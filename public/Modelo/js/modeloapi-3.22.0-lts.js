!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Modelo",[],t):"object"==typeof exports?exports.Modelo=t():e.Modelo=t()}(this,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=149)}([function(e,t,r){"use strict";var i=r(14),n=new(function(){function e(){this.sub=this.subtract,this.mul=this.multiply,this.div=this.divide,this.dist=this.distance,this.sqrDist=this.squaredDistance,this.len=this.length,this.sqrLen=this.squaredLength}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},e.prototype.fromValues=function(e,t){var r=new i.a.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},e.prototype.set=function(e,t,r){return e[0]=t,e[1]=r,e},e.prototype.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},e.prototype.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},e.prototype.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},e.prototype.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},e.prototype.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},e.prototype.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},e.prototype.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},e.prototype.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},e.prototype.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},e.prototype.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},e.prototype.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},e.prototype.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},e.prototype.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},e.prototype.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.prototype.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},e.prototype.rotate=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e},e.prototype.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.prototype.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},e.prototype.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},e.prototype.random=function(e,t){t=t||1;var r=2*i.a.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},e.prototype.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},e.prototype.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},e.prototype.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},e.prototype.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},e.prototype.forEach=function(e,t,r,i,a,o){var s,l,u=n.create();for(t||(t=2),r||(r=0),l=i?Math.min(i*t+r,e.length):e.length,s=r;s<l;s+=t)u[0]=e[s],u[1]=e[s+1],a(u,u,o),e[s]=u[0],e[s+1]=u[1];return e},e.prototype.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},e}()),a=n,o=r(6),s=r(34),l=new(function(){function e(){}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.prototype.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},e.prototype.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},e.prototype.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},e.prototype.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},e.prototype.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},e.prototype.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*s+a*l,e[1]=n*s+o*l,e[2]=i*u+a*c,e[3]=n*u+o*c,e},e.prototype.mul=function(e,t,r){return this.multiply(e,t,r)},e.prototype.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=n*l+o*s,e[2]=i*-s+a*l,e[3]=n*-s+o*l,e},e.prototype.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*l,e[3]=o*l,e},e.prototype.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},e.prototype.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},e.prototype.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e.prototype.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},e.prototype.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},e}()),u=new(function(){function e(){}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.prototype.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},e.prototype.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=r*a-i*n;return l?(l=1/l,e[0]=a*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*s-a*o)*l,e[5]=(i*o-r*s)*l,e):null},e.prototype.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},e.prototype.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1],h=r[2],d=r[3],p=r[4],f=r[5];return e[0]=i*u+a*c,e[1]=n*u+o*c,e[2]=i*h+a*d,e[3]=n*h+o*d,e[4]=i*p+a*f+s,e[5]=n*p+o*f+l,e},e.prototype.mul=function(e,t,r){this.multiply(e,t,r)},e.prototype.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*u,e[1]=n*c+o*u,e[2]=i*-u+a*c,e[3]=n*-u+o*c,e[4]=s,e[5]=l,e},e.prototype.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1];return e[0]=i*u,e[1]=n*u,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=l,e},e.prototype.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=i*u+a*c+s,e[5]=n*u+o*c+l,e},e.prototype.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},e.prototype.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},e.prototype.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},e.prototype.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},e.prototype.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},e}()),c=r(50),h=r(57),d=r(33);r.d(t,!1,function(){return i.a}),r.d(t,"c",function(){return a}),r.d(t,"d",function(){return o.a}),r.d(t,"e",function(){return s.a}),r.d(t,!1,function(){return l}),r.d(t,!1,function(){return u}),r.d(t,!1,function(){return c.a}),r.d(t,"b",function(){return h.a}),r.d(t,"a",function(){return d.a})},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={isMobile:!1,devicePixelRatio:1,littleEndian:!0,gpuMemory:256,browserName:"",browserVersion:"",browserEngineName:"",browserEngineVersion:"",deviceModel:"",deviceType:"",deviceVendor:"",osName:"",osVersion:"",cpuArchitecture:"",initResize:!0,webvr:!1,isOrbital:!1,gpuInfo:{device:void 0,tier:void 0,fps:void 0,gpu:void 0,type:void 0}}},function(e,t,r){"use strict";var i,n=r(0),a=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],s=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],l={width:0,height:0,depth:0};!function(e){var t=0,r=0,i=function(){function e(){}return e.create=function(){return{tip:n.d.create(),direction:n.d.create(),cosThetaSquared:0,sinThetaSquared:0,invSinTheta:0}},e.updateShape=function(e,i,n){t=.017453293*i*.5,r=Math.tan(t),r*=Math.sqrt(1+n*n),e.cosThetaSquared=1/(r*r+1),e.sinThetaSquared=1-e.cosThetaSquared,e.invSinTheta=1/Math.sqrt(e.sinThetaSquared)},e}();e.cone=i;var u=function(){function e(){this._vec=new Float32Array(3)}return e.createFromArray=function(e){var t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.createFromSphere=function(e){var t=new Float32Array(6);return t[0]=e[0]-e[3],t[1]=e[1]-e[3],t[2]=e[2]-e[3],t[3]=e[0]+e[3],t[4]=e[1]+e[3],t[5]=e[2]+e[3],t},e.createFromPoints=function(e,t){e[0]=t[0][0],e[3]=t[0][0],e[1]=t[0][1],e[4]=t[0][1],e[2]=t[0][2],e[5]=t[0][2];for(var r=1,i=t.length;r<i;r++)e[0]>t[r][0]&&(e[0]=t[r][0]),e[3]<t[r][0]&&(e[3]=t[r][0]),e[1]>t[r][1]&&(e[1]=t[r][1]),e[4]<t[r][1]&&(e[4]=t[r][1]),e[2]>t[r][2]&&(e[2]=t[r][2]),e[5]<t[r][2]&&(e[5]=t[r][2]);return e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.create=function(e,t){var r=new Float32Array(6);return e=e||a,t=t||o,r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.invalidate=function(e){e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=o[0],e[4]=o[1],e[5]=o[2]},e.min=function(e){return n.d.fromValues(e[0],e[1],e[2])},e.max=function(e){return n.d.fromValues(e[3],e[4],e[5])},e.len=function(e){var t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return Math.sqrt(t*t+r*r+i*i)},e.isEqual=function(e,t){return Math.abs(e[0]-t[0])<1e-6&&Math.abs(e[1]-t[1])<1e-6&&Math.abs(e[2]-t[2])<1e-6&&Math.abs(e[3]-t[3])<1e-6&&Math.abs(e[4]-t[4])<1e-6&&Math.abs(e[5]-t[5])<1e-6},e.union=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e[4]=Math.max(t[4],r[4]),e[5]=Math.max(t[5],r[5]),e},e.moveTo=function(e,t,r){var i=r[0]-.5*(t[0]+t[3]),n=r[1]-.5*(t[1]+t[4]),a=r[2]-.5*(t[2]+t[5]);return e[0]=t[0]+i,e[1]=t[1]+n,e[2]=t[2]+a,e[3]=t[3]+i,e[4]=t[4]+n,e[5]=t[5]+a,e},e.scaleTo=function(e,t,r){var i=.5*(t[0]+t[3])-.5*r[0],n=.5*(t[0]+t[3])+.5*r[0],a=.5*(t[1]+t[4])-.5*r[1],o=.5*(t[1]+t[4])+.5*r[1],s=.5*(t[2]+t[5])-.5*r[2],l=.5*(t[2]+t[5])+.5*r[2];e[0]=i,e[3]=n,e[1]=a,e[4]=o,e[2]=s,e[5]=l},e.scale=function(e,t,r){var i=.5-.5*r,n=.5+.5*r,a=t[0]*n+t[3]*i,o=t[0]*i+t[3]*n,s=t[1]*n+t[4]*i,l=t[1]*i+t[4]*n,u=t[2]*n+t[5]*i,c=t[2]*i+t[5]*n;e[0]=a,e[3]=o,e[1]=s,e[4]=l,e[2]=u,e[5]=c},e.expand=function(e,t){void 0===t&&(t=1e-4),e[0]-=t,e[1]-=t,e[2]-=t,e[3]+=t,e[4]+=t,e[5]+=t},e.points=function(e){var t=[];return t.push(n.d.fromValues(e[0],e[1],e[2])),t.push(n.d.fromValues(e[3],e[1],e[2])),t.push(n.d.fromValues(e[3],e[4],e[2])),t.push(n.d.fromValues(e[0],e[4],e[2])),t.push(n.d.fromValues(e[0],e[1],e[5])),t.push(n.d.fromValues(e[3],e[1],e[5])),t.push(n.d.fromValues(e[3],e[4],e[5])),t.push(n.d.fromValues(e[0],e[4],e[5])),t},e.points2=function(e,t){return t[0][0]=e[0],t[0][1]=e[1],t[0][2]=e[2],t[1][0]=e[3],t[1][1]=e[1],t[1][2]=e[2],t[2][0]=e[3],t[2][1]=e[4],t[2][2]=e[2],t[3][0]=e[0],t[3][1]=e[4],t[3][2]=e[2],t[4][0]=e[0],t[4][1]=e[1],t[4][2]=e[5],t[5][0]=e[3],t[5][1]=e[1],t[5][2]=e[5],t[6][0]=e[3],t[6][1]=e[4],t[6][2]=e[5],t[7][0]=e[0],t[7][1]=e[4],t[7][2]=e[5],t},e.points3=function(e,t){return t[0][0]=e[0],t[0][1]=e[1],t[0][2]=e[2],t[1][0]=e[3],t[1][1]=e[1],t[1][2]=e[2],t[2][0]=e[3],t[2][1]=e[1],t[2][2]=e[5],t[3][0]=e[0],t[3][1]=e[1],t[3][2]=e[5],t[4][0]=e[0],t[4][1]=e[4],t[4][2]=e[2],t[5][0]=e[3],t[5][1]=e[4],t[5][2]=e[2],t[6][0]=e[3],t[6][1]=e[4],t[6][2]=e[5],t[7][0]=e[0],t[7][1]=e[4],t[7][2]=e[5],t},e.planes=function(e){var t=[];return t.push(n.e.fromValues(-1,0,0,+e[0])),t.push(n.e.fromValues(0,-1,0,+e[1])),t.push(n.e.fromValues(0,0,-1,+e[2])),t.push(n.e.fromValues(1,0,0,-e[3])),t.push(n.e.fromValues(0,1,0,-e[4])),t.push(n.e.fromValues(0,0,1,-e[5])),t},e.volume=function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},e.size=function(e){return l.width=e[3]-e[0],l.height=e[4]-e[1],l.depth=e[5]-e[2],l},e.center=function(e){return[.5*(e[0]+e[3]),.5*(e[1]+e[4]),.5*(e[2]+e[5])]},e.transform=function(t,r,i){e.points2(r,s),n.d.transformMat4(s[0],s[0],i),n.d.transformMat4(s[1],s[1],i),n.d.transformMat4(s[2],s[2],i),n.d.transformMat4(s[3],s[3],i),n.d.transformMat4(s[4],s[4],i),n.d.transformMat4(s[5],s[5],i),n.d.transformMat4(s[6],s[6],i),n.d.transformMat4(s[7],s[7],i),t[0]=s[0][0],t[3]=s[0][0],t[1]=s[0][1],t[4]=s[0][1],t[2]=s[0][2],t[5]=s[0][2];for(var a=1;a<8;a++)t[0]>s[a][0]&&(t[0]=s[a][0]),t[3]<s[a][0]&&(t[3]=s[a][0]),t[1]>s[a][1]&&(t[1]=s[a][1]),t[4]<s[a][1]&&(t[4]=s[a][1]),t[2]>s[a][2]&&(t[2]=s[a][2]),t[5]<s[a][2]&&(t[5]=s[a][2])},e.isEmpty=function(e){return e[3]<e[0]||e[4]<e[1]||e[5]<e[2]},e}();e.aabb=u;var c=function(){function e(){}return e.create=function(e,t,r){var i=t[0]-e[0],a=t[1]-e[1],o=t[2]-e[2],s=r[0]-e[0],l=r[1]-e[1],u=r[2]-e[2],c=n.e.create();return c[0]=a*u-o*l,c[1]=o*s-i*u,c[2]=i*l-a*s,c[3]=-(c[0]*e[0]+c[1]*e[1]+c[2]*e[2]),this.normalize(c),c},e.createABCD=function(e,t,r,i){var a=n.e.fromValues(e,t,r,i);return this.normalize(a),a},e.normalize=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t},e}();e.plane=c;var h=function(){function e(){}return e.createFromAABB=function(e){var t=new Float32Array(4);return t[0]=.5*(e[0]+e[3]),t[1]=.5*(e[1]+e[4]),t[2]=.5*(e[2]+e[5]),t[3]=.5*u.len(e),t},e.createFromArray=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e}();e.sphere=h;var d=n.a.create(),p=function(){function e(){}return e.createFromMatrix=function(e){var t,r=[];for(t=0;t<14;++t)r.push(n.e.create());for(n.a.invert(d,e),n.e.transformMat4(r[6],[-1,-1,-1,1],d),n.e.transformMat4(r[7],[1,-1,-1,1],d),n.e.transformMat4(r[8],[1,-1,1,1],d),n.e.transformMat4(r[9],[-1,-1,1,1],d),n.e.transformMat4(r[10],[-1,1,-1,1],d),n.e.transformMat4(r[11],[1,1,-1,1],d),n.e.transformMat4(r[12],[1,1,1,1],d),n.e.transformMat4(r[13],[-1,1,1,1],d),t=6;t<14;++t)n.e.scale(r[t],r[t],1/r[t][3]);var i=-e[3],a=-e[7],o=-e[11],s=-e[15];return r[0]=c.createABCD(i-e[2],a-e[6],o-e[10],s-e[14]),r[1]=c.createABCD(i+e[2],a+e[6],o+e[10],s+e[14]),r[2]=c.createABCD(i+e[1],a+e[5],o+e[9],s+e[13]),r[3]=c.createABCD(i-e[1],a-e[5],o-e[9],s-e[13]),r[4]=c.createABCD(i-e[0],a-e[4],o-e[8],s-e[12]),r[5]=c.createABCD(i+e[0],a+e[4],o+e[8],s+e[12]),r},e.points=function(e){return e.slice(6)},e.planes=function(e){var t=[];return t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3]),t.push(e[4]),t.push(e[5]),t},e}();e.frustum=p;var f=new Array(4),_=[0,0,0],m=[0,0,0],v=[0,0,0],y=[0,0,0],g=[0,0,0],b=[0,0,0],w=[0,0,0],x=[0,0,0],M=function(){function e(){}return e.line_plane=function(e,t,r){n.d.subtract(g,e,t),n.d.normalize(y,g);var i=n.d.dot(y,r);if(Math.abs(i)<=.001)return null;for(var a=-(n.d.dot(t,r)+r[3])/i,o=0;o<3;++o)if(a*y[o]/g[o]<0||a*y[o]/g[o]>1)return null;var s=n.d.create();return s[0]=t[0]+a*y[0],s[1]=t[1]+a*y[1],s[2]=t[2]+a*y[2],s},e.line_frustum=function(t,r,i,n){for(var a=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[0,3,2,1],[0,4,7,3],[1,2,6,5]],o=!1,s=0;s<6;s++){var l=i[s],u=[];u.push(i[a[s][0]+6]),u.push(i[a[s][1]+6]),u.push(i[a[s][2]+6]),u.push(i[a[s][3]+6]);var c=e.line_frustum_quad(t,r,l,u);null!==c&&(n.push(c),o=!0)}return o},e.line_aabb=function(t,r,i,n){for(var a=u.planes(i),o=!1,s=0;s<6;s++){var l=e.line_aabb_quad(t,r,a[s],i,s);null!=l&&(n.push(l),o=!0)}return o},e.line_frustum_quad=function(t,r,i,n){var a;return null==(a=e.line_plane(t,r,i))?null:E.point_triangle(n[0],n[1],n[2],a)||E.point_triangle(n[2],n[3],n[0],a)?a:null},e.line_aabb_quad=function(t,r,i,n,a){var o;if(null===(o=e.line_plane(t,r,i)))return null;var s=!1;switch(a){case 1:case 4:s=E.point_slab(o[0],n[0],n[3])&&E.point_slab(o[2],n[2],n[5]);break;case 5:case 2:s=E.point_slab(o[0],n[0],n[3])&&E.point_slab(o[1],n[1],n[4]);break;case 0:case 3:s=E.point_slab(o[1],n[1],n[4])&&E.point_slab(o[2],n[2],n[5])}return s?o:null},e.ray_aabb=function(e,t,r){for(var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,a=!0,o=-1,s=0;s<3;s++){var l=t[s],u=e[s],c=r[s],h=r[s+3];if(0!==l){var d=(c-u)/l,p=(h-u)/l,_=0;if(d>p){var m=p;p=d,d=m,_=1}if(d>i&&(i=d,o=2*s+_),(i=Math.max(d,i))>(n=Math.min(p,n))){a=!1;break}if(n<0){a=!1;break}}else if(l<c||l>h){a=!1;break}}return a?(f[0]=e[0]+t[0]*i,f[1]=e[1]+t[1]*i,f[2]=e[2]+t[2]*i,f[3]=o,f):null},e.sphere_frustum=function(e,t){return n.d.dot(t[0],e)+t[0][3]<e[3]&&n.d.dot(t[1],e)+t[1][3]<e[3]&&n.d.dot(t[2],e)+t[2][3]<e[3]&&n.d.dot(t[3],e)+t[3][3]<e[3]&&n.d.dot(t[4],e)+t[4][3]<e[3]&&n.d.dot(t[5],e)+t[5][3]<e[3]},e.prototype.sphere_cone=function(e,t){n.d.scale(_,t.direction,t.invSinTheta*e[3]),n.d.subtract(m,t.tip,_),n.d.subtract(v,e,m);var r=n.d.dot(v,v),i=n.d.dot(t.direction,v);return i>0&&i*i>=r*t.cosThetaSquared&&(n.d.subtract(v,e,t.tip),r=n.d.dot(v,v),!((i=-n.d.dot(t.direction,v))>0&&i*i>=r*t.sinThetaSquared)||r<=e[3]*e[3])},e.aabb_frustum=function(t,r){var i,n=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],a=u.points(t),o=p.points(r),s=[];for(i=0;i<12;i++)e.line_frustum(a[n[i][0]],a[n[i][1]],r,s);for(i=0;i<12;i++)e.line_aabb(o[n[i][0]],o[n[i][1]],t,s);for(i=0;i<8;i++){var l=a[i];E.point_frustum(l,r)&&s.push(l)}for(i=0;i<8;i++){var c=o[i];E.point_aabb(c,t)&&s.push(c)}return s},e.aabb_aabb=function(e,t){return(E.point_slab(e[0],t[0],t[3])||E.point_slab(e[3],t[0],t[3]))&&(E.point_slab(e[1],t[1],t[4])||E.point_slab(e[4],t[1],t[4]))&&(E.point_slab(e[2],t[2],t[5])||E.point_slab(e[5],t[2],t[5]))||(E.point_slab(t[0],e[0],e[3])||E.point_slab(t[3],e[0],e[3]))&&(E.point_slab(t[1],e[1],e[4])||E.point_slab(t[4],e[1],e[4]))&&(E.point_slab(t[2],e[2],e[5])||E.point_slab(t[5],e[2],e[5]))},e}();e.intersect=M;var E=function(){function e(){}return e.point_triangle=function(e,t,r,i){n.d.subtract(b,r,e),n.d.subtract(w,t,e),n.d.subtract(x,i,e);var a=n.d.dot(b,b),o=n.d.dot(b,w),s=n.d.dot(b,x),l=n.d.dot(w,w),u=n.d.dot(w,x),c=1/(a*l-o*o),h=(l*s-o*u)*c;if(h<0||h>1)return!1;var d=(a*u-o*s)*c;return!(d<0||d>1)&&h+d<=1},e.point_aabb=function(e,t){return e[0]>t[0]&&e[1]>t[1]&&e[2]>t[2]&&e[0]<t[3]&&e[1]<t[4]&&e[2]<t[5]},e.point_frustum=function(e,t){return n.d.dot(t[0],e)+t[0][3]<0&&n.d.dot(t[1],e)+t[1][3]<0&&n.d.dot(t[2],e)+t[2][3]<0&&n.d.dot(t[3],e)+t[3][3]<0&&n.d.dot(t[4],e)+t[4][3]<0&&n.d.dot(t[5],e)+t[5][3]<0},e.sphere_frustum=function(e,t){return n.d.dot(t[0],e)+t[0][3]<-e[3]&&n.d.dot(t[1],e)+t[1][3]<-e[3]&&n.d.dot(t[2],e)+t[2][3]<-e[3]&&n.d.dot(t[3],e)+t[3][3]<-e[3]&&n.d.dot(t[4],e)+t[4][3]<-e[3]&&n.d.dot(t[5],e)+t[5][3]<-e[3]},e.point_slab=function(e,t,r){return e<r&&e>t},e.aabb_frustum=function(t,r){var i=u.points(t);return e.point_frustum(i[0],r)&&e.point_frustum(i[1],r)&&e.point_frustum(i[2],r)&&e.point_frustum(i[3],r)&&e.point_frustum(i[4],r)&&e.point_frustum(i[5],r)&&e.point_frustum(i[6],r)&&e.point_frustum(i[7],r)},e}();e.inside=E;var T=function(){function e(){}return e.point_frustum=function(e,t){return n.d.dot(t[0],e)+t[0][3]>0||n.d.dot(t[1],e)+t[1][3]>0||n.d.dot(t[2],e)+t[2][3]>0||n.d.dot(t[3],e)+t[3][3]>0||n.d.dot(t[4],e)+t[4][3]>0||n.d.dot(t[5],e)+t[5][3]>0},e.sphere_frustum=function(e,t){return n.d.dot(t[0],e)+t[0][3]>e[3]||n.d.dot(t[1],e)+t[1][3]>e[3]||n.d.dot(t[2],e)+t[2][3]>e[3]||n.d.dot(t[3],e)+t[3][3]>e[3]||n.d.dot(t[4],e)+t[4][3]>e[3]||n.d.dot(t[5],e)+t[5][3]>e[3]},e.aabb_frustum=function(e,t){for(var r=0;r<6;r++){var i=t[r][0]>0?e[0]:e[3],n=t[r][1]>0?e[1]:e[4],a=t[r][2]>0?e[2]:e[5];if(t[r][0]*i+t[r][1]*n+t[r][2]*a+t[r][3]>0)return!0}for(r=0;r<3;r++){if(t[6][r]>e[1][r]&&t[7][r]>e[1][r]&&t[8][r]>e[1][r]&&t[9][r]>e[1][r]&&t[10][r]>e[1][r]&&t[11][r]>e[1][r]&&t[12][r]>e[1][r]&&t[13][r]>e[1][r])return!0;if(t[6][r]<e[0][r]&&t[7][r]<e[0][r]&&t[8][r]<e[0][r]&&t[9][r]<e[0][r]&&t[10][r]<e[0][r]&&t[11][r]<e[0][r]&&t[12][r]<e[0][r]&&t[13][r]<e[0][r])return!0}return!1},e.aabb_aabb=function(e,t){return e[3]<=t[0]||e[0]>=t[3]||e[4]<=t[1]||e[1]>=t[4]||e[5]<=t[2]||e[2]>=t[5]},e}();e.outside=T,e.clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},e.lerp=function(e,t,r){return e+(t-e)*r},e.isPowerOfTwo=function(e){return 0==(e&e-1)&&0!==e},e.floorPowerOfTwo=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.vfovToHfov=function(e,t){var r=2*Math.tan(e*Math.PI/180/2)*t;return 2*Math.atan(r/2)*180/Math.PI}}(i||(i={})),t.a=i},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,LINEAR_MIPMAP_LINEAR:9987,LINEAR:9729,NEAREST:9728,NEAREST_MIPMAP_NEAREST:9984,REPEAT:10497,CLAMP_TO_EDGE:33071,RGBA:6408,RGB:6407}},function(e,t,r){"use strict";var i=r(13),n={};n.pbr=new i.a("pbr",["main.vs","pbr_main.vs","transform_simple.inc"],["pbr.fs","pbr_main.fs","material_pbr.inc","shade_pbr.inc"],{highPrecision:!0,vpMatrix:!0,position:!0,normal:!0,modelMatrix:!0,uv:!0}),n["animating-pipe-solid"]=new i.a("animating-pipe-solid",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!1,position:!0,normal:!0,uv:!0}),n["animating-pipe-texture"]=new i.a("animating-pipe-texture",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_pipe_texture.inc","shade_adhoc.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!1,position:!0,normal:!0,uv:!0}),n["animating-stripe"]=new i.a("animating-stripe",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_animating_ribbon.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),n["animating-ribbon"]=new i.a("animating-ribbon",["main.vs","modelo_ribbon.vs"],["main.fs","modelo_main.fs","material_animating_ribbon.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),n.heightmap=new i.a("heightmap",["main.vs","modelo_main.vs","transform_heightmap.inc"],["main.fs","modelo_main.fs","material_heightmap.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.heatmap=new i.a("heatmap",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_heatmap.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!1,uv:!0}),n.volume=new i.a("volume",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_dummy.inc","shade_volume.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.volume_multi_layer=new i.a("volume_multi_layer",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_dummy.inc","shade_volume_multi_layer.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.color_multi_layer=new i.a("color_multi_layer",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_dummy.inc","shade_color_multi_layer.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.barchart_wireframe=new i.a("barchart_wireframe",["main.vs","modelo_main.vs","transform_barchart_wireframe.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!1,uv:!1}),n.barchart=new i.a("barchart",["main.vs","modelo_main.vs","transform_barchart.inc"],["main.fs","modelo_main.fs","material_barchart.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.blit=new i.a("blit","blit.vs",["blit.fs","blit_simple.inc"],{highPrecision:!0,position:!0,modelMatrix:!0,uv:!0}),n.blit_dof=new i.a("blit_dof","blit.vs",["blit.fs","blit_dof.inc"],{highPrecision:!0,position:!0,modelMatrix:!0,uv:!0}),n.blit_multiply=new i.a("blit","blit.vs",["blit.fs","blit_multiply.inc"],{highPrecision:!0,position:!0,modelMatrix:!0,uv:!0}),n.blit_glow=new i.a("blit_glow","blit.vs",["blit.fs","blit_glow.inc"],{highPrecision:!0,position:!0,modelMatrix:!0,uv:!0}),n.accumulate=new i.a("accumulate","blit.vs",["blit.fs","blit_accumulate.inc"],{highPrecision:!0,position:!0,uv:!0}),n.normaldepth=new i.a("normaldepth",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","normaldepth_main.fs"],{highPrecision:!0,vpMatrix:!0,viewMatrix:!0,modelMatrix:!0,position:!0,normal:!0,depth:!0,uv:!0}),n.depth=new i.a("depth",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","depth_main.fs"],{highPrecision:!0,vpMatrix:!0,viewMatrix:!0,modelMatrix:!0,position:!0,depth:!0,uv:!0}),n.solid=new i.a("solid",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_adhoc.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.dark=new i.a("dark",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_dark.fs"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.mark=new i.a("mark",["main.vs","modelo_main.vs","transform_mark.inc"],["main.fs","mark_main.fs"],{highPrecision:!0,modelMatrix:!0,vpMatrix:!0,vertexid:!0}),n.color=new i.a("color",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_color.inc","shade_adhoc.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,color:!0}),n.texture=new i.a("texture",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_texture.inc","shade_adhoc.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0,uv:!0}),n.glass=new i.a("glass",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_glass.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,normal:!0}),n.plain=new i.a("plain",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0}),n.plain_texture=new i.a("plain_texture",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","modelo_main.fs","material_texture.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),n.df_text=new i.a("df_text",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","modelo_main.fs","material_dummy.inc","shade_glyph.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),n.constant=new i.a("constant",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0}),n.constant_mask=new i.a("constant_mask",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","modelo_main.fs","material_mask.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),n.constant_shape=new i.a("constant",["main.vs","modelo_main_shape.vs","transform_nonormal.inc"],["main_shape.fs","modelo_main.fs","material_solid.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0}),n.constant2d=new i.a("constant2d","blit.vs","blit_direct.fs",{highPrecision:!0,position:!0}),n.skybox=new i.a("skybox",["main.vs","modelo_main.vs","transform_skybox.inc"],["main.fs","modelo_main.fs","material_skybox.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,uv:!0}),n.woit_accum_texture=new i.a("woit_accum_texture",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_texture.inc","shade_oit.inc"],{highPrecision:!0,vpMatrix:!0,viewMatrix:!0,modelMatrix:!0,position:!0,normal:!0,depth:!0,uv:!0}),n.woit_accum_solid=new i.a("woit_accum_solid",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_solid.inc","shade_oit.inc"],{highPrecision:!0,vpMatrix:!0,viewMatrix:!0,modelMatrix:!0,position:!0,normal:!0,depth:!0}),n.woit_accum_color=new i.a("woit_accum_color",["main.vs","modelo_main.vs","transform_simple.inc"],["main.fs","modelo_main.fs","material_color.inc","shade_oit.inc"],{highPrecision:!0,vpMatrix:!0,viewMatrix:!0,modelMatrix:!0,position:!0,normal:!0,depth:!0}),n.woit_reveal=new i.a("woit_reveal","blit.vs",["blit.fs","blit_oit.inc"],{highPrecision:!0,modelMatrix:!0,position:!0}),n.ssao=new i.a("ssao","blit.vs",["blit.fs","blit_ssao2.inc"],{highPrecision:!0}),n.shadowsmooth=new i.a("shadowsmooth","blit.vs",["blit.fs","blit_shadow.inc"],{highPrecision:!0,position:!0,uv:!0}),n.sketch=new i.a("sketch","blit.vs",["blit.fs","blit_sketch.inc"],{highPrecision:!0,position:!0,uv:!0}),n.contour=new i.a("contour","blit.vs",["blit.fs","blit_contour.inc"],{highPrecision:!0,position:!0,uv:!0}),n.contouroverlay=new i.a("contouroverlay","blit.vs",["blit.fs","blit_contour_overlay.inc"],{highPrecision:!0,position:!0,uv:!0}),n.outline=new i.a("outline","blit.vs",["blit.fs","blit_outline.inc"],{highPrecision:!0,position:!0,uv:!0}),n.outlineoverlay=new i.a("outlineoverlay","blit.vs",["blit.fs","blit_outline_overlay.inc"],{highPrecision:!0,position:!0,uv:!0}),n.vr_wrap=new i.a("vr_wrap","blit.vs",["blit.fs","blit_vr_wrap.inc"],{highPrecision:!0,position:!0,uv:!0}),n.gradient=new i.a("gradient","blit.vs",["blit.fs","blit_gradient.inc"],{highPrecision:!0,position:!0,uv:!0}),n.glow=new i.a("glow","blit.vs",["blit.fs","blit_glow.inc"],{highPrecision:!0,position:!0,uv:!0}),n.glow_blur=new i.a("glow_blur","blit.vs",["blit.fs","blit_glow_blur.inc"],{highPrecision:!0,position:!0,uv:!0}),n.fog=new i.a("fog","blit.vs",["blit.fs","blit_fog.inc"],{highPrecision:!0,position:!0,uv:!0}),n.metaball=new i.a("metaball","blit.vs",["blit.fs","blit_metaball.inc"],{highPrecision:!0,position:!0,uv:!0}),n.overlay=new i.a("overlay","blit.vs",["blit.fs","blit_overlay.inc"],{highPrecision:!0,position:!0,uv:!0}),n.background=new i.a("background","blit.vs",["blit.fs","blit_transparent.inc"],{highPrecision:!0,position:!0,uv:!0}),n.map_tile=new i.a("map_tile",["main.vs","modelo_main.vs","transform_nonormal.inc"],["main.fs","map.fs","material_texture.inc","shade_plain.inc"],{highPrecision:!0,vpMatrix:!0,modelMatrix:!0,position:!0,uv:!0}),t.a=n},function(e,t,r){"use strict";r.d(t,"c",function(){return n}),r.d(t,"a",function(){return a}),r.d(t,"e",function(){return o}),r.d(t,"b",function(){return s}),r.d(t,"d",function(){return l}),r.d(t,"f",function(){return u});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function n(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a=function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function o(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function s(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})}function l(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i}},function(e,t,r){"use strict";var i=r(14),n=new(function(){function e(){this.sub=this.subtract,this.mul=this.multiply,this.div=this.divide,this.dist=this.distance,this.sqrDist=this.squaredDistance,this.len=this.length,this.sqrLen=this.squaredLength}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.prototype.fromValues=function(e,t,r){var n=new i.a.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.prototype.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},e.prototype.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},e.prototype.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},e.prototype.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},e.prototype.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},e.prototype.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},e.prototype.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},e.prototype.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},e.prototype.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},e.prototype.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)},e.prototype.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n},e.prototype.length=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},e.prototype.squaredLength=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i},e.prototype.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},e.prototype.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},e.prototype.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},e.prototype.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=n*l-a*s,e[1]=a*o-i*l,e[2]=i*s-n*o,e},e.prototype.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e},e.prototype.hermite=function(e,t,r,i,n,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*l+i[0]*u+n[0]*c,e[1]=t[1]*s+r[1]*l+i[1]*u+n[1]*c,e[2]=t[2]*s+r[2]*l+i[2]*u+n[2]*c,e},e.prototype.bezier=function(e,t,r,i,n,a){var o=1-a,s=o*o,l=a*a,u=s*o,c=3*a*s,h=3*l*o,d=l*a;return e[0]=t[0]*u+r[0]*c+i[0]*h+n[0]*d,e[1]=t[1]*u+r[1]*c+i[1]*h+n[1]*d,e[2]=t[2]*u+r[2]*c+i[2]*h+n[2]*d,e},e.prototype.random=function(e,t){t=t||1;var r=2*i.a.RANDOM()*Math.PI,n=2*i.a.RANDOM()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e},e.prototype.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e},e.prototype.transformDirection=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*a,e[1]=r[1]*i+r[5]*n+r[9]*a,e[2]=r[2]*i+r[6]*n+r[10]*a,e},e.prototype.transformMat3=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},e.prototype.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*i+s*a-l*n,h=u*n+l*i-o*a,d=u*a+o*n-s*i,p=-o*i-s*n-l*a;return e[0]=c*u+p*-o+h*-l-d*-s,e[1]=h*u+p*-s+d*-o-c*-l,e[2]=d*u+p*-l+c*-s-h*-o,e},e.prototype.rotateX=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},e.prototype.rotateY=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},e.prototype.rotateZ=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},e.prototype.rotateAxisZ=function(e,t,r){return e[0]=t[0]*Math.cos(r)-t[1]*Math.sin(r),e[1]=t[0]*Math.sin(r)+t[1]*Math.cos(r),e[2]=t[2],e},e.prototype.rotateByVector=function(e,t,r,i){var n=Math.cos(i),a=Math.sin(i);return e[0]=(r[0]*r[0]*(1-n)+n)*t[0]+(r[0]*r[1]*(1-n)-r[2]*a)*t[1]+(r[0]*r[2]*(1-n)+r[1]*a)*t[2],e[1]=(r[1]*r[0]*(1-n)+r[2]*a)*t[0]+(r[1]*r[1]*(1-n)+n)*t[1]+(r[1]*r[2]*(1-n)-r[0]*a)*t[2],e[2]=(r[0]*r[2]*(1-n)-r[1]*a)*t[0]+(r[1]*r[2]*(1-n)+r[0]*a)*t[1]+(r[2]*r[2]*(1-n)+n)*t[2],e},e.prototype.forEach=function(e,t,r,i,n,a){var o,s,l=this.create();for(t||(t=3),r||(r=0),s=i?Math.min(i*t+r,e.length):e.length,o=r;o<s;o+=t)l[0]=e[o],l[1]=e[o+1],l[2]=e[o+2],n(l,l,a),e[o]=l[0],e[o+1]=l[1],e[o+2]=l[2];return e},e.prototype.angle=function(e,t){var r=this.fromValues(e[0],e[1],e[2]),i=this.fromValues(t[0],t[1],t[2]);this.normalize(r,r),this.normalize(i,i);var n=this.dot(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)},e.prototype.angleTo=function(e,t){var r=this.create();this.cross(r,e,t);var i=this.fromValues(e[0],e[1],e[2]),n=this.fromValues(t[0],t[1],t[2]);this.normalize(i,i),this.normalize(n,n);var a=this.dot(i,n);return a>1?0:a<-1?Math.PI:r[2]>0?Math.acos(a):-Math.acos(a)},e.prototype.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},e.prototype.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},e}());t.a=n},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return U}),r.d(t,"b",function(){return d}),r.d(t,"c",function(){return T}),r.d(t,"d",function(){return z}),r.d(t,"e",function(){return H}),r.d(t,"f",function(){return W}),r.d(t,"g",function(){return N}),r.d(t,"h",function(){return C}),r.d(t,"i",function(){return g}),r.d(t,"j",function(){return k}),r.d(t,"k",function(){return E}),r.d(t,"l",function(){return D}),r.d(t,"m",function(){return A}),r.d(t,"n",function(){return P}),r.d(t,"o",function(){return O}),r.d(t,"p",function(){return h}),r.d(t,"q",function(){return K}),r.d(t,"r",function(){return x}),r.d(t,"s",function(){return w}),r.d(t,"t",function(){return f}),r.d(t,"u",function(){return m}),r.d(t,"v",function(){return _}),r.d(t,"w",function(){return y}),r.d(t,"x",function(){return Y}),r.d(t,"y",function(){return X}),r.d(t,"z",function(){return J}),r.d(t,"A",function(){return ee}),r.d(t,"B",function(){return te}),r.d(t,"C",function(){return G}),r.d(t,"D",function(){return j}),r.d(t,"E",function(){return p}),r.d(t,"F",function(){return b}),r.d(t,"G",function(){return u}),r.d(t,"H",function(){return v}),r.d(t,"I",function(){return Z});var i=r(35),n=r(10),a=r(5),o=r(111),s=r.n(o);r(69);function l(e,t,r,i){if(function(e){return"IntValue"===e.kind}(r)||function(e){return"FloatValue"===e.kind}(r))e[t.value]=Number(r.value);else if(function(e){return"BooleanValue"===e.kind}(r)||function(e){return"StringValue"===e.kind}(r))e[t.value]=r.value;else if(function(e){return"ObjectValue"===e.kind}(r)){var a={};r.fields.map(function(e){return l(a,e.name,e.value,i)}),e[t.value]=a}else if(function(e){return"Variable"===e.kind}(r)){var o=(i||{})[r.name.value];e[t.value]=o}else if(function(e){return"ListValue"===e.kind}(r))e[t.value]=r.values.map(function(e){var r={};return l(r,t,e,i),r[t.value]});else if(function(e){return"EnumValue"===e.kind}(r))e[t.value]=r.value;else{if(!function(e){return"NullValue"===e.kind}(r))throw new n.a(17);e[t.value]=null}}function u(e,t){var r=null;e.directives&&(r={},e.directives.forEach(function(e){r[e.name.value]={},e.arguments&&e.arguments.forEach(function(i){var n=i.name,a=i.value;return l(r[e.name.value],n,a,t)})}));var i=null;return e.arguments&&e.arguments.length&&(i={},e.arguments.forEach(function(e){var r=e.name,n=e.value;return l(i,r,n,t)})),h(e.name.value,i,r)}var c=["connection","include","skip","client","rest","export"];function h(e,t,r){if(r&&r.connection&&r.connection.key){if(r.connection.filter&&r.connection.filter.length>0){var i=r.connection.filter?r.connection.filter:[];i.sort();var n=t,a={};return i.forEach(function(e){a[e]=n[e]}),r.connection.key+"("+JSON.stringify(a)+")"}return r.connection.key}var o=e;if(t){var l=s()(t);o+="("+l+")"}return r&&Object.keys(r).forEach(function(e){-1===c.indexOf(e)&&(r[e]&&Object.keys(r[e]).length?o+="@"+e+"("+JSON.stringify(r[e])+")":o+="@"+e)}),o}function d(e,t){if(e.arguments&&e.arguments.length){var r={};return e.arguments.forEach(function(e){var i=e.name,n=e.value;return l(r,i,n,t)}),r}return null}function p(e){return e.alias?e.alias.value:e.name.value}function f(e){return"Field"===e.kind}function _(e){return"InlineFragment"===e.kind}function m(e){return e&&"id"===e.type&&"boolean"==typeof e.generated}function v(e,t){return void 0===t&&(t=!1),Object(a.a)({type:"id",generated:t},"string"==typeof e?{id:e,typename:void 0}:e)}function y(e){return null!=e&&"object"==typeof e&&"json"===e.type}function g(e,t){if(e.directives&&e.directives.length){var r={};return e.directives.forEach(function(e){r[e.name.value]=d(e,t)}),r}return null}function b(e,t){return void 0===t&&(t={}),function(e){return e?e.filter(M).map(function(e){var t=e.arguments;e.name.value;Object(n.b)(t&&1===t.length,14);var r=t[0];Object(n.b)(r.name&&"if"===r.name.value,15);var i=r.value;return Object(n.b)(i&&("Variable"===i.kind||"BooleanValue"===i.kind),16),{directive:e,ifArgument:r}}):[]}(e.directives).every(function(e){var r=e.directive,i=e.ifArgument,a=!1;return"Variable"===i.value.kind?(a=t[i.value.name.value],Object(n.b)(void 0!==a,13)):a=i.value.value,"skip"===r.name.value?!a:a})}function w(e,t){return function(e){var t=[];return Object(i.visit)(e,{Directive:function(e){t.push(e.name.value)}}),t}(t).some(function(t){return e.indexOf(t)>-1})}function x(e){return e&&w(["client"],e)&&w(["export"],e)}function M(e){var t=e.name.value;return"skip"===t||"include"===t}function E(e,t){var r=t,i=[];return e.definitions.forEach(function(e){if("OperationDefinition"===e.kind)throw new n.a(11);"FragmentDefinition"===e.kind&&i.push(e)}),void 0===r&&(Object(n.b)(1===i.length,12),r=i[0].name.value),Object(a.a)(Object(a.a)({},e),{definitions:Object(a.f)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:r}}]}}],e.definitions)})}function T(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.forEach(function(t){void 0!==t&&null!==t&&Object.keys(t).forEach(function(r){e[r]=t[r]})}),e}function S(e){Object(n.b)(e&&"Document"===e.kind,2);var t=e.definitions.filter(function(e){return"FragmentDefinition"!==e.kind}).map(function(e){if("OperationDefinition"!==e.kind)throw new n.a(3);return e});return Object(n.b)(t.length<=1,4),e}function A(e){return S(e),e.definitions.filter(function(e){return"OperationDefinition"===e.kind})[0]}function P(e){return e.definitions.filter(function(e){return"OperationDefinition"===e.kind&&e.name}).map(function(e){return e.name.value})[0]||null}function k(e){return e.definitions.filter(function(e){return"FragmentDefinition"===e.kind})}function O(e){var t=A(e);return Object(n.b)(t&&"query"===t.operation,6),t}function D(e){var t;S(e);for(var r=0,i=e.definitions;r<i.length;r++){var a=i[r];if("OperationDefinition"===a.kind){var o=a.operation;if("query"===o||"mutation"===o||"subscription"===o)return a}"FragmentDefinition"!==a.kind||t||(t=a)}if(t)return t;throw new n.a(10)}function N(e){void 0===e&&(e=[]);var t={};return e.forEach(function(e){t[e.name.value]=e}),t}function C(e){if(e&&e.variableDefinitions&&e.variableDefinitions.length){var t=e.variableDefinitions.filter(function(e){return e.defaultValue}).map(function(e){var t=e.variable,r=e.defaultValue,i={};return l(i,t.name,r),i});return T.apply(void 0,Object(a.f)([{}],t))}return{}}function I(e,t,r){var i=0;return e.forEach(function(r,n){t.call(this,r,n,e)&&(e[i++]=r)},r),e.length=i,e}var R={kind:"Field",name:{kind:"Name",value:"__typename"}};function B(e){return function e(t,r){return t.selectionSet.selections.every(function(t){return"FragmentSpread"===t.kind&&e(r[t.name.value],r)})}(A(e)||function(e){Object(n.b)("Document"===e.kind,7),Object(n.b)(e.definitions.length<=1,8);var t=e.definitions[0];return Object(n.b)("FragmentDefinition"===t.kind,9),t}(e),N(k(e)))?null:e}function L(e){return function(t){return e.some(function(e){return e.name&&e.name===t.name.value||e.test&&e.test(t)})}}function F(e,t){var r=Object.create(null),n=[],o=Object.create(null),s=[],l=B(Object(i.visit)(t,{Variable:{enter:function(e,t,i){"VariableDefinition"!==i.kind&&(r[e.name.value]=!0)}},Field:{enter:function(t){if(e&&t.directives&&(e.some(function(e){return e.remove})&&t.directives&&t.directives.some(L(e))))return t.arguments&&t.arguments.forEach(function(e){"Variable"===e.value.kind&&n.push({name:e.value.name.value})}),t.selectionSet&&function e(t){var r=[];t.selections.forEach(function(t){(f(t)||_(t))&&t.selectionSet?e(t.selectionSet).forEach(function(e){return r.push(e)}):"FragmentSpread"===t.kind&&r.push(t)});return r}(t.selectionSet).forEach(function(e){s.push({name:e.name.value})}),null}},FragmentSpread:{enter:function(e){o[e.name.value]=!0}},Directive:{enter:function(t){if(L(e)(t))return null}}}));return l&&I(n,function(e){return!r[e.name]}).length&&(l=function(e,t){var r=function(e){return function(t){return e.some(function(e){return t.value&&"Variable"===t.value.kind&&t.value.name&&(e.name===t.value.name.value||e.test&&e.test(t))})}}(e);return B(Object(i.visit)(t,{OperationDefinition:{enter:function(t){return Object(a.a)(Object(a.a)({},t),{variableDefinitions:t.variableDefinitions.filter(function(t){return!e.some(function(e){return e.name===t.variable.name.value})})})}},Field:{enter:function(t){var i=e.some(function(e){return e.remove});if(i){var n=0;if(t.arguments.forEach(function(e){r(e)&&(n+=1)}),1===n)return null}}},Argument:{enter:function(e){if(r(e))return null}}}))}(n,l)),l&&I(s,function(e){return!o[e.name]}).length&&(l=function(e,t){function r(t){if(e.some(function(e){return e.name===t.name.value}))return null}return B(Object(i.visit)(t,{FragmentSpread:{enter:r},FragmentDefinition:{enter:r}}))}(s,l)),l}function U(e){return Object(i.visit)(S(e),{SelectionSet:{enter:function(e,t,r){if(!r||"OperationDefinition"!==r.kind){var i=e.selections;if(i)if(!i.some(function(e){return f(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))})){var n=r;if(!(f(n)&&n.directives&&n.directives.some(function(e){return"export"===e.name.value})))return Object(a.a)(Object(a.a)({},e),{selections:Object(a.f)(i,[R])})}}}}})}var V={test:function(e){var t="connection"===e.name.value;return t&&(!e.arguments||e.arguments.some(function(e){return"key"===e.name.value})),t}};function j(e){return F([V],S(e))}function z(e){return"query"===D(e).operation?e:Object(i.visit)(e,{OperationDefinition:{enter:function(e){return Object(a.a)(Object(a.a)({},e),{operation:"query"})}}})}function G(e){S(e);var t=F([{test:function(e){return"client"===e.name.value},remove:!0}],e);return t&&(t=Object(i.visit)(t,{FragmentDefinition:{enter:function(e){if(e.selectionSet&&e.selectionSet.selections.every(function(e){return f(e)&&"__typename"===e.name.value}))return null}}})),t}var H="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product),q=Object.prototype.toString;function W(e){return function e(t,r){switch(q.call(t)){case"[object Array]":if(r.has(t))return r.get(t);var i=t.slice(0);return r.set(t,i),i.forEach(function(t,n){i[n]=e(t,r)}),i;case"[object Object]":if(r.has(t))return r.get(t);var n=Object.create(Object.getPrototypeOf(t));return r.set(t,n),Object.keys(t).forEach(function(i){n[i]=e(t[i],r)}),n;default:return t}}(e,new Map)}function Q(t){return(void 0!==e?"production":"development")===t}function Y(){return!0===Q("production")}function X(){return!0===Q("test")}function Z(e){try{return e()}catch(e){console.error&&console.error(e)}}function K(e){return e.errors&&e.errors.length}function J(e){if((!0===Q("development")||X())&&!("function"==typeof Symbol&&"string"==typeof Symbol("")))return function e(t){return Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(r){null===t[r]||"object"!=typeof t[r]&&"function"!=typeof t[r]||Object.isFrozen(t[r])||e(t[r])}),t}(e);return e}var $=Object.prototype.hasOwnProperty;function ee(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return te(e)}function te(e){var t=e[0]||{},r=e.length;if(r>1){var i=[];t=ne(t,i);for(var n=1;n<r;++n)t=ie(t,e[n],i)}return t}function re(e){return null!==e&&"object"==typeof e}function ie(e,t,r){return re(t)&&re(e)?(Object.isExtensible&&!Object.isExtensible(e)&&(e=ne(e,r)),Object.keys(t).forEach(function(i){var n=t[i];if($.call(e,i)){var a=e[i];n!==a&&(e[i]=ie(ne(a,r),n,r))}else e[i]=n}),e):t}function ne(e,t){return null!==e&&"object"==typeof e&&t.indexOf(e)<0&&(e=Array.isArray(e)?e.slice(0):Object(a.a)({__proto__:Object.getPrototypeOf(e)},e),t.push(e)),e}Object.create({})}).call(this,r(56))},function(e,t,r){"use strict";var i=function(){function e(e,t,r,i,n){this.ready=!1,this.always=!1,this._name=e,this._options=n||{},this._framebuffer=null;var a=t.gl;if(this._options.hasOwnProperty("clearColor")||(this._options.clearColor=new Float32Array([1,1,1,0])),this._options.hasOwnProperty("colorMask")||(this._options.colorMask=new Int32Array([1,1,1,1])),this._options.hasOwnProperty("depthTest")||(this._options.depthTest=!0),this._options.hasOwnProperty("depthMask")||(this._options.depthMask=!0),this._options.hasOwnProperty("clearDepth")||(this._options.clearDepth=1),this._options.hasOwnProperty("depthFunc")||(this._options.depthFunc=a.LESS),this._options.hasOwnProperty("blend")||(this._options.blend=!1),this._options.hasOwnProperty("blendFunc")||(this._options.blendFunc=[a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA]),this._options.hasOwnProperty("stencilTest")||(this._options.stencilTest=!1),this._options.hasOwnProperty("stencilOp")||(this._options.stencilOp=[a.KEEP,a.KEEP,a.REPLACE]),this._options.hasOwnProperty("stencilFunc")||(this._options.stencilFunc=[a.ALWAYS,0,-1]),this._options.hasOwnProperty("samples")||(this._options.samples=1),this._options.hasOwnProperty("depthFilter")||(this._options.depthFilter=a.NEAREST),this._framebuffer=t.getFramebuffer(this._name),this._framebuffer.ready)this._framebuffer.resize(r,i);else{var o=-1;n.hasOwnProperty("colorBuffer")&&(o=n.colorBuffer);var s=-1;n.hasOwnProperty("depthBuffer")&&(s=n.depthBuffer);var l,u=n.colorFormat||a.RGBA8,c=n.depthFormat||(a.isWebGL2?a.DEPTH_COMPONENT24:a.DEPTH_COMPONENT);this._options.stencilTest&&(c=a.isWebGL2?a.DEPTH24_STENCIL8:a.DEPTH_STENCIL),l=-1===o?e+"-cbuf":"c"+o.toString()+"-"+r.toString()+"x"+i.toString()+"-"+u+"x"+this._options.samples;var h=t.getTexture(l);if(!h.ready&&(h.create(r,i,u,this._options.colorFilter,this._options.colorWrap,this._options.samples),!h.ready))return console.warn("colorBufferObject named:"+l+"is ceate error"),h.destroy(),void(this.ready=!1);var d=[h];if(this._options.colorBuffers&&this._options.colorBuffers.length>0)for(var p=0,f=this._options.colorBuffers.length;p<f;p++){var _=this._options.colorBuffers[p];_.colorFormat=_.colorFormat||a.RGBA8,_.samples=_.samples||1,l=null==_.index?e+"-cbuf":"c"+_.index.toString()+"-"+r.toString()+"x"+i.toString()+"-"+_.colorFormat+"x"+_.samples;var m=t.getTexture(l);if(!m.ready&&(m.create(r,i,_.colorFormat,_.colorFilter,_.colorWrap,_.samples),!m.ready))return m.destroy(),console.warn("colorBufferObject named:"+l+"is ceate error"),void(this.ready=!1);d.push(m)}l=-1===s?e+"-dbuf":"d"+s.toString()+"-"+r.toString()+"x"+i.toString()+"-"+c+"x"+this._options.samples;var v=t.getTexture(l);if(!v.ready&&(v.create(r,i,c,this._options.depthFilter,this._options.depthWrap,this._options.samples),!v.ready))return v.destroy(),console.warn("depthBufferObject named:"+l+"is ceate error"),void(this.ready=!1);this._framebuffer.create(d,v)}this.ready=this._framebuffer.ready,this.ready||console.warn("framebuffer named  "+this._name+"  create error")}return e.prototype.destroy=function(){this._name=null,delete this._name,this._framebuffer.destroy(),this._framebuffer=null,delete this._framebuffer,this._options=null,delete this._options},e.prototype.render=function(e){this.ready?(e.useFramebuffer(this._framebuffer),e.blend(this._options.blend),this._options.blend&&e.blendFunc(this._options.blendFunc),e.clearColor(this._options.clearColor),e.colorMask(this._options.colorMask),e.depthTest(this._options.depthTest,this._options.clearDepth,this._options.depthFunc),e.depthMask(this._options.depthMask),e.stencilTest(this._options.stencilTest,this._options.stencilFunc,this._options.stencilOp,this._options.stencilMask)):console.log("render target '"+this._name+"' is not ready.")},e.prototype.resize=function(e,t){this.ready?(this.ready=!1,this._framebuffer.resize(e,t),this.ready=this._framebuffer.ready):console.log("render target '"+this._name+"' is not ready.")},e.prototype.setClearColor=function(e){this.ready?(this._options.clearColor[0]=e[0],this._options.clearColor[1]=e[1],this._options.clearColor[2]=e[2],this._options.clearColor[3]=e[3]):console.log("render target "+this._name+" is not ready.")},e.prototype.getOption=function(e){return this._options[e]},e.prototype.setOption=function(e,t){this._options[e]=t},e.prototype.getOptions=function(){return this._options},e.prototype.getColorBuffer=function(e){return this._framebuffer.getColorBuffer(e)},e.prototype.getDepthBuffer=function(){return this._framebuffer.getDepthBuffer()},e.prototype.getWidth=function(){return this._framebuffer.getWidth()},e.prototype.getHeight=function(){return this._framebuffer.getHeight()},e.prototype.getFramebuffer=function(){return this._framebuffer},e.prototype.getName=function(){return this._name},e}();t.a=i},function(e,t,r){"use strict";var i=function(){function e(){this.upload=null,this.value=null,this.texUnit=-1}return e.prototype.uploadTexture=function(e,t){this.value&&this.value.use(this.texUnit),e&&e.upload(this.texUnit,t)},e.prototype.uploadValue=function(e,t){e.upload(this.value,t)},e}();t.a=i},function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return s}),r.d(t,"b",function(){return l});var i=r(5),n="Invariant Violation",a=Object.setPrototypeOf,o=void 0===a?function(e,t){return e.__proto__=t,e}:a,s=function(e){function t(r){void 0===r&&(r=n);var i=e.call(this,"number"==typeof r?n+": "+r+" (see https://github.com/apollographql/invariant-packages)":r)||this;return i.framesToPop=1,i.name=n,o(i,t.prototype),i}return Object(i.c)(t,e),t}(Error);function l(e,t){if(!e)throw new s(t)}function u(e){return function(){return console[e].apply(console,arguments)}}!function(e){e.warn=u("warn"),e.error=u("error")}(l||(l={}));var c={env:{}};if("object"==typeof e)c=e;else try{Function("stub","process = stub")(c)}catch(e){}}).call(this,r(56))},function(e,t,r){"use strict";var i,n;r.d(t,"a",function(){return n}),function(e){e.sceneLengthUnit=function(){return"foot"},e.lengthUnitScale=function(e){switch(void 0===e&&(e="mm"),e){case"mm":return.00328084;case"cm":return.0328084;case"m":return 3.28084;default:return 1}}}(i||(i={})),function(e){e.Foot2Meter=.3048,e.Meter2Foot=3.28084,e.Deg2Rad=Math.PI/180,e.Rad2Deg=180/Math.PI}(n||(n={})),t.b=i},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i,n=r(9),a=r(20),o=r(4);!function(e){e[e.INHERITED=-1]="INHERITED",e[e.DOUBLESIDE=0]="DOUBLESIDE",e[e.BACKSIDE=1]="BACKSIDE",e[e.FRONTSIDE=2]="FRONTSIDE",e[e.DOUBLESIDE_NORMAL_FRONT=3]="DOUBLESIDE_NORMAL_FRONT"}(i||(i={}));var s=function(){function e(e){this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.name=e,this.modelName="",this.layerName="",this.materialName="",this.transparent=!1,this.textureFullName="",this.textureTransparent=!1,this.hasMask=!1,this.hasTexture=!1,this.parameters={},this.reservedParameters={},this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.side=i.FRONTSIDE}return e.prototype.destroy=function(e){e&&(e.deReferenceTexture(this.textureFullName),e.deleteMaterial(this.name)),this.name=null,delete this.name,this.parameters=null,delete this.parameters,this.reservedParameters=null,delete this.reservedParameters},e.prototype.attachShader=function(e,t){if(e&&e.ready){for(var r in e.userUniforms)if(!this.parameters.hasOwnProperty(r))if(this.parameters[r]=new n.a,r.match(/uTexture\d/)){this.hasTexture=!0;var i=parseInt(r.substr(8));if(i>2){console.error("can't support >3 user textures. See shader '"+e.name+"'");continue}this.parameters[r].texUnit=i,this.parameters[r].upload=this.parameters[r].uploadTexture}else this.parameters[r].upload=this.parameters[r].uploadValue;var a;for(a in this.parameters)e.userUniforms[a]||delete this.parameters[a];for(a in this.reservedParameters)e.reservedUniforms[a]||delete this.reservedParameters[a];return e}},e.prototype.use=function(e){var t;for(t in this.reservedParameters){(r=e.reservedUniforms[t])&&this.reservedParameters[t].upload(r,e.getGL())}for(t in this.parameters){var r;(r=e.userUniforms[t])&&this.parameters[t].upload(r,e.getGL())}},e.prototype.absorb=function(e){var t;for(t in this.reservedParameters)this.reservedParameters[t].value=e.reservedParameters[t].value,this.reservedParameters[t].texUnit=e.reservedParameters[t].texUnit;for(t in this.parameters)this.parameters[t].value=e.parameters[t].value,this.parameters[t].texUnit=e.parameters[t].texUnit},e.prototype.restoreTransparency=function(){},e.prototype.hash=function(e){var t="";return t=t+e[0].toString()+e[1].toString()+e[2].toString()+e[3].toString()},e.prototype.setDiffuseTexture=function(e,t,r,i){var n=this,s=!1,l=t.gl;if(this.hasTexture||(s=!0,r.forEach(function(e){var r=t.getShader("texture",e.shader.flags),i=e.shader.shaderSource.name;if(!r.ready){var n=o.a.texture;if(r.createFromShaderSource(n,e.shader.flags),!r.ready)throw"modelo3d error at creating shader '"+i+"'!"}e.setShader(r)})),this.reservedParameters.m_uDiffuseTexture){var u=void 0;if(this.reservedParameters.m_uDiffuseTexture.value&&(u=this.reservedParameters.m_uDiffuseTexture.value.name),e instanceof a.a)s&&e.setWarp(l.REPEAT),this.reservedParameters.m_uDiffuseTexture.value=e;else if(e instanceof HTMLImageElement){var c=t.getTexture("texture-"+e),h=(f=this.reservedParameters.m_uDiffuseTexture.value)&&f._filter||c.getFilter(),d=f&&f._wrap||c.getWrap();s&&(d=l.REPEAT);var p=l.RGB;"png"===(m=e.src.split("."))[m.length-1]&&(p=l.RGBA),c.ready=!1,c.createFromImage(e,p,l.UNSIGNED_BYTE,h,d),this.reservedParameters.m_uDiffuseTexture.value=c}else{var f,_=t.getTexture("texture-"+e);h=(f=this.reservedParameters.m_uDiffuseTexture.value||_)&&f._filter||_.getFilter(),d=f&&f._wrap||_.getWrap();s&&(d=l.REPEAT);var m;p=l.RGB;"png"===(m=e.split("."))[m.length-1]&&(p=l.RGBA),_.ready=!1,_.createFromFile(e,p,h,d,function(){n.reservedParameters.m_uDiffuseTexture.value=_,i&&i(u)})}return this.hasTexture=!0,u}console.warn("can not set texture for "+this.name)},e.prototype.removeDiffuseTexture=function(){this.hasTexture=!1,this.reservedParameters.m_uDiffuseTexture.value=void 0},e.prototype.setTextureFullName=function(e){this.textureFullName=e},e.prototype.setPrefix=function(e){this.prefix=e},e.prototype.setModelName=function(e){this.modelName=e},e.prototype.setLayerName=function(e){this.layerName=e},e.prototype.setMaterialName=function(e){this.materialName=e},e.prototype.setSide=function(e){this.side=e},e.prototype.getSide=function(){return this.side},e.prototype.clone=function(e){},e}();t.b=s},function(e,t,r){"use strict";var i={"blit.fs":"uniform sampler2D m_uBlitTexture;\n#if MOBILE\nuniform sampler2D m_uBlitDepthTexture;\n#endif\nuniform vec2 m_uInvResolution;\n\n#if WEBGL2\n\nin vec2 m_vTexCoord;\nout vec4 out_color;\n\n#else \n\nvarying vec2 m_vTexCoord;\n\n#endif\n\n#include <uniform.inc>\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution);\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution);\n#endif\nvoid main() \n{ \n#if WEBGL2\n\n#if MOBILE\n out_color = shade(m_uBlitTexture, m_uBlitDepthTexture, m_vTexCoord, m_uInvResolution);\n#else\n out_color = shade(m_uBlitTexture, m_vTexCoord, m_uInvResolution);\n#endif\n\n#else\n\n#if MOBILE\n gl_FragColor = shade(m_uBlitTexture, m_uBlitDepthTexture, m_vTexCoord, m_uInvResolution);\n#else\n gl_FragColor = shade(m_uBlitTexture, m_vTexCoord, m_uInvResolution);\n#endif\n\n#endif\n}\n","blit.vs":"#if WEBGL2\n\nin vec3 m_aPosition;\nin vec2 m_aTexCoord;\nout vec2 m_vTexCoord;\n\n#else\n\nattribute vec3 m_aPosition;\nattribute vec2 m_aTexCoord;\nvarying vec2 m_vTexCoord;\n\n#endif\n\nvoid main() \n{ \n#if MODEL_TRANSFORM\n gl_Position = m_uPerNode.modelMatrix * vec4(m_aPosition.xy, 0.999999, 1.0); \n#else\n gl_Position = vec4(m_aPosition.xy, 0.999999, 1.0); \n#endif\n m_vTexCoord = m_aTexCoord;\n}\n\n","blit_accumulate.inc":"uniform sampler2D uTexture0;\nuniform float uFrameCount;\n\nfloat random( vec2 p )\n{\n return fract(sin(dot(p.xy, vec2(12.9898, 78.233))) * (43758.5453 + uFrameCount * 1231.3));\n}\n \nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 accum = sampleTexture2D(tex, uv);\n vec4 sampleColor = sampleTexture2D(uTexture0, uv); \n vec4 result = (sampleColor + (uFrameCount - 1.0) * accum) / uFrameCount;\n float dither = 1.0/255.0 * (random(uv - 0.5) - 0.5);\n result += vec4(dither,dither, dither, 0.0);\n\n return result;\n}\n\n","blit_simple.inc":"#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n return sampleTexture2D(tex, uv);\n}\n","blit_vr_wrap.inc":"uniform vec2 uLeftCenterOffset; \nuniform vec2 uRightCenterOffset; \nuniform vec4 uWarpScaleParam; \nuniform vec3 uHmdWarpParam; \nuniform bool uCalibration;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 res;\n if(m_vTexCoord.x <= 0.5){ \n vec2 coord = vec2(m_vTexCoord.x * 2.0, m_vTexCoord.y); \n vec2 offset = (coord.xy - uLeftCenterOffset) * uWarpScaleParam.xy;\n float dist2 = offset.x * offset.x + offset.y * offset.y;\n \n vec2 offsetWarp = offset * (uHmdWarpParam.x + uHmdWarpParam.y * dist2 + uHmdWarpParam.z * dist2 * dist2);\n vec2 sampLoc = uLeftCenterOffset + offsetWarp * uWarpScaleParam.zw;\n \n if(all(equal(clamp(sampLoc, 0.0, 1.0), sampLoc)))\n res = sampleTexture2D(tex, vec2(sampLoc.x * 0.5, sampLoc.y)); \n else\n res = vec4(0.0);\n \n if (uCalibration) {\n if(res.w > 0.0 && (mod(sampLoc.x - uLeftCenterOffset.x, 0.1) < 0.002 || mod(sampLoc.y, 0.1) < 0.002))\n res = vec4(0.0,0.0,1.0,1.0);\n \n if(length(coord.xy - uLeftCenterOffset) < 0.01) \n res = vec4(0.0, 0.0, 0.0, 1.0);\n }\n } else { \n vec2 coord = vec2((m_vTexCoord.x - 0.5) * 2.0, m_vTexCoord.y); \n vec2 offset = (coord.xy - uRightCenterOffset) * uWarpScaleParam.xy;\n float dist2 = offset.x * offset.x + offset.y * offset.y;\n vec2 offsetWarp = offset * (uHmdWarpParam.x + \n uHmdWarpParam.y * dist2 + uHmdWarpParam.z * dist2 * dist2);\n vec2 sampLoc = uRightCenterOffset + offsetWarp * uWarpScaleParam.zw;\n if(all(equal(clamp(sampLoc, 0.0, 1.0), sampLoc)))\n res = sampleTexture2D(tex, vec2(sampLoc.x* 0.5 + 0.5, sampLoc.y));\n else\n res = vec4(0.0, 0.0, 0.0, 1.0);\n\n if (uCalibration) {\n if(res.w > 0.0 && (mod(sampLoc.x - uRightCenterOffset.x, 0.1) < 0.002 || mod(sampLoc.y, 0.1) < 0.002))\n res = vec4(0.0,0.0,1.0,1.0);\n if(length(coord.xy - uRightCenterOffset) < 0.01)\n res = vec4(1.0,0.0,0.0,1.0);\n }\n\n }\n return res;\n}\n","clipping.inc":"#if CLIPPING\n if (dot(m_vVertex.xyz, m_uGlobal.clipPlanes[0].xyz) > m_uGlobal.clipPlanes[0].w ||\n dot(m_vVertex.xyz, m_uGlobal.clipPlanes[1].xyz) > m_uGlobal.clipPlanes[1].w ||\n dot(m_vVertex.xyz, m_uGlobal.clipPlanes[2].xyz) > m_uGlobal.clipPlanes[2].w ||\n dot(m_vVertex.xyz, m_uGlobal.clipPlanes[3].xyz) > m_uGlobal.clipPlanes[3].w ||\n dot(m_vVertex.xyz, m_uGlobal.clipPlanes[4].xyz) > m_uGlobal.clipPlanes[4].w ||\n dot(m_vVertex.xyz, m_uGlobal.clipPlanes[5].xyz) > m_uGlobal.clipPlanes[5].w) {\n discard;\n }\n#endif","depth_main.fs":"#include <globalvars.inc>\n\n#if ENCODE_DEPTH\nvec4 encodeDepth(float depth)\n{\n const vec4 bitShift = vec4(255.0*255.0*255.0, 255.0*255.0, 255.0, 1.0);\n const vec4 bitMask = vec4(0.0, 1.0/255.0, 1.0/255.0, 1.0/255.0);\n vec4 res = fract(depth * bitShift); \n res -= res.xxyz * bitMask; \n return res;\n}\n#endif\n\n#if WEBGL2\n out vec4 out_color;\n#endif\n\n#if ALPHATEST\n uniform sampler2D m_uDiffuseTexture;\n#endif\n\nvoid main()\n{\n#include <clipping.inc>\n\n#if ALPHATEST\n vec4 texel = sampleTexture2D(m_uDiffuseTexture, m_vTexCoord.xy);\n if (texel.a < 0.15)\n {\n discard;\n }\n#endif\n\n#if ENCODE_DEPTH\n vec4 o = encodeDepth(gl_FragCoord.z); \n#else\n vec4 o = gl_FragCoord.zzzz;\n#endif\n\n#if WEBGL2\n out_color = o;\n#else\n gl_FragColor = o;\n#endif\n}\n","gamma.inc":"float linearTosRGB1(const in float c, const in float gamma)\n{\n float v = 0.0;\n if (c < 0.0031308) \n {\n if ( c > 0.0) \n {\n v = c * 12.92;\n }\n } \n else \n {\n v = 1.055 * pow(c, 1.0 / gamma) - 0.055;\n }\n return v;\n}\n\nvec3 linearTosRGB(const in vec3 rgb, const in float gamma)\n{\n vec3 ret;\n ret.r = linearTosRGB1(rgb.r, gamma);\n ret.g = linearTosRGB1(rgb.g, gamma);\n ret.b = linearTosRGB1(rgb.b, gamma);\n return ret;\n}\n\nfloat sRGBToLinear1(const in float c, const in float gamma)\n{\n float v = 0.0;\n if (c < 0.04045)\n {\n if (c >= 0.0)\n {\n v = c * ( 1.0 / 12.92);\n }\n } \n else \n {\n v = pow((c + 0.055) * (1.0 / 1.055), gamma);\n }\n return v;\n}\n\nvec3 sRGBToLinear(const in vec3 srgb, const in float gamma)\n{\n vec3 ret;\n ret.r = sRGBToLinear1(srgb.r, gamma);\n ret.g = sRGBToLinear1(srgb.g, gamma);\n ret.b = sRGBToLinear1(srgb.b, gamma);\n\n return ret;\n}\n","globalvars.inc":"#if CLIPPING\nstruct GlobalStruct\n{\n vec4 clipPlanes[6];\n};\nuniform GlobalStruct m_uGlobal;\n#endif\n","lights.inc":"struct SunLightStruct\n{\n mat4 diffuseMatrix[3];\n float intensity;\n vec3 direction;\n mat4 shadowMatrix0;\n mat4 shadowMatrix1;\n};\nuniform SunLightStruct m_uSunLight;\nuniform sampler2D m_uSunLightProbe;\n\nstruct PointLightStruct\n{\n vec3 color;\n vec3 position;\n float radius;\n};\n\nstruct DirectionalLightStruct\n{\n vec3 color;\n vec3 direction;\n};\n\nstruct SpotLightStruct\n{\n vec3 color;\n vec3 position;\n vec3 direction;\n float cutoff;\n float radius;\n};\n\n#if POINT_LIGHT0\nuniform PointLightStruct m_uPointLight0;\n#endif\n#if POINT_LIGHT1\nuniform PointLightStruct m_uPointLight1;\n#endif\n#if POINT_LIGHT2\nuniform PointLightStruct m_uPointLight2;\n#endif\n\n#if DIRECTIONAL_LIGHT0\nuniform DirectionalLightStruct m_uDirectionalLight0;\n#endif\n#if DIRECTIONAL_LIGHT1\nuniform DirectionalLightStruct m_uDirectionalLight1;\n#endif\n#if DIRECTIONAL_LIGHT2\nuniform DirectionalLightStruct m_uDirectionalLight2;\n#endif\n\n#if SPOT_LIGHT0\nuniform SpotLightStruct m_uSpotLight0;\n#endif\n#if SPOT_LIGHT1\nuniform SpotLightStruct m_uSpotLight1;\n#endif\n#if SPOT_LIGHT2\nuniform SpotLightStruct m_uSpotLight2;\n#endif\n","main.fs":"#if WEBGL2\nin vec3 m_vVertex;\nin vec3 m_vNormal;\nin vec3 m_vTexCoord;\nin vec4 m_vColor;\nflat in vec4 m_vId;\nin float m_vDepth;\nin float m_vColorIndex;\n#else \n\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\n#include <uniform.inc>\n\n\n\n\n","main.vs":"#if WEBGL2\nlayout (location = 0) in vec3 m_aPosition;\n\n#if COMPRESSION\nlayout (location = 1) in float m_aNormal0;\n#else\nlayout (location = 1) in vec3 m_aNormal0;\n#endif\n\nlayout (location = 2) in float m_aNormal1;\nlayout (location = 3) in float m_aNormal2;\nlayout (location = 4) in vec2 m_aTexCoord;\nlayout (location = 5) in vec4 m_aColor;\nlayout (location = 6) in float m_aMaterial;\nlayout (location = 7) in vec3 m_aTangent;\nlayout (location = 8) in vec4 m_aJoint0;\nlayout (location = 9) in vec4 m_aWeight0;\n\n#if INSTANCING\nlayout (location = 10) in mat4 m_aModelMatrix;\n#endif\n\n\n\n#else\nattribute vec3 m_aPosition;\n\n#if COMPRESSION\nattribute float m_aNormal0;\n#else\nattribute vec3 m_aNormal0;\n#endif\n\nattribute float m_aNormal1;\nattribute float m_aNormal2;\nattribute vec2 m_aTexCoord;\nattribute vec4 m_aColor;\nattribute float m_aMaterial;\nattribute vec3 m_aTangent;\nattribute vec4 m_aJoint0;\nattribute vec4 m_aWeight0;\n#if INSTANCING\nattribute mat4 m_aModelMatrix;\n#endif\n\n\n#endif\n\n","main_shape.fs":"#if WEBGL2\nin vec3 m_vVertex;\nin vec3 m_vNormal;\nin vec3 m_vTexCoord;\nin vec4 m_vColor;\nin float m_vDepth;\nin float m_vColorIndex;\n#else \n\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\n#include <uniform.inc>\n\n\n\n\n","material_skybox.inc":"#if EQUIRECTANGLE || WALLPAPER\nuniform sampler2D m_uSkyTexture;\n#else \nuniform samplerCube m_uSkyTexture;\n#endif \n\nuniform float m_uTransparency;\nuniform float m_uTextureOffset;\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor, in bool usePlate)\n{\n#if EQUIRECTANGLE \n vec2 uv=m_vTexCoord.xy;\n uv.x = fract(uv.x+m_uTextureOffset);\n diffuse *= sampleTexture2D(m_uSkyTexture, uv).xyz;\n#endif\n\n#if WALLPAPER \n diffuse *= sampleTexture2D(m_uSkyTexture, m_vTexCoord.xy).xyz; \n#endif\n#if CUBEMAP\n diffuse *= sampleTexture3D(m_uSkyTexture, normalize(m_vTexCoord.xyz)).xyz; \n#endif \n\n#if GAMMA\n diffuse *= sRGBToLinear(diffuse, 2.2); \n#endif\n transparent = m_uTransparency;\n}\n","modelo_main.fs":"#include <globalvars.inc>\n#include <gamma.inc>\n#include <lights.inc>\n#include <shadow.inc>\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate);\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor); \n\n#if WEBGL2\nlayout(location=0) out vec4 out_color;\nlayout(location=1) out vec4 out_color1; \n#endif\n\n#if USE_PLATTE\nuniform sampler2D m_uPlatteTexture;\n#endif\n\n#if TONE_MAPPING\n\n#include <tone_mapping.inc>\n\n#endif\n\nvoid main()\n{\n#include <clipping.inc>\n\n vec3 N = normalize(m_vNormal);\n vec3 V = normalize(m_vVertex * m_uPerFrame.cameraPosition.w - m_uPerFrame.cameraPosition.xyz);\n vec3 P = m_vVertex;\n\n#if DOUBLESIDED \n N *= (float(gl_FrontFacing)*2.0-1.0);\n#endif\n\n vec3 diffuse = vec3(1.0); \n float transparent;\n vec3 specular;\n float roughness;\n vec4 platte = vec4(1.0);\n vec3 platteColor = vec3(1.0);\n bool usePlate = false;\n#if USE_PLATTE\n float colorIndex = m_vColorIndex - step(0.499, m_vColorIndex)*0.5;\n if (colorIndex < 0.495)\n {\n vec4 platte = sampleTexture2D(m_uPlatteTexture, vec2(colorIndex, 0));\n platteColor = platte.xyz;\n transparent = platte.w;\n usePlate = true;\n }\n#endif\n parseMaterial(diffuse, specular, transparent, roughness ,platteColor, usePlate);\n\n#if !WEBGL2\n vec4 out_color1;\n#endif\n vec3 color = shade(diffuse, specular, roughness, transparent, P, N, V, out_color1); \n\n#if TONE_MAPPING\n color.rgb = toneMapping(color.rgb);\n#endif\n\n#if DRAW_POINT\n float dist = distance(gl_PointCoord,vec2(0.5,0.5));\n if(dist > 0.5){\n discard;\n }\n#endif\n\n#if GAMMA\n color = linearTosRGB(color, 2.2);\n#endif\n\n#if WEBGL2\n out_color = vec4(color, transparent);\n#else\n gl_FragColor = vec4(color, transparent); \n#endif\n \n}\n","modelo_main.vs":"#if WEBGL2\nout vec3 m_vVertex;\nout vec3 m_vNormal;\nout vec3 m_vTexCoord;\nout vec4 m_vColor;\nflat out vec4 m_vId;\nout float m_vDepth;\nout float m_vColorIndex;\n#else\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition);\n\nvoid main()\n{\n vec4 position = vec4(m_aPosition, 1.0);\n#if COMPRESSION\nvec4 normal = vec4(m_aNormal0, m_aNormal1, m_aNormal2, 0.0);\n#else\nvec4 normal = vec4(m_aNormal0, 0.0);\n#endif\n vec3 uv = vec3(m_aTexCoord, 1.0);\n\n vec4 worldPosition;\n\n transform(position, normal, uv, worldPosition);\n\n#if VISIBILITY\n position.z -= step(0.5, m_aMaterial) * position.w * 10000.0;\n#endif\n\n#if USE_PLATTE\n m_vColorIndex = m_aMaterial; \n#endif\n\n#include <varying.inc>\n\n gl_Position = position;\n\n gl_PointSize = 10.0;\n}\n\n","modelo_main_shape.vs":"#if WEBGL2\nout vec3 m_vVertex;\nout vec3 m_vNormal;\nout vec3 m_vTexCoord;\nout vec4 m_vColor;\nout float m_vDepth;\nout float m_vColorIndex;\n#else\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition);\n\nvoid main()\n{\n vec4 position = vec4(m_aPosition, 1.0);\n#if COMPRESSION\nvec4 normal = vec4(m_aNormal0, m_aNormal1, m_aNormal2, 0.0);\n#else\nvec4 normal = vec4(m_aNormal0, 0.0);\n#endif\n vec3 uv = vec3(m_aTexCoord, 1.0);\n\n vec4 worldPosition;\n\n transform(position, normal, uv, worldPosition);\n\n#if VISIBILITY\n position.z -= step(0.5, m_aMaterial) * position.w * 10000.0;\n#endif\n\n#if USE_PLATTE\n m_vColorIndex = m_aMaterial; \n#endif\n\n#include <varying.inc>\n\n gl_Position = position;\n\n gl_PointSize = 10.0;\n}\n\n","normaldepth_main.fs":"#include <globalvars.inc>\n\n#if WEBGL2\n out vec4 out_color;\n#endif\n\n#if ALPHATEST\n uniform sampler2D m_uDiffuseTexture;\n#endif\n\nvoid main()\n{\n#include <clipping.inc>\n\n#if ALPHATEST\n vec4 texel = sampleTexture2D(m_uDiffuseTexture, m_vTexCoord.xy);\n if (texel.a < 0.15)\n {\n discard;\n }\n#endif\n\n vec4 normal = vec4(m_vNormal, 0.0);\n\n#if !WORLDSPACE_NORMAL\n normal = m_uPerFrame.viewMatrix * normal;\n#endif\n\n#if DOUBLESIDED\n \n#if WORLDSPACE_NORMAL\n vec4 eyeNormal = m_uPerFrame.viewMatrix * normal;\n#else\n vec4 eyeNormal = normal;\n#endif\n\n vec4 eyeDir = m_uPerFrame.viewMatrix * vec4(m_vVertex, 1.0);\n normal *= -sign(dot(eyeNormal.xyz, eyeDir.xyz));\n\n#endif\n \n vec3 n = normalize(normal.xyz);\n\n#if ENCODE_NORMAL\n n = (n + vec3(1.0)) * 0.5;\n#endif\n\n#if WEBGL2\n out_color = vec4(n, m_vDepth); \n#else\n gl_FragColor = vec4(n, m_vDepth);\n#endif\n \n}\n","shade_plain.inc":"vec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n return diffuse;\n}\n","shadow.inc":"#if SHADOW\nuniform sampler2D m_uShadowTexture0;\nuniform float m_uShadowContrast;\n#if MOBILE\n\nfloat shadow(vec3 P, vec3 N, vec3 L)\n{\n mat4 matrix = m_uSunLight.shadowMatrix0;\n \n float backside = min(1.0, max(0.0, dot(N, -L) * 10.0));\n vec4 v = matrix * vec4(P, 1);\n vec3 t = (v.xyz / v.w + vec3(1.0)) * 0.5;\n\n // e^c(d - t) where d <= t\n vec2 coord = t.xy;\n float fz = sampleTexture2D(m_uShadowTexture0, coord).x;\n float fd = exp(85.0 * (fz - t.z));\n float lit = min(fd, 1.0) * backside;// times with nDotL to shadow the backside\n return lit * 0.2 + 0.8; // linearized version of max(lit, 0.8);\n}\n\n#else\n\nuniform float m_uShadowFine;\nuniform float m_uShadowSize;\n\nfloat bilinear(vec2 frac2, vec4 v)\n{\n vec2 cc = mix(v.xz, v.yw, frac2.x);\n return mix(cc.x, cc.y, frac2.y);\n}\n\nfloat pcf2x(float depth, vec2 coord, in float shadowMapSize, in sampler2D shadowTexture, in float isFineShadow)\n{\n coord = coord * shadowMapSize;\n // Find the nearest 2x2 quad\n vec2 p = floor(coord - vec2(0.5)) + vec2(0.5);\n vec2 f = coord - p;\n vec2 p0 = p / shadowMapSize;\n float pixel = 1.0 / shadowMapSize;\n \n vec4 c;\n c.x = sampleTexture2D(shadowTexture, p0).x;\n c.y = sampleTexture2D(shadowTexture, p0 + vec2(pixel, 0)).x;\n c.z = sampleTexture2D(shadowTexture, p0 + vec2(0, pixel)).x;\n c.w = sampleTexture2D(shadowTexture, p0 + vec2(pixel, pixel)).x;\n \n if (isFineShadow > 0.5) {\n c = exp(300.0 * c + vec4(-300.0 * depth));\n return bilinear(f, c);\n } \n \n float z = bilinear(f, c);\n return z * exp(-85.0 * depth);\n}\n\nfloat shadow1(vec3 P, vec3 N, vec3 L, sampler2D shadowTexture, mat4 shadowMatrix)\n{\n vec4 v = shadowMatrix * vec4(P, 1);\n vec3 t = (v.xyz / v.w + vec3(1.0)) * 0.5;\n float fd = pcf2x(t.z, t.xy, m_uShadowSize, shadowTexture, m_uShadowFine);\n \n // Turn step to a ramp to improve front/back face edge and shadow acne\n float backside = min(1.0, max(0.0, dot(N, -L) * 10.0));\n float lit = min(fd, 1.0) * backside;// times with nDotL to shadow the backside\n return lit * 0.6 * m_uShadowContrast + 0.6 * (1.0 - m_uShadowContrast) + 0.4; // linearized version of max(lit, 0.8);\n}\n\n\nfloat shadow(vec3 P, vec3 N, vec3 L)\n{\n return shadow1(P, N, L, m_uShadowTexture0, m_uSunLight.shadowMatrix0);\n}\n\n#endif\n\n#endif\n","tone_mapping.inc":"uniform float uExposure;\n\nfloat getLuminance(vec3 c)\n{\n return dot(c, vec3(0.22, 0.707, 0.071));\n}\n\nvec3 toneMapping(vec3 color) \n{\n float lum = getLuminance(color);\n float lumTm = lum * uExposure;\n float scale = lumTm / (1.0 + lumTm);\n\n return color * scale / lum;\n}\n","transform_simple.inc":"#if POP_BUFFER\nstruct PopParams {\n vec3 vertexConstant;\n float vertexGridSize;\n float powPrecision;\n};\nuniform PopParams m_uPopParams;\n#endif\n\n#if HAS_SKIN\n#if WEBGL2\nuniform m_bJointMatrix\n{\n mat4 matrix[128];\n} m_uJointMatrix;\n#else\nuniform sampler2D m_uTransformTexture;\n\nmat4 transpose(in mat4 inMatrix) {\n highp vec4 i0 = inMatrix[0];\n highp vec4 i1 = inMatrix[1];\n highp vec4 i2 = inMatrix[2];\n highp vec4 i3 = inMatrix[3];\n\n highp mat4 outMatrix = mat4(\n vec4(i0.x, i1.x, i2.x, i3.x),\n vec4(i0.y, i1.y, i2.y, i3.y),\n vec4(i0.z, i1.z, i2.z, i3.z),\n vec4(i0.w, i1.w, i2.w, i3.w)\n );\n\n return outMatrix;\n}\n\nmat4 inverse(mat4 m) {\n float\n a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n b00 = a00 * a11 - a01 * a10,\n b01 = a00 * a12 - a02 * a10,\n b02 = a00 * a13 - a03 * a10,\n b03 = a01 * a12 - a02 * a11,\n b04 = a01 * a13 - a03 * a11,\n b05 = a02 * a13 - a03 * a12,\n b06 = a20 * a31 - a21 * a30,\n b07 = a20 * a32 - a22 * a30,\n b08 = a20 * a33 - a23 * a30,\n b09 = a21 * a32 - a22 * a31,\n b10 = a21 * a33 - a23 * a31,\n b11 = a22 * a33 - a23 * a32,\n\n det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n return mat4(\n a11 * b11 - a12 * b10 + a13 * b09,\n a02 * b10 - a01 * b11 - a03 * b09,\n a31 * b05 - a32 * b04 + a33 * b03,\n a22 * b04 - a21 * b05 - a23 * b03,\n a12 * b08 - a10 * b11 - a13 * b07,\n a00 * b11 - a02 * b08 + a03 * b07,\n a32 * b02 - a30 * b05 - a33 * b01,\n a20 * b05 - a22 * b02 + a23 * b01,\n a10 * b10 - a11 * b08 + a13 * b06,\n a01 * b08 - a00 * b10 - a03 * b06,\n a30 * b04 - a31 * b02 + a33 * b00,\n a21 * b02 - a20 * b04 - a23 * b00,\n a11 * b07 - a10 * b09 - a12 * b06,\n a00 * b09 - a01 * b07 + a02 * b06,\n a31 * b01 - a30 * b03 - a32 * b00,\n a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n#endif\n#endif\n\n#if HAS_SKIN\nmat4 getJointMatrix(in vec4 indices) {\n#if WEBGL2\n return m_aWeight0.x * m_uJointMatrix.matrix[int(indices.x)] +\n m_aWeight0.y * m_uJointMatrix.matrix[int(indices.y)] +\n m_aWeight0.z * m_uJointMatrix.matrix[int(indices.z)] +\n m_aWeight0.w * m_uJointMatrix.matrix[int(indices.w)];\n#else\n vec4 col1, col2, col3, col4;\n col1 = texture2DLod(m_uTransformTexture, vec2((indices.x * 4.0 ) / 511.0, 0.0), 0.0);\n col2 = texture2DLod(m_uTransformTexture, vec2((indices.x * 4.0 + 1.0) / 511.0, 0.0), 0.0);\n col3 = texture2DLod(m_uTransformTexture, vec2((indices.x * 4.0 + 2.0) / 511.0, 0.0), 0.0);\n col4 = texture2DLod(m_uTransformTexture, vec2((indices.x * 4.0 + 3.0) / 511.0, 0.0), 0.0);\n mat4 matrix1 = mat4(col1, col2, col3, col4); \n col1 = texture2DLod(m_uTransformTexture, vec2((indices.y * 4.0 ) / 511.0, 0.0), 0.0);\n col2 = texture2DLod(m_uTransformTexture, vec2((indices.y * 4.0 + 1.0) / 511.0, 0.0), 0.0);\n col3 = texture2DLod(m_uTransformTexture, vec2((indices.y * 4.0 + 2.0) / 511.0, 0.0), 0.0);\n col4 = texture2DLod(m_uTransformTexture, vec2((indices.y * 4.0 + 3.0) / 511.0, 0.0), 0.0);\n mat4 matrix2 = mat4(col1, col2, col3, col4);\n col1 = texture2DLod(m_uTransformTexture, vec2((indices.z * 4.0 ) / 511.0, 0.0), 0.0);\n col2 = texture2DLod(m_uTransformTexture, vec2((indices.z * 4.0 + 1.0) / 511.0, 0.0), 0.0);\n col3 = texture2DLod(m_uTransformTexture, vec2((indices.z * 4.0 + 2.0) / 511.0, 0.0), 0.0);\n col4 = texture2DLod(m_uTransformTexture, vec2((indices.z * 4.0 + 3.0) / 511.0, 0.0), 0.0);\n mat4 matrix3 = mat4(col1, col2, col3, col4);\n col1 = texture2DLod(m_uTransformTexture, vec2((indices.w * 4.0 ) / 511.0, 0.0), 0.0);\n col2 = texture2DLod(m_uTransformTexture, vec2((indices.w * 4.0 + 1.0) / 511.0, 0.0), 0.0);\n col3 = texture2DLod(m_uTransformTexture, vec2((indices.w * 4.0 + 2.0) / 511.0, 0.0), 0.0);\n col4 = texture2DLod(m_uTransformTexture, vec2((indices.w * 4.0 + 3.0) / 511.0, 0.0), 0.0);\n mat4 matrix4 = mat4(col1, col2, col3, col4);\n return m_aWeight0.x * matrix1 + \n m_aWeight0.y * matrix2 + \n m_aWeight0.z * matrix3 + \n m_aWeight0.w * matrix4;\n#endif\n}\n#endif\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n#if POP_BUFFER\n position.xyz = (position.xyz - m_uPopParams.vertexConstant) / m_uPopParams.vertexGridSize;\n position.xyz = floor(position.xyz / m_uPopParams.powPrecision) * m_uPopParams.powPrecision * m_uPopParams.vertexGridSize;\n#endif\n\n#if HAS_SKIN\n mat4 jointMatrix = getJointMatrix(m_aJoint0);\n#endif\n\n#if MODEL_TRANSFORM\n#if INSTANCING\n position = m_aModelMatrix * position;\n normal = (m_aModelMatrix * normal);\n#else\n\n#if HAS_SKIN\n normal = m_uPerNode.normalMatrix * vec4(normalize(transpose(inverse(jointMatrix)) * normal).xyz, 0.0);\n position = m_uPerNode.modelMatrix * jointMatrix * position;\n#else\n position = m_uPerNode.modelMatrix * position;\n normal = m_uPerNode.normalMatrix * vec4(normalize(normal.xyz), 0.0);\n#endif\n#endif\n#endif\n\n worldPosition = position;\n position = m_uPerFrame.vpMatrix * position;\n}\n","transform_skybox.inc":"\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n#if EQUIRECTANGLE\n uv = vec3(1.0 - uv.x, uv.y, 1.0);\n#endif\n#if WALLPAPER\n uv = vec3(uv.x, 1.0 - uv.y, 1.0);\n#endif\n#if CUBEMAP\n#if FLIP\n uv = vec3(position.x, -position.z, -position.y);\n#else\n uv = vec3(position.x, position.z, -position.y);\n#endif\n#endif\n\n#if MODEL_TRANSFORM\n position = m_uPerNode.modelMatrix * position;\n#endif\n#if EQUIRECTANGLE || CUBEMAP\n position = m_uPerFrame.vpMatrix * vec4(position.xyz, 0.0);\n#endif\n\n position = position.xyww; \n}\n\n\n","uniform.inc":"#if WEBGL2\nvec4 sampleTexture2D(sampler2D tex, vec2 coord)\n{\n return texture(tex, coord);\n}\n\nvec4 sampleTexture2D(samplerCube tex, vec3 coord, float LOD) \n{\n return textureLod(tex, coord, LOD);\n}\n#else\nvec4 sampleTexture2D(sampler2D tex, vec2 coord)\n{\n return texture2D(tex, coord);\n}\n\nvec4 sampleTexture2D(samplerCube tex, vec3 coord, float LOD) \n{\n return textureCube(tex, coord);\n}\n#endif\n\n#if WEBGL2\nvec4 sampleTexture3D(samplerCube tex, vec3 coord)\n{\n return texture(tex, coord);\n}\n\nvec4 sampleTexture3D(samplerCube tex, vec3 coord, float LOD) \n{\n return textureLod(tex, coord, LOD);\n}\n\n#else\nvec4 sampleTexture3D(samplerCube tex, vec3 coord)\n{\n return textureCube(tex, coord);\n}\n\nvec4 sampleTexture3D(samplerCube tex, vec3 coord, float LOD) \n{\n return textureCube(tex, coord);\n}\n#endif\n\n","blit_contour.inc":"vec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{ \n vec2 coordCenter = uv + vec2( 0.0, 0.0); \n vec2 coordUp = uv + vec2( 0.0, -invResolution.y); \n vec2 coordDown = uv + vec2( 0.0, +invResolution.y); \n vec2 coordLeft = uv + vec2(-invResolution.x, 0.0); \n vec2 coordRight = uv + vec2(+invResolution.x, 0.0); \n vec2 coordUpLeft = uv + vec2(-invResolution.x, -invResolution.y); \n vec2 coordDownLeft = uv + vec2(-invResolution.x, +invResolution.y); \n vec2 coordUpRight = uv + vec2(-invResolution.x, +invResolution.y); \n vec2 coordDownRight = uv + vec2(+invResolution.x, +invResolution.y); \n\n bool centerOutsideOfTarget = sampleTexture2D(tex, coordCenter ).r < 1.0;\n bool neighborInsideOfTarget = sampleTexture2D(tex, coordUp ).r > 0.5\n || sampleTexture2D(tex, coordDown ).r > 0.5 \n || sampleTexture2D(tex, coordLeft ).r > 0.5 \n || sampleTexture2D(tex, coordRight ).r > 0.5 \n || sampleTexture2D(tex, coordUpLeft ).r > 0.5 \n || sampleTexture2D(tex, coordDownLeft ).r > 0.5 \n || sampleTexture2D(tex, coordUpRight ).r > 0.5 \n || sampleTexture2D(tex, coordDownRight).r > 0.5;\n bool isContour = centerOutsideOfTarget && neighborInsideOfTarget;\n\n return isContour? vec4(0.0, 0.0, 0.0, 1.0) : vec4(0.0, 0.0, 0.0, 0.0);\n} \n","blit_contour_overlay.inc":"uniform vec4 uColor;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 scene = sampleTexture2D(tex, uv);\n vec2 coord00 = uv + vec2(-invResolution.x * 2.0, -invResolution.y * 2.0);\n vec2 coord01 = uv + vec2(-invResolution.x * 2.0, -invResolution.y);\n vec2 coord02 = uv + vec2(-invResolution.x * 2.0, 0.0);\n vec2 coord03 = uv + vec2(-invResolution.x * 2.0, invResolution.y);\n vec2 coord04 = uv + vec2(-invResolution.x * 2.0, invResolution.y * 2.0);\n\n vec2 coord10 = uv + vec2(-invResolution.x, -invResolution.y * 2.0);\n vec2 coord11 = uv + vec2(-invResolution.x, -invResolution.y);\n vec2 coord12 = uv + vec2(-invResolution.x, 0.0);\n vec2 coord13 = uv + vec2(-invResolution.x, invResolution.y);\n vec2 coord14 = uv + vec2(-invResolution.x, invResolution.y * 2.0);\n\n vec2 coord20 = uv + vec2(0.0, -invResolution.y * 2.0);\n vec2 coord21 = uv + vec2(0.0, -invResolution.y);\n vec2 coord22 = uv + vec2(0.0, 0.0);\n vec2 coord23 = uv + vec2(0.0, invResolution.y);\n vec2 coord24 = uv + vec2(0.0, invResolution.y * 2.0);\n vec2 coord30 = uv + vec2(invResolution.x, -invResolution.y * 2.0);\n vec2 coord31 = uv + vec2(invResolution.x, -invResolution.y);\n vec2 coord32 = uv + vec2(invResolution.x, 0.0);\n vec2 coord33 = uv + vec2(invResolution.x, invResolution.y);\n vec2 coord34 = uv + vec2(invResolution.x, invResolution.y * 2.0);\n vec2 coord40 = uv + vec2(invResolution.x * 2.0, -invResolution.y * 2.0);\n vec2 coord41 = uv + vec2(invResolution.x * 2.0, -invResolution.y);\n vec2 coord42 = uv + vec2(invResolution.x * 2.0, 0.0);\n vec2 coord43 = uv + vec2(invResolution.x * 2.0, invResolution.y);\n vec2 coord44 = uv + vec2(invResolution.x * 2.0, invResolution.y * 2.0);\n\n vec4 contour = sampleTexture2D(tex, coord00) * 0.0090 +\n sampleTexture2D(tex, coord01) * 0.0399 +\n sampleTexture2D(tex, coord02) * 0.0657 +\n sampleTexture2D(tex, coord03) * 0.0399 +\n sampleTexture2D(tex, coord04) * 0.0090 +\n sampleTexture2D(tex, coord10) * 0.0399 +\n sampleTexture2D(tex, coord11) * 0.1788 +\n sampleTexture2D(tex, coord12) * 0.2949 +\n sampleTexture2D(tex, coord13) * 0.1788 +\n sampleTexture2D(tex, coord14) * 0.0399 +\n sampleTexture2D(tex, coord20) * 0.0657 +\n sampleTexture2D(tex, coord21) * 0.2949 +\n sampleTexture2D(tex, coord22) * 0.4863 +\n sampleTexture2D(tex, coord23) * 0.2949 +\n sampleTexture2D(tex, coord24) * 0.0657 +\n sampleTexture2D(tex, coord30) * 0.0399 +\n sampleTexture2D(tex, coord31) * 0.1788 +\n sampleTexture2D(tex, coord32) * 0.2949 +\n sampleTexture2D(tex, coord33) * 0.1788 +\n sampleTexture2D(tex, coord34) * 0.0399 +\n sampleTexture2D(tex, coord40) * 0.0090 +\n sampleTexture2D(tex, coord41) * 0.0399 +\n sampleTexture2D(tex, coord42) * 0.0657 +\n sampleTexture2D(tex, coord43) * 0.0399 +\n sampleTexture2D(tex, coord44) * 0.0090;\n float a = min(1.0, contour.a);\n return uColor * a + scene * (1.0 - a);\n} \n\n","blit_direct.fs":"uniform vec3 uColor;\n\n#if WEBGL2\nout vec4 out_color;\n#endif\n\nvoid main() \n{ \n#if WEBGL2\n out_color = vec4(uColor, 1);\n#else\n gl_FragColor = vec4(uColor, 1);\n#endif\n}\n","blit_oit.inc":"uniform sampler2D uTexture1;\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 rgbAlphaAdd = sampleTexture2D(m_uBlitTexture, uv);\n \n float alphaMulti = sampleTexture2D(uTexture1, uv).r; \n\n vec4 ret = vec4(rgbAlphaAdd.rgb / clamp(alphaMulti, 1e-4, 5e4), rgbAlphaAdd.a);\n\n return ret;\n}\n","blit_outline.inc":"uniform float u_outlineWidth;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{ \n bool centerInsideOfTarget = sampleTexture2D(tex, uv).r > 0.5;\n if(centerInsideOfTarget) return vec4(0.0);\n\n float w2 = u_outlineWidth*u_outlineWidth;\n for(float i=-8.0; i<=8.0; i+=1.0)\n {\n if(i<-u_outlineWidth || i>u_outlineWidth) continue;\n\n float i2 = i*i;\n for(float j=-8.0; j<8.0; j+=1.0)\n {\n float j2 = j*j;\n if(i2+j2>w2) continue;\n\n vec2 coordIJ = uv + vec2(i, j)*invResolution;\n bool neighborInsideOfTarget = sampleTexture2D(tex, coordIJ).r>0.5;\n if(neighborInsideOfTarget) return vec4(vec3(0.0), 1.0);\n }\n }\n\n return vec4(0.0);\n} \n","blit_outline_overlay.inc":"uniform vec4 uColor;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 scene = sampleTexture2D(tex, uv);\n float a = scene.a;\n return uColor * a + scene * (1.0 - a);\n} \n","blit_overlay.inc":"uniform sampler2D m_uForeground;\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n vec4 foreground = sampleTexture2D(m_uForeground, uv);\n return foreground;\n}\n","blit_shadow.inc":"const float g0 = 0.0751; const float g1 = 0.1238; const float g2 = 0.0751; \nconst float g3 = 0.1238; const float g4 = 0.2042; const float g5 = 0.1238; \nconst float g6 = 0.0751; const float g7 = 0.1238; const float g8 = 0.0751; \nconst float C = 85.0;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{ \n float tmp = 0.0;\n vec2 coord; \n\n float pixelSize = invResolution.x;\n\n coord = uv + vec2(-pixelSize, -pixelSize); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g0;\n\n coord = uv + vec2(0.0, -pixelSize); \n \n tmp += exp(C * sampleTexture2D(tex, coord).x) * g1;\n \n coord = uv + vec2(pixelSize, -pixelSize); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g2;\n\n coord = uv + vec2(-pixelSize, 0.0); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g3; \n\n coord = uv; \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g4;\n \n coord = uv + vec2(pixelSize, 0.0 ); \n \n tmp += exp(C * sampleTexture2D(tex, coord).x) * g5;\n\n coord = uv + vec2(-pixelSize, pixelSize); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g6;\n \n coord = uv + vec2(0.0, pixelSize); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g7;\n \n coord = uv + vec2(pixelSize, pixelSize); \n\n tmp += exp(C * sampleTexture2D(tex, coord).x) * g8;\n\n return vec4(tmp); \n} \n\n","blit_sketch.inc":"uniform float uThreshold; \nuniform float uContrast; \nuniform vec3 uNearAxis; \nuniform bool uIsPerspective; \n\n#if MOBILE\nuniform vec2 uNearFar;\n\nvoid getNormalPosition(in sampler2D tex, in sampler2D tex2, vec2 coord, out vec3 position, out vec3 normal) \n{\n vec2 uv = coord * 0.5 + vec2(0.5); \n vec4 n = sampleTexture2D(tex, uv); \n\n normal = normalize(n.xyz * 2.0 - 1.0); \n vec4 p = sampleTexture2D(tex2, uv);\n float depth = p.x * 2.0 -1.0;\n \n if (uIsPerspective) \n {\n position.z = -2.0 * uNearFar.x * uNearFar.y / (uNearFar.x + uNearFar.y - depth * (uNearFar.y - uNearFar.x));\n position.xy = uNearAxis.xy * coord.xy * position.z / uNearAxis.z; \n } \n else \n {\n position.xy = uNearAxis.xy * coord.xy;\n position.z = 0.5 * (depth * (uNearFar.y - uNearFar.x) + uNearFar.x + uNearFar.y);\n }\n} \n#else\nvoid getNormalPosition(in sampler2D tex, vec2 coord, out vec3 position, out vec3 normal) \n{\n vec2 uv = coord * 0.5 + vec2(0.5); \n vec4 p = sampleTexture2D(tex, uv); \n\n normal = normalize(p.xyz); \n position.z = p.w; \n if (uIsPerspective) \n { \n position.xy = uNearAxis.xy * coord.xy * p.w / uNearAxis.z; \n } \n else \n {\n position.xy = uNearAxis.xy * coord.xy;\n }\n}\n#endif\n\nfloat planeDistance(vec3 posA, vec3 norA, vec3 posB, vec3 norB) \n{ \n vec3 posDelta = normalize(posB - posA); \n float planeDist = max(abs(dot(posDelta, norA)), abs(dot(posDelta, norB))); \n float normalDist = max(1.0 - dot(norA, norB), 0.0); \n \n return max(planeDist, normalDist);\n} \n\nuniform vec3 uColor;\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else \nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n vec2 vFragCoord = uv * 2.0 - vec2(1.0);\n vec2 coordCenter = vFragCoord.xy ; \n vec2 coordUp = vFragCoord - vec2(0.0, 2.0 * invResolution.y); \n vec2 coordDown = vFragCoord + vec2(0.0, 2.0 * invResolution.y); \n vec2 coordLeft = vFragCoord - vec2(2.0 * invResolution.x, 0.0); \n vec2 coordRight = vFragCoord + vec2(2.0 * invResolution.x, 0.0); \n vec3 posUp, norUp; \n vec3 posDown, norDown; \n vec3 posLeft, norLeft; \n vec3 posRight, norRight; \n#if MOBILE\n getNormalPosition(tex, tex2, coordUp, posUp, norUp); \n getNormalPosition(tex, tex2, coordDown, posDown, norDown); \n getNormalPosition(tex, tex2, coordLeft, posLeft, norLeft); \n getNormalPosition(tex, tex2, coordRight, posRight, norRight); \n#else \n getNormalPosition(tex, coordUp, posUp, norUp); \n getNormalPosition(tex, coordDown, posDown, norDown); \n getNormalPosition(tex, coordLeft, posLeft, norLeft); \n getNormalPosition(tex, coordRight, posRight, norRight);\n#endif\n vec2 planeDist = vec2(planeDistance(posLeft, norLeft, posRight, norRight), \n planeDistance(posUp, norUp, posDown, norDown)); \n float edge = length(planeDist); \n float sketch = step(edge, uThreshold); \n sketch = clamp(uContrast * (1.0 - sketch), 0.0, 1.0); \n \n return vec4(uColor, sketch);\n}\n","blit_solid.inc":"uniform vec3 uColor;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n return vec4(uColor, 1);\n}\n","blit_ssao2.inc":"uniform vec3 uNearAxis; \r\nuniform vec2 uTexTransform; \r\nuniform float uRadius; \r\nuniform bool uIsPerspective; \r\nuniform float uFrameCount; \r\nuniform vec4 uTexSizeAndInv; \r\nuniform vec2 SAMPLES[8]; \r\n\r\n#if MOBILE\r\nuniform vec2 uNearFar;\r\n\r\nvec4 getNormalAndDepth(in sampler2D tex, in sampler2D tex2, vec2 fragCoord) \r\n{\r\n vec2 texcoord = fragCoord * 0.5 + vec2(0.5);\r\n texcoord.x = texcoord.x * uTexTransform.x + uTexTransform.y;\r\n \r\n vec4 ret = sampleTexture2D(tex, texcoord); \r\n ret.xyz = normalize(ret.xyz * 2.0 - 1.0); \r\n \r\n vec4 p = sampleTexture2D(tex2, texcoord);\r\n float depth = p.x * 2.0 -1.0;\r\n if (uIsPerspective) \r\n {\r\n ret.w = -2.0 * uNearFar.x * uNearFar.y / (uNearFar.x + uNearFar.y - depth * (uNearFar.y - uNearFar.x));\r\n } \r\n else \r\n {\r\n ret.w = 0.5 * (depth * (uNearFar.y - uNearFar.x) + uNearFar.x + uNearFar.y);\r\n }\r\n return ret;\r\n} \r\n#else\r\nvec4 getNormalAndDepth(in sampler2D tex, vec2 fragCoord) \r\n{\r\n vec2 texcoord = fragCoord * 0.5 + vec2(0.5);\r\n texcoord.x = texcoord.x * uTexTransform.x + uTexTransform.y;\r\n \r\n return sampleTexture2D(tex, texcoord); \r\n} \r\n#endif\r\n\r\n\r\nvec3 getEyePosition(vec2 fragCoord, float depth) \r\n{\r\n vec3 eyeDirection = uNearAxis * vec3(fragCoord, 1.0); \r\n vec3 eyePosition; \r\n eyePosition.z = depth; \r\n if (uIsPerspective) \r\n { \r\n eyePosition.xy = eyeDirection.xy * depth / eyeDirection.z; \r\n } \r\n else \r\n {\r\n eyePosition.xy = eyeDirection.xy; \r\n } \r\n return eyePosition; \r\n} \r\n\r\nvec3 getScreenPosition(vec3 eyePos) \r\n{ \r\n if (uIsPerspective)\r\n {\r\n return vec3(eyePos.xy * uNearAxis.z / uNearAxis.xy / eyePos.z, eyePos.z); \r\n }\r\n else\r\n {\r\n return vec3(eyePos.xy / uNearAxis.xy, eyePos.z); \r\n }\r\n} \r\n\r\n#if MOBILE\r\nvec3 getOffsetEyePosition(in sampler2D tex, in sampler2D tex2, vec3 viewPos, vec2 offset) \r\n#else\r\nvec3 getOffsetEyePosition(in sampler2D tex, vec3 viewPos, vec2 offset) \r\n#endif\r\n{ \r\n vec2 scnPos = getScreenPosition(viewPos).xy; \r\n vec2 scnOffset = getScreenPosition(vec3(offset, viewPos.z)).xy; \r\n vec2 pixOffset = scnOffset * uTexSizeAndInv.xy * 0.5;\r\n if(length(pixOffset) > 2.0) \r\n {\r\n scnOffset = (floor(pixOffset + 0.5) ) * uTexSizeAndInv.zw * 2.0;\r\n }\r\n#if MOBILE\r\nfloat sampDepth = getNormalAndDepth(tex, tex2, scnPos + scnOffset).w; \r\n#else\r\nfloat sampDepth = getNormalAndDepth(tex, scnPos + scnOffset).w; \r\n#endif\r\n return getEyePosition(scnPos + scnOffset, sampDepth); \r\n} \r\n\r\nvec3 computeMultiBounceColor(float x, vec3 albedo) \r\n{ \r\n vec3 a = 2.0404 * albedo - 0.3324; \r\n vec3 b = -4.7951 * albedo + 0.6417; \r\n vec3 c = 2.7552 * albedo + 0.6903; \r\n return max( vec3(x,x,x), ( ( x * a + b ) * x + c ) * x ); \r\n} \r\n\r\nfloat random(vec2 p) \r\n{ \r\n return fract(sin(dot(p.xy, vec2(12.9898, 78.233))) * (43758.5453 + (uFrameCount) * 1231.3));\r\n} \r\n\r\n#if MOBILE\r\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\r\n#else \r\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\r\n#endif\r\n{ \r\n float maxScreenRadius = 0.4; float falloffDist = 0.0; float randScale = 0.4; const float aoStrength = 1.1; const float PI = 3.1415926535898; \r\n const float HalfPI = 1.570796326794895; \r\n\r\n vec2 vFragCoord = uv * 2.0 - vec2(1.0);\r\n#if MOBILE\r\n vec4 p = getNormalAndDepth(tex, tex2, vFragCoord); \r\n#else\r\n vec4 p = getNormalAndDepth(tex, vFragCoord); \r\n#endif\r\n vec3 eyePosition = getEyePosition(vFragCoord, p.w); \r\n vec3 normal = p.xyz; \r\n float xx = p.w;\r\n if (length(normal) < 0.95) {\r\n return vec4(1.0);\r\n }\r\n\r\n vec2 projScrRadius = getEyePosition(vec2(1.0, 1.0) * maxScreenRadius, p.w).xy; \r\n vec3 viewDir = vec3(0.0, 0.0, 1.0);\r\n\r\n float radiusScale = 1.0 + randScale * (random(vFragCoord * 0.5 - 0.5) - 0.5); \r\n float radius = radiusScale * min(uRadius, min(projScrRadius.x, projScrRadius.y)); \r\n\r\n if (uIsPerspective) {\r\n viewDir = normalize(-uNearAxis * vec3(vFragCoord, 1.0)); \r\n } \r\n\r\n vec3 sliceTan = normalize(vec3(SAMPLES[7], 0.0));\r\n vec3 sliceNorm = normalize(cross(viewDir, sliceTan)); \r\n vec3 normalSliceProj = normal - dot(normal, sliceNorm) * sliceNorm; \r\n vec3 normalSliceDir = normalize(normalSliceProj); \r\n float thetaN = acos(dot(normalSliceDir, viewDir)) * sign(dot(cross(sliceNorm, viewDir), normalSliceDir)); \r\n\r\n float horizon1 = thetaN + HalfPI;\r\n for (int i = 0; i < 8; ++i) \r\n { \r\n vec2 p = SAMPLES[i];\r\n#if MOBILE\r\nvec3 offsetPosition = getOffsetEyePosition(tex, tex2, eyePosition, p * radius); \r\n#else\r\nvec3 offsetPosition = getOffsetEyePosition(tex, eyePosition, p * radius); \r\n#endif\r\n vec3 v_i = offsetPosition - eyePosition; \r\n float h1 = min(acos(dot(normalize(v_i), viewDir)), HalfPI + thetaN); \r\n float weight = 1.0 - clamp((length(v_i) / radius - falloffDist), 0.0, 1.0); \r\n horizon1 = mix(horizon1, min(horizon1, h1), weight); \r\n } \r\n\r\n float horizon2 = -thetaN + HalfPI;\r\n for(int i = 0; i < 8; ++i) \r\n { \r\n vec2 p = -SAMPLES[i]; \r\n#if MOBILE\r\nvec3 offsetPosition = getOffsetEyePosition(tex, tex2, eyePosition, p * radius); \r\n#else\r\nvec3 offsetPosition = getOffsetEyePosition(tex, eyePosition, p * radius); \r\n#endif\r\n vec3 v_i = offsetPosition - eyePosition; \r\n float h2 = min(acos(dot(normalize(v_i), viewDir)), HalfPI - thetaN); \r\n float weight = 1.0 - clamp((length(v_i) / radius - falloffDist), 0.0, 1.0); \r\n horizon2 = mix(horizon2, min(horizon2, h2), weight); \r\n } \r\n\r\n \r\n float occ = 1.0 - (cos(horizon1) + cos(horizon2)) * 0.5 * aoStrength; \r\n vec3 ao = computeMultiBounceColor(occ, vec3(1.0,1.0,1.0));\r\n\r\n return vec4(ao, 1.0); \r\n}\r\n","blit_transparent.inc":"uniform vec4 uColor;\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else \nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n float x = uColor.a;\n return uColor;\n}\n","material_color.inc":"struct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate)\n{\n vec3 albedo = m_vColor.rgb;\n\n transparent = m_vColor.a * m_uMaterial.values[3];\n // FIXME: roughness is not used now.\n //roughness = m_uMaterial.values[4];\n \n#if GAMMA\n albedo = sRGBToLinear(albedo, 2.2); \n#endif\n\n // FIXME: metallic is 0 now.\n //diffuse = albedo * (1.0 - m_uMaterial.values[5]);\n //specular = mix(dielectricColor, albedo, m_uMaterial.values[5]);\n diffuse = albedo;\n specular = dielectricColor;\n}\n\n","material_mask.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nuniform sampler2D m_uDiffuseTexture;\n\n// 0-1: scaleRatio\n// 2: radian\nuniform vec3 m_uTextureScale;\n\n// 0-1: offset\n// 2: on/off\nuniform vec3 m_uTextureOffset;\n\n#if SECOND_TEXTURE\nuniform sampler2D m_uDiffuseTexture2;\n#endif\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\nvec2 _getTransformedUV()\n{\n if(m_uTextureOffset.z<0.1)\n {\n return m_vTexCoord.xy;\n }\n\n vec2 uv;\n float cosValue = cos(m_uTextureScale.z);\n float sinValue = sin(m_uTextureScale.z);\n uv.x = cosValue*m_uTextureScale.x*m_vTexCoord.x - sinValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.x;\n uv.y = sinValue*m_uTextureScale.x*m_vTexCoord.x + cosValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.y;\n return uv;\n}\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness ,in vec3 platteColor, in bool usePlate)\n{\n vec2 uv = _getTransformedUV();\n vec4 texel = sampleTexture2D(m_uDiffuseTexture, uv);\n\n transparent = m_uMaterial.values[3];\n\n if (texel.a < m_uMaterial.values[5]) \n {\n discard;\n }\n\n vec3 albedo = vec3(m_uMaterial.values[0], m_uMaterial.values[1], m_uMaterial.values[2]);\n\n#if USE_PLATTE\n if(usePlate == true){\n // diffuseColor\n diffuse = texel.rgb * platteColor;\n }else{\n diffuse = albedo;\n }\n#else\n diffuse = albedo;\n#endif\n // FIXME: metallic is 0 now.\n //diffuse = albedo * (1.0 - m_uMaterial.values[5]);\n //specular = mix(dielectricColor, albedo, m_uMaterial.values[5]);\n specular = dielectricColor;\n}\n\n","material_pbr.inc":"#if HAS_BASECOLORMAP\nuniform sampler2D m_uBaseColorTexture;\n#endif\n\n#if HAS_METALROUGHNESSMAP\nuniform sampler2D m_uMetallicRoughnessTexture;\n#endif\n\n#if HAS_NORMALMAP\nuniform sampler2D m_uNormalTexture;\n#endif\n\n#if HAS_EMISSIVEMAP\nuniform sampler2D m_uEmissiveTexture;\n#endif\n\n#if HAS_OCCLUSIONMAP\n uniform sampler2D m_uOcclusionTexture;\n#endif\n\n// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[10]; \n};\n\nuniform MaterialStruct m_uMaterial;\n\n// 0-1: scaleRatio\n// 2: radian\nuniform vec3 m_uTextureScale;\n\n// 0-1: offset\n// 2: on/off\nuniform vec3 m_uTextureOffset;\n\nvec2 _getTransformedUV()\n{\n if(m_uTextureOffset.z<0.1)\n {\n return m_vTexCoord.xy;\n }\n\n vec2 uv;\n float cosValue = cos(m_uTextureScale.z);\n float sinValue = sin(m_uTextureScale.z);\n uv.x = cosValue*m_uTextureScale.x*m_vTexCoord.x - sinValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.x;\n uv.y = sinValue*m_uTextureScale.x*m_vTexCoord.x + cosValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.y;\n return uv;\n}\n\nvoid parseMaterial(out vec4 baseColor, out vec3 normal, out vec2 metallicRoughness, out vec3 emissiveColor, out float occlusion)\n{\n baseColor = vec4(m_uMaterial.values[0], m_uMaterial.values[1], m_uMaterial.values[2], m_uMaterial.values[3]); \n#if HAS_BASECOLORMAP\n vec2 uv = _getTransformedUV();\n baseColor *= sampleTexture2D(m_uBaseColorTexture, uv);\n#endif\n\n metallicRoughness = vec2(m_uMaterial.values[5], m_uMaterial.values[4]);\n#if HAS_METALROUGHNESSMAP\n metallicRoughness *= sampleTexture2D(m_uMetallicRoughnessTexture, m_vTexCoord.xy).bg;\n#endif\n\n#if HAS_NORMALMAP\n normal = sampleTexture2D(m_uNormalTexture, m_vTexCoord.xy).xyz * 2.0 - vec3(1.0);\n#else \n normal = m_vNormal;\n#endif\n\n emissiveColor = vec3(m_uMaterial.values[6], m_uMaterial.values[7], m_uMaterial.values[8]);\n#if HAS_EMISSIVEMAP\n emissiveColor *= sampleTexture2D(m_uEmissiveTexture, m_vTexCoord.xy).xyz;\n#endif\n\n#if HAS_OCCLUSIONMAP\n occlusion = sampleTexture2D(m_uOcclusionTexture, m_vTexCoord.xy).r;\n#endif\n}\n\n","material_pipe_texture.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nuniform sampler2D m_uDiffuseTexture;\n\n// 0-1: scaleRatio\n// 2: radian\nuniform vec3 m_uTextureScale;\n\n// 0-1: offset\n// 2: on/off\nuniform vec3 m_uTextureOffset;\n\nuniform float m_uLimitU;\n\n#if SECOND_TEXTURE\nuniform sampler2D m_uDiffuseTexture2;\n#endif\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\nvec2 _getTransformedUV(float t)\n{\n vec2 uv;\n float cosValue = cos(m_uTextureScale.z);\n float sinValue = sin(m_uTextureScale.z);\n uv.x = cosValue*m_uTextureScale.x*(m_vTexCoord.x-m_uLimitU*t) - sinValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.x;\n uv.y = sinValue*m_uTextureScale.x*(m_vTexCoord.x-m_uLimitU) + cosValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.y;\n return uv;\n}\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness ,in vec3 platteColor, in bool usePlate)\n{\n vec2 uv = _getTransformedUV(1.0);\n vec4 texel1 = sampleTexture2D(m_uDiffuseTexture, uv);\n uv=_getTransformedUV(0.5);\n vec4 texel2 = sampleTexture2D(m_uDiffuseTexture, uv);\n\n transparent = texel1.a * m_uMaterial.values[3];\n diffuse = texel1.rgb*0.5 + texel2.rgb*0.5;\n specular = dielectricColor;\n}\n\n","material_solid.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\n#if ALPHATEST\n uniform sampler2D m_uDiffuseTexture;\n#endif\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate)\n{\n //roughness = m_uMaterial.values[4];\n vec3 albedo = vec3(m_uMaterial.values[0], m_uMaterial.values[1], m_uMaterial.values[2]);\n transparent = m_uMaterial.values[3];\n\n#if ALPHATEST\n vec4 texel = sampleTexture2D(m_uDiffuseTexture, m_vTexCoord.xy);\n float alphatest = texel.a * transparent;\n\n // alpha testing\n if (alphatest < 0.15)\n {\n discard;\n }\n#endif\n \n#if GAMMA\n albedo = sRGBToLinear(albedo, 2.2); \n#endif\n\n#if USE_PLATTE\n if(usePlate == true){\n diffuse = platteColor;\n }else{\n diffuse = albedo;\n }\n#else\n diffuse = albedo;\n#endif\n // FIXME: metallic is 0 now.\n //vec3 diffuse = albedo * (1.0 - m_uMaterial.values[5]);\n //specular = mix(dielectricColor, albedo, m_uMaterial.values[5]);\n specular = dielectricColor;\n}\n\n","material_texture.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nuniform sampler2D m_uDiffuseTexture;\n\n// 0-1: scaleRatio\n// 2: radian\nuniform vec3 m_uTextureScale;\n\n// 0-1: offset\n// 2: on/off\nuniform vec3 m_uTextureOffset;\n\n#if SECOND_TEXTURE\nuniform sampler2D m_uDiffuseTexture2;\n#endif\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\nvec2 _getTransformedUV()\n{\n if(m_uTextureOffset.z<0.1)\n {\n return m_vTexCoord.xy;\n }\n\n vec2 uv;\n float cosValue = cos(m_uTextureScale.z);\n float sinValue = sin(m_uTextureScale.z);\n uv.x = cosValue*m_uTextureScale.x*m_vTexCoord.x - sinValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.x;\n uv.y = sinValue*m_uTextureScale.x*m_vTexCoord.x + cosValue*m_uTextureScale.y*m_vTexCoord.y + m_uTextureOffset.y;\n return uv;\n}\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness ,in vec3 platteColor, in bool usePlate)\n{\n vec2 uv = _getTransformedUV();\n vec4 texel = sampleTexture2D(m_uDiffuseTexture, uv);\n#if SECOND_TEXTURE\n vec4 texel2 = sampleTexture2D(m_uDiffuseTexture2, uv);\n#endif\n\n transparent = texel.a * m_uMaterial.values[3];\n#if SECOND_TEXTURE\n transparent = transparent * (1.0 - texel2.a) + texel2.a;\n#endif\n\n#if ALPHATEST\n if (transparent < m_uMaterial.values[5]) \n {\n discard;\n }\n#endif\n\n // FIXME: roughness is not used now.\n //roughness = m_uMaterial.values[4];\n vec3 albedo = texel.rgb * vec3(m_uMaterial.values[0], m_uMaterial.values[1], m_uMaterial.values[2]);\n#if SECOND_TEXTURE \n albedo = albedo * texel.a * m_uMaterial.values[3];\n albedo = albedo * (1.0 - texel2.a) + texel2.rgb * texel2.a;\n#endif\n\n#if GAMMA\n albedo = sRGBToLinear(albedo, 2.2); \n#endif\n\n#if USE_PLATTE\n if(usePlate == true){\n // diffuseColor\n diffuse = texel.rgb * platteColor;\n }else{\n diffuse = albedo;\n }\n#else\n diffuse = albedo;\n#endif\n // FIXME: metallic is 0 now.\n //diffuse = albedo * (1.0 - m_uMaterial.values[5]);\n //specular = mix(dielectricColor, albedo, m_uMaterial.values[5]);\n specular = dielectricColor;\n\n}\n\n","pbr.fs":"#if WEBGL2\nin vec3 m_vVertex;\nin vec3 m_vNormal;\nin vec3 m_vTexCoord;\nin mat3 m_vTBN;\nin vec4 m_vColor;\nflat in vec4 m_vId;\nin float m_vDepth;\nin float m_vColorIndex;\n#else \n\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying mat3 m_vTBN;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\n#include <uniform.inc>\n\n\n\n\n","pbr_main.fs":"#include <globalvars.inc>\n#include <gamma.inc>\n#include <lights.inc>\n#include <shadow.inc>\n\nvoid parseMaterial(out vec4 baseColor, out vec3 normal, out vec2 metallicRoughness, out vec3 emissiveColor, out float occlusion);\n\nvec4 shade(in vec4 baseColor, in vec3 normal, in vec3 V, in vec2 metallicRoughness, in vec3 emissiveColor, in float occlusion); \n\n#if WEBGL2\nlayout(location=0) out vec4 out_color;\nlayout(location=1) out vec4 out_color1; \n#endif\n\n#if USE_PLATTE\nuniform sampler2D m_uPlatteTexture;\n#endif\n\n#if TONE_MAPPING \n\n#include <tone_mapping.inc>\n\n#endif \n\nvoid main()\n{\n#include <clipping.inc>\n\n vec3 N = normalize(m_vNormal);\n vec3 V = normalize(m_vVertex - m_uPerFrame.cameraPosition.xyz);\n vec3 P = m_vVertex;\n\n#if DOUBLESIDED \n N *= -sign(dot(N, V));\n#endif\n\n vec4 baseColor; \n vec3 normal;\n vec2 metallicRoughness;\n vec3 emissiveColor;\n float occlusion;\n#if USE_PLATTE\n if (m_vColorIndex < 0.495)\n {\n vec4 platteColor = sampleTexture2D(m_uPlatteTexture, vec2(m_vColorIndex, 0));\n baseColor = platteColor;\n }\n else\n {\n parseMaterial(baseColor, normal, metallicRoughness, emissiveColor, occlusion);\n }\n#else\n parseMaterial(baseColor, normal, metallicRoughness, emissiveColor, occlusion);\n#endif\n vec4 color = shade(baseColor, normal, V, metallicRoughness, emissiveColor, occlusion);\n\n#if TONE_MAPPING\n color.rgb = toneMapping(color.rgb);\n#endif\n#if GAMMA\n color.xyz = linearTosRGB(color.xyz, 2.2);\n#endif\n\n#if WEBGL2\n out_color = color;\n#else\n gl_FragColor = color; \n#endif\n \n}\n","pbr_main.vs":"#if WEBGL2\nout vec3 m_vVertex;\nout vec3 m_vNormal;\nout vec3 m_vTexCoord;\nout mat3 m_vTBN;\nout vec4 m_vColor;\nflat out vec4 m_vId;\nout float m_vDepth;\nout float m_vColorIndex;\n#else\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying mat3 m_vTBN;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition);\n\nvoid main()\n{\n vec4 position = vec4(m_aPosition, 1.0);\n#if COMPRESSION\n vec4 normal = vec4(m_aNormal0, m_aNormal1, m_aNormal2);\n#else\n vec4 normal = vec4(m_aNormal0, 0.0);\n#endif\n vec3 uv = vec3(m_aTexCoord, 1.0);\n\n vec4 worldPosition;\n\n transform(position, normal, uv, worldPosition);\n\n#if VISIBILITY\n position.z -= step(0.5, m_aMaterial) * position.w * 10000.0;\n#endif\n\n#if HAS_TANGENT\n vec3 tangent = (m_uPerNode.modelMatrix * vec4(m_aTangent, 0.0)).xyz;\n vec3 biTangent = normalize(cross(normal.xyz, tangent));\n m_vTBN = mat3(normalize(tangent), biTangent, normal.xyz);\n#endif\n\n#if USE_PLATTE\n m_vColorIndex = m_aMaterial; \n#endif\n\n#include <varying.inc>\n\n gl_Position = position;\n\n gl_PointSize = 4.0;\n}\n\n","shade_adhoc.inc":"\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n#if BASE\n vec3 color = diffuse;\n#else\n // Main light (environmental diffuse lighting)\n float diffuseTerm = dot(vec4(N, 1), m_uSunLight.diffuseMatrix[0] * vec4(N, 1));\n \n // Second light (head light)\n float nv = max(dot(N, -V), 0.0);\n float vl = max(dot(V, m_uSunLight.direction), 0.0);\n diffuseTerm = diffuseTerm + (nv * (1.0 - vl)) * 0.8;\n \n vec3 color = m_uSunLight.intensity * vec3(0.5, 0.497, 0.49) * (diffuse * diffuseTerm) + diffuse * 0.5;\n \n float specularTerm = 0.0;\n float nh;\n \n#if SPECULAR\n // Main light specular part\n vec3 H = -normalize(m_uSunLight.direction + V);\n nh = max(dot(N, H), 0.0);\n specularTerm = pow(nh, 100.0); // FIXME: Currently we use constant roughness.\n \n color += m_uSunLight.intensity * vec3(0.5) * specularTerm;\n#endif\n\n#if SHADOW\n color *= shadow(P, N, m_uSunLight.direction);\n#endif\n\n#endif\n return color;\n}\n\n\n","shade_color_multi_layer.inc":"uniform sampler2D m_uPlatteTexture;\nuniform sampler2D m_uDensityTexture;\nuniform vec2 m_uInvResolution;\nuniform float m_uAlphaCorrection;\nuniform mat4 m_uInvTransform;\nuniform float m_uLayers;\nuniform vec2 m_uGridSize;\nuniform float m_uSampleNumber;\nuniform float m_uInstanceFilter;\nconst float STEP = 1.73205081 / 256.0;\n\nvec4 getColor(float intensity) {\n vec2 _uv = vec2(intensity, 0);\n vec4 color = sampleTexture2D(m_uPlatteTexture, _uv);\n float alpha = 1.0;\n return vec4(color.r, color.g, color.b, alpha); \n}\n\nfloat sampleAs3DTexture( vec3 texCoord ) {\n texCoord += vec3(0.5); // 000(1,1,1)\n float z = clamp(texCoord.z, 0.0, 0.99);\n float sliceNumber = floor(z * m_uLayers);\n\n float top = min(m_uSampleNumber + sliceNumber + 1.0, m_uLayers - 1.0);\n float bottom = max(sliceNumber - m_uSampleNumber, 0.0);\n float totalSamples = 0.0;\n\n texCoord.y = 1.0 - texCoord.y;\n texCoord.xy /= m_uGridSize;\n float intensity = 0.0;\n float heightLength = 0.0;\n int i;\n for (i = int(bottom); i <= int(top); i++)\n {\n vec2 texCoordSlice = texCoord.xy;\n texCoordSlice.x += mod(float(i), m_uGridSize.x) / m_uGridSize.x;\n texCoordSlice.y += floor(float(i) / m_uGridSize.x) / m_uGridSize.y;\n float tempIntensity = sampleTexture2D(m_uDensityTexture, texCoordSlice).x;\n intensity += tempIntensity;\n heightLength += 1.0;\n }\n intensity /= max(heightLength,1.0);\n\treturn intensity;\n}\n\n // axis aligned box centered at the origin, with size boxSize\nvec2 boxIntersection(vec3 orig, vec3 dir) \n{\n\tconst vec3 box_min = vec3( - 0.5 );\n\tconst vec3 box_max = vec3( 0.5 );\n\tvec3 inv_dir = 1.0 / dir;\n\tvec3 tmin_tmp = ( box_min - orig ) * inv_dir;\n vec3 tmax_tmp = ( box_max - orig ) * inv_dir;\n\tvec3 tmin = min( tmin_tmp, tmax_tmp );\n\tvec3 tmax = max( tmin_tmp, tmax_tmp );\n\tfloat t0 = max( tmin.x, max( tmin.y, tmin.z ) );\n\tfloat t1 = min( tmax.x, min( tmax.y, tmax.z ) );\n\treturn vec2( t0, t1 );\n}\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n vec2 texc = vec2(gl_FragCoord.x * m_uInvResolution.x,\n gl_FragCoord.y * m_uInvResolution.y);\n\n // Transform to model space.\n vec3 frontPos = (m_uInvTransform * vec4(P.x, P.y, P.z, 1.0)).xyz;\n vec3 cameraPos = (m_uInvTransform * vec4(m_uPerFrame.cameraPosition.xyz, 1.0)).xyz;\n vec3 rayDir = normalize((m_uInvTransform * vec4(V.xyz, 0.0)).xyz);\n vec3 backPos = frontPos;\n vec2 bounds = boxIntersection(cameraPos, rayDir);\n if ( bounds.x > bounds.y ) discard;\n bounds.x = max( bounds.x, 0.0 );\n vec3 p = cameraPos + bounds.x * rayDir;\n vec3 inc = 1.0 / abs( rayDir );\n float delta = min( inc.x, min( inc.y, inc.z ) );\n\tdelta /= 100.0;\n\n // The color accumulator.\n vec4 accumulatedColor = vec4(0.0);\n vec4 tempColor = vec4(0.0);\n float d = 0.0;\n float widthLength = 0.0;\n for ( float t = bounds.x; t < bounds.y; t += delta ) {\n\t\td += sampleAs3DTexture( p );\n p += rayDir * delta;\n widthLength += 1.0;\n }\n d /= widthLength;\n if ( d > m_uInstanceFilter ) {\n accumulatedColor = getColor(d);\n\t\t accumulatedColor.a = 1.0;\n transparent = 1.0;\n }else{\n\t\t accumulatedColor.a = 0.0;\n transparent = 0.0;\n }\n return accumulatedColor.xyz;\n}\n","shade_glass.inc":"\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n#if BASE\n vec3 color = diffuse;\n#else\n vec3 color = diffuse * m_uSunLight.intensity;\n \n#if SPECULAR\n vec3 H = -normalize(m_uSunLight.direction + V);\n float nh = max(dot(N, H), 0.0);\n color += vec3(pow(nh, roughness));\n#endif\n#endif\n return color;\n}\n","shade_oit.inc":"\nfloat weight(float z, float a) {\n return pow(a, 1.0) * clamp(0.03 / (1e-5 + pow(abs(z) / 200.0, 4.0)), 1e-2, 3e3);\n}\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n#if BASE\n vec3 color = diffuse;\n#else\n // Main light (environmental diffuse lighting)\n float diffuseTerm = dot(vec4(N, 1), m_uSunLight.diffuseMatrix[0] * vec4(N, 1));\n \n // Second light (head light)\n float nv = max(dot(N, -V), 0.0);\n float vl = max(dot(V, m_uSunLight.direction), 0.0);\n diffuseTerm = diffuseTerm + (nv * (1.0 - vl)) * 0.8;\n \n vec3 color = m_uSunLight.intensity * vec3(0.5, 0.497, 0.49) * (diffuse * diffuseTerm) + diffuse * 0.5;\n \n float specularTerm = 0.0;\n float nh;\n\n#if SPECULAR\n // Main light specular part\n vec3 H = -normalize(m_uSunLight.direction + V);\n nh = max(dot(N, H), 0.0);\n specularTerm = pow(nh, 100.0); // FIXME: Currently we use constant roughness.\n \n color += m_uSunLight.intensity * vec3(0.5, 0.497, 0.49) * specularTerm;\n#endif\n\n float w = weight(m_vDepth, transparent);\n color = diffuse * w * transparent;\n secondColor = vec4(vec3(transparent * w), 1.0);\n\n#endif\n return color;\n}\n","shade_pbr.inc":'uniform sampler2D m_uBrdfLut;\nuniform samplerCube m_uDiffuseEnvMap;\nuniform samplerCube m_uSpecularEnvMap;\nuniform float m_uTotalLod;\nconst float M_PI = 3.1416926;\nvec3 specularReflection(vec3 reflectance0, vec3 reflectance90, float VdotH)\n{\n return reflectance0 + (reflectance90 - reflectance0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat geometricOcclusion(float NdotL, float NdotV, float alphaRoughness)\n{\n float r = alphaRoughness;\n\n float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat microfacetDistribution(float alphaRoughness, float NdotH)\n{\n float roughnessSq = alphaRoughness * alphaRoughness;\n float f = (NdotH * roughnessSq - NdotH) * NdotH + 1.0;\n return roughnessSq / (M_PI * f * f);\n}\n\nvec3 diffuse(vec3 diffuseColor)\n{\n return diffuseColor / M_PI;\n}\n\nvec3 getIBLContribution(float perceptualRoughness, vec3 n, float NdotV, vec3 diffuseColor, vec3 specularColor, vec3 reflection)\n{\n // We can bake the env map using according to the following course note or using IBL Baker.\n // https://cdn2-unrealengine-1251447533.file.myqcloud.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\n // retrieve a scale and bias to F0.\n vec3 brdf = sampleTexture2D(m_uBrdfLut, vec2(NdotV, 1.0 - perceptualRoughness)).rgb;\n brdf = pow(brdf,vec3(2.2));\n \n#if DIFFUSE_EVN_MAP\n vec3 diffuseLight = sampleTexture3D(m_uDiffuseEnvMap, vec3(n.x, n.z, -n.y)).rgb;\n#else\n vec3 diffuseLight = vec3(1.0);\n\n#if SPECULAR_ENV_MAP\n float lod = (perceptualRoughness * m_uTotalLod);\n vec3 specularLight = sampleTexture3D(m_uSpecularEnvMap, vec3(-reflection.x, -reflection.z, reflection.y), lod).rgb;\n#else\n vec3 specularLight = vec3(1.0);\n#endif\n\n vec3 diffuse = diffuseLight * diffuseColor;\n vec3 specular = specularLight * (specularColor * brdf.x + brdf.y);\n\n return diffuse + specular;\n}\n\nvec4 shade(in vec4 baseColor, in vec3 normal, in vec3 V, in vec2 metallicRoughness, in vec3 emissiveColor, in float occlusion)\n{\n#if BASE\n vec3 color = baseColor;\n#else\n float roughness = clamp(metallicRoughness.y, 0.04, 1.0);\n float metallic = clamp(metallicRoughness.x, 0.0, 1.0);\n\n#if HAS_NORMALMAP\n\n#if HAS_TANGENT\n vec3 worldNormal = normalize(m_vTBN * normal);\n#else\n // FIXME: If it\'s webgl1.0, use extension to get ddx and ddy.\n vec3 pos_dx = dFdx(m_vVertex);\n vec3 pos_dy = dFdy(m_vVertex);\n vec3 tex_dx = dFdx(m_vTexCoord);\n vec3 tex_dy = dFdy(m_vTexCoord);\n vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n t = normalize(t - m_vNormal * dot(m_vNormal, t));\n vec3 b = normalize(cross(m_vNormal, t));\n mat3 tbn = mat3(t, b, m_vNormal);\n vec3 worldNormal = normalize(tbn * normal);\n#endif\n\n#else\n vec3 worldNormal = normalize(m_vNormal);\n#endif\n\n vec3 l = normalize(m_uSunLight.direction); // Vector from surface point to light\n vec3 h = normalize(l + V); // Half vector between both l and v\n vec3 reflection = -normalize(reflect(V, worldNormal));\n\n float NdotL = clamp(dot(worldNormal, l), 0.001, 1.0);\n float NdotV = abs(dot(worldNormal, V)) + 0.001;\n float NdotH = clamp(dot(worldNormal, h), 0.0, 1.0);\n float LdotH = clamp(dot(l, h), 0.0, 1.0);\n float VdotH = clamp(dot(V, h), 0.0, 1.0);\n\n vec3 f0 = vec3(0.04);\n vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n diffuseColor *= 1.0 - metallic;\n vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n // Compute reflectance.\n float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n vec3 specularEnvironmentR0 = specularColor.rgb;\n vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n float alphaRoughness = roughness * roughness;\n vec3 F = specularReflection(specularEnvironmentR0, specularEnvironmentR90, VdotH);\n float G = geometricOcclusion(NdotL, NdotV, alphaRoughness);\n float D = microfacetDistribution(alphaRoughness, NdotH);\n // Calculation of analytical lighting contribution\n vec3 diffuseContrib = (1.0 - F) * diffuse(diffuseColor);\n vec3 specContrib = max(vec3(0.0), F * G * D / (4.0 * NdotL * NdotV));\n vec3 color = NdotL * (diffuseContrib + specContrib);\n\n diffuseColor *= m_uSunLight.intensity;\n specularColor *= m_uSunLight.intensity;\n color += m_uMaterial.values[9] * getIBLContribution(roughness, worldNormal, NdotV, diffuseColor, specularColor, reflection);\n\n#if SHADOW\n color *= shadow(m_vVertex, normal, m_uSunLight.direction);\n#endif\n\n#if HAS_EMISSIVEMAP\n color += emissiveColor;\n#endif\n\n#if HAS_OCCLUSIONMAP\n color *= occlusion;\n#endif\n#endif\n return vec4(color, baseColor.a);\n}\n',"transform_nonormal.inc":"\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n#if MODEL_TRANSFORM\n#if INSTANCING\n position = m_aModelMatrix * position;\n#else\n position = m_uPerNode.modelMatrix * position;\n#endif\n#endif\n\n worldPosition = position;\n position = m_uPerFrame.vpMatrix * position;\n}\n","blit_dof.inc":"uniform bool useDepth;\nuniform sampler2D m_uBlitDepthTexture;\nuniform float maxblur;\nuniform float aperture;\nuniform vec2 nearFar;\nuniform float focus;\n\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n return dot( v, UnpackFactors );\n}\n\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n\nfloat getViewZ( const in float depth ) {\n\treturn perspectiveDepthToViewZ( depth, nearFar.x, nearFar.y );\n}\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec2 dofblur;\n vec2 aspectcorrect = vec2(1.0, invResolution.y / invResolution.x);\n if (useDepth) \n {\n float viewZ = getViewZ(unpackRGBAToDepth(sampleTexture2D(m_uBlitDepthTexture, uv)));\n float factor = focus + viewZ;\n dofblur = vec2(clamp(factor * aperture, -maxblur, maxblur));\n }\n else \n {\n dofblur = vec2(clamp(sampleTexture2D(m_uBlitDepthTexture, vec2(uv.x, 1.0 - uv.y)).a * aperture, -maxblur, maxblur));\n }\n vec2 dofblur9 = dofblur * 0.9;\n vec2 dofblur7 = dofblur * 0.7;\n vec2 dofblur4 = dofblur * 0.4;\n vec4 col = vec4( 0.0 );\n col += sampleTexture2D(tex, uv);\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, 0.4 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.15, 0.37 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, 0.29 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.37, 0.15 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.40, 0.0 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.37, -0.15 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, -0.29 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, -0.4 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.15, 0.37 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, 0.29 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.37, 0.15 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.4, 0.0 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.15, -0.37 ) * aspectcorrect ) * dofblur );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.15, 0.37 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.37, 0.15 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.15, 0.37 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.37, 0.15 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, 0.29 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.40, 0.0 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, -0.4 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, 0.29 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.4, 0.0 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, 0.4 ) * aspectcorrect ) * dofblur7 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, 0.29 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.4, 0.0 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, -0.4 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, 0.29 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.4, 0.0 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n col += sampleTexture2D( tex, uv.xy + ( vec2( 0.0, 0.4 ) * aspectcorrect ) * dofblur4 );\n col = col / 41.0;\n col.a = 1.0;\n return col;\n}\n","blit_fog.inc":"//uniform sampler2D uTexture0;\nuniform vec4 uColor;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n vec4 color = sampleTexture2D(tex, uv);\n //vec4 depth = sampleTexture2D(uTexture0, uv);\n float depth = uv.y;\n\n return mix(color, uColor, depth);\n}\n","blit_glow.inc":"uniform float intensity;\nuniform float offset;\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n vec4 color = sampleTexture2D(tex, uv);\n color.a = abs(offset - color.a);\n return color * intensity * 2.0;\n}\n","blit_glow_blur.inc":"// This shader can be used to the highlight effect.\nuniform vec2 direction;\nuniform float radius;\nuniform float weights[7];\n\n// Transform color to luminance.\nfloat getLuminance(vec3 color)\n{\n return dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n\n\tvec2 texelStep = invResolution * direction * radius;\n\tvec2 start = uv - 3.0 * texelStep;\n\n\tvec4 baseColor = vec4(0., 0., 0., 0.);\n\tvec2 texelOffset = vec2(0., 0.);\n\n\tfor (int i = 0; i < 7; i++)\n\t{\n\t\t// alpha blur.\n\t\tvec4 texel = sampleTexture2D(tex, start + texelOffset);\n\t\tbaseColor.a += texel.a * weights[i];\n\n\t\t// Highest Luma for outline.\n\t\tfloat luminance = getLuminance(baseColor.rgb);\n\t\tfloat luminanceTexel = getLuminance(texel.rgb);\n\t\tfloat choice = step(luminanceTexel, luminance);\n\t\tbaseColor.rgb = choice * baseColor.rgb + (1.0 - choice) * texel.rgb;\n\n\t\ttexelOffset += texelStep;\n\t}\n\n\treturn baseColor;\n}\n","blit_gradient.inc":"uniform vec3 uColor;\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n //vec2 offset = (m_vTexCoord.xy - vec2(0.5, 0.5)) * 2.0;\n\n //float dist2 = dot(offset, offset);\n //float c = max(min(1.5 * dist2 - 0.5, 0.8), 0.0);\n\n //return vec4(0, 0, 0, c);\n\n vec4 t = sampleTexture2D(tex, uv);\n return vec4(uColor, 1.0 - t.r);\n}\n","blit_metaball.inc":"uniform vec4 uColor;\nuniform vec4 uContourColor;\n//uniform vec4 uBackgroundColor;\nuniform float uContourWidth;\nconst float uThreshold = 0.3;\n\n#if MOBILE\nvec4 shade(in sampler2D tex, in sampler2D tex2, in vec2 uv, in vec2 invResolution)\n#else\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n#endif\n{\n float contourThreshold = uThreshold * uContourWidth;\n float alpha = sampleTexture2D(tex, uv).r;\n\n vec4 ret;\n \n if (alpha < uThreshold) {\n\t discard;\n }\n\n#if CONTOUR\n if (alpha < contourThreshold) {\n ret = uContourColor;\n } else {\n#endif\n ret = uColor;\n#if CONTOUR\n }\n#endif\n\n return ret;\n}\n","blit_ssao.inc":"uniform vec3 uNearAxis;\nuniform vec2 uTexTransform;\nuniform vec2 SAMPLES[16];\nuniform float uRadius;\nuniform bool uIsPerspective;\n\nvec4 getNormalAndDepth(sampler2D tex, vec2 fragCoord)\n{\n vec2 texcoord = fragCoord * 0.5 + vec2(0.5);\n texcoord.x = texcoord.x * uTexTransform.x + uTexTransform.y;\n return sampleTexture2D(tex, texcoord);\n}\n\nvec3 getEyePosition(vec2 fragCoord, float depth)\n{\n vec3 eyeDirection = uNearAxis * vec3(fragCoord, 1.0);\n vec3 eyePosition;\n eyePosition.z = depth;\n if (uIsPerspective) \n {\n eyePosition.xy = eyeDirection.xy * depth / eyeDirection.z;\n } \n else \n {\n eyePosition.xy = eyeDirection.xy;\n }\n return eyePosition; \n}\n\nvec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n float ao = 0.0;\n float radius = uRadius;\n float radius2 = radius * radius;\n const float bias = 0.0001;\n const float epsilon = 0.0001;\n vec2 vFragCoord = uv * 2.0 - vec2(1.0);\n vec4 p = getNormalAndDepth(tex, vFragCoord);\n vec3 eyePosition = getEyePosition(vFragCoord, p.w);\n vec3 normal = p.xyz;\n for (int i = 0; i < 16; i++)\n {\n vec2 d = SAMPLES[i] - vec2(0.5);\n vec2 sample = vec2(vFragCoord + d * radius / eyePosition.z);\n float depth = getNormalAndDepth(tex, sample).w;\n vec3 samplePosition = getEyePosition(sample, depth);\n vec3 v_i = samplePosition - eyePosition;\n float v_v = dot(v_i, v_i);\n float f = max(radius2 - v_v, 0.0) / radius2;\n ao += f * f * f * max(0.0,(dot(v_i, normal) + eyePosition.z * bias)/(v_v + epsilon));\n }\n float occ = 1.0 - ao / (4.0 * 16.0);\n occ = clamp(pow(occ, 2.04), 0.0, 1.0);\n return vec4(occ);\n}\n\n","map.fs":"#include <globalvars.inc>\n#include <gamma.inc>\n#include <lights.inc>\n#include <shadow.inc>\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate);\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor); \n\n#if WEBGL2\nlayout(location=0) out vec4 out_color;\nlayout(location=1) out vec4 out_color1; \n#endif\n\n#if TONE_MAPPING\n#include <tone_mapping.inc>\n#endif\n\n#if TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\nvoid main()\n{\n// #include <clipping.inc>\n#include <tile_limit_rectangle.inc>\n\n vec3 N = normalize(m_vNormal);\n vec3 V = normalize(m_vVertex * m_uPerFrame.cameraPosition.w - m_uPerFrame.cameraPosition.xyz);\n vec3 P = m_vVertex;\n\n vec3 diffuse = vec3(1.0); \n float transparent;\n vec3 specular;\n float roughness;\n vec4 platte = vec4(1.0);\n vec3 platteColor = vec3(1.0);\n bool usePlate = false;\n\n parseMaterial(diffuse, specular, transparent, roughness ,platteColor, usePlate);\n \n\n#if !WEBGL2\n vec4 out_color1;\n#endif\n vec3 color = shade(diffuse, specular, roughness, transparent, P, N, V, out_color1); \n\n#if TONE_MAPPING\n color.rgb = toneMapping(color.rgb);\n#endif\n\n#if GAMMA\n color = linearTosRGB(color, 2.2);\n#endif\n\n#if WEBGL2\n out_color = vec4(color, transparent);\n#else\n gl_FragColor = vec4(color, transparent); \n#endif\n \n}\n","mark_main.fs":"#include <globalvars.inc>\n\nout vec4 out_color;\n\nvoid main()\n{\n#include <clipping.inc>\n \n out_color = m_vId;\n}","material_animating_ribbon.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nuniform sampler2D m_uPlatteTexture;\nuniform float m_uTime;\nuniform float m_uSpeed;\n\nconst vec3 dielectricColor = vec3(0.04); // The specular color of water.\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor ,in bool usePlate)\n{\n vec4 texel = sampleTexture2D(m_uPlatteTexture, m_vTexCoord.xy + m_uTime * vec2(0.001 * m_uSpeed, 0.0));\n transparent = texel.a;\n diffuse *= texel.rgb;\n specular = dielectricColor;\n}\n","material_barchart.inc":"// 0-2: diffuse\n// 3: transparent\n// 4: roughness\n// 5: metallic\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nconst vec3 dielectricColor = vec3(1.0); // The specular color of water.\n\n#if ALPHATEST\n uniform sampler2D m_uDiffuseTexture;\n#endif\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor ,in bool usePlate)\n{\n diffuse *= m_vColor.xyz;\n specular = dielectricColor;\n transparent = 1.0;\n}\n","material_dummy.inc":"struct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate)\n{\n transparent = 0.5;\n return;\n}\n","material_heatmap.inc":"const vec3 dielectricColor = vec3(1.0);\n\nuniform sampler2D m_uData;\nuniform sampler2D m_uPlatte;\n#if ENABLE_FOREGROUND\nuniform sampler2D m_uForeground;\n#endif\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate)\n{\n float intensity = sampleTexture2D(m_uData, m_vTexCoord.xy).x;\n diffuse *= sampleTexture2D(m_uPlatte, vec2(intensity, 0.0)).rgb;\n#if ENABLE_FOREGROUND\n vec4 foregroundColor = sampleTexture2D(m_uForeground, m_vTexCoord.xy);\n diffuse *= foregroundColor.rgb * foregroundColor.a + diffuse * (1.0 - foregroundColor.a);\n#endif\n specular = dielectricColor;\n#if DISABLE_BLEND\n transparent = 1.0;\n#else\n transparent = intensity * 100.0; \n#endif\n}\n","material_heightmap.inc":"const vec3 dielectricColor = vec3(1.0);\n\nvoid parseMaterial(inout vec3 diffuse, out vec3 specular, out float transparent, out float roughness,in vec3 platteColor,in bool usePlate)\n{\n diffuse *= m_vColor.xyz;\n specular = dielectricColor;\n transparent = m_vColor.a;\n}\n","modelo_dark.fs":"#include <globalvars.inc>\n#include <gamma.inc>\n#include <lights.inc>\n#include <shadow.inc>\n\n#if WEBGL2\nlayout(location=0) out vec4 out_color;\n#endif\n\nstruct MaterialStruct\n{\n float values[6]; \n};\nuniform MaterialStruct m_uMaterial;\n\nvoid main()\n{\n#include <clipping.inc>\n\n vec3 N = normalize(m_vNormal);\n vec3 V = normalize(m_vVertex * m_uPerFrame.cameraPosition.w - m_uPerFrame.cameraPosition.xyz);\n vec3 P = m_vVertex;\n\n#if DOUBLESIDED \n N *= (float(gl_FrontFacing)*2.0-1.0);\n#endif\n\n // Prepare material\n vec3 diffuse; \n float transparent;\n vec3 specular;\n\n diffuse = vec3(m_uMaterial.values[0], m_uMaterial.values[1], m_uMaterial.values[2]);\n transparent = m_uMaterial.values[3];\n\n\n // Main light (environmental diffuse lighting)\n float diffuseTerm = dot(vec4(N, 1), m_uSunLight.diffuseMatrix[0] * vec4(N, 1));\n \n // Second light (head light)\n float nv = max(dot(N, -V), 0.0);\n float vl = max(dot(V, m_uSunLight.direction), 0.0);\n diffuseTerm = diffuseTerm + (nv * (1.0 - vl)) * 0.8;\n \n vec3 color = m_uSunLight.intensity * vec3(0.5, 0.497, 0.49) * (diffuse * diffuseTerm) + diffuse * 0.5;\n \n float specularTerm = 0.0;\n float nh;\n \n#if SPECULAR\n // Main light specular part\n vec3 H = -normalize(m_uSunLight.direction + V);\n nh = max(dot(vec3(0.0, 0.0, N.z), H), 0.0); // Specular only for z-up faces.\n specularTerm = pow(nh, 10.0); // FIXME: Currently we use constant roughness.\n \n color += m_uSunLight.intensity * vec3(10.0) * specularTerm;\n#endif\n\n transparent = max(specularTerm, transparent);\n\n#if SHADOW\n color *= shadow(P, N, m_uSunLight.direction);\n#endif\n \n#if WEBGL2\n out_color = vec4(color, transparent);\n#else\n gl_FragColor = vec4(color, transparent); \n#endif\n \n}\n\n","modelo_ribbon.vs":"#if WEBGL2\nout vec3 m_vVertex;\nout vec3 m_vNormal;\nout vec3 m_vTexCoord;\nout vec4 m_vColor;\nflat out vec4 m_vId;\nout float m_vDepth;\nout float m_vColorIndex;\n#else\nvarying vec3 m_vVertex;\nvarying vec3 m_vNormal;\nvarying vec3 m_vTexCoord;\nvarying vec4 m_vColor;\nvarying float m_vDepth;\nvarying float m_vColorIndex;\n#endif\n\nuniform vec4 uTexSizeAndInv;\nuniform float m_uWidth;// ribbon's minimum width in pixel\n\nvec2 project(vec4 device)\n{\n vec3 devicePos = device.xyz / device.w;\n vec2 clipPos = (devicePos * 0.5 + 0.5).xy;\n return clipPos * uTexSizeAndInv.xy;\n}\n\nvec4 unproject(vec2 screen, float z, float w) \n{\n vec2 clipPos = screen * uTexSizeAndInv.zw;\n vec2 devicePos = clipPos * 2.0 - 1.0;\n return vec4(devicePos * w, z, w);\n}\n\nconst float PI = 3.14159;\nvoid main()\n{\n // get screen space position of last, next and current.\n vec2 sLast = project(m_uPerFrame.vpMatrix * vec4(m_aNormal0.xyz, 1.0));\n vec2 sNext = project(m_uPerFrame.vpMatrix * vec4(m_aColor.xyz, 1.0));\n vec4 dCurrent = m_uPerFrame.vpMatrix * vec4(m_aPosition.xyz, 1.0);\n vec2 sCurrent = project(dCurrent);\n\n vec2 normal1 = (sLast - sCurrent);\n vec2 normal2 = (sCurrent - sNext);\n // get screen space normal.\n vec2 normal = normalize(normal1 + normal2);\n float off = m_aColor.w;\n \n // get screen space offset direction.\n vec2 dir = vec2(normal.y, -normal.x) * off;\n // offset the screen space position by width(in pixels)\n // Notice that if the vertex is in front of the near plane, the actual width in pixel can be larger than m_uWidth.\n vec2 pos = sCurrent + dir * m_uWidth;\n\n vec4 worldPosition = vec4(m_aPosition.xyz, 1.0);\n\n vec3 uv = vec3(m_aTexCoord.x, (off + 1.0) * 0.5, 1.0);\n\n#include <varying.inc>\n\n gl_Position = unproject(pos, dCurrent.z, dCurrent.w);\n}\n\n","shade_glyph.inc":"uniform sampler2D m_uFontBitmap;\nuniform vec2 m_uTextureSize;\nuniform vec3 m_uColor;\n\nfloat bilinear(vec2 frac2, vec4 v)\n{\n vec2 cc = mix(v.xz, v.yw, frac2.x);\n return mix(cc.x, cc.y, frac2.y);\n}\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n // float sample1 = sampleTexture2D(m_uFontBitmap, m_vTexCoord.xy).r;\n // float scale = 1.0 / fwidth(sample1);\n // float signedDistance = (sample1 - 0.5) * scale;\n // float color = clamp(signedDistance + 0.5, 0.0, 1.0);\n // transparent = clamp(signedDistance + 0.5 + scale * 0.125, 0.0, 1.0);\n // return vec3(color);\n\n vec2 coord = m_vTexCoord.xy * m_uTextureSize;\n vec2 p = floor(coord - vec2(0.5)) + vec2(0.5);\n vec2 f = coord - p;\n vec2 p0 = p / m_uTextureSize;\n vec2 pixel = 1.0 / m_uTextureSize;\n\n vec4 c;\n c.x = sampleTexture2D(m_uFontBitmap, p0).x;\n c.y = sampleTexture2D(m_uFontBitmap, p0 + vec2(pixel.x, 0)).x;\n c.z = sampleTexture2D(m_uFontBitmap, p0 + vec2(0, pixel.y)).x;\n c.w = sampleTexture2D(m_uFontBitmap, p0 + vec2(pixel.x, pixel.y)).x;\n\n float value = bilinear(f, c);\n\n transparent = step(0.45, value);\n if (transparent < 0.5) {\n discard;\n }\n return m_uColor;\n}\n","shade_pbs.inc":"","shade_volume.inc":"uniform sampler2D m_uGradientTexture;\nuniform sampler2D m_uPlatteTexture;\nuniform sampler2D m_uDensityTexture;\nuniform vec2 m_uInvResolution;\nuniform float m_uAlphaCorrection;\nuniform mat4 m_uInvTransform;\n\nconst float STEP = 1.73205081 / 256.0;\n\n// Get color according to intenstity\nvec4 getColor(float density) \n{\n // Makes the volume looks brighter;\n density = min(0.26, density) / 0.26;\n vec4 color = sampleTexture2D(m_uPlatteTexture, vec2(density, 0.0));\n\n // Attenuate the alpha.\n float alpha = max(density, 0.02);\n \n return vec4(color.rgb, alpha); \n}\n\nvec4 sampleDensity(vec3 position) \n{\n // position is within [-0.5, -0.5, -0.5] x [0.5, 0.5, 0.5]\n\n // TODO: currently we don't support multiple layers.\n // The z coordinate determines which Z slice we have to look for.\n //float z = clamp(texCoord.z, 0.0, 0.99);\n \n //float sliceNumber = floor(z * float(m_uSliceNumber));\n \n //texCoord.y = 1.0 - texCoord.y;\n //texCoord.xy *= 0.125;\n \n //vec2 texCoordSlice = texCoord.xy;\n //texCoordSlice.x += (mod(sliceNumber, 8.0) * 0.125);\n //texCoordSlice.y += floor(sliceNumber * 0.125) * 0.125;\n\n vec3 xyz = position + vec3(0.5);\n \n float density = sampleTexture2D(m_uDensityTexture, xyz.xy).x;\n \n vec4 res = getColor(density);\n\n //float gradient = sampleTexture2D(m_uGradientTexture, xyz.xz).x * sampleTexture2D(m_uGradientTexture, xyz.yz).x;\n \n res.w *= 2.0 * (xyz.z * xyz.z * xyz.z) - 3.0 * (xyz.z * xyz.z) + 1.0; // attenuation at the z axis\n\n return res;\n}\n\n // axis aligned box centered at the origin, with size boxSize\nvec2 boxIntersection(vec3 ro, vec3 rd) \n{\n vec3 m = 1.0 / rd; // could precompute if traversing a big set of algined boxes\n vec3 n = m * ro; // could precompute if traversing a big set of algined boxes\n vec3 k = abs(m) * 0.5;\n \n vec3 t1 = -n - k;\n vec3 t2 = -n + k;\n\n float tN = max(max(t1.x, t1.y), t1.z);\n float tF = min(min(t2.x, t2.y), t2.z);\n \n if( tN > tF || tF < 0.0) return vec2(-1.0); // no intersection\n\n return vec2(tN, tF);\n}\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n // Transform to model space.\n vec3 frontPos = (m_uInvTransform * vec4(P.x, P.y, P.z, 1.0)).xyz;\n vec3 cameraPos = (m_uInvTransform * vec4(m_uPerFrame.cameraPosition.xyz, 1.0)).xyz;\n vec3 rayDir = normalize((m_uInvTransform * vec4(V.xyz, 0.0)).xyz);\n vec3 backPos = frontPos;\n vec2 t = boxIntersection(cameraPos, rayDir);\n if (t.x > -1.0 && t.y > -1.0)\n {\n backPos = cameraPos + rayDir * t.y;\n }\n \n float rayLength = length(backPos - frontPos);\n\n int steps = int(max(1.0, floor(rayLength / STEP)));\n \n // Calculate how long to increment in each step.\n float delta = rayLength / float(steps);\n \n // The increment in each direction for each step.\n vec3 deltaDirection = rayDir * delta;\n \n // Start the ray casting from the front position.\n vec3 currentPosition = frontPos;\n \n // The color accumulator.\n vec4 accumulatedColor = vec4(0.0);\n \n // The alpha value accumulated so far.\n float accumulatedAlpha = 0.0;\n \n vec4 colorSample;\n float alphaSample;\n \n#if WEBGL2\n for (int i = 0; i < steps; i++)\n {\n#else\n for (int i = 0; i < 256; i++) \n {\n if (i >= steps) \n {\n break;\n }\n#endif\n colorSample = sampleDensity(currentPosition);\n \n alphaSample = colorSample.a * m_uAlphaCorrection;\n \n alphaSample *= (1.0 - accumulatedAlpha);\n \n // Perform the composition.\n accumulatedColor += colorSample * alphaSample;\n \n // Store the alpha accumulated so far.\n accumulatedAlpha += alphaSample;\n \n // Advance the ray.\n currentPosition += deltaDirection;\n }\n \n transparent = accumulatedAlpha;\n \n return accumulatedColor.xyz;\n}\n","shade_volume_multi_layer.inc":"uniform sampler2D m_uDensityTexture;\nuniform sampler2D m_uPlatteTexture;\nuniform vec2 m_uInvResolution;\nuniform float m_uAlphaCorrection;\nuniform mat4 m_uInvTransform;\nuniform float m_uLayers;\nuniform vec2 m_uGridSize;\nuniform float m_uSampleNumber;\nconst float STEP = 1.73205081 / 256.0;\n\n// get color according to intenstity\nvec4 getColor(float intensity) {\n // makes the volume looks brighter;\n intensity = min(0.26, intensity) / 0.26;\n vec2 _uv = vec2(intensity, 0);\n vec4 color = sampleTexture2D(m_uPlatteTexture, _uv);\n float alpha = intensity;\n if (alpha < 0.03)\n {\n alpha = 0.02;\n }\n\n return vec4(color.r, color.g, color.b, alpha); \n}\n\n// take the 3 layers above and 3 layers blow to get the final intensity.\nvec4 sampleAs3DTexture(vec3 texCoord) {\n texCoord += vec3(0.5);\n vec4 heightSlice1;\n vec4 heightSlice2;\n vec4 colorSlice1;\n vec4 colorSlice2;\n vec2 texCoordSlice1;\n vec2 texCoordSlice2;\n\n // The z coordinate determines which Z slice we have to look for.\n // Z slice number goes from 0 to 255.\n float z = clamp(texCoord.z, 0.0, 0.99);\n\n float sliceNumber = floor(z * m_uLayers);\n\n float top = min(m_uSampleNumber + sliceNumber + 1.0, m_uLayers - 1.0);\n float bottom = max(sliceNumber - m_uSampleNumber, 0.0);\n\n float totalSamples = 0.0;\n\n texCoord.y = 1.0 - texCoord.y;\n texCoord.xy /= m_uGridSize;\n\n float intensity = 0.0;\n float sampleWeight;\n int i;\n#if WEBGL2\n for (i = int(bottom); i <= int(top); i++)\n {\n#else\n for (int j = 0; j < 256; j++)\n {\n i = int(bottom) + j;\n if (i > int(top))\n {\n break;\n }\n#endif\n vec2 texCoordSlice = texCoord.xy;\n texCoordSlice.x += (mod(float(i), m_uGridSize.x) / m_uGridSize.x);\n texCoordSlice.y += floor(float(i) / m_uGridSize.x) / m_uGridSize.y;\n\n float tempIntensity = sampleTexture2D(m_uDensityTexture, texCoordSlice).x;\n sampleWeight = (m_uSampleNumber + 1.0) - abs(z * m_uLayers - (float(i)));\n intensity += sampleWeight * tempIntensity;\n totalSamples += sampleWeight;\n }\n\n if (totalSamples != 0.0)\n {\n intensity /= totalSamples; \n } \n\n return getColor(intensity);\n}\n\n\n // axis aligned box centered at the origin, with size boxSize\nvec2 boxIntersection(vec3 ro, vec3 rd) \n{\n vec3 m = 1.0 / rd; // could precompute if traversing a big set of algined boxes\n vec3 n = m * ro; // could precompute if traversing a big set of algined boxes\n vec3 k = abs(m) * 0.5;\n \n vec3 t1 = -n - k;\n vec3 t2 = -n + k;\n\n float tN = max(max(t1.x, t1.y), t1.z);\n float tF = min(min(t2.x, t2.y), t2.z);\n \n if( tN > tF || tF < 0.0) return vec2(-1.0); // no intersection\n\n return vec2(tN, tF);\n}\n\nvec3 shade(in vec3 diffuse, in vec3 specular, in float roughness, inout float transparent, in vec3 P, in vec3 N, in vec3 V, out vec4 secondColor)\n{\n vec2 texc = vec2(gl_FragCoord.x * m_uInvResolution.x,\n gl_FragCoord.y * m_uInvResolution.y);\n\n // Transform to model space.\n vec3 frontPos = (m_uInvTransform * vec4(P.x, P.y, P.z, 1.0)).xyz;\n vec3 cameraPos = (m_uInvTransform * vec4(m_uPerFrame.cameraPosition.xyz, 1.0)).xyz;\n vec3 rayDir = normalize((m_uInvTransform * vec4(V.xyz, 0.0)).xyz);\n vec3 backPos = frontPos;\n vec2 t = boxIntersection(cameraPos, rayDir);\n \n if (t.x > -1.0 && t.y > -1.0)\n {\n backPos = cameraPos + rayDir * t.y;\n }\n\n float rayLength = length(backPos - frontPos);\n\n int steps = int(max(1.0, floor(rayLength / STEP)));\n\n // Calculate how long to increment in each step.\n float delta = rayLength / float(steps);\n\n // The increment in each direction for each step.\n vec3 deltaDirection = rayDir * delta;\n\n // Start the ray casting from the front position.\n vec3 currentPosition = frontPos;\n\n // The color accumulator.\n vec4 accumulatedColor = vec4(0.0);\n\n // The alpha value accumulated so far.\n float accumulatedAlpha = 0.0;\n\n vec4 colorSample;\n float alphaSample;\n\n // Perform the ray marching iterations\n \n#if WEBGL2\n for (int i = 0; i < steps; i++)\n {\n#else\n for (int i = 0; i < 256; i++) \n {\n if (i >= steps)\n {\n break;\n }\n#endif\n colorSample = sampleAs3DTexture(currentPosition);\n\n alphaSample = colorSample.a * m_uAlphaCorrection;\n\n alphaSample *= (1.0 - accumulatedAlpha);\n\n // Perform the composition.\n accumulatedColor += colorSample * alphaSample;\n\n // Store the alpha accumulated so far.\n accumulatedAlpha += alphaSample;\n\n // Advance the ray.\n currentPosition += deltaDirection;\n }\n\n transparent = accumulatedAlpha;\n\n return accumulatedColor.xyz;\n}\n","tile_limit_rectangle.inc":"#if TILE_LIMIT_RECTANGLE\n if (m_vTexCoord.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < m_vTexCoord.x ||\n m_vTexCoord.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < m_vTexCoord.y)\n {\n discard;\n }\n#endif","transform_barchart.inc":"uniform sampler2D m_uData;\nuniform ivec2 m_uRes;\nuniform float m_uThickness;\nuniform sampler2D m_uPlatte;\n \nconst vec2 offsets[4] = vec2[](vec2(-1, -1), vec2(1, -1), vec2(-1, 1), vec2(1, 1));\nconst int columns[6] = int[](0, 0, 1, 1, 2, 2);\nconst float signs[6] = float[](-1.0, 1.0, -1.0, 1.0, -1.0, 1.0);\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n float height = textureLod(m_uData, (position.xy + 1.0) * 0.5, 0.0).r;\n \n float xSize = m_uThickness / float(m_uRes.x); // The field size is now 2x2.\n float ySize = m_uThickness / float(m_uRes.y);\n int vertexId = gl_VertexID % 24;\n\n int faceIndex = vertexId / 4;\n int vertIndex = vertexId % 4;\n\n int c0 = columns[faceIndex];\n int c1 = (c0 + 1) % 3;\n int c2 = (c0 + 2) % 3;\n\n float stretch[3];\n stretch[c0] = signs[faceIndex];\n stretch[c1] = offsets[vertIndex][0];\n stretch[c2] = offsets[vertIndex][1];\n\n position.x += stretch[0] * xSize;\n position.y += stretch[1] * ySize;\n // FIXME: The height scaling.\n position.z += (stretch[2] + 1.0) * 0.5 * height;\n\n#if MODEL_TRANSFORM\n position = m_uPerNode.modelMatrix * position;\n normal = m_uPerNode.modelMatrix * normal;\n#endif\n\n m_vColor = textureLod(m_uPlatte, vec2(height, 0.0), 0.0);\n\n worldPosition = position;\n position = m_uPerFrame.vpMatrix * position;\n}\n","transform_barchart_wireframe.inc":"uniform sampler2D m_uData;\nuniform ivec2 m_uRes;\nuniform float m_uThickness;\n \nconst vec2 offsets[4] = vec2[](vec2(1, -1), vec2(1, 1), vec2(-1, 1), vec2(-1, -1));\nconst float signs[2] = float[](0.0, 1.0);\n\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n float height = textureLod(m_uData, (position.xy + 1.0) * 0.5, 0.0).r;\n \n float xSize = m_uThickness / float(m_uRes.x); // The field size is now 1x1.\n float ySize = m_uThickness / float(m_uRes.y);\n int vertexId = gl_VertexID % 8;\n\n int heightIndex = vertexId / 4;\n int vertIndex = vertexId % 4;\n\n float stretch[3];\n stretch[0] = offsets[vertIndex][0];\n stretch[1] = offsets[vertIndex][1];\n stretch[2] = signs[heightIndex];\n\n position.x += 1.005 * stretch[0] * xSize; // Multiply 1.005 to avoid z-fighting with bar surfaces.\n position.y += 1.005 * stretch[1] * ySize;\n position.z += 1.005 * stretch[2] * height;\n\n#if MODEL_TRANSFORM\n position = m_uPerNode.modelMatrix * position;\n normal = m_uPerNode.modelMatrix * normal;\n#endif\n\n worldPosition = position;\n position = m_uPerFrame.vpMatrix * position;\n}\n","transform_heightmap.inc":"uniform sampler2D m_uData;\nuniform sampler2D m_uPlatte;\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n#if WEBGL2\n float height = texture(m_uData, uv.xy).x;\n#else\n float height = texture2DLod(m_uData, uv.xy, 0.0).a;\n#endif\n position.z = height;\n\n#if MODEL_TRANSFORM\n position = m_uPerNode.modelMatrix * position;\n normal = m_uPerNode.modelMatrix * normal;\n#endif\n\n#if WEBGL2\n m_vColor = textureLod(m_uPlatte, vec2(height, 0.0), 0.0);\n#else\n m_vColor = texture2DLod(m_uPlatte, vec2(height, 0.0), 0.0);\n#endif\n position = m_uPerFrame.vpMatrix * position;\n}\n","transform_mark.inc":"\nvoid transform(inout vec4 position, inout vec4 normal, inout vec3 uv, out vec4 worldPosition)\n{\n#if MODEL_TRANSFORM\n position = m_uPerNode.modelMatrix * position;\n#endif\n \n position = m_uPerFrame.vpMatrix * position;\n}\n"},n=i,a=function(){function e(e,t,r,i){this.name=e,this.ready=!1;var a,o,s="";if(Array.isArray(t))for(a=0,o=t.length;a<o;++a)n[t[a]]?s+=n[t[a]]:s+=t[a];else n[t]?s+=n[t]:s+=t;var l="";if(Array.isArray(r))for(a=0,o=r.length;a<o;++a)n[r[a]]?l+=n[r[a]]:l+=r[a];else n[r]?l+=n[r]:l+=r;this._precompile(s,l,i)}return e.prototype.destroy=function(){this.ready&&(this.vsSource=null,this.fsSource=null,this.ready=!1)},e.prototype._precompile=function(e,t,r){if(!this.ready){try{this.vsSource=this._dissolve(e,!0,r),this.fsSource=this._dissolve(t,!1,r)}catch(e){return void console.warn(e)}this.ready=!0}},e.prototype._dissolve=function(e,t,r){var i="";i+="#if WEBGL2 \n#version 300 es \n#endif \n",r.highPrecision?i+="precision highp float;\nprecision highp sampler2D;\n":i+="precision mediump float;\nprecision mediump sampler2D;\n",t?((r.viewMatrix||r.vpMatrix||r.projectionMatrix||r.mvpMatrix)&&(i+="#if WEBGL2 \nuniform m_bPerFrame { \n    mat4 viewMatrix;\n    mat4 vpMatrix;\n    vec4 cameraPosition;\n} m_uPerFrame; \n#else \nstruct PerFrameStruct {\n",r.viewMatrix&&(i+="    mat4 viewMatrix;\n"),r.vpMatrix&&(i+="    mat4 vpMatrix;\n"),i+="    vec4 cameraPosition;\n};\nuniform PerFrameStruct m_uPerFrame; \n#endif \n"),r.modelMatrix&&(i+="#if WEBGL2 && MODEL_TRANSFORM\nuniform m_bPerNode { \n    mat4 modelMatrix;\n    mat4 normalMatrix;\n} m_uPerNode; \n#endif\n#if !WEBGL2 && MODEL_TRANSFORM\nstruct PerNodeStruct {\n    mat4 modelMatrix;\n    mat4 normalMatrix;\n};\nuniform PerNodeStruct m_uPerNode;\n#endif\n"),r.vertexid&&(i+="uniform int m_uBaseVertexOffset; \n")):(r.viewMatrix||r.vpMatrix||r.projectionMatrix||r.mvpMatrix)&&(i+="#if WEBGL2 \nuniform m_bPerFrame { \n    mat4 viewMatrix;\n    mat4 vpMatrix;\n    vec4 cameraPosition;\n} m_uPerFrame; \n#else \nstruct PerFrameStruct {\n",r.viewMatrix&&(i+="    mat4 viewMatrix;\n"),r.vpMatrix&&(i+="    mat4 vpMatrix;\n"),i+="    vec4 cameraPosition;\n};\nuniform PerFrameStruct m_uPerFrame; \n#endif \n");for(var a="",o=e.split("\n"),s=/<([\w\d\.]+)>/g,l=0,u=o.length;l<u;l++){var c=o[l];if(c.match(/#include/g)){var h=c.match(s);if(h){var d=h[0].substring(1,h[0].length-1);"varying.inc"===d?(t&&r.normal&&(a+="    m_vNormal = normal.xyz; \n"),t&&r.position&&(a+="    m_vVertex = worldPosition.xyz; \n"),t&&r.uv&&(a+="    m_vTexCoord = uv; \n"),t&&r.vertexid&&(a+="    int objectID = gl_VertexID + m_uBaseVertexOffset; \n",a+="    m_vId = vec4( \n",a+="    float(objectID & 0xFF) / 255.0,  \n",a+="    float((objectID >> 8) & 0xFF) / 255.0,  \n",a+="    float((objectID >> 16) & 0xFF) / 255.0,  \n",a+="    float((objectID >> 24) & 0xFF) / 255.0); \n"),t&&r.color&&(a+="    m_vColor = m_aColor; \n"),t&&r.material&&(a+="    m_vMaterial = m_aMaterial;\n"),t&&r.depth&&(a+="m_vDepth = (m_uPerFrame.viewMatrix * worldPosition).z;\n")):a+=n[d]}}else a+=c+"\n"}return s=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,i+(a=a.replace(s,function(e,t,r,i){for(var n="",a=parseInt(t);a<parseInt(r);a++)n+=i.replace(/\[i\]/g,"["+a+"]");return n}))},e}();t.a=a},function(e,t,r){"use strict";var i=new(function(){function e(){this.degree=Math.PI/180,this.EPSILON=1e-6,this.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,this.RANDOM=Math.random,this.ENABLE_SIMD=!1,this.SIMD_AVAILABLE=this.ARRAY_TYPE===Float32Array&&"SIMD"in this,this.USE_SIMD=this.ENABLE_SIMD&&this.SIMD_AVAILABLE}return e.prototype.setMatrixArrayType=function(e){this.ARRAY_TYPE=e},e.prototype.toRadian=function(e){return e*this.degree},e}());t.a=i},function(e,t,r){"use strict";var i=r(5),n=r(7),a=r(69),o=r(110),s=r.n(o).a,l=r(10);!function(e){function t(t,r){var i=e.call(this,t)||this;return i.link=r,i}Object(i.c)(t,e)}(Error);function u(e){return e.request.length<=1}function c(e){return new s(function(t){t.error(e)})}function h(e,t){var r=Object(i.a)({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){r="function"==typeof e?Object(i.a)({},r,e(r)):Object(i.a)({},r,e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return Object(i.a)({},r)}}),Object.defineProperty(t,"toKey",{enumerable:!1,value:function(){return function(e){var t=e.query,r=e.variables,i=e.operationName;return JSON.stringify([i,t,r])}(t)}}),t}function d(e,t){return t?t(e):s.of()}function p(e){return"function"==typeof e?new v(e):e}function f(){return new v(function(){return s.of()})}function _(e){return 0===e.length?f():e.map(p).reduce(function(e,t){return e.concat(t)})}function m(e,t,r){var i=p(t),n=p(r||new v(d));return u(i)&&u(n)?new v(function(t){return e(t)?i.request(t)||s.of():n.request(t)||s.of()}):new v(function(t,r){return e(t)?i.request(t,r)||s.of():n.request(t,r)||s.of()})}var v=function(){function e(e){e&&(this.request=e)}return e.prototype.split=function(t,r,i){return this.concat(m(t,r,i||new e(d)))},e.prototype.concat=function(e){return function(e,t){var r=p(e);if(u(r))return r;var i=p(t);return u(i)?new v(function(e){return r.request(e,function(e){return i.request(e)||s.of()})||s.of()}):new v(function(e,t){return r.request(e,function(e){return i.request(e,t)||s.of()})||s.of()})}(this,e)},e.prototype.request=function(e,t){throw new l.a(1)},e.empty=f,e.from=_,e.split=m,e.execute=y,e}();function y(e,t){return e.request(h(t.context,function(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?Object(n.n)(t.query):""),t}(function(e){for(var t=["query","operationName","variables","extensions","context"],r=0,i=Object.keys(e);r<i.length;r++){var n=i[r];if(t.indexOf(n)<0)throw new l.a(2)}return e}(t))))||s.of()}var g,b=r(109),w=r(35);function x(e){return e<7}!function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(g||(g={}));var M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype[b.a]=function(){return this},t.prototype["@@observable"]=function(){return this},t}(s);function E(e){return Array.isArray(e)&&e.length>0}var T,S=function(e){var t="";return E(e.graphQLErrors)&&e.graphQLErrors.forEach(function(e){var r=e?e.message:"Error message not found.";t+="GraphQL error: "+r+"\n"}),e.networkError&&(t+="Network error: "+e.networkError.message+"\n"),t=t.replace(/\n$/,"")},A=function(e){function t(r){var i=r.graphQLErrors,n=r.networkError,a=r.errorMessage,o=r.extraInfo,s=e.call(this,a)||this;return s.graphQLErrors=i||[],s.networkError=n||null,s.message=a||S(s),s.extraInfo=o,s.__proto__=t.prototype,s}return Object(i.c)(t,e),t}(Error);!function(e){e[e.normal=1]="normal",e[e.refetch=2]="refetch",e[e.poll=3]="poll"}(T||(T={}));var P=function(e){function t(t){var r=t.queryManager,i=t.options,a=t.shouldSubscribe,o=void 0===a||a,s=e.call(this,function(e){return s.onSubscribe(e)})||this;s.observers=new Set,s.subscriptions=new Set,s.isTornDown=!1,s.options=i,s.variables=i.variables||{},s.queryId=r.generateQueryId(),s.shouldSubscribe=o;var l=Object(n.m)(i.query);return s.queryName=l&&l.name&&l.name.value,s.queryManager=r,s}return Object(i.c)(t,e),t.prototype.result=function(){var e=this;return new Promise(function(t,r){var i={next:function(r){t(r),e.observers.delete(i),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout(function(){n.unsubscribe()},0)},error:r},n=e.subscribe(i)})},t.prototype.currentResult=function(){var e=this.getCurrentResult();return void 0===e.data&&(e.data={}),e},t.prototype.getCurrentResult=function(){if(this.isTornDown){var e=this.lastResult;return{data:!this.lastError&&e&&e.data||void 0,error:this.lastError,loading:!1,networkStatus:g.error}}var t,r=this.queryManager.getCurrentQueryResult(this),n=r.data,a=r.partial,o=this.queryManager.queryStore.get(this.queryId),s=this.options.fetchPolicy,l="network-only"===s||"no-cache"===s;if(o){var u=o.networkStatus;if(function(e,t){return void 0===t&&(t="none"),e&&(e.networkError||"none"===t&&E(e.graphQLErrors))}(o,this.options.errorPolicy))return{data:void 0,loading:!1,networkStatus:u,error:new A({graphQLErrors:o.graphQLErrors,networkError:o.networkError})};o.variables&&(this.options.variables=Object(i.a)(Object(i.a)({},this.options.variables),o.variables),this.variables=this.options.variables),t={data:n,loading:x(u),networkStatus:u},o.graphQLErrors&&"all"===this.options.errorPolicy&&(t.errors=o.graphQLErrors)}else{var c=l||a&&"cache-only"!==s;t={data:n,loading:c,networkStatus:c?g.loading:g.ready}}return a||this.updateLastResult(Object(i.a)(Object(i.a)({},t),{stale:!1})),Object(i.a)(Object(i.a)({},t),{partial:a})},t.prototype.isDifferentFromLastResult=function(e){var t=this.lastResultSnapshot;return!(t&&e&&t.networkStatus===e.networkStatus&&t.stale===e.stale&&Object(a.a)(t.data,e.data))},t.prototype.getLastResult=function(){return this.lastResult},t.prototype.getLastError=function(){return this.lastError},t.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastResultSnapshot,delete this.lastError,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){var e=this.queryManager.queryStore.get(this.queryId);e&&(e.networkError=null,e.graphQLErrors=[])},t.prototype.refetch=function(e){var t=this.options.fetchPolicy;return"cache-only"===t?Promise.reject(new l.a(1)):("no-cache"!==t&&"cache-and-network"!==t&&(t="network-only"),Object(a.a)(this.variables,e)||(this.variables=Object(i.a)(Object(i.a)({},this.variables),e)),Object(a.a)(this.options.variables,this.variables)||(this.options.variables=Object(i.a)(Object(i.a)({},this.options.variables),this.variables)),this.queryManager.fetchQuery(this.queryId,Object(i.a)(Object(i.a)({},this.options),{fetchPolicy:t}),T.refetch))},t.prototype.fetchMore=function(e){var t=this;Object(l.b)(e.updateQuery,2);var r=Object(i.a)(Object(i.a)({},e.query?e:Object(i.a)(Object(i.a)(Object(i.a)({},this.options),e),{variables:Object(i.a)(Object(i.a)({},this.variables),e.variables)})),{fetchPolicy:"network-only"}),n=this.queryManager.generateQueryId();return this.queryManager.fetchQuery(n,r,T.normal,this.queryId).then(function(i){return t.updateQuery(function(t){return e.updateQuery(t,{fetchMoreResult:i.data,variables:r.variables})}),t.queryManager.stopQuery(n),i},function(e){throw t.queryManager.stopQuery(n),e})},t.prototype.subscribeToMore=function(e){var t=this,r=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables}).subscribe({next:function(r){var i=e.updateQuery;i&&t.updateQuery(function(e,t){var n=t.variables;return i(e,{subscriptionData:r,variables:n})})},error:function(t){e.onError&&e.onError(t)}});return this.subscriptions.add(r),function(){t.subscriptions.delete(r)&&r.unsubscribe()}},t.prototype.setOptions=function(e){var t=this.options.fetchPolicy;this.options=Object(i.a)(Object(i.a)({},this.options),e),e.pollInterval?this.startPolling(e.pollInterval):0===e.pollInterval&&this.stopPolling();var r=e.fetchPolicy;return this.setVariables(this.options.variables,t!==r&&("cache-only"===t||"standby"===t||"network-only"===r),e.fetchResults)},t.prototype.setVariables=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),this.isTornDown=!1,e=e||this.variables,!t&&Object(a.a)(e,this.variables)?this.observers.size&&r?this.result():Promise.resolve():(this.variables=this.options.variables=e,this.observers.size?this.queryManager.fetchQuery(this.queryId,this.options):Promise.resolve())},t.prototype.updateQuery=function(e){var t=this.queryManager,r=t.getQueryWithPreviousResult(this.queryId),i=r.previousResult,a=r.variables,o=r.document,s=Object(n.I)(function(){return e(i,{variables:a})});s&&(t.dataStore.markUpdateQueryResult(o,a,s),t.broadcastQueries())},t.prototype.stopPolling=function(){this.queryManager.stopPollingQuery(this.queryId),this.options.pollInterval=void 0},t.prototype.startPolling=function(e){D(this),this.options.pollInterval=e,this.queryManager.startPollingQuery(this.options,this.queryId)},t.prototype.updateLastResult=function(e){var t=this.lastResult;return this.lastResult=e,this.lastResultSnapshot=this.queryManager.assumeImmutableResults?e:Object(n.f)(e),t},t.prototype.onSubscribe=function(e){var t=this;try{var r=e._subscription._observer;r&&!r.error&&(r.error=k)}catch(e){}var i=!this.observers.size;return this.observers.add(e),e.next&&this.lastResult&&e.next(this.lastResult),e.error&&this.lastError&&e.error(this.lastError),i&&this.setUpQuery(),function(){t.observers.delete(e)&&!t.observers.size&&t.tearDownQuery()}},t.prototype.setUpQuery=function(){var e=this,t=this.queryManager,r=this.queryId;this.shouldSubscribe&&t.addObservableQuery(r,this),this.options.pollInterval&&(D(this),t.startPollingQuery(this.options,r));var n=function(t){e.updateLastResult(Object(i.a)(Object(i.a)({},e.lastResult),{errors:t.graphQLErrors,networkStatus:g.error,loading:!1})),O(e.observers,"error",e.lastError=t)};t.observeQuery(r,this.options,{next:function(r){if(e.lastError||e.isDifferentFromLastResult(r)){var i=e.updateLastResult(r),n=e.options,o=n.query,s=n.variables,l=n.fetchPolicy;t.transform(o).hasClientExports?t.getLocalState().addExportedVariables(o,s).then(function(n){var s=e.variables;e.variables=e.options.variables=n,!r.loading&&i&&"cache-only"!==l&&t.transform(o).serverQuery&&!Object(a.a)(s,n)?e.refetch():O(e.observers,"next",r)}):O(e.observers,"next",r)}},error:n}).catch(n)},t.prototype.tearDownQuery=function(){var e=this.queryManager;this.isTornDown=!0,e.stopPollingQuery(this.queryId),this.subscriptions.forEach(function(e){return e.unsubscribe()}),this.subscriptions.clear(),e.removeObservableQuery(this.queryId),e.stopQuery(this.queryId),this.observers.clear()},t}(M);function k(e){}function O(e,t,r){var i=[];e.forEach(function(e){return e[t]&&i.push(e)}),i.forEach(function(e){return e[t](r)})}function D(e){var t=e.options.fetchPolicy;Object(l.b)("cache-first"!==t&&"cache-only"!==t,3)}var N=function(){function e(){this.store={}}return e.prototype.getStore=function(){return this.store},e.prototype.get=function(e){return this.store[e]},e.prototype.initMutation=function(e,t,r){this.store[e]={mutation:t,variables:r||{},loading:!0,error:null}},e.prototype.markMutationError=function(e,t){var r=this.store[e];r&&(r.loading=!1,r.error=t)},e.prototype.markMutationResult=function(e){var t=this.store[e];t&&(t.loading=!1,t.error=null)},e.prototype.reset=function(){this.store={}},e}(),C=function(){function e(){this.store={}}return e.prototype.getStore=function(){return this.store},e.prototype.get=function(e){return this.store[e]},e.prototype.initQuery=function(e){var t=this.store[e.queryId];Object(l.b)(!t||t.document===e.document||Object(a.a)(t.document,e.document),19);var r,i=!1,n=null;e.storePreviousVariables&&t&&t.networkStatus!==g.loading&&(Object(a.a)(t.variables,e.variables)||(i=!0,n=t.variables)),r=i?g.setVariables:e.isPoll?g.poll:e.isRefetch?g.refetch:g.loading;var o=[];t&&t.graphQLErrors&&(o=t.graphQLErrors),this.store[e.queryId]={document:e.document,variables:e.variables,previousVariables:n,networkError:null,graphQLErrors:o,networkStatus:r,metadata:e.metadata},"string"==typeof e.fetchMoreForQueryId&&this.store[e.fetchMoreForQueryId]&&(this.store[e.fetchMoreForQueryId].networkStatus=g.fetchMore)},e.prototype.markQueryResult=function(e,t,r){this.store&&this.store[e]&&(this.store[e].networkError=null,this.store[e].graphQLErrors=E(t.errors)?t.errors:[],this.store[e].previousVariables=null,this.store[e].networkStatus=g.ready,"string"==typeof r&&this.store[r]&&(this.store[r].networkStatus=g.ready))},e.prototype.markQueryError=function(e,t,r){this.store&&this.store[e]&&(this.store[e].networkError=t,this.store[e].networkStatus=g.error,"string"==typeof r&&this.markQueryResultClient(r,!0))},e.prototype.markQueryResultClient=function(e,t){var r=this.store&&this.store[e];r&&(r.networkError=null,r.previousVariables=null,t&&(r.networkStatus=g.ready))},e.prototype.stopQuery=function(e){delete this.store[e]},e.prototype.reset=function(e){var t=this;Object.keys(this.store).forEach(function(r){e.indexOf(r)<0?t.stopQuery(r):t.store[r].networkStatus=g.loading})},e}();var I=function(){function e(e){var t=e.cache,r=e.client,i=e.resolvers,n=e.fragmentMatcher;this.cache=t,r&&(this.client=r),i&&this.addResolvers(i),n&&this.setFragmentMatcher(n)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach(function(e){t.resolvers=Object(n.A)(t.resolvers,e)}):this.resolvers=Object(n.A)(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){var t=e.document,r=e.remoteResult,n=e.context,a=e.variables,o=e.onlyRunForcedResolvers,s=void 0!==o&&o;return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(e){return t?[2,this.resolveDocument(t,r.data,n,a,this.fragmentMatcher,s).then(function(e){return Object(i.a)(Object(i.a)({},r),{data:e.result})})]:[2,r]})})},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return Object(n.s)(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return this.resolvers?Object(n.C)(e):e},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.cache;return Object(i.a)(Object(i.a)({},e),{cache:t,getCacheKey:function(e){if(t.config)return t.config.dataIdFromObject(e);Object(l.b)(!1,6)}})},e.prototype.addExportedVariables=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(n){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(r),t).then(function(e){return Object(i.a)(Object(i.a)({},t),e.exportedVariables)})]:[2,Object(i.a)({},t)]})})},e.prototype.shouldForceResolvers=function(e){var t=!1;return Object(w.visit)(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some(function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value})))return w.BREAK}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:Object(n.d)(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t,r,a,o,s){return void 0===r&&(r={}),void 0===a&&(a={}),void 0===o&&(o=function(){return!0}),void 0===s&&(s=!1),Object(i.b)(this,void 0,void 0,function(){var l,u,c,h,d,p,f,_,m;return Object(i.d)(this,function(v){return l=Object(n.l)(e),u=Object(n.j)(e),c=Object(n.g)(u),h=l.operation,d=h?function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(h):"Query",f=(p=this).cache,_=p.client,m={fragmentMap:c,context:Object(i.a)(Object(i.a)({},r),{cache:f,client:_}),variables:a,fragmentMatcher:o,defaultOperationType:d,exportedVariables:{},onlyRunForcedResolvers:s},[2,this.resolveSelectionSet(l.selectionSet,t,m).then(function(e){return{result:e,exportedVariables:m.exportedVariables}})]})})},e.prototype.resolveSelectionSet=function(e,t,r){return Object(i.b)(this,void 0,void 0,function(){var a,o,s,u,c,h=this;return Object(i.d)(this,function(d){return a=r.fragmentMap,o=r.context,s=r.variables,u=[t],c=function(e){return Object(i.b)(h,void 0,void 0,function(){var c,h;return Object(i.d)(this,function(i){return Object(n.F)(e,s)?Object(n.t)(e)?[2,this.resolveField(e,t,r).then(function(t){var r;void 0!==t&&u.push(((r={})[Object(n.E)(e)]=t,r))})]:(Object(n.v)(e)?c=e:(c=a[e.name.value],Object(l.b)(c,7)),c&&c.typeCondition&&(h=c.typeCondition.name.value,r.fragmentMatcher(t,h,o))?[2,this.resolveSelectionSet(c.selectionSet,t,r).then(function(e){u.push(e)})]:[2]):[2]})})},[2,Promise.all(e.selections.map(c)).then(function(){return Object(n.B)(u)})]})})},e.prototype.resolveField=function(e,t,r){return Object(i.b)(this,void 0,void 0,function(){var a,o,s,l,u,c,h,d,p,f=this;return Object(i.d)(this,function(i){return a=r.variables,o=e.name.value,s=Object(n.E)(e),l=o!==s,u=t[s]||t[o],c=Promise.resolve(u),r.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(h=t.__typename||r.defaultOperationType,(d=this.resolvers&&this.resolvers[h])&&(p=d[l?o:s])&&(c=Promise.resolve(p(t,Object(n.b)(e,a),r.context,{field:e,fragmentMap:r.fragmentMap})))),[2,c.then(function(t){return void 0===t&&(t=u),e.directives&&e.directives.forEach(function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach(function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(r.exportedVariables[e.value.value]=t)})}),e.selectionSet?null==t?t:Array.isArray(t)?f.resolveSubSelectedArray(e,t,r):e.selectionSet?f.resolveSelectionSet(e.selectionSet,t,r):void 0:t})]})})},e.prototype.resolveSubSelectedArray=function(e,t,r){var i=this;return Promise.all(t.map(function(t){return null===t?null:Array.isArray(t)?i.resolveSubSelectedArray(e,t,r):e.selectionSet?i.resolveSelectionSet(e.selectionSet,t,r):void 0}))},e}();function R(e){var t=new Set,r=null;return new M(function(i){return t.add(i),r=r||e.subscribe({next:function(e){t.forEach(function(t){return t.next&&t.next(e)})},error:function(e){t.forEach(function(t){return t.error&&t.error(e)})},complete:function(){t.forEach(function(e){return e.complete&&e.complete()})}}),function(){t.delete(i)&&!t.size&&r&&(r.unsubscribe(),r=null)}})}var B=Object.prototype.hasOwnProperty,L=function(){function e(e){var t=e.link,r=e.queryDeduplication,i=void 0!==r&&r,a=e.store,o=e.onBroadcast,s=void 0===o?function(){}:o,l=e.ssrMode,u=void 0!==l&&l,c=e.clientAwareness,h=void 0===c?{}:c,d=e.localState,p=e.assumeImmutableResults;this.mutationStore=new N,this.queryStore=new C,this.clientAwareness={},this.idCounter=1,this.queries=new Map,this.fetchQueryRejectFns=new Map,this.transformCache=new(n.e?WeakMap:Map),this.inFlightLinkObservables=new Map,this.pollingInfoByQueryId=new Map,this.link=t,this.queryDeduplication=i,this.dataStore=a,this.onBroadcast=s,this.clientAwareness=h,this.localState=d||new I({cache:a.getCache()}),this.ssrMode=u,this.assumeImmutableResults=!!p}return e.prototype.stop=function(){var e=this;this.queries.forEach(function(t,r){e.stopQueryNoBroadcast(r)}),this.fetchQueryRejectFns.forEach(function(e){e(new l.a(8))})},e.prototype.mutate=function(e){var t=e.mutation,r=e.variables,a=e.optimisticResponse,o=e.updateQueries,s=e.refetchQueries,u=void 0===s?[]:s,c=e.awaitRefetchQueries,h=void 0!==c&&c,d=e.update,p=e.errorPolicy,f=void 0===p?"none":p,_=e.fetchPolicy,m=e.context,v=void 0===m?{}:m;return Object(i.b)(this,void 0,void 0,function(){var e,s,c,p=this;return Object(i.d)(this,function(m){switch(m.label){case 0:return Object(l.b)(t,9),Object(l.b)(!_||"no-cache"===_,10),e=this.generateQueryId(),t=this.transform(t).document,this.setQuery(e,function(){return{document:t}}),r=this.getVariables(t,r),this.transform(t).hasClientExports?[4,this.localState.addExportedVariables(t,r,v)]:[3,2];case 1:r=m.sent(),m.label=2;case 2:return s=function(){var e={};return o&&p.queries.forEach(function(t,r){var i=t.observableQuery;if(i){var n=i.queryName;n&&B.call(o,n)&&(e[r]={updater:o[n],query:p.queryStore.get(r)})}}),e},this.mutationStore.initMutation(e,t,r),this.dataStore.markMutationInit({mutationId:e,document:t,variables:r,updateQueries:s(),update:d,optimisticResponse:a}),this.broadcastQueries(),c=this,[2,new Promise(function(o,l){var p,m;c.getObservableFromLink(t,Object(i.a)(Object(i.a)({},v),{optimisticResponse:a}),r,!1).subscribe({next:function(i){Object(n.q)(i)&&"none"===f?m=new A({graphQLErrors:i.errors}):(c.mutationStore.markMutationResult(e),"no-cache"!==_&&c.dataStore.markMutationResult({mutationId:e,result:i,document:t,variables:r,updateQueries:s(),update:d}),p=i)},error:function(t){c.mutationStore.markMutationError(e,t),c.dataStore.markMutationComplete({mutationId:e,optimisticResponse:a}),c.broadcastQueries(),c.setQuery(e,function(){return{document:null}}),l(new A({networkError:t}))},complete:function(){if(m&&c.mutationStore.markMutationError(e,m),c.dataStore.markMutationComplete({mutationId:e,optimisticResponse:a}),c.broadcastQueries(),m)l(m);else{"function"==typeof u&&(u=u(p));var t=[];E(u)&&u.forEach(function(e){if("string"==typeof e)c.queries.forEach(function(r){var i=r.observableQuery;i&&i.queryName===e&&t.push(i.refetch())});else{var r={query:e.query,variables:e.variables,fetchPolicy:"network-only"};e.context&&(r.context=e.context),t.push(c.query(r))}}),Promise.all(h?t:[]).then(function(){c.setQuery(e,function(){return{document:null}}),"ignore"===f&&p&&Object(n.q)(p)&&delete p.errors,o(p)})}}})})]}})})},e.prototype.fetchQuery=function(e,t,r,a){return Object(i.b)(this,void 0,void 0,function(){var o,s,l,u,c,h,d,p,f,_,m,v,y,g,b,w,x,M,E=this;return Object(i.d)(this,function(S){switch(S.label){case 0:return o=t.metadata,s=void 0===o?null:o,l=t.fetchPolicy,u=void 0===l?"cache-first":l,c=t.context,h=void 0===c?{}:c,d=this.transform(t.query).document,p=this.getVariables(d,t.variables),this.transform(d).hasClientExports?[4,this.localState.addExportedVariables(d,p,h)]:[3,2];case 1:p=S.sent(),S.label=2;case 2:if(t=Object(i.a)(Object(i.a)({},t),{variables:p}),m=_="network-only"===u||"no-cache"===u,_||(v=this.dataStore.getCache().diff({query:d,variables:p,returnPartialData:!0,optimistic:!1}),y=v.complete,g=v.result,m=!y||"cache-and-network"===u,f=g),b=m&&"cache-only"!==u&&"standby"!==u,Object(n.s)(["live"],d)&&(b=!0),w=this.idCounter++,x="no-cache"!==u?this.updateQueryWatch(e,d,t):void 0,this.setQuery(e,function(){return{document:d,lastRequestId:w,invalidated:!0,cancel:x}}),this.invalidate(a),this.queryStore.initQuery({queryId:e,document:d,storePreviousVariables:b,variables:p,isPoll:r===T.poll,isRefetch:r===T.refetch,metadata:s,fetchMoreForQueryId:a}),this.broadcastQueries(),b){if(M=this.fetchRequest({requestId:w,queryId:e,document:d,options:t,fetchMoreForQueryId:a}).catch(function(t){throw function(e){return e.hasOwnProperty("graphQLErrors")}(t)?t:(w>=E.getQuery(e).lastRequestId&&(E.queryStore.markQueryError(e,t,a),E.invalidate(e),E.invalidate(a),E.broadcastQueries()),new A({networkError:t}))}),"cache-and-network"!==u)return[2,M];M.catch(function(){})}return this.queryStore.markQueryResultClient(e,!b),this.invalidate(e),this.invalidate(a),this.transform(d).hasForcedResolvers?[2,this.localState.runResolvers({document:d,remoteResult:{data:f},context:h,variables:p,onlyRunForcedResolvers:!0}).then(function(r){return E.markQueryResult(e,r,t,a),E.broadcastQueries(),r})]:(this.broadcastQueries(),[2,{data:f}])}})})},e.prototype.markQueryResult=function(e,t,r,i){var n=r.fetchPolicy,a=r.variables,o=r.errorPolicy;"no-cache"===n?this.setQuery(e,function(){return{newData:{result:t.data,complete:!0}}}):this.dataStore.markQueryResult(t,this.getQuery(e).document,a,i,"ignore"===o||"all"===o)},e.prototype.queryListenerForObserver=function(e,t,r){var i=this;function n(e,t){if(r[e])try{r[e](t)}catch(e){}}return function(r,a){if(i.invalidate(e,!1),r){var o=i.getQuery(e),s=o.observableQuery,l=o.document,u=s?s.options.fetchPolicy:t.fetchPolicy;if("standby"!==u){var c=x(r.networkStatus),h=s&&s.getLastResult(),d=!(!h||h.networkStatus===r.networkStatus),p=t.returnPartialData||!a&&r.previousVariables||d&&t.notifyOnNetworkStatusChange||"cache-only"===u||"cache-and-network"===u;if(!c||p){var f=E(r.graphQLErrors),_=s&&s.options.errorPolicy||t.errorPolicy||"none";if("none"===_&&f||r.networkError)return n("error",new A({graphQLErrors:r.graphQLErrors,networkError:r.networkError}));try{var m=void 0,v=void 0;if(a)"no-cache"!==u&&"network-only"!==u&&i.setQuery(e,function(){return{newData:null}}),m=a.result,v=!a.complete;else{var y=s&&s.getLastError(),g="none"!==_&&(y&&y.graphQLErrors)!==r.graphQLErrors;if(h&&h.data&&!g)m=h.data,v=!1;else{var b=i.dataStore.getCache().diff({query:l,variables:r.previousVariables||r.variables,returnPartialData:!0,optimistic:!0});m=b.result,v=!b.complete}}var w=v&&!(t.returnPartialData||"cache-only"===u),M={data:w?h&&h.data:m,loading:c,networkStatus:r.networkStatus,stale:w};"all"===_&&f&&(M.errors=r.graphQLErrors),n("next",M)}catch(e){n("error",new A({networkError:e}))}}}}}},e.prototype.transform=function(e){var t=this.transformCache;if(!t.has(e)){var r=this.dataStore.getCache(),i=r.transformDocument(e),a=Object(n.D)(r.transformForLink(i)),o=this.localState.clientQuery(i),s=this.localState.serverQuery(a),l={document:i,hasClientExports:Object(n.r)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:o,serverQuery:s,defaultVars:Object(n.h)(Object(n.m)(i))},u=function(e){e&&!t.has(e)&&t.set(e,l)};u(e),u(i),u(o),u(s)}return t.get(e)},e.prototype.getVariables=function(e,t){return Object(i.a)(Object(i.a)({},this.transform(e).defaultVars),t)},e.prototype.watchQuery=function(e,t){void 0===t&&(t=!0),Object(l.b)("standby"!==e.fetchPolicy,11),e.variables=this.getVariables(e.query,e.variables),void 0===e.notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var r=Object(i.a)({},e);return new P({queryManager:this,options:r,shouldSubscribe:t})},e.prototype.query=function(e){var t=this;return Object(l.b)(e.query,12),Object(l.b)("Document"===e.query.kind,13),Object(l.b)(!e.returnPartialData,14),Object(l.b)(!e.pollInterval,15),new Promise(function(r,i){var n=t.watchQuery(e,!1);t.fetchQueryRejectFns.set("query:"+n.queryId,i),n.result().then(r,i).then(function(){return t.fetchQueryRejectFns.delete("query:"+n.queryId)})})},e.prototype.generateQueryId=function(){return String(this.idCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){this.stopPollingQuery(e),this.queryStore.stopQuery(e),this.invalidate(e)},e.prototype.addQueryListener=function(e,t){this.setQuery(e,function(e){return e.listeners.add(t),{invalidated:!1}})},e.prototype.updateQueryWatch=function(e,t,r){var i=this,n=this.getQuery(e).cancel;n&&n();return this.dataStore.getCache().watch({query:t,variables:r.variables,optimistic:!0,previousResult:function(){var t=null,r=i.getQuery(e).observableQuery;if(r){var n=r.getLastResult();n&&(t=n.data)}return t},callback:function(t){i.setQuery(e,function(){return{invalidated:!0,newData:t}})}})},e.prototype.addObservableQuery=function(e,t){this.setQuery(e,function(){return{observableQuery:t}})},e.prototype.removeObservableQuery=function(e){var t=this.getQuery(e).cancel;this.setQuery(e,function(){return{observableQuery:null}}),t&&t()},e.prototype.clearStore=function(){this.fetchQueryRejectFns.forEach(function(e){e(new l.a(16))});var e=[];return this.queries.forEach(function(t,r){t.observableQuery&&e.push(r)}),this.queryStore.reset(e),this.mutationStore.reset(),this.dataStore.reset()},e.prototype.resetStore=function(){var e=this;return this.clearStore().then(function(){return e.reFetchObservableQueries()})},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var r=[];return this.queries.forEach(function(i,n){var a=i.observableQuery;if(a){var o=a.options.fetchPolicy;a.resetLastResults(),"cache-only"===o||!e&&"standby"===o||r.push(a.refetch()),t.setQuery(n,function(){return{newData:null}}),t.invalidate(n)}}),this.broadcastQueries(),Promise.all(r)},e.prototype.observeQuery=function(e,t,r){return this.addQueryListener(e,this.queryListenerForObserver(e,t,r)),this.fetchQuery(e,t)},e.prototype.startQuery=function(e,t,r){return this.addQueryListener(e,r),this.fetchQuery(e,t).catch(function(){}),e},e.prototype.startGraphQLSubscription=function(e){var t=this,r=e.query,i=e.fetchPolicy,a=e.variables;r=this.transform(r).document,a=this.getVariables(r,a);var o=function(e){return t.getObservableFromLink(r,{},e,!1).map(function(a){if(i&&"no-cache"===i||(t.dataStore.markSubscriptionResult(a,r,e),t.broadcastQueries()),Object(n.q)(a))throw new A({graphQLErrors:a.errors});return a})};if(this.transform(r).hasClientExports){var s=this.localState.addExportedVariables(r,a).then(o);return new M(function(e){var t=null;return s.then(function(r){return t=r.subscribe(e)},e.error),function(){return t&&t.unsubscribe()}})}return o(a)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchQueryRejectFns.delete("query:"+e),this.fetchQueryRejectFns.delete("fetchRequest:"+e),this.getQuery(e).subscriptions.forEach(function(e){return e.unsubscribe()}),this.queries.delete(e)},e.prototype.getCurrentQueryResult=function(e,t){void 0===t&&(t=!0);var r=e.options,i=r.variables,n=r.query,a=r.fetchPolicy,o=r.returnPartialData,s=e.getLastResult(),l=this.getQuery(e.queryId).newData;if(l&&l.complete)return{data:l.result,partial:!1};if("no-cache"===a||"network-only"===a)return{data:void 0,partial:!1};var u=this.dataStore.getCache().diff({query:n,variables:i,previousResult:s?s.data:void 0,returnPartialData:!0,optimistic:t}),c=u.result,h=u.complete;return{data:h||o?c:void 0,partial:!h}},e.prototype.getQueryWithPreviousResult=function(e){var t;if("string"==typeof e){var r=this.getQuery(e).observableQuery;Object(l.b)(r,17),t=r}else t=e;var i=t.options,n=i.variables,a=i.query;return{previousResult:this.getCurrentQueryResult(t,!1).data,variables:n,document:a}},e.prototype.broadcastQueries=function(){var e=this;this.onBroadcast(),this.queries.forEach(function(t,r){t.invalidated&&t.listeners.forEach(function(i){i&&i(e.queryStore.get(r),t.newData)})})},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,r,a){var o,s=this;void 0===a&&(a=this.queryDeduplication);var l=this.transform(e).serverQuery;if(l){var u=this.inFlightLinkObservables,c=this.link,h={query:l,variables:r,operationName:Object(n.n)(l)||void 0,context:this.prepareContext(Object(i.a)(Object(i.a)({},t),{forceFetch:!a}))};if(t=h.context,a){var d=u.get(l)||new Map;u.set(l,d);var p=JSON.stringify(r);if(!(o=d.get(p))){d.set(p,o=R(y(c,h)));var f=function(){d.delete(p),d.size||u.delete(l),_.unsubscribe()},_=o.subscribe({next:f,error:f,complete:f})}}else o=R(y(c,h))}else o=M.of({data:{}}),t=this.prepareContext(t);var m=this.transform(e).clientQuery;return m&&(o=function(e,t){return new M(function(r){var i=r.next,n=r.error,a=r.complete,o=0,s=!1,l={next:function(e){++o,new Promise(function(r){r(t(e))}).then(function(e){--o,i&&i.call(r,e),s&&l.complete()},function(e){--o,n&&n.call(r,e)})},error:function(e){n&&n.call(r,e)},complete:function(){s=!0,o||a&&a.call(r)}},u=e.subscribe(l);return function(){return u.unsubscribe()}})}(o,function(e){return s.localState.runResolvers({document:m,remoteResult:e,context:t,variables:r})})),o},e.prototype.fetchRequest=function(e){var t,r,i=this,n=e.requestId,a=e.queryId,o=e.document,s=e.options,l=e.fetchMoreForQueryId,u=s.variables,c=s.errorPolicy,h=void 0===c?"none":c,d=s.fetchPolicy;return new Promise(function(e,c){var p=i.getObservableFromLink(o,s.context,u),f="fetchRequest:"+a;i.fetchQueryRejectFns.set(f,c);var _=function(){i.fetchQueryRejectFns.delete(f),i.setQuery(a,function(e){e.subscriptions.delete(m)})},m=p.map(function(e){if(n>=i.getQuery(a).lastRequestId&&(i.markQueryResult(a,e,s,l),i.queryStore.markQueryResult(a,e,l),i.invalidate(a),i.invalidate(l),i.broadcastQueries()),"none"===h&&E(e.errors))return c(new A({graphQLErrors:e.errors}));if("all"===h&&(r=e.errors),l||"no-cache"===d)t=e.data;else{var p=i.dataStore.getCache().diff({variables:u,query:o,optimistic:!1,returnPartialData:!0}),f=p.result;(p.complete||s.returnPartialData)&&(t=f)}}).subscribe({error:function(e){_(),c(e)},complete:function(){_(),e({data:t,errors:r,loading:!1,networkStatus:g.ready,stale:!1})}});i.setQuery(a,function(e){e.subscriptions.add(m)})})},e.prototype.getQuery=function(e){return this.queries.get(e)||{listeners:new Set,invalidated:!1,document:null,newData:null,lastRequestId:1,observableQuery:null,subscriptions:new Set}},e.prototype.setQuery=function(e,t){var r=this.getQuery(e),n=Object(i.a)(Object(i.a)({},r),t(r));this.queries.set(e,n)},e.prototype.invalidate=function(e,t){void 0===t&&(t=!0),e&&this.setQuery(e,function(){return{invalidated:t}})},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return Object(i.a)(Object(i.a)({},t),{clientAwareness:this.clientAwareness})},e.prototype.checkInFlight=function(e){var t=this.queryStore.get(e);return t&&t.networkStatus!==g.ready&&t.networkStatus!==g.error},e.prototype.startPollingQuery=function(e,t,r){var n=this,a=e.pollInterval;if(Object(l.b)(a,18),!this.ssrMode){var o=this.pollingInfoByQueryId.get(t);o||this.pollingInfoByQueryId.set(t,o={}),o.interval=a,o.options=Object(i.a)(Object(i.a)({},e),{fetchPolicy:"network-only"});var s=function(){var e=n.pollingInfoByQueryId.get(t);e&&(n.checkInFlight(t)?u():n.fetchQuery(t,e.options,T.poll).then(u,u))},u=function(){var e=n.pollingInfoByQueryId.get(t);e&&(clearTimeout(e.timeout),e.timeout=setTimeout(s,e.interval))};r&&this.addQueryListener(t,r),u()}return t},e.prototype.stopPollingQuery=function(e){this.pollingInfoByQueryId.delete(e)},e}(),F=function(){function e(e){this.cache=e}return e.prototype.getCache=function(){return this.cache},e.prototype.markQueryResult=function(e,t,r,i,a){void 0===a&&(a=!1);var o=!Object(n.q)(e);a&&Object(n.q)(e)&&e.data&&(o=!0),!i&&o&&this.cache.write({result:e.data,dataId:"ROOT_QUERY",query:t,variables:r})},e.prototype.markSubscriptionResult=function(e,t,r){Object(n.q)(e)||this.cache.write({result:e.data,dataId:"ROOT_SUBSCRIPTION",query:t,variables:r})},e.prototype.markMutationInit=function(e){var t,r=this;e.optimisticResponse&&(t="function"==typeof e.optimisticResponse?e.optimisticResponse(e.variables):e.optimisticResponse,this.cache.recordOptimisticTransaction(function(i){var n=r.cache;r.cache=i;try{r.markMutationResult({mutationId:e.mutationId,result:{data:t},document:e.document,variables:e.variables,updateQueries:e.updateQueries,update:e.update})}finally{r.cache=n}},e.mutationId))},e.prototype.markMutationResult=function(e){var t=this;if(!Object(n.q)(e.result)){var r=[{result:e.result.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}],i=e.updateQueries;i&&Object.keys(i).forEach(function(a){var o=i[a],s=o.query,l=o.updater,u=t.cache.diff({query:s.document,variables:s.variables,returnPartialData:!0,optimistic:!1}),c=u.result;if(u.complete){var h=Object(n.I)(function(){return l(c,{mutationResult:e.result,queryName:Object(n.n)(s.document)||void 0,queryVariables:s.variables})});h&&r.push({result:h,dataId:"ROOT_QUERY",query:s.document,variables:s.variables})}}),this.cache.performTransaction(function(t){r.forEach(function(e){return t.write(e)});var i=e.update;i&&Object(n.I)(function(){return i(t,e.result)})})}},e.prototype.markMutationComplete=function(e){var t=e.mutationId;e.optimisticResponse&&this.cache.removeOptimistic(t)},e.prototype.markUpdateQueryResult=function(e,t,r){this.cache.write({result:r,dataId:"ROOT_QUERY",variables:t,query:e})},e.prototype.reset=function(){return this.cache.reset()},e}(),U="2.6.10",V=function(){function e(e){var t=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var r=e.cache,i=e.ssrMode,n=void 0!==i&&i,a=e.ssrForceFetchDelay,o=void 0===a?0:a,s=e.connectToDevTools,u=e.queryDeduplication,c=void 0===u||u,h=e.defaultOptions,d=e.assumeImmutableResults,p=void 0!==d&&d,f=e.resolvers,_=e.typeDefs,m=e.fragmentMatcher,y=e.name,g=e.version,b=e.link;if(!b&&f&&(b=v.empty()),!b||!r)throw new l.a(4);this.link=b,this.cache=r,this.store=new F(r),this.disableNetworkFetches=n||o>0,this.queryDeduplication=c,this.defaultOptions=h||{},this.typeDefs=_,o&&setTimeout(function(){return t.disableNetworkFetches=!1},o),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this);void 0!==s&&(s&&"undefined"!=typeof window)&&(window.__APOLLO_CLIENT__=this),this.version=U,this.localState=new I({cache:r,client:this,resolvers:f,fragmentMatcher:m}),this.queryManager=new L({link:this.link,store:this.store,queryDeduplication:c,ssrMode:n,clientAwareness:{name:y,version:g},localState:this.localState,assumeImmutableResults:p,onBroadcast:function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.queryStore.getStore(),mutations:t.queryManager.mutationStore.getStore()},dataWithOptimisticResults:t.cache.extract(!0)})}})}return e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=Object(i.a)(Object(i.a)({},this.defaultOptions.watchQuery),e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=Object(i.a)(Object(i.a)({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=Object(i.a)(Object(i.a)({},this.defaultOptions.query),e)),Object(l.b)("cache-and-network"!==e.fetchPolicy,5),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=Object(i.a)(Object(i.a)({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=Object(i.a)(Object(i.a)({},this.defaultOptions.mutate),e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){var t=this.cache.writeQuery(e);return this.queryManager.broadcastQueries(),t},e.prototype.writeFragment=function(e){var t=this.cache.writeFragment(e);return this.queryManager.broadcastQueries(),t},e.prototype.writeData=function(e){var t=this.cache.writeData(e);return this.queryManager.broadcastQueries(),t},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return y(this.link,e)},e.prototype.initQueryManager=function(){return this.queryManager},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then(function(){return e.queryManager.clearStore()}).then(function(){return Promise.all(e.resetStoreCallbacks.map(function(e){return e()}))}).then(function(){return e.reFetchObservableQueries()})},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then(function(){return e.queryManager.clearStore()}).then(function(){return Promise.all(e.clearStoreCallbacks.map(function(e){return e()}))})},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter(function(t){return t!==e})}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter(function(t){return t!==e})}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e}(),j=r(107),z={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},G=function(e,t,r){var i=new Error(r);throw i.name="ServerError",i.response=e,i.statusCode=e.status,i.result=t,i},H=function(e,t){var r;try{r=JSON.stringify(e)}catch(e){var i=new l.a(2);throw i.parseError=e,i}return r},q=function(e){void 0===e&&(e={});var t=e.uri,r=void 0===t?"/graphql":t,n=e.fetch,a=e.includeExtensions,o=e.useGETForQueries,u=Object(i.e)(e,["uri","fetch","includeExtensions","useGETForQueries"]);!function(e){if(!e&&"undefined"==typeof fetch)throw new l.a(1)}(n),n||(n=fetch);var h={http:{includeExtensions:a},options:u.fetchOptions,credentials:u.credentials,headers:u.headers};return new v(function(e){var t=function(e,t){var r=e.getContext().uri;return r||("function"==typeof t?t(e):t||"/graphql")}(e,r),a=e.getContext(),l={};if(a.clientAwareness){var u=a.clientAwareness,d=u.name,p=u.version;d&&(l["apollographql-client-name"]=d),p&&(l["apollographql-client-version"]=p)}var f,_=Object(i.a)({},l,a.headers),m={http:a.http,options:a.fetchOptions,credentials:a.credentials,headers:_},v=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=Object(i.a)({},t.options,{headers:t.headers,credentials:t.credentials}),o=t.http;r.forEach(function(e){a=Object(i.a)({},a,e.options,{headers:Object(i.a)({},a.headers,e.headers)}),e.credentials&&(a.credentials=e.credentials),o=Object(i.a)({},o,e.http)});var s=e.operationName,l=e.extensions,u=e.variables,c=e.query,h={operationName:s,variables:u};return o.includeExtensions&&(h.extensions=l),o.includeQuery&&(h.query=Object(j.print)(c)),{options:a,body:h}}(e,z,h,m),y=v.options,g=v.body;if(!y.signal){var b=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var e=new AbortController;return{controller:e,signal:e.signal}}(),w=b.controller,x=b.signal;(f=w)&&(y.signal=x)}if(o&&!e.query.definitions.some(function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation})&&(y.method="GET"),"GET"===y.method){var M=function(e,t){var r=[],i=function(e,t){r.push(e+"="+encodeURIComponent(t))};"query"in t&&i("query",t.query);t.operationName&&i("operationName",t.operationName);if(t.variables){var n=void 0;try{n=H(t.variables,"Variables map")}catch(e){return{parseError:e}}i("variables",n)}if(t.extensions){var a=void 0;try{a=H(t.extensions,"Extensions map")}catch(e){return{parseError:e}}i("extensions",a)}var o="",s=e,l=e.indexOf("#");-1!==l&&(o=e.substr(l),s=e.substr(0,l));var u=-1===s.indexOf("?")?"?":"&";return{newURI:s+u+r.join("&")+o}}(t,g),E=M.newURI,T=M.parseError;if(T)return c(T);t=E}else try{y.body=H(g,"Payload")}catch(T){return c(T)}return new s(function(r){return n(t,y).then(function(t){return e.setContext({response:t}),t}).then(function(e){return function(t){return t.text().then(function(e){try{return JSON.parse(e)}catch(i){var r=i;return r.name="ServerParseError",r.response=t,r.statusCode=t.status,r.bodyText=e,Promise.reject(r)}}).then(function(r){return t.status>=300&&G(t,r,"Response not successful: Received status code "+t.status),Array.isArray(r)||r.hasOwnProperty("data")||r.hasOwnProperty("errors")||G(t,r,"Server response was missing for query '"+(Array.isArray(e)?e.map(function(e){return e.operationName}):e.operationName)+"'."),r})}}(e)).then(function(e){return r.next(e),r.complete(),e}).catch(function(e){"AbortError"!==e.name&&(e.result&&e.result.errors&&e.result.data&&r.next(e.result),r.error(e))}),function(){f&&f.abort()}})})};var W=function(e){function t(t){return e.call(this,q(t).request)||this}return Object(i.c)(t,e),t}(v);function Q(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||void 0===e||null===e)return null;if(Array.isArray(e))return Q(e[0]);var t=[];return Object.keys(e).forEach(function(r){var i={kind:"Field",name:{kind:"Name",value:r},selectionSet:Q(e[r])||void 0};t.push(i)}),{kind:"SelectionSet",selections:t}}var Y,X={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:null,variableDefinitions:null,directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:null,name:{kind:"Name",value:"__typename"},arguments:[],directives:[],selectionSet:null}]}}]},Z=function(){function e(){}return e.prototype.transformDocument=function(e){return e},e.prototype.transformForLink=function(e){return e},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.read({query:e.query,variables:e.variables,optimistic:t})},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.read({query:Object(n.k)(e.fragment,e.fragmentName),variables:e.variables,rootId:e.id,optimistic:t})},e.prototype.writeQuery=function(e){this.write({dataId:"ROOT_QUERY",result:e.data,query:e.query,variables:e.variables})},e.prototype.writeFragment=function(e){this.write({dataId:e.id,result:e.data,variables:e.variables,query:Object(n.k)(e.fragment,e.fragmentName)})},e.prototype.writeData=function(e){var t=e.id,r=e.data;if(void 0!==t){var i=null;try{i=this.read({rootId:t,optimistic:!1,query:X})}catch(e){}var n=i&&i.__typename||"__ClientData",a=Object.assign({__typename:n},r);this.writeFragment({id:t,fragment:function(e,t){return{kind:"Document",definitions:[{kind:"FragmentDefinition",typeCondition:{kind:"NamedType",name:{kind:"Name",value:t||"__FakeType"}},name:{kind:"Name",value:"GeneratedClientQuery"},selectionSet:Q(e)}]}}(a,n),data:a})}else this.writeQuery({query:function(e){return{kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GeneratedClientQuery"},selectionSet:Q(e)}]}}(r),data:r})},e}();Y||(Y={});var K=null,J={},$=1,ee=Array,te=ee["@wry/context:Slot"]||function(){var e=function(){function e(){this.id=["slot",$++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return e.prototype.hasValue=function(){for(var e=K;e;e=e.parent)if(this.id in e.slots){var t=e.slots[this.id];if(t===J)break;return e!==K&&(K.slots[this.id]=t),!0}return K&&(K.slots[this.id]=J),!1},e.prototype.getValue=function(){if(this.hasValue())return K.slots[this.id]},e.prototype.withValue=function(e,t,r,i){var n,a=((n={__proto__:null})[this.id]=e,n),o=K;K={parent:o,slots:a};try{return t.apply(i,r)}finally{K=o}},e.bind=function(e){var t=K;return function(){var r=K;try{return K=t,e.apply(this,arguments)}finally{K=r}}},e.noContext=function(e,t,r){if(!K)return e.apply(r,t);var i=K;try{return K=null,e.apply(r,t)}finally{K=i}},e}();try{Object.defineProperty(ee,"@wry/context:Slot",{value:ee["@wry/context:Slot"]=e,enumerable:!1,writable:!1,configurable:!1})}finally{return e}}();te.bind,te.noContext;function re(){}var ie=function(){function e(e,t){void 0===e&&(e=1/0),void 0===t&&(t=re),this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},e.prototype.getEntry=function(e){var t=this.map.get(e);if(t&&t!==this.newest){var r=t.older,i=t.newer;i&&(i.older=r),r&&(r.newer=i),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=i)}return t},e.prototype.set=function(e,t){var r=this.getEntry(e);return r?r.value=t:(r={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=r),this.newest=r,this.oldest=this.oldest||r,this.map.set(e,r),r.value)},e.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},e.prototype.delete=function(e){var t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)},e}(),ne=new te,ae=[],oe=[],se=100;function le(e,t){if(!e)throw new Error(t||"assertion failure")}function ue(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}var ce=function(){function e(t,r){this.fn=t,this.args=r,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],++e.count}return e.prototype.recompute=function(){if(le(!this.recomputing,"already recomputing"),function(e){var t=ne.getValue();if(t)return e.parents.add(t),t.childValues.has(e)||t.childValues.set(e,[]),de(e)?_e(t,e):me(t,e),t}(this)||!ye(this))return de(this)?function(e){var t=ge(e);ne.withValue(e,he,[e]),function(e){if("function"==typeof e.subscribe)try{we(e),e.unsubscribe=e.subscribe.apply(null,e.args)}catch(t){return e.setDirty(),!1}return!0}(e)&&function(e){if(e.dirty=!1,de(e))return;fe(e)}(e);return t.forEach(ye),ue(e.value)}(this):ue(this.value)},e.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,pe(this),we(this))},e.prototype.dispose=function(){var e=this;ge(this).forEach(ye),we(this),this.parents.forEach(function(t){t.setDirty(),be(t,e)})},e.count=0,e}();function he(e){e.recomputing=!0,e.value.length=0;try{e.value[0]=e.fn.apply(null,e.args)}catch(t){e.value[1]=t}e.recomputing=!1}function de(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function pe(e){e.parents.forEach(function(t){return _e(t,e)})}function fe(e){e.parents.forEach(function(t){return me(t,e)})}function _e(e,t){if(le(e.childValues.has(t)),le(de(t)),e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=oe.pop()||new Set;e.dirtyChildren.add(t),pe(e)}function me(e,t){le(e.childValues.has(t)),le(!de(t));var r=e.childValues.get(t);0===r.length?e.childValues.set(t,function(e){return e.slice(0)}(t.value)):function(e,t){var r=e.length;return r>0&&r===t.length&&e[r-1]===t[r-1]}(r,t.value)||e.setDirty(),ve(e,t),de(e)||fe(e)}function ve(e,t){var r=e.dirtyChildren;r&&(r.delete(t),0===r.size&&(oe.length<se&&oe.push(r),e.dirtyChildren=null))}function ye(e){return 0===e.parents.size&&"function"==typeof e.reportOrphan&&!0===e.reportOrphan()}function ge(e){var t=ae;return e.childValues.size>0&&(t=[],e.childValues.forEach(function(r,i){be(e,i),t.push(i)})),le(null===e.dirtyChildren),t}function be(e,t){t.parents.delete(e),e.childValues.delete(t),ve(e,t)}function we(e){var t=e.unsubscribe;"function"==typeof t&&(e.unsubscribe=void 0,t())}var xe=function(){function e(e){this.weakness=e}return e.prototype.lookup=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.lookupArray(e)},e.prototype.lookupArray=function(e){var t=this;return e.forEach(function(e){return t=t.getChildTrie(e)}),t.data||(t.data=Object.create(null))},e.prototype.getChildTrie=function(t){var r=this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),i=r.get(t);return i||r.set(t,i=new e(this.weakness)),i},e}();var Me=new xe("function"==typeof WeakMap);function Ee(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Me.lookupArray(e)}var Te=new Set;function Se(e,t){void 0===t&&(t=Object.create(null));var r=new ie(t.max||Math.pow(2,16),function(e){return e.dispose()}),i=!!t.disposable,n=t.makeCacheKey||Ee;function a(){if(!i||ne.hasValue()){var a=n.apply(null,arguments);if(void 0===a)return e.apply(null,arguments);var o=Array.prototype.slice.call(arguments),s=r.get(a);s?s.args=o:(s=new ce(e,o),r.set(a,s),s.subscribe=t.subscribe,i&&(s.reportOrphan=function(){return r.delete(a)}));var l=s.recompute();return r.set(a,s),Te.add(r),ne.hasValue()||(Te.forEach(function(e){return e.clean()}),Te.clear()),i?void 0:l}}return a.dirty=function(){var e=n.apply(null,arguments),t=void 0!==e&&r.get(e);t&&t.setDirty()},a}var Ae=!1;function Pe(){var e=!Ae;return Object(n.y)()||(Ae=!0),e}var ke=function(){function e(){}return e.prototype.ensureReady=function(){return Promise.resolve()},e.prototype.canBypassInit=function(){return!0},e.prototype.match=function(e,t,r){var i=r.store.get(e.id),n="ROOT_QUERY"===e.id;if(!i)return n;var a=i.__typename,o=void 0===a?n&&"Query":a;return o&&o===t||(Pe(),"heuristic")},e}(),Oe=(function(){function e(e){e&&e.introspectionQueryResultData?(this.possibleTypesMap=this.parseIntrospectionResult(e.introspectionQueryResultData),this.isReady=!0):this.isReady=!1,this.match=this.match.bind(this)}e.prototype.match=function(e,t,r){Object(l.b)(this.isReady,1);var i=r.store.get(e.id),n="ROOT_QUERY"===e.id;if(!i)return n;var a=i.__typename,o=void 0===a?n&&"Query":a;if(Object(l.b)(o,2),o===t)return!0;var s=this.possibleTypesMap[t];return!!(o&&s&&s.indexOf(o)>-1)},e.prototype.parseIntrospectionResult=function(e){var t={};return e.__schema.types.forEach(function(e){"UNION"!==e.kind&&"INTERFACE"!==e.kind||(t[e.name]=e.possibleTypes.map(function(e){return e.name}))}),t}}(),Object.prototype.hasOwnProperty),De=function(){function e(e){var t=this;void 0===e&&(e=Object.create(null)),this.data=e,this.depend=Se(function(e){return t.data[e]},{disposable:!0,makeCacheKey:function(e){return e}})}return e.prototype.toObject=function(){return this.data},e.prototype.get=function(e){return this.depend(e),this.data[e]},e.prototype.set=function(e,t){t!==this.data[e]&&(this.data[e]=t,this.depend.dirty(e))},e.prototype.delete=function(e){Oe.call(this.data,e)&&(delete this.data[e],this.depend.dirty(e))},e.prototype.clear=function(){this.replace(null)},e.prototype.replace=function(e){var t=this;e?(Object.keys(e).forEach(function(r){t.set(r,e[r])}),Object.keys(this.data).forEach(function(r){Oe.call(e,r)||t.delete(r)})):Object.keys(this.data).forEach(function(e){t.delete(e)})},e}();function Ne(e){return new De(e)}var Ce=function(){function e(e){var t=this,r=void 0===e?{}:e,i=r.cacheKeyRoot,a=void 0===i?new xe(n.e):i,o=r.freezeResults,s=void 0!==o&&o,l=this.executeStoreQuery,u=this.executeSelectionSet,c=this.executeSubSelectedArray;this.freezeResults=s,this.executeStoreQuery=Se(function(e){return l.call(t,e)},{makeCacheKey:function(e){var t=e.query,r=e.rootValue,i=e.contextValue,n=e.variableValues,o=e.fragmentMatcher;if(i.store instanceof De)return a.lookup(i.store,t,o,JSON.stringify(n),r.id)}}),this.executeSelectionSet=Se(function(e){return u.call(t,e)},{makeCacheKey:function(e){var t=e.selectionSet,r=e.rootValue,i=e.execContext;if(i.contextValue.store instanceof De)return a.lookup(i.contextValue.store,t,i.fragmentMatcher,JSON.stringify(i.variableValues),r.id)}}),this.executeSubSelectedArray=Se(function(e){return c.call(t,e)},{makeCacheKey:function(e){var t=e.field,r=e.array,i=e.execContext;if(i.contextValue.store instanceof De)return a.lookup(i.contextValue.store,t,r,JSON.stringify(i.variableValues))}})}return e.prototype.readQueryFromStore=function(e){return this.diffQueryAgainstStore(Object(i.a)(Object(i.a)({},e),{returnPartialData:!1})).result},e.prototype.diffQueryAgainstStore=function(e){var t=e.store,r=e.query,i=e.variables,o=e.previousResult,s=e.returnPartialData,u=void 0===s||s,c=e.rootId,h=void 0===c?"ROOT_QUERY":c,d=e.fragmentMatcherFunction,p=e.config,f=Object(n.o)(r);i=Object(n.c)({},Object(n.h)(f),i);var _={store:t,dataIdFromObject:p&&p.dataIdFromObject,cacheRedirects:p&&p.cacheRedirects||{}},m=this.executeStoreQuery({query:r,rootValue:{type:"id",id:h,generated:!0,typename:"Query"},contextValue:_,variableValues:i,fragmentMatcher:d}),v=m.missing&&m.missing.length>0;return v&&!u&&m.missing.forEach(function(e){if(!e.tolerable)throw new l.a(8)}),o&&Object(a.a)(o,m.result)&&(m.result=o),{result:m.result,complete:!v}},e.prototype.executeStoreQuery=function(e){var t=e.query,r=e.rootValue,i=e.contextValue,a=e.variableValues,o=e.fragmentMatcher,s=void 0===o?Re:o,l=Object(n.l)(t),u=Object(n.j)(t),c={query:t,fragmentMap:Object(n.g)(u),contextValue:i,variableValues:a,fragmentMatcher:s};return this.executeSelectionSet({selectionSet:l.selectionSet,rootValue:r,execContext:c})},e.prototype.executeSelectionSet=function(e){var t=this,r=e.selectionSet,a=e.rootValue,o=e.execContext,s=o.fragmentMap,u=o.contextValue,c=o.variableValues,h={result:null},d=[],p=u.store.get(a.id),f=p&&p.__typename||"ROOT_QUERY"===a.id&&"Query"||void 0;function _(e){var t;return e.missing&&(h.missing=h.missing||[],(t=h.missing).push.apply(t,e.missing)),e.result}return r.selections.forEach(function(e){var r;if(Object(n.F)(e,c))if(Object(n.t)(e)){var h=_(t.executeField(p,f,e,o));void 0!==h&&d.push(((r={})[Object(n.E)(e)]=h,r))}else{var m=void 0;if(Object(n.v)(e))m=e;else if(!(m=s[e.name.value]))throw new l.a(9);var v=m.typeCondition&&m.typeCondition.name.value,y=!v||o.fragmentMatcher(a,v,u);if(y){var g=t.executeSelectionSet({selectionSet:m.selectionSet,rootValue:a,execContext:o});"heuristic"===y&&g.missing&&(g=Object(i.a)(Object(i.a)({},g),{missing:g.missing.map(function(e){return Object(i.a)(Object(i.a)({},e),{tolerable:!0})})})),d.push(_(g))}}}),h.result=Object(n.B)(d),this.freezeResults,h},e.prototype.executeField=function(e,t,r,i){var a=i.variableValues,o=i.contextValue,s=function(e,t,r,i,a,o){o.resultKey;var s=o.directives,l=r;(i||s)&&(l=Object(n.p)(l,i,s));var u=void 0;if(e&&void 0===(u=e[l])&&a.cacheRedirects&&"string"==typeof t){var c=a.cacheRedirects[t];if(c){var h=c[r];h&&(u=h(e,i,{getCacheKey:function(e){var t=a.dataIdFromObject(e);return t&&Object(n.H)({id:t,typename:e.__typename})}}))}}if(void 0===u)return{result:u,missing:[{object:e,fieldName:l,tolerable:!1}]};Object(n.w)(u)&&(u=u.json);return{result:u}}(e,t,r.name.value,Object(n.b)(r,a),o,{resultKey:Object(n.E)(r),directives:Object(n.i)(r,a)});return Array.isArray(s.result)?this.combineExecResults(s,this.executeSubSelectedArray({field:r,array:s.result,execContext:i})):r.selectionSet?null==s.result?s:this.combineExecResults(s,this.executeSelectionSet({selectionSet:r.selectionSet,rootValue:s.result,execContext:i})):(Ie(r,s.result),this.freezeResults,s)},e.prototype.combineExecResults=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.forEach(function(t){t.missing&&(e=e||[]).push.apply(e,t.missing)}),{result:t.pop().result,missing:e}},e.prototype.executeSubSelectedArray=function(e){var t,r=this,i=e.field,n=e.array,a=e.execContext;function o(e){return e.missing&&(t=t||[]).push.apply(t,e.missing),e.result}return n=n.map(function(e){return null===e?null:Array.isArray(e)?o(r.executeSubSelectedArray({field:i,array:e,execContext:a})):i.selectionSet?o(r.executeSelectionSet({selectionSet:i.selectionSet,rootValue:e,execContext:a})):(Ie(i,e),e)}),this.freezeResults,{result:n,missing:t}},e}();function Ie(e,t){if(!e.selectionSet&&Object(n.u)(t))throw new l.a(10)}function Re(){return!0}var Be=function(){function e(e){void 0===e&&(e=Object.create(null)),this.data=e}return e.prototype.toObject=function(){return this.data},e.prototype.get=function(e){return this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e.prototype.delete=function(e){this.data[e]=void 0},e.prototype.clear=function(){this.data=Object.create(null)},e.prototype.replace=function(e){this.data=e||Object.create(null)},e}();var Le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="WriteError",t}return Object(i.c)(t,e),t}(Error);var Fe=function(){function e(){}return e.prototype.writeQueryToStore=function(e){var t=e.query,r=e.result,i=e.store,n=void 0===i?Ne():i,a=e.variables,o=e.dataIdFromObject,s=e.fragmentMatcherFunction;return this.writeResultToStore({dataId:"ROOT_QUERY",result:r,document:t,store:n,variables:a,dataIdFromObject:o,fragmentMatcherFunction:s})},e.prototype.writeResultToStore=function(e){var t=e.dataId,r=e.result,i=e.document,a=e.store,o=void 0===a?Ne():a,s=e.variables,l=e.dataIdFromObject,u=e.fragmentMatcherFunction,c=Object(n.m)(i);try{return this.writeSelectionSetToStore({result:r,dataId:t,selectionSet:c.selectionSet,context:{store:o,processedData:{},variables:Object(n.c)({},Object(n.h)(c),s),dataIdFromObject:l,fragmentMap:Object(n.g)(Object(n.j)(i)),fragmentMatcherFunction:u}})}catch(e){throw function(e,t){var r=new Le("Error writing result to store for query:\n "+JSON.stringify(t));return r.message+="\n"+e.message,r.stack=e.stack,r}(e,i)}},e.prototype.writeSelectionSetToStore=function(e){var t=this,r=e.result,i=e.dataId,a=e.selectionSet,o=e.context,s=o.variables,u=o.store,c=o.fragmentMap;return a.selections.forEach(function(e){var a;if(Object(n.F)(e,s))if(Object(n.t)(e)){var u=Object(n.E)(e),h=r[u];if(void 0!==h)t.writeFieldToStore({dataId:i,value:h,field:e,context:o});else{var d=!1,p=!1;e.directives&&e.directives.length&&(d=e.directives.some(function(e){return e.name&&"defer"===e.name.value}),p=e.directives.some(function(e){return e.name&&"client"===e.name.value})),!d&&!p&&o.fragmentMatcherFunction}}else{var f=void 0;Object(n.v)(e)?f=e:(f=(c||{})[e.name.value],Object(l.b)(f,3));var _=!0;if(o.fragmentMatcherFunction&&f.typeCondition){var m=i||"self",v=Object(n.H)({id:m,typename:void 0}),y={store:new Be((a={},a[m]=r,a)),cacheRedirects:{}},g=o.fragmentMatcherFunction(v,f.typeCondition.name.value,y);Object(n.x)(),_=!!g}_&&t.writeSelectionSetToStore({result:r,selectionSet:f.selectionSet,dataId:i,context:o})}}),u},e.prototype.writeFieldToStore=function(e){var t,r,o,s=e.field,u=e.value,c=e.dataId,h=e.context,d=h.variables,p=h.dataIdFromObject,f=h.store,_=Object(n.G)(s,d);if(s.selectionSet&&null!==u)if(Array.isArray(u)){var m=c+"."+_;r=this.processArrayValue(u,m,s.selectionSet,h)}else{var v=c+"."+_,y=!0;if(Ue(v)||(v="$"+v),p){var g=p(u);Object(l.b)(!g||!Ue(g),4),(g||"number"==typeof g&&0===g)&&(v=g,y=!1)}Ve(v,s,h.processedData)||this.writeSelectionSetToStore({dataId:v,result:u,selectionSet:s.selectionSet,context:h});var b=u.__typename;r=Object(n.H)({id:v,typename:b},y);var w=(o=f.get(c))&&o[_];if(w!==r&&Object(n.u)(w)){var x=void 0!==w.typename,M=void 0!==b,E=x&&M&&w.typename!==b;Object(l.b)(!y||w.generated||E,5),Object(l.b)(!x||M,6),w.generated&&(E?y||f.delete(w.id):function e(t,r,o){if(t===r)return!1;var s=o.get(t);var l=o.get(r);var u=!1;Object.keys(s).forEach(function(t){var r=s[t],i=l[t];Object(n.u)(r)&&Ue(r.id)&&Object(n.u)(i)&&!Object(a.a)(r,i)&&e(r.id,i.id,o)&&(u=!0)});o.delete(t);var c=Object(i.a)(Object(i.a)({},s),l);if(Object(a.a)(c,l))return u;o.set(r,c);return!0}(w.id,r.id,f))}}else r=null!=u&&"object"==typeof u?{type:"json",json:u}:u;(o=f.get(c))&&Object(a.a)(r,o[_])||f.set(c,Object(i.a)(Object(i.a)({},o),((t={})[_]=r,t)))},e.prototype.processArrayValue=function(e,t,r,i){var a=this;return e.map(function(e,o){if(null===e)return null;var s=t+"."+o;if(Array.isArray(e))return a.processArrayValue(e,s,r,i);var l=!0;if(i.dataIdFromObject){var u=i.dataIdFromObject(e);u&&(s=u,l=!1)}return Ve(s,r,i.processedData)||a.writeSelectionSetToStore({dataId:s,result:e,selectionSet:r,context:i}),Object(n.H)({id:s,typename:e.__typename},l)})},e}();function Ue(e){return"$"===e[0]}function Ve(e,t,r){if(!r)return!1;if(r[e]){if(r[e].indexOf(t)>=0)return!0;r[e].push(t)}else r[e]=[t];return!1}var je={fragmentMatcher:new ke,dataIdFromObject:function(e){if(e.__typename){if(void 0!==e.id)return e.__typename+":"+e.id;if(void 0!==e._id)return e.__typename+":"+e._id}return null},addTypename:!0,resultCaching:!0,freezeResults:!1};var ze=Object.prototype.hasOwnProperty,Ge=function(e){function t(t,r,i){var n=e.call(this,Object.create(null))||this;return n.optimisticId=t,n.parent=r,n.transaction=i,n}return Object(i.c)(t,e),t.prototype.toObject=function(){return Object(i.a)(Object(i.a)({},this.parent.toObject()),this.data)},t.prototype.get=function(e){return ze.call(this.data,e)?this.data[e]:this.parent.get(e)},t}(Be),He=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;r.watches=new Set,r.typenameDocumentCache=new Map,r.cacheKeyRoot=new xe(n.e),r.silenceBroadcast=!1,r.config=Object(i.a)(Object(i.a)({},je),t),r.config.customResolvers&&(r.config.cacheRedirects=r.config.customResolvers),r.config.cacheResolvers&&(r.config.cacheRedirects=r.config.cacheResolvers),r.addTypename=!!r.config.addTypename,r.data=r.config.resultCaching?new De:new Be,r.optimisticData=r.data,r.storeWriter=new Fe,r.storeReader=new Ce({cacheKeyRoot:r.cacheKeyRoot,freezeResults:t.freezeResults});var a=r,o=a.maybeBroadcastWatch;return r.maybeBroadcastWatch=Se(function(e){return o.call(r,e)},{makeCacheKey:function(e){if(!e.optimistic&&!e.previousResult)return a.data instanceof De?a.cacheKeyRoot.lookup(e.query,JSON.stringify(e.variables)):void 0}}),r}return Object(i.c)(t,e),t.prototype.restore=function(e){return e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).toObject()},t.prototype.read=function(e){if("string"==typeof e.rootId&&void 0===this.data.get(e.rootId))return null;var t=this.config.fragmentMatcher,r=t&&t.match;return this.storeReader.readQueryFromStore({store:e.optimistic?this.optimisticData:this.data,query:this.transformDocument(e.query),variables:e.variables,rootId:e.rootId,fragmentMatcherFunction:r,previousResult:e.previousResult,config:this.config})||null},t.prototype.write=function(e){var t=this.config.fragmentMatcher,r=t&&t.match;this.storeWriter.writeResultToStore({dataId:e.dataId,result:e.result,variables:e.variables,document:this.transformDocument(e.query),store:this.data,dataIdFromObject:this.config.dataIdFromObject,fragmentMatcherFunction:r}),this.broadcastWatches()},t.prototype.diff=function(e){var t=this.config.fragmentMatcher,r=t&&t.match;return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,query:this.transformDocument(e.query),variables:e.variables,returnPartialData:e.returnPartialData,previousResult:e.previousResult,fragmentMatcherFunction:r,config:this.config})},t.prototype.watch=function(e){var t=this;return this.watches.add(e),function(){t.watches.delete(e)}},t.prototype.evict=function(e){throw new l.a(7)},t.prototype.reset=function(){return this.data.clear(),this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){for(var t=[],r=0,i=this.optimisticData;i instanceof Ge;)i.optimisticId===e?++r:t.push(i),i=i.parent;if(r>0){for(this.optimisticData=i;t.length>0;){var n=t.pop();this.performTransaction(n.transaction,n.optimisticId)}this.broadcastWatches()}},t.prototype.performTransaction=function(e,t){var r=this.data,i=this.silenceBroadcast;this.silenceBroadcast=!0,"string"==typeof t&&(this.data=this.optimisticData=new Ge(t,this.optimisticData,e));try{e(this)}finally{this.silenceBroadcast=i,this.data=r}this.broadcastWatches()},t.prototype.recordOptimisticTransaction=function(e,t){return this.performTransaction(e,t)},t.prototype.transformDocument=function(e){if(this.addTypename){var t=this.typenameDocumentCache.get(e);return t||(t=Object(n.a)(e),this.typenameDocumentCache.set(e,t),this.typenameDocumentCache.set(t,t)),t}return e},t.prototype.broadcastWatches=function(){var e=this;this.silenceBroadcast||this.watches.forEach(function(t){return e.maybeBroadcastWatch(t)})},t.prototype.maybeBroadcastWatch=function(e){e.callback(this.diff({query:e.query,variables:e.variables,previousResult:e.previousResult&&e.previousResult(),optimistic:e.optimistic}))},t}(Z);function qe(e){return new v(function(t,r){return new s(function(i){var n,a,o;try{n=r(t).subscribe({next:function(n){n.errors&&(o=e({graphQLErrors:n.errors,response:n,operation:t,forward:r}))?a=o.subscribe({next:i.next.bind(i),error:i.error.bind(i),complete:i.complete.bind(i)}):i.next(n)},error:function(n){(o=e({operation:t,networkError:n,graphQLErrors:n&&n.result&&n.result.errors,forward:r}))?a=o.subscribe({next:i.next.bind(i),error:i.error.bind(i),complete:i.complete.bind(i)}):i.error(n)},complete:function(){o||i.complete.bind(i)()}})}catch(n){e({networkError:n,operation:t,forward:r}),i.error(n)}return function(){n&&n.unsubscribe(),a&&n.unsubscribe()}})})}!function(e){function t(t){var r=e.call(this)||this;return r.link=qe(t),r}Object(i.c)(t,e),t.prototype.request=function(e,t){return this.link.request(e,t)}}(v);var We=r(43);r.d(t,"a",function(){return Xe});var Qe=function(){return(Qe=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Ye={},Xe=function(){if(Ye.gqlClient)return Ye.gqlClient;var e=new W({uri:We.a.endpoint+"/graphql"}),t=qe(function(e){var t=e.graphQLErrors,r=(e.networkError,e.operation),i=e.response;t&&/Expected type \"Id\"/.test(t[0].message)&&(i.errors=[Error("model id is not valid")]),"InitElementProperty"===r.operationName&&t&&t[0]&&"property already exist"===t[0].message&&(i.errors=[Error("element Status cannot be initialized multiple times")])}),r=new v(function(e,t){var r={"x-access-token":We.a.appToken};return We.a.headers&&(r=Qe(Qe({},We.a.headers),r)),e.setContext({headers:r}),t(e)}),i=new V({link:v.from([t,r,e]),cache:new He,defaultOptions:{watchQuery:{fetchPolicy:"cache-and-network",errorPolicy:"all"},query:{fetchPolicy:"network-only",errorPolicy:"all"},mutate:{errorPolicy:"all"}}});return Ye.gqlClient=i,i}},function(e,t,r){"use strict";var i=r(2),n=r(54),a=r(0),o=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=function(){function e(t,r,i,o,s,l){if(this._id=0,this.isDestroy=!1,this.testCull=!0,this.drawnLastFrame=!1,this.useOverride=!0,this._id=e._totalNumber++,this.mesh=t,this.material=i,this.shader=r,this.transform=new n.a(o),this.worldTransform=new n.a(o),this.initMatrix=a.a.create(),this._parent=null,this._dirty=!1,this.name=l||"",this.faceCamera=!1,this.visible=!0,this.bbox=null,this.bsphere=null,this.distance=0,this.nodes=[],this.hidables=-1,this.originalMaterial=null,this.minVertexBits=0,this.isDestroy=!1,this.testCull=!0,this.material){var u=this.material.attachShader(this.shader,this.mesh.getManager());this.shader=this.shader||u}s&&this.setBbox(s)}return e.prototype.dump=function(){console.groupCollapsed("Drawable: "+this._id),console.log("material: ",this.material),console.log("nodes: ",this.nodes),console.log("mesh: ",this.mesh),console.log("shader: ",this.shader),console.log("transform: ",this.transform),console.log("worldTransform: ",this.worldTransform),console.log("skeleton: ",this.skeleton),console.log("faceCamera: "+this.faceCamera),console.log("visible: "+this.visible),console.log("bbox: "+this.bbox),console.log("bsphere: "+this.bsphere),console.log("originBBox: "+this.originBBox),console.log("_dirty: "+this._dirty),console.log("distance: "+this.distance),console.groupEnd()},e.prototype.dumpVisibility=function(){console.log("drawable<"+this._id+">: "+(this.visible?"shown":"hidden")),this.nodes.forEach(function(e){return console.log("node<"+e.id+">: "+(e.isVisible()?"shown":"hidden"))})},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){this.transform.destroy(),this.transform=null,delete this.transform,this.worldTransform.destroy(),this.worldTransform=null,delete this.worldTransform,this.bbox=null,delete this.bbox,this.bsphere=null,delete this.bsphere,this.mesh.destroy(),this.mesh=null,delete this.mesh,this.material.destroy(e),this.material=null,delete this.material,this.originalMaterial&&this.originalMaterial.destroy(e),this.originalMaterial=null,delete this.originalMaterial,this.nodes=null,delete this.nodes,this.isDestroy=!0},e.prototype.setBbox=function(e){this.bbox=i.a.aabb.createFromArray(e),this.bsphere=i.a.sphere.createFromAABB(this.bbox);var t=a.a.create();a.a.invert(t,this.transform.matrix),this.initMatrix[12]=(this.bbox[0]+this.bbox[3])/2,this.initMatrix[13]=(this.bbox[1]+this.bbox[4])/2,this.initMatrix[14]=(this.bbox[2]+this.bbox[5])/2,this.originBBox=i.a.aabb.create(),i.a.aabb.transform(this.originBBox,this.bbox,t)},e.prototype.isShadowCaster=function(){return(!this.material.transparent||this.material.parameters.hasOwnProperty("uMaterialDiffuseTexture"))&&this.mesh.isTriangle()},e.prototype.setShader=function(e){this.shader!==e&&(this.shader=e,this.material.attachShader(e))},e.prototype.setParent=function(e){this._parent=e},e.prototype.setTranslation=function(e,t,r){this.transform.setTranslation(e,t,r),this.updateBBox(),this.recompileShader("MODEL_TRANSFORM",!this.transform.identity)},e.prototype.translate=function(e,t,r){this.transform.translate(e,t,r),this.bbox[0]+=e,this.bbox[1]+=t,this.bbox[2]+=r,this.bbox[3]+=e,this.bbox[4]+=t,this.bbox[5]+=r,this.bsphere[0]+=e,this.bsphere[1]+=t,this.bsphere[2]+=r,this.recompileShader("MODEL_TRANSFORM",!this.transform.identity)},e.prototype.setScaling=function(e,t,r){var i=this.transform.getScaling();this.transform.setScaling(e,t,r);var n=.5*(this.bbox[3]+this.bbox[0]),a=.5*(this.bbox[4]+this.bbox[1]),o=.5*(this.bbox[5]+this.bbox[2]),s=e/i[0]*(this.bbox[3]-this.bbox[0])*.5,l=t/i[1]*(this.bbox[4]-this.bbox[1])*.5,u=r/i[2]*(this.bbox[5]-this.bbox[2])*.5;this.bbox[0]=n-s,this.bbox[1]=a-l,this.bbox[2]=o-u,this.bbox[3]=n+s,this.bbox[4]=a+l,this.bbox[5]=o+u,this.bsphere[3]=Math.sqrt(s*s+l*l+u*u)},e.prototype.multiply=function(e){a.d.transformMat4(this.bsphere,this.bsphere,e),this.transform.multiply(e),this.updateBBox()},e.prototype.setTransformMatrix=function(e){this.transform.setTransform(e),this.updateBBox()},e.prototype.setTransform=function(e){var t=a.a.create(),r=a.a.create();a.a.invert(t,this.initMatrix),a.a.multiply(r,e,t),this.setTransformMatrix(r)},e.prototype.setWorldMatrix=function(e){this.transform.set(e),this.updateBBox()},e.prototype.recompileShader=function(e,t){var r,i=this.shader.flags.lastIndexOf(e),n=!1;if(t?-1===i&&(r=this.shader.flags.concat(e),n=!0):-1!==i&&((r=this.shader.flags.slice(0)).splice(i,1),n=!0),n){var a=this.shader.shaderSource.name,o=this.shader.getManager().getShader(a,r);if(!o.ready&&(o.createFromShaderSource(this.shader.shaderSource,r),!o.ready))throw new Error("Failed to create shader '"+a+"'!");this.shader=o,this.material.attachShader(this.shader)}},e.prototype._onlyHasOneNode=function(){return 1===this.nodes.length},e.prototype._allNodesHasSameVisibilty=function(){var e,t,r=this.nodes[0].isVisible();try{for(var i=o(this.nodes),n=i.next();!n.done;n=i.next()){if(r!==n.value.isVisible())return!1}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return!0},e.prototype._updateVisibilityAccordingNodes=function(e){void 0===e&&(e=!1),this.visible=this.nodes[0].isVisible();var t=this.nodes[0].clonedDrawable;t&&e&&(t.visible=this.visible)},e.prototype.changeVisibilityAttributeOfNodeVertices=function(){var e,t,r=this._getVerticesCount(),i=this._getBufferOffset(),n=0,a=new Uint8Array(r);try{for(var s=o(this.nodes),l=s.next();!l.done;l=s.next()){var u=l.value;a.fill(u.getPlatteIndex(),n,n+u.verticesCount),n+=u.verticesCount}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}this.mesh.vbSubData(i,a)},e.prototype.updateVisibility=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!1),this._onlyHasOneNode())return this._updateVisibilityAccordingNodes(t),void(e&&this.recompileShader("VISIBILITY",!1));this.visible=!0,this.changeVisibilityAttributeOfNodeVertices(),e&&this.recompileShader("VISIBILITY",!0)},e.prototype.updateColor=function(){var e,t,r=!1;try{for(var i=o(this.nodes),n=i.next();!n.done;n=i.next()){if(r=n.value.usePlatte())break}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.recompileShader("USE_PLATTE",r),r&&this._uploadPlatteIndices()},e.prototype._uploadPlatteIndices=function(){this.mesh.vbSubData(this._getBufferOffset(),this._getPlatteIndices())},e.prototype._getVerticesCount=function(){var e,t,r=0;try{for(var i=o(this.nodes),n=i.next();!n.done;n=i.next()){r+=n.value.verticesCount}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},e.prototype._getBufferOffset=function(){return this._getVerticesCount()*this.mesh.attributes.values[0].stride},e.prototype._getPlatteIndices=function(){var e,t,r=this._getVerticesCount(),i=new Uint8Array(r),n=0;try{for(var a=o(this.nodes),s=a.next();!s.done;s=a.next()){var l=s.value;i.fill(l.getPlatteIndex(),n,n+l.verticesCount),n+=l.verticesCount}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return i},e.prototype.updateTransformMatrix=function(){this._dirty&&this.worldTransform.multiply(this._parent)},e.prototype.render=function(e,t,r){this.transform.use(e,t),this.skeleton&&this.skeleton.use(t),this.popLodInfo&&this._preparePop(e,t,r),this.mesh.renderSub(r[0],r[1])},e.prototype._preparePop=function(e,t,r){var i=this.shader.getManager().gl,n=Math.ceil(Math.log2(960*this.bsphere[3]*e._invTanFov/a.d.distance(this.bsphere,e.eye))-1);n=this.minVertexBits-n;for(var o=0,s=0;s<this.popLodInfo.lod.length;s++){var l=this.popLodInfo.lod[s];if(l.level<n){r[1]=l.indexLength,o=l.level;break}}t.reservedUniforms["m_uPopParams.vertexConstant"]&&t.reservedUniforms["m_uPopParams.vertexConstant"].upload(this.popLodInfo.vertexConstant,i),t.reservedUniforms["m_uPopParams.vertexGridSize"]&&t.reservedUniforms["m_uPopParams.vertexGridSize"].upload(this.popLodInfo.gridSize,i),t.reservedUniforms["m_uPopParams.powPrecision"]&&t.reservedUniforms["m_uPopParams.powPrecision"].upload(Math.pow(2,o),i)},e.prototype.updateBBox=function(){this.bbox&&this.originBBox&&(i.a.aabb.transform(this.bbox,this.originBBox,this.transform.matrix),this.bsphere=i.a.sphere.createFromAABB(this.bbox))},e.prototype.getWorldMatrix=function(){return this.worldTransform.matrix},e.prototype.getTransformMatrix=function(){return this.transform.matrix},e.prototype.getTransformArray=function(){var e=[];return e=e.concat(this.transform.matrix)},e.prototype.clone=function(){var t=new e(this.mesh,this.shader,this.material.clone(this.material.name+"-cloned"),this.transform.matrix,this.bbox);return t.faceCamera=this.faceCamera,t.bsphere=this.bsphere,t.distance=this.distance,t.nodes=this.nodes,t.hidables=this.hidables,t.originalMaterial=this.originalMaterial,t},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.isSingleton=function(){return 1===this.nodes.length},e.prototype.isMerged=function(){return this.nodes.length>1},e.prototype.isLine=function(){return this.mesh.isLine()},e.prototype.isTriangle=function(){return this.mesh.isTriangle()},e.prototype.setId=function(e){this._id=e},e.prototype.getId=function(){return this._id},e.prototype.locked=function(){this.transform.setDefault(this.transform.matrix)},e.prototype.update=function(e){},e._totalNumber=0,e}();t.a=s},function(e,t,r){"use strict";r.d(t,"b",function(){return n});var i=function(){function e(){}return e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.indexOf=function(t,r){if(!e.isArray(t))return console.error("Not an array!"),-1;for(var i=0,n=t.length;i<n;++i)if(t[i]===r)return i;return-1},e.decodeUTF8=function(e){for(var t="",r=0;r<e.length;r++){var i=e[r];if(i<128)t+=String.fromCharCode(i);else if(i>191&&i<224)t+=String.fromCharCode((31&i)<<6|63&e[r+1]),r+=1;else if(i>223&&i<240)t+=String.fromCharCode((15&i)<<12|(63&e[r+1])<<6|63&e[r+2]),r+=2;else{var n=((7&i)<<18|(63&e[r+1])<<12|(63&e[r+2])<<6|63&e[r+3])-65536;t+=String.fromCharCode(n>>10|55296,1023&n|56320),r+=3}}return t},e.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})},e.arrayDiff=function(e,t){var r=e.filter(function(e){return!t.includes(e)});return{added:t.filter(function(t){return!e.includes(t)}),removed:r}},e}();function n(e){var t,r=null,i=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t=i,null===r&&(r=requestAnimationFrame(function(i){return function(){r=null,e.apply(i,t)}}(this)))};return i.cancel=function(){cancelAnimationFrame(r),r=null},i}t.a=i},function(e,t,r){"use strict";var i=r(8),n=function(){function e(e,t,r){var i=this;this.name=null,this._scene=null,this._viewer=null,this._camera=null,this._cameras=[],this._renderer=null,this._resourceManager=null,this._renderable=!1,this._enabled=!1,this._interactive=!0,this._inputEnabled=!0,this._needUpdate=!1,this._renderTargets=[],this._gl=null,this.name=e,this._viewer=r,r&&(this._gl=r.getResourceManager().gl,this._scene=r.getScene().core,this._camera=r.getCamera().core,this._renderer=r.getRenderer(),this._resourceManager=r.getResourceManager(),r.getCamera().cores.forEach(function(e){return i._cameras.push(e)})),this._renderable=t}return e.prototype.beforeDestroy=function(){return!1},e.prototype.destroy=function(){this.name=null,delete this.name,this._viewer=null,delete this._viewer,this._scene=null,delete this._scene,this._camera=null,delete this._camera,this._cameras=null,delete this._cameras,this._renderer=null,delete this._renderer,this._resourceManager=null,delete this._resourceManager,this._renderTargets.forEach(function(e){return e.destroy()}),this._renderTargets=null,delete this._renderTargets},e.prototype.doesSupportMobile=function(e){return!1},e.prototype.doesSupport3D=function(e){return!1},e.prototype.isEnabled=function(){return this._enabled},e.prototype.dump=function(){},e.prototype.setEnabled=function(e){e!==this._enabled&&(this._enabled=e,this._viewer.setProgressiveRendering(),this._onEnableChanged())},e.prototype._onEnableChanged=function(){},e.prototype.switchEnabled=function(){this._enabled=!this._enabled,this._viewer.setProgressiveRendering(),this._onEnableChanged()},e.prototype.setInteractive=function(e){this._interactive=e,this._viewer.setProgressiveRendering()},e.prototype.isInteractive=function(){return this._interactive&&this._enabled},e.prototype.addInput=function(e){},e.prototype.resize=function(e,t){for(var r=0;r<this._renderTargets.length;r++)this._renderTargets[r].resize(e,t)},e.prototype.setNeedUpdate=function(e){this._needUpdate=e},e.prototype.update=function(){this._needUpdate&&(this._update(),this._needUpdate=!1)},e.prototype.renderNormally=function(){this._enabled&&this._interactive&&this._render()},e.prototype.renderProgressively=function(){this._enabled&&this._interactive&&this._renderProgressively()},e.prototype._render=function(){},e.prototype._update=function(){},e.prototype._renderProgressively=function(){},e.prototype.setInputEnabled=function(e){this._inputEnabled=e},e.prototype.isInputEnabled=function(){return this._inputEnabled},e.prototype.onSceneChanged=function(){},e.prototype._getRenderTarget=function(e){if(this._renderable&&this._viewer){var t=this._viewer.getRenderScene().getRenderTarget().getName(),r=this._viewer.getCamera().core,n=r.viewport[2],a=r.viewport[3],o=new i.a(t,this._resourceManager,n,a,e||{});return this._renderTargets.push(o),o}return null},e.prototype._getRenderTargetPR=function(e){if(!this._viewer)return null;if(!this._renderable)return null;var t=this._viewer.getRenderScene().getRenderTargetPR().getName(),r=this._viewer.getCamera().core,n=r.viewport[2],a=r.viewport[3],o=new i.a(t,this._resourceManager,n,a,e||{});return this._renderTargets.push(o),o},e.prototype._getDefaultShadow=function(){return this._viewer.getRenderScene()._shadow},e.prototype._isShadowEnabled=function(){return this._viewer.getRenderScene().isShadowEnabled()},e}();t.a=n},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={webvr:!1,compressNormals:!1,maxInstanceCount:1e3}},function(e,t,r){"use strict";var i=r(38);function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var a,o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),u=n("DX10");!function(e){e[e.TEXTURETYPE_UNSIGNED_INT=0]="TEXTURETYPE_UNSIGNED_INT",e[e.TEXTURETYPE_HALF_FLOAT=1]="TEXTURETYPE_HALF_FLOAT",e[e.TEXTURETYPE_FLOAT=2]="TEXTURETYPE_FLOAT"}(a||(a={}));var c=function(){function e(){}return e.GetDDSInfo=function(e){var t=new Int32Array(e,0,31),r=new Int32Array(e,0,35),i=1;131072&t[2]&&(i=Math.max(1,t[7]));var n=t[21],c=n===u?r[32]:0,h=a.TEXTURETYPE_UNSIGNED_INT;switch(n){case 113:h=a.TEXTURETYPE_HALF_FLOAT;break;case 116:h=a.TEXTURETYPE_FLOAT;break;case u:if(10===c){h=a.TEXTURETYPE_HALF_FLOAT;break}if(2===c){h=a.TEXTURETYPE_FLOAT;break}}return{width:t[4],height:t[3],mipmapCount:i,isFourCC:4==(4&t[20]),isRGB:64==(64&t[20]),isLuminance:131072==(131072&t[20]),isCube:512==(512&t[28]),isCompressed:n===o||n===s||n===l,dxgiFormat:c,textureType:h}},e._ToHalfFloat=function(t){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=t;var r=e._Int32View[0],i=r>>16&32768,n=r>>12&2047,a=r>>23&255;return a<103?i:a>142?(i|=31744,i|=(255==a?0:1)&&8388607&r):a<113?i|=((n|=2048)>>114-a)+(n>>113-a&1):(i|=a-112<<10|n>>1,i+=1&n)},e._FromHalfFloat=function(e){var t=(32768&e)>>15,r=(31744&e)>>10,i=1023&e;return 0===r?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,r,i,n,a,o){for(var s=new Float32Array(n),l=new Uint16Array(a,i),u=0,c=0;c<r;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=e._FromHalfFloat(l[d]),s[u+1]=e._FromHalfFloat(l[d+1]),s[u+2]=e._FromHalfFloat(l[d+2]),e.StoreLODInAlphaChannel?s[u+3]=o:s[u+3]=e._FromHalfFloat(l[d+3]),u+=4}return s},e._GetHalfFloatRGBAArrayBuffer=function(t,r,i,n,a,o){if(e.StoreLODInAlphaChannel){for(var s=new Uint16Array(n),l=new Uint16Array(a,i),u=0,c=0;c<r;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=l[d],s[u+1]=l[d+1],s[u+2]=l[d+2],s[u+3]=e._ToHalfFloat(o),u+=4}return s}return new Uint16Array(a,i,n)},e._GetFloatRGBAArrayBuffer=function(t,r,i,n,a,o){if(e.StoreLODInAlphaChannel){for(var s=new Float32Array(n),l=new Float32Array(a,i),u=0,c=0;c<r;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=l[d],s[u+1]=l[d+1],s[u+2]=l[d+2],s[u+3]=o,u+=4}return s}return new Float32Array(a,i,n)},e._GetFloatAsUIntRGBAArrayBuffer=function(t,r,i,n,a,o){for(var s=new Uint8Array(n),l=new Float32Array(a,i),u=0,c=0;c<r;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=255*Math.min(1,Math.max(0,l[d])),s[u+1]=255*Math.min(1,Math.max(0,l[d+1])),s[u+2]=255*Math.min(1,Math.max(0,l[d+2])),e.StoreLODInAlphaChannel?s[u+3]=o:s[u+3]=255*Math.min(1,Math.max(0,l[d+3])),u+=4}return s},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,r,i,n,a,o){for(var s=new Uint8Array(n),l=new Uint16Array(a,i),u=0,c=0;c<r;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=255*Math.min(1,Math.max(0,e._FromHalfFloat(l[d]))),s[u+1]=255*Math.min(1,Math.max(0,e._FromHalfFloat(l[d+1]))),s[u+2]=255*Math.min(1,Math.max(0,e._FromHalfFloat(l[d+2]))),e.StoreLODInAlphaChannel?s[u+3]=o:s[u+3]=255*Math.min(1,Math.max(0,e._FromHalfFloat(l[d+3]))),u+=4}return s},e._GetRGBAArrayBuffer=function(e,t,r,i,n,a,o,s,l){for(var u=new Uint8Array(i),c=new Uint8Array(n,r),h=0,d=0;d<t;d++)for(var p=0;p<e;p++){var f=4*(p+d*e);u[h]=c[f+a],u[h+1]=c[f+o],u[h+2]=c[f+s],u[h+3]=c[f+l],h+=4}return u},e._ExtractLongWordOrder=function(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)},e._GetRGBArrayBuffer=function(e,t,r,i,n,a,o,s){for(var l=new Uint8Array(i),u=new Uint8Array(n,r),c=0,h=0;h<t;h++)for(var d=0;d<e;d++){var p=3*(d+h*e);l[c]=u[p+a],l[c+1]=u[p+o],l[c+2]=u[p+s],c+=3}return l},e._GetLuminanceArrayBuffer=function(e,t,r,i,n){for(var a=new Uint8Array(i),o=new Uint8Array(n,r),s=0,l=0;l<t;l++)for(var u=0;u<e;u++){var c=u+l*e;a[s]=o[c],s++}return a},e.uploadDataToTexture=function(e,t,r,i,n,a,o,s,l){void 0===l&&(l=!1);var u=e.TEXTURE_CUBE_MAP_POSITIVE_X+o,c=Math.round(Math.log(t.width)*Math.LOG2E),h=Math.round(Math.log(t.height)*Math.LOG2E),d=l?t.width:Math.pow(2,Math.max(c-s,0)),p=l?t.height:Math.pow(2,Math.max(h-s,0));e.isWebGL2||(n=a),e.texImage2D(u,s,a,d,p,0,n,i,r)},e.uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,a,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var l=e.TEXTURE_CUBE_MAP_POSITIVE_X+o;e.compressedTexImage2D(l,s,r,i,n,0,a)},e.UploadDDSLevels=function(t,r,i,n,a,c,h,d){void 0===h&&(h=-1);var p,f,_,m,v,y,g,b=t.s3tcExtension,w=new Int32Array(i,0,31),x=0,M=0,E=1;if(542327876===w[0])if(n.isFourCC||n.isRGB||n.isLuminance)if(!n.isCompressed||b){var T=w[22];m=w[1]+4;if(n.isFourCC)switch(p=w[21]){case o:E=8,M=b.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case s:E=16,M=b.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case l:E=16,M=b.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:!0;break;case u:m+=20;var S=!1;switch(n.dxgiFormat){case 10:case 2:!0,S=!0;break;case 88:n.isRGB=!0,n.isFourCC=!1,T=32,S=!0}if(S)break;default:return void console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(p))}var A=e._ExtractLongWordOrder(w[23]),P=e._ExtractLongWordOrder(w[24]),k=e._ExtractLongWordOrder(w[25]),O=e._ExtractLongWordOrder(w[26]);y=1,131072&w[2]&&!1!==a&&(y=Math.max(1,w[7]));for(var D,N,C,I=d||0,R=t.isWebGL2||t.halfFloatExtension,B=I;B<c;B++){for(f=w[4],_=w[3],g=0;g<y;++g){if(-1===h||h===g){var L=-1===h?g:0;if(!n.isCompressed&&n.isFourCC){D=t.RGBA,x=f*_*4;var F=null;128===T?(C=t.FLOAT,N=t.RGBA32F,F=e._GetFloatRGBAArrayBuffer(f,_,m,x,i,L)):64!==T||R?(C=t.HALF_FLOAT||R.HALF_FLOAT_OES,N=t.RGBA16F||t.RGBA,F=e._GetHalfFloatRGBAArrayBuffer(f,_,m,x,i,L)):(C=t.FLOAT,N=t.RGBA32F,F=e._GetHalfFloatAsFloatRGBAArrayBuffer(f,_,m,x,i,L)),F&&e.uploadDataToTexture(t,r,F,C,D,N,B,L)}else if(n.isRGB)C=t.UNSIGNED_INT,24===T?(D=t.RGB,N=t.RGB8,x=f*_*3,v=e._GetRGBArrayBuffer(f,_,m,x,i,A,P,k),e.uploadDataToTexture(t,r,v,C,D,N,B,L)):(D=t.RGBA,N=t.RGBA8,x=f*_*4,v=e._GetRGBAArrayBuffer(f,_,m,x,i,A,P,k,O),e.uploadDataToTexture(t,r,v,C,D,N,B,L));else if(n.isLuminance){var U=t.getParameter(t.UNPACK_ALIGNMENT),V=f;x=Math.floor((f+U-1)/U)*U*(_-1)+V,v=e._GetLuminanceArrayBuffer(f,_,m,x,i),D=t.LUMINANCE,N=t.LUMINANCE,C=t.UNSIGNED_INT,e.uploadDataToTexture(t,r,v,C,D,N,B,L)}else x=Math.max(4,f)/4*Math.max(4,_)/4*E,v=new Uint8Array(i,m,x),C=t.UNSIGNED_INT,e.uploadCompressedDataToTextureDirectly(t,r,M,f,_,v,B,L)}m+=T?f*_*(T/8):x,f*=.5,_*=.5,f=Math.max(1,f),_=Math.max(1,_)}if(void 0!==d)break}}else console.error("Compressed textures are not supported on this platform.");else console.error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else console.error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}(),h=r(1),d=r(26),p=r(2),f=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),_=function(e){function t(t,r){var i=e.call(this,t,r)||this;i._resizeImage=function(e,t){var r=1;(e.width>t||e.height>t)&&(r=t/Math.max(e.width,e.height));var n=p.a.floorPowerOfTwo,a=n(r*e.width),o=n(r*e.height);i._canvas||(i._canvas=i._createCanvas(a,o));var s=i._canvas;return s.width=a,s.height=o,s.getContext("2d").drawImage(e,0,0,a,o),console.warn("Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")"),s};var n=r.gl;return i._texture=null,i._internalFormat=n.RGBA,i._format=n.RGBA,i._type=n.UNSIGNED_BYTE,i._wrap=n.CLAMP_TO_EDGE,i._filter=n.LINEAR,i._flipY=!1,i._mipmap=!1,i._rbo=!1,i._target=n.TEXTURE_2D,i._samples=1,i._is3d=!1,i._canvas=null,i._maxTextureSize=h.a.isMobile?Math.min(n.getParameter(n.MAX_TEXTURE_SIZE),2048):n.getParameter(n.MAX_TEXTURE_SIZE),i.width=1,i.height=1,i.depth=1,i.bytes=0,i.url=null,i}return f(t,e),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rbo",{get:function(){return this._rbo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),t.prototype.useTexture3d=function(){this._is3d=!0},t.prototype.destroy=function(t){if(void 0===t&&(t=!1),t||(this._ref--,!(this._ref>0))){if(this.ready){var r=this._manager.gl;this._rbo?r.deleteRenderbuffer(this._texture):r.deleteTexture(this._texture),this._texture=null,delete this._texture;var i;(i=r.getError())!==r.NO_ERROR&&console.log("GL error in texture.destroy(): "+i)}this._manager&&this._manager.deleteTexture(this.name),e.prototype.destroy.call(this)}},t.prototype._isPowerOfTwo=function(e){return p.a.isPowerOfTwo(e.width)&&p.a.isPowerOfTwo(e.height)},t.prototype._createCanvas=function(e,t){return"undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")},t.prototype._create=function(e){var t=this._manager.gl;this._texture=t.createTexture();var r=t.NEAREST;(this._filter!==t.LINEAR_MIPMAP_NEAREST&&this._filter!==t.NEAREST_MIPMAP_LINEAR&&this._filter!==t.LINEAR_MIPMAP_LINEAR&&this._filter!==t.LINEAR||(r=t.LINEAR),t.activeTexture(t.TEXTURE0+7),t.bindTexture(t.TEXTURE_2D,this._texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._filter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrap),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrap),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),e)?((!1===this._isPowerOfTwo(e)||e.width>this._maxTextureSize||e.height>this._maxTextureSize)&&(e=this._resizeImage(e,this._maxTextureSize)),t.texImage2D(t.TEXTURE_2D,0,this._format,this._format,this._type,e)):t.texImage2D(t.TEXTURE_2D,0,this._internalFormat,this.width,this.height,0,this._format,this._type,null);this._mipmap&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},t.prototype.updateImage=function(e,t,r,i,n){this.ready=!1,this.createFromImage(e,t,r,i,n)},t.prototype.createFromImage=function(e,t,r,i,n,a){void 0===a&&(a=!1);var o=this._manager.gl;this.ready||(this._format=t,this._type=r,this.width=e.width,this.height=e.height,this._filter=i,this._wrap=n,this._filter!==o.LINEAR_MIPMAP_NEAREST&&this._filter!==o.NEAREST_MIPMAP_LINEAR&&this._filter!==o.LINEAR_MIPMAP_LINEAR&&this._filter!==o.NEAREST_MIPMAP_NEAREST||(this._mipmap=!0),this._flipY=a,this._create(e),o.getError()===o.NO_ERROR?this.ready=!0:o.deleteTexture(this._texture))},t.prototype.createFromCanvas=function(e,t,r,i,n,a){void 0===a&&(a=!1);var o=this._manager.gl;if(!this.ready){this._format=t,this._type=r,this.width=e.width,this.height=e.height,this._filter=i,this._wrap=n,this._filter!==o.LINEAR_MIPMAP_NEAREST&&this._filter!==o.NEAREST_MIPMAP_LINEAR&&this._filter!==o.LINEAR_MIPMAP_LINEAR&&this._filter!==o.NEAREST_MIPMAP_NEAREST||(this._mipmap=!0),this._flipY=a,this._texture=o.createTexture();var s=o.NEAREST;this._filter!==o.LINEAR_MIPMAP_NEAREST&&this._filter!==o.NEAREST_MIPMAP_LINEAR&&this._filter!==o.LINEAR_MIPMAP_LINEAR&&this._filter!==o.LINEAR||(s=o.LINEAR),o.activeTexture(o.TEXTURE0+7),o.bindTexture(o.TEXTURE_2D,this._texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this._filter),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,this._wrap),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,this._wrap),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this._flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),o.texImage2D(o.TEXTURE_2D,0,this._format,this._format,this._type,e),this._mipmap&&o.generateMipmap(o.TEXTURE_2D),o.bindTexture(o.TEXTURE_2D,null),o.getError()===o.NO_ERROR?this.ready=!0:o.deleteTexture(this._texture)}},t.prototype.createFromImages=function(e,t,r,i,n){var a=this._manager.gl;if(!this.ready){this._target=a.TEXTURE_CUBE_MAP,this._format=t,this._type=r,this.width=e[0].width,this.height=e[0].height,this._filter=i,this._wrap=n,this._filter!==a.LINEAR_MIPMAP_NEAREST&&this._filter!==a.NEAREST_MIPMAP_LINEAR&&this._filter!==a.LINEAR_MIPMAP_LINEAR&&this._filter!==a.NEAREST_MIPMAP_NEAREST||(this._mipmap=!0),this._texture=a.createTexture();var o=a.NEAREST;this._filter!==a.LINEAR_MIPMAP_NEAREST&&this._filter!==a.NEAREST_MIPMAP_LINEAR&&this._filter!==a.LINEAR_MIPMAP_LINEAR&&this._filter!==a.LINEAR||(o=a.LINEAR),a.activeTexture(a.TEXTURE0+7),a.bindTexture(a.TEXTURE_CUBE_MAP,this._texture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,this._filter),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,o),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,this._wrap),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,this._wrap),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this._format,this._format,this._type,e[0]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this._format,this._format,this._type,e[1]),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this._format,this._format,this._type,e[2]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,this._format,this._format,this._type,e[3]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this._format,this._format,this._type,e[4]),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this._format,this._format,this._type,e[5]),this._mipmap&&a.generateMipmap(a.TEXTURE_CUBE_MAP),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.getError()===a.NO_ERROR?this.ready=!0:a.deleteTexture(this._texture)}},t.prototype.createFromDDS=function(e,t){var r=this;d.a.OpenFile1(e,"arraybuffer",Promise).downloadFile().then(function(e){var i=c.GetDDSInfo(e.data);r.width=i.width,r.height=i.height;var n=i.isRGB||i.isLuminance||i.mipmapCount>1,a=r._manager.gl;r._texture=a.createTexture(),i.isCube?(r._target=a.TEXTURE_CUBE_MAP,r._filter=a.LINEAR_MIPMAP_LINEAR):(r._target=a.TEXTURE_2D,r._filter=a.LINEAR);var o=a.LINEAR;r._wrap=a.CLAMP_TO_EDGE,a.activeTexture(a.TEXTURE0+7),a.bindTexture(r._target,r._texture),a.texParameteri(r._target,a.TEXTURE_MIN_FILTER,r._filter),a.texParameteri(r._target,a.TEXTURE_MAG_FILTER,o),a.texParameteri(r._target,a.TEXTURE_WRAP_S,r._wrap),a.texParameteri(r._target,a.TEXTURE_WRAP_T,r._wrap),c.UploadDDSLevels(a,r,e.data,i,n,6,-1),a.bindTexture(a.TEXTURE_CUBE_MAP,null),i.isFourCC||1!==i.mipmapCount||r.generateCubeMapMipMap(),a.getError()===a.NO_ERROR?r.ready=!0:a.deleteTexture(r._texture),t&&t()})},t.prototype.createFromFiles=function(e,t,r,i,n){var a=this;if(6===e.length){var o=[],s=0;e.forEach(function(l,u){var c=new Image;c.crossOrigin="anonymous",o.push(c),c.onload=function(){++s===e.length&&(a.createFromImages(o,t,a._manager.gl.UNSIGNED_BYTE,r,i),n&&n(a))},c.src=l})}else console.warn("file length should be 6.")},t.prototype.createFromFile=function(e,t,r,i,n){var a=this;if(!this.ready){var o=new Image;o.crossOrigin="anonymous",o.onload=function(){a.createFromImage(o,t,a._manager.gl.UNSIGNED_BYTE,r,i),n&&n(a)},o.src=e}},t.prototype.create=function(e,t,r,i,n,a,o){var s=this._manager.gl;if(!this.ready){r=r||s.RGBA;var l=s.UNSIGNED_BYTE;this.width=e,this.height=t,this.depth,this._filter=i||s.LINEAR,this._wrap=n||s.CLAMP_TO_EDGE;var u=r;if(s.isWebGL2&&(this._samples=a||1),r===s.RGB32F||r===s.RGBA32F||r===s.R32F){if(!s.floatTextureExtension&&!s.isWebGL2)return void console.error("Unsupported texture format for texture "+this.name);l=s.FLOAT,r=r===s.RGB32F?s.RGB:r===s.RGBA32F?s.RGBA:s.RED}else if(r===s.RGB16F||r===s.RGBA16F||r===s.R16F)l=s.HALF_FLOAT,r=r===s.RGB16F?s.RGB:r===s.RGBA16F?s.RGBA:s.RED;else if(r===s.RGBA8||r===s.RGBA)l=s.UNSIGNED_BYTE,r=s.RGBA;else if(r===s.RGB8||r===s.RGB)l=s.UNSIGNED_BYTE,r=s.RGB;else if(r===s.R8)l=s.UNSIGNED_BYTE,r=s.isWebGL2?s.RED:s.ALPHA;else if(r===s.DEPTH_COMPONENT16||r===s.DEPTH_COMPONENT24||r===s.DEPTH_COMPONENT32||r===s.DEPTH_COMPONENT){if(!s.depthTextureExtension&&!s.isWebGL2)return void console.error("Unsupported texture format for texture "+this.name);l=s.UNSIGNED_INT,r===s.DEPTH_COMPONENT16?l=s.UNSIGNED_SHORT:r!==s.DEPTH_COMPONENT24&&r!==s.DEPTH_COMPONENT32||(l=s.UNSIGNED_INT),r=s.DEPTH_COMPONENT}else if(r===s.DEPTH24_STENCIL8||r===s.DEPTH_STENCIL)l=s.isWebGL2?s.UNSIGNED_INT_24_8:s.depthTextureExtension.UNSIGNED_INT_24_8_WEBGL,r=s.DEPTH_STENCIL;else{if(r!==s.ALPHA&&r!==s.LUMINANCE_ALPHA&&r!==s.LUMINANCE)return void console.error("Unsupported texture format for texture "+this.name);l=s.UNSIGNED_BYTE}this._format=r,this._internalFormat=s.isWebGL2?u:r,this._type=l;var c=s.NEAREST;if(this._filter!==s.LINEAR_MIPMAP_NEAREST&&this._filter!==s.NEAREST_MIPMAP_LINEAR&&this._filter!==s.LINEAR_MIPMAP_LINEAR&&this._filter!==s.LINEAR||(c=s.LINEAR),s.isWebGL2)if(a>1){if(this._texture=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._texture),s.renderbufferStorageMultisample(s.RENDERBUFFER,this._samples,this._internalFormat,this.width,this.height),s.getError()!==s.NO_ERROR)return void s.deleteRenderbuffer(this._texture);this._rbo=!0}else this._texture=s.createTexture(),s.activeTexture(s.TEXTURE0+7),this._is3d?(s.bindTexture(s.TEXTURE_3D,this._texture),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,this._filter),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,c),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,this._wrap),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,this._wrap),s.texStorage2D(s.TEXTURE_3D,1,this._internalFormat,this.width,this.height,this.depth)):(s.bindTexture(s.TEXTURE_2D,this._texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this._filter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,this._wrap),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,this._wrap),s.texStorage2D(s.TEXTURE_2D,1,this._internalFormat,this.width,this.height));else if(this._format!==s.DEPTH24_STENCIL8||s.depthTextureExtension)this._texture=s.createTexture(),s.activeTexture(s.TEXTURE0+7),s.bindTexture(s.TEXTURE_2D,this._texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this._filter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,this._wrap),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,this._wrap),s.texImage2D(s.TEXTURE_2D,0,this._internalFormat,this.width,this.height,0,this._internalFormat,this._type,null);else{if(this._texture=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._texture),s.renderbufferStorage(s.RENDERBUFFER,this._internalFormat,e,t),s.getError()!==s.NO_ERROR)return void s.deleteRenderbuffer(this._texture);this._rbo=!0}s.getError()===s.NO_ERROR?this.ready=!0:s.deleteTexture(this._texture)}},t.prototype.createFromArraybuffer=function(e,t,r,i,n,a,o){this.width=a,this.height=o,this._format=t,this._type=r,this._filter=i,this._wrap=n;var s=this._manager.gl;this._texture=s.createTexture();var l=s.LINEAR;s.activeTexture(s.TEXTURE0+7),s.bindTexture(s.TEXTURE_2D,this._texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,l),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,a,o,0,t,r,e),s.bindTexture(s.TEXTURE_2D,null),s.getError()===s.NO_ERROR?this.ready=!0:s.deleteTexture(this._texture)},t.prototype.update=function(e){var t=this._manager.gl;t.activeTexture(t.TEXTURE0+7),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),this._format===t.LUMINANCE&&t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,this._format,this._type,e),this._format===t.LUMINANCE&&t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.getError()===t.NO_ERROR?this.ready=!0:t.deleteTexture(this._texture)},t.prototype.copy=function(){var e=this._manager.gl;if(!this._rbo){this.ready=!1;var t=this.width,r=this.height;e.activeTexture(e.TEXTURE0+7),e.bindTexture(e.TEXTURE_2D,this._texture),e.copyTexSubImage2D(e.TEXTURE_2D,0,0,0,0,0,t,r),e.getError()===e.NO_ERROR&&(this.ready=!0),e.bindTexture(e.TEXTURE_2D,null)}},t.prototype.resize=function(e,t){var r=this._manager.gl;if(this.ready&&(this.width!==e||this.height!==t)){if(e>4096&&(e=4096),t>4096&&(t=4096),this.width=e,this.height=t,-1!==this.name.search(/-[0-9]+x[0-9]+-/)){var i=this.name.split("-"),n=i[0]+"-"+this.width+"x"+this.height+"-"+i[2];this._manager.renameTexture(this.name,n),this.name=n}this.ready=!1,this._rbo?(r.bindRenderbuffer(r.RENDERBUFFER,this._texture),this._samples<=1?r.renderbufferStorage(r.RENDERBUFFER,this._internalFormat,e,t):r.renderbufferStorageMultisample(r.RENDERBUFFER,this._samples,this._internalFormat,this.width,this.height),r.getError()===r.NO_ERROR?this.ready=!0:r.deleteRenderbuffer(this._texture),r.bindRenderbuffer(r.RENDERBUFFER,null)):(r.deleteTexture(this._texture),this._create(null),r.getError()===r.NO_ERROR?this.ready=!0:r.deleteTexture(this._texture))}},t.prototype.generateMipmap=function(){var e=this._manager.gl;!this.ready||this._rbo||this._mipmap||(this._mipmap=!0,e.activeTexture(e.TEXTURE0+7),e.bindTexture(e.TEXTURE_2D,this._texture),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.bindTexture(e.TEXTURE_2D,null))},t.prototype.generateCubeMapMipMap=function(){var e=this._manager.gl;!this.ready||this._rbo||this._mipmap||(this._mipmap=!0,e.activeTexture(e.TEXTURE0+7),e.bindTexture(e.TEXTURE_CUBE_MAP,this._texture),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.bindTexture(e.TEXTURE_CUBE_MAP,null))},t.prototype.use=function(e){var t=this._manager.gl;this.ready&&!this._rbo?(t.activeTexture(t.TEXTURE0+e),t.bindTexture(this._target,this._texture)):console.warn("texture "+this.name+" is either not ready or not bindable.")},t.prototype.isFloating=function(){var e=this._manager.gl;return this._type===e.FLOAT||this._type===e.isWebGL2?e.UNSIGNED_INT_24_8:e.depthTextureExtension.UNSIGNED_INT_24_8_WEBGL},t.prototype.isMultisamples=function(){return this._samples>1},t.prototype.hasAlpha=function(){var e=this._manager.gl;return this._format===e.RGBA||this._format===e.RGBA32F||this._format===e.RGBA16F||this._format===e.RGBA8},t.prototype.getSize=function(){var e=this._manager.gl;if(!this.ready)return 0;var t=this.width*this.height;switch(this._format){case e.RG:t*=2;break;case e.RGB:t*=3;break;case e.RGBA:t*=4}switch(this._type){case e.FLOAT:case e.isWebGL2?e.UNSIGNED_INT_24_8:e.depthTextureExtension.UNSIGNED_INT_24_8_WEBGL:t*=4;break;case e.DEPTH_COMPONENT16:t*=2}return this.bytes=t,this.bytes},t.prototype.discard=function(){var e=this._manager.gl;this.ready&&(this._rbo?e.deleteRenderbuffer(this._texture):e.deleteTexture(this._texture),this._texture=null,this.ready=!1)},t.prototype.getFilter=function(){return this._filter},t.prototype.getWrap=function(){return this._wrap},t.prototype.setWarp=function(e){this._wrap=e},t.prototype.restore=function(){var e=this._manager.gl;this.ready||(this._rbo?this.create(this.width,this.height,this._internalFormat,this._filter,this._wrap,this._samples):this._create(null),e.getError()===e.NO_ERROR?this.ready=!0:e.deleteTexture(this._texture))},t}(i.a);t.a=_},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i,n=r(2);!function(e){e[e.ROOT=0]="ROOT",e[e.INSTANCE=1]="INSTANCE",e[e.GROUP=2]="GROUP",e[e.ELEMENT=3]="ELEMENT",e[e.NODE=4]="NODE",e[e.LINK=5]="LINK",e[e.ROOM=6]="ROOM",e[e.AREA=7]="AREA",e[e.ANY=-1]="ANY"}(i||(i={}));var a=function(){function e(e,t,r,i){this.etype=e,this.id=t,this.father=null,this.children=[],this.bbox=n.a.aabb.create(),this.model=r,this.guid="",this.name=i}return e.prototype.getNodes=function(){for(var e=[],t=[],r=0,i=this.children.length;r<i;++r){var n=this.children[r];n.hasOwnProperty("children")?t.push(n):e.push(n)}for(;t.length>0;)for(var a=t.pop(),o=0,s=a.children.length;o<s;++o){var l=a.children[o];l.hasOwnProperty("children")?t.push(l):e.push(l)}return e},e.prototype.getDocument=function(){for(var e=this.father;null!==e&&e.etype!==i.LINK;)e=e.father;return e.etype===i.LINK?e:null},e}();t.b=a},function(e,t,r){"use strict";var i=r(1),n=r(0),a=r(58),o=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},s=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},l=new Float32Array([0,0,0,0]),u=new Float32Array([0,0,0,0]),c=new Array(5),h=function(){function e(e){if(this.enabledCull=!1,arguments.length<1)throw new Error("BaseCamera requires viewport.");this._at=[0,0,0],this._theta=Math.PI,this._phi=0,this._distance=15,this._firstPerson=!1,this._fov=46,this._invTanFov=1/Math.tan(.00872665*this._fov),this._znear=.1,this._zfar=1e3,this._perspective=!0,this._twoPointsPerpective=!1,this._yVanishFactor=n.e.create(),this._height=1,this.viewport=n.e.create(),this.viewMatrix=n.a.create(),this.projectMatrix=n.a.create(),this.vpMatrix=n.a.create(),this.eye=new Float32Array([15,0,0,1]),this.viewport[0]=e[0],this.viewport[1]=e[1],this.viewport[2]=e[2],this.viewport[3]=e[3],e[3]<1&&(e[3]=1),this._aspect=e[2]/e[3],n.a.perspective(this.projectMatrix,this._fov*Math.PI/180,this._aspect,this._znear,this._zfar),n.a.identity(this.viewMatrix),this._frustumCull=new a.a(this),this.enabledCull=!1,this.uniformBlock=new Float32Array(36)}return e.prototype.destroy=function(){this.viewport=null,delete this.viewport,this.viewMatrix=null,delete this.viewMatrix,this.projectMatrix=null,delete this.projectMatrix,this.vpMatrix=null,delete this.vpMatrix,this._at=null,delete this._at,this.eye=null,delete this.eye},e.prototype.updateVP=function(){var e=Math.sin(this._phi),t=Math.cos(this._phi),r=Math.sin(this._theta),i=Math.cos(this._theta),a=this.viewMatrix,o=0,s=0;if(a[2]=t*i,a[6]=t*r,this._yVanishFactor[2]=e,this._firstPerson&&(a[2]=-a[2],a[6]=-a[6],this._yVanishFactor[2]=-this._yVanishFactor[2]),Math.abs(this._phi)>=.499999*Math.PI?(a[0]=i*this._yVanishFactor[2],a[4]=r*this._yVanishFactor[2],this._yVanishFactor[0]=-r*a[6]-i*a[2]):(a[0]=-a[6],a[4]=a[2],this._yVanishFactor[0]=0),(o=this._length(a[0],a[4],this._yVanishFactor[0]))>0&&(s=1/o,a[0]*=s,a[4]*=s,this._yVanishFactor[0]*=s),a[1]=-this._yVanishFactor[2]*a[4],a[5]=this._yVanishFactor[2]*a[0],this._yVanishFactor[1]=a[2]*a[4]-a[6]*a[0],(o=this._length(a[1],a[5],this._yVanishFactor[1]))>0&&(s=1/o,a[1]*=s,a[5]*=s,this._yVanishFactor[1]*=s),a[8]=this._yVanishFactor[0],a[9]=this._yVanishFactor[1],a[10]=this._yVanishFactor[2],a[11]=this._yVanishFactor[3],this._firstPerson?(this._at[0]=this.eye[0]-a[2]*this._distance,this._at[1]=this.eye[1]-a[6]*this._distance,this._at[2]=this.eye[2]-this._yVanishFactor[2]*this._distance):(this.eye[0]=this._at[0]+a[2]*this._distance,this.eye[1]=this._at[1]+a[6]*this._distance,this.eye[2]=this._at[2]+this._yVanishFactor[2]*this._distance),a[12]=-(a[0]*this.eye[0]+a[4]*this.eye[1]+a[8]*this.eye[2]),a[13]=-(a[1]*this.eye[0]+a[5]*this.eye[1]+a[9]*this.eye[2]),a[14]=-(a[2]*this.eye[0]+a[6]*this.eye[1]+a[10]*this.eye[2]),this._twoPointsPerpective){n.a.lookAt_correction(this.viewMatrix,this.eye,this._at,[0,0,1])}n.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},e.prototype.cull=function(e,t){return!!this.enabledCull&&this._frustumCull.isCulled(e)},e.prototype.cullUpdate=function(e){this._frustumCull.update(e)},e.prototype.setViewport=function(e,t){void 0===t&&(t=!0);var r=e[2],i=e[3];if((r>8192||i>8192)&&(r>=i?(i=Math.floor(8192*i/r),r=8192):(r=Math.floor(8192*r/i),i=8192)),i<1&&(i=1),(e[0]!==this.viewport[0]||e[1]!==this.viewport[1]||r!==this.viewport[2]||i!==this.viewport[3])&&(this.viewport[0]=e[0],this.viewport[1]=e[1],this.viewport[2]=r,this.viewport[3]=i,i<1&&(i=1),this._aspect=r/i,t)){if(this._perspective)this.projectMatrix[0]=this._invTanFov/this._aspect,this.projectMatrix[5]=this._invTanFov;else{var a=this._height*this._aspect,o=this._height;this.projectMatrix[0]=2/a,this.projectMatrix[5]=2/o}n.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)}},e.prototype.isPerspective=function(){return this._perspective},e.prototype.setPerspective=function(e){if(this._perspective!==e){if(this._perspective=e,this._perspective)this.projectMatrix[1]=this.projectMatrix[2]=this.projectMatrix[3]=this.projectMatrix[4]=this.projectMatrix[6]=this.projectMatrix[7]=this.projectMatrix[8]=this.projectMatrix[9]=this.projectMatrix[12]=this.projectMatrix[13]=this.projectMatrix[15]=0,this.projectMatrix[11]=-1,this.projectMatrix[0]=this._invTanFov/this._aspect,this.projectMatrix[5]=this._invTanFov;else{this.projectMatrix[1]=this.projectMatrix[2]=this.projectMatrix[3]=this.projectMatrix[4]=this.projectMatrix[6]=this.projectMatrix[7]=this.projectMatrix[8]=this.projectMatrix[9]=this.projectMatrix[11]=0,this.projectMatrix[12]=0,this.projectMatrix[13]=0,this.projectMatrix[15]=1;var t=this._height*this._aspect,r=this._height;this.projectMatrix[0]=2/t,this.projectMatrix[5]=2/r}n.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)}},e.prototype._setFov=function(e){this._fov!==e&&(this._fov=e,this._invTanFov=1/Math.tan(.00872665*this._fov),this._perspective&&(this.projectMatrix[0]=this._invTanFov/this._aspect,this.projectMatrix[5]=this._invTanFov))},e.prototype._setHeight=function(e){if(this._height!==e&&(this._height=e,!this._perspective)){var t=this._height*this._aspect,r=this._height;this.projectMatrix[0]=2/t,this.projectMatrix[5]=2/r}},e.prototype.updateProjection=function(e,t){var r;this._znear=e||this._znear,this._zfar=t||this._zfar,this._perspective?(r=1/(this._znear-this._zfar),this.projectMatrix[10]=(this._zfar+this._znear)*r,this.projectMatrix[14]=2*this._zfar*this._znear*r):(r=1/(this._znear-this._zfar),this.projectMatrix[10]=2*r,this.projectMatrix[14]=(this._znear+this._zfar)*r),n.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},e.prototype.reset=function(e,t){this._firstPerson=!1,this._theta=Math.PI,this._phi=0,this._distance=15,this._fov=46,this._invTanFov=1/Math.tan(.00872665*this._fov),this._perspective=!0,n.a.perspective(this.projectMatrix,this._fov*Math.PI/180,this._aspect,this._znear,this._zfar),this._at[0]=0,this._at[1]=0,this._at[2]=0,this.eye[0]=-this._distance,this.eye[1]=0,this.eye[2]=0},e.prototype.resetDefaultCam=function(){if(this._defaultCameraInfo.height&&!this._defaultCameraInfo.fov)return console.warn("Reset camera info can't be ortho."),!1;this._firstPerson=!1;var e=this._defaultCameraInfo.phi;e>=.49999*Math.PI&&(e=.49999*Math.PI),e<=-.49999*Math.PI&&(e=-.49999*Math.PI);var t=this._defaultCameraInfo.theta;(t%=2*Math.PI)>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI),this._theta=t,this._phi=e,this._distance=this._defaultCameraInfo.distance,this._fov=this._defaultCameraInfo.fov,this._invTanFov=1/Math.tan(.00872665*this._fov),this._perspective=!0,this._at=this._defaultCameraInfo.at;var r=Math.sin(this._phi),i=Math.cos(this._phi),n=Math.sin(this._theta),a=Math.cos(this._theta);this.eye[0]=this._at[0]+i*a*this._distance,this.eye[1]=this._at[1]+i*n*this._distance,this.eye[2]=this._at[2]+r*this._distance,this.updateProjection();if(this._defaultCameraInfo.theta-this._targetTheta<1e-4&&this._defaultCameraInfo.phi-this._targetPhi<1e-4&&this._defaultCameraInfo.distance-this._targetDistance<1e-4){var o=this._defaultCameraInfo.at[0]-this._targetAt[0],s=this._defaultCameraInfo.at[1]-this._targetAt[1],l=this._defaultCameraInfo.at[2]-this._targetAt[2];Math.sqrt(o*o+s*s+l*l)<=1e-4&&(this._distance+=3*1e-4)}return!0},e.prototype.unproject=function(e,t,r){var n=[0,0,0],a=[0,0,0];e=Math.floor(e*i.a.devicePixelRatio),t=Math.floor(t*i.a.devicePixelRatio);var o,s=this.viewport[2]-this.viewport[0],l=this.viewport[3]-this.viewport[1];o=void 0!==r?r:this._znear;var u,c,h=e/s*2-1,d=(l-1-t)/l*2-1;return this._perspective?(u=h*o/this.projectMatrix[0],c=d*o/this.projectMatrix[5]):(u=(h-this.projectMatrix[12])/this.projectMatrix[0],c=(d-this.projectMatrix[13])/this.projectMatrix[5]),n[0]=this.eye[0]-this.viewMatrix[2]*o,n[1]=this.eye[1]-this.viewMatrix[6]*o,n[2]=this.eye[2]-this._yVanishFactor[2]*o,a[0]=n[0]+u*this.viewMatrix[0]+c*this.viewMatrix[1],a[1]=n[1]+u*this.viewMatrix[4]+c*this.viewMatrix[5],a[2]=n[2]+u*this._yVanishFactor[0]+c*this._yVanishFactor[1],a},e.prototype.project=function(e,t){var r=n.e.create();null!==t&&void 0!==t?n.d.transformMat4(r,e,t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=1;var a=n.e.create();n.e.transformMat4(a,r,this.vpMatrix),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];var o=this.viewport[3]-this.viewport[1],s=(a[0]+1)/2*this.viewport[2]+this.viewport[0],l=(a[1]+1)/2*o;return[s/=i.a.devicePixelRatio,l=(o-1-l)/i.a.devicePixelRatio,Math.sign(a[3])]},e.prototype.setFirstPerson=function(e){this._firstPerson!==e&&(this._theta=Math.PI+this._theta,this._phi=-this._phi,this._firstPerson=e)},e.prototype._length=function(e,t,r){return Math.sqrt(e*e+t*t+r*r)},e.prototype.getViewDirection=function(){return l[0]=-this.viewMatrix[2],l[1]=-this.viewMatrix[6],l[2]=-this._yVanishFactor[2],l},e.prototype.getEye=function(){return u[0]=this.eye[0],u[1]=this.eye[1],u[2]=this.eye[2],u[3]=1,u},e.prototype.jitter=function(e,t){this._perspective?(this.projectMatrix[8]+=2*e,this.projectMatrix[9]+=2*t):(this.projectMatrix[12]+=2*e,this.projectMatrix[13]+=2*t),n.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},e.prototype.getNearPlaneSize=function(){if(this._perspective){var e=Math.tan(.017453293*this._fov*.5)*this._znear;return[e*this._aspect,e,-this._znear]}return[1/this.projectMatrix[0],1/this.projectMatrix[5],1]},e.prototype.getFarPlaneSize=function(){if(this._perspective){var e=Math.tan(.017453293*this._fov*.5)*this._zfar;return[e*this._aspect,e,-this._zfar]}return[1/this.projectMatrix[0],1/this.projectMatrix[5],1]},e.prototype.transformPerspectiveToOrthogonal=function(){this._perspective&&(this.setPerspective(!1),this._setHeight(this._distance),this._distance+=3e-4)},e.prototype.shootRay=function(e,t,r,i){var a=this.unproject(e,t);this._perspective?(r[0]=this.eye[0],r[1]=this.eye[1],r[2]=this.eye[2],i[0]=a[0]-r[0],i[1]=a[1]-r[1],i[2]=a[2]-r[2]):(r[0]=a[0],r[1]=a[1],r[2]=a[2],i[0]=-this.viewMatrix[2],i[1]=-this.viewMatrix[6],i[2]=-this._yVanishFactor[2]),n.d.normalize(i,i)},e.prototype.transformOrthogonalToPerspective=function(){this._perspective||(this.setPerspective(!0),this._distance+=15e-5)},e.prototype.copy=function(e){this._at[0]=e._at[0],this._at[1]=e._at[1],this._at[2]=e._at[2],this._theta=e._theta,this._phi=e._phi,this._distance=e._distance,this._firstPerson=e._firstPerson,this._fov=e._fov,this._invTanFov=e._invTanFov,this._znear=e._znear,this._zfar=e._zfar,this._aspect=e._aspect,this._perspective=e._perspective,this._height=e._height,n.e.copy(this.viewport,e.viewport),n.a.copy(this.viewMatrix,e.viewMatrix),n.a.copy(this.projectMatrix,e.projectMatrix),n.a.copy(this.vpMatrix,e.vpMatrix),n.e.copy(this.eye,e.eye)},e.prototype.split=function(e,t){for(var r=this._znear,i=this._zfar,a=r,o=.1*(i-r),s=1;s<e;s++){var l=s/e,u=.5*(r*Math.pow(i/r,l)+r+Math.pow(i-r,l))+o;(h=t[s-1]).copy(this),h.updateProjection(a,u),n.a.multiply(h.vpMatrix,h.projectMatrix,h.viewMatrix),a=u,c[s-1]=u}var h;return(h=t[e-1]).copy(this),h.updateProjection(a,i),n.a.multiply(h.vpMatrix,h.projectMatrix,h.viewMatrix),c},e.prototype.setPose=function(e,t){this.eye=e,this._at=t,this._distance=n.d.distance(e,t);var r=[e[0]-t[0],e[1]-t[1],0],i=e[2]-t[2];this._phi=Math.asin(i/this._distance),this._theta=n.d.angleTo([1,0,0],r),this._targetAt=s(t),this._targetPhi=this._phi,this._targetTheta=this._theta,this._targetDistance=this._distance,this.updateVP()},e}();t.a=h},function(e,t,r){"use strict";var i=r(17),n=r(4),a=r(12),o=r(9),s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),l=function(e){function t(t){var r=e.call(this,t)||this;return r.setSide(a.a.DOUBLESIDE),r}return s(t,e),t.prototype.attachShader=function(e,t){if(e&&e.ready){for(var r in e.userUniforms)if(!this.parameters.hasOwnProperty(r))if(this.parameters[r]=new o.a,r.match(/uTexture\d/)){this.hasTexture=!0;var i=parseInt(r.substr(8));if(i>2){console.error("can't support >3 user textures. See shader '"+e.name+"'");continue}this.parameters[r].texUnit=i,this.parameters[r].upload=this.parameters[r].uploadTexture}else this.parameters[r].upload=this.parameters[r].uploadValue;for(var n in e.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uSkyTexture"===n?(this.reservedParameters[n]=new o.a,this.hasTexture=!0,this.reservedParameters[n].texUnit=4,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uTransparency"===n?(this.reservedParameters[n]=new o.a,this.reservedParameters[n].value=1,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uTextureOffset"===n&&(this.reservedParameters[n]=new o.a,this.reservedParameters[n].value=0,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));for(var a in this.reservedParameters)e.reservedUniforms[a]||delete this.reservedParameters[a];return e}},t.prototype.setTexture=function(e){this.reservedParameters.m_uSkyTexture.value=e},t.prototype.setTextureOffset=function(e){this.reservedParameters.m_uTextureOffset.value=e},t.prototype.texture=function(){return this.reservedParameters.m_uSkyTexture.value},t.prototype.setTransparency=function(e){this.reservedParameters.m_uTransparency.value=e},t}(a.b),u=r(22),c=r(16),h=r(0),d=r(3);r.d(t,"a",function(){return p});var p,f=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e[e.SKYBOX_SOLIDCOLOR=0]="SKYBOX_SOLIDCOLOR",e[e.SKYBOX_WALLPAPER=1]="SKYBOX_WALLPAPER",e[e.SKYBOX_EQUIRECTANGLE=2]="SKYBOX_EQUIRECTANGLE",e[e.SKYBOX_CUBEMAP=3]="SKYBOX_CUBEMAP",e[e.SKYBOX_WALLPAPER_TILED=4]="SKYBOX_WALLPAPER_TILED"}(p||(p={}));var _=function(e){function t(t){var r=e.call(this,null,null,null,null,null)||this;r._resourceManager=t,r._mode=-1,r._flipY=!1,r.camera=new u.a([0,0,1,1]);for(var i=0,n="model-skybox-texture-"+i;r._resourceManager.hasTexture(n);)n="model-skybox-texture-"+ ++i;return r._texture=r._resourceManager.getTexture(n),r.visible=!1,r.material=new l(n),r.setMode(p.SKYBOX_EQUIRECTANGLE),r}return f(t,e),t.prototype.destroy=function(){this._texture&&this._texture.destroy(),delete this._texture,this.camera.destroy(),delete this.camera,this._resourceManager=null,delete this._resourceManager,this._flipY=null,delete this._flipY,e.prototype.destroy.call(this)},t.prototype.update=function(e){if(this._mode===p.SKYBOX_WALLPAPER_TILED&&this.visible){var t=this.camera.viewport[3]-this.camera.viewport[1],r=this._texture.height/this._texture.width*(i/t),i=this.camera.viewport[2]-this.camera.viewport[0];this.transform.setScaling(1,r,1),this.transform.setTranslation(0,1-r,1)}else h.a.copy(this.camera.viewMatrix,e),this.camera.viewMatrix[12]=0,this.camera.viewMatrix[13]=0,this.camera.viewMatrix[14]=0,h.a.multiply(this.camera.vpMatrix,this.camera.projectMatrix,e)},t.prototype.resize=function(e,t){this.camera.setViewport([0,0,e,t])},t.prototype._updateMaterial=function(){this.visible=this._texture.ready,this.visible?this.material.setTexture(this._texture):console.warn("skybox sees a corrupted image.")},t.prototype.setImage=function(e){var t=this;if(e){if(this._texture&&this._texture.ready){this._texture.destroy();for(var r=0,n="model-skybox-texture-"+r;this._resourceManager.hasTexture(n);)n="model-skybox-texture-"+ ++r;this._texture=this._resourceManager.getTexture(n)}if(e&&i.a.isArray(e))e[0]instanceof HTMLImageElement?(this._texture.createFromImages(e,d.a.RGB,d.a.UNSIGNED_BYTE,d.a.LINEAR,d.a.CLAMP_TO_EDGE),this._updateMaterial()):this._texture.createFromFiles(e,d.a.RGB,d.a.LINEAR,d.a.CLAMP_TO_EDGE,function(){t._updateMaterial()}),this.visible=this._texture.ready,this.visible?this.material.setTexture(this._texture):console.warn("skybox sees a corrupted image.");else if(e instanceof HTMLImageElement)this._texture.createFromImage(e,d.a.RGB,d.a.UNSIGNED_BYTE,d.a.LINEAR,d.a.CLAMP_TO_EDGE),this._updateMaterial(),this.visible=this._texture.ready,this.visible?this.material.setTexture(this._texture):console.warn("skybox sees a corrupted image.");else{var a=e.split(".");"dds"==a[a.length-1].toLocaleLowerCase()&&this._texture.createFromDDS(e,function(){t._updateMaterial(),t.visible=t._texture.ready,t.visible?t.material.setTexture(t._texture):console.warn("skybox sees a corrupted image.")})}}else this.visible=!1},t.prototype.getMode=function(){return this._mode},t.prototype.setMode=function(e){if(this._mode!==e){this._mode=e;var t=n.a.skybox;if(this._mode===p.SKYBOX_WALLPAPER)this.mesh=this._resourceManager.getMesh("quad"),this.mesh.ready||this.mesh.createQuad(),this.shader=this._resourceManager.getShader("skybox",["WALLPAPER"]),this.shader.ready||this.shader.createFromShaderSource(t,["WALLPAPER"]),this.transform.reset();else if(this._mode===p.SKYBOX_WALLPAPER_TILED)this.mesh=this._resourceManager.getMesh("quad"),this.mesh.ready||this.mesh.createQuad(),this.shader=this._resourceManager.getShader("skybox",["WALLPAPER","MODEL_TRANSFORM"]),this.shader.ready||this.shader.createFromShaderSource(t,["WALLPAPER","MODEL_TRANSFORM"]),this.transform.reset();else if(this._mode===p.SKYBOX_EQUIRECTANGLE)this.mesh=this._resourceManager.getMesh("sphere-64-128"),this.mesh.ready||this.mesh.createSphere(64,128),this.shader=this._resourceManager.getShader("skybox",["EQUIRECTANGLE"]),this.shader.ready||this.shader.createFromShaderSource(t,["EQUIRECTANGLE"]);else if(this._mode===p.SKYBOX_CUBEMAP){this.mesh=this._resourceManager.getMesh("sphere-64-128"),this.mesh.ready||this.mesh.createSphere(64,p.SKYBOX_CUBEMAP);var r=["CUBEMAP"];this._flipY&&r.push("FLIP"),this.shader=this._resourceManager.getShader("skybox",r),this.shader.ready||this.shader.createFromShaderSource(t,r)}this.material.attachShader(this.shader),this.material.setTexture(this._texture),this.material.setTransparency(1)}},t.prototype.setTransparency=function(e){this.material.setTransparency(e)},t.prototype.setFlipYEnabled=function(e){this._flipY=e,this._mode=-1,this.setMode(p.SKYBOX_CUBEMAP)},t.prototype.getTexture=function(){return this._texture},t.prototype.setDirection=function(e){this._mode===p.SKYBOX_EQUIRECTANGLE&&(this.material.setTextureOffset(e),this._direction=e)},t.prototype.getDirection=function(){return this._direction},t.prototype.setFov=function(e){this.camera._setFov(e)},t}(c.a);t.b=_},function(e,t,r){"use strict";var i=r(0),n=r(51),a=r(1),o=r(4),s=r(12),l=r(22),u=r(8),c=[],h=function(){function e(e,t){this._drawableNotUseOverride=[],this._scene=e,this._renderTarget=null,this._shaders=[null,null,null],this._ready=!1,this._phonyCamera=new l.a([0,0,5,5]),this._phonyCamera.enabledCull=!0,this._pickMatrix=i.a.create(),this._material=new s.b("depth-query"),this._gl=t.gl,this._ray=new n.a,this.recompileShader(t,[]),this._renderTarget=new u.a("query",t,5,5,{clearColor:[0,0,0,0],clearDepth:1}),this._ready=this._renderTarget.ready}return Object.defineProperty(e.prototype,"phonyCamera",{get:function(){return this._phonyCamera},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._ready&&(this._material.destroy(),this._material=null,delete this._material,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._pickMatrix=null,delete this._pickMatrix,this._phonyCamera=null,delete this._phonyCamera)},e.prototype._begin=function(e,t,r,n,a,o){t=r.viewport[3]-1-t,this._pickMatrix[0]=r.viewport[2]/a,this._pickMatrix[5]=r.viewport[3]/o,this._pickMatrix[12]=(r.viewport[2]-2*e)/a,this._pickMatrix[13]=(r.viewport[3]-2*t)/o,i.a.multiply(this._phonyCamera.vpMatrix,this._pickMatrix,r.vpMatrix),this._phonyCamera.viewport[0]=r.viewport[0],this._phonyCamera.viewport[1]=r.viewport[1],this._phonyCamera.viewport[2]=a,this._phonyCamera.viewport[3]=o,i.d.copy(this._phonyCamera.eye,r.eye),i.d.copy(this._phonyCamera._at,r._at)},e.prototype._end=function(e,t){var r=this._gl;if(e||t){s=new Uint8Array(e*t*4);r.readPixels(0,0,e,t,r.RGBA,r.UNSIGNED_BYTE,s);for(var i=Number.POSITIVE_INFINITY,n=e*t,a=0;a<n;a+=1)if(0!==s[4*a+0]||0!==s[4*a+1]||0!==s[4*a+2]||0!==s[4*a+3]){var o=s[4*a+0]/255*(1/16581375)+s[4*a+1]/255*(1/65025)+s[4*a+2]/255*(1/255)+s[4*a+3]/255;o<i&&(i=o)}return i===Number.POSITIVE_INFINITY?null:i}var s=new Uint8Array(4);return r.readPixels(2,2,1,1,r.RGBA,r.UNSIGNED_BYTE,s),0===s[0]&&0===s[1]&&0===s[2]&&0===s[3]?null:s[0]/255*(1/16581375)+s[1]/255*(1/65025)+s[2]/255*(1/255)+s[3]/255},e.prototype._genGodViewPhonyCameraAt=function(e){var t=[e[0],e[1],e[2]-1];i.a.lookAt(this._phonyCamera.viewMatrix,e,t,[0,1,0]),i.a.ortho(this._phonyCamera.projectMatrix,-2.5,2.5,-2.5,2.5,.1,1000.1),i.a.mul(this._phonyCamera.vpMatrix,this._phonyCamera.projectMatrix,this._phonyCamera.viewMatrix),this._phonyCamera.cullUpdate(this._scene.bbox)},e.prototype._renderScene=function(e){var t=this._gl;e.clear(this._renderTarget,t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this._scene.clipping.isEnabled()&&e.renderState.invalidateClip(),this._renderModels(e),this._renderMaps(e)},e.prototype._renderModels=function(e){for(var t in this._scene.models)e.drawDrawables(this._renderTarget,this._scene.models[t].drawables,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,!this._scene.needRenderDoubleSided()&&this._gl.CCW)},e.prototype._renderMaps=function(e){if(this._scene.maps){var t=[];this._scene.maps.forEach(function(e){e.mapTiles.forEach(function(e){t.push(e.drawable)})}),e.drawDrawables(this._renderTarget,t,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,this._gl.CCW)}},e.prototype.getHeightUnder=function(e,t){if(!this._ready)return null;this._renderTarget.resize(5,5),this._genGodViewPhonyCameraAt(e),this._renderScene(t);var r=this._end();return r?r>.9?null:this._getPosition(0,0,r,this._phonyCamera)[2]:null},e.prototype.getIntersectionUnder=function(e,t){if(!this._ready)return null;var r=e.eye;this._renderTarget.resize(5,5),this._genGodViewPhonyCameraAt(r),this._renderScene(t);var i=this._end();return i?[r[0],r[1],this._getPosition(0,0,i,this._phonyCamera)[2]]:null},e.prototype.unproject=function(e,t,r,i,n,o){if(!this._ready)return null;var s=this._gl;e=Math.floor(e*a.a.devicePixelRatio),t=Math.floor(t*a.a.devicePixelRatio),this._renderTarget.resize(5,5),this._begin(e,t,i,r,5,5),this._phonyCamera.cullUpdate(this._scene.bbox),r.clear(this._renderTarget,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this._scene.clipping.isEnabled()&&r.renderState.invalidateClip();var l=void 0!==o||this._scene.needRenderDoubleSided();if(n&&n.length>0)this.beforeRenderWithOverride(n),r.drawDrawables(this._renderTarget,n,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,!l&&s.CCW),this.afterRenderWithOverride();else{for(var u in this._scene.models)this.beforeRenderWithOverride(this._scene.models[u].drawables),r.drawDrawables(this._renderTarget,this._scene.models[u].drawables,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,!l&&s.CCW),this.afterRenderWithOverride();for(var h in this._scene.pawns)this.beforeRenderWithOverride(this._scene.pawns[h].drawables),r.drawDrawables(this._renderTarget,this._scene.pawns[h].drawables,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,!l&&s.CCW),this.afterRenderWithOverride();this._scene.maps&&(c.length=0,this._scene.maps.forEach(function(e){e.mapTiles.forEach(function(e){c.push(e.drawable)})}),c.length>0&&(this.beforeRenderWithOverride(c),r.drawDrawables(this._renderTarget,c,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,null,s.CCW),this.afterRenderWithOverride()))}var d=this._end();return null===d?null:this._getPosition(e,t,d,i)},e.prototype.getNearest=function(e,t,r,i,n,o){if(!this._ready)return null;var s=this._gl;e=Math.floor(e*a.a.devicePixelRatio),t=Math.floor(t*a.a.devicePixelRatio),r=Math.floor(r*a.a.devicePixelRatio),i=Math.floor(i*a.a.devicePixelRatio);var l=Math.floor((e+r)/2),u=Math.floor((t+i)/2),h=r-e,d=i-t;for(var p in this._renderTarget.resize(h,d),this._begin(l,u,o,n,h,d),this._phonyCamera.cullUpdate(this._scene.bbox),n.clear(this._renderTarget,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this._scene.clipping.isEnabled()&&n.renderState.invalidateClip(),this._scene.models)n.drawDrawables(this._renderTarget,this._scene.models[p].drawables,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,!this._scene.needRenderDoubleSided()&&s.CCW);this._scene.maps&&(c.length=0,this._scene.maps.forEach(function(e){e.mapTiles.forEach(function(e){c.push(e.drawable)})}),n.drawDrawables(this._renderTarget,c,this._phonyCamera,this._shaders,this._material,this._scene.clipping,null,null,s.CCW));var f=this._end(h,d);return null===f?null:this._getPosition(l,u,f,o)},e.prototype._getPosition=function(e,t,r,n){var a=n.viewport[2],o=n.viewport[3],s=i.e.fromValues(2*(e/a-.5),2*((o-1-t)/o-.5),2*r-1,1),l=i.a.create();i.a.invert(l,n.vpMatrix);var u=i.e.create();return i.e.transformMat4(u,s,l),0!==u[3]?(s[0]=u[0]/u[3],s[1]=u[1]/u[3],s[2]=u[2]/u[3],s[3]=1):i.e.copy(s,u),s},e.prototype.recompileShader=function(e,t){var r=t.slice(0);r.push("ENCODE_DEPTH"),this._shaders[0]=e.getShader("depth-query",r),this._shaders[0].ready||this._shaders[0].createFromShaderSource(o.a.depth,r),r.push("MODEL_TRANSFORM"),this._shaders[1]=e.getShader("depth-query",r),this._shaders[1].ready||this._shaders[1].createFromShaderSource(o.a.depth,r),r.push("INSTANCING"),this._shaders[2]=e.getShader("depth-query",r),this._shaders[2].ready||this._shaders[2].createFromShaderSource(o.a.depth,r),this._material.attachShader(this._shaders[0])},e.prototype.beforeRenderWithOverride=function(e){var t=this;this._drawableNotUseOverride.length=0,e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},e.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1})},e}();t.a=h},function(e,t,r){"use strict";var i=r(0),n=r(11),a=function(){function e(e){this._name=null,this._saved=null,this._camera=null,this._timePre=null,this._vMove=2*n.a.Meter2Foot,this._vRotate=10*n.a.Deg2Rad,this._vFov=10*n.a.Deg2Rad,this._name=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype.setMoveSpeed=function(e){this._vMove=e*n.a.Meter2Foot},e.prototype.getMoveSpeed=function(){return this._vMove*n.a.Foot2Meter},e.prototype.setRotateSpeed=function(e){this._vRotate=e*n.a.Deg2Rad},e.prototype.getRotateSpeed=function(){return this._vRotate*n.a.Rad2Deg},e.prototype.setFovSpeed=function(e){this._vFov=e*n.a.Deg2Rad},e.prototype.getFovSpeed=function(){return this._vFov*n.a.Rad2Deg},e.prototype.destroy=function(){this._camera=null,delete this._camera},e.prototype.attach=function(e){this._saved&&this===e.animator||(this._camera=e,this._saved=this._camera.animator,this._camera.animator=this,this._timePre=Date.now())},e.prototype.detach=function(){null!==this._camera&&(this._camera.animator=this._saved,this._saved=null,this._camera=null,this._timePre=null)},e.prototype.update=function(){var e=this._getTimeElapsed();return this._update(e)},e.prototype._getTimeElapsed=function(){var e=Date.now(),t=.001*(e-this._timePre);return this._timePre=e,t},e.prototype._updateCameraViewProjectionByEyeAt=function(){var e=this._camera;i.a.lookAt(e.viewMatrix,e.eye,e._at,[0,0,1]),e._updateProjection(),i.a.multiply(e.vpMatrix,e.projectMatrix,e.viewMatrix),e._cull.update()},e.prototype._adjustThetaPhiByEyeAt=function(){var e=this._camera;e._targetDistance=e._distance,e._targetEye=[e.eye[0],e.eye[1],e.eye[2]],e._targetAt=e._at;var t=e.eye[0]-e._at[0],r=e.eye[1]-e._at[1],i=e.eye[2]-e._at[2],n=Math.atan2(r,t);n+=e._firstPerson?Math.PI:0;var a=Math.asin(Math.min(i/e._targetDistance,1));a=Math.min(a,.49999*Math.PI),a=Math.max(a,-.49999*Math.PI),a*=e._firstPerson?-1:1,e._theta=e._targetTheta=n,e._phi=e._targetPhi=a},e}();t.a=a},function(e,t,r){"use strict";var i,n=new URL(window.location.href).searchParams.get("filePath"),a=new Map;!function(e){e.OpenImage=function(e,t){return{downloadFile:function(){var r=e;return new t(function(e,t){var i=new XMLHttpRequest;i.onload=function(t){var r=URL.createObjectURL(this.response),i=new Image;return i.setAttribute("crossorigin","anonymous"),i.onload=function(){e(i),URL.revokeObjectURL(r)},i.src=r,null},i.open("GET",r,!0),i.responseType="blob",i.send()})}}},e.OpenFile1=function(e,t,r,i){return{downloadFile:function(o){return new r(function(r,s){i&&a.forEach(function(e){e&&e.abort()});var l=new XMLHttpRequest;a.set(e,l),l.open("GET",(n||"")+e,!0),l||s("CORS not supported"),l.responseType=t,l.onerror=function(e){s(e)},l.setRequestHeader("Accept","*/*"),l.onload=function(){200===l.status||206===l.status?r({data:l.response}):s("fail to retrieve "+e+" http status error:"+l.status),a.delete(e)},l.onprogress=function(e){o&&o(e)},l.send()})},onProgress:function(){}}};var t=function(){function e(e){this._onProgress=e,this._currentDownload=0,this.totalDownload=0}return e.prototype.onProgress=function(e,t){this._currentDownload+=e,this._onProgress(Math.max(Math.min(this._currentDownload/this.totalDownload,1),0),t)},e.prototype.setTotalDownload=function(e){this.totalDownload=e/.89,this._currentDownload=this.totalDownload-e},e.prototype.getSingleFileProgress=function(){var e=0,t=this;return function(r,i){var n=r-e;e=r,t.onProgress(n,i)}},e}();e.ProgressTracker=t,e.MakeIndividualOnProgress=function(e){var t=0;return function(r){var i=r-t;t=r,e.onprogress(i)}}}(i||(i={})),t.a=i},function(e,t,r){"use strict";var i;r.d(t,"a",function(){return i}),function(e){e.Family="family",e.Level="level",e.Element="element",e.Category="category",e.Type="type",e.File="file"}(i||(i={}))},function(e,t,r){"use strict";r.d(t,"d",function(){return n}),r.d(t,"g",function(){return a}),r.d(t,"b",function(){return o}),r.d(t,"e",function(){return s}),r.d(t,"f",function(){return l}),r.d(t,"a",function(){return i}),r.d(t,"c",function(){return u});var i,n=function(e){return function(t){return e.every(function(e){return e in t})}},a=function(e){return function(t){return e.includes(t)}};function o(e,t,r){if(!t(e)){var i=JSON.stringify(e,null,2);throw Error(r+" "+i||"validation of "+i+" failed")}}function s(e){var t=e.createElement("canvas");return null!==WebGLUtils.setupWebGL(t,{webgl2:!1})}function l(e){var t=e.createElement("canvas"),r=WebGLUtils.setupWebGL(t,{webgl2:!0});return!!r&&null!==r.getParameter(r.VERSION).match("WebGL 2.0")}function u(e){var t=e.split(".");return 1===t.length?null:t[t.length-1].toLowerCase()}!function(e){e[e.FRONT=0]="FRONT",e[e.BACK=1]="BACK",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e[e.TOP=4]="TOP",e[e.BOTTOM=5]="BOTTOM",e[e.WORLD=6]="WORLD"}(i||(i={}))},function(e,t,r){"use strict";var i=r(31),n=r(46),a=r(41),o=r.n(a),s=r(43),l=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},u=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},c=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o};var h=function(e,t,r){return l(void 0,void 0,void 0,function(){var t,i,n,a,l;return u(this,function(u){switch(u.label){case 0:if(!s.a.endpoint)throw Error("ModeloAPI needs to be initialized first. Call Modelo.init().");return t=function(e){return decodeURIComponent(escape(window.atob(e)))}(e),i=c(t.split(","),2),n=i[0],a=i[1],[4,o.a.post(s.a.endpoint+"/login",{username:n,password:a},{headers:r})];case 1:return l=u.sent(),localStorage.setItem("token",l.data.token),[2]}})})},d=function(){localStorage.removeItem("token")},p=r(42),f=r(48),_=r(26),m=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},v=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},y={};function g(e,t){return m(this,void 0,void 0,function(){var r,n,a,o,s,l,u,c,h,d,m,g,b;return v(this,function(v){switch(v.label){case 0:return y[e]?[2,y[e]]:t?[3,7]:[4,Object(i.e)(e)];case 1:if(r=v.sent(),!(u=r.convertedUrls.filter(function(e){return"bim.txt"===e.filename})[0]))throw new Error("this model does not contain bim tree information");if(!(c=r.convertedUrls.filter(function(e){return"reference.csv"===e.filename})[0]))throw new Error("this model does not contain reference.csv");return(h=r.convertedUrls.find(function(e){return"docModelId.json"===e.filename}))?[4,Object(p.a)(e,h)]:[3,3];case 2:return a=v.sent().data,[3,4];case 3:a=null,v.label=4;case 4:return n=a,[4,Object(p.a)(e,u)];case 5:return o=v.sent().data,[4,Object(p.a)(e,c)];case 6:return s=v.sent().data,b=Object(f.b)(e,o,s,{useElementIdAsId:!0,docModelId:n,modelId:e,prependModelId:!0}),y[e]=b,[2,b];case 7:return u=(l=t||"/"+e)+"/bim.txt",c=l+"/reference.csv",h=l+"/docModelId.json",[4,_.a.OpenFile1(u,"",Promise).downloadFile()];case 8:return d=v.sent(),[4,_.a.OpenFile1(c,"",Promise).downloadFile()];case 9:m=v.sent(),g=null,v.label=10;case 10:return v.trys.push([10,12,,13]),[4,_.a.OpenFile1(h,"json",Promise).downloadFile()];case 11:return g=v.sent(),[3,13];case 12:return v.sent(),[3,13];case 13:return b=Object(f.b)(e,d.data,m.data,{useElementIdAsId:!0,docModelId:g?g.data:null,modelId:e,prependModelId:!0}),y[e]=b,[2,b]}})})}var b=r(99),w=r.n(b),x=r(98),M=r.n(x),E=r(97),T=r.n(E),S=r(96),A=r.n(S),P=r(66),k=r.n(P),O=r(95),D=r.n(O),N=r(94),C=r.n(N),I=r(61),R=r(15),B=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},L=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},F=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},U=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(F(arguments[t]));return e},V=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},j=/(.*)\+(.*)\/(.*)/,z=function(e,t){return B(void 0,void 0,void 0,function(){var r,i,n,a;return L(this,function(o){switch(o.label){case 0:return[4,g(e)];case 1:return r=o.sent(),Object.keys(r.elements).map(function(e){return r.elements[e]}),i=U([t[0]],t).join("<>"),[4,Object(R.a)().mutate({mutation:A.a,variables:{modelId:e,property:"MODELO-STATUS@688",strValue:i}})];case 2:if(n=o.sent(),n.data,a=n.errors)throw Error(a[0].message);return[2]}})})},G=function(e){return B(void 0,void 0,void 0,function(){var t,r;return L(this,function(i){switch(i.label){case 0:return[4,g(e)];case 1:return t=i.sent(),r=Object.keys(t.elements).map(function(e){return t.elements[e]}),[4,Object(R.a)().mutate({mutation:k.a,variables:{modelId:e,docAndCatIdArr:r.map(function(e){return e.docAndCatId}),elementIdArr:r.map(function(e){return e.elementId}),propertyArr:r.map(function(e){return"MODELO-STATUS@688"})}})];case 2:return i.sent().data,[2]}})})},H=function(e,t,r,i){return B(void 0,void 0,void 0,function(){var n,a;return L(this,function(o){switch(o.label){case 0:return[4,g(e)];case 1:return n=o.sent(),a=t.map(function(e){return n.elements[e]}),[4,Object(R.a)().mutate({mutation:M.a,variables:{modelId:e,docAndCatIdArr:a.map(function(e){return e.docAndCatId}),elementIdArr:a.map(function(e){return e.elementId}),propertyArr:a.map(function(e){return r+"@689"}),strValueArr:a.map(function(e){return i})}})];case 2:return o.sent().data,[2,!0]}})})},q=function(e,t,r,i){return B(void 0,void 0,void 0,function(){return L(this,function(n){return[2,H(e,[t],r,i)]})})},W=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n,a;return L(this,function(o){switch(o.label){case 0:if(!j.test(t))throw Error("elementId "+t+" seems not correct");return[4,$(e,t)];case 1:if(i=o.sent(),!(n=i.find(function(e){return"MODELO-STATUS"===e.name&&688===e.groupKey})))throw Error("status needs to be initialized first");return(a=n.strValue.split("<>"))[0]=r,[4,te(e,t,{name:"MODELO-STATUS",group:"MODELO",groupKey:688,strValue:a.join("<>")})];case 2:return o.sent(),[2,r]}})})},Q=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n;return L(this,function(a){switch(a.label){case 0:return[4,g(e)];case 1:return i=a.sent(),n=t.map(function(e){return i.elements[e]}),[4,Object(R.a)().mutate({mutation:k.a,variables:{modelId:e,docAndCatIdArr:n.map(function(e){return e.docAndCatId}),elementIdArr:n.map(function(e){return e.elementId}),propertyArr:n.map(function(e){return r+"@689"})}})];case 2:return a.sent().data,[2,!0]}})})},Y=function(e,t,r){return B(void 0,void 0,void 0,function(){return L(this,function(i){return[2,Q(e,[t],r)]})})},X=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n,a;return L(this,function(o){switch(o.label){case 0:return 0===t.length?[2]:1===t.length?[2,W(e,t[0],r)]:[4,$(e,t[0])];case 1:if(i=o.sent(),!(n=i.find(function(e){return"MODELO-STATUS"===e.name&&688===e.groupKey})))throw Error("status needs to be initialized first");return(a=n.strValue.split("<>"))[0]=r,[4,re(e,t,{name:"MODELO-STATUS",group:"MODELO",groupKey:688,strValue:a.join("<>")})];case 2:return o.sent(),[2,r]}})})},Z=function(e,t){return B(void 0,void 0,void 0,function(){var r,i;return L(this,function(n){switch(n.label){case 0:return[4,$(e,t)];case 1:if(r=n.sent(),!(i=r.find(function(e){return"MODELO-STATUS"===e.name&&688===e.groupKey})))throw Error("status needs to be initialized first");return[2,i.strValue.split("<>")[0]]}})})},K=function(e){return B(void 0,void 0,void 0,function(){var t,r,i,n;return L(this,function(a){switch(a.label){case 0:return[4,g(e)];case 1:return t=a.sent(),r=t.elements[Object.keys(t.elements)[0]],[4,$(e,r.id)];case 2:if(i=a.sent(),!(n=i.find(function(e){return"MODELO-STATUS"===e.name&&688===e.groupKey})))throw Error("status needs to be initialized first");return[2,n.strValue.split("<>").slice(1)]}})})},J=function(e,t){return B(void 0,void 0,void 0,function(){var r,i,n,a,o,s,l,u;return L(this,function(c){switch(c.label){case 0:return 0===t.length?[2,{}]:1!==t.length?[3,2]:[4,Z(e,t[0])];case 1:return r=c.sent(),[2,(u={},u[t[0]]=r,u)];case 2:return[4,g(e)];case 3:return i=c.sent(),n=t.map(function(e){return i.elements[e]}),[4,Object(R.a)().query({query:T.a,variables:{modelId:e,elementIdArr:n.map(function(e){return e.elementId}),propertyArr:n.map(function(e){return"MODELO-STATUS@688"})}})];case 4:if(a=c.sent(),o=a.data,s=a.errors)throw s[0];if(!o.batchGetElementProperties.properties[0].strValues)throw Error("status needs to be initialized first");return l={},o.batchGetElementProperties.elementIdArr.forEach(function(e,r){var i=t.find(function(t){return t.endsWith(e+"")}),n=o.batchGetElementProperties.properties[0].strValues[r];if(!n)throw Error("status needs to be initialized first");l[i]=n.split("<>")[0]}),[2,l]}})})},$=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n,a,o,s,l,u,c,h,d,p,m,v;return L(this,function(y){switch(y.label){case 0:if(!j.test(t))throw Error("elementId "+t+" seems not correct");return r?[3,4]:[4,g(e)];case 1:return i=y.sent(),[4,ie(e,"unit.json")];case 2:return n=y.sent(),a=i.elements[t],o=n[a.docId],[4,Object(R.a)().query({query:w.a,variables:{modelId:a.originModelId,docAndCatId:a.docAndCatId,elementId:a.elementId}})];case 3:return[2,y.sent().data.elementProperties.map(function(e){var t=e.property,r=e.numValue,i=e.strValue,n=F(t.split("@"),2),a=n[0],s=n[1];return{name:a,group:I[s],groupKey:parseInt(s),strValue:i,numValue:r,unit:o[a]||null}})];case 4:return[4,g(e,s=r||"/"+e)];case 5:return l=y.sent(),u=s+"/unit.json",[4,_.a.OpenFile1(u,"",Promise).downloadFile()];case 6:return c=y.sent(),h=JSON.parse(c.data),d=l.elements[t],p=h[d.docId],m=s+"/elementsInfo.csv",[4,_.a.OpenFile1(m,"",Promise).downloadFile()];case 7:return v=y.sent(),[2,Object(f.c)(t.split("/")[1],v.data).map(function(e){var t=e.property,r=e.numValue,i=e.strValue,n=F(t.split("@"),2),a=n[0],o=n[1];return{name:a,group:I[o],groupKey:parseInt(o),strValue:i,numValue:r,unit:p[a]||null}})]}})})},ee=function(e,t){return B(void 0,void 0,void 0,function(){var r,i,n,a,o,s,l,u,c,h,d;return L(this,function(p){switch(p.label){case 0:return 0===t.length?[2,[]]:1===t.length?[2,$(e,t[0])]:[4,g(e)];case 1:return r=p.sent(),i=t.map(function(e){if(!j.test(e))throw Error("elementId "+e+" seems not correct");return r.elements[e]}),[4,ie(e,"unit.json")];case 2:return p.sent(),[4,ie(e,"typeKeys.json")];case 3:n=p.sent(),a=[];try{for(o=V(i),s=o.next();!s.done;s=o.next())l=s.value,u=r.types[l.typeId],a=a.concat(n[l.docId][u.name]||[])}catch(e){h={error:e}}finally{try{s&&!s.done&&(d=o.return)&&d.call(o)}finally{if(h)throw h.error}}return c=U(new Set(a)).map(function(e){var t=F(e.split("@"),3),r=t[0],i=t[1],n=t[2];return{name:r,group:I[i],groupKey:parseInt(i),strValue:"2"===n?"multiple values":null,numValue:"1"===n?"multiple values":null}}),[2,new Promise(function(e){return e(c)})]}})})},te=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n;return L(this,function(a){switch(a.label){case 0:return ne(r),[4,g(e)];case 1:return i=a.sent(),n=i.elements[t],[4,Object(R.a)().mutate({mutation:D.a,variables:{modelId:e,docAndCatId:n.docAndCatId,elementId:n.elementId,property:r.name+"@"+r.groupKey,strValue:r.strValue,numValue:r.numValue}})];case 2:return a.sent(),[2,r]}})})},re=function(e,t,r){return B(void 0,void 0,void 0,function(){var i,n,a;return L(this,function(o){switch(o.label){case 0:return ne(r),[4,g(e)];case 1:return i=o.sent(),n=t.map(function(e){return i.elements[e]}),a={modelId:e,docAndCatIdArr:n.map(function(e){return e.docAndCatId}),elementIdArr:n.map(function(e){return e.elementId}),propertyArr:n.map(function(){return r}).map(function(e){return e.name+"@"+e.groupKey})},"string"==typeof r.strValue&&(a.strValueArr=n.map(function(){return r}).map(function(e){return e.strValue})),"number"==typeof r.numValue&&(a.numValueArr=n.map(function(){return r}).map(function(e){return e.numValue})),[4,Object(R.a)().mutate({mutation:C.a,variables:a})];case 2:return o.sent(),[2,r]}})})},ie=function(e,t){return B(void 0,void 0,void 0,function(){var r,n,a,o,s;return L(this,function(l){switch(l.label){case 0:return[4,Object(i.e)(e)];case 1:if(r=l.sent(),!(n=r.convertedUrls.find(function(e){return e.filename===t})))throw Error("this model does not contain "+t);return t.endsWith(".json")?[4,Object(p.a)(e,n)]:[3,3];case 2:return[2,a=l.sent().data];case 3:return t.endsWith(".csv")?[4,Object(p.a)(e,n)]:[3,5];case 4:return a=l.sent().data,o=a.split("\n").splice(1),s={},o.filter(function(e){return e}).forEach(function(e){var t=F(e.trim().split(","),3),r=t[0],i=t[1],n=t[2];s[i+"-"+n]=parseInt(r)}),[2,s];case 5:return[2,null]}})})},ne=function(e){if("number"!=typeof e.numValue&&"string"!=typeof e.strValue)throw Error("[strValue, numValue] should set one correct value");if("number"==typeof e.numValue&&"string"==typeof e.strValue)throw Error("[strValue, numValue] can only set one value");return!0},ae=r(45),oe=r(47),se=r(89),le=r.n(se),ue=r(88),ce=r.n(ue),he=r(87),de=r.n(he),pe=r(86),fe=r.n(pe),_e=r(44),me=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},ve=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ye=function(e,t,r){return me(void 0,void 0,void 0,function(){var i;return ve(this,function(n){switch(n.label){case 0:return[4,Object(R.a)().mutate({mutation:le.a,variables:{name:t,modelId:e,elementIds:r}})];case 1:return i=n.sent().data,[2,Object(_e.c)(i.addModelSelectionSet)]}})})},ge=function(e){return me(void 0,void 0,void 0,function(){return ve(this,function(t){switch(t.label){case 0:return[4,Object(R.a)().query({query:ce.a,variables:{modelId:e}})];case 1:return[2,t.sent().data.model.modelSelectionSets.map(function(e){return Object(_e.c)(e)})]}})})},be=function(e,t,r){return me(void 0,void 0,void 0,function(){var i;return ve(this,function(n){switch(n.label){case 0:return[4,Object(R.a)().mutate({mutation:de.a,variables:{id:e,name:t,elementIds:r}})];case 1:return i=n.sent().data,[2,Object(_e.c)(i.updateModelSelectionSet)]}})})},we=function(e){return me(void 0,void 0,void 0,function(){return ve(this,function(t){switch(t.label){case 0:return[4,Object(R.a)().mutate({mutation:fe.a,variables:{id:e}})];case 1:return t.sent(),[2,e]}})})},xe=r(85),Me=r.n(xe),Ee=r(84),Te=r.n(Ee),Se=r(83),Ae=r.n(Se),Pe=r(82),ke=r.n(Pe),Oe=function(){return(Oe=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},De=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},Ne=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function Ce(e){return De(this,void 0,void 0,function(){var t,r,i;return Ne(this,function(n){switch(n.label){case 0:return[4,Object(R.a)().query({query:Me.a,variables:{modelId:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors)throw Error(i[0].message);return[2,r.model.settings]}})})}function Ie(e,t){return De(this,void 0,void 0,function(){var r,i,n;return Ne(this,function(a){switch(a.label){case 0:return[4,Object(R.a)().mutate({mutation:Te.a,variables:Oe({modelId:e},t)})];case 1:if(r=a.sent(),i=r.data,n=r.errors)throw Error(n[0].message);return[2,i]}})})}function Re(e){return De(this,void 0,void 0,function(){var t,r,i;return Ne(this,function(n){switch(n.label){case 0:return[4,Object(R.a)().mutate({mutation:Ae.a,variables:{id:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r)throw Error("render setting "+e+" does not exist");if(i)throw Error(i[0].message);return[2,e]}})})}function Be(e,t){return De(this,void 0,void 0,function(){var r,i,n;return Ne(this,function(a){switch(a.label){case 0:return[4,Object(R.a)().mutate({mutation:ke.a,variables:Oe(Oe({},t),{id:e})})];case 1:if(r=a.sent(),i=r.data,n=r.errors,!i)throw Error("render setting "+e+" does not exist");if(n)throw Error(n[0].message);return[2,i.updateModelSettings]}})})}r.d(t,"h",function(){return i.d}),r.d(t,!1,function(){return i.e}),r.d(t,!1,function(){return i.a}),r.d(t,!1,function(){return i.h}),r.d(t,!1,function(){return i.g}),r.d(t,!1,function(){}),r.d(t,!1,function(){}),r.d(t,!1,function(){return i.f}),r.d(t,!1,function(){return i.b}),r.d(t,!1,function(){return i.c}),r.d(t,!1,function(){}),r.d(t,!1,function(){return n.d}),r.d(t,!1,function(){return n.a}),r.d(t,!1,function(){return n.b}),r.d(t,!1,function(){return n.c}),r.d(t,!1,function(){return h}),r.d(t,!1,function(){return d}),r.d(t,!1,function(){return z}),r.d(t,!1,function(){return G}),r.d(t,"b",function(){return H}),r.d(t,"a",function(){return q}),r.d(t,!1,function(){return W}),r.d(t,"k",function(){return Q}),r.d(t,"j",function(){return Y}),r.d(t,!1,function(){return X}),r.d(t,!1,function(){return Z}),r.d(t,!1,function(){return K}),r.d(t,!1,function(){return J}),r.d(t,"f",function(){return $}),r.d(t,"g",function(){return ee}),r.d(t,"l",function(){return te}),r.d(t,"m",function(){return re}),r.d(t,"e",function(){return g}),r.d(t,!1,function(){return ae.b}),r.d(t,!1,function(){return ae.a}),r.d(t,!1,function(){return oe.c}),r.d(t,!1,function(){return oe.b}),r.d(t,!1,function(){}),r.d(t,!1,function(){return oe.d}),r.d(t,!1,function(){return oe.a}),r.d(t,!1,function(){return ye}),r.d(t,!1,function(){return ge}),r.d(t,!1,function(){return be}),r.d(t,!1,function(){return we}),r.d(t,"i",function(){return Ce}),r.d(t,"c",function(){return Ie}),r.d(t,"d",function(){return Re}),r.d(t,"n",function(){return Be})},function(e,t,r){"use strict";var i=r(1),n=r(52),a=r(25),o=r(0),s=r(2),l=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),u=function(e){function t(t){var r=e.call(this,"transition")||this;return r._srcAt=o.d.create(),r._srcEye=o.d.create(),r._dstAt=o.d.create(),r._dstEye=o.d.create(),r._curAt=o.d.create(),r._curEye=o.d.create(),r._eventEmitter=t,r._srcTheta=0,r._dstTheta=0,r._srcPhi=0,r._dstPhi=0,r._curTheta=0,r._curPhi=0,r._srcDistance=0,r._dstDistance=0,r._startTime=0,r._duration=0,r._speed=1,r._isPano=!1,r}return l(t,e),t.prototype._update=function(e){return!0},t.prototype.update=function(){var e=((new Date).getTime()-this._startTime)/this._duration;return e>1?(this._updateCamera(this._dstEye,this._dstAt),this.stop(),!1):(e=Math.sin(e*Math.PI-Math.PI/2)/2+.5,n.a.linear.vec3(this._curAt,this._srcAt,this._dstAt,e),n.a.linear.vec3(this._curEye,this._srcEye,this._dstEye,e),this._updateCamera(this._curEye,this._curAt),!0)},t.prototype.stop=function(){var e=this._camera;e._targetDistance=e._distance;var t=e.eye[0]-e._at[0],r=e.eye[1]-e._at[1],i=e.eye[2]-e._at[2];e._targetPhi=e._phi=Math.asin(Math.min(i/e._targetDistance,1)),e._targetPhi>=.49999*Math.PI&&(e._targetPhi=.49999*Math.PI),e._targetPhi<=-.49999*Math.PI&&(e._targetPhi=-.49999*Math.PI),e._targetTheta=e._theta=Math.atan2(r,t),e._firstPerson&&(e._targetPhi=e._phi=-e._targetPhi,e._targetTheta=e._theta=e._targetTheta+Math.PI),this.detach(),this._eventEmitter&&(this._eventEmitter.emit("Comment-TransitionOver"),this._eventEmitter.emit("Camera-TransitionOver"),this._eventEmitter.emit("commentTransitionEnded"))},t.prototype.start=function(e,t,r,i){var n=this._camera;return t&&n.restore(e),this._setStartPoint(n._at,n.eye,n._distance,e.at,n._theta,n._phi),t||n.restore(e),this._setEndPoint(n._targetDistance,n._targetTheta,n._targetPhi,n._firstPerson,n._scene?n._scene.radius:100,r,i),o.d.copy(n._at,this._srcAt),o.d.copy(n.eye,this._srcEye),t?(this._updateCamera(this._dstEye,this._dstAt,this._dstTheta,this._dstPhi),!0):(this._startTime=(new Date).getTime(),this._updateCamera(this._srcEye,this._srcAt,this._srcTheta,this._srcPhi),!0)},t.prototype.startPano=function(e){var t,r,i=this._camera;this._isPano=!0,o.d.normalize(e,e),o.d.scale(e,e,15),o.d.copy(this._srcAt,i._at),o.d.copy(this._srcEye,i.eye),this._srcDistance=o.d.distance(i.eye,i._at),o.d.copy(this._dstAt,e),this._srcTheta=i._theta,this._srcPhi=i._phi,this._dstDistance=o.d.distance(i.eye,e),this._dstTheta=i._theta,this._dstPhi=i._phi,o.d.copy(this._dstEye,i.eye),t=o.d.distance(this._srcAt,this._dstAt),r=Math.abs(this._srcDistance-this._dstDistance);t=Math.ceil(t/100*450),r=Math.ceil(r/100*450);var n=Math.max(t,r);return n=Math.min(Math.max(n,1),266),this._duration=15*n/this._speed,this._startTime=(new Date).getTime(),this._updateCamera(this._srcEye,this._srcAt,this._srcTheta,this._srcPhi),!0},t.prototype._setStartPoint=function(e,t,r,i,n,a){o.d.copy(this._srcAt,e),o.d.copy(this._srcEye,t),this._srcDistance=r,o.d.copy(this._dstAt,i),this._srcTheta=n,this._srcPhi=a},t.prototype._setEndPoint=function(e,t,r,n,a,s,l){var u,c,h;this._dstDistance=e,this._dstTheta=t,this._dstPhi=r;var d,p,f,_,m,v=Math.sin(this._dstPhi),y=Math.cos(this._dstPhi),g=Math.sin(this._dstTheta);u=y*Math.cos(this._dstTheta),c=y*g,h=v,n&&(u=-u,c=-c,h=-h),this._dstEye[0]=this._dstAt[0]+u*this._dstDistance,this._dstEye[1]=this._dstAt[1]+c*this._dstDistance,this._dstEye[2]=this._dstAt[2]+h*this._dstDistance,d=o.d.distance(this._srcAt,this._dstAt),p=o.d.distance(this._srcEye,this._dstEye),f=Math.abs(this._srcDistance-this._dstDistance),_=Math.abs(this._srcTheta-this._dstTheta),m=Math.abs(this._srcPhi-this._dstPhi);var b=i.a.isMobile?300:450,w=s||266;d=Math.ceil(d/a*b),p=Math.ceil(p/a*b),f=Math.ceil(f/a*b),_=Math.ceil(_/Math.PI*90),m=Math.ceil(m/Math.PI*90);var x=Math.max(f,Math.max(d,p));x=Math.max(x,Math.max(_,m)),x=Math.min(Math.max(x,1),w);l=l||this._speed;this._duration=15*x/l},t.prototype._updateCamera=function(e,t,r,i){var n=this._camera;n.eye[0]=e[0],n.eye[1]=e[1],n.eye[2]=e[2],n._at[0]=t[0],n._at[1]=t[1],n._at[2]=t[2],r&&(n._targetTheta=r),i&&(n._targetPhi=i),n._distance=o.d.distance(n.eye,n._at),n._twoPointsPerpective?o.a.lookAt_correction(n.viewMatrix,n.eye,n._at,[0,0,1]):o.a.lookAt(n.viewMatrix,n.eye,n._at,[0,0,1]),n._yVanishFactor[0]=n.viewMatrix[8],n._yVanishFactor[1]=n.viewMatrix[9],n._yVanishFactor[2]=n.viewMatrix[10],n._yVanishFactor[3]=n.viewMatrix[11],n._scene&&n._updateProjection(),o.a.multiply(n.vpMatrix,n.projectMatrix,n.viewMatrix),n._cull.update()},t.prototype.setTransitionSpeed=function(e){this._speed=s.a.clamp(e,.01,Number.POSITIVE_INFINITY)},t}(a.a);t.a=u},function(e,t,r){"use strict";r.d(t,"d",function(){return P}),r.d(t,"e",function(){return k}),r.d(t,"a",function(){return O}),r.d(t,"h",function(){return D}),r.d(t,"g",function(){return N}),r.d(t,"f",function(){return C}),r.d(t,"b",function(){return I}),r.d(t,"c",function(){return R});var i=r(60),n=r.n(i),a=r(120),o=r.n(a),s=r(119),l=r.n(s),u=r(118),c=r.n(u),h=r(117),d=r.n(h),p=r(116),f=r.n(p),_=(r(115),r(114)),m=r.n(_),v=r(113),y=r.n(v),g=r(112),b=r.n(g),w=r(41),x=r.n(w),M=r(15),E=r(45),T=r(42),S=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},A=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},P=function(e){return S(void 0,void 0,void 0,function(){var t,r,i;return A(this,function(a){switch(a.label){case 0:return[4,Object(M.a)().query({query:n.a,variables:{modelId:e}})];case 1:if(t=a.sent(),r=t.data,i=t.errors,!r||!r.model)throw Error("model does not exist");if(i)throw Error(i[0].message);return[2,B(r.model)]}})})},k=function(e){return S(void 0,void 0,void 0,function(){var t,r,i;return A(this,function(n){switch(n.label){case 0:return[4,Object(M.a)().query({query:o.a,variables:{modelId:e},fetchPolicy:"cache-first"})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r.model)throw Error("model does not exist");if(i)throw Error(i[0].message);return[2,r.model]}})})},O=function(e){return S(void 0,void 0,void 0,function(){var t;return A(this,function(r){switch(r.label){case 0:return[4,Object(M.a)().mutate({mutation:l.a,variables:{modelId:e},errorPolicy:"all"})];case 1:if(t=r.sent().errors)throw Error(t[0].message);return[2,e]}})})},D=function(e,t,r){return S(void 0,void 0,void 0,function(){var i,n,a,o,s;return A(this,function(l){switch(l.label){case 0:if(!Object(T.c)(e.name))throw Error("file format not valid");return[4,Object(E.b)()];case 1:return i=l.sent(),[4,Object(M.a)().mutate({mutation:c.a,variables:{folderId:i.id,name:e.name,filenames:[e.name],cvtOptions:t?"-comptex":""}})];case 2:return n=l.sent().data,a=n.uploadModel,o=a.id,s=a.uploadUrls,[4,x.a.put(s[0].url,e,{onUploadProgress:function(e){var t=e.loaded/e.total;r&&r(t)}})];case 3:return l.sent(),[4,Object(M.a)().mutate({mutation:d.a,variables:{modelId:o}})];case 4:return[2,B(l.sent().data.uploadModelSuccess)]}})})},N=function(e,t){return S(void 0,void 0,void 0,function(){return A(this,function(r){switch(r.label){case 0:return[4,Object(M.a)().mutate({mutation:f.a,variables:{modelId:e,name:t}})];case 1:return r.sent(),[2,e]}})})},C=function(e,t,r,i){return S(void 0,void 0,void 0,function(){var n,a;return A(this,function(o){switch(o.label){case 0:if(t.length<2)throw Error("merge model requires at least 2 models");if(n={modelFragments:t.map(function(e){return{modelId:e,tree:"*",transform:[]}})},r&&(n.mergeType=r),i)for(a=0;a<i.length;a++)n.modelFragments[a].transform=i[a];return[4,function(e,t){return S(void 0,void 0,void 0,function(){var r;return A(this,function(i){switch(i.label){case 0:return[4,Object(E.b)()];case 1:return r=i.sent(),[4,Object(M.a)().mutate({mutation:m.a,variables:{name:e,query:t,folderId:r.id}})];case 2:return[2,i.sent().data.sliceModel.id]}})})}(e,JSON.stringify(n,null,0))];case 1:return[2,o.sent()]}})})},I=function(e){return S(void 0,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:if(null===e||void 0===e)throw Error("Please enter a valid modelId");return[4,Object(M.a)().mutate({mutation:y.a,variables:{modelId:e}})];case 1:return[2,t.sent().data.modelStartConvertToPdf.assetId]}})})},R=function(e){return S(void 0,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return[4,Object(M.a)().query({query:b.a,variables:{assetId:e}})];case 1:return[2,t.sent().data.asset.downloadUrls[0].url]}})})};function B(e){var t,r;return e.downloadUrls&&e.downloadUrls.length&&(t=e.downloadUrls[0],r=e.downloadUrls.filter(function(t){return t.filename!==e.name})),{id:e.id,name:e.name,convertedUrls:e.convertedUrls?e.convertedUrls.map(function(e){return{filename:e.filename,url:e.url}}):null,downloadUrl:t?t.url:null,attachments:r,status:e.status,createdAt:e.createdAt}}},function(e,t,r){"use strict";var i,n=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},a=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){e.Text="text",e.ArrayBuffer="arraybuffer",e.Image="blob",e.JSON="json",e.XML="text"}(i||(i={}));var o=(/Chrome/.test(navigator.userAgent)||/Safari/.test(navigator.userAgent))&&(/Google Inc/.test(navigator.vendor)||/Apple Computer, Inc/.test(navigator.vendor)),s={temporary:1073741824};function l(e,t){return n(this,void 0,void 0,function(){var r;return a(this,function(i){return r={create:t},[2,new Promise(function(t,i){(function(){return n(this,void 0,void 0,function(){return a(this,function(e){return[2,new Promise(function(e,t){o&&(window.requestFileSystem||window.webkitRequestFileSystem)?(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,s.temporary,e,t)):t("FILESYSTEM_NOT_SUPPORTED")})]})})})().then(function(n){return n.root.getDirectory(e,r,t,i)}).catch(i)})]})})}function u(e,t,r){return n(this,void 0,void 0,function(){var i;return a(this,function(n){return i={create:t},[2,new Promise(function(n,a){l(e,t).then(function(e){return e.getFile(r,i,n,a)}).catch(a)})]})})}function c(e){var t=e.split("/").pop()||"";return{directory:e.replace(t,""),fileName:t}}function h(e,t){return n(this,void 0,void 0,function(){return a(this,function(r){return[2,function(e,t){return n(this,void 0,void 0,function(){var r,o,s,l,h,d;return a(this,function(p){switch(p.label){case 0:return r=c(e),o=r.directory,s=r.fileName,[4,u(o,!1,s)];case 1:return l=p.sent(),[4,new Promise(function(e,t){return l.file(e,t)})];case 2:if(0===(h=p.sent()).size)throw new Error("FILE_SIZE_ZERO");return[4,function(e,t){return n(this,void 0,void 0,function(){var r;return a(this,function(n){return r=new FileReader,[2,new Promise(function(n,a){switch(r.onloadend=function(){void 0!==r.result||null!==r.result?n(r.result):a(r.error)},e.type){case i.JSON:case i.XML:r.readAsText(t);break;case i.ArrayBuffer:case i.Image:r.readAsArrayBuffer(t);break;default:throw new Error("File has no type")}})]})})}(t,h)];case 3:return d=p.sent(),t.type===i.Image?[2,new Blob([d],{type:t.mime})]:t.type===i.JSON?[2,JSON.parse(d)]:[2,d]}})})}(e,t).then(function(e){return e}).catch(function(e){return null})]})})}function d(e,t,r){return n(this,void 0,void 0,function(){var o,s;return a(this,function(l){return t.type===i.JSON?(s=JSON.stringify(e),o=new Blob([s],{type:t.mime})):o=t.type===i.Image?e:new Blob([e],{type:t.mime}),[2,function(e,t,r){return n(this,void 0,void 0,function(){var r,i,n,o,s;return a(this,function(a){switch(a.label){case 0:return r=c(e),i=r.directory,n=r.fileName,[4,u(i,!0,n)];case 1:return o=a.sent(),[4,new Promise(function(e){return o.createWriter(e)})];case 2:return s=a.sent(),[2,new Promise(function(e,r){s.onerror=function(e){return r()},s.onwriteend=function(){return e()},s.write(t)})]}})})}(r,o)]})})}var p=r(60),f=r.n(p),_=r(15),m=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},v=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},y=function(e){return m(void 0,void 0,void 0,function(){var t,r,i;return v(this,function(n){switch(n.label){case 0:return[4,Object(_.a)().query({query:f.a,variables:{modelId:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r||!r.model)throw Error("model does not exist");if(i)throw Error(i[0].message);return[2,function(e){var t,r;return e.downloadUrls&&e.downloadUrls.length&&(t=e.downloadUrls[0],r=e.downloadUrls.filter(function(t){return t.filename!==e.name})),{id:e.id,name:e.name,convertedUrls:e.convertedUrls?e.convertedUrls.map(function(e){return{filename:e.filename,url:e.url}}):null,downloadUrl:t?t.url:null,attachments:r,status:e.status,createdAt:e.createdAt}}(r.model)]}})})};function g(e,t){return new Error(JSON.stringify({category:e,detail:t.name+": "+t.message}))}r.d(t,"b",function(){return E}),r.d(t,"a",function(){return T}),r.d(t,"c",function(){return A});var b=function(){return(b=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},w=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},x=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},M={bin:{mime:"application/octet-binary",responseType:"arraybuffer",type:i.ArrayBuffer},xml:{mime:"application/xml",responseType:"text",type:i.XML},json:{mime:"application/json",responseType:"json",type:i.JSON},txt:{mime:"text/plain",responseType:"text",type:i.Text},csv:{mime:"text/plain",responseType:"text",type:i.Text},jpeg:{mime:"image/jpg",responseType:"blob",type:i.Image},jpg:{mime:"image/jpg",responseType:"blob",type:i.Image},png:{mime:"image/png",responseType:"blob",type:i.Image},gif:{mime:"image/gif",responseType:"blob",type:i.Image},bmp:{mime:"image/bmp",responseType:"blob",type:i.Image}};function E(e,t){return w(this,void 0,void 0,function(){var r,i,n,a=this;return x(this,function(o){switch(o.label){case 0:return r=[],t?(r=t,[3,3]):[3,1];case 1:return[4,y(e)];case 2:if(!(i=o.sent()))throw Error("model does not exist");r=i.convertedUrls,o.label=3;case 3:return n={},(r=r.map(function(e){return b(b({},e),{filename:e.filename.lastIndexOf(".gz")>=0?e.filename.replace(".gz",""):e.filename})})).forEach(function(t){var r,i=[],o=!1,s=function(e){o||i.forEach(function(t){t(e)})},l=new Promise(function(e,t){r=function(){o=!0,e()}});n[t.filename]={progressEvents:i,progressFn:s,cancel:r,filename:t.filename,downloadFile:function(){return w(a,void 0,void 0,function(){return x(this,function(r){return o?[2]:[2,S(e,t,s,l)]})})},onProgress:function(e){i.push(e)}}}),[2,n]}})})}function T(e,t){return S(e,t,function(){})}function S(e,t,r,i){return w(this,void 0,void 0,function(){var n,a;return x(this,function(o){switch(o.label){case 0:n=function(e){var t=e.split(".").pop()||"";return M[t.toLowerCase()]}(t.filename),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,h("model-"+e+"/"+t.filename,n)];case 2:return a=o.sent(),[3,4];case 3:throw g("openFile",o.sent());case 4:if(a)return[3,9];o.label=5;case 5:return o.trys.push([5,7,,8]),[4,function(e,t,r,i){return w(this,void 0,void 0,function(){return x(this,function(n){return[2,new Promise(function(n,a){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType=e.responseType,o.onload=function(){200===o.status||206===o.status?n({data:o.response}):a()},o.onprogress=function(e){r(e)},o.onerror=function(e){a(e)},i&&i.then(function(){o.abort()}),o.send()})]})})}(n,t.url,r,i)];case 6:return a=o.sent().data,[3,8];case 7:throw g("downloadBinary",o.sent());case 8:return d(a,n,"model-"+e+"/"+t.filename).then(function(){}).catch(function(e){throw g("saveFile",e)}),[3,10];case 9:new ProgressEvent("mesh"),r({loaded:a.byteLength||0,total:a.byteLength||1}),o.label=10;case 10:if("blob"!==n.responseType)return[2,{data:a}];try{return[2,A(a,t.filename)]}catch(e){throw g("processImage",e)}return[2]}})})}function A(e,t){return w(this,void 0,void 0,function(){var r,i;return x(this,function(n){return r=window.URL||window.webkitURL,i=r.createObjectURL(e),[2,new Promise(function(e,r){var n=new Image;n.name=t,n.src=i,n.crossOrigin="",n.onload=function(){return e(n)},n.onerror=function(e){r("error downloading image:"+t)}})]})})}},function(e,t,r){"use strict";var i=r(2),n=r(14),a=r(57),o=r(6),s=o.a.create(),l=new(function(){function e(){this.mul=this.multiply}return e.prototype.equals=function(e,t){for(var r=0;r<16;r++)if(e[r]!==t[r])return!1;return!0},e.prototype.fromValues=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,_){var m=new Float32Array(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=a,m[6]=o,m[7]=s,m[8]=l,m[9]=u,m[10]=c,m[11]=h,m[12]=d,m[13]=p,m[14]=f,m[15]=_,m},e.prototype.create=function(){var e=new n.a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.clone=function(e){var t=new n.a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.prototype.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},e.prototype.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},e.prototype.scalarTranspose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.prototype.simdTranspose=function(e,t){return e},e.prototype.transpose=function(e,t){return n.a.USE_SIMD?this.simdTranspose(e,t):this.scalarTranspose(e,t)},e.prototype.scalarInvert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],_=t[13],m=t[14],v=t[15],y=r*s-i*o,g=r*l-n*o,b=r*u-a*o,w=i*l-n*s,x=i*u-a*s,M=n*u-a*l,E=c*_-h*f,T=c*m-d*f,S=c*v-p*f,A=h*m-d*_,P=h*v-p*_,k=d*v-p*m,O=y*k-g*P+b*A+w*S-x*T+M*E;return O?(O=1/O,e[0]=(s*k-l*P+u*A)*O,e[1]=(n*P-i*k-a*A)*O,e[2]=(_*M-m*x+v*w)*O,e[3]=(d*x-h*M-p*w)*O,e[4]=(l*S-o*k-u*T)*O,e[5]=(r*k-n*S+a*T)*O,e[6]=(m*b-f*M-v*g)*O,e[7]=(c*M-d*b+p*g)*O,e[8]=(o*P-s*S+u*E)*O,e[9]=(i*S-r*P-a*E)*O,e[10]=(f*x-_*b+v*y)*O,e[11]=(h*b-c*x-p*y)*O,e[12]=(s*T-o*A-l*E)*O,e[13]=(r*A-i*T+n*E)*O,e[14]=(_*g-f*w-m*y)*O,e[15]=(c*w-h*g+d*y)*O,e):null},e.prototype.simdInvert=function(e,t){return e},e.prototype.invert=function(e,t){return n.a.USE_SIMD?this.simdInvert(e,t):this.scalarInvert(e,t)},e.prototype.scalarAdjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],_=t[13],m=t[14],v=t[15];return e[0]=s*(d*v-p*m)-h*(l*v-u*m)+_*(l*p-u*d),e[1]=-(i*(d*v-p*m)-h*(n*v-a*m)+_*(n*p-a*d)),e[2]=i*(l*v-u*m)-s*(n*v-a*m)+_*(n*u-a*l),e[3]=-(i*(l*p-u*d)-s*(n*p-a*d)+h*(n*u-a*l)),e[4]=-(o*(d*v-p*m)-c*(l*v-u*m)+f*(l*p-u*d)),e[5]=r*(d*v-p*m)-c*(n*v-a*m)+f*(n*p-a*d),e[6]=-(r*(l*v-u*m)-o*(n*v-a*m)+f*(n*u-a*l)),e[7]=r*(l*p-u*d)-o*(n*p-a*d)+c*(n*u-a*l),e[8]=o*(h*v-p*_)-c*(s*v-u*_)+f*(s*p-u*h),e[9]=-(r*(h*v-p*_)-c*(i*v-a*_)+f*(i*p-a*h)),e[10]=r*(s*v-u*_)-o*(i*v-a*_)+f*(i*u-a*s),e[11]=-(r*(s*p-u*h)-o*(i*p-a*h)+c*(i*u-a*s)),e[12]=-(o*(h*m-d*_)-c*(s*m-l*_)+f*(s*d-l*h)),e[13]=r*(h*m-d*_)-c*(i*m-n*_)+f*(i*d-n*h),e[14]=-(r*(s*m-l*_)-o*(i*m-n*_)+f*(i*l-n*s)),e[15]=r*(s*d-l*h)-o*(i*d-n*h)+c*(i*l-n*s),e},e.prototype.simdAdjoint=function(e,t){return e},e.prototype.adjoint=function(e,t){return n.a.USE_SIMD?this.simdAdjoint(e,t):this.scalarAdjoint(e,t)},e.prototype.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],_=e[14],m=e[15];return(t*o-r*a)*(h*m-d*_)-(t*s-i*a)*(c*m-d*f)+(t*l-n*a)*(c*_-h*f)+(r*s-i*o)*(u*m-d*p)-(r*l-n*o)*(u*_-h*p)+(i*l-n*s)*(u*f-c*p)},e.prototype.simdMultiply=function(e,t,r){return e},e.prototype.scalarMultiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],_=t[12],m=t[13],v=t[14],y=t[15],g=r[0],b=r[1],w=r[2],x=r[3];return e[0]=g*i+b*s+w*h+x*_,e[1]=g*n+b*l+w*d+x*m,e[2]=g*a+b*u+w*p+x*v,e[3]=g*o+b*c+w*f+x*y,g=r[4],b=r[5],w=r[6],x=r[7],e[4]=g*i+b*s+w*h+x*_,e[5]=g*n+b*l+w*d+x*m,e[6]=g*a+b*u+w*p+x*v,e[7]=g*o+b*c+w*f+x*y,g=r[8],b=r[9],w=r[10],x=r[11],e[8]=g*i+b*s+w*h+x*_,e[9]=g*n+b*l+w*d+x*m,e[10]=g*a+b*u+w*p+x*v,e[11]=g*o+b*c+w*f+x*y,g=r[12],b=r[13],w=r[14],x=r[15],e[12]=g*i+b*s+w*h+x*_,e[13]=g*n+b*l+w*d+x*m,e[14]=g*a+b*u+w*p+x*v,e[15]=g*o+b*c+w*f+x*y,e},e.prototype.multiply=function(e,t,r){return n.a.USE_SIMD?this.simdMultiply(e,t,r):this.scalarMultiply(e,t,r)},e.prototype.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},e.prototype.getScaling=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],o=t[5],s=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(l*l+u*u+c*c),e},e.prototype.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},e.prototype.scalarTranslate=function(e,t,r){var i,n,a,o,s,l,u,c,h,d,p,f,_=r[0],m=r[1],v=r[2];return t===e?(e[12]=t[0]*_+t[4]*m+t[8]*v+t[12],e[13]=t[1]*_+t[5]*m+t[9]*v+t[13],e[14]=t[2]*_+t[6]*m+t[10]*v+t[14],e[15]=t[3]*_+t[7]*m+t[11]*v+t[15]):(i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*_+s*m+h*v+t[12],e[13]=n*_+l*m+d*v+t[13],e[14]=a*_+u*m+p*v+t[14],e[15]=o*_+c*m+f*v+t[15]),e},e.prototype.simdTranslate=function(e,t,r){return e},e.prototype.translate=function(e,t,r){return n.a.USE_SIMD?this.simdTranslate(e,t,r):this.scalarTranslate(e,t,r)},e.prototype.scalarScale=function(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.prototype.SIMDScale=function(e,t,r){return e},e.prototype.scale=function(e,t,r){return n.a.USE_SIMD?this.SIMDScale(e,t,r):this.scalarScale(e,t,r)},e.prototype.rotate=function(e,t,r,i){var a,o,s,l,u,c,h,d,p,f,_,m,v,y,g,b,w,x,M,E,T,S,A,P,k=i[0],O=i[1],D=i[2],N=Math.sqrt(k*k+O*O+D*D);return Math.abs(N)<n.a.EPSILON?null:(k*=N=1/N,O*=N,D*=N,a=Math.sin(r),s=1-(o=Math.cos(r)),l=t[0],u=t[1],c=t[2],h=t[3],d=t[4],p=t[5],f=t[6],_=t[7],m=t[8],v=t[9],y=t[10],g=t[11],b=k*k*s+o,w=O*k*s+D*a,x=D*k*s-O*a,M=k*O*s-D*a,E=O*O*s+o,T=D*O*s+k*a,S=k*D*s+O*a,A=O*D*s-k*a,P=D*D*s+o,e[0]=l*b+d*w+m*x,e[1]=u*b+p*w+v*x,e[2]=c*b+f*w+y*x,e[3]=h*b+_*w+g*x,e[4]=l*M+d*E+m*T,e[5]=u*M+p*E+v*T,e[6]=c*M+f*E+y*T,e[7]=h*M+_*E+g*T,e[8]=l*S+d*A+m*P,e[9]=u*S+p*A+v*P,e[10]=c*S+f*A+y*P,e[11]=h*S+_*A+g*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},e.prototype.scalarRotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+u*i,e[5]=o*n+c*i,e[6]=s*n+h*i,e[7]=l*n+d*i,e[8]=u*n-a*i,e[9]=c*n-o*i,e[10]=h*n-s*i,e[11]=d*n-l*i,e},e.prototype.SIMDRotateX=function(e,t,r){return e},e.prototype.rotateX=function(e,t,r){return n.a.USE_SIMD?this.SIMDRotateX(e,t,r):this.scalarRotateX(e,t,r)},e.prototype.scalarRotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-u*i,e[1]=o*n-c*i,e[2]=s*n-h*i,e[3]=l*n-d*i,e[8]=a*i+u*n,e[9]=o*i+c*n,e[10]=s*i+h*n,e[11]=l*i+d*n,e},e.prototype.SIMDRotateY=function(e,t,r){return e},e.prototype.rotateY=function(e,t,r){return n.a.USE_SIMD?this.SIMDRotateY(e,t,r):this.scalarRotateY(e,t,r)},e.prototype.scalarRotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+u*i,e[1]=o*n+c*i,e[2]=s*n+h*i,e[3]=l*n+d*i,e[4]=u*n-a*i,e[5]=c*n-o*i,e[6]=h*n-s*i,e[7]=d*n-l*i,e},e.prototype.SIMDRotateZ=function(e,t,r){return e},e.prototype.rotateZ=function(e,t,r){return n.a.USE_SIMD?this.SIMDRotateZ(e,t,r):this.scalarRotateZ(e,t,r)},e.prototype.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},e.prototype.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.fromRotation=function(e,t,r){var i,a,o,s=r[0],l=r[1],u=r[2],c=Math.sqrt(s*s+l*l+u*u);return Math.abs(c)<n.a.EPSILON?null:(s*=c=1/c,l*=c,u*=c,i=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=s*s*o+a,e[1]=l*s*o+u*i,e[2]=u*s*o-l*i,e[3]=0,e[4]=s*l*o-u*i,e[5]=l*l*o+a,e[6]=u*l*o+s*i,e[7]=0,e[8]=s*u*o+l*i,e[9]=l*u*o-s*i,e[10]=u*u*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},e.prototype.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=i+i,l=n+n,u=a+a,c=i*s,h=i*l,d=i*u,p=n*l,f=n*u,_=a*u,m=o*s,v=o*l,y=o*u;return e[0]=1-(p+_),e[1]=h+y,e[2]=d-v,e[3]=0,e[4]=h-y,e[5]=1-(c+_),e[6]=f+m,e[7]=0,e[8]=d+v,e[9]=f-m,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},e.prototype.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],l=n+n,u=a+a,c=o+o,h=n*l,d=n*u,p=n*c,f=a*u,_=a*c,m=o*c,v=s*l,y=s*u,g=s*c,b=i[0],w=i[1],x=i[2];return e[0]=(1-(f+m))*b,e[1]=(d+g)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(d-g)*w,e[5]=(1-(h+m))*w,e[6]=(_+v)*w,e[7]=0,e[8]=(p+y)*x,e[9]=(_-v)*x,e[10]=(1-(h+f))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},e.prototype.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var a=t[0],o=t[1],s=t[2],l=t[3],u=a+a,c=o+o,h=s+s,d=a*u,p=a*c,f=a*h,_=o*c,m=o*h,v=s*h,y=l*u,g=l*c,b=l*h,w=i[0],x=i[1],M=i[2],E=n[0],T=n[1],S=n[2];return e[0]=(1-(_+v))*w,e[1]=(p+b)*w,e[2]=(f-g)*w,e[3]=0,e[4]=(p-b)*x,e[5]=(1-(d+v))*x,e[6]=(m+y)*x,e[7]=0,e[8]=(f+g)*M,e[9]=(m-y)*M,e[10]=(1-(d+_))*M,e[11]=0,e[12]=r[0]+E-(e[0]*E+e[4]*T+e[8]*S),e[13]=r[1]+T-(e[1]*E+e[5]*T+e[9]*S),e[14]=r[2]+S-(e[2]*E+e[6]*T+e[10]*S),e[15]=1,e},e.prototype.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,u=r*o,c=i*o,h=i*s,d=n*o,p=n*s,f=n*l,_=a*o,m=a*s,v=a*l;return e[0]=1-h-f,e[1]=c+v,e[2]=d-m,e[3]=0,e[4]=c-v,e[5]=1-u-f,e[6]=p+_,e[7]=0,e[8]=d+m,e[9]=p-_,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.prototype.frustum=function(e,t,r,i,n,a,o){var s=1/(r-t),l=1/(n-i),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*l,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e},e.prototype.perspective=function(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e},e.prototype.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(n-a)*u*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},e.prototype.ortho=function(e,t,r,i,n,a,o){var s=1/(t-r),l=1/(i-n),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*l,e[14]=(o+a)*u,e[15]=1,e},e.prototype.lookAt=function(e,t,r,i){var a,o,s,l,u,c,h,d,p,f,_=t[0],m=t[1],v=t[2],y=i[0],g=i[1],b=i[2],w=r[0],x=r[1],M=r[2];return Math.abs(_-w)<n.a.EPSILON&&Math.abs(m-x)<n.a.EPSILON&&Math.abs(v-M)<n.a.EPSILON?this.identity(e):(h=_-w,d=m-x,p=v-M,a=g*(p*=f=1/Math.sqrt(h*h+d*d+p*p))-b*(d*=f),o=b*(h*=f)-y*p,s=y*d-g*h,(f=Math.sqrt(a*a+o*o+s*s))?(a*=f=1/f,o*=f,s*=f):(a=0,o=0,s=0),l=d*s-p*o,u=p*a-h*s,c=h*o-d*a,(f=Math.sqrt(l*l+u*u+c*c))?(l*=f=1/f,u*=f,c*=f):(l=0,u=0,c=0),e[0]=a,e[1]=l,e[2]=h,e[3]=0,e[4]=o,e[5]=u,e[6]=d,e[7]=0,e[8]=s,e[9]=c,e[10]=p,e[11]=0,e[12]=-(a*_+o*m+s*v),e[13]=-(l*_+u*m+c*v),e[14]=-(h*_+d*m+p*v),e[15]=1,e)},e.prototype.lookAt_correction=function(e,t,r,i){var n=e;this.lookAt(n,t,r,i);var a=l.create();return l.invert(a,n),a[4]=0,a[5]=0,a[6]=1,a[7]=0,l.invert(n,a),n},e.prototype.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},e.prototype.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},e.prototype.setFromEuler=function(e,t,r,i){var n=Math.cos(t),a=Math.sin(t),o=Math.cos(r),s=Math.sin(r),l=Math.cos(i),u=Math.sin(i),c=n*l,h=n*u,d=a*l,p=a*u;return e[0]=o*l,e[4]=-o*u,e[8]=s,e[1]=h+d*s,e[5]=c-p*s,e[9]=-a*o,e[2]=p-c*s,e[6]=d+h*s,e[10]=n*o,e},e.prototype.getEuler=function(e){var t=e[0],r=e[4],i=e[8],n=(e[1],e[5]),a=e[9],o=(e[2],e[6]),s=e[10],l=[0,0,0];return Math.max(-1,Math.min(1,i)),l[1]=Math.asin(Math.max(-1,Math.min(1,i))),Math.abs(i)<.9999999?(l[0]=Math.atan2(-a,s),l[2]=Math.atan2(-r,t)):(l[0]=Math.atan2(o,n),l[2]=0),l},e.prototype.getEulerByOrder=function(e,t,r){void 0===r&&(r="XYZ");var n=t[0],a=t[4],o=t[8],s=(t[1],t[5]),l=t[9],u=(t[2],t[6]),c=t[10],h=0,d=0,p=0;switch(r){case"XYZ":d=Math.asin(i.a.clamp(o,-1,1)),Math.abs(o)<.9999999?(h=Math.atan2(-l,c),p=Math.atan2(-a,n)):(h=Math.atan2(u,s),p=0)}return e[0]=h,e[1]=d,e[2]=p,e},e.prototype.extractTransform=function(e){var t=o.a.create(),r=a.a.create(),i=o.a.fromValues(e[0],e[4],e[8]),n=o.a.fromValues(e[1],e[5],e[9]),s=o.a.fromValues(e[2],e[6],e[10]),l=[o.a.length(i),o.a.length(n),o.a.length(s)],u=o.a.create();return o.a.cross(u,n,s),o.a.dot(i,u)<0&&(l[0]=-l[0]),e[0]/=l[0],e[4]/=l[0],e[8]/=l[0],e[1]/=l[1],e[5]/=l[1],e[9]/=l[1],e[2]/=l[2],e[6]/=l[2],e[10]/=l[2],this.getRotation(r,e),this.getRotation(r,e),this.getTranslation(t,e),{position:t,rotation:r,scale:l}},e.prototype.compose=function(e,t,r,i){var n=e,a=r[0],o=r[1],s=r[2],l=r[3],u=a+a,c=o+o,h=s+s,d=a*u,p=a*c,f=a*h,_=o*c,m=o*h,v=s*h,y=l*u,g=l*c,b=l*h,w=i[0],x=i[1],M=i[2];return n[0]=(1-(_+v))*w,n[1]=(p+b)*w,n[2]=(f-g)*w,n[3]=0,n[4]=(p-b)*x,n[5]=(1-(d+v))*x,n[6]=(m+y)*x,n[7]=0,n[8]=(f+g)*M,n[9]=(m-y)*M,n[10]=(1-(d+_))*M,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,this},e.prototype.decompose=function(e,t,r,i){var n=e;s[0]=n[0],s[1]=n[1],s[2]=n[2];var a=o.a.len(s);s[0]=n[4],s[1]=n[5],s[2]=n[6];var c=o.a.len(s);s[0]=n[8],s[1]=n[9],s[2]=n[10];var h=o.a.len(s);this.determinant(e)<0&&(a=-a),t[0]=n[12],t[1]=n[13],t[2]=n[14],l.copy(u,e);var d=1/a,p=1/c,f=1/h;u[0]*=d,u[1]*=d,u[2]*=d,u[4]*=p,u[5]*=p,u[6]*=p,u[8]*=f,u[9]*=f,u[10]*=f,this.getRotation(r,u),i[0]=a,i[1]=c,i[2]=h},e}()),u=l.create();t.a=l},function(e,t,r){"use strict";var i=r(14),n=new(function(){function e(){this.sub=this.subtract,this.mul=this.multiply,this.div=this.divide,this.dist=this.distance,this.sqrDist=this.squaredDistance,this.len=this.length,this.sqrLen=this.squaredLength}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.prototype.fromValues=function(e,t,r,n){var a=new i.a.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.prototype.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},e.prototype.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},e.prototype.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},e.prototype.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},e.prototype.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},e.prototype.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},e.prototype.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},e.prototype.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},e.prototype.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},e.prototype.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)},e.prototype.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a},e.prototype.length=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)},e.prototype.squaredLength=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n},e.prototype.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},e.prototype.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},e.prototype.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=a*o),e},e.prototype.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.prototype.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},e.prototype.random=function(e,t){return t=t||1,e[0]=i.a.RANDOM(),e[1]=i.a.RANDOM(),e[2]=i.a.RANDOM(),e[3]=i.a.RANDOM(),n.normalize(e,e),n.scale(e,e,t),e},e.prototype.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e},e.prototype.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*i+s*a-l*n,h=u*n+l*i-o*a,d=u*a+o*n-s*i,p=-o*i-s*n-l*a;return e[0]=c*u+p*-o+h*-l-d*-s,e[1]=h*u+p*-s+d*-o-c*-l,e[2]=d*u+p*-l+c*-s-h*-o,e[3]=t[3],e},e.prototype.forEach=function(e,t,r,i,a,o){var s,l,u=n.create();for(t||(t=4),r||(r=0),l=i?Math.min(i*t+r,e.length):e.length,s=r;s<l;s+=t)u[0]=e[s],u[1]=e[s+1],u[2]=e[s+2],u[3]=e[s+3],a(u,u,o),e[s]=u[0],e[s+1]=u[1],e[s+2]=u[2],e[s+3]=u[3];return e},e.prototype.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e}());t.a=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.visit=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,l=void 0,u=Array.isArray(e),c=[e],h=-1,d=[],p=void 0,f=void 0,_=void 0,m=[],v=[],y=e;do{var g=++h===c.length,b=g&&0!==d.length;if(g){if(f=0===v.length?void 0:m[m.length-1],p=_,_=v.pop(),b){if(u)p=p.slice();else{for(var w={},x=0,M=Object.keys(p);x<M.length;x++){var E=M[x];w[E]=p[E]}p=w}for(var T=0,S=0;S<d.length;S++){var A=d[S][0],P=d[S][1];u&&(A-=T),u&&null===P?(p.splice(A,1),T++):p[A]=P}}h=l.index,c=l.keys,d=l.edits,u=l.inArray,l=l.prev}else{if(f=_?u?h:c[h]:void 0,null===(p=_?_[f]:y)||void 0===p)continue;_&&m.push(f)}var k=void 0;if(!Array.isArray(p)){if(!o(p))throw new Error("Invalid AST Node: "+(0,i.default)(p));var O=s(t,p.kind,g);if(O){if((k=O.call(t,p,f,_,m,v))===a)break;if(!1===k){if(!g){m.pop();continue}}else if(void 0!==k&&(d.push([f,k]),!g)){if(!o(k)){m.pop();continue}p=k}}}void 0===k&&b&&d.push([f,p]),g?m.pop():(l={inArray:u,index:h,keys:c,edits:d,prev:l},u=Array.isArray(p),c=u?p:r[p.kind]||[],h=-1,d=[],_&&v.push(_),_=p)}while(void 0!==l);0!==d.length&&(y=d[d.length-1][1]);return y},t.visitInParallel=function(e){var t=new Array(e.length);return{enter:function(r){for(var i=0;i<e.length;i++)if(!t[i]){var n=s(e[i],r.kind,!1);if(n){var o=n.apply(e[i],arguments);if(!1===o)t[i]=r;else if(o===a)t[i]=a;else if(void 0!==o)return o}}},leave:function(r){for(var i=0;i<e.length;i++)if(t[i])t[i]===r&&(t[i]=null);else{var n=s(e[i],r.kind,!0);if(n){var o=n.apply(e[i],arguments);if(o===a)t[i]=a;else if(void 0!==o&&!1!==o)return o}}}}},t.visitWithTypeInfo=function(e,t){return{enter:function(r){e.enter(r);var i=s(t,r.kind,!1);if(i){var n=i.apply(t,arguments);return void 0!==n&&(e.leave(r),o(n)&&e.enter(n)),n}},leave:function(r){var i,n=s(t,r.kind,!0);return n&&(i=n.apply(t,arguments)),e.leave(r),i}}},t.getVisitFn=s,t.BREAK=t.QueryDocumentKeys=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(129));var n={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]};t.QueryDocumentKeys=n;var a=Object.freeze({});function o(e){return Boolean(e&&"string"==typeof e.kind)}function s(e,t,r){var i=e[t];if(i){if(!r&&"function"==typeof i)return i;var n=r?i.leave:i.enter;if("function"==typeof n)return n}else{var a=r?e.leave:e.enter;if(a){if("function"==typeof a)return a;var o=a[t];if("function"==typeof o)return o}}}t.BREAK=a},function(e,t,r){"use strict";var i=r(74),n=r(145),a=Object.prototype.toString;function o(e){return"[object Array]"===a.call(e)}function s(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===a.call(e)}function u(e,t){if(null!==e&&void 0!==e)if("object"!=typeof e&&(e=[e]),o(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===a.call(e)},isBuffer:n,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===a.call(e)},isFile:function(e){return"[object File]"===a.call(e)},isBlob:function(e){return"[object Blob]"===a.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,i){"object"==typeof t[i]&&"object"==typeof r?t[i]=e(t[i],r):t[i]=r}for(var i=0,n=arguments.length;i<n;i++)u(arguments[i],r);return t},extend:function(e,t,r){return u(t,function(t,n){e[n]=r&&"function"==typeof t?i(t,r):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){"use strict";var i=r(1),n=r(4),a=r(22),o=r(8),s=r(0),l=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},u=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},c=function(){function e(e,t){this._drawableNotUseOverride=[],this._scene=e,this._material=null,this._shaders=[null,null,null],this._ready=!1,this._renderTarget=null,this._phonyCamera=new a.a([0,0,1,1]),this._pickMatrix=s.a.create(),this._gl=t.gl,this._material=e.materialManager.createMaterialAdhoc("pick-query"),this.recompileShader(t,[]),this._renderTarget=new o.a("query",t,5,5,{clearColor:[0,0,0,0],depthFunc:this._gl.LEQUAL}),this._ready=this._renderTarget.ready}return e.prototype.destroy=function(){this._ready&&(this._material.destroy(),this._material=null,delete this._material,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget)},e.prototype._beginRegion=function(e,t,r,i,n){t=n.viewport[3]-1-t,i=n.viewport[3]-1-i;var a=Math.abs(r-e)+1,o=Math.abs(i-t)+1;a==this._renderTarget.getWidth()&&o==this._renderTarget.getHeight()||this._renderTarget.resize(a,o),this._pickMatrix[0]=n.viewport[2]/a,this._pickMatrix[5]=n.viewport[3]/o,this._pickMatrix[12]=(n.viewport[2]-e-r)/a,this._pickMatrix[13]=(n.viewport[3]-t-i)/o,s.a.multiply(this._phonyCamera.vpMatrix,this._pickMatrix,n.vpMatrix),this._phonyCamera.viewport[0]=n.viewport[0],this._phonyCamera.viewport[1]=n.viewport[1],this._phonyCamera.viewport[2]=a,this._phonyCamera.viewport[3]=o,this._phonyCamera.eye=n.eye,this._phonyCamera._at=n._at},e.prototype._endRegion=function(e,t){var r=this._gl,i=[],n=new Uint8Array(e*t*4);this._renderTarget.getFramebuffer().use(),r.readPixels(0,0,e,t,r.RGBA,r.UNSIGNED_BYTE,n);for(var a={},o=0;o<t;o+=2)for(var s=0;s<e;s+=2){var l=4*(o*e+s),u=n[l]+256*n[l+1]+256*n[l+2]*256+256*n[l+3]*256*256;u>0&&(a[u-=1]||(i.push(u),a[u]=1))}return i},e.prototype._changeMaterial=function(e,t){e+=1;var r=[0,0,0];r[0]=(.49+(255&e))/255,r[1]=(.49+(e>>8&255))/255,r[2]=(.49+(e>>16&255))/255;var i=(.49+(e>>24&255))/255;t.setDiffuse(r),t.setTransparent(i)},e.prototype.pickModel=function(e,t,r,i){var n=[],a=[],o=function(e){var t=s._scene.models[e].getDrawablesWithoutLine();n.push.apply(n,u(t)),t.forEach(function(){a.push(e)})},s=this;for(var l in this._scene.models)o(l);var c=this.pickDrawable(e,t,r,i,n);if(c){var h=n.indexOf(c);return this._scene.models[a[h]]}},e.prototype.pick=function(e,t,r,i){for(var n in this._scene.models){var a=this._scene.models[n],o=this.pickDrawable(e,t,r,i,a.getDrawablesWithoutLine());if(o)return o}return null},e.prototype.pickDrawable=function(e,t,r,n,a,o){e=Math.floor(e*i.a.devicePixelRatio),t=Math.floor(t*i.a.devicePixelRatio),this._scene.clipping.isEnabled()&&r.renderState.invalidateClip();var s=this._gl;this._beginRegion(e,t,e,t,n),r.clear(this._renderTarget,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var l=void 0!==o?o:this._scene.needRenderDoubleSided();this.beforeRenderWithOverride(a),r.drawDrawablesCustom(this._renderTarget,a,this._phonyCamera,this._shaders,this._material,this._scene.clipping,!l&&s.CCW,this._changeMaterial),this.afterRenderWithOverride();var u=this._endRegion(1,1);return 0===u.length?null:a[u[0]]},e.prototype.pickNodesInsideRegion=function(e,t,r,n,a,o,s){if(!this._ready)return[];e=Math.floor(e*i.a.devicePixelRatio),t=Math.floor(t*i.a.devicePixelRatio),r=Math.floor(r*i.a.devicePixelRatio),n=Math.floor(n*i.a.devicePixelRatio),this._scene.clipping.isEnabled()&&a.renderState.invalidateClip();var l=this._gl;this._beginRegion(e,t,r,n,o),a.clear(this._renderTarget,l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),this.beforeRenderWithOverride(s),a.drawDrawablesCustom(this._renderTarget,s,this._phonyCamera,this._shaders,this._material,this._scene.clipping,!this._scene.needRenderDoubleSided()&&l.CCW,this._changeMaterial),this.afterRenderWithOverride();var u=this._endRegion(r-e+1,n-t+1);if(0===u.length)return[];var c=[];u.forEach(function(e){var t=s[e].nodes;t&&t.forEach(function(e){e.isVisible()&&c.push(e)})}),this._beginRegion(e,t,r,n,o),a.clear(this._renderTarget,l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),a.drawNodesCustom(this._renderTarget,c,this._phonyCamera,this._shaders,this._material,this._scene.clipping,!this._scene.needRenderDoubleSided()&&l.CCW,this._changeMaterial);var h=[];return this._endRegion(r-e+1,n-t+1).forEach(function(e){h.push(c[e])}),h},e.prototype.recompileShader=function(e,t){var r=[];t.section&&r.push("CLIPPING"),this._shaders[0]=e.getShader("constant",r),this._shaders[0].ready||this._shaders[0].createFromShaderSource(n.a.constant,r),r.push("MODEL_TRANSFORM"),this._shaders[1]=e.getShader("constant",r),this._shaders[1].ready||this._shaders[1].createFromShaderSource(n.a.constant,r),r.push("INSTANCING"),this._shaders[2]=e.getShader("constant",r),this._shaders[2].ready||this._shaders[2].createFromShaderSource(n.a.constant,r),this._material.attachShader(this._shaders[0]),this._material.setDiffuse(s.d.fromValues(0,0,0)),this._material.setTransparent(0)},e.prototype.beforeRenderWithOverride=function(e){var t=this;this._drawableNotUseOverride.length=0,e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},e.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1})},e}();t.a=c},function(e,t,r){"use strict";var i=function(){function e(e,t){this._manager=t,this._ref=0,this.name=e,this.ready=!1}return e.prototype.ref=function(){this._ref++},e.prototype.destroy=function(){this.ready=!1,this._manager=null,delete this._manager,this.name=null,delete this.name},e.prototype.getGL=function(){return this._manager.gl},e.prototype.getManager=function(){return this._manager},e}();t.a=i},function(e,t,r){"use strict";var i,n,a,o,s,l,u,c,h,d,p,f;r.d(t,"c",function(){return i}),r.d(t,"b",function(){return n}),r.d(t,"k",function(){return a}),r.d(t,"j",function(){return o}),r.d(t,"d",function(){return s}),r.d(t,"e",function(){return l}),r.d(t,"h",function(){return u}),r.d(t,"g",function(){return c}),r.d(t,"i",function(){return h}),r.d(t,"f",function(){return d}),r.d(t,"a",function(){return p}),r.d(t,"l",function(){return f}),function(e){e.Init="INIT",e.Error="ERROR",e.Done="DONE"}(i||(i={})),function(e){e.Wbs="wbs",e.Img="img",e.File="file",e.Dwg="dwg",e.ModelConvertedPdf="modelConvertedPdf",e.Image360="image360"}(n||(n={})),function(e){e.Urgent="urgent",e.Critical="critical",e.Normal="normal"}(a||(a={})),function(e){e.Img="img",e.Txt="txt"}(o||(o={})),function(e){e.Urgent="urgent",e.Critical="critical",e.Normal="normal"}(s||(s={})),function(e){e.Open="open",e.InProgress="inProgress",e.Resolved="resolved",e.Bot="bot"}(l||(l={})),function(e){e.Normal="normal",e.Versioned="versioned",e.Partial="partial"}(u||(u={})),function(e){e.Error="ERROR",e.Init="INIT",e.Uploaded="UPLOADED",e.Converted="CONVERTED"}(c||(c={})),function(e){e.ElementId="elementId",e.Type="type",e.Family="family",e.Category="category",e.Level="level"}(h||(h={})),function(e){e.Architect="Architect",e.Product="Product"}(d||(d={})),function(e){e.Error="ERROR",e.Init="INIT",e.Uploaded="UPLOADED",e.Converted="CONVERTED"}(p||(p={})),function(e){e.Txt="txt",e.Img="img",e.File="file"}(f||(f={}))},function(e,t,r){"use strict";var i=r(22),n=r(25),a=r(0),o=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),s=function(e){function t(t){var r=e.call(this,"navigate")||this;return r._eventEmitter=t,r}return o(t,e),t.prototype._update=function(e){return!0},t.prototype.update=function(){var e=this._camera;e.eye[0]+=.15*(e._targetEye[0]-e.eye[0]),e.eye[1]+=.15*(e._targetEye[1]-e.eye[1]),e.eye[2]+=.15*(e._targetEye[2]-e.eye[2]),e._at[0]+=.15*(e._targetAt[0]-e._at[0]),e._at[1]+=.15*(e._targetAt[1]-e._at[1]),e._at[2]+=.15*(e._targetAt[2]-e._at[2]),e._distance=a.d.distance(e.eye,e._at),a.a.lookAt(e.viewMatrix,e.eye,e._at,[0,0,1]);var t=e._targetFov-e._fov;return i.a.prototype._setFov.apply(e,[e._fov+.15*t]),e._updateProjection(),a.a.multiply(e.vpMatrix,e.projectMatrix,e.viewMatrix),e._cull.update(),!0},t.prototype.stop=function(e){if(this._camera){var t=this._camera;if(!e){if(!t)return;var r=this;if(a.d.distance(t.eye,t._targetEye)>.001||a.d.distance(t._at,t._targetAt)>.001||Math.abs(t._targetFov-t._fov)>.001)return void window.setTimeout(function(){r.stop()},100)}t._distance=t._targetDistance;var i=t.eye[0]-t._at[0],n=t.eye[1]-t._at[1],o=t.eye[2]-t._at[2];t._targetPhi=t._phi=Math.asin(Math.min(o/t._targetDistance,1)),t._targetPhi>=.49999*Math.PI&&(t._targetPhi=.49999*Math.PI),t._targetPhi<=-.49999*Math.PI&&(t._targetPhi=-.49999*Math.PI),t._targetTheta=t._theta=Math.atan2(n,i),t._firstPerson&&(t._targetPhi=t._phi=-t._targetPhi,t._targetTheta=t._theta=t._targetTheta+Math.PI),this.detach(),this._eventEmitter&&this._eventEmitter.emit("Camera-Navigation-Over")}},t.prototype.start=function(e,t,r,i,n){var a=this._camera,o=t[0]-e[0],s=t[1]-e[1],l=t[2]-e[2],u=Math.sqrt(o*o+s*s+l*l);if(u>1e-6?(a._targetAt[0]=t[0],a._targetAt[1]=t[1],a._targetAt[2]=t[2]):(o=a._targetAt[0]-e[0],s=a._targetAt[1]-e[1],l=a._targetAt[2]-e[2],u=Math.sqrt(o*o+s*s+l*l)),a._targetEye[0]=e[0],a._targetEye[1]=e[1],a._targetEye[2]=e[2],r&&(a._targetTheta=r),i&&(a._targetPhi=i),n&&a.setTargetFov(n),a._targetDistance=u,u<.001*a._scene.radius){var c=.001*a._scene.radius/u;a._targetDistance=.001*a._scene.radius,a._targetAt[0]=c*o+a._targetEye[0],a._targetAt[1]=c*s+a._targetEye[1],a._targetAt[2]=c*l+a._targetEye[2]}},t}(n.a);t.a=s},function(e,t,r){e.exports=r(146)},function(e,t,r){"use strict";r.d(t,"c",function(){return a});var i=r(32);r.d(t,"a",function(){return i.a}),r.d(t,"b",function(){return i.c});var n=[".obj",".3dm",".skp",".stl",".m3d",".zip",".ifc",".rvt",".fbx",".rfa",".nwc",".nwd",".s3d",".max",".dgn"];function a(e){return n.some(function(t){return e.toLowerCase().endsWith(t)})}},function(e,t,r){"use strict";r.d(t,"b",function(){return n});r(28);var i={endpoint:"",appToken:"",headers:null},n=function(e){i.endpoint=e.endpoint,i.appToken=e.appToken,i.headers=e.headers};t.a=i},function(e,t,r){"use strict";function i(e){var t=Object.create(null);for(var r in e)"symbol"!=typeof e[r]&&"__typename"!==r&&(t[r]=e[r]);return t}function n(e){var t={id:e.id,renderData:JSON.parse(e.camera),createdAt:e.createdAt};return"{}"!==e.message&&(t.extData=JSON.parse(e.message)),t}function a(e){return e.map(function(e){return n(e)})}r.d(t,"c",function(){return i}),r.d(t,"a",function(){return n}),r.d(t,"b",function(){return a})},function(e,t,r){"use strict";r.d(t,"b",function(){return c}),r.d(t,"a",function(){return h});var i=r(15),n=r(106),a=r.n(n),o=r(105),s=r.n(o),l=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},u=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},c=function(){return l(void 0,void 0,void 0,function(){var e,t,r;return u(this,function(n){switch(n.label){case 0:return[4,Object(i.a)().query({query:a.a,variables:{}})];case 1:if(e=n.sent(),t=e.data,r=e.errors)throw Error(r[0].message);return[2,t.user.projects[0].modelFolder]}})})},h=function(){return l(void 0,void 0,void 0,function(){var e,t,r;return u(this,function(n){switch(n.label){case 0:return[4,Object(i.a)().query({query:s.a,variables:{}})];case 1:if(e=n.sent(),t=e.data,r=e.errors)throw Error(r[0].message);return[2,t.user.projects[0].assetFolder]}})})}},function(e,t,r){"use strict";r.d(t,"d",function(){return E}),r.d(t,"a",function(){return T}),r.d(t,"b",function(){return S}),r.d(t,"c",function(){return A});var i=r(104),n=r.n(i),a=r(41),o=r.n(a),s=r(59),l=r.n(s),u=r(103),c=r.n(u),h=r(102),d=r.n(h),p=r(101),f=r.n(p),_=r(100),m=r.n(_),v=r(15),y=r(45),g=r(28),b=r(39),w=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},x=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},M={dwg:b.b.Dwg},E=function(e,t,r){return w(void 0,void 0,void 0,function(){var i,a,s,l,u,h,d;return x(this,function(p){switch(p.label){case 0:return[4,Object(y.a)()];case 1:return i=p.sent(),a=t,t||(s=Object(g.c)(e.name),a=s&&M[s]?M[s]:b.b.File),[4,Object(v.a)().mutate({mutation:c.a,variables:{folderId:i.id,assetName:e.name,fileNames:[e.name],type:a}})];case 2:return l=p.sent().data,u=l.uploadAsset,h=u.id,d=u.uploadUrls,[4,o.a.put(d[0].url,e,{headers:{"Content-Type":n.a.getType(e.name)},onUploadProgress:function(e){var t=e.loaded/e.total;r&&r(t)}})];case 3:return p.sent(),[4,Object(v.a)().mutate({mutation:m.a,variables:{assetId:h}})];case 4:return[2,P(p.sent().data.uploadAssetSuccess)]}})})},T=function(e){return w(void 0,void 0,void 0,function(){var t;return x(this,function(r){switch(r.label){case 0:return[4,Object(v.a)().mutate({mutation:f.a,variables:{assetId:e}})];case 1:if(t=r.sent().errors)throw Error(t[0].message);return[2,e]}})})},S=function(e){return w(void 0,void 0,void 0,function(){var t,r,i;return x(this,function(n){switch(n.label){case 0:return[4,Object(v.a)().query({query:l.a,variables:{assetId:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r.asset)throw Error("asset does not exist");if(i)throw Error(i[0].message);return[2,P(r.asset)]}})})},A=function(e,t){return w(void 0,void 0,void 0,function(){return x(this,function(r){switch(r.label){case 0:return[4,Object(v.a)().mutate({mutation:d.a,variables:{assetId:e,name:t}})];case 1:return r.sent(),[2,e]}})})};function P(e){if(!e.downloadUrls)throw Error("get download url for "+e.name+" failed");return{id:e.id,name:e.name,status:e.status,type:e.type,downloadUrl:e.downloadUrls[0].url,convertedUrls:e.convertedUrls?e.convertedUrls.map(function(e){return{filename:e.filename,url:e.url}}):null,panoConvertedUrl:e.panoConvertedUrl?e.panoConvertedUrl:null,updatedAt:e.updatedAt}}},function(e,t,r){"use strict";r.d(t,"c",function(){return y}),r.d(t,"b",function(){return g}),r.d(t,"d",function(){return b}),r.d(t,"a",function(){return w});var i=r(93),n=r.n(i),a=r(92),o=r.n(a),s=r(91),l=r.n(s),u=r(90),c=r.n(u),h=r(65),d=r.n(h),p=r(15),f=r(44),_=function(){return(_=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},m=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},v=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},y=function(e){return m(void 0,void 0,void 0,function(){var t,r,i;return v(this,function(a){switch(a.label){case 0:return[4,Object(p.a)().query({query:n.a,variables:{modelId:e}})];case 1:if(t=a.sent(),r=t.data,i=t.errors)throw Error(i[0].message);if(!r.modelComments)throw Error("model "+e+" does not exist");return[2,r.modelComments]}})})},g=function(e){return m(void 0,void 0,void 0,function(){var t,r,i;return v(this,function(n){switch(n.label){case 0:return[4,Object(p.a)().mutate({mutation:l.a,variables:{id:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r)throw Error("comment "+e+" does not exist");if(i)throw Error(i[0].message);return[2,e]}})})},b=function(e,t){return m(void 0,void 0,void 0,function(){var r,i,n,a,s,l,u,h;return v(this,function(d){switch(d.label){case 0:return[4,Object(p.a)().query({query:o.a,variables:{commentId:e},fetchPolicy:"cache-first"})];case 1:if(r=d.sent(),i=r.data,n=r.errors,!i)throw Error("comment "+e+" does not exist");if(n)throw Error(n[0].message);return a=i.modelComment,s=_(_({},JSON.parse(a.message)),t),[4,Object(p.a)().mutate({mutation:c.a,variables:{id:e,message:JSON.stringify(s),plainText:"placeholder"}})];case 2:if(l=d.sent(),u=l.data,h=l.errors,!u)throw Error("comment "+e+" does not exist");if(h)throw Error(h[0].message);return[2,Object(f.a)(u.updateModelComment)]}})})},w=function(e,t,r){return m(void 0,void 0,void 0,function(){var i,n;return v(this,function(a){switch(a.label){case 0:return[4,Object(p.a)().mutate({mutation:d.a,variables:{modelId:e,plainText:"placeholder",message:JSON.stringify(r),camera:JSON.stringify(t)}})];case 1:return i=a.sent().data,n=i.addModelComment,[2,Object(f.a)(n)]}})})}},function(e,t,r){"use strict";r.d(t,"a",function(){return a}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return s});var i=r(27),n=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},a=[{type:i.a.File,idLabel:"modelId",container:"models"},{type:i.a.Level,idLabel:"levelId",container:"levels"},{type:i.a.Category,idLabel:"categoryId",container:"categories"},{type:i.a.Family,idLabel:"familyId",container:"families"},{type:i.a.Type,idLabel:"typeId",container:"types"},{type:i.a.Element,idLabel:"elementId",container:"elements"}];function o(e,t,r,o){void 0===o&&(o={parseProps:!1,useElementIdAsId:!1,onlyDocNames:!1,ignoreElements:!1,modelId:null,docModelId:null,prependModelId:!1});var s={};r.split("\n").splice(1).forEach(function(e){var t=n(e.split(","),3),r=t[0],i=t[1],a=t[2];i&&a&&(s[i+"-"+a.trim()]=r)});var l=1,u=1,c=o.prependModelId?o.modelId+"+":"",h=(o.parseProps,!!o.useElementIdAsId),d={elements:{},types:{},families:{},levels:{},models:{},categories:{}},p=t.split("\n"),f=[null,null,null,null,null];if(o.onlyDocNames){for(var _=0;_<p.length;_++){var m=p[_];if(0!==m.length&&" "!==m.charAt(0)){var v=n(p[0].match(/(.*)\((\d)\)$/),3),y=v[0],g=(v[1],v[2]);d.models[c+g]={type:i.a.File,index:0,id:c+g,name:"",childrenNum:0,isTerrain:!0,levels:[],pathName:y+"("+g+")"}}}return d}return p.forEach(function(t){for(var r=0;" "===t.charAt(0)&&t.length>0;)r++,t=t.substr(1);t=t.trim();var p=a[r],_={type:p.type,index:u++,id:c+p.idLabel+"-"+l++,name:t||"undefined",pathName:t||"",childrenNum:0};if(p.type===i.a.File){if(!t)return;var m=(t=t.slice(0,-1)).lastIndexOf("(");if(-1===m)throw new Error("Not a valid bim.txt");var v=t.substring(m+1),y=n(o.docModelId?o.docModelId[v].split("_"):[null,null],2),g=y[0],b=y[1];_.id=c+v,_.docId=v,_.name=t.substring(0,m),_.originModelId=g||o.modelId,_.originDocId=b||v,_.pathName=_.name+"("+_.docId+")"}if(p.type===i.a.Element){if(o.ignoreElements)return;_.modelId=e,_.props="{}";var w=f[0],x=f[2];_.docId=w.docId;var M=n(o.docModelId?o.docModelId[_.docId].split("_"):[null,null],2);g=M[0],b=M[1];_.docAndCatId=parseInt(s[w.docId+"-"+x.name]),_.originModelId=g||o.modelId,_.originDocId=b||_.docId,h&&(_.id=c+(w.docId+"/")+t),_.elementId=""+t}else{_[a[r+1].container]=[]}if(p.type!==i.a.File){var E=a[r-1],T=f[r-1];T[p.container].push(_.id),T.childrenNum+=1,_[E.idLabel]=T.id}p.type===i.a.Family&&(_.levelId=f[1].id),f[r]=_,d[p.container][_.id]=_}),d}function s(e,t){var r=[],i=0;return(t=t.trim()).split("\n").forEach(function(t){if(t.indexOf(e)>-1){var n=t.split(","),a=void 0,o=void 0,s=void 0;0===i?(a=n[2].trim(),o=Number(n[3]),s=(s=n[4].trim()).length>0?s:null):(a=n[2].slice(1,n[2].length-1).trim(),o=Number(n[3]),s=(s=n[4].slice(1,n[4].length-1).trim()).length>0?s:null),i++,r.push({property:a,numValue:o,strValue:s,__typename:"ElementProperty"})}}),r}},function(e,t,r){"use strict";r.d(t,"c",function(){return c}),r.d(t,"b",function(){return h}),r.d(t,"a",function(){return i});var i,n=r(47),a=r(53),o=r(44),s=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},l=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},u={};function c(e,t,r){return s(this,void 0,void 0,function(){var i;return l(this,function(o){return i=function(e){var t=e.getTool("Comment");t||(t=e.addTool(new a.a(e)));return t.create()}(e),[2,new Promise(function(e,a){n.a(t,i,r||{}).then(function(t){return u[t.id]=t.renderData,e(t)}).catch(a)})]})})}function h(e,t){var r=e.getTool("Comment");r||(r=e.addTool(new a.a(e))),r.activate(u[t]),r.setEnabled(!0)}!function(e){e.get=function(e){return s(this,void 0,void 0,function(){return l(this,function(t){return[2,new Promise(function(t,r){n.c(e).then(function(e){var r=Object(o.b)(e);return r.forEach(function(e){u[e.id]=e.renderData}),t(r)}).catch(r)})]})})},e.remove=function(e){return s(this,void 0,void 0,function(){return l(this,function(t){return[2,new Promise(function(t,r){n.b(e).then(function(e){return delete u[e],t(e)}).catch(r)})]})})},e.update=function(e,t){return s(this,void 0,void 0,function(){return l(this,function(r){return[2,n.d(e,t)]})})}}(i||(i={}))},function(e,t,r){"use strict";var i=r(14),n=new(function(){function e(){this.mul=this.multiply}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.prototype.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.prototype.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.prototype.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.prototype.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.prototype.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=c*o-s*u,d=-c*a+s*l,p=u*a-o*l,f=r*h+i*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-c*i+n*u)*f,e[2]=(s*i-n*o)*f,e[3]=d*f,e[4]=(c*r-n*l)*f,e[5]=(-s*r+n*a)*f,e[6]=p*f,e[7]=(-u*r+i*l)*f,e[8]=(o*r-i*a)*f,e):null},e.prototype.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=n*u-i*c,e[2]=i*s-n*o,e[3]=s*l-a*c,e[4]=r*c-n*l,e[5]=n*a-r*s,e[6]=a*u-o*l,e[7]=i*l-r*u,e[8]=r*o-i*a,e},e.prototype.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*(u*a-o*l)+r*(-u*n+o*s)+i*(l*n-a*s)},e.prototype.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],p=r[1],f=r[2],_=r[3],m=r[4],v=r[5],y=r[6],g=r[7],b=r[8];return e[0]=d*i+p*o+f*u,e[1]=d*n+p*s+f*c,e[2]=d*a+p*l+f*h,e[3]=_*i+m*o+v*u,e[4]=_*n+m*s+v*c,e[5]=_*a+m*l+v*h,e[6]=y*i+g*o+b*u,e[7]=y*n+g*s+b*c,e[8]=y*a+g*l+b*h,e},e.prototype.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=d*i+p*o+u,e[7]=d*n+p*s+c,e[8]=d*a+p*l+h,e},e.prototype.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(r),p=Math.cos(r);return e[0]=p*i+d*o,e[1]=p*n+d*s,e[2]=p*a+d*l,e[3]=p*o-d*i,e[4]=p*s-d*n,e[5]=p*l-d*a,e[6]=u,e[7]=c,e[8]=h,e},e.prototype.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.prototype.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},e.prototype.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.prototype.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.prototype.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},e.prototype.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,u=r*o,c=i*o,h=i*s,d=n*o,p=n*s,f=n*l,_=a*o,m=a*s,v=a*l;return e[0]=1-h-f,e[3]=c-v,e[6]=d+m,e[1]=c+v,e[4]=1-u-f,e[7]=p-_,e[2]=d-m,e[5]=p+_,e[8]=1-u-h,e},e.prototype.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],_=t[13],m=t[14],v=t[15],y=r*s-i*o,g=r*l-n*o,b=r*u-a*o,w=i*l-n*s,x=i*u-a*s,M=n*u-a*l,E=c*_-h*f,T=c*m-d*f,S=c*v-p*f,A=h*m-d*_,P=h*v-p*_,k=d*v-p*m,O=y*k-g*P+b*A+w*S-x*T+M*E;return O?(O=1/O,e[0]=(s*k-l*P+u*A)*O,e[1]=(l*S-o*k-u*T)*O,e[2]=(o*P-s*S+u*E)*O,e[3]=(n*P-i*k-a*A)*O,e[4]=(r*k-n*S+a*T)*O,e[5]=(i*S-r*P-a*E)*O,e[6]=(_*M-m*x+v*w)*O,e[7]=(m*b-f*M-v*g)*O,e[8]=(f*x-_*b+v*y)*O,e):null},e.prototype.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},e.prototype.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},e}());t.a=n},function(e,t,r){"use strict";var i=r(33),n=r(6),a=function(){function e(){this.origin=n.a.create(),this.direction=n.a.create(),this._tempDirect=n.a.create(),this._cameraWorldMatrix=i.a.create()}return e.prototype.set=function(e,t){this.origin=e,this.direction=t},e.prototype.setFromCamera=function(e,t,r){if(r.isPerspective())n.a.copy(this.origin,r.eye),this._tempDirect=r.unproject(e,t,.5),n.a.subtract(this.direction,this._tempDirect,this.origin);else{n.a.copy(this.origin,r.unproject(e,t,(r._znear+r._zfar)/(r._znear-r._zfar)));var a=n.a.fromValues(0,0,-1);i.a.invert(this._cameraWorldMatrix,r.viewMatrix),n.a.transformDirection(this.direction,a,this._cameraWorldMatrix)}n.a.normalize(this.direction,this.direction)},e.prototype.intersectBox=function(e){var t,r,i,n,a,o,s=1/this.direction[0],l=1/this.direction[1],u=1/this.direction[2],c=this.origin;return s>=0?(t=(e[0]-c[0])*s,r=(e[3]-c[0])*s):(t=(e[3]-c[0])*s,r=(e[0]-c[0])*s),l>=0?(i=(e[1]-c[1])*l,n=(e[4]-c[1])*l):(i=(e[4]-c[1])*l,n=(e[1]-c[1])*l),!(t>n||i>r)&&((i>t||t!=t)&&(t=i),(n<r||r!=r)&&(r=n),u>=0?(a=(e[2]-c[2])*u,o=(e[5]-c[2])*u):(a=(e[5]-c[2])*u,o=(e[2]-c[2])*u),!(t>o||a>r)&&((a>t||t!=t)&&(t=a),(o<r||r!=r)&&(r=o),!(r<0)))},e.prototype.distanceToPlane=function(e,t){var r=n.a.dot(e,this.direction);if(0===r)return n.a.dot(e,this.origin)+t?0:null;var i=-(n.a.dot(this.origin,e)+t)/r;return i>=0?i:null},e.prototype.intersectPlane=function(e,t){var r=[-e[0],-e[1],-e[2]],i=this.distanceToPlane(r,t);if(null===i)return null;var a=n.a.create();return n.a.scaleAndAdd(a,this.origin,this.direction,i),a},e}();t.a=a},function(e,t,r){"use strict";var i;!function(e){!function(e){e.vec3=function(e,t,r,i){var n=1-i;e[0]=n*t[0]+i*r[0],e[1]=n*t[1]+i*r[1],e[2]=n*t[2]+i*r[2]},e.scalar=function(e,t,r){return(1-r)*e+r*t}}(e.linear||(e.linear={})),function(e){e.vec3=function(e,t,r,i){var n=1-(i=3*i*i-2*i*i*i);e[0]=n*t[0]+i*r[0],e[1]=n*t[1]+i*r[1],e[2]=n*t[2]+i*r[2]},e.scalar=function(e,t,r){return(1-(r=3*r*r-2*r*r*r))*e+r*t}}(e.cubic||(e.cubic={}))}(i||(i={})),t.a=i},function(e,t,r){"use strict";var i=r(2),n=r(19),a=r(30),o=r(40),s=r(24),l=r(37),u=r(18),c=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),h=function(e){function t(t){var r=e.call(this,"Comment",!1,t)||this;return r._pickQuery=new l.a(r._scene,r._resourceManager),r._depthQuery=new s.a(r._scene,r._resourceManager),r._animator=new a.a(t.getEventEmitter()),r._clippingEnabled=r._scene.clipping.isEnabled(),r._comments={},r}return c(t,e),t.prototype.destroy=function(){this._pickQuery.destroy(),this._pickQuery=null,delete this._pickQuery,this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery,this._comments=null,delete this._comments},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype._recompileShader=function(){if(this._scene.clipping.isEnabled()!==this._clippingEnabled){this._clippingEnabled=this._scene.clipping.isEnabled();var e=[];n.a.compressNormals&&e.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&e.push("DOUBLESIDED"),this._pickQuery.recompileShader(this._resourceManager,e),this._depthQuery.recompileShader(this._resourceManager,e)}},t.prototype.activate=function(e){var t=!1,r=this._scene.clipping.isEnabled(),n=!1;if(e.section){if(n=!0,r){var s=i.a.aabb.create(e.section.min,e.section.max);t=i.a.aabb.isEqual(this._scene.clipping.get(),s)}e.section.min&&e.section.max?this._scene.clipping.set(e.section.min,e.section.max):this._scene.clipping.set(e.section.planes,e.section.points)}else this._scene.clipping.reset(),n=!1;t=t||r!==n,(this._camera.animator instanceof a.a||this._camera.animator instanceof o.a)&&this._camera.animator.stop(!0),this._animator.attach(this._camera),this._animator.start(e.camera,!1)},t.prototype.setTransitionSpeed=function(e){this._animator.setTransitionSpeed(e)},t.prototype.create=function(){return{element:"",camera:this._camera.dump(),section:this._scene.clipping.isEnabled()?{planes:this._scene.clipping.getClippingPlanes(!0),points:this._scene.clipping.getClippingPoints(!0)}:null}},t.prototype.setComments=function(e){for(var t=0;t<e.length;t++)this._comments[e[t].id]=e[t].renderData},t.prototype.addComment=function(e){this._comments[e.id]=e.renderData},t.prototype.deleteComment=function(e){delete this._comments[e]},t.prototype._onEnableChanged=function(){if(this._recompileShader(),!this._enabled){for(var e={},t=0,r=this._comments.length;t<r;t++){e[this._comments[t].id]={x:-1,y:-1,visible:!1}}this._viewer.notifyEventListener("Comment-UpdateRenderStatus",e)}},t}(u.a);t.a=h},function(e,t,r){"use strict";var i=r(0),n=[0,0,0],a=function(){function e(e){this._default=i.a.create(),this._buffer=null,this.identity=!0,this.normalMatrix=null,e?(this.identity=!1,this.matrix=i.a.clone(e)):this.matrix=i.a.create(),i.a.copy(this._default,this.matrix),this._buffer=new Float32Array(32),this._updateMatrixBuffer()}return e.prototype.destroy=function(){this._buffer=null,delete this._buffer,this._default=null,delete this._default,this.matrix=null,delete this.matrix,this.identity=null,delete this.identity},e.prototype._updateMatrixBuffer=function(){this.identity?this.normalMatrix=i.a.create():(this.normalMatrix=i.a.create(),i.a.invert(this.normalMatrix,this.matrix),i.a.transpose(this.normalMatrix,this.normalMatrix));for(var e=0;e<16;e++)this._buffer[e]=this.matrix[e];for(e=0;e<16;e++)this._buffer[e+16]=this.normalMatrix[e]},e.prototype.use=function(e,t){var r=null,i=t.getGL();i.isWebGL2?(r=t.reservedUniforms.m_uPerNode)&&r.upload(this._buffer,i):((r=t.reservedUniforms["m_uPerNode.modelMatrix"])&&r.upload(this.matrix,i),(r=t.reservedUniforms["m_uPerNode.normalMatrix"])&&r.upload(this.normalMatrix,i))},e.prototype.setRotation=function(e,t){this._default===this.matrix&&(this._default=i.a.clone(this.matrix)),this.identity=!1;var r=[this.matrix[12],this.matrix[13],this.matrix[14]],n=this.getScaling();i.a.identity(this.matrix),this.setScaling(n[0],n[1],n[2]);var a=i.a.create(),o=i.b.create();i.b.setAxisAngle(o,[e[0],e[1],e[2]],t),i.a.fromQuat(a,o),this.multiply(a),this.matrix[12]=r[0],this.matrix[13]=r[1],this.matrix[14]=r[2],this._updateMatrixBuffer()},e.prototype.setRotationByQuat=function(e){this._default===this.matrix&&(this._default=i.a.clone(this.matrix)),this.identity=!1;var t=[this.matrix[12],this.matrix[13],this.matrix[14]],r=this.getScaling();i.a.identity(this.matrix),this.setScaling(r[0],r[1],r[2]);var n=i.a.create();i.a.fromQuat(n,e),this.multiply(n),this.matrix[12]=t[0],this.matrix[13]=t[1],this.matrix[14]=t[2],this._updateMatrixBuffer()},e.prototype.translate=function(e,t,r){this._default===this.matrix&&(this._default=i.a.clone(this.matrix)),this.identity=!1,this.matrix[12]+=e,this.matrix[13]+=t,this.matrix[14]+=r,this._updateMatrixBuffer()},e.prototype.setTranslation=function(e,t,r){this._default===this.matrix&&(this._default=i.a.clone(this.matrix)),this.identity=!1,this.matrix[12]=this._default[12]+e,this.matrix[13]=this._default[13]+t,this.matrix[14]=this._default[14]+r,this._updateMatrixBuffer()},e.prototype.setScaling=function(e,t,r){this.identity=!1;var n=[this.matrix[0],this.matrix[1],this.matrix[2]],a=[this.matrix[4],this.matrix[5],this.matrix[6]],o=[this.matrix[8],this.matrix[9],this.matrix[10]],s=e/Math.sqrt(i.d.dot(n,n)),l=t/Math.sqrt(i.d.dot(a,a)),u=r/Math.sqrt(i.d.dot(o,o));this.matrix[0]*=s,this.matrix[1]*=s,this.matrix[2]*=s,this.matrix[4]*=l,this.matrix[5]*=l,this.matrix[6]*=l,this.matrix[8]*=u,this.matrix[9]*=u,this.matrix[10]*=u,this._updateMatrixBuffer()},e.prototype.getScaling=function(){var e=[this.matrix[0],this.matrix[1],this.matrix[2]],t=[this.matrix[4],this.matrix[5],this.matrix[6]],r=[this.matrix[8],this.matrix[9],this.matrix[10]];return n[0]=Math.sqrt(i.d.dot(e,e)),n[1]=Math.sqrt(i.d.dot(t,t)),n[2]=Math.sqrt(i.d.dot(r,r)),n},e.prototype.set=function(e){e?(this.identity=!1,i.a.copy(this.matrix,e)):i.a.identity(this.matrix),i.a.copy(this._default,this.matrix),this._updateMatrixBuffer()},e.prototype.setTransform=function(e){e?(this.identity=!1,i.a.multiply(this.matrix,e,this._default)):i.a.identity(this.matrix),this._updateMatrixBuffer()},e.prototype.reset=function(){i.a.copy(this.matrix,this._default),this.identity=Math.abs(this.matrix[0]-1)<1e-5&&Math.abs(this.matrix[5]-1)<1e-5&&Math.abs(this.matrix[10]-1)<1e-5&&Math.abs(this.matrix[12])<1e-5&&Math.abs(this.matrix[13])<1e-5&&Math.abs(this.matrix[14])<1e-5,this._updateMatrixBuffer()},e.prototype.getInverted=function(e){i.a.invert(e,this.matrix)},e.prototype.multiply=function(e){this._default===this.matrix&&(this._default=i.a.clone(this.matrix)),this.identity?i.a.copy(this.matrix,e):i.a.multiply(this.matrix,e,this.matrix),this.identity=Math.abs(this.matrix[0]-1)<1e-5&&Math.abs(this.matrix[5]-1)<1e-5&&Math.abs(this.matrix[10]-1)<1e-5&&Math.abs(this.matrix[12])<1e-5&&Math.abs(this.matrix[13])<1e-5&&Math.abs(this.matrix[14])<1e-5,this._updateMatrixBuffer()},e.prototype.multiplyMatrices=function(e,t){i.a.multiply(this.matrix,e,t),this.identity=Math.abs(this.matrix[0]-1)<1e-5&&Math.abs(this.matrix[5]-1)<1e-5&&Math.abs(this.matrix[10]-1)<1e-5&&Math.abs(this.matrix[12])<1e-5&&Math.abs(this.matrix[13])<1e-5&&Math.abs(this.matrix[14])<1e-5,this._updateMatrixBuffer()},e.prototype.setDefault=function(e){i.a.copy(this._default,e),this.matrix=i.a.create()},e}();t.a=a},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i,n=r(29),a=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){!function(e){e.Family="family",e.Level="level",e.Element="element",e.Category="category",e.Type="type",e.File="file"}(e.BIMTreeNodeType||(e.BIMTreeNodeType={})),e.getElementProperties=function(e,t,r){return a(this,void 0,void 0,function(){return o(this,function(i){return[2,n.f(e,t,r)]})})},e.getElementsProperties=function(e,t){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,n.g(e,t)]})})},e.addCustomElementProperty=function(e,t,r,i){return a(this,void 0,void 0,function(){return o(this,function(a){return[2,n.a(e,t,r,i)]})})},e.addCustomElementsProperty=function(e,t,r,i){return a(this,void 0,void 0,function(){return o(this,function(a){return[2,n.b(e,t,r,i)]})})},e.removeCustomElementProperty=function(e,t,r){return a(this,void 0,void 0,function(){return o(this,function(i){return[2,n.j(e,t,r)]})})},e.removeCustomElementsProperty=function(e,t,r){return a(this,void 0,void 0,function(){return o(this,function(i){return[2,n.k(e,t,r)]})})},e.updateElementProperty=function(e,t,r){return a(this,void 0,void 0,function(){return o(this,function(i){return[2,n.l(e,t,r)]})})},e.updateElementsProperty=function(e,t,r){return a(this,void 0,void 0,function(){return o(this,function(i){return[2,n.m(e,t,r)]})})},e.getTreeInfo=function(e,t){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,n.e(e,t)]})})}}(i||(i={}))},function(e,t){var r,i,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&p())}function p(){if(!c){var e=s(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function _(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||c||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=_,n.addListener=_,n.once=_,n.off=_,n.removeListener=_,n.removeAllListeners=_,n.emit=_,n.prependListener=_,n.prependOnceListener=_,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,r){"use strict";var i=r(14),n=r(50),a=r(33),o=r(6),s=r(34),l=new(function(){function e(){this.fromValues=s.a.fromValues,this.copy=s.a.copy,this.set=s.a.set,this.add=s.a.add,this.mul=this.multiply,this.scale=s.a.scale,this.dot=s.a.dot,this.lerp=s.a.lerp,this.length=s.a.length,this.len=this.length,this.squaredLength=s.a.squaredLength,this.sqrLen=this.squaredLength,this.normalize=s.a.normalize}return e.prototype.create=function(){var e=new i.a.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},e.prototype.rotationTo=function(e,t,r){var i=o.a.create(),n=o.a.fromValues(1,0,0),a=o.a.fromValues(0,1,0),s=o.a.dot(t,r);return s<-.999999?(o.a.cross(i,n,t),o.a.length(i)<1e-6&&o.a.cross(i,a,t),o.a.normalize(i,i),this.setAxisAngle(e,i,Math.PI),e):s>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.a.cross(i,t,r),e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=1+s,this.normalize(e,e))},e.prototype.toYXZ=function(e){var t=a.a.create();a.a.fromQuat(t,e);var r={_x:0,_y:0,_z:0},i=t[0],n=(t[4],t[8]),o=t[1],s=t[5],l=t[9],u=t[2],c=(t[6],t[10]);return r._x=Math.asin(-Math.max(-1,Math.min(1,l))),Math.abs(l)<.99999?(r._y=Math.atan2(n,c),r._z=Math.atan2(o,s)):(r._y=Math.atan2(-u,i),r._z=0),r},e.prototype.setAxes=function(e,t,r,i){var a=n.a.create();return a[0]=r[0],a[3]=r[1],a[6]=r[2],a[1]=i[0],a[4]=i[1],a[7]=i[2],a[2]=-t[0],a[5]=-t[1],a[8]=-t[2],this.normalize(e,this.fromMat3(e,a))},e.prototype.clone=function(e){var t=new i.a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.prototype.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},e.prototype.setAxisAngle=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},e.prototype.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*c+o*s+n*u-a*l,e[1]=n*c+o*l+a*s-i*u,e[2]=a*c+o*u+i*l-n*s,e[3]=o*c-i*s-n*l-a*u,e},e.prototype.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-i*s,e},e.prototype.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*s,e[1]=n*l+o*s,e[2]=a*l+i*s,e[3]=o*l-n*s,e},e.prototype.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*s,e[1]=n*l-i*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},e.prototype.fromYXZ=function(e,t,r,i){var n=Math.cos(r/2),a=Math.cos(t/2),o=Math.cos(i/2),s=Math.sin(r/2),l=Math.sin(t/2),u=Math.sin(i/2);return e[0]=s*a*o+n*l*u,e[1]=n*l*o-s*a*u,e[2]=n*a*u-s*l*o,e[3]=n*a*o+s*l*u,e},e.prototype.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},e.prototype.slerp=function(e,t,r,i){var n,a,o,s,l,u=t[0],c=t[1],h=t[2],d=t[3],p=r[0],f=r[1],_=r[2],m=r[3];return(a=u*p+c*f+h*_+d*m)<0&&(a=-a,p=-p,f=-f,_=-_,m=-m),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-i)*n)/o,l=Math.sin(i*n)/o):(s=1-i,l=i),e[0]=s*u+l*p,e[1]=s*c+l*f,e[2]=s*h+l*_,e[3]=s*d+l*m,e},e.prototype.sqlerp=function(e,t,r,i,n,a){var o=this.create(),s=this.create();return this.slerp(o,t,n,a),this.slerp(s,r,i,a),this.slerp(e,o,s,2*a*(1-a)),e},e.prototype.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=a*s,e},e.prototype.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.prototype.fromMat3=function(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+n]+t[3*n+a])*r,e[o]=(t[3*o+n]+t[3*n+o])*r}return e},e.prototype.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e.prototype.fromEuler=function(e,t,r,i){var n=Math.cos,a=Math.sin,o=n(t/2),s=n(r/2),l=n(i/2),u=a(t/2),c=a(r/2),h=a(i/2);return e[0]=u*s*l+o*c*h,e[1]=o*c*l-u*s*h,e[2]=o*s*h+u*c*l,e[3]=o*s*l-u*c*h,e},e}());t.a=l},function(e,t,r){"use strict";var i=r(2),n=function(){function e(e){this._camera=e,this._scene=e._scene,this._frustum=i.a.frustum.createFromMatrix(e.vpMatrix),this._contain=!1,this._p=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._t=[0,0,0,0,0,0]}return e.prototype.isCulled=function(e){if(this._contain)return!1;var t=this._frustum,r=e.bbox;return r[this._p[0][0]]*t[0][0]+r[this._p[0][1]]*t[0][1]+r[this._p[0][2]]*t[0][2]>this._t[0]||r[this._p[1][0]]*t[1][0]+r[this._p[1][1]]*t[1][1]+r[this._p[1][2]]*t[1][2]>this._t[1]||r[this._p[2][0]]*t[2][0]+r[this._p[2][1]]*t[2][1]+r[this._p[2][2]]*t[2][2]>this._t[2]||r[this._p[3][0]]*t[3][0]+r[this._p[3][1]]*t[3][1]+r[this._p[3][2]]*t[3][2]>this._t[3]||r[this._p[4][0]]*t[4][0]+r[this._p[4][1]]*t[4][1]+r[this._p[4][2]]*t[4][2]>this._t[4]||r[this._p[5][0]]*t[5][0]+r[this._p[5][1]]*t[5][1]+r[this._p[5][2]]*t[5][2]>this._t[5]},e.prototype.update=function(e){this._frustum=i.a.frustum.createFromMatrix(this._camera.vpMatrix);for(var t=0;t<6;t++)this._p[t][0]=this._frustum[t][0]>0?0:3,this._p[t][1]=this._frustum[t][1]>0?1:4,this._p[t][2]=this._frustum[t][2]>0?2:5,this._t[t]=-this._frustum[t][3];this._contain=i.a.inside.aabb_frustum(e||this._scene.bbox,this._frustum)},e}();t.a=n},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"asset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"assetId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filenames"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"convertedUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"panoConvertedUrl"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:309}};r.loc.source={body:"query GetAsset($assetId: Int!) {\n  asset(id: $assetId) {\n    id\n    name\n    type\n    status\n    filenames\n    createdBy {\n      id\n      username\n    }\n    createdAt\n    updatedAt\n    convertedUrls {\n      filename\n      url\n    }\n    downloadUrls {\n      filename\n      url\n    }\n    panoConvertedUrl\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetAsset=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetAsset")},function(e,t,r){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelInfo"},directives:[]},{kind:"Field",name:{kind:"Name",value:"versionedModels"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelInfo"},directives:[]}]}}]}}]}}],loc:{start:0,end:175}};i.loc.source={body:'#import "./ModelInfo.gql"\n\nquery GetModel($modelId: Id!) {\n    model(id: $modelId) {\n        ...ModelInfo\n        versionedModels {\n            ...ModelInfo\n        }\n    }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};i.definitions=i.definitions.concat(function(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!n[t]&&(n[t]=!0,!0)})}(r(147).definitions));var a={};function o(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}i.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),a[e.name.value]=t}}),e.exports=i,e.exports.GetModel=function(e,t){var r={kind:e.kind,definitions:[o(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var i=a[t]||new Set,n=new Set,s=new Set;for(i.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){n.has(e)||(n.add(e),(a[e]||new Set).forEach(function(e){s.add(e)}))})}return n.forEach(function(t){var i=o(e,t);i&&r.definitions.push(i)}),r}(i,"GetModel")},function(e){e.exports={0:"PG_IDENTITY_DATA",1:"PG_GEOMETRY",3:"PG_CONSTRUCTION",4:"PG_GRAPHICS",5:"PG_MATERIALS",6:"PG_UNDERLAY",7:"PG_STAIR_TREADS",8:"PG_STAIR_RISERS",9:"PG_STAIR_STRINGERS",10:"PG_ELECTRICAL",11:"PG_PLUMBING",12:"PG_STRUCTURAL",13:"PG_MECHANICAL",14:"PG_PHASING",19:"PG_CONSTRAINTS",20:"PG_PATTERN",21:"PG_VIEW_EXTENTS",22:"PG_VIEW_CAMERA",23:"PG_TEXT",24:"PG_ELECTRICAL_LIGHTING",25:"PG_ELECTRICAL_LOADS",26:"PG_MECHANICAL_LOADS",27:"PG_MECHANICAL_AIRFLOW",28:"PG_STRUCTURAL_ANALYSIS",29:"PG_ENERGY_ANALYSIS",30:"PG_AELECTRICAL",31:"PG_IFC",33:"PG_CURTAIN_GRID_VERT",34:"PG_CURTAIN_GRID_1",35:"PG_CURTAIN_GRID_HORIZ",36:"PG_CURTAIN_GRID_2",37:"PG_CURTAIN_MULLION_VERT",38:"PG_CURTAIN_MULLION_1",39:"PG_CURTAIN_MULLION_HORIZ",40:"PG_CURTAIN_MULLION_2",41:"PG_CURTAIN_GRID",43:"PG_REBAR_SYSTEM_LAYERS",44:"PG_REBAR_ARRAY",45:"PG_ANALYTICAL_MODEL",46:"PG_TRANSLATION_IN",47:"PG_ROTATION_ABOUT",48:"PG_FIRE_PROTECTION",49:"PG_TITLE",50:"PG_TRUSS_FAMILY_VERT_WEB",51:"PG_TRUSS_FAMILY_DIAG_WEB",52:"PG_TRUSS_FAMILY_TOP_CHORD",53:"PG_TRUSS_FAMILY_BOTTOM_CHORD",54:"PG_PROFILE",55:"PG_PROFILE_1",56:"PG_PROFILE_2",57:"PG_GREEN_BUILDING",58:"PG_PATTERN_APPLICATION",59:"PG_LIGHT_PHOTOMETRICS",60:"PG_SLAB_SHAPE_EDIT",61:"PG_ANALYSIS_RESULTS",62:"PG_DISPLAY",63:"PG_CURTAIN_GRID_U",64:"PG_CURTAIN_GRID_V",65:"PG_ADSK_MODEL_PROPERTIES",66:"PG_AREA",67:"PG_CONCEPTUAL_ENERGY_DATA",68:"PG_FITTING",69:"PG_ENERGY_ANALYSIS_DETAILED_AND_CONCEPTUAL_MODELS",70:"PG_ENERGY_ANALYSIS_DETAILED_MODEL",71:"PG_ENERGY_ANALYSIS_CONCEPTUAL_MODEL",72:"PG_FLEXIBLE",73:"PG_GENERAL",74:"PG_ELECTRICAL_CIRCUITING",75:"PG_DATA",76:"PG_CONCEPTUAL_ENERGY_DATA_BUILDING_SERVICES",77:"PG_RAILING_SYSTEM_FAMILY_TOP_RAIL",78:"PG_RAILING_SYSTEM_FAMILY_HANDRAILS",79:"PG_RAILING_SYSTEM_FAMILY_SEGMENT_PATTERN",80:"PG_RAILING_SYSTEM_SEGMENT_PATTERN_REPEAT",81:"PG_RAILING_SYSTEM_SEGMENT_PATTERN_REMAINDER",82:"PG_RAILING_SYSTEM_SEGMENT_POSTS",83:"PG_RAILING_SYSTEM_SEGMENT_U_GRID",84:"PG_RAILING_SYSTEM_SEGMENT_V_GRID",85:"PG_SUPPORT",86:"PG_VISIBILITY",87:"PG_OVERALL_LEGEND",88:"PG_INSULATION",89:"PG_LINING",90:"PG_SYSTEMTYPE_RISEDROP",91:"PG_ANALYTICAL_ALIGNMENT",92:"PG_ANALYTICAL_PROPERTIES",93:"PG_NODES",94:"PG_LENGTH",95:"PG_SPLIT_PROFILE_DIMENSIONS",96:"PG_STAIRS_CALCULATOR_RULES",97:"PG_STAIRS_TREADS_RISERS",98:"PG_TERMINTATION",99:"PG_RAILING_SYSTEM_SECONDARY_FAMILY_HANDRAILS",100:"PG_STAIRS_OPEN_END_CONNECTION",101:"PG_STAIRS_SUPPORTS",102:"PG_STAIRS_WINDERS",103:"PG_CONTINUOUSRAIL_BEGIN_BOTTOM_EXTENSION",104:"PG_CONTINUOUSRAIL_END_TOP_EXTENSION",105:"PG_SEGMENTS_FITTINGS",106:"PG_DIVISION_GEOMETRY",107:"PG_GEOMETRY_POSITIONING",108:"PG_REFERENCE",110:"PG_FABRICATION_PRODUCT_DATA",111:"PG_FORCES",112:"PG_MOMENTS",113:"PG_PRIMARY_END",114:"PG_SECONDARY_END",116:"PG_RELEASES_MEMBER_FORCES",117:"PG_ENERGY_ANALYSIS_ADVANCED",118:"PG_COUPLER_ARRAY",119:"PG_ENERGY_ANALYSIS_BUILDING_DATA",120:"PG_ENERGY_ANALYSIS_ROOM_SPACE_DATA",121:"PG_ENERGY_ANALYSIS_BLDG_CONS_MTL_THERMAL_PROPS",125:"PG_STRUCTURAL_SECTION_GEOMETRY",126:"PG_GEO_LOCATION",688:"MODELO_PROPERTIES",689:"MODELO_CUSTOM_PROPERTIES",888:"MODELO_CONNECTED_DATA","-1":"INVALID"}},function(e,t,r){"use strict";(function(t){var i=r(36),n=r(143),a={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=r(73):void 0!==t&&(e=r(73)),e}(),transformRequest:[function(e,t){return n(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(o(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function(e){s.headers[e]={}}),i.forEach(["post","put","patch"],function(e){s.headers[e]=i.merge(a)}),e.exports=s}).call(this,r(56))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i,n=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function n(e,t){if(!i[e]){i[e]={};for(var r=0;r<e.length;r++)i[e][e.charAt(r)]=r}return i[e][t]}var a={compressToBase64:function(e){if(null==e)return"";var r=a._compress(e,6,function(e){return t.charAt(e)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:a._decompress(e.length,32,function(r){return n(t,e.charAt(r))})},compressToUTF16:function(t){return null==t?"":a._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=a.compress(e),r=new Uint8Array(2*t.length),i=0,n=t.length;i<n;i++){var o=t.charCodeAt(i);r[2*i]=o>>>8,r[2*i+1]=o%256}return r},decompressFromUint8Array:function(t){if(null===t||void 0===t)return a.decompress(t);for(var r=new Array(t.length/2),i=0,n=r.length;i<n;i++)r[i]=256*t[2*i]+t[2*i+1];var o=[];return r.forEach(function(t){o.push(e(t))}),a.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,function(e){return r.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),a._decompress(e.length,32,function(t){return n(r,e.charAt(t))}))},compress:function(t){return a._compress(t,16,function(t){return e(t)})},_compress:function(e,t,r){if(null==e)return"";var i,n,a,o={},s={},l="",u="",c="",h=2,d=3,p=2,f=[],_=0,m=0;for(a=0;a<e.length;a+=1)if(l=e.charAt(a),Object.prototype.hasOwnProperty.call(o,l)||(o[l]=d++,s[l]=!0),u=c+l,Object.prototype.hasOwnProperty.call(o,u))c=u;else{if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(i=0;i<p;i++)_<<=1,m==t-1?(m=0,f.push(r(_)),_=0):m++;for(n=c.charCodeAt(0),i=0;i<8;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1}else{for(n=1,i=0;i<p;i++)_=_<<1|n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n=0;for(n=c.charCodeAt(0),i=0;i<16;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1}0==--h&&(h=Math.pow(2,p),p++),delete s[c]}else for(n=o[c],i=0;i<p;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1;0==--h&&(h=Math.pow(2,p),p++),o[u]=d++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(i=0;i<p;i++)_<<=1,m==t-1?(m=0,f.push(r(_)),_=0):m++;for(n=c.charCodeAt(0),i=0;i<8;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1}else{for(n=1,i=0;i<p;i++)_=_<<1|n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n=0;for(n=c.charCodeAt(0),i=0;i<16;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1}0==--h&&(h=Math.pow(2,p),p++),delete s[c]}else for(n=o[c],i=0;i<p;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(n=2,i=0;i<p;i++)_=_<<1|1&n,m==t-1?(m=0,f.push(r(_)),_=0):m++,n>>=1;for(;;){if(_<<=1,m==t-1){f.push(r(_));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,r,i){var n,a,o,s,l,u,c,h=[],d=4,p=4,f=3,_="",m=[],v={val:i(0),position:r,index:1};for(n=0;n<3;n+=1)h[n]=n;for(o=0,l=Math.pow(2,2),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;switch(o){case 0:for(o=0,l=Math.pow(2,8),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;c=e(o);break;case 1:for(o=0,l=Math.pow(2,16),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;c=e(o);break;case 2:return""}for(h[3]=c,a=c,m.push(c);;){if(v.index>t)return"";for(o=0,l=Math.pow(2,f),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;switch(c=o){case 0:for(o=0,l=Math.pow(2,8),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;h[p++]=e(o),c=p-1,d--;break;case 1:for(o=0,l=Math.pow(2,16),u=1;u!=l;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=r,v.val=i(v.index++)),o|=(s>0?1:0)*u,u<<=1;h[p++]=e(o),c=p-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,f),f++),h[c])_=h[c];else{if(c!==p)return null;_=a+a.charAt(0)}m.push(_),h[p++]=a+_.charAt(0),a=_,0==--d&&(d=Math.pow(2,f),f++)}}};return a}();void 0===(i=function(){return n}.call(t,r,t,e))||(e.exports=i)},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddModelComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"plainText"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"bimdata"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"camera"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Id"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addModelComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"message"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}},{kind:"Argument",name:{kind:"Name",value:"plainText"},value:{kind:"Variable",name:{kind:"Name",value:"plainText"}}},{kind:"Argument",name:{kind:"Name",value:"bimdata"},value:{kind:"Variable",name:{kind:"Name",value:"bimdata"}}},{kind:"Argument",name:{kind:"Name",value:"camera"},value:{kind:"Variable",name:{kind:"Name",value:"camera"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bimdata"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"camera"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"plainText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:371}};r.loc.source={body:"mutation AddModelComment($message: String!, $plainText: String!, $bimdata: String, $camera: String, $modelId: Id) {\n    addModelComment(message: $message, plainText: $plainText, bimdata: $bimdata, camera: $camera, modelId: $modelId) {\n        id\n        bimdata\n        camera\n        modelId\n        message\n        plainText\n        createdAt\n        updatedAt\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.AddModelComment=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"AddModelComment")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"BatchDeleteProperties"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"batchDeleteProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"docAndCatIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"elementIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"propertyArr"},value:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}}}],directives:[]}]}}],loc:{start:0,end:279}};r.loc.source={body:"mutation BatchDeleteProperties(\n  $modelId: Id!\n  $docAndCatIdArr: [Int]!\n  $elementIdArr: [Int]!\n  $propertyArr: [String]!\n) {\n  batchDeleteProperties(\n    modelId: $modelId\n    docAndCatIdArr: $docAndCatIdArr\n    elementIdArr: $elementIdArr\n    propertyArr: $propertyArr\n  )\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.BatchDeleteProperties=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"BatchDeleteProperties")},function(e,t){},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i=Object.prototype,n=i.toString,a=i.hasOwnProperty,o=new Map;function s(e,t){try{return function e(t,r){if(t===r)return!0;var i=n.call(t);var o=n.call(r);if(i!==o)return!1;switch(i){case"[object Array]":if(t.length!==r.length)return!1;case"[object Object]":if(l(t,r))return!0;var s=Object.keys(t),u=Object.keys(r),c=s.length;if(c!==u.length)return!1;for(var h=0;h<c;++h)if(!a.call(r,s[h]))return!1;for(var h=0;h<c;++h){var d=s[h];if(!e(t[d],r[d]))return!1}return!0;case"[object Error]":return t.name===r.name&&t.message===r.message;case"[object Number]":if(t!=t)return r!=r;case"[object Boolean]":case"[object Date]":return+t==+r;case"[object RegExp]":case"[object String]":return t==""+r;case"[object Map]":case"[object Set]":if(t.size!==r.size)return!1;if(l(t,r))return!0;for(var p=t.entries(),f="[object Map]"===i;;){var _=p.next();if(_.done)break;var m=_.value,v=m[0],y=m[1];if(!r.has(v))return!1;if(f&&!e(y,r.get(v)))return!1}return!0}return!1}(e,t)}finally{o.clear()}}function l(e,t){var r=o.get(e);if(r){if(r.has(t))return!0}else o.set(e,r=new Set);return r.add(t),!1}},function(e,t,r){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";var i=r(141);e.exports=function(e,t,r,n,a){var o=new Error(e);return i(o,t,r,n,a)}},function(e,t,r){"use strict";var i=r(36),n=r(142),a=r(140),o=r(139),s=r(138),l=r(72);e.exports=function(e){return new Promise(function(t,u){var c=e.data,h=e.headers;i.isFormData(c)&&delete h["Content-Type"];var d=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",f=e.auth.password||"";h.Authorization="Basic "+btoa(p+":"+f)}if(d.open(e.method.toUpperCase(),a(e.url,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,d.onreadystatechange=function(){if(d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in d?o(d.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:r,config:e,request:d};n(t,u,i),d=null}},d.onerror=function(){u(l("Network Error",e,null,d)),d=null},d.ontimeout=function(){u(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",d)),d=null},i.isStandardBrowserEnv()){var _=r(137),m=(e.withCredentials||s(e.url))&&e.xsrfCookieName?_.read(e.xsrfCookieName):void 0;m&&(h[e.xsrfHeaderName]=m)}if("setRequestHeader"in d&&i.forEach(h,function(e,t){void 0===c&&"content-type"===t.toLowerCase()?delete h[t]:d.setRequestHeader(t,e)}),e.withCredentials&&(d.withCredentials=!0),e.responseType)try{d.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&d.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){d&&(d.abort(),u(e),d=null)}),void 0===c&&(c=null),d.send(c)})}},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];return e.apply(t,r)}}},function(e,t,r){"use strict";var i,n,a=r(17),o=function(){function e(e,t){this.name=e,this._enabled=!1,this._canvas=t.getCanvas(),this._viewer=t,this._event=null}return e.prototype.destroy=function(){this._enabled=null,delete this._enabled,this.name=null,delete this.name,this._event=null,delete this._event,this._canvas=null,delete this._canvas},e.prototype.isAvailable=function(e){return!1},e.prototype.setEnabled=function(e){this._enabled=e},e}(),s=r(1),l=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),u=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},h=function(e){function t(t){var r=e.call(this,"mouse",t)||this;r.LEFT_BUTTON=0,r.MIDDLE_BUTTON=1,r.RIGHT_BUTTON=2,r._downListeners=new Map,r._moveListeners=new Map,r._upListeners=new Map,r._wheelListeners=new Map,r._dbClickListeners=new Map,r._x0=-1,r._y0=-1,r._lastWheelTime=0,r._eventQueue=[],r.x=-1,r.y=-1,r.dx=-1,r.dy=-1,r.pressed=!1,r.moved=!1,r.delta=0,r.button=r.LEFT_BUTTON,r.preUpDate=-201,r.nowUpDate=0;var i=0,n=r;function o(e){return function(t){if((t.relatedTarget||t.toElement||t.currentTarget)===n._canvas||"mouseup"===t.type)return t.offsetX_norm=void 0===t.offsetX?t.layerX:t.offsetX,t.offsetY_norm=void 0===t.offsetY?t.layerY:t.offsetY,"firefox"===s.a.browserName||"edge"===s.a.browserName?t.buttonDown=i:t.buttonDown=t.which,e.call(n,t)}}r._canvas.onwheel=Object(a.b)(o(r._onMouseWheel)),r._canvas.onmousemove=Object(a.b)(o(r._onMouseMove)),r._canvas.ondblclick=o(r._onMouseDblclick);var l=o(r._onMouseDown);r._canvas.onmousedown=function(e){i=e.which,l(e)};var u=o(r._onMouseUp);return r._mouseUp=function(e){u(e),i=0},r._onMouseLeave=function(e){i=0},document.addEventListener("mouseup",r._mouseUp,!1),document.addEventListener("mouseout",r._onMouseLeave,!1),r}return l(t,e),t.prototype.destroy=function(){this._canvas.onmousedown=null,this._canvas.onmouseleave=null,this._canvas.ondblclick=null,this._canvas.onwheel=null,this._canvas.onmousemove=null,document.removeEventListener("mouseup",this._mouseUp),document.removeEventListener("mouseout",this._onMouseLeave),this._downListeners=null,delete this._downListeners,this._upListeners=null,delete this._upListeners,this._moveListeners=null,delete this._moveListeners,this._wheelListeners=null,delete this._wheelListeners,this._dbClickListeners=null,delete this._dbClickListeners,this._enabled=null,delete this._eventQueue,e.prototype.destroy.call(this)},t.prototype.addMouseDownListener=function(e,t){t||(t="mouseDown "+a.a.generateUUID()),this._downListeners.set(t,e)},t.prototype.addMouseMoveListener=function(e,t){t||(t="mouseMove "+a.a.generateUUID()),this._moveListeners.set(t,e)},t.prototype.addMouseUpListener=function(e,t){t||(t="mouseUp "+a.a.generateUUID()),this._upListeners.set(t,e)},t.prototype.addMouseWheelListener=function(e,t){t||(t="mouseWheel "+a.a.generateUUID()),this._wheelListeners.set(t,e)},t.prototype.addMouseDbClickListener=function(e,t){t||(t="mouseDbClick "+a.a.generateUUID()),this._dbClickListeners.set(t,e)},t.prototype.isAvailable=function(e){return!e},t.prototype._onMouseDown=function(e){var t,r;if(this._enabled&&this._viewer.isRendering()){e.preventDefault(),this.pressed=!0;var i=e.offsetX_norm,n=e.offsetY_norm;this.dx=0,this.dy=0,this.x=i,this.y=n,this.moved=!1,this.button=e.button,this._x0=this.x,this._y0=this.y,this._event=e,this.isDoubleClick=!1;try{for(var a=u(this._downListeners.entries()),o=a.next();!o.done;o=a.next()){var s=c(o.value,2),l=s[0],h=s[1];if("CameraManipulator"!==l&&h(this))return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var d=this._downListeners.get("CameraManipulator");d&&d(this)}},t.prototype._onMouseUp=function(e){var t,r;if(this._enabled&&this._viewer.isRendering()){e.preventDefault(),this.nowUpDate=performance.now();var i=this.nowUpDate-this.preUpDate;this.isDoubleClick=i<200,this.preUpDate=performance.now(),this.pressed=!1;var n=e.offsetX_norm,a=e.offsetY_norm;this.dx=n-this.x,this.dy=a-this.y,this.x=n,this.y=a,this._event=e,this.button=e.button,this.moved=Math.abs(this.x-this._x0)>3||Math.abs(this.y-this._y0)>3;try{for(var o=u(this._upListeners.entries()),s=o.next();!s.done;s=o.next()){var l=c(s.value,2),h=l[0],d=l[1];if("CameraManipulator"!==h&&d(this))return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var p=this._upListeners.get("CameraManipulator");p&&p(this)}},t.prototype._onMouseMove=function(e){var t,r;if(this._enabled&&this._viewer.isRendering()){e.preventDefault();var i=e.offsetX_norm,n=e.offsetY_norm;if(this.dx=i-this.x,this.dy=n-this.y,0!==this.dx||0!==this.dy){this.x=i,this.y=n,this._event=e,this.moved=Math.abs(this.x-this._x0)>3||Math.abs(this.y-this._y0)>3;try{for(var a=u(this._moveListeners.entries()),o=a.next();!o.done;o=a.next()){var s=c(o.value,2),l=s[0],h=s[1];if("CameraManipulator"!==l&&h(this))return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var d=this._moveListeners.get("CameraManipulator");d&&d(this)}}},t.prototype._onMouseWheel=function(e){var t,r;if(this._enabled&&this._viewer.isRendering()){e.preventDefault();var i=e.deltaY;this.delta=-Math.max(-1,Math.min(1,i)),"firefox"!==s.a.browserName&&(this.delta*=Math.min(i*i/2500,1));try{for(var n=u(this._wheelListeners.entries()),a=n.next();!a.done;a=n.next()){var o=c(a.value,2),l=o[0],h=o[1];if("CameraManipulator"!==l&&h(this))return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}var d=this._wheelListeners.get("CameraManipulator");d&&d(this)}},t.prototype._onMouseDblclick=function(e){var t,r;if(this._enabled&&this._viewer.isRendering()){e.preventDefault();var i=e.offsetX_norm,n=e.offsetY_norm;this.dx=i-this.x,this.dy=n-this.y,this.x=i,this.y=n,this._event=e,(Math.abs(this.x-this._x0)>3||Math.abs(this.y-this._y0)>3)&&(this.moved=!0),this.isDoubleClick=!0;try{for(var a=u(this._dbClickListeners.entries()),o=a.next();!o.done;o=a.next()){var s=c(o.value,2),l=s[0],h=s[1];if("CameraManipulator"!==l&&h(this))return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var d=this._dbClickListeners.get("CameraManipulator");d&&d(this)}},t.prototype.getEvent=function(){return this._event},t}(o),d=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),p=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},_=function(e){function t(t){var r=e.call(this,"touch",t)||this;return r._startListeners=new Map,r._moveListeners=new Map,r._stopListeners=new Map,r._dbClickListeners=new Map,r.numCursors=0,r.x0=0,r.y0=0,r.cursors={},r.identifiers=[],r.lastCursor=null,r.clickTime=0,r.isDoubleClick=!1,r._onTouchStart=r._onTouchStart1.bind(r),r._onTouchMove=r._onTouchMove1.bind(r),r._onTouchStop=r._onTouchStop1.bind(r),r._canvas.addEventListener("touchstart",r._onTouchStart,!1),r._canvas.addEventListener("touchmove",r._onTouchMove,!1),r._canvas.addEventListener("touchend",r._onTouchStop,!1),r}return d(t,e),t.prototype.destroy=function(){this._canvas.removeEventListener("touchstart",this._onTouchStart),this._canvas.removeEventListener("touchmove",this._onTouchMove),this._canvas.removeEventListener("touchend",this._onTouchStop),this._startListeners=null,delete this._startListeners,this._moveListeners=null,delete this._moveListeners,this._stopListeners=null,delete this._stopListeners,this._dbClickListeners=null,delete this._dbClickListeners,e.prototype.destroy.call(this)},t.prototype.cursor=function(e){return e<this.identifiers.length?this.cursors[this.identifiers[e]]:null},t.prototype.addTouchMoveListener=function(e,t){t||(t="touchMove "+a.a.generateUUID()),this._moveListeners.set(t,e)},t.prototype.addTouchStartListener=function(e,t){t||(t="touchStart "+a.a.generateUUID()),this._startListeners.set(t,e)},t.prototype.addTouchStopListener=function(e,t){t||(t="touchStop "+a.a.generateUUID()),this._stopListeners.set(t,e)},t.prototype.addTouchDbClickListener=function(e,t){t||(t="touchDbclick "+a.a.generateUUID()),this._dbClickListeners.set(t,e)},t.prototype._onTouchStart1=function(e){var t,r,i,n;e.preventDefault(),this.numCursors=e.touches.length;for(var a=0;a<e.changedTouches.length;++a)this._addCursor(e.changedTouches[a]);var o="";for(var s in this.cursors)null!==this.cursors[s]&&(o=s);if(1===this.numCursors){var l=this.cursors[o],u=(new Date).getTime();this.lastCursor&&(u-this.clickTime<400&&Math.abs(this.lastCursor.x-l.x)<50&&Math.abs(this.lastCursor.y-l.y)<50?this.isDoubleClick=!0:this.isDoubleClick=!1),this.lastCursor=this.cursor(0),this.clickTime=u}else this.isDoubleClick=!1;try{for(var c=p(this._startListeners.entries()),h=c.next();!h.done;h=c.next()){var d=f(h.value,2),_=d[0],m=d[1];if("CameraManipulator"!==_){if(m(this))return;(b=this._startListeners.get("CameraManipulator"))&&b(this)}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}if(this.isDoubleClick){try{for(var v=p(this._dbClickListeners.entries()),y=v.next();!y.done;y=v.next()){var g=f(y.value,2);_=g[0],m=g[1];if("CameraManipulator"!==_&&m(this))return}}catch(e){i={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}var b;(b=this._dbClickListeners.get("CameraManipulator"))&&b(this)}},t.prototype._onTouchMove1=function(e){var t,r;e.preventDefault();this.numCursors=e.touches.length;for(var i=[],n=0;n<e.touches.length;n++)this.cursors[e.touches[n].identifier]||this._addCursor(e.touches[n]),i.push(e.touches[n].identifier);for(var a in this.cursors){var o=Number(a);-1===i.indexOf(o)&&this._removeCursor(o)}for(var s=this._canvas.getBoundingClientRect(),l=0;l<e.changedTouches.length;++l){var u=e.changedTouches[l].pageX-s.left,c=e.changedTouches[l].pageY-s.top,h=e.changedTouches[l].identifier;this.cursors[h].dx=u-this.cursors[h].x,this.cursors[h].dy=c-this.cursors[h].y,this.cursors[h].x=u,this.cursors[h].y=c,this.cursors[h].moved=!0}try{for(var d=p(this._moveListeners.entries()),_=d.next();!_.done;_=d.next()){var m=f(_.value,2),v=m[0],y=m[1];if("CameraManipulator"!==v&&y(this))return}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}var g=this._moveListeners.get("CameraManipulator");g&&g(this)},t.prototype._onTouchStop1=function(e){e.preventDefault(),this.numCursors=e.touches.length;for(var t=0;t<e.changedTouches.length;t++){var r=e.changedTouches[t].identifier;this._removeCursor(r)}},t.prototype.isAvailable=function(e){return!0},t.prototype._removeCursor=function(e){var t,r,i=this.identifiers.indexOf(e);-1!==i&&this.identifiers.splice(i,1),this.cursorStopped=this.cursors[e];try{for(var n=p(this._stopListeners.entries()),a=n.next();!a.done;a=n.next()){var o=f(a.value,2),s=o[0],l=o[1];if("CameraManipulator"!==s&&l(this))return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}var u=this._stopListeners.get("CameraManipulator");u&&u(this),delete this.cursors[e]},t.prototype._addCursor=function(e){var t=this._canvas.getBoundingClientRect(),r=e.identifier,i={x:e.pageX-t.left,y:e.pageY-t.top,dx:0,dy:0,moved:!1};this.cursors[r]=i,this.identifiers.push(r)},t}(o),m=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),v=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},y=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},g=function(e){function t(t){var r=e.call(this,"keyboard",t)||this;return r._upListeners=new Map,r._downListeners=new Map,r._enabled=!0,r.key="Dead",r.keyCode=-1,r._keyDownFn=r._keyDown.bind(r),r._keyUpFn=r._keyUp.bind(r),document.addEventListener("keydown",r._keyDownFn),document.addEventListener("keyup",r._keyUpFn),r}return m(t,e),t.prototype.destroy=function(){this._upListeners=null,delete this._upListeners,this._downListeners=null,delete this._downListeners,document.removeEventListener("keydown",this._keyDownFn),document.removeEventListener("keyup",this._keyUpFn),this._keyDownFn=null,delete this._keyDownFn,this._keyUpFn=null,delete this._keyUpFn,e.prototype.destroy.call(this)},t.prototype.isAvailable=function(e){return!e},t.prototype.addKeyUpListener=function(e,t){t||(t="keyDown "+a.a.generateUUID()),this._upListeners.set(t,e)},t.prototype.addKeyDownListener=function(e,t){t||(t="keyDown "+a.a.generateUUID()),this._downListeners.set(t,e)},t.prototype._keyDown=function(e){var t,r;if(this._doesCanvasHaveFocus()){e.preventDefault(),this.key=e.key,this.repeat=e.repeat,this.keyCode=e.keyCode;try{for(var i=v(this._downListeners.entries()),n=i.next();!n.done;n=i.next()){var a=y(n.value,2),o=a[0],s=a[1];if("CameraManipulator"!==o&&s(this))return}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}var l=this._downListeners.get("CameraManipulator");l&&l(this)}},t.prototype._keyUp=function(e){var t,r;if(this._doesCanvasHaveFocus()){e.preventDefault(),this.key=e.key,this.keyCode=e.keyCode;try{for(var i=v(this._upListeners.entries()),n=i.next();!n.done;n=i.next()){var a=y(n.value,2),o=a[0],s=a[1];if("CameraManipulator"!==o&&s(this))return}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}var l=this._upListeners.get("CameraManipulator");l&&l(this)}},t.prototype._doesCanvasHaveFocus=function(){if(!this._enabled)return!1;var e=document.activeElement,t=e&&e!==document.body;if(!t)return!0;if("tui-select-selection"===e.className)return!0;if("INPUT"===e.tagName){var r=e.type||e.getAttribute("type");t=!("password"!==r&&"text"!==r&&"number"!==r&&"search"!==r)}if("BUTTON"!==e.tagName&&"SELECT"!==e.tagName||(t=!1),t)return!1;var i="";return void 0!==window.getSelection?i=window.getSelection().toString():void 0!==document.selection&&"Text"===document.selection.type&&(i=document.selection.createRange().text),!i&&!t},t}(o),b=r(80),w=r(79),x=r.n(w),M=function(){return function(){this.vramSize=0,this.littleEndian=!0;var e=(new x.a).getResult(),t=(e.device.model||"").toLowerCase();switch(this.browserName=(e.browser&&e.browser.name||"").toLowerCase(),this.browserVersion=(e.browser&&e.browser.major||"").toLowerCase(),this.browserEngineName=(e.engine&&e.engine.name||"").toLowerCase(),this.browserEngineVersion=(e.engine&&e.engine.version||"").toLowerCase(),this.deviceModel=(e.device&&e.device.model||"").toLowerCase(),this.deviceType=(e.device&&e.device.type||"").toLowerCase(),this.deviceVendor=(e.device&&e.device.vendor||"").toLowerCase(),this.osName=(e.os&&e.os.name||"").toLowerCase(),this.osVersion=(e.os&&e.os.version||"").toLowerCase(),this.cpuArchitecture=(e.cpu&&e.cpu.architecture||"").toLowerCase(),t){case"iphone":this.vramSize=1024;break;case"ipad":this.vramSize=2048;break;default:this.vramSize=4096}}}(),E=function(){function e(){this.events={}}return e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.events[e]&&this.events[e].forEach(function(e){return e.apply(null,t)})},e.prototype.on=function(e,t){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){var i;r.events[e]=null===(i=r.events[e])||void 0===i?void 0:i.filter(function(e){return e!==t})}},e.prototype.remove=function(e,t){if(this.events[e]){var r=this.events[e].indexOf(t);-1!==r&&this.events[e].splice(r,1)}},e.prototype.clear=function(){this.events={}},e}(),T=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},S=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(T(arguments[t]));return e};!function(e){e[e.INITIALIZED=-1]="INITIALIZED",e[e.UNINITIALIZED=-2]="UNINITIALIZED",e[e.RENDERING=-3]="RENDERING",e[e.INITIALIZED_PAUSED=-4]="INITIALIZED_PAUSED",e[e.RENDERING_PAUSED=-5]="RENDERING_PAUSED",e[e.TICK_PAUSED=-6]="TICK_PAUSED"}(i||(i={})),function(e){e[e.VIEW_NULL=-1]="VIEW_NULL",e[e.VIEW_360=0]="VIEW_360",e[e.VIEW_MODEL=1]="VIEW_MODEL"}(n||(n={}));var A=function(){function e(e,t,r,n){var a=this;if(void 0===t&&(t={isMobile:!1,initResize:!0}),this._nFramesTobeDrawnNormally=0,this._nFramesTobeDrawnProgressively=0,this.state=i.UNINITIALIZED,this._canvasId="ModeloCanvas-"+e,this._container=document.getElementById(e),!this._container)throw Error("The container '"+e+"' doesn't exist.");if(r&&n&&(this._container.style.width=r+"px",this._container.style.height=n+"px"),this.viewType=-1,0===this._container.clientHeight)throw Error("The container '"+e+"' should have height");if(this._canvas=document.getElementById(this._canvasId),this._canvas)throw Error("A viewer has already been created in container '"+this._canvas.parentElement.id+"'. Please call viewer.destroy() first.");this._canvas=document.createElement("canvas"),this._canvas.id=this._canvasId,this._canvas.style.display="block",this._container.appendChild(this._canvas),this._canvas.oncontextmenu=function(){return!1};var o=r||this._container.clientWidth,l=n||this._container.clientHeight;s.a.devicePixelRatio=t.devicePixelRatio||window.devicePixelRatio,t.isMobile&&(o*s.a.devicePixelRatio>2048||l*s.a.devicePixelRatio>2048)&&(s.a.devicePixelRatio/=Math.max(o,l)*s.a.devicePixelRatio/2048);var u=Math.floor(o*s.a.devicePixelRatio),c=Math.floor(l*s.a.devicePixelRatio);this._canvas.width=u,this._canvas.height=c,this._canvas.style.width=o+"px",this._canvas.style.height=l+"px";var h=new M;s.a.littleEndian=h.littleEndian,s.a.gpuMemory=Math.round(.5*h.vramSize),s.a.browserName=h.browserName,s.a.browserVersion=h.browserVersion,s.a.browserEngineName=h.browserEngineName,s.a.browserEngineVersion=h.browserEngineVersion,s.a.osName=h.osName,s.a.osVersion=h.osVersion,s.a.deviceModel=h.deviceModel,s.a.deviceType=h.deviceType,s.a.deviceVendor=h.deviceVendor,s.a.cpuArchitecture=h.cpuArchitecture,s.a.isMobile=t.isMobile,s.a.initResize=t.initResize,this._eventEmitter=new E,this._inputs=[],this._tools=[],t.initResize&&(this._ro=new b.a(function(e){e.forEach(function(e){var t=e.contentRect,r=t.width,i=t.height;a.resize(r,i)})}),this._ro.observe(this._container)),this.state=i.INITIALIZED}return e.prototype.resize=function(e,t){console.warn("canvas resize"),e=e||1,t=t||1;var r=Math.floor(e*s.a.devicePixelRatio),i=Math.floor(t*s.a.devicePixelRatio);this._canvas.width=r,this._canvas.height=i,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px"},e.prototype.destroy=function(){this.state!==i.UNINITIALIZED&&(this._ro&&(this._ro.unobserve(this._container),this._ro=null,delete this._ro),this._inputs.forEach(function(e){e.destroy()}),this._inputs=null,delete this._inputs,this._tools.forEach(function(e){e.destroy()}),this._tools=null,delete this._tools,this._eventEmitter=null,delete this._eventEmitter,this.state=i.UNINITIALIZED,this._canvas.remove(),this._canvas=null,delete this._canvas,this._container=null,delete this._container,console.log("%cThe viewer gets destroyed","font-weight:bold;"))},e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.invalidate=function(e){void 0===e&&(e=1),this._nFramesTobeDrawnNormally=e,this._nFramesTobeDrawnProgressively=0},e.prototype.addInput=function(e){if(!e.isAvailable(s.a.isMobile))return console.warn(e.name+" is not supported on current platform."),-1;for(var t=0;t<this._inputs.length;t++)if(this._inputs[t].name===e.name)return-1;e.setEnabled(!0);var r=this._inputs.length;return this._inputs.push(e),r},e.prototype.removeInput=function(e){var t=this._inputs[e];e>=0&&e<this._inputs.length&&this._inputs.slice(e,1),t.destroy()},e.prototype.getInput=function(e){return e>=0&&e<this._inputs.length?this._inputs[e]:null},e.prototype.addTool=function(e){if(!e.doesSupportMobile(s.a.isMobile))return null;for(var t=0;t<this._tools.length;t++)if(this._tools[t].name===e.name)return null;for(t=0;t<this._inputs.length;t++)e.addInput(this._inputs[t]);return this._tools.push(e),e},e.prototype.getTool=function(e){for(var t=0;t<this._tools.length;t++)if(this._tools[t].name===e)return this._tools[t];return null},e.prototype.removeTool=function(e){for(var t=0;t<this._tools.length;t++)if(this._tools[t].name===e){this._tools[t].destroy(),this._tools.splice(t,1);break}},e.prototype.getWidth=function(){return this._canvas.width},e.prototype.getHeight=function(){return this._canvas.height},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getEventEmitter=function(){return this._eventEmitter},e.prototype.registerEventListener=function(e,t){this._eventEmitter.on(e,t)},e.prototype.removeEventListener=function(e,t){this._eventEmitter.remove(e,t)},e.prototype.notifyEventListener=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this._eventEmitter&&(t=this._eventEmitter).emit.apply(t,S([e],r))},e.prototype.getViewType=function(){return this.viewType},e.prototype.isRendering=function(){return this.state===i.RENDERING},e.prototype.isUninitialized=function(){return this.state===i.UNINITIALIZED},e.prototype.isPaused=function(){return this.state===i.TICK_PAUSED||this.state===i.RENDERING_PAUSED||this.state===i.INITIALIZED_PAUSED},e}(),P=r(2),k=r(4),O=r(20),D=r(16),N=r(12),C=r(9),I=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),R=[1,0,1,.1,100,.55,0,0],B=[0,0,0],L=[1,1,0],F=function(e){function t(t,r){var i=e.call(this,t)||this;return i.originTextureUrl=null,i._resourceManager=null,i._materialParameters=new Float32Array(R),i._materialTextureOffset=null,i._materialTextureScale=null,i._reservedParameters2={},i._oldTransparency=1,i._oldDiffuse=[0,0,0],i._resourceManager=r,i}return I(t,e),t.prototype.destroy=function(t){this._materialParameters=null,this._reservedParameters2=null,this._materialTextureScale=null,this._materialTextureOffset=null,this.textureTransparent=null,delete this._materialParameters,delete this._reservedParameters2,delete this._materialTextureScale,delete this._materialTextureOffset,e.prototype.destroy.call(this,t)},t.prototype.attachShader=function(t,r){if(!t&&!r)return null;if(!t){if(!(t=r.getShader("solid",[])).ready){var i=k.a.solid;if(t.createFromShaderSource(i,["MODEL_TRANSFORM"]),!t.ready)throw"modelo3d error at creating shader 'solid'!"}}if(!t||!t.ready)return null;for(var n in e.prototype.attachShader.call(this,t,r),t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uDiffuseTexture"===n?(this.reservedParameters[n]=new C.a,this.hasTexture=!0,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uDiffuseTexture2"===n?(this.reservedParameters[n]=new C.a,this.hasTexture=!0,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):n.indexOf("m_uMaterial")>=0?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue,this.reservedParameters[n].value=this._materialParameters):"m_uTextureOffset"===n?(this._materialTextureOffset=new Float32Array(B),this.reservedParameters[n]=new C.a,this.reservedParameters[n].value=this._materialTextureOffset,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uTextureScale"===n&&(this._materialTextureScale=new Float32Array(L),this.reservedParameters[n]=new C.a,this.reservedParameters[n].value=this._materialTextureScale,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return t},t.prototype.equal=function(e){return this._materialParameters[0]===e[0]&&this._materialParameters[0]===e[0]&&this._materialParameters[2]===e[2]&&this._materialParameters[3]===e[3]},t.prototype.hash=function(){var e="",t=this._materialParameters;return e=e+t[0].toString()+t[1].toString()+t[2].toString()+t[3].toString()},t.prototype.setDiffuse=function(e){var t=this._materialParameters;t[0]=e[0],t[1]=e[1],t[2]=e[2],this._oldDiffuse[0]=t[0],this._oldDiffuse[1]=t[1],this._oldDiffuse[2]=t[2],e[3]&&(t[3]=e[3])},t.prototype.setTransparent=function(e){this._oldTransparency=this._materialParameters[3],this._materialParameters[3]=e,this.transparent=e<.99||!!this.textureTransparent},t.prototype.setAlphaCutoff=function(e){e=P.a.clamp(e,0,1),this._materialParameters[5]=e},t.prototype.restoreTransparency=function(){this._materialParameters&&(this._materialParameters[3]=this._oldTransparency,this.transparent=this._oldTransparency<.99||!!this.textureTransparent)},t.prototype.adjustTransparency=function(e){this._materialParameters[3]=e,this.transparent=this._materialParameters[3]<.99||!!this.textureTransparent},t.prototype.setDiffuseTexture=function(e){var t=this;if(this.reservedParameters.m_uDiffuseTexture)if(e instanceof O.a)this.reservedParameters.m_uDiffuseTexture.value=e;else{var r=this.reservedParameters.m_uDiffuseTexture.value,i=r.getFilter(),n=r.getWrap(),a=this._resourceManager.gl.RGB;if(e instanceof HTMLImageElement){var o=new O.a("texture-"+e.src,this._resourceManager);"png"===(s=e.src.split("."))[s.length-1]&&(a=this._resourceManager.gl.RGBA),o.createFromImage(e,a,this._resourceManager.gl.UNSIGNED_BYTE,i,n),this.reservedParameters.m_uDiffuseTexture.value=o}else{var s,l=new O.a("texture-"+e,this._resourceManager);a=this._resourceManager.gl.RGB;"png"===(s=e.split("."))[s.length-1]&&(a=this._resourceManager.gl.RGBA),l.createFromFile(e,a,i,n,function(){t.reservedParameters.m_uDiffuseTexture.value=l})}}else console.warn("can not set texture for "+this.name)},t.prototype.setSecondDiffuseTexture=function(e){this.reservedParameters.m_uDiffuseTexture2.value=e},t.prototype.getDiffuse=function(){return this._materialParameters},t.prototype.getTransparent=function(){return this._materialParameters[3]},t.prototype.getShininess=function(){return this._materialParameters[4]},t.prototype.getDiffuseTexture=function(){return this.hasTexture&&this.reservedParameters.m_uDiffuseTexture?this.reservedParameters.m_uDiffuseTexture.value:null},t.prototype.getAlphaCutoff=function(){return this._materialParameters[5]},t.prototype.absorb=function(e){if(this.hasMask){var t=this.reservedParameters.m_uDiffuseTexture,r=e.reservedParameters.m_uDiffuseTexture;t&&r&&(t.value=r.value),this.setAlphaCutoff(e.getAlphaCutoff())}this.transparent&&this.setTransparent(e.getTransparent()),this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits},t.prototype.clone=function(e,r){if(r||(r=new t(e,this._resourceManager)),this.reservedParameters){for(var i in this.reservedParameters)i.indexOf("m_uMaterial")>=0?(r.reservedParameters[i]=new C.a,r.reservedParameters[i].upload=this.reservedParameters[i].upload,r._materialParameters=new Float32Array(this.reservedParameters[i].value),r.reservedParameters[i].value=r._materialParameters):r.reservedParameters[i]=this.reservedParameters[i];r.transparent=this.transparent,r.hasMask=this.hasMask,r.hasTexture=this.hasTexture}return r},t.prototype.setTextureOffset=function(e){if(this.hasTexture){var t=this._materialTextureOffset;t[0]=e[0],t[1]=e[1],this._setTextureConfigured(!0)}},t.prototype._setTextureConfigured=function(e){this.hasTexture&&(this._materialTextureOffset[2]=e?1:0)},t.prototype.setTextureScale=function(e){if(this.hasTexture){var t=this._materialTextureScale;t[0]=e[0],t[1]=e[1],this._setTextureConfigured(!0)}},t.prototype.setTextureRotate=function(e){this.hasTexture&&(this._materialTextureScale[2]=e,this._setTextureConfigured(!0))},t.prototype.heighLight=function(){var e=this._materialParameters;e[0]=Math.min(1,1.3*this._oldDiffuse[0]),e[1]=Math.min(1,1.5*this._oldDiffuse[1]),e[2]=Math.min(1,1.1*this._oldDiffuse[2])},t.prototype.restoreDiffuse=function(){var e=this._materialParameters;e[0]=this._oldDiffuse[0],e[1]=this._oldDiffuse[1],e[2]=this._oldDiffuse[2]},t}(N.b),U=r(0),V=r(11),j=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},z=V.b.lengthUnitScale("mm"),G=U.a.create();G[0]=G[5]=G[10]=z;var H,q=U.b.create(),W=U.a.create(),Q=U.d.create(),Y=new Float32Array([-.5,-.5,-.5,.5,.5,.5]);!function(e){e[e.UNLOADED=0]="UNLOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED"}(H||(H={}));var X,Z=function(){function e(e,t,r){this.prefix="",this.isMatrixIdentity=!0,this._useOverride=!0,this._children=new Map,this.materialDrawablesMap=new Map,this.drawables=[],this.name=e,this.bbox=P.a.aabb.create(),this.originBBox=P.a.aabb.create(),this._center=null,this.faces=1,this.isPopBuffer=!1,this.hasContours=!1,this.isBimCullingNeeded=!1,this._matrix=U.a.create(),this._invertMatrix=U.a.create(),this._originalMatrix=U.a.create(),this._drawableMatrix=U.a.create(),this._quat=U.b.create(),this.initMatrix=U.a.create(),this._position=[0,0,0],this._scale=[1,1,1],this._euler=[0,0,0],this._positionFromInit=[0,0,0],this._eulerFromInit=[0,0,0],this._scaleFromInit=[1,1,1],this.visible=!0,this._resourceManager=t,this._materialManager=r,this._rotate_matrix=U.a.create(),this._rotate_point=new Float32Array(3),this.skeletons=[],this._state=H.UNLOADED}return Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){e!==this._state&&this.stateChangeCallback&&this.stateChangeCallback(this._state,e),this._state=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useOverride",{get:function(){return this._useOverride},set:function(e){this._useOverride=e,this.drawables.forEach(function(t){t.useOverride=e})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"euler",{get:function(){return this._euler},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionFromInit",{get:function(){return this._positionFromInit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eulerFromInit",{get:function(){return this._eulerFromInit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleFromInit",{get:function(){return this._scaleFromInit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),e.prototype.preInitialize=function(e){this.calculateOffset(e),this.initBoundingBox(e),this.calculateOrientedBoundingBox(e),this.initialize(),this.updateBoundingBoxMatrix()},e.prototype.initialize=function(){this.initMatrix=U.a.create(),U.a.copy(this.initMatrix,this._matrix),U.a.copy(this._originalMatrix,this._matrix),this.initMatrix[12]=this._matrix[12]=.5*(this.bbox[0]+this.bbox[3]),this.initMatrix[13]=this._matrix[13]=.5*(this.bbox[1]+this.bbox[4]),this.initMatrix[14]=this._matrix[14]=.5*(this.bbox[2]+this.bbox[5]),U.a.invert(this._invertMatrix,this.initMatrix),U.a.multiply(this._drawableMatrix,this._matrix,this._invertMatrix),this.originBBox=P.a.aabb.createFromArray(this.bbox),this.updatePositionEulerScaling()},e.prototype.copyMatrixFromEntity=function(e){var t=e.initMatrix,r=U.a.create();U.a.multiply(r,t,this._invertMatrix);var i=e.getTransformMatrix();U.a.copy(this.initMatrix,t),U.a.copy(this._matrix,i),U.a.invert(this._invertMatrix,this.initMatrix),U.a.multiply(this._drawableMatrix,this._matrix,this._invertMatrix),P.a.aabb.transform(this.bbox,this.bbox,r),U.a.multiply(this._originalMatrix,r,this._originalMatrix);var n=U.a.create();U.a.identity(n),U.a.equals(this._originalMatrix,n)||(this.isMatrixIdentity=!1),this.originBBox=P.a.aabb.createFromArray(this.bbox),this.updatePositionEulerScaling(),this.updateBoundingBoxMatrix()},e.prototype.destroy=function(){var e=this;this.drawables.forEach(function(t){t.destroy(e._materialManager)}),this.drawables=null,delete this.drawables,this.materialDrawablesMap=null,delete this.materialDrawablesMap,this.bbox=null,delete this.bbox,this.name=null,delete this.name,this.faces=null,delete this.faces,this.hasContours=null,delete this.hasContours,this._resourceManager=null,delete this._resourceManager,this._materialManager=null,delete this._materialManager,this.skeletons=null,delete this.skeletons},e.prototype.getCenter=function(){return this.getOriginBBox(),this._center=[],this._center[0]=.5*(this.originBBox[0]+this.originBBox[3]),this._center[1]=.5*(this.originBBox[1]+this.originBBox[4]),this._center[2]=.5*(this.originBBox[2]+this.originBBox[5]),this._center},e.prototype.getOriginBBox=function(){for(var e=P.a.aabb.createFromArray([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]),t=0,r=this.drawables.length;t<r;t++){var i=this.drawables[t];i.visible&&(0,P.a.aabb.union(e,i.originBBox,e))}this.isPopBuffer&&P.a.aabb.transform(e,e,G),this.originBBox=P.a.aabb.createFromArray(e)},e.prototype.setVisibility=function(e){this.visible!==e&&(this.visible=e,this.drawables.forEach(function(t){t.visible=e}))},e.prototype.setModelPosition=function(e,t){this._position=e,t&&this.setTransformMatrix(this.getModelTransformMatrix())},e.prototype.setModelScale=function(e,t){this._scale=e,t&&this.setTransformMatrix(this.getModelTransformMatrix())},e.prototype.updateModelRotation=function(e,t,r){this._tempRotation=e;var i=U.b.create();"rotate-yz"===t?U.b.rotateX(i,i,e):"rotate-xz"===t?U.b.rotateY(i,i,e):"rotate-xy"===t&&U.b.rotateZ(i,i,e),U.b.multiply(this._quat,i,this._quat);var n=U.b.toYXZ(this._quat);this.euler[0]=n._x,this.euler[1]=n._y,this.euler[2]=n._z,U.a.fromQuat(this._rotate_matrix,this._quat),r&&this.setTransformMatrix(this.getModelTransformMatrix())},e.prototype.setModelRotationFromEuler=function(e,t){var r=U.b.create(),i=e._x,n=e._y,a=e._z;this._euler=e,U.b.fromYXZ(r,n,i,a),this._quat=r,this._rotate_matrix=U.a.fromQuat(this._rotate_matrix,r),t&&this.setTransformMatrix(this.getModelTransformMatrix())},e.prototype.getModelTransformMatrix=function(){this._center||this.getCenter();var e=this._center,t=this._position||this._center,r=U.a.create(),i=1;this.isPopBuffer&&(i=z);var n=U.a.create();n[12]+=t[0],n[13]+=t[1],n[14]+=t[2],U.a.multiply(r,r,n),U.a.multiply(r,r,this._rotate_matrix);var a=U.a.create();return a[12]-=e[0],a[13]-=e[1],a[14]-=e[2],U.a.multiply(r,r,a),r=U.a.scale(r,r,[i*this.scale[0],i*this.scale[1],i*this.scale[2]])},e.prototype.addDrawable=function(e){this.materialDrawablesMap.has(e.material.name)?this.materialDrawablesMap.get(e.material.name).push(e):this.materialDrawablesMap.set(e.material.name,[e]),this.drawables.push(e),U.a.multiply(this._drawableMatrix,this._matrix,this._invertMatrix),e.recompileShader("MODEL_TRANSFORM",!0),e.setTransformMatrix(this._drawableMatrix)},e.prototype.addDrawables=function(e){var t,r;try{for(var i=j(e),n=i.next();!n.done;n=i.next()){var a=n.value;this.addDrawable(a)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.addChildEntity=function(e){var t=e.getTransformMatrix(),r=U.a.create();U.a.invert(r,this._matrix),U.a.multiply(r,r,t),this._children.set(e,r)},e.prototype.addMarks=function(e){var t=this;e.forEach(function(e){t.addChildEntity(e)})},e.prototype.updateBBox=function(){var e=this;this.bbox=P.a.aabb.create(),this.drawables.forEach(function(t){t.visible&&!t.isDestroy&&P.a.aabb.union(e.bbox,t.bbox,e.bbox)})},e.prototype.recalculateMatrixFromBoundingBox=function(e){e||(e=this.bbox),e.some(function(e){return e===1/0||e===-1/0})||(this.calculateOrientedBoundingBox(e),this.initialize(),this.updateDrawablesTransform())},e.prototype.translate=function(e,t,r){this.drawables.forEach(function(i){i.isDestroy||i.translate(e,t,r)}),P.a.aabb.moveTo(this.bbox,this.bbox,[e,t,r])},e.prototype.rotate=function(e,t,r){var i=this;U.a.fromRotation(this._rotate_matrix,e,t),U.d.transformMat4(this._rotate_point,r,this._rotate_matrix),this._rotate_matrix[12]=r[0]-this._rotate_point[0],this._rotate_matrix[13]=r[1]-this._rotate_point[1],this._rotate_matrix[14]=r[2]-this._rotate_point[2],U.a.multiply(this._matrix,this._rotate_matrix,this._matrix),this.drawables.forEach(function(e){e.isDestroy||e.multiply(i._rotate_matrix)}),this.updateBBox(),this.getRotate()},e.prototype.updatePositionEulerScaling=function(){U.a.multiply(W,this._invertMatrix,this._matrix),U.a.decompose(W,this._positionFromInit,q,this._scaleFromInit),U.a.fromQuat(W,q),U.a.getEulerByOrder(this._eulerFromInit,W),U.a.decompose(this._matrix,this._position,q,this._scale),U.a.fromQuat(W,q),U.a.getEulerByOrder(this._euler,W)},e.prototype.setRotate=function(e,t,r,i){void 0===i&&(i=!1),U.b.fromEuler(q,e,t,r),i?(U.a.compose(W,this._positionFromInit,q,this._scaleFromInit),U.a.multiply(this._matrix,this.initMatrix,W)):U.a.compose(this._matrix,this.position,q,this.scale),this.updateDrawablesTransform(),this.updateBBox(),this.updatePositionEulerScaling()},e.prototype.setDeltaRotate=function(e,t,r){U.b.fromEuler(q,e,t,r),U.a.fromQuat(W,q),U.a.multiply(this._matrix,this._matrix,W),this.updateDrawablesTransform(),this.updateBBox(),this.updatePositionEulerScaling()},e.prototype.getRotate=function(){return U.a.getEulerByOrder(this._euler,this._matrix),this._euler},e.prototype.setTranslation=function(e,t,r,i){void 0===i&&(i=!1),i?(Q[0]=e,Q[1]=t,Q[2]=r,U.b.fromEuler(q,this._eulerFromInit[0],this._eulerFromInit[1],this._eulerFromInit[2]),U.a.compose(W,Q,q,this._scaleFromInit),U.a.multiply(this._matrix,this.initMatrix,W),P.a.aabb.moveTo(this.bbox,this.bbox,Q)):(this._matrix[12]=e,this._matrix[13]=t,this._matrix[14]=r,P.a.aabb.moveTo(this.bbox,this.bbox,[e,t,r])),this.updateDrawablesTransform(),this.updatePositionEulerScaling()},e.prototype.setDeltaTranslation=function(e,t,r){Q[0]=e/this._scale[0],Q[1]=t/this._scale[1],Q[2]=r/this._scale[2],U.a.fromTranslation(W,Q),U.a.multiply(this._matrix,this._matrix,W),this.updateDrawablesTransform(),P.a.aabb.moveTo(this.bbox,this.bbox,[e,t,r]),this.updatePositionEulerScaling()},e.prototype.getTranslation=function(){return this._position[0]=this._matrix[12],this._position[1]=this._matrix[13],this._position[2]=this._matrix[14],this._position},e.prototype.setScaling=function(e,t,r,i){if(void 0===i&&(i=!1),i)Q[0]=e,Q[1]=t,Q[2]=r,U.b.fromEuler(q,this._eulerFromInit[0],this._eulerFromInit[1],this._eulerFromInit[2]),U.a.compose(W,this._positionFromInit,q,Q),U.a.multiply(this._matrix,this.initMatrix,W);else{var n=this.scale,a=n[0],o=n[1],s=n[2];U.a.scale(this._matrix,this._matrix,[e/a,t/o,r/s])}P.a.aabb.invalidate(this.bbox),this.updateDrawablesTransform(),this.updateBBox(),this.updatePositionEulerScaling()},e.prototype.getScaling=function(){return U.a.getScaling(this._scale,this._matrix),this.scale},e.prototype.getTransformMatrix=function(){return this._matrix},e.prototype.getRealTransformMatrix=function(){var e=U.a.create();return U.a.multiply(e,this._drawableMatrix,this._originalMatrix),Array.from(e)},e.prototype.getOriginalTransformMatrix=function(){return this._originalMatrix},e.prototype.getTransformArray=function(){U.a.invert(this._invertMatrix,this.initMatrix),U.a.multiply(this._drawableMatrix,this._matrix,this._invertMatrix);for(var e=[],t=0;t<12;t++)e[t]=this._drawableMatrix[t];var r=[this._matrix[12]-this.initMatrix[12],this._matrix[13]-this.initMatrix[13],this._matrix[14]-this.initMatrix[14]];return e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},e.prototype.setTransformMatrix=function(e){U.a.copy(this._matrix,e),this.updateDrawablesTransform(),this.updateBBox(),this.updatePositionEulerScaling()},e.prototype.updateDrawablesTransform=function(){var e=this;U.a.multiply(this._drawableMatrix,this._matrix,this._invertMatrix),this.drawables.forEach(function(t){t.recompileShader("SHADOW",!0),t.recompileShader("MODEL_TRANSFORM",!0),t.setTransformMatrix(e._drawableMatrix)}),this._children.forEach(function(t,r){U.a.multiply(W,e._matrix,t),r.setTransformMatrix(W)})},e.prototype.setTransfromArry=function(e){var t=[e[12],e[13],e[14]];U.a.multiply(this._matrix,this.initMatrix,e),this._matrix[12]=this.initMatrix[12]+t[0],this._matrix[13]=this.initMatrix[13]+t[1],this._matrix[14]=this.initMatrix[14]+t[2],this.setTransformMatrix(this._matrix)},e.prototype.calculateOrientedBoundingBox=function(e){this.geometryCenteredOrientedBoundingBox||(this.geometryCenteredOrientedBoundingBox=P.a.aabb.create()),P.a.aabb.moveTo(this.geometryCenteredOrientedBoundingBox,e,[0,0,0])},e.prototype.calculateOffset=function(e){this._offset=P.a.aabb.center(e)},e.prototype.updateBoundingBoxMatrix=function(){var e=this.getTransformMatrix(),t=P.a.aabb.center(this.geometryCenteredOrientedBoundingBox),r=P.a.aabb.size(this.geometryCenteredOrientedBoundingBox);return U.a.fromRotationTranslationScale(W,U.b.create(),t,[r.width,r.height,r.depth]),U.a.multiply(W,e,W),W},e.prototype.initBoundingBox=function(e){var t=this.getTransformMatrix(),r=P.a.aabb.center(e),i=P.a.aabb.size(e);U.a.fromRotationTranslationScale(W,U.b.create(),r,[i.width,i.height,i.depth]),U.a.multiply(W,t,W),P.a.aabb.transform(this.bbox,Y,W)},e}(),K=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),J=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.popUrl="",n}return K(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createSolidCube=function(e){void 0===e&&(e=[.5,.5,.5]);var t=this._resourceManager.getShader(this.name,["MODEL_TRANSFORM"]);t.ready||t.createFromShaderSource(k.a.solid,["MODEL_TRANSFORM"]);var r=this._materialManager.createMaterialAdhoc("pawn-material-"+this.name);r.attachShader(t,this._resourceManager),r.setDiffuse(e),r.setTransparent(1);var i=this._resourceManager.getMesh(this.name);i.createSolidCube(),this.addDrawable(new D.a(i,t,r,null,new Float32Array([-1,-1,-1,1,1,1]))),(t=this._resourceManager.getShader(this.name,["MODEL_TRANSFORM"])).ready||t.createFromShaderSource(k.a.plain,["MODEL_TRANSFORM"]),(r=this._materialManager.createMaterialAdhoc(this.name+"_line")).attachShader(t,this._resourceManager),r.setDiffuse([0,0,0]),r.setTransparent(1),(i=this._resourceManager.getMesh("pawn-material-"+this.name+"_line")).createWiredCube();var n=new Float32Array([-1,-1,-1,1,1,1]);P.a.aabb.scale(n,n,1.01);var a=new D.a(i,t,r,null,n);a.transform.setScaling(1.01,1.01,1.01),this.addDrawable(a),this.bbox?P.a.aabb.union(this.bbox,this.bbox,n):this.bbox=n},t.prototype.createTexturedQuad=function(e,t){var r=(t||{}).flipY,i=void 0!==r&&r;a.a.isArray(e)||(e=[e]);var n=["MODEL_TRANSFORM"];e.length>1&&n.push("SECOND_TEXTURE");var o=this._resourceManager.getShader(this.name,n);o.ready||o.createFromShaderSource(k.a.plain_texture,n);for(var s=Array(e.length),l=0;l<e.length;l++){var u=e[l];if(u instanceof O.a)s[l]=e[l];else{s[l]=this._resourceManager.getTexture(this.name+"_"+l);var c=this._resourceManager.gl,h=u.src.split(".");"png"!==h[h.length-1]&&"svg"!==h[h.length-1]?s[l].createFromImage(u,c.RGB,c.UNSIGNED_BYTE,c.LINEAR,c.CLAMP_TO_EDGE,i):s[l].createFromImage(u,c.RGBA,c.UNSIGNED_BYTE,c.LINEAR,c.CLAMP_TO_EDGE,i)}}var d=new F("pawn-material-"+this.name,this._resourceManager);d.attachShader(o,this._resourceManager),d.setDiffuse([1,1,1]),d.setTransparent(1),s[0]&&(d.setDiffuseTexture(s[0]),s[0].hasAlpha()&&(d.transparent=!0)),s[1]&&(d.setSecondDiffuseTexture(s[1]),s[1].hasAlpha()&&(d.transparent=!0));var p=this._resourceManager.getMesh(this.name);p.createQuad(!0,!0);var f=new Float32Array([-1,-1,0,1,1,0]);this.addDrawable(new D.a(p,o,d,null,f)),this.bbox?P.a.aabb.union(this.bbox,this.bbox,f):this.bbox=f},t.prototype.getSkeletons=function(){return this.skeletons},t.prototype.setDiffuseColor=function(e){this.drawables.forEach(function(t){t.material.setDiffuse(e)})},t.prototype.setOpacity=function(e){this.drawables.forEach(function(t){t.material.setTransparent(e)})},t.prototype.clone=function(e){var r=new t(e,this._resourceManager,this._materialManager);return this.drawables.forEach(function(e){r.addDrawable(e.clone())}),r.bbox=P.a.aabb.create(),P.a.aabb.copy(r.bbox,this.bbox),r.faces=this.faces,r.hasContours=this.hasContours,r},t.prototype.setTransformMatrix=function(e){this._matrix=e,this.drawables.forEach(function(t){t.setWorldMatrix(e)}),this.updateBBox()},t.prototype.getPawnInfo=function(){return{name:this.name,position:this.position,popUrl:this.popUrl,euler:this.euler,scale:this.scale,matrix:this._matrix}},t}(Z),$=r(41),ee=r.n($),te=r(3),re=function(){return function(e,t,r,i){this.name=e,this.index=-1,this.type=t,this.offset=0,this.stride=0,this.size=i,this.normalized=!!r}}(),ie=function(){function e(){this.values=[],this.hasNormal=!1,this.hasColor=!1,this.hasUV=!1,this.id=0,this.primitive=te.a.TRIANGLES,this.compressed=!1}return e.prototype._getSizeOfType=function(e){switch(e){case te.a.UNSIGNED_BYTE:case te.a.BYTE:return 1;case te.a.UNSIGNED_SHORT:case te.a.SHORT:return 2;case te.a.FLOAT:case te.a.INT:case te.a.UNSIGNED_INT:return 4;default:throw new Error("unknown GL type")}},e.prototype.builtin=function(e,t,r,i){var n=0,a=null;if(e&&((a=new re("m_aPosition",e,!1,3)).index=0,a.offset=0,this.values.push(a),n=3*this._getSizeOfType(e)),t){var o=3,s=!1;o=3,s=!1,t!==te.a.FLOAT&&(s=!0,o=4),(a=new re("m_aNormal",t,s,o)).index=1,a.offset=n,this.values.push(a),n+=o*this._getSizeOfType(t),this.hasNormal=!0}r&&((a=new re("m_aTexCoord",r,!1,2)).index=4,a.offset=n,this.values.push(a),n+=2*this._getSizeOfType(r),this.hasUV=!0),i&&((a=new re("m_aColor",i,!1,4)).index=5,a.offset=n,t!==te.a.FLOAT&&(a.normalized=!0),this.values.push(a),n+=4*this._getSizeOfType(i),this.hasColor=!0);for(var l=0,u=this.values.length;l<u;++l)this.values[l].stride=n;this.id=(e?16:0)+(t?8:0)+(r?4:0)+(i?2:0)},e.prototype.compress=function(){if(this.hasNormal&&!this.compressed){this.compressed=!0,this.id+=32;var e=[];e.push(this.values[0]);var t=null;(t=new re("m_aNormal0",te.a.BYTE,!0,1)).index=1,t.offset=0,e.push(t),(t=new re("m_aNormal1",te.a.BYTE,!0,1)).index=2,t.offset=4,e.push(t),(t=new re("m_aNormal2",te.a.BYTE,!0,1)).index=3,t.offset=8,e.push(t);for(var r=2,i=this.values.length;r<i;r++)this.values[r].offset-=4,e.push(this.values[r]);var n=this.values[0].stride-4;for(r=0,i=e.length;r<i;++r)e[r].stride=n;this.values=e}},e.prototype.clone=function(){var t=new e;t.id=this.id,t.hasNormal=this.hasNormal,t.hasColor=this.hasColor,t.hasUV=this.hasUV,t.compressed=this.compressed,t.primitive=this.primitive,t.values=new Array(this.values.length);for(var r=0,i=this.values.length;r<i;r++){var n=this.values[r];t.values[r]=new re(n.name,n.type,n.normalized,n.size),t.values[r].index=n.index,t.values[r].offset=n.offset,t.values[r].stride=n.stride}return t},e.prototype.add=function(e,t,r,i,n,a,o){if(!this.has(e)){var s=new re(e,r,i,n);s.index=t,s.stride=a,s.offset=o,this.values.push(s)}},e.prototype.has=function(e){for(var t=0,r=this.values.length;t<r;++t)if(this.values[t].name===e)return!0;return!1},e.prototype.bindBuffer=function(e,t){t.bindBuffer(t.ARRAY_BUFFER,e);for(var r=0,i=this.values.length;r<i;r++){var n=this.values[r].index;t.vertexAttribPointer(n,this.values[r].size,this.values[r].type,this.values[r].normalized,this.values[r].stride,this.values[r].offset),t.enableVertexAttribArray(n)}},e.prototype.bindVbos=function(e,t){for(var r=0,i=e.length;r<i;r++){t.bindBuffer(t.ARRAY_BUFFER,e[r].buffer);var n=this.values[r].index;t.vertexAttribPointer(n,this.values[r].size,this.values[r].type,this.values[r].normalized,this.values[r].stride,this.values[r].offset),t.enableVertexAttribArray(n)}},e.prototype.bindBuffers=function(e,t){for(var r=0,i=e.length;r<i;r++){t.bindBuffer(t.ARRAY_BUFFER,e[r]);var n=this.values[r].index;t.vertexAttribPointer(n,this.values[r].size,this.values[r].type,this.values[r].normalized,this.values[r].stride,this.values[r].offset),t.enableVertexAttribArray(n)}},e.prototype.bind=function(e,t){t.disableVertexAttribArray(1),t.disableVertexAttribArray(2),t.disableVertexAttribArray(3),t.disableVertexAttribArray(4),t.disableVertexAttribArray(5),t.disableVertexAttribArray(6),t.bindBuffer(t.ARRAY_BUFFER,e);for(var r=0,i=this.values.length;r<i;r++){var n=this.values[r].index;t.vertexAttribPointer(n,this.values[r].size,this.values[r].type,this.values[r].normalized,this.values[r].stride,this.values[r].offset),t.enableVertexAttribArray(n)}},e}();!function(e){e[e.LINEAR=0]="LINEAR",e[e.STEP=1]="STEP",e[e.CATMULLROMSPLINE=2]="CATMULLROMSPLINE",e[e.CUBICSPLINE=3]="CUBICSPLINE"}(X||(X={}));var ne=function(){function e(e,t,r){this._position=e||null,this._rotation=t||null,this._scale=r||null,this._interpolationMethod=X.LINEAR,this._matrix=U.a.create()}return e.prototype.getInterpolationMethod=function(){return this._interpolationMethod},e.prototype.setTranslation=function(e){this._position=e},e.prototype.getTranslation=function(){return this._position},e.prototype.setRotation=function(e){this._rotation=e},e.prototype.getRotation=function(){return this._rotation},e.prototype.setScale=function(e){this._scale=e},e.prototype.getScale=function(){return this._scale},e.prototype.setInterpolationMethod=function(e){this._interpolationMethod=e},e.interpolate=function(t,r,i){var n=new e(U.d.create(),U.b.create(),U.d.fromValues(1,1,1));return U.d.lerp(n._position,t._position,r._position,i),U.b.slerp(n._rotation,t._rotation,r._rotation,i),U.d.lerp(n._scale,t._scale,r._scale,i),n},e.prototype.getLocalTransform=function(){U.a.fromScaling(this._matrix,this._scale);var e=U.a.create();return U.a.fromQuat(e,this._rotation),U.a.multiply(this._matrix,e,this._matrix),this._matrix[12]=this._position[0],this._matrix[13]=this._position[1],this._matrix[14]=this._position[2],this._matrix},e}(),ae=function(){function e(e){this._skeleton=e,this._animationTime=0}return e.prototype.doAnimation=function(e){this._animationTime=0,this._currentAnimation=e},e.prototype.update=function(){if(null!=this._currentAnimation){this._increaseAnimationTime();var e=this._calculateCurrentAnimationPose();this._applyPoseToJoints(e,this._skeleton.getRoot(),this._skeleton._rootMatrix)}},e.prototype._increaseAnimationTime=function(){this._animationTime+=this._currentAnimation.getSpeed(),this._animationTime>this._currentAnimation.getLength()&&(this._animationTime%=this._currentAnimation.getLength())},e.prototype._calculateCurrentAnimationPose=function(){var e=this._getPreviousAndNextFrames(),t=this._calculateProgression(e[0],e[1]);return this._interpolatePoses(e[0],e[1],t)},e.prototype._applyPoseToJoints=function(e,t,r){var i=this,n=e.get(t.getName());n||(n=U.a.create());var a=U.a.create();U.a.multiply(a,r,n),t.children.forEach(function(t){i._applyPoseToJoints(e,t,a)}),U.a.multiply(a,a,t.getInverseBindTransform()),t.setAnimationTransform(a)},e.prototype._getPreviousAndNextFrames=function(){for(var e=this._currentAnimation.getKeyFrames(),t=e[0],r=e[0],i=1;i<e.length&&!((r=e[i]).getTimeStamp()>this._animationTime);i++)t=e[i];return[t,r]},e.prototype._calculateProgression=function(e,t){var r=t.getTimeStamp()-e.getTimeStamp();return(this._animationTime-e.getTimeStamp())/r},e.prototype._interpolatePoses=function(e,t,r){var i=new Map,n=e.getJointKeyFrames(),a=t.getJointKeyFrames();return n.forEach(function(e,t){var n,o=a.get(t);n=e.getInterpolationMethod()==X.STEP?e:ne.interpolate(e,o,r),i.set(t,n.getLocalTransform())}),i},e}(),oe=function(){function e(e,t){this._lastFrame=-1,this._animator=new ae(this),this._rootJoint=e,this.joints=[],this._animations=[],t.gl.isWebGL2?this._transformTexture=null:(this._transformTexture=t.getTexture("skeleton-transform-"+e.getName()),t.gl.floatTextureExtension||console.warn("skeleton animation not supported in webgl1.0 without float texture extension!"),this._transformTexture.create(512,1,t.gl.RGBA32F,t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._transformTexture.use(4),this.gl=t.gl)}return e.prototype.use=function(e){var t,r=e.getGL();this._transformTexture?(this._transformTexture.update(this._jointMatrices),(t=e.reservedUniforms.m_uTransformTexture).upload(4,this.gl)):(t=e.reservedUniforms.m_uJointMatrix)&&t.upload(this._jointMatrices,r)},e.prototype.updateJointMatrices=function(){var e=this;return this._jointMatrices||(this._transformTexture?this._jointMatrices=new Float32Array(2048):this._jointMatrices=new Float32Array(16*this.joints.length)),this.joints.forEach(function(t,r){var i=t.getAnimatedTransform();e._jointMatrices.set(i,16*r)}),this._jointMatrices},e.prototype.setRootMatrix=function(e){this._rootMatrix=U.a.clone(e)},e.prototype.addJoint=function(e){this.joints.push(e)},e.prototype.getRoot=function(){return this._rootJoint},e.prototype.addAnimation=function(e){this._animations.push(e)},e.prototype.getAnimations=function(){return this._animations},e.prototype.doAnimation=function(e){this._animator.doAnimation(e)},e.prototype.update=function(){this._animator.update(),this.updateJointMatrices()},e}(),se=function(){function e(e,t,r){this._name=e,this._inverseBindMatrix=t,this.children=[],this._animatedTransform=U.a.create(),this._matrixWorld=r}return e.prototype.getName=function(){return this._name},e.prototype.addChild=function(e){this.children.push(e)},e.prototype.getAnimatedTransform=function(){return this._animatedTransform},e.prototype.setAnimationTransform=function(e){U.a.copy(this._animatedTransform,e)},e.prototype.getInverseBindTransform=function(){return this._inverseBindMatrix},e}(),le=function(){function e(e,t,r){this._name=e,this._keyFrames=r,this._length=t,this._speed=.0167}return e.prototype.getSpeed=function(){return this._speed},e.prototype.setSpeed=function(e){this._speed=e},e.prototype.getName=function(){return this._name},e.prototype.getLength=function(){return this._length},e.prototype.getKeyFrames=function(){return this._keyFrames},e}(),ue=function(){function e(e){this._timeStamp=e,this._pose=new Map}return e.prototype.getTimeStamp=function(){return this._timeStamp},e.prototype.getJointKeyFrames=function(){return this._pose},e}(),ce="data:image/png;base64,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",he=100,de={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pe=function(){function e(e,t,r){e=e||U.d.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),t=t||U.d.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),void 0===r||!0===r?(this.min=U.d.clone(e),this.max=U.d.clone(t)):(this.min=e,this.max=t),this.transform=U.a.create()}return e.prototype.updateBoundingBox=function(e){U.d.min(this.min,this.min,e.min),U.d.max(this.max,this.max,e.max)},e.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},e.getAABBFromOBB=function(t,r){var i=U.d.create(),n=U.d.create(),a=U.d.create(),o=U.d.create(),s=U.d.create();U.d.set(i,r[0],r[1],r[2]),U.d.set(n,r[4],r[5],r[6]),U.d.set(a,r[8],r[9],r[10]);var l=U.d.fromValues(r[12],r[13],r[14]),u=U.d.clone(l);U.d.scale(o,i,t.min[0]),U.d.scale(s,i,t.max[0]),U.d.min(i,o,s),U.d.add(l,l,i),U.d.max(i,o,s),U.d.add(u,u,i),U.d.scale(o,n,t.min[1]),U.d.scale(s,n,t.max[1]),U.d.min(n,o,s),U.d.add(l,l,n),U.d.max(n,o,s),U.d.add(u,u,n),U.d.scale(o,a,t.min[2]),U.d.scale(s,a,t.max[2]),U.d.min(a,o,s),U.d.add(l,l,a),U.d.max(a,o,s),U.d.add(u,u,a);var c=new e(l,u,!1);return c.calculateTransform(),c},e}(),fe=function(){function e(e,t){this.bufferView=t,this.componentType=e.componentType,this.byteOffset=void 0!==e.byteOffset?e.byteOffset:0,this.byteStride=t.byteStride,this.normalized=void 0!==e.normalized&&e.normalized,this.count=e.count,this.type=e.type,this.size=de[this.type],this.min=e.min,this.max=e.max}return e.prototype._arrayBuffer2TypedArray=function(e,t,r,i){switch(i){case 5122:return new Int16Array(e,t,r);case 5123:return new Uint16Array(e,t,r);case 5124:return new Int32Array(e,t,r);case 5125:return new Uint32Array(e,t,r);case 5126:return new Float32Array(e,t,r);default:return null}},e.prototype.getAccessorData=function(){return this._arrayBuffer2TypedArray(this.bufferView.data,this.byteOffset,this.count*de[this.type],this.componentType)},e}(),_e=function(){function e(e,t){this.byteLength=e.byteLength,this.byteOffset=void 0!==e.byteOffset?e.byteOffset:0,this.byteStride=void 0!==e.byteStride?e.byteStride:0,this.target=void 0!==e.target?e.target:null,this.data=t.slice(this.byteOffset,this.byteOffset+this.byteLength),this._glBuffer=null}return e.prototype.getBuffer=function(e,t){return this._glBuffer||(this._glBuffer=e.createBuffer(),e.bindBuffer(t,this._glBuffer),e.bufferData(t,this.data,e.STATIC_DRAW),e.bindBuffer(t,null)),this._glBuffer},e}(),me=function(){function e(e,t,r){if(this.name=void 0!==t.name?t.name:null,this.nodeID=r,this.camera=void 0!==t.camera?t.camera:null,this.matrix=U.a.create(),t.hasOwnProperty("matrix")){for(var i=0;i<16;++i)this.matrix[i]=t.matrix[i];this.translation=U.d.create(),U.a.getTranslation(this.translation,this.matrix),this.rotation=U.b.create(),U.a.getRotation(this.rotation,this.matrix),this.scale=U.d.create(),U.a.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(t.translation,t.rotation,t.scale);this.children=t.children||[],this.mesh=void 0!==t.mesh?e.model.meshes[t.mesh]:null,this.skin=void 0!==t.skin?t.skin:null,this.inverseBindMatrix=null,this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.aabb=null,this.bvh=new pe}return e.prototype.traverse=function(e,t){t(this,e);for(var r=0,i=this.children.length;r<i;r++)this.children[r].traverse(this,t)},e.prototype.traversePostOrder=function(e,t){for(var r=0,i=this.children.length;r<i;r++)this.children[r].traversePostOrder(this,t);t(this,e)},e.prototype.traverseTwoExecFun=function(e,t,r){t(this,e);for(var i=0,n=this.children.length;i<n;i++)this.children[i].traverseTwoExecFun(this,t,r);r(this,e)},e.prototype.getTransformMatrixFromTRS=function(e,t,r){this.translation=void 0!==e?U.d.fromValues(e[0],e[1],e[2]):U.d.fromValues(0,0,0),this.rotation=void 0!==t?U.e.fromValues(t[0],t[1],t[2],t[3]):U.e.fromValues(0,0,0,1),this.scale=void 0!==r?U.d.fromValues(r[0],r[1],r[2]):U.d.fromValues(1,1,1),this.updateMatrixFromTRS()},e.prototype.updateMatrixFromTRS=function(){U.a.fromScaling(this.matrix,this.scale);var e=U.a.create();U.a.fromQuat(e,this.rotation),U.a.multiply(this.matrix,e,this.matrix),this.matrix[12]=this.translation[0],this.matrix[13]=this.translation[1],this.matrix[14]=this.translation[2]},e}(),ve=function(){return function(e,t,r){var i,n;this.meshID=r,this.name=void 0!==t.name?t.name:null,this.primitives=[],this.boundingBox=null;for(var a=0,o=t.primitives.length;a<o;++a)i=t.primitives[a],n=new ye(e.model,i,a),this.primitives.push(n),n.boundingBox&&(this.boundingBox||(this.boundingBox=new pe),this.boundingBox.updateBoundingBox(n.boundingBox));this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null}}(),ye=function(){return function(e,t,r){var i;for(i in this.index=r,this.attributes=t.attributes,this.indices=void 0!==t.indices?t.indices:null,null!==this.indices?(this.indicesComponentType=e.json.accessors[this.indices].componentType,this.indicesLength=e.json.accessors[this.indices].count,this.indicesOffset=e.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=e.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=e.json.accessors[this.attributes.POSITION].byteOffset||0),this.attributes)this.attributes[i]=e.accessors[this.attributes[i]];if(this.material=void 0!==t.material?e.materials[t.material]:null,this.mode=void 0!==t.mode?t.mode:4,this.targets=t.targets,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.vertexArray=null,this.vertexBuffer=null,this.indexBuffer=null,this.shader=null,this.boundingBox=null,void 0!==this.attributes.POSITION){var n=this.attributes.POSITION;n.max&&"VEC3"===n.type&&(this.boundingBox=new pe(U.d.fromValues(n.min[0],n.min[1],n.min[2]),U.d.fromValues(n.max[0],n.max[1],n.max[2]),!1),this.boundingBox.calculateTransform())}}}(),ge=function(){function e(e,t){this.name=void 0!==t.name?t.name:null,this.sampler=void 0!==t.sampler?e.model.samplers[t.sampler]:null,this.source=void 0!==t.source?e.model.images[t.source]:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.texture=null}return e.prototype.createTexture=function(e){this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},e}(),be=function(){function e(e){this.name=void 0!==e.name?e.name:null,this.magFilter=void 0!==e.magFilter?e.magFilter:null,this.minFilter=void 0!==e.minFilter?e.minFilter:null,this.wrapS=void 0!==e.wrapS?e.wrapS:10497,this.wrapT=void 0!==e.wrapT?e.wrapT:10497,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.sampler=null}return e.prototype.createSampler=function(e){this.sampler=e.createSampler(),this.minFilter?e.samplerParameteri(this.sampler,e.TEXTURE_MIN_FILTER,this.minFilter):e.samplerParameteri(this.sampler,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR),this.magFilter?e.samplerParameteri(this.sampler,e.TEXTURE_MAG_FILTER,this.magFilter):e.samplerParameteri(this.sampler,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.sampler,e.TEXTURE_WRAP_S,this.wrapS),e.samplerParameteri(this.sampler,e.TEXTURE_WRAP_T,this.wrapT)},e}(),we=function(){return function(e){this.index=e.index,this.texCoord=void 0!==e.texCoord?e.texCoord:0,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),xe=function(){return function(e){this.baseColorFactor=void 0!==e.baseColorFactor?e.baseColorFactor:[1,1,1,1],this.baseColorTexture=void 0!==e.baseColorTexture?new we(e.baseColorTexture):null,this.metallicFactor=void 0!==e.metallicFactor?e.metallicFactor:1,this.roughnessFactor=void 0!==e.roughnessFactor?e.roughnessFactor:1,this.metallicRoughnessTexture=void 0!==e.metallicRoughnessTexture?new we(e.metallicRoughnessTexture):null,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Me=function(){return function(e){this.index=e.index,this.texCoord=void 0!==e.texCoord?e.texCoord:0,this.scale=void 0!==e.scale?e.scale:1,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Ee=function(){return function(e){this.index=e.index,this.texCoord=void 0!==e.texCoord?e.texCoord:0,this.strength=void 0!==e.strength?e.strength:1,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Te=function(){return function(e){this.name=void 0!==e.name?e.name:null,this.pbrMetallicRoughness=void 0!==e.pbrMetallicRoughness?new xe(e.pbrMetallicRoughness):new xe({baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=void 0!==e.normalTexture?new Me(e.normalTexture):null,this.occlusionTexture=void 0!==e.occlusionTexture?new Ee(e.occlusionTexture):null,this.emissiveTexture=void 0!==e.emissiveTexture?new we(e.emissiveTexture):null,this.emissiveFactor=void 0!==e.emissiveFactor?e.emissiveFactor:[0,0,0],this.alphaMode=void 0!==e.alphaMode?e.alphaMode:"OPAQUE",this.alphaCutoff=void 0!==e.alphaCutoff?e.alphaCutoff:.5,this.doubleSided=e.doubleSided||!1,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Se=function(){return function(e,t,r){var i,n,a;for(this.mySkeleton=null,this.name=void 0!==t.name?t.name:null,this.skinID=r,this.joints=new Array(t.joints.length),i=0,a=this.joints.length;i<a;i++)this.joints[i]=e.nodes[t.joints[i]];if(this.skeleton=void 0!==t.skeleton?e.nodes[t.skeleton]:null,this.inverseBindMatrices=void 0!==t.inverseBindMatrices?e.accessors[t.inverseBindMatrices]:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.inverseBindMatrices)for(this.inverseBindMatricesData=this.inverseBindMatrices.getAccessorData(),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(16*he),i=0,n=0,a=this.inverseBindMatricesData.length;i<a;i+=16,n++)this.joints[n].inverseBindMatrix=U.a.fromValues(this.inverseBindMatricesData[i],this.inverseBindMatricesData[i+1],this.inverseBindMatricesData[i+2],this.inverseBindMatricesData[i+3],this.inverseBindMatricesData[i+4],this.inverseBindMatricesData[i+5],this.inverseBindMatricesData[i+6],this.inverseBindMatricesData[i+7],this.inverseBindMatricesData[i+8],this.inverseBindMatricesData[i+9],this.inverseBindMatricesData[i+10],this.inverseBindMatricesData[i+11],this.inverseBindMatricesData[i+12],this.inverseBindMatricesData[i+13],this.inverseBindMatricesData[i+14],this.inverseBindMatricesData[i+15])}}(),Ae=function(){return function(e,t){this.name=void 0!==t.name?t.name:null,this.nodes=new Array(t.nodes.length);for(var r=0,i=t.nodes.length;r<i;r++)this.nodes[r]=e.nodes[t.nodes[r]];this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.boundingBox=null}}(),Pe=function(){return function(e){this.nodeID=void 0!==e.node?e.node:null,this.path=e.path,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),ke=function(){return function(e,t){this.sampler=t.samplers[e.sampler],this.target=new Pe(e.target),this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Oe=function(){return function(e,t){this.input=e.accessors[t.input],this.output=e.accessors[t.output],this.inputTypedArray=this.input.getAccessorData(),this.outputTypedArray=this.output.getAccessorData(),this.interpolation=void 0!==t.interpolation?t.interpolation:"LINEAR",this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.curIdx=0,this.curValue=U.e.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]}}(),De=function(){return function(e,t){var r,i;for(this.name=void 0!==t.name?t.name:null,this.samplers=[],r=0,i=t.samplers.length;r<i;r++)this.samplers[r]=new Oe(e,t.samplers[r]);for(this.channels=[],r=0,i=t.channels.length;r<i;r++)this.channels[r]=new ke(t.channels[r],this);this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null}}(),Ne=function(){return function(e){this.json=e,this.defaultScene=void 0!==e.scene?e.scene:0,this.version=Number(e.asset.version),e.accessors&&(this.accessors=new Array(e.accessors.length)),e.bufferViews&&(this.bufferViews=new Array(e.bufferViews.length)),e.scenes&&(this.scenes=new Array(e.scenes.length)),e.nodes&&(this.nodes=new Array(e.nodes.length)),e.meshes&&(this.meshes=new Array(e.meshes.length)),e.materials&&(this.materials=new Array(e.materials.length)),e.textures&&(this.textures=new Array(e.textures.length)),e.samplers&&(this.samplers=new Array(e.samplers.length)),e.images&&(this.images=new Array(e.images.length)),e.skins&&(this.skins=new Array(e.skins.length)),e.animations&&(this.animations=new Array(e.animations.length)),e.cameras&&(this.cameras=new Array(e.cameras.length)),this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null}}(),Ce=function(){function e(e,t,r){this._buffers=[],this._gltfModel=e,this._resourceManager=t,this._materialManager=r}return e.load=function(t,r,i,n){var a=new J(n,r,i),o=new e(a,r,i);return new Promise(function(e){o.load(t,function(){e(a)})})},e.prototype._parse=function(){var e,t,r,i,n,a,o;if(this.model.bufferViews)for(e=0,t=this.model.bufferViews.length;e<t;e++)this.model.bufferViews[e]=new _e(this.model.json.bufferViews[e],this._buffers[this.model.json.bufferViews[e].buffer]);if(this.model.accessors)for(e=0,t=this.model.accessors.length;e<t;e++)this.model.accessors[e]=new fe(this.model.json.accessors[e],this.model.bufferViews[this.model.json.accessors[e].bufferView]);if(this.model.materials)for(e=0,t=this.model.materials.length;e<t;e++)this.model.materials[e]=new Te(this.model.json.materials[e]);if(this.model.samplers)for(e=0,t=this.model.samplers.length;e<t;e++)this.model.samplers[e]=new be(this.model.json.samplers[e]);if(this.model.textures)for(e=0,t=this.model.textures.length;e<t;e++)this.model.textures[e]=new ge(this,this.model.json.textures[e]);for(e=0,t=this.model.meshes.length;e<t;e++)this.model.meshes[e]=new ve(this,this.model.json.meshes[e],e);for(e=0,t=this.model.nodes.length;e<t;e++)this.model.nodes[e]=new me(this,this.model.json.nodes[e],e);for(e=0,t=this.model.nodes.length;e<t;e++)for(r=0,i=(a=this.model.nodes[e]).children.length;r<i;r++)a.children[r]=this.model.nodes[a.children[r]];var s,l=new Array(this.model.nodes.length);for(e=0,t=l.length;e<t;e++)l[e]=U.a.create();function u(e,t){var r=l[e.nodeID];if(null!==t)U.a.mul(r,l[t.nodeID],e.matrix);else{U.a.mul(r,[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],e.matrix)}e.matrixWorld=U.a.clone(r),e.matrixParent=U.a.clone(null!==t?l[t.nodeID]:U.a.create())}function c(e,t){var r,i=l[e.nodeID];r=null!==t?t.bvh:n.boundingBox,e.mesh&&(o=e.mesh).boundingBox&&(e.aabb=pe.getAABBFromOBB(o.boundingBox,i),0===e.children.length&&(U.d.copy(e.bvh.min,e.aabb.min),U.d.copy(e.bvh.max,e.aabb.max))),U.d.min(r.min,r.min,e.bvh.min),U.d.max(r.max,r.max,e.bvh.max)}for(e=0,t=this.model.scenes.length;e<t;e++){for((n=this.model.scenes[e]=new Ae(this.model,this.model.json.scenes[e])).boundingBox=new pe,r=0,i=n.nodes.length;r<i;r++)(a=n.nodes[r]).traverseTwoExecFun(null,u,c);n.boundingBox.calculateTransform()}for(r=0,i=this.model.nodes.length;r<i;r++)null!==(a=this.model.nodes[r]).bvh&&a.bvh.calculateTransform();if(this.model.animations)for(e=0,t=this.model.animations.length;e<t;e++)this.model.animations[e]=new De(this.model,this.model.json.animations[e]);if(this.model.json.skins)for(e=0,t=this.model.skins.length;e<t;e++)for(this.model.skins[e]=new Se(this.model,this.model.json.skins[e],e),r=0,i=(s=this.model.skins[e].joints).length;r<i;r++)s[r].jointID=r;for(e=0,t=this.model.nodes.length;e<t;e++)null!==(a=this.model.nodes[e]).skin&&"number"==typeof a.skin&&(a.skin=this.model.skins[a.skin])},e.prototype._createTexture=function(e){var t=this.model.textures[e.index],r=this._modelUrl+"-"+e.index;if(this._resourceManager.hasTexture(r))return this._resourceManager.getTexture(r);var i=this._resourceManager.getTexture(r),n=t.source,a=this._resourceManager.gl,o=a.LINEAR,s=a.REPEAT;return t.sampler&&t.sampler.minFilter&&(o=t.sampler.minFilter),t.sampler&&t.sampler.wrapS&&(s=t.sampler.wrapS),i.createFromImage(n,-1===n.src.indexOf(".png")?a.RGB:a.RGBA,a.UNSIGNED_BYTE,o,s),i},e.prototype._createShader=function(e,t){var r=[];r.push("MODEL_TRANSFORM");var i=e.material;i&&(i.pbrMetallicRoughness.baseColorTexture&&r.push("HAS_BASECOLORMAP"),i.pbrMetallicRoughness.metallicRoughnessTexture&&r.push("HAS_METALROUGHNESSMAP"),i.normalTexture&&r.push("HAS_NORMALMAP"),i.occlusionTexture&&r.push("HAS_OCCLUSIONMAP"),i.emissiveTexture&&r.push("HAS_EMISSIVEMAP"),t&&r.push("HAS_SKIN")),void 0!==e.attributes.TANGENT&&r.push("HAS_TANGENT");var n=this._resourceManager.getShader("pbr",r);if(!n.ready){var a=k.a.pbr;if(n.createFromShaderSource(a,r),!n.ready)throw"modelo3d error at creating shader 'pbr'!"}return n},e.prototype._createMaterial=function(e,t){var r,i=this._resourceManager.gl,n=e.material,a=this._materialManager.createMaterialPbr(this._modelUrl+"-"+e.material.name);if(a.attachShader(t,this._resourceManager),a.setBaseColor(n.pbrMetallicRoughness.baseColorFactor),a.setMetallic(n.pbrMetallicRoughness.metallicFactor),a.setRoughness(n.pbrMetallicRoughness.roughnessFactor),a.setEmissive(n.emissiveFactor),this._resourceManager.hasTexture("modelo-brdf-lut")?r=this._resourceManager.getTexture("modelo-brdf-lut"):(r=this._resourceManager.getTexture("modelo-brdf-lut")).createFromFile(ce,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){}),a.setBrdfLut(r),n.pbrMetallicRoughness.baseColorTexture){var o=n.pbrMetallicRoughness.baseColorTexture,s=this._createTexture(o);a.setBaseColorTexture(s)}if(n.normalTexture){o=n.normalTexture,s=this._createTexture(o);a.setNormalTexture(s)}if(n.pbrMetallicRoughness.metallicRoughnessTexture){o=n.pbrMetallicRoughness.metallicRoughnessTexture,s=this._createTexture(o);a.setMetallicRoughnessTexture(s)}if(n.emissiveTexture){o=n.emissiveTexture,s=this._createTexture(o);a.setEmissiveTexture(s)}if(n.occlusionTexture){o=n.occlusionTexture,s=this._createTexture(o);a.setOcclusionTexture(s)}return a},e.prototype._createMesh=function(e,t){var r=this._resourceManager.gl,i=new ie,n=[],a=t.attributes.POSITION;i.add("m_aPosition",0,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER)),void 0!==t.attributes.NORMAL&&(a=t.attributes.NORMAL,i.add("m_aNormal",1,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER))),void 0!==t.attributes.TEXCOORD_0&&(a=t.attributes.TEXCOORD_0,i.add("m_aTexCoord",4,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER))),void 0!==t.attributes.TANGENT&&(a=t.attributes.TANGENT,i.add("m_aTangent",7,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER))),void 0!==t.attributes.JOINTS_0&&(a=t.attributes.JOINTS_0,i.add("m_aJoint0",8,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER))),void 0!==t.attributes.WEIGHTS_0&&(a=t.attributes.WEIGHTS_0,i.add("m_aWeight0",9,a.componentType,a.normalized,a.size,a.byteStride,a.byteOffset),n.push(a.bufferView.getBuffer(r,r.ARRAY_BUFFER)));var o=this._resourceManager.getMesh(this._modelUrl+"_"+e+"_"+t.index),s=(a=this.model.accessors[t.indices]).bufferView.getBuffer(r,r.ELEMENT_ARRAY_BUFFER);return o.createFromBufferObject(n,s,i,t.mode,t.indicesComponentType,t.indicesLength,a.byteOffset),o},e.prototype._createDrawable=function(e,t,r,i,n){var a=t.boundingBox,o=new D.a(r,i,n,null,new Float32Array([a.min[0],a.min[1],a.min[2],a.max[0],a.max[1],a.max[2]]));return o.transform.set(e.matrixWorld),this._gltfModel.addDrawable(o),o},e.prototype._traverseNode=function(e){var t=this;if(e.mesh&&e.mesh.primitives.forEach(function(r){var i=e.nodeID+"_"+e.mesh.meshID,n=t._createMesh(i,r),a=t._createShader(r,!!e.skin),o=t._createMaterial(r,a),s=t._createDrawable(e,r,n,a,o);e.skin&&(s.skeleton=e.skin.mySkeleton)}),e.children.length>0)for(var r=0;r<e.children.length;r++)this._traverseNode(e.children[r])},e.prototype._buildSkeleton=function(e,t,r){var i=this;t.children.forEach(function(t){var n=r.get(t.nodeID.toString());e.addChild(n),i._buildSkeleton(n,t,r)})},e.prototype._setupScene=function(){var e=this;this.model.skins&&this.model.skins.length>0&&(this.model.skins.forEach(function(t){var r=new Map,i=new se(e._modelUrl+(t.skeleton?t.skeleton.nodeID.toString():""),t.skeleton&&t.skeleton.inverseBindMatrix?t.skeleton.inverseBindMatrix:U.a.create(),t.skeleton?t.skeleton.matrixWorld:U.a.create());r.set(i.getName(),i);var n=new oe(i,e._resourceManager);n.setRootMatrix(t.skeleton?t.skeleton.matrixParent:U.a.create()),t.joints.forEach(function(e){var t=r.get(e.nodeID.toString());t||(t=new se(e.nodeID.toString(),e.inverseBindMatrix,e.matrixWorld),r.set(t.getName(),t)),n.addJoint(t)}),t.skeleton?e._buildSkeleton(i,t.skeleton,r):e._buildSkeleton(i,t.joints[0],r),e._gltfModel.skeletons.push(n),t.mySkeleton=n}),this.model.animations.forEach(function(t,r){var i=new Map,n=0,a=new Set;t.channels.forEach(function(e){var t=e.sampler,r=X.LINEAR;switch(t.interpolation){case"LINEAR":r=X.LINEAR;break;case"STEP":r=X.STEP;break;case"CATMULLROMSPLINE":r=X.CATMULLROMSPLINE;break;case"CUBICSPLINE":r=X.CUBICSPLINE}for(var o=0,s=0;s<t.inputTypedArray.length;s++){var l=t.inputTypedArray[s];l>n&&(n=l);var u=i.get(l);u||(u=new ue(l),i.set(l,u));for(var c=u.getJointKeyFrames(),h=t.output.size,d=[],p=0;p<h;p++)d[p]=t.outputTypedArray[o+p];var f=e.target.nodeID.toString();a.has(f)||a.add(f);var _=c.get(f);switch(_||(_=new ne,c.set(f,_)),_.setInterpolationMethod(r),e.target.path){case"translation":_.setTranslation(d);break;case"rotation":_.setRotation(d);break;case"scale":_.setScale(d)}o+=h}});var o=Array.from(i.values());o.sort(function(e,t){return e.getTimeStamp()-t.getTimeStamp()}),o.forEach(function(t){t.getJointKeyFrames().forEach(function(t,r){var i=parseInt(r),n=e.model.nodes[i];null===t.getTranslation()&&t.setTranslation(n.translation),null===t.getRotation()&&t.setRotation(n.rotation),null===t.getScale()&&t.setScale(n.scale)})}),o[0].getJointKeyFrames().forEach(function(e,t){for(var r=1;r<o.length;r++)o[r].getJointKeyFrames().has(t)||o[r].getJointKeyFrames().set(t,e)});var s=new le(r.toString(),n,o);a.forEach(function(t){for(var r=0;r<e._gltfModel.skeletons.length;r++){var i=e._gltfModel.skeletons[r];if(-1!==i.joints.findIndex(function(e){return e.getName()===t})){i.addAnimation(s);break}}})})),this.model.scenes.forEach(function(t){t.nodes.forEach(function(t){e._traverseNode(t)})});var t=this.model.scenes[0].boundingBox;this._gltfModel.bbox=new Float32Array([t.min[0],t.min[1],t.min[2],t.max[0],t.max[1],t.max[2]])},e.prototype.load=function(e,t){var r=this;this._modelUrl=e,this._baseUrl=this._getBaseUrl(e),ee.a.get(e,{responseType:"json"}).then(function(e){var i=e.data;r.model=new Ne(i);var n=[];i.images&&n.push(r._loadImages(i.images)),i.buffers&&n.push(r._loadArraybuffer(i.buffers)),Promise.all(n).then(function(){r._parse(),r._setupScene(),t()})})},e.prototype._loadImages=function(e){var t=this;return new Promise(function(r,i){for(var n=e.length,a=function(){var a=new Image;a.src=t._baseUrl+e[o].uri,a.onload=function(){0===--n&&r(!0)},a.onerror=function(){console.error("failed to load image: "+a.src),i()},t.model.images[o]=a},o=0;o<e.length;o++)a()})},e.prototype._loadArraybuffer=function(e){var t=this;return new Promise(function(r,i){for(var n=[],a=0;a<e.length;a++){var o=e[a].uri;if("data:application/octet-stream;base64,"===o.substring(0,37)){var s=o.substring(37),l=t.base64toArrayBuffer(s);t._buffers[a]=l.buffer}else{var u=t._baseUrl+e[a].uri,c=ee.a.get(u,{responseType:"arraybuffer"});n.push(c)}}Promise.all(n).then(function(e){e.forEach(function(e,r){t._buffers[r]=e.data}),r(!0)})})},e.prototype._getBaseUrl=function(e){var t="",r=e.lastIndexOf("/");return-1!==r&&(t=e.substring(0,r+1)),t},e.prototype.base64toArrayBuffer=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(t),i=new Uint8Array(r.length),n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return i},e}(),Ie=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Re=function(e){function t(t,r){return e.call(this,t,r)||this}return Ie(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uFontBitmap"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uTextureSize"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uColor"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return i},t.prototype.setFontBitmap=function(e){this.reservedParameters.m_uFontBitmap&&(this.reservedParameters.m_uFontBitmap.value=e),this.reservedParameters.m_uTextureSize&&(this.reservedParameters.m_uTextureSize.value=[e.width,e.height])},t.prototype.setColor=function(e){this.reservedParameters.m_uColor&&(this.reservedParameters.m_uColor.value=e)},t}(F),Be=r(38),Le=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Fe=function(e){function t(t){var r=e.call(this,"bitmap-font",t)||this;return r._asciiMap=new Map,r._bitmap=new O.a("bitmap-font",t),r.ready=!1,r._fontInfo={name:"Arial",size:32,bold:!1,italic:!1,width:1024,height:128,characters:{0:{x:288,y:42,width:27,height:35,originX:5,originY:29,advance:18},1:{x:630,y:42,width:21,height:35,originX:3,originY:29,advance:18},2:{x:120,y:42,width:28,height:35,originX:5,originY:29,advance:18},3:{x:315,y:42,width:27,height:35,originX:5,originY:29,advance:18},4:{x:148,y:42,width:28,height:35,originX:6,originY:29,advance:18},5:{x:176,y:42,width:28,height:35,originX:5,originY:28,advance:18},6:{x:342,y:42,width:27,height:35,originX:5,originY:29,advance:18},7:{x:735,y:42,width:27,height:34,originX:5,originY:28,advance:18},8:{x:204,y:42,width:28,height:35,originX:5,originY:29,advance:18},9:{x:232,y:42,width:28,height:35,originX:5,originY:29,advance:18}," ":{x:471,y:77,width:12,height:12,originX:6,originY:6,advance:9},"!":{x:672,y:42,width:16,height:35,originX:3,originY:29,advance:9},'"':{x:304,y:77,width:21,height:20,originX:5,originY:29,advance:11},"#":{x:393,y:0,width:30,height:36,originX:6,originY:29,advance:18},$:{x:197,y:0,width:27,height:40,originX:5,originY:30,advance:18},"%":{x:562,y:0,width:37,height:35,originX:4,originY:29,advance:28},"&":{x:361,y:0,width:32,height:36,originX:5,originY:29,advance:21},"'":{x:325,y:77,width:16,height:20,originX:5,originY:29,advance:6},"(":{x:85,y:0,width:20,height:42,originX:4,originY:29,advance:10},")":{x:105,y:0,width:20,height:42,originX:4,originY:29,advance:10},"*":{x:281,y:77,width:23,height:22,originX:5,originY:29,advance:12},"+":{x:143,y:77,width:28,height:27,originX:4,originY:24,advance:18},",":{x:341,y:77,width:16,height:19,originX:3,originY:9,advance:9},"-":{x:403,y:77,width:21,height:15,originX:5,originY:15,advance:10},".":{x:424,y:77,width:16,height:15,originX:3,originY:9,advance:9},"/":{x:478,y:0,width:21,height:36,originX:6,originY:29,advance:9},":":{x:127,y:77,width:16,height:28,originX:3,originY:22,advance:9},";":{x:762,y:42,width:16,height:33,originX:3,originY:22,advance:9},"<":{x:171,y:77,width:28,height:27,originX:4,originY:25,advance:18},"=":{x:253,y:77,width:28,height:22,originX:4,originY:22,advance:18},">":{x:199,y:77,width:28,height:27,originX:4,originY:25,advance:18},"?":{x:369,y:42,width:27,height:35,originX:5,originY:29,advance:18},"@":{x:0,y:0,width:42,height:42,originX:4,originY:29,advance:32},A:{x:599,y:0,width:34,height:35,originX:6,originY:29,advance:21},B:{x:0,y:42,width:30,height:35,originX:4,originY:29,advance:21},C:{x:328,y:0,width:33,height:36,originX:5,originY:29,advance:23},D:{x:799,y:0,width:32,height:35,originX:4,originY:29,advance:23},E:{x:30,y:42,width:30,height:35,originX:4,originY:29,advance:21},F:{x:260,y:42,width:28,height:35,originX:4,originY:29,advance:19},G:{x:294,y:0,width:34,height:36,originX:4,originY:29,advance:25},H:{x:831,y:0,width:31,height:35,originX:4,originY:29,advance:23},I:{x:688,y:42,width:16,height:35,originX:3,originY:29,advance:9},J:{x:583,y:42,width:25,height:35,originX:5,originY:29,advance:16},K:{x:862,y:0,width:31,height:35,originX:4,originY:29,advance:21},L:{x:396,y:42,width:27,height:35,originX:4,originY:29,advance:18},M:{x:633,y:0,width:34,height:35,originX:4,originY:29,advance:26},N:{x:893,y:0,width:31,height:35,originX:4,originY:29,advance:23},O:{x:259,y:0,width:35,height:36,originX:5,originY:29,advance:25},P:{x:60,y:42,width:30,height:35,originX:4,originY:29,advance:21},Q:{x:224,y:0,width:35,height:37,originX:5,originY:29,advance:25},R:{x:667,y:0,width:33,height:35,originX:4,originY:29,advance:23},S:{x:924,y:0,width:31,height:35,originX:5,originY:29,advance:21},T:{x:955,y:0,width:31,height:35,originX:5,originY:29,advance:19},U:{x:986,y:0,width:31,height:35,originX:4,originY:29,advance:23},V:{x:700,y:0,width:33,height:35,originX:6,originY:29,advance:21},W:{x:520,y:0,width:42,height:35,originX:6,originY:29,advance:30},X:{x:733,y:0,width:33,height:35,originX:6,originY:29,advance:21},Y:{x:766,y:0,width:33,height:35,originX:6,originY:29,advance:21},Z:{x:90,y:42,width:30,height:35,originX:5,originY:29,advance:19},"[":{x:159,y:0,width:19,height:41,originX:4,originY:29,advance:9},"\\":{x:499,y:0,width:21,height:36,originX:6,originY:29,advance:9},"]":{x:178,y:0,width:19,height:41,originX:6,originY:29,advance:9},"^":{x:227,y:77,width:26,height:24,originX:5,originY:29,advance:15},_:{x:440,y:77,width:31,height:14,originX:7,originY:1,advance:18},"`":{x:385,y:77,width:18,height:16,originX:5,originY:29,advance:10},a:{x:960,y:42,width:27,height:29,originX:5,originY:23,advance:18},b:{x:423,y:42,width:27,height:35,originX:4,originY:29,advance:18},c:{x:987,y:42,width:27,height:29,originX:5,originY:23,advance:16},d:{x:450,y:42,width:27,height:35,originX:5,originY:29,advance:18},e:{x:848,y:42,width:28,height:29,originX:5,originY:23,advance:18},f:{x:608,y:42,width:22,height:35,originX:6,originY:29,advance:9},g:{x:451,y:0,width:27,height:36,originX:5,originY:23,advance:18},h:{x:531,y:42,width:26,height:35,originX:4,originY:29,advance:18},i:{x:704,y:42,width:16,height:35,originX:4,originY:29,advance:7},j:{x:125,y:0,width:19,height:42,originX:8,originY:29,advance:7},k:{x:557,y:42,width:26,height:35,originX:4,originY:29,advance:16},l:{x:720,y:42,width:15,height:35,originX:4,originY:29,advance:7},m:{x:778,y:42,width:35,height:29,originX:4,originY:23,advance:26},n:{x:27,y:77,width:26,height:29,originX:4,originY:23,advance:18},o:{x:876,y:42,width:28,height:29,originX:5,originY:23,advance:18},p:{x:477,y:42,width:27,height:35,originX:4,originY:23,advance:18},q:{x:504,y:42,width:27,height:35,originX:5,originY:23,advance:18},r:{x:105,y:77,width:22,height:29,originX:4,originY:23,advance:10},s:{x:53,y:77,width:26,height:29,originX:5,originY:23,advance:16},t:{x:651,y:42,width:21,height:35,originX:6,originY:29,advance:9},u:{x:79,y:77,width:26,height:29,originX:4,originY:23,advance:18},v:{x:904,y:42,width:28,height:29,originX:6,originY:23,advance:16},w:{x:813,y:42,width:35,height:29,originX:6,originY:23,advance:23},x:{x:932,y:42,width:28,height:29,originX:6,originY:23,advance:16},y:{x:423,y:0,width:28,height:36,originX:6,originY:23,advance:16},z:{x:0,y:77,width:27,height:29,originX:6,originY:23,advance:16},"{":{x:42,y:0,width:22,height:42,originX:5,originY:29,advance:10},"|":{x:144,y:0,width:15,height:42,originX:3,originY:29,advance:8},"}":{x:64,y:0,width:21,height:42,originX:5,originY:29,advance:10},"~":{x:357,y:77,width:28,height:17,originX:5,originY:20,advance:18}}},r._init(),r}return Le(t,e),t.prototype._init=function(){var e=this,t=this._manager.gl;this._bitmap.create(1024,128,t.RGB8,t.LINEAR,t.CLAMP_TO_EDGE);var r=new Image;r.onload=function(){e._bitmap.updateImage(r,t.RGB,t.UNSIGNED_BYTE,t.LINEAR,t.CLAMP_TO_EDGE)},r.src="data:image/png;base64,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"},t.prototype.getGlyphs=function(e){for(var t=[],r=0;r<e.length;r++){var i=e.charCodeAt(r),n=this._fontInfo.characters[e[r]];if(this._asciiMap.has(i))t.push(this._asciiMap.get(i));else{var a={x1:n.x/this._fontInfo.width,y1:(n.y+n.height)/this._fontInfo.height,x2:(n.x+n.width)/this._fontInfo.width,y2:n.y/this._fontInfo.height,size:n.advance/this._fontInfo.size,width:n.width/this._fontInfo.size,height:n.height/this._fontInfo.size,xoffset:n.originX/2/this._fontInfo.size,yoffset:n.originY/this._fontInfo.size};t.push(a),this._asciiMap.set(i,a)}}return t},t.prototype.getTexture=function(){return this._bitmap},t}(Be.a),Ue=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ve=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n._content="",void 0!==n._resourceManager.bitmapFont?n._bitmapFont=n._resourceManager.bitmapFont:(n._resourceManager.bitmapFont=new Fe(r),n._bitmapFont=n._resourceManager.bitmapFont),n}return Ue(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.setContent=function(e){if(e!==this._content){this._content=e;var t=this._bitmapFont.getGlyphs(e);if(this.drawables[0]&&this.drawables[0].mesh.ready)this.drawables[0].mesh.destroy(),this.drawables[0].mesh=this._resourceManager.getMesh("text3d-"+e),this.drawables[0].mesh.ready||this.drawables[0].mesh.createTextGrid(t);else{var r=this._resourceManager.getMesh("text3d-"+e);r.ready||r.createTextGrid(t);var i=this._resourceManager.getShader("text3d-"+this.name,["MODEL_TRANSFORM"]);i.ready||i.createFromShaderSource(k.a.df_text,["MODEL_TRANSFORM"]);var n=new Re("text3d-material-"+this.name,this._resourceManager);n.attachShader(i,this._resourceManager),n.setFontBitmap(this._bitmapFont.getTexture()),n.setColor([0,0,0]),n.transparent=!0;var a=new Float32Array([-1,-1,0,1,1,0]);this.addDrawable(this._createDrawable(r,i,n,a)),this.bbox?P.a.aabb.union(this.bbox,this.bbox,a):this.bbox=a}}},t.prototype.setColor=function(e){this.drawables.forEach(function(t){t.material.setColor(e)})},t.prototype._createDrawable=function(e,t,r,i){return new D.a(e,t,r,null,i)},t}(Z),je=r(54),ze=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ge=(U.d.fromValues(0,0,0),U.a.create(),[0,0,0]),He=function(e){function t(t){var r=e.call(this,t)||this;return r._up=U.d.create(),r._forward=U.d.create(),r._right=U.d.create(),r._translate=U.d.create(),r._transformMatrix=U.a.create(),r.matrix&&(U.a.copy(r._transformMatrix,r.matrix),U.a.copy(r.matrix,r.matrix)),r}return ze(t,e),t.prototype.getBottomPoint=function(){var e=this.getScaling();return Ge[0]=this.matrix[12],Ge[1]=this.matrix[13],Ge[2]=this.matrix[14]-e[2],Ge},t.prototype.setTranslation=function(t,r,i){U.a.copy(this.matrix,this._transformMatrix),e.prototype.setTranslation.call(this,t,r,i),U.a.copy(this._transformMatrix,this.matrix)},t.prototype.setScaling=function(t,r,i){U.a.copy(this.matrix,this._transformMatrix),e.prototype.setScaling.call(this,t,r,i),U.a.copy(this._transformMatrix,this.matrix)},t.prototype.setFaceCameraZ=function(e){this._faceCameraZ=e},t.prototype.update=function(e,t){this._up=U.d.create(),this._forward=U.d.create(),this._right=U.d.create(),this._faceCameraZ?(this._forward[0]=e._at[0]-e.eye[0],this._forward[1]=e._at[1]-e.eye[1],this._forward[2]=e._at[2]-e.eye[2]):(this._forward[0]=e._at[0]-e.eye[0],this._forward[1]=e._at[1]-e.eye[1],this._forward[2]=0),U.d.normalize(this._forward,this._forward),this._up[2]=1,U.d.cross(this._right,this._forward,this._up),U.d.normalize(this._right,this._right),U.d.cross(this._up,this._right,this._forward),U.d.normalize(this._up,this._up);var r=U.a.create();r[0]=this._right[0],r[1]=this._right[1],r[2]=this._right[2],r[3]=0,r[4]=this._forward[0],r[5]=this._forward[1],r[6]=this._forward[2],r[7]=0,r[8]=this._up[0],r[9]=this._up[1],r[10]=this._up[2],r[11]=0,this._translate=U.d.create(),this._translate[0]=this._transformMatrix[12],this._translate[1]=this._transformMatrix[13],this._translate[2]=this._transformMatrix[14],this._transformMatrix[12]=this._transformMatrix[13]=this._transformMatrix[14]=0,U.a.multiply(this.matrix,r,this._transformMatrix),this.matrix[12]=this._translate[0],this.matrix[13]=this._translate[1],this.matrix[14]=this._translate[2],this._transformMatrix[12]=this._translate[0],this._transformMatrix[13]=this._translate[1],this._transformMatrix[14]=this._translate[2],this._updateMatrixBuffer()},t.prototype.setTransform=function(t){e.prototype.setTransform.call(this,t),U.a.copy(this._transformMatrix,this.matrix)},t}(je.a),qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),We=function(e){function t(t,r,i,n,a){var o=e.call(this,t,r,i,n,a)||this;return o.shouldUpdate=!0,o.faceCamera=!0,o.transform=new He(n),o.bbox=P.a.aabb.createFromSphere(o.bsphere),o._center=P.a.aabb.center(o.bbox),o}return qe(t,e),t.prototype.destroy=function(t){this._center=null,delete this._center,e.prototype.destroy.call(this,t)},t.prototype.isShadowCaster=function(){return!0},t.prototype.update=function(e){this.shouldUpdate&&this.transform.update(e,this._center)},t.prototype.setTranslation=function(t,r,i){e.prototype.setTranslation.call(this,t,r,i),this._center=P.a.aabb.center(this.bbox)},t.prototype.translate=function(t,r,i){e.prototype.translate.call(this,t,r,i),this._center=P.a.aabb.center(this.bbox)},t.prototype.setTransformMatrix=function(t){e.prototype.setTransformMatrix.call(this,t),this._center=P.a.aabb.center(this.bbox)},t.prototype.clone=function(){var e=new t(this.mesh,this.shader,this.material.clone(this.material.name+"-cloned"),this.transform.matrix,this.bbox);return e.faceCamera=this.faceCamera,e.bsphere=this.bsphere,e.distance=this.distance,e.nodes=this.nodes,e.hidables=this.hidables,e.originalMaterial=this.originalMaterial,e._center=this._center,e},t.prototype.recompileShader=function(t,r){"CLIPPING"!==t&&e.prototype.recompileShader.call(this,t,r)},t}(D.a),Qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ye=function(e){function t(t,r,i){return e.call(this,t,r,i)||this}return Qe(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype._createDrawable=function(e,t,r,i){return new We(e,t,r,null,i)},t.prototype.setFaceCameraZ=function(e){this.drawables.forEach(function(t){t.transform.setFaceCameraZ(e)})},t}(Ve),Xe=function(){function e(e,t,r,i){this._sceneJson=e,this._sceneBin=t,this._modelJson=r,this._modelBin=i,this._samplersLocation=0,this._texturesLocation=0,this._materialsLocation=0,this._attributesLocation=0,this._meshesLocation=0,this._nodesLocation=0,this._initialize(e,t,r,i)}return e.prototype.destroy=function(){this._sceneBin=null,this._sceneJson=null,this._modelBin=null,this._modelJson=null,delete this._sceneBin,delete this._sceneJson,delete this._modelBin,delete this._modelJson,this._samplersLocation=null,this._texturesLocation=null,this._materialsLocation=null,this._attributesLocation=null,delete this._samplersLocation,delete this._texturesLocation,delete this._materialsLocation,delete this._attributesLocation,this._meshesLocation=null,this._nodesLocation=null,delete this._meshesLocation,delete this._nodesLocation},e.prototype._initialize=function(e,t,r,i){var n=0;e.samplers.length>0&&(this._samplersLocation=n,n+=4*e.samplers.length),e.textures.length>0&&(this._texturesLocation=n,n+=4*e.textures.length),e.materials.length>0&&(this._materialsLocation=n,n+=16*e.materials.length),e.attributes.length>0&&(this._attributesLocation=n),this._meshesLocation=8;var a=new Uint32Array(i,0,2);this._nodesLocation=20*a[0]+8},e.prototype.readSampler=function(e){return new Uint8Array(this._sceneBin,this._samplersLocation+1*e*4,4)},e.prototype.readTexture=function(e){return new Uint8Array(this._sceneBin,this._texturesLocation+1*e*4,4)},e.prototype.readMaterial=function(e){return new Uint8Array(this._sceneBin,this._materialsLocation+1*e*16,16)},e.prototype.readAttribute=function(e){return new Int8Array(this._sceneBin,this._attributesLocation+1*e*8,8)},e.prototype.readMesh=function(e){return new Uint32Array(this._modelBin,this._meshesLocation+4*e*5,5)},e.prototype.readNodeData=function(e){return new Uint32Array(this._modelBin,this._nodesLocation+4*e*21,3)},e.prototype.readNodeBBox=function(e){return new Float32Array(this._modelBin,this._nodesLocation+4*(21*e+3),6)},e.prototype.readNodeTransform=function(e){return new Float32Array(this._modelBin,this._nodesLocation+4*(21*e+9),12)},e.prototype.getBuffer=function(){return this._modelBin},e}(),Ze=r(32),Ke=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},Je=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},$e=new Float32Array(16);var et=function(){function e(e,t,r,i,n){void 0===n&&(n=!1),this._pawn=e,this._modelId=t,this._resourceManager=r,this._materialManager=i,this._billboard=n,this._sceneJson=null,this._modelJson=null,this._binLoader=null,this.drawables=[]}return e.prototype.destroy=function(){this._pawn=null,delete this._pawn,this._modelId=null,delete this._modelId,this._resourceManager=null,delete this._resourceManager,this._materialManager=null,delete this._materialManager,this._sceneJson=null,delete this._sceneJson,this._modelJson=null,delete this._modelJson,this._binLoader.destroy(),this._binLoader=null,delete this._binLoader,this.drawables=null,delete this.drawables},e.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e=this;return Je(this,function(t){return[2,Object(Ze.b)(this._modelId).then(function(t){return t["scene.json"].downloadFile().then(function(r){var i;if(i="string"==typeof r.data?JSON.parse(r.data):r.data,e._sceneJson=i,i.source){var n=e._sceneJson.source.split(".");switch(n[n.length-1]){case"skp":e._pawn.faces=2,e._pawn.hasContours=!0;break;case"rfa":case"rvt":e._pawn.faces=1,e._pawn.hasContours=!0;break;case"vgx":case"stl":case"max":e._pawn.faces=1;break;case"obj":case"3dm":case"nwd":e._pawn.faces=0;break;default:e._pawn.faces=1}}return e._load(t,i)})})]})})},e.prototype._load=function(e,t){return Ke(this,void 0,void 0,function(){var r=this;return Je(this,function(i){return this._sceneJson=t,[2,e["model.json"].downloadFile().then(function(i){return r._modelJson=i.data,r._pawn.bbox=new Float32Array(r._modelJson["model.bin"].bbox),e["scene.bin"].downloadFile().then(function(i){var n=i.data;return e["model.bin"].downloadFile().then(function(i){var a=i.data;return r._binLoader=new Xe(t,n,r._modelJson,a),r._loadTextures(e).then(function(){return r._loadMeshes(e)})})})})]})})},e.prototype._loadTextures=function(e){return Ke(this,void 0,void 0,function(){var t,r,i,n,a,o,s,l=this;return Je(this,function(u){if(0===this._sceneJson.textures.length)return[2,Promise.resolve("ok")];for(t=new Array(this._sceneJson.samplers.length),o=0,s=this._sceneJson.samplers.length;o<s;o++)t[o]={filter:te.a.LINEAR_MIPMAP_LINEAR,wrap:te.a.REPEAT},1===(r=this._binLoader.readSampler(o))[0]?t[o].filter=1===r[2]?te.a.LINEAR_MIPMAP_LINEAR:te.a.LINEAR:t[o].filter=1===r[2]?te.a.NEAREST_MIPMAP_NEAREST:te.a.NEAREST,t[o].wrap=1===r[1]?te.a.REPEAT:te.a.CLAMP_TO_EDGE;for(i={},Object.keys(e).forEach(function(t){var r=t.toLowerCase();i[r]=e[t]}),a=(n=function(e){var r=l._sceneJson.textures[e].name,n=r.toLowerCase();return i[n].downloadFile().then(function(i){var n=l._binLoader.readTexture(e),a=t[n[1]],o=l._resourceManager.getTexture(r),s=4===n[0]?te.a.RGBA:te.a.RGB;if(o.updateImage(i,s,te.a.UNSIGNED_BYTE,a.filter,a.wrap),!o.ready)return Promise.reject("modelo3d loader errors at creating texture object '"+r+"'.")})})(0),o=1,s=this._sceneJson.textures.length;o<s;o++)a=function(e){return a.then(function(){return n(e)})}(o);return[2,a]})})},e.prototype._loadMeshes=function(e){return Ke(this,void 0,void 0,function(){var t,r,i,n,a,o,l,u,c,h,d,p,f,_,m,v,y,g,b,w,x,M,E,T,S,A,P,k,O,D,N,C,I,R=this;return Je(this,function(B){for(t=new Array(this._sceneJson.attributes.length),r=[te.a.POINTS,te.a.LINES,te.a.LINES,te.a.LINES,te.a.TRIANGLES],i=[te.a.BYTE,te.a.UNSIGNED_BYTE,te.a.SHORT,te.a.UNSIGNED_SHORT,te.a.INT,te.a.UNSIGNED_INT,0,te.a.FLOAT,0],n=0,I=this._sceneJson.attributes.length;n<I;n++)t[n]=new ie,this._sceneJson.attributes[n],a=this._binLoader.readAttribute(n),t[n].primitive=r[a[0]],o=a[1]>=0?i[a[1]]:null,l=a[2]>=0?i[a[2]]:null,u=a[3]>=0?i[a[3]]:null,t[n].builtin(te.a.FLOAT,o,l,u);for(c=this._modelJson["model.bin"].nodes,h=this._modelJson.buffers.length,d=0,_=0;_<h;_++)d+=this._modelJson.buffers[_].byteLength;if(d>1024*s.a.gpuMemory*1024)throw new Error("No enough GPU memory to load this model: "+d);for(p=new Array(h),f=0;f<h;f++)p[f]=[];for(_=0;_<c;_++)S=this._binLoader.readNodeData(_),m=this._binLoader.readMesh(S[1]),v=m[0]>>16,p[v].push(_);for(y=0,g=0,b=0,I=p.length;b<I;++b){for(w=p[b],x=0,M=0,E=0,T=w.length;E<T;E++)S=this._binLoader.readNodeData(w[E]),A=this._binLoader.readMesh(S[1]),P=A[2],k=A[4],x+=P=P+3&-4,M+=k=k+3&-4;y<x&&(y=x),g<M&&(g=M)}for(O=new ArrayBuffer(y),D=new ArrayBuffer(g),N=this._loadMesh(0,e["mesh0.bin"],p,O,D,t),C=1,I=this._modelJson.buffers.length;C<I;C++)N=function(r){return N.then(function(){var i="mesh"+r.toString()+".bin";return R._loadMesh(r,e[i],p,O,D,t)})}(C);return[2,N]})})},e.prototype._loadMesh=function(e,t,r,i,n,a){var o=this;return t.downloadFile().then(function(t){var s=t.data,l=r[e],u=o._resourceManager.getBuffer(o._modelId+"vmesh"+e+".bin"),c=o._resourceManager.getBuffer(o._modelId+"imesh"+e+".bin"),h=!1;u.ready||c.ready||(u.create(te.a.ARRAY_BUFFER,new Uint8Array(1)),c.create(te.a.ELEMENT_ARRAY_BUFFER,new Uint8Array(1)),h=!0);for(var d=0,p=0,f=0,_=l.length;f<_;++f){var m=l[f],v=o._binLoader.readNodeData(m),y=o._binLoader.readMesh(v[1]),g=y[0]>>8&255,b=a[g],w=null;if(o._resourceManager.hasMesh(o._modelId+v[1]))w=o._createDrawable(m,v,y,b,u,c,null,null);else{var x=new Uint8Array(i,d,y[2]),M=new Uint8Array(n,p,y[4]),E=new Uint8Array(s,y[1],y[2]);x.set(E);var T=new Uint8Array(s,y[3],y[4]);M.set(T),d=(d+=y[2])+3&-4,p=(p+=y[4])+3&-4,w=o._createDrawable(m,v,y,b,u,c,x,M)}o.drawables.push(w)}h&&(u.update(new Uint8Array(i,0,d)),c.update(new Uint8Array(n,0,p)))})},e.prototype._createDrawable=function(e,t,r,i,n,a,o,s){var l=255&r[0],u=this._createShaderObject(t,i);if(u){var c=this._createMaterialObject(t,u,i);if(c){var h=this._createMeshObject(t[1],i,l,o,s,n,a);if(h){var d=null;0==(1073741824&t[2])&&(d=function(e){return $e[0]=e[0],$e[1]=e[1],$e[2]=e[2],$e[3]=0,$e[4]=e[3],$e[5]=e[4],$e[6]=e[5],$e[7]=0,$e[8]=e[6],$e[9]=e[7],$e[10]=e[8],$e[11]=0,$e[12]=e[9],$e[13]=e[10],$e[14]=e[11],$e[15]=1,$e}(this._binLoader.readNodeTransform(e)));var p=this._binLoader.readNodeBBox(e),f=void 0;return(f=this._billboard?new We(h,u,c,d,p):new D.a(h,u,c,d,p)).visible=!0,f}throw new Error("No enough GPU memory for new meshes.")}}},e.prototype._createMeshObject=function(e,t,r,i,n,a,o){var s=this._resourceManager.getMesh(this._modelId+e);if(!s.ready){for(var l=[te.a.UNSIGNED_BYTE,te.a.UNSIGNED_BYTE,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_INT],u=t.clone(),c=0,h=t.values.length;c<h;c++)u.values[c].offset+=i.byteOffset;s.createShared(u.primitive,u,i,n,l[r],a,o)}return s},e.prototype._createMaterialObject=function(e,t,r){var i=this._sceneJson.materials[65535&e[0]];r.primitive===te.a.LINES&&(i="mxLine-"+i);var n=this._materialManager.getMaterial(this._modelId+i);if(!n){var a=this._binLoader.readMaterial(65535&e[0]);(n=this._materialManager.createMaterialAdhoc(this._modelId+i)).attachShader(t);var o=[0,0,0];if(o[0]=a[0]/255,o[1]=a[1]/255,o[2]=a[2]/255,n.setDiffuse(o),n.setTransparent(a[3]/255),255!==a[4]){var s=a[5]<<8|a[4],l=this._modelId+this._sceneJson.textures[s].name,u=this._binLoader.readTexture(s);4===u[0]?1===u[2]?(n.hasMask=!0,n.transparent=!1):n.transparent=!0:n.transparent?n.transparent=!0:n.transparent=!1;var c=this._resourceManager.getTexture(l);n.setDiffuseTexture(c)}}return n},e.prototype._createShaderObject=function(e,t){var r=this._binLoader.readMaterial(65535&e[0]),i=255!==r[4],n="solid";t.primitive===te.a.LINES?n="plain":t.hasColor?n="color":i&&(n="texture");var a=[];if(e[2]>>30&1&&!this._billboard||a.push("MODEL_TRANSFORM"),i){var o=r[5]<<8|r[4];this._binLoader.readTexture(o)[2]&&a.push("ALPHATEST")}var s=this._resourceManager.getShader(n,a);if(!s.ready){var l=k.a[n];if(s.createFromShaderSource(l,a),!s.ready)throw"modelo3d error at creating shader '"+n+"'!"}return s},e}(),tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),rt=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},it=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},nt=function(e){function t(t,r,i){return e.call(this,t,r,i)||this}return tt(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.setFaceCameraZ=function(e){this.drawables.forEach(function(t){t.transform.setFaceCameraZ(e)})},t.prototype.load=function(e){return rt(this,void 0,void 0,function(){var t,r=this;return it(this,function(i){return this.drawables.length>0?(console.error("Can't re-initialize pawn."),[2]):[2,(t=new et(this,e,this._resourceManager,this._materialManager,!0)).load().then(function(){t.drawables.forEach(function(e){r.addDrawable(e)}),t.destroy()}).catch(function(e){console.warn(e)})]})})},t.prototype.createSolidQuad=function(e){void 0===e&&(e=[.5,.5,.5]);var t=this._resourceManager.getShader(this.name,["MODEL_TRANSFORM"]);t.ready||t.createFromShaderSource(k.a.plain,["MODEL_TRANSFORM"]);var r=this._materialManager.createMaterialAdhoc("pawn-billboard-material-"+this.name);r.attachShader(t,this._resourceManager),r.setDiffuse(e);var i=this._resourceManager.getMesh(this.name);i.createQuad(!0,!0,!0),this.addDrawable(new We(i,t,r,null,new Float32Array([-1,0,-1,1,0,1])));var n=new Float32Array([-1,0,-1,1,0,1]);P.a.aabb.scale(n,n,1.01),this.bbox?P.a.aabb.union(this.bbox,this.bbox,n):this.bbox=n},t.prototype.createWiredCube=function(e){void 0===e&&(e=[.5,.5,.5]);var t=this._resourceManager.getShader(this.name,["MODEL_TRANSFORM"]);t.ready||t.createFromShaderSource(k.a.plain,["MODEL_TRANSFORM"]);var r=this._materialManager.createMaterialAdhoc("pawn-billboard-material-"+this.name);r.attachShader(t,this._resourceManager),r.setDiffuse(e);var i=this._resourceManager.getMesh(this.name);i.createWiredCube(),this.addDrawable(new We(i,t,r,null,new Float32Array([-1,-1,-1,1,1,1])));var n=new Float32Array([-1,0,-1,1,0,1]);P.a.aabb.scale(n,n,1.01),this.bbox?P.a.aabb.union(this.bbox,this.bbox,n):this.bbox=n},t.prototype.createTexturedQuad=function(e,t){var r=t||{},i=r.hasMask,n=void 0!==i&&i,a=r.color,o=void 0===a?[1,1,1]:a,s=r.flipY,l=void 0!==s&&s,u=["MODEL_TRANSFORM"];n&&u.push("ALPHATEST");var c=this._resourceManager.getShader(this.name,u);c.ready||c.createFromShaderSource(k.a.plain_texture,u);var h=this._resourceManager.getTexture("pawn-billboard-texture-"+e.src);if(!h.ready){var d=this._resourceManager.gl,p=e.src.split(".");"png"!==p[p.length-1]&&"svg"!==p[p.length-1]?h.createFromImage(e,d.RGB,d.UNSIGNED_BYTE,d.LINEAR,d.CLAMP_TO_EDGE,l):h.createFromImage(e,d.RGBA,d.UNSIGNED_BYTE,d.LINEAR,d.CLAMP_TO_EDGE,l)}var f=e.src+"_"+o.join(","),_=this._materialManager.createMaterialAdhoc("pawn-billboard-material-"+f);_.attachShader(c,this._resourceManager),_.setDiffuseTexture(h),_.setDiffuse(o),h.hasAlpha()&&(_.transparent=!0),_.hasMask=n,n&&(_.transparent=!1,_.setTransparent(1),_.setAlphaCutoff(.9));var m=this._resourceManager.getMesh("pawn-billboard-mesh");m.createQuad(!0,!0,!0),this.addDrawable(new We(m,c,_,null,new Float32Array([-1,-1,-1,1,1,1])));var v=new Float32Array([-1,0,-1,1,0,1]);P.a.aabb.scale(v,v,1.01),this.bbox?P.a.aabb.union(this.bbox,this.bbox,v):this.bbox=v},t}(J),at=function(){function e(){this._zAngle=0,this._target=U.d.create(),this.intensity=1.05,this.shinness=100,this.envmapMatrix=U.a.create(),this._initialDirection=U.d.clone([.81961,-.28627,-.49804]),this._latitude=Math.asin(-this._initialDirection[2]),this._longitude=Math.atan2(-this._initialDirection[1],-this._initialDirection[0]),this.direction=U.d.clone(this._initialDirection),this.basedirection=U.d.clone(this._initialDirection);var e=U.a.clone([1.586253,-.725169,.70441,-2.30068,-.725169,-1.586253,-.359456,1.623691,.70441,-.359456,-.237555,-.893975,-2.30068,1.623691,-.893975,6.141995]),t=U.a.clone([1.329145,-.730669,.591031,-2.126058,-.730669,-1.329145,-.403495,1.890295,.591031,-.403495,-.159067,-.888839,-2.126058,1.890295,-.888839,6.193693]),r=U.a.clone([.870924,-.654664,.433506,-1.748137,-.654664,-.870924,-.440849,2.254821,.433506,-.440849,-.109753,-.848042,-1.748137,2.254821,-.848042,6.301804]);U.a.multiplyScalar(e,e,.0299),U.a.multiplyScalar(t,t,.0587),U.a.multiplyScalar(r,r,.0114),U.a.add(this.envmapMatrix,e,t),U.a.add(this.envmapMatrix,this.envmapMatrix,r),this._constantEnvmapMatrix=U.a.clone(this.envmapMatrix),this._initialEnvmapMatrix=U.a.clone(this.envmapMatrix),this._initialDirection=U.d.clone([.81961,-.49804,.28627]),this._initialEnvmapMatrix=U.a.clone(this._constantEnvmapMatrix),this._setFlipYZ(!1),this.setLatitude(.17*Math.PI),this.setLongitude(1.78*Math.PI)}return e.prototype._setFlipYZ=function(e){if(this._flipYZ=e,e)this._initialDirection=U.d.clone([.81961,-.49804,.28627]),this._initialEnvmapMatrix=U.a.clone(this._constantEnvmapMatrix);else{this._initialDirection=U.d.clone([.81961,-.28627,-.49804]);var t=U.a.clone([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),r=U.a.create();U.a.transpose(r,t);var i=U.a.create();U.a.multiply(this._initialEnvmapMatrix,U.a.multiply(i,r,this._constantEnvmapMatrix),t)}},e.prototype.setIntensity=function(e){this.intensity=e},e.prototype.getIntensity=function(){return this.intensity},e.prototype.setSpecularShinness=function(e){this.shinness=e},e.prototype.setLatitude=function(e){this._latitude=e;var t=Math.cos(this._latitude);this.basedirection[0]=-t*Math.cos(this._longitude),this.basedirection[1]=t*Math.sin(this._longitude),this.basedirection[2]=-Math.sin(this._latitude),this._updateDirection(),this._updateEnvmapMatrix()},e.prototype.setZRotation=function(e){this._zAngle=e,this._updateDirection(),this._updateEnvmapMatrix()},e.prototype.setLongitude=function(e){this._longitude=e;var t=Math.cos(this._latitude);this.basedirection[0]=-t*Math.cos(this._longitude),this.basedirection[1]=t*Math.sin(this._longitude),this.basedirection[2]=-Math.sin(this._latitude),this._updateDirection(),this._updateEnvmapMatrix()},e.prototype.getLongitude=function(){return this._longitude},e.prototype.getLatitude=function(){return this._latitude},e.prototype.getDirection=function(){return this.direction},e.prototype._updateEnvmapMatrix=function(){var e=U.b.create(),t=U.d.create();U.d.cross(t,this.direction,this._initialDirection),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+U.d.dot(this.direction,this._initialDirection),U.b.normalize(e,e);var r=U.a.create();U.a.fromQuat(r,e);var i=U.a.create();U.a.transpose(i,r);var n=U.a.create();U.a.multiply(this.envmapMatrix,U.a.multiply(n,i,this._initialEnvmapMatrix),r)},e.prototype._updateDirection=function(){U.d.rotateAxisZ(this.direction,this.basedirection,this._zAngle)},e}(),ot=function(){function e(e){this._enabled=!1,this._planes=[],this._bbox=P.a.aabb.createFromArray([-1,-1,-1,1,1,1]),this._clip=P.a.aabb.createFromArray([0,0,0,0,0,0]),this._planes=P.a.aabb.planes(this._clip),this._points=[U.d.create(),U.d.create(),U.d.create(),U.d.create(),U.d.create(),U.d.create(),U.d.create(),U.d.create()]}return e.prototype.initialize=function(e){this._bbox=P.a.aabb.createFromArray(e),this._bbox[0]-=.002,this._bbox[1]-=.002,this._bbox[2]-=.002,this._bbox[3]+=.002,this._bbox[4]+=.002,this._bbox[5]+=.002,this.reset()},e.prototype.reset=function(){var e=P.a.aabb.min(this._bbox),t=P.a.aabb.max(this._bbox);this._clip=P.a.aabb.create(e,t),this._points=P.a.aabb.points(this._clip),this._planes=P.a.aabb.planes(this._clip)},e.prototype.getCenter=function(){return P.a.aabb.center(this._clip)},e.prototype.getRadius=function(){return.5*P.a.aabb.len(this._clip)},e.prototype.get=function(){return this._clip},e.prototype.getBBox=function(){return this._bbox},e.prototype.getClippingPlanes=function(e){if(e){var t=[];return t.push(U.e.clone(this._planes[0])),t.push(U.e.clone(this._planes[1])),t.push(U.e.clone(this._planes[2])),t.push(U.e.clone(this._planes[3])),t.push(U.e.clone(this._planes[4])),t.push(U.e.clone(this._planes[5])),t}return this._planes},e.prototype.getClippingPoints=function(e){if(e){var t=[];return t.push(U.d.clone(this._points[0])),t.push(U.d.clone(this._points[1])),t.push(U.d.clone(this._points[2])),t.push(U.d.clone(this._points[3])),t.push(U.d.clone(this._points[4])),t.push(U.d.clone(this._points[5])),t.push(U.d.clone(this._points[6])),t.push(U.d.clone(this._points[7])),t}return this._points},e.prototype.getMin=function(){return P.a.aabb.min(this._clip)},e.prototype.getMax=function(){return P.a.aabb.max(this._clip)},e.prototype.update=function(e){for(var t=0;t<e.length;t++)U.d.copy(this._points[t],e[t]);P.a.aabb.createFromPoints(this._clip,e),U.e.copy(this._planes[0],P.a.plane.create(e[0],e[4],e[7])),U.e.copy(this._planes[1],P.a.plane.create(e[1],e[2],e[6])),U.e.copy(this._planes[2],P.a.plane.create(e[0],e[1],e[5])),U.e.copy(this._planes[3],P.a.plane.create(e[2],e[3],e[7])),U.e.copy(this._planes[4],P.a.plane.create(e[0],e[3],e[2])),U.e.copy(this._planes[5],P.a.plane.create(e[4],e[5],e[6]))},e.prototype.set=function(e,t){this._enabled=!0,"number"==typeof t[0]?(this._clip=P.a.aabb.create(e,t),this._points=P.a.aabb.points(this._clip),this._planes=P.a.aabb.planes(this._clip)):this.update(t)},e.prototype.isEnabled=function(){return this._enabled},e.prototype.setEnabled=function(e){this._enabled=e},e}(),st=r(23),lt=function(){function e(e){this._resourceManager=e,this.color=new Float32Array([1,1,1,1]),this.mode=st.a.SKYBOX_SOLIDCOLOR,this.skybox=null}return e.prototype.destroy=function(){null!==this.skybox&&this.skybox.destroy(),this.skybox=null,delete this.skybox,this.color=null,delete this.color},e.prototype.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.color[3]=e[3]},e.prototype.getColor=function(){return[this.color[0],this.color[1],this.color[2],this.color[3]]},e.prototype.setImages=function(e){this.skybox||(this.skybox=new st.b(this._resourceManager)),this.skybox.setImage(e)},e.prototype.setMode=function(e){e!==st.a.SKYBOX_SOLIDCOLOR?(this.skybox||(this.skybox=new st.b(this._resourceManager)),this.skybox.setMode(e)):this.skybox,this.mode=e},e.prototype.setBackgroundDirection=function(e){this.mode!==st.a.SKYBOX_SOLIDCOLOR&&(this.skybox||(this.skybox=new st.b(this._resourceManager)),this.skybox.setDirection(e))},e}(),ut=r(21),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ht=[1,0,1,1,.8,1,0,0,0,1],dt=[0,0,0],pt=[1,1,0],ft=function(e){function t(t,r){var i=e.call(this,t)||this;return i._materialParameters=new Float32Array(ht),i._materialTextureOffset=null,i._materialTextureScale=null,i._reservedParameters2={},i._resourceManager=r,i}return ct(t,e),t.prototype.destroy=function(){this._reservedParameters2=null,delete this._reservedParameters2,this._materialParameters=null,delete this._materialParameters,this._materialTextureScale=null,this._materialTextureOffset=null,delete this._materialTextureScale,delete this._materialTextureOffset,e.prototype.destroy.call(this)},t.prototype.attachShader=function(t,r){if(!t&&!r)return null;if(!t){if(!(t=r.getShader("solid",[])).ready){var i=k.a.solid;if(t.createFromShaderSource(i,["MODEL_TRANSFORM"]),!t.ready)throw"modelo3d error at creating shader 'solid'!"}}if(!t||!t.ready)return null;for(var n in e.prototype.attachShader.call(this,t,r),t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uSpecularEnvMap"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=4,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uBrdfLut"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uBaseColorTexture"===n?(this.reservedParameters[n]=new C.a,this.hasTexture=!0,this.reservedParameters[n].texUnit=8,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):n.indexOf("m_uMaterial")>=0?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue,this._materialParameters=new Float32Array(ht),this.reservedParameters[n].value=this._materialParameters):"m_uNormalTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=9,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uMetallicRoughnessTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=10,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uEmissiveTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=11,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uOcclusionTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=12,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uDiffuseEnvMap"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=13,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uTransformTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=14,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uTotalLod"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uReflectIntensity"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uTextureOffset"===n?(this._materialTextureOffset=new Float32Array(dt),this.reservedParameters[n]=new C.a,this.reservedParameters[n].value=this._materialTextureOffset,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uTextureScale"===n&&(this._materialTextureScale=new Float32Array(pt),this.reservedParameters[n]=new C.a,this.reservedParameters[n].value=this._materialTextureScale,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return t},t.prototype.equal=function(e){return this._materialParameters[0]===e[0]&&this._materialParameters[0]===e[0]&&this._materialParameters[2]===e[2]&&this._materialParameters[3]===e[3]},t.prototype.hash=function(){var e="",t=this._materialParameters;return e=e+t[0].toString()+t[1].toString()+t[2].toString()+t[3].toString()},t.prototype.getBaseColor=function(){return[this._materialParameters[0],this._materialParameters[1],this._materialParameters[2],this._materialParameters[3]]},t.prototype.setBaseColor=function(e){var t=this._materialParameters;t[0]=e[0],t[1]=e[1],t[2]=e[2],void 0!==e[3]&&(t[3]=e[3])},t.prototype.setEmissive=function(e){var t=this._materialParameters;t[6]=e[0],t[7]=e[1],t[8]=e[2]},t.prototype.setTransparent=function(e){this._materialParameters[3]=e,this.transparent=e<.99},t.prototype.getTransparent=function(){return this._materialParameters[3]},t.prototype.getRoughness=function(){return this._materialParameters[4]},t.prototype.setRoughness=function(e){this._materialParameters[4]=e},t.prototype.getMetallic=function(){return this._materialParameters[5]},t.prototype.setMetallic=function(e){this._materialParameters[5]=e},t.prototype._reCreateTexture=function(e,t,r){var i=this.reservedParameters[t].value,n=i.getFilter(),a=i.getWrap(),o=this._resourceManager.gl.RGB;if(e instanceof HTMLImageElement){var s=new O.a("texture-"+e.src,this._resourceManager);return"png"===(l=e.src.split("."))[l.length-1]&&(o=this._resourceManager.gl.RGBA),i.destroy(),s.createFromImage(e,o,this._resourceManager.gl.UNSIGNED_BYTE,n,a),s}var l,u=new O.a("texture-"+e,this._resourceManager);o=this._resourceManager.gl.RGB;"png"===(l=e.split("."))[l.length-1]&&(o=this._resourceManager.gl.RGBA),u.createFromFile(e,o,n,a,function(){i.destroy(),r(u)})},t.prototype.getBaseColorTexture=function(){return this.reservedParameters.m_uBaseColorTexture?this.reservedParameters.m_uBaseColorTexture.value:null},t.prototype.setBaseColorTexture=function(e){var t=this;this.reservedParameters.m_uBaseColorTexture?e instanceof O.a?this.reservedParameters.m_uBaseColorTexture.value=e:this._reCreateTexture(e,"m_uBaseColorTexture",function(e){t.reservedParameters.m_uBaseColorTexture.value=e}):console.warn("can not set texture for "+this.name)},t.prototype.setNormalTexture=function(e){var t=this;this.reservedParameters.m_uNormalTexture||console.warn("can not set normal texture for "+this.name),e instanceof O.a?this.reservedParameters.m_uNormalTexture.value=e:(e=this._reCreateTexture(e,"m_uNormalTexture",function(e){t.reservedParameters.m_uNormalTexture.value=e}),this.reservedParameters.m_uNormalTexture.value=e)},t.prototype.setEmissiveTexture=function(e){var t=this;this.reservedParameters.m_uEmissiveTexture||console.warn("can not set emissive texture for "+this.name),e instanceof O.a?this.reservedParameters.m_uEmissiveTexture.value=e:(e=this._reCreateTexture(e,"m_uEmissiveTexture",function(e){t.reservedParameters.m_uEmissiveTexture.value=e}),this.reservedParameters.m_uEmissiveTexture.value=e)},t.prototype.setOcclusionTexture=function(e){var t=this;this.reservedParameters.m_uOcclusionTexture||console.warn("can not set occlusion texture for "+this.name),e instanceof O.a?this.reservedParameters.m_uOcclusionTexture.value=e:(e=this._reCreateTexture(e,"m_uOcclusionTexture",function(e){t.reservedParameters.m_uOcclusionTexture.value=e}),this.reservedParameters.m_uOcclusionTexture.value=e)},t.prototype.setMetallicRoughnessTexture=function(e){var t=this;this.reservedParameters.m_uMetallicRoughnessTexture||console.warn("can not set metallic roughness texture for "+this.name),e instanceof O.a?this.reservedParameters.m_uMetallicRoughnessTexture.value=e:(e=this._reCreateTexture(e,"m_uMetallicRoughnessTexture",function(e){t.reservedParameters.m_uMetallicRoughnessTexture.value=e}),this.reservedParameters.m_uMetallicRoughnessTexture.value=e)},t.prototype.setBrdfLut=function(e){this.reservedParameters.m_uBrdfLut.value=e},t.prototype.setEnvironmentMap=function(e){this.reservedParameters.m_uEnvironmentMap.value=e},t.prototype.setSpecularEnvMap=function(e){this.reservedParameters.m_uSpecularEnvMap.value=e;var t=Math.floor(Math.log2(Math.max(e.width,e.height)))+1;this.reservedParameters.m_uTotalLod.value=t},t.prototype.setReflectIntensity=function(e){e<0?console.error("intensity should be greater than 0"):this.reservedParameters.m_uSpecularEnvMap&&this.reservedParameters.m_uSpecularEnvMap.value&&(this._materialParameters[9]=e)},t.prototype.getDiffuseTexture=function(){return this.hasTexture&&this.reservedParameters.m_uDiffuseTexture?this.reservedParameters.m_uDiffuseTexture.value:null},t.prototype.setTextureOffset=function(e){if(this.hasTexture){var t=this._materialTextureOffset;t[0]=e[0],t[1]=e[1],this._setTextureConfigured(!0)}},t.prototype._setTextureConfigured=function(e){this.hasTexture&&(this._materialTextureOffset[2]=e?1:0)},t.prototype.setTextureScale=function(e){if(this.hasTexture){var t=this._materialTextureScale;t[0]=e[0]>0?1/e[0]:t[0],t[1]=e[1]>0?1/e[1]:t[1],this._setTextureConfigured(!0)}},t.prototype.setTextureRotate=function(e){this.hasTexture&&(this._materialTextureScale[2]=e,this._setTextureConfigured(!0))},t.prototype.clone=function(e){var r=new t(e,this._resourceManager);if(this.reservedParameters){for(var i in this.reservedParameters)i.indexOf("m_uMaterial")>=0?(r.reservedParameters[i]=new C.a,r.reservedParameters[i].upload=this.reservedParameters[i].upload,r._materialParameters=new Float32Array(this.reservedParameters[i].value),r.reservedParameters[i].value=r._materialParameters):r.reservedParameters[i]=this.reservedParameters[i];r.transparent=this.transparent}return r},t.prototype.getDiffuse=function(){return this._materialParameters},t}(N.b),_t=function(){return function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.x=e,this.y=t,this.z=r}}(),mt=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.west=e,this.south=t,this.east=r,this.north=i}return e.southwest=function(e,t){return t?(t.x=e.west,t.y=e.south,t.z=0,t):new _t(e.west,e.south)},e.northwest=function(e,t){return t?(t.x=e.west,t.y=e.north,t.z=0,t):new _t(e.west,e.north)},e.northeast=function(e,t){return t?(t.x=e.east,t.y=e.north,t.z=0,t):new _t(e.east,e.north)},e.southeast=function(e,t){return t?(t.x=e.east,t.y=e.south,t.z=0,t):new _t(e.east,e.south)},e.contains=function(e,t){var r=t.x,i=t.y,n=e.west,a=e.east;return a<n&&(a+=2*Math.PI,r<0&&(r+=2*Math.PI)),(r>n||Math.abs(r-n)<1e-14)&&(r<a||Math.abs(r-a)<1e-14)&&i>=e.south&&i<=e.north},e.computeWidth=function(e){return e.east-e.west},e.computeHeight=function(e){return e.north-e.south},e.center=function(e,t){var r=.5*(e.east+e.west),i=.5*(e.south+e.north);return t?(t.x=r,t.x=i,t.z=0,t):new _t(r,i)},e.clone=function(t,r){if(t)return r?(r.west=t.west,r.south=t.south,r.east=t.east,r.north=t.north,r):new e(t.west,t.south,t.east,t.north)},e.MAX_VALUE=new e(-Math.PI,-Math.PI/2,Math.PI,Math.PI/2),e}(),vt=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.toCartesian3=function(){return new _t(this.x,this.y,0)},e}(),yt=function(){function e(){}return Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ellipsoid",{get:function(){return this._ellipsoid},enumerable:!1,configurable:!0}),e}(),gt=function(){function e(e,t,r){this.initialize(this,e,t,r)}return Object.defineProperty(e.prototype,"maximumRadius",{get:function(){return this._maximumRadius},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e,t,r,i){e._radii=new _t(t,r,i),e._radiiSquared=new _t(t*t,r*r,i*i),e._radiiToTheFourth=new _t(t*t*t*t,r*r*r*r,i*i*i*i),e._oneOverRadii=new _t(0===t?0:1/t,0===r?0:1/r,0===i?0:1/i),e._oneOverRadiiSquared=new _t(0===t?0:1/(t*t),0===r?0:1/(r*r),0===i?0:1/(i*i)),e._minimumRadius=Math.min(t,r,i),e._maximumRadius=Math.max(t,r,i),e._centerToleranceSquared=.1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)},e}(),bt=function(){function e(){this._ellipsoid=new gt(6378137,6378137,6356752.314245179)}return Object.defineProperty(e.prototype,"ellipsoid",{get:function(){return this._ellipsoid},enumerable:!1,configurable:!0}),e}(),wt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),xt=function(e){function t(){var t=e.call(this)||this;return t._semimajorAxis=t.ellipsoid.maximumRadius,t._oneOverSemimajorAxis=1/t._semimajorAxis,t}return wt(t,e),t.mercatorAngleToGeodeticLatitude=function(e){return Math.PI/2-2*Math.atan(Math.exp(-e))},t.geodeticLatitudeToMercatorAngle=function(e){e>t.MaximumLatitude?e=t.MaximumLatitude:e<-t.MaximumLatitude&&(e=-t.MaximumLatitude);var r=Math.sin(e);return.5*Math.log((1+r)/(1-r))},t.prototype.project=function(e,r){var i=this._semimajorAxis,n=e.x*i,a=t.geodeticLatitudeToMercatorAngle(e.y)*i,o=e.z;return r?(r.x=n,r.y=a,r.z=o,r):new _t(n,a,o)},t.prototype.unProject=function(e,r){var i=this._oneOverSemimajorAxis,n=e.x*i,a=t.mercatorAngleToGeodeticLatitude(e.y*i),o=e.z;return r?(r.x=n,r.y=a,r.z=o,r):new _t(n,a,o)},t.MaximumLatitude=t.mercatorAngleToGeodeticLatitude(Math.PI),t}(bt),Mt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Et=function(e){function t(){var t=e.call(this)||this;t._numberOfLevelZeroTilesX=1,t._numberOfLevelZeroTilesY=1,t._projection=new xt,t._ellipsoid=t._projection.ellipsoid;var r=t.ellipsoid.maximumRadius*Math.PI;t._rectangleSouthwestInMeters=new vt(-r,-r),t._rectangleNortheastInMeters=new vt(r,r);var i=t._projection.unProject(t._rectangleSouthwestInMeters.toCartesian3()),n=t._projection.unProject(t._rectangleNortheastInMeters.toCartesian3());return t._rectangle=new mt(i.x,i.y,n.x,n.y),t}return Mt(t,e),t.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},t.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},t.prototype.rectangleToNativeRectangle=function(e,t){var r=this._projection,i=r.project(mt.southwest(e)),n=r.project(mt.northeast(e));return t?(t.west=i.x,t.south=i.y,t.east=n.x,t.north=n.y,t):new mt(i.x,i.y,n.x,n.y)},t.prototype.tileXYToNativeRectangle=function(e,t,r,i){var n=this.getNumberOfXTilesAtLevel(r),a=this.getNumberOfYTilesAtLevel(r),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/n,s=this._rectangleSouthwestInMeters.x+e*o,l=this._rectangleSouthwestInMeters.x+(e+1)*o,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/a,c=this._rectangleNortheastInMeters.y-t*u,h=this._rectangleNortheastInMeters.y-(t+1)*u;return i?(i.west=s,i.south=h,i.east=l,i.north=c,i):new mt(s,h,l,c)},t.prototype.tileXYToRectangle=function(e,t,r,i){var n=this.tileXYToNativeRectangle(e,t,r,i),a=this._projection,o=a.unProject(new _t(n.west,n.south)),s=a.unProject(new _t(n.east,n.north));return n.west=o.x,n.south=o.y,n.east=s.x,n.north=s.y,n},t.prototype.positionToTileXY=function(e,t,r){var i=this._rectangle;if(mt.contains(i,e)){var n=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/n,s=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/a,l=this._projection.project(e),u=l.x-this._rectangleSouthwestInMeters.x,c=this._rectangleNortheastInMeters.y-l.y,h=u/o|0;h>=n&&(h=n-1);var d=c/s|0;return d>=a&&(d=a-1),r?(r.x=h,r.y=d,r):new vt(h,d)}},t}(yt);function Tt(){return!0}function St(e,t){function r(){throw new Error(t)}for(var i in void 0===t&&(t="This object was destroyed, i.e., destroy() was called."),e)"function"==typeof e[i]?e[i]=r:e.hasOwnProperty(i)&&(e[i]=null);e.isDestroyed=Tt}var At=new(function(){return function(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=r,this.w=i}}()),Pt=function(){function e(e,t,r,i){this.generator=e,this.x=t,this.y=r,this.level=i,this.ready=!1,this.drawn=!1,this.idString=this.x+"_"+this.y+"_"+this.level,this.image=new Image,this.rectangle=new mt,this.generator.tilingScheme.tileXYToNativeRectangle(t,r,this.level,this.rectangle)}return e.prototype.createTileXYTexture=function(){var e=this.generator.viewer.getResourceManager(),t=document.createElement("canvas");t.setAttribute("width","256px"),t.setAttribute("height","256px");var r=t.getContext("2d");r.fillStyle="white",r.fillRect(0,0,256,256),r.lineWidth=6,r.strokeStyle="blue",r.beginPath(),r.rect(0,0,256,256),r.stroke(),r.fillStyle="red",r.font="24px serif",r.fillText("X: "+this.x,80,90),r.fillText("Y: "+this.y,80,120),r.fillText("LEVEL: "+this.level,70,150);var i=e.getTexture("imagery_"+this.idString),n=e.gl;return i.createFromCanvas(t,n.RGB,n.UNSIGNED_BYTE,n.LINEAR,n.CLAMP_TO_EDGE),i},e.prototype.createDrawable=function(e){var t=this;return void 0===e&&(e=!0),new Promise(function(r,i){var n=t.width=mt.computeWidth(t.rectangle),a=t.height=mt.computeHeight(t.rectangle),o=mt.center(t.rectangle);o.x-=t.generator.centerInProjection.x,o.y-=t.generator.centerInProjection.y;var s=["MODEL_TRANSFORM"];e&&s.push("TILE_LIMIT_RECTANGLE");var l=t.generator.viewer.getResourceManager(),u=t.generator.imageryProvider,c="mapTile_"+u.resource.url+"_"+t.idString,h=l.getShader("mapTile",s);h.ready||h.createFromShaderSource(k.a.map_tile,s);var d=l.getTexture(c),p=l.gl;u.requestImage(t.x,t.y,t.level).then(function(e){var i=e.src.split(".");"png"!==i[i.length-1]&&"svg"!==i[i.length-1]?d.createFromImage(e,p.RGB,p.UNSIGNED_BYTE,p.LINEAR,p.CLAMP_TO_EDGE,!0):d.createFromImage(e,p.RGBA,p.UNSIGNED_BYTE,p.LINEAR,p.CLAMP_TO_EDGE,!0),t.material=new F(c,l),t.material.setSide(N.a.DOUBLESIDE),t.material.attachShader(h,l),t.material.setDiffuse([1,1,1]),t.material.setTransparent(1),t.material.setDiffuseTexture(d),t.setCartographicLimitRectangle(t.generator.extent);var s=l.getMesh(c);s.createQuad(!0,!0);var u=new Float32Array([-1,-1,0,1,1,0]);t.drawable=new D.a(s,h,t.material,null,u);var f=V.b.lengthUnitScale("m");t.drawable.setScaling(n/2*f,a/2*f,1*f),t.drawable.setTranslation(o.x*f,o.y*f,o.z*f),t.ready=!0,r(t)}).catch(function(e){i(e)})})},e.prototype.createPawn=function(){var e=this,t=mt.computeWidth(this.rectangle),r=mt.computeHeight(this.rectangle),i=mt.center(this.rectangle);i.x-=this.generator.centerInProjection.x,i.y-=this.generator.centerInProjection.y;var n=this.generator.imageryProvider,a=this.generator.viewer;return new Promise(function(o,s){e.pawn=new J("mapTile_"+n.resource.url+"_"+e.idString,a.getResourceManager(),a.getMaterialManager()),n.requestImage(e.x,e.y,e.level).then(function(n){e.pawn.createTexturedQuad([n],{flipY:!0}),e.pawn.setScaling(t/2,r/2,1),e.pawn.setTranslation(i.x,i.y,i.z),e.ready=!0,o(e)}).catch(function(e){s(e)})})},e.prototype.render=function(){this.generator.viewer.getRenderScene().addDrawable(this.drawable),this.drawn=!0,this.generator.viewer.invalidate()},e.prototype.setCartographicLimitRectangle=function(e){!function(e,t){if(t.west<t.east)return t;var r=mt.clone(t,kt);mt.center(e,Ot).x>0?r.east=Math.PI:r.west=-Math.PI}(this.rectangle,e);var t=this.rectangle,r=1/this.width,i=1/this.height;At.x=(e.west-t.west)*r,At.y=(e.south-t.south)*i,At.z=(e.east-t.west)*r,At.w=(e.north-t.south)*i;var n=this.material.parameters.u_cartographicLimitRectangle.value;n?(n[0]=At.x,n[1]=At.y,n[2]=At.z,n[3]=At.w):this.material.parameters.u_cartographicLimitRectangle.value=[At.x,At.y,At.z,At.w]},e.prototype.destroy=function(){return this.generator.viewer.getRenderScene().removeDrawable(this.drawable),St(this)},e}(),kt=new mt,Ot=new _t;var Dt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Nt=function(e){function t(t,r){return e.call(this,t,r)||this}return Dt(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!t)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uPlatte"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uData"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture));return i},t.prototype.setPlatteTexture=function(e){this.reservedParameters.m_uPlatte.value=e},t.prototype.setDataTexture=function(e){this.reservedParameters.m_uData.value=e},t}(F),Ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),It=function(e){function t(t,r){return e.call(this,t,r)||this}return Ct(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!t)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uPlatte"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uData"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uForeground"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=7,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture));return i},t.prototype.setForegroundImage=function(e){this.reservedParameters.m_uForeground.value=e},t}(Nt),Rt=function(){function e(e,t){this.needUpdate=!1,this.alwaysUpdate=!0,this.alwaysRenderOnTop=!1,this.name=e+t.getVisualizes(e).length,this._renderScene=t,this._enabled=!1,this._position=[0,0,0],this._scale=[1,1,1],this._quaternion=U.b.create(),this._drawables=[]}return e.prototype.destroy=function(){this._renderScene=null,delete this._renderScene,this._position=null,delete this._position,this._scale=null,delete this._scale;for(var e=0;e<this._drawables.length;e++)this._drawables[e].destroy();this._drawables=null,delete this._drawables},e.prototype.setPosition=function(e){this._position=e;for(var t=0;t<this._drawables.length;t++)this._drawables[t].transform.setTranslation(e[0],e[1],e[2]),this._drawables[t].updateBBox()},e.prototype.setScaling=function(e){this._scale=e;for(var t=0;t<this._drawables.length;t++)this._drawables[t].transform.setScaling(e[0],e[1],e[2]),this._drawables[t].updateBBox()},e.prototype.setRotation=function(e,t){U.b.setAxisAngle(this._quaternion,[e[0],e[1],e[2]],t);for(var r=0;r<this._drawables.length;r++)this._drawables[r].transform.setRotation(e,t),this._drawables[r].updateBBox()},e.prototype.setRotationByQuat=function(e){this._quaternion=e;for(var t=0;t<this._drawables.length;t++)this._drawables[t].transform.setRotationByQuat(e),this._drawables[t].updateBBox()},e.prototype.setEnabled=function(e){this._enabled=e,this._onEnableChanged()},e.prototype._onEnableChanged=function(){},e.prototype.doesSupportMobile=function(e){return!0},e.prototype.doesSupportWebGL1=function(){return!0},e.prototype.isEnabled=function(){return this._enabled},e.prototype.resize=function(e,t){},e.prototype.draw=function(e,t,r,i,n,a,o){void 0===o&&(o=-1)},e.prototype.setParameter=function(e,t){},e.prototype.getParameter=function(e){},e.prototype.getTexture=function(){return null},e.prototype.isNeedUpdate=function(){return this.needUpdate||this.alwaysUpdate},e.prototype.setAlwaysUpdate=function(e){this.alwaysUpdate=e},e.prototype.addEffects=function(){},e.prototype.removeEffects=function(){},e.prototype.isAdded=function(){for(var e=this._renderScene._visualizes,t=0;t<e.length;t++)if(e[t]===this)return!0;return!1},e}(),Bt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Lt=function(e){function t(t){var r=e.call(this,"heatmap",t)||this;return r._resourceManager=t.getResourceManager(),r._dataTexture=r._resourceManager.getTexture(r.name+"-heatmap-density"),r._platteTexture=r._resourceManager.getTexture(r.name+"-heatmap-platte"),r._foregroundTexture=r._resourceManager.getTexture(r.name+"-heatmap-foreground"),r._width=1024,r._height=1024,r._gridSize=32,r._needUpdate=!0,r._showGridLine=!1,r._showPoints=!1,r._enableBlend=!0,r._enableForeground=!1,r._resourceManager.gl.isWebGL2?r._imageData=new Float32Array(r._width*r._height):r._imageData=new Uint8Array(r._width*r._height),r}return Bt(t,e),t.prototype.destroy=function(){this._dataTexture.destroy(),this._dataTexture=null,delete this._dataTexture,this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,this._foregroundTexture.destroy(),this._foregroundTexture=null,delete this._foregroundTexture,this._points=null,delete this._points,this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.setParameter=function(e,t){var r=this._resourceManager.gl;switch(e){case"points":this._points=t;break;case"width":this._width=t;break;case"height":this._height=t;break;case"gridSize":this._gridSize=t;break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,r.RGBA,r.LINEAR,r.CLAMP_TO_EDGE,null);break;case"blend":this._enableBlend=t;break;case"foregroundImage":this._enableForeground=!0,this._foregroundTexture.createFromFile(t,r.RGBA,r.LINEAR,r.CLAMP_TO_EDGE,null)}this._needUpdate=!0},t.prototype._cubic=function(e,t,r,i,n){var a=.5;return(-a*e+1.5*t+(a-2)*r+a*i)*n*n*n+(1*e+(a-3)*t+2*r-a*i)*n*n+(-a*e+a*r)*n+t},t.prototype._sampleImage=function(e,t,r,i,n){return i<0&&(i=0),n<0&&(n=0),i>=t&&(i=t-1),n>=r&&(n=r-1),e[i+t*n]},t.prototype._linear=function(e,t,r){return e*(1-r)+t*r},t.prototype._bilinear=function(e,t,r,i,n){var a=Math.max(e*r-.5,0),o=Math.floor(a),s=a-o,l=Math.max(t*i-.5,0),u=Math.floor(l),c=l-u,h=this._sampleImage(n,r,i,o,u),d=this._sampleImage(n,r,i,o+1,u),p=this._sampleImage(n,r,i,o,u+1),f=this._sampleImage(n,r,i,o+1,u+1),_=this._linear(h,d,s),m=this._linear(p,f,s);return this._linear(_,m,c)},t.prototype._bicubic=function(e,t,r,i,n){var a=Math.max(e*r-.5,0),o=Math.floor(a),s=a-o,l=Math.max(t*i-.5,0),u=Math.floor(l),c=l-u,h=this._sampleImage(n,r,i,o-1,u-1),d=this._sampleImage(n,r,i,o+0,u-1),p=this._sampleImage(n,r,i,o+1,u-1),f=this._sampleImage(n,r,i,o+2,u-1),_=this._sampleImage(n,r,i,o-1,u+0),m=this._sampleImage(n,r,i,o+0,u+0),v=this._sampleImage(n,r,i,o+1,u+0),y=this._sampleImage(n,r,i,o+2,u+0),g=this._sampleImage(n,r,i,o-1,u+1),b=this._sampleImage(n,r,i,o+0,u+1),w=this._sampleImage(n,r,i,o+1,u+1),x=this._sampleImage(n,r,i,o+2,u+1),M=this._sampleImage(n,r,i,o-1,u+2),E=this._sampleImage(n,r,i,o+0,u+2),T=this._sampleImage(n,r,i,o+1,u+2),S=this._sampleImage(n,r,i,o+2,u+2),A=this._cubic(h,d,p,f,s),P=this._cubic(_,m,v,y,s),k=this._cubic(g,b,w,x,s),O=this._cubic(M,E,T,S,s);return this._cubic(A,P,k,O,c)},t.prototype._updateImage=function(){if(this._points){for(var e=this._width/this._gridSize,t=this._height/this._gridSize,r=new Float32Array(e*t),i=1e-6,n=0;n<this._points.length;n++){var a=this._points[n],o=Math.floor(a.x*e),s=r[(d=Math.floor(a.y*t))*e+o];s+=a.number,r[d*e+o]=s,i<s&&(i=s)}for(var l=0;l<this._height;l++)for(var u=0;u<this._width;u++){(s=this._bicubic((u+.5)/this._width,(l+.5)/this._height,e,t,r))<0&&(s=0),s>i&&(s=i),this._resourceManager.gl.isWebGL2?this._imageData[l*this._width+u]=s/i:this._imageData[l*this._width+u]=255*s/i}if(this._showGridLine){for(l=1;l<t;l++)for(var c=l*this._gridSize-1,h=l*this._gridSize+1,d=c;d<=h;d++)for(u=0;u<this._width;u++)this._imageData[d*this._width+u]=1,this._resourceManager.gl.isWebGL2||(this._imageData[d*this._width+u]*=255);for(u=1;u<e;u++)for(c=u*this._gridSize-1,h=u*this._gridSize+1,o=c;o<=h;o++)for(l=0;l<this._height;l++)this._resourceManager.gl.isWebGL2?this._imageData[l*this._width+o]=1:this._imageData[l*this._width+o]=255}if(this._showPoints)for(n=0;n<this._points.length;n++)for(a=this._points[n],u=Math.floor(a.x*this._width),l=Math.floor(a.y*this._height),o=u-1;o<=u+1;o++)for(d=l-1;d<=l+1;d++)this._resourceManager.gl.isWebGL2?this._imageData[d*this._width+o]=1:this._imageData[d*this._width+o]=255;var p=this._resourceManager.gl;this._dataTexture.ready||(p.isWebGL2?this._dataTexture.create(this._width,this._height,p.R32F,p.LINEAR,p.CLAMP_TO_EDGE):this._dataTexture.create(this._width,this._height,p.ALPHA,p.LINEAR,p.CLAMP_TO_EDGE)),this._dataTexture.resize(this._width,this._height),this._dataTexture.update(this._imageData);var f=["MODEL_TRANSFORM"];this._enableBlend||f.push("DISABLE_BLEND"),this._enableForeground&&f.push("ENABLE_FOREGROUND");var _=this._resourceManager.getShader("heatmap",f);if(!_.ready){var m=k.a.heatmap;if(_.createFromShaderSource(m,f),!_.ready)throw new Error("Error at creating shader 'heatmap'!")}if(this._drawables.length<1){var v=this._resourceManager.getMesh("heatmap");v.ready||v.createQuad(!0);var y=new It("HeatMap",this._resourceManager);y.attachShader(_,this._resourceManager);var g=new D.a(v,_,y,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]));this._drawables.push(g),this.setPosition(this._position),this.setScaling(this._scale)}}},t.prototype.getTexture=function(){return this._needUpdate&&(this._updateImage(),this._needUpdate=!1),this._dataTexture},t.prototype.getImageData=function(){if(this._needUpdate&&(this._updateImage(),this._needUpdate=!0),this._imageData instanceof Float32Array)return this._imageData;for(var e=new Float32Array(this._imageData.length),t=0;t<this._imageData.length;t++)e[t]=this._imageData[t]/255;return e},t.prototype.draw=function(e,t,r,i,n,a,o){if(void 0===o&&(o=-1),this._enabled)if(this.getTexture(),this._platteTexture.ready&&this._dataTexture.ready){var s=this._drawables[0].material;s.setPlatteTexture(this._platteTexture),s.setDataTexture(this._dataTexture),this._enableForeground&&s.setForegroundImage(this._foregroundTexture),a.setOption("blend",!0),e.drawDrawables(a,this._drawables,t,null,null,r,i,n,null,!1),a.setOption("blend",!1)}else console.warn("cannot visualize heatmap without necessary data!")},t}(Rt),Ft=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ut=function(e){function t(t){var r=e.call(this,"HeightMap",t)||this;return r._xres=1024,r._yres=1024,r._resourceManager=t.getResourceManager(),r._dataTexture=null,r._platteTexture=r._resourceManager.getTexture(r.name+"-HeightMap-platte"),r}return Ft(t,e),t.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,delete this._xres,delete this._yres,this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,e.prototype.destroy.call(this)},t.prototype._initialize=function(){return!0},t.prototype.setParameter=function(e,t){var r=!1,i=this._resourceManager.gl;switch(e){case"xres":this._xres=t,r=!0;break;case"yres":this._yres=t,r=!0;break;case"dataTexture":this._dataTexture=t;break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,null)}r&&this._updateGeometry()},t.prototype._updateGeometry=function(){var e=this._resourceManager.getMesh("HeightMap");if(e.ready&&(e.destroy(),e=this._resourceManager.getMesh("HeightMap")),e.createGrid(this._xres,this._yres),this._drawables.length<1){var t=this._resourceManager.getShader("heightmap",["MODEL_TRANSFORM"]);if(!t.ready){var r=k.a.heightmap;if(t.createFromShaderSource(r,["MODEL_TRANSFORM"]),!t.ready)throw new Error("Error at creating shader 'heightmap'!")}var i=new Nt("HeightMap",this._resourceManager);i.attachShader(t,this._resourceManager);var n=new D.a(e,t,i,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]));this._drawables.push(n),this.setPosition(this._position),this.setScaling(this._scale)}else this._drawables[0].mesh=e},t.prototype.draw=function(e,t,r,i,n,a,o){if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready&&this._dataTexture.ready){if(this._drawables.length>0){var s=this._drawables[0].material;s.setPlatteTexture(this._platteTexture),s.setDataTexture(this._dataTexture),a.setOption("blend",!0);this._resourceManager.gl;e.drawDrawables(a,this._drawables,t,null,null,r,i,n,null,!1),a.setOption("blend",!1)}}else console.warn("cannot visualize height map without necessary data!")},t}(Rt),Vt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},jt=function(){function e(e,t,r,i,n,a,o){void 0===i&&(i=1e3),void 0===n&&(n=1e3),void 0===o&&(o=40),this.enabled=!0,this._mapTiles=[],this.level=t,this.centerInCartographic=r,this.width=i,this.height=n,this.viewer=a,this.imageryProvider=e,this.tilingScheme=new Et,this.projection=this.tilingScheme.projection,this.centerInProjection=this.tilingScheme.projection.project(r);var s=this.centerInProjection.x-i/2,l=this.centerInProjection.y-n/2,u=this.centerInProjection.x+i/2,c=this.centerInProjection.y+n/2;this.extent=new mt(s,l,u,c);var h=this.tilingScheme.projection.unProject(new _t(s,c));this.leftUpXY=this.tilingScheme.positionToTileXY(h,t);var d=this.tilingScheme.projection.unProject(new _t(u,l));this.extentInCartographic=new mt(h.x,d.y,d.x,h.y),this.rightDownXY=this.tilingScheme.positionToTileXY(d,t),this._maximumTilesNumber=o;var p=V.b.lengthUnitScale("m");this.bbox=new Float32Array([-i/2*p,-n/2*p,-1*p,i/2*p,n/2*p,1*p]),this.viewer.getScene().core.updateBBox(this.bbox,!1)}return Object.defineProperty(e.prototype,"mapTiles",{get:function(){return this._mapTiles},enumerable:!1,configurable:!0}),e.prototype.preValidate=function(){return!((this.rightDownXY.x-this.leftUpXY.x+1)*(this.rightDownXY.y-this.leftUpXY.y+1)>this._maximumTilesNumber)||(console.warn(""+this._maximumTilesNumber+"level"),this.enabled=!1,!1)},e.prototype.generateMapTiles=function(){var e=this,t=[];if(this.preValidate(),this.enabled){for(var r=this.leftUpXY.x;r<=this.rightDownXY.x;r++)for(var i=this.leftUpXY.y;i<=this.rightDownXY.y;i++){var n=new Pt(this,r,i,this.level),a=n.createDrawable();a.then(function(e){e.render()}),this._mapTiles.push(n),t.push(a)}return Promise.all(t).then(function(){return Promise.resolve(e)})}return Promise.reject(", level")},e.prototype.cartographicToSceneCoordinate=function(e,t,r){void 0===r&&(r=0);var i=this.projection.project(new _t(e,t,r)),n=this.centerInProjection,a=n.x,o=n.y,s=n.z,l=[i.x-a,i.y-o,i.z-s];return l.forEach(function(e,t){return l[t]=e*V.b.lengthUnitScale("m")}),l},e.prototype.sceneCoordinateToCartographic=function(e,t,r){void 0===r&&(r=0);var i=this.centerInProjection.x,n=this.centerInProjection.y,a=this.centerInProjection.z,o=V.b.lengthUnitScale("m"),s=this.projection.unProject(new _t(i+e/o,n+t/o,a+r/o));return[s.x,s.y,s.z]},e.prototype.generateGeoHeightMap=function(e,t){var r=this,i=1e4,n=1e4,a=-1e4,o=-1e4,s=[];e.forEach(function(e){var t=r.cartographicToSceneCoordinate(e.longitude/180*Math.PI,e.latitude/180*Math.PI,0);t[0]<i&&(i=t[0]),t[0]>a&&(a=t[0]),t[1]<n&&(n=t[1]),t[1]>o&&(o=t[1]),s.push(t)});for(var l=[],u=0;u<s.length;u++)l[u]={},l[u].x=(s[u][0]-i)/(a-i),l[u].y=(s[u][1]-n)/(o-n),l[u].number=e[u].value;var c=new Lt(this.viewer.getRenderScene());c.setParameter("points",l);var h=a-i,d=o-n,p=(a+i)/2,f=(o+n)/2,_=new Ut(this.viewer.getRenderScene());if(t){if(_.setParameter("xres",t.xres||1024),_.setParameter("yres",t.yres||1024),t.paletteImage?_.setParameter("paletteImage",t.paletteImage):t.platteImage&&_.setParameter("platteImage",t.paletteImage),t.resolution){var m=Vt(t.resolution,3),v=m[0],y=m[1],g=m[2];c.setParameter("width",v||1024),c.setParameter("height",y||1024),c.setParameter("gridSize",g||32)}_.setScaling([h/2,d/2,t.zScale?t.zScale:1]),_.setPosition([p,f,t.height?t.height:1])}else _.setParameter("xres",1024),_.setParameter("yres",1024),_.setScaling([h/2,d/2,1]),_.setPosition([p,f,1]);return _.setParameter("dataTexture",c.getTexture()),_.setEnabled(!0),_},e.prototype.destroy=function(){return this.mapTiles.forEach(function(e){e.destroy()}),St(this)},e}(),zt=function(){return(zt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Gt=function(){function e(e){this._retryCount=0,this._retryAttempts=0,this._url=e.url,this._queryParameters=e.queryParameters?e.queryParameters:{},this._templateValues=e.templateValues?e.templateValues:{}}return Object.defineProperty(e.prototype,"url",{get:function(){return this.getUrlComponent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"queryParameters",{get:function(){return this._queryParameters},enumerable:!1,configurable:!0}),e.prototype.fetchImage=function(e){var t=this;return void 0===e&&(e=!0),new Promise(function(r,i){!function(e,t,r,i){void 0===t&&(t=!0);var n=new Image;n.onload=function(){r&&r(n)},n.onerror=function(e){i&&i(e)},t&&(n.crossOrigin="");n.src=e}(t.url,e,r,i)})},e.prototype.getDerived=function(t){var r=new e({url:this.url,queryParameters:zt(zt({},this._queryParameters),t.queryParameters),templateValues:zt(zt({},this._templateValues),t.templateValues)});return r._retryCount=this._retryCount,r},e.prototype.getUrlComponent=function(){var e=this._url.replace(/%7B/g,"{").replace(/%7D/g,"}"),t=this._templateValues;return e=e.replace(/{(.*?)}/g,function(e,r){var i=t[r];return i?encodeURIComponent(i):e})},e.fetchImage=function(t,r){return void 0===r&&(r=!0),new e({url:t}).fetchImage(r)},e}();var Ht=function(){return(Ht=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},qt=/{[^}]+}/g,Wt={x:function(e,t,r,i){return Yt(e,"{x}",t)},y:function(e,t,r,i){return Yt(e,"{y}",r)},z:function(e,t,r,i){return Yt(e,"{z}",i)},s:function(e,t,r,i){var n=(t+r+i)%e.subdomains.length;return e.subdomains[n]},reverseX:function(e,t,r,i){var n=e.tilingScheme.getNumberOfXTilesAtLevel(i)-t-1;return Yt(e,"{reverseX}",n)},reverseY:function(e,t,r,i){var n=e.tilingScheme.getNumberOfYTilesAtLevel(i)-r-1;return Yt(e,"{reverseY}",n)},reverseZ:function(e,t,r,i){var n=e.maximumLevel;return Yt(e,"{reverseZ}",n&&i<n?n-i-1:i)}},Qt=function(){function e(e){this._resource=new Gt({url:e.url}),this._tilingScheme=e.tilingScheme?e.tilingScheme:new Et,this._tags=e.customTags?Ht(Ht({},Wt),e.customTags):Wt,this._maximumLevel=e.maximumLevel,Array.isArray(e.subdomains)?this._subdomains=e.subdomains.slice():void 0!==e.subdomains&&e.subdomains.length>0?this._subdomains=e.subdomains.split(""):this._subdomains=["a","b","c"]}return Object.defineProperty(e.prototype,"tilingScheme",{get:function(){return this._tilingScheme},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximumLevel",{get:function(){return this._maximumLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subdomains",{get:function(){return this._subdomains},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resource",{get:function(){return this._resource},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this._tags},enumerable:!1,configurable:!0}),e.prototype.requestImage=function(e,t,r){return function(e,t,r,i){var n=e.resource,a=n.getUrlComponent(),o=e.tags,s={},l=a.match(qt);l&&l.forEach(function(n){var a=n.substring(1,n.length-1);o[a]&&(s[a]=o[a](e,t,r,i))});return n.getDerived({templateValues:s})}(this,e,t,r).fetchImage()},e}();function Yt(e,t,r){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){var i=e.urlSchemeZeroPadding[t];if("string"==typeof i){var n=i.length;n>1&&(r=r.length>=n?r:new Array(n-r.toString().length+1).join("0")+r)}}return r}var Xt,Zt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Kt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Jt=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Kt(arguments[t]));return e},$t=new Float32Array([1e10,1e10,1e10,-1e10,-1e10,-1e10]),er=function(){function e(e,t){this._exposure=1,this._faces=2,this._lights=[],this.models={},this.pawns={},this.shapes={},this.maps=[],this.text3Ds=[],this.pawnInfo={},this.background=new lt(e),this.compressed=!1,this.materialManager=t,this.bbox=P.a.aabb.create(),this.originBox=P.a.aabb.create(),this.modelsBox=P.a.aabb.create(),this.scale=1,this.radius=1.732,this.hasCurveOrLine=!1,this.hasProfileLines=!1,this.isBimCullingNeeded=!1,this.visible=!0,this._lights[0]=new at,this.clipping=new ot(this)}return e.prototype.dump=function(){var e,t,r,i;console.groupCollapsed("Scene"),console.groupCollapsed("models: "+Object.keys(this.models).length);try{for(var n=Zt(Object.entries(this.models)),a=n.next();!a.done;a=n.next()){var o=Kt(a.value,2),s=o[0],l=o[1];console.log(s+": ",l)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}console.groupEnd(),console.groupCollapsed("pawns: "+Object.keys(this.pawns).length);try{for(var u=Zt(Object.entries(this.pawns)),c=u.next();!c.done;c=u.next()){var h=Kt(c.value,2),d=h[0],p=h[1];console.log(d+": ",p)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}console.groupEnd(),console.log("bbbox: "+this.bbox),console.log("scale: "+this.scale),console.log("radius: "+this.radius),console.log("clipping: ",this.clipping),console.log("compressed: "+this.compressed),console.log("_needRenderDoubleSided: "+this._needRenderDoubleSided),console.log("_exposure: "+this._exposure),console.groupEnd()},e.prototype.destroy=function(){for(var e in this.background&&this.background.destroy(),this.background=null,delete this.background,this.models)this.models[e].destroy();for(var t in this.models=null,delete this.models,this.pawns)this.pawns[t].destroy();for(var r in this.shapes)this.shapes[r].destroy();this.pawns=null,delete this.pawns,this.shapes=null,delete this.shapes,this.bbox=null,this.models=null,this.originBox=null,this._lights=null,this.clipping=null},e.prototype.updateBBox=function(e,t){var r,i,n;if(t=!0===t,e)P.a.aabb.union(this.bbox,this.bbox,e),n=this.bbox,t&&P.a.aabb.union(this.modelsBox,this.modelsBox,e);else{for(var a in n=P.a.aabb.create(),this.modelsBox=P.a.aabb.create(),this.models){var o=this.models[a];o.updateBBox(),P.a.aabb.union(n,n,o.bbox),P.a.aabb.union(this.modelsBox,this.modelsBox,o.bbox)}for(var s in this.pawns){var l=this.pawns[s];l.updateBBox(),P.a.aabb.union(n,n,l.bbox)}for(var u in this.shapes){var c=this.shapes[u];c.bbox&&P.a.aabb.union(n,n,c.bbox)}try{for(var h=Zt(this.maps),d=h.next();!d.done;d=h.next()){var p=d.value;P.a.aabb.union(n,n,p.bbox)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}this.setBBox(n,t)},e.prototype.setLightingIntensity=function(e){this._lights[0].setIntensity(e)},e.prototype.setSpecularShinness=function(e){this._lights[0].setSpecularShinness(e)},e.prototype.setLightingLatitude=function(e){this._lights[0].setLatitude(e)},e.prototype.setLightingLongitude=function(e){this._lights[0].setLongitude(e)},e.prototype.setMainLight=function(e){this._lights[0]=e},e.prototype.getMainLight=function(){return this._lights[0]},e.prototype.setlightZRotation=function(e){this._lights[0].setZRotation(e)},e.prototype._isInfinityBBox=function(e){return e.some(function(e){return e===1/0||e===-1/0})},e.prototype.setBBox=function(e,t){if(!this._isInfinityBBox(e)){this.bbox=P.a.aabb.createFromArray(e),P.a.aabb.expand(this.bbox);var r=P.a.aabb.size(this.bbox);this.scale=.5*Math.max(r.width,Math.max(r.height,r.depth)),this.radius=.5*P.a.aabb.len(this.bbox),t&&this.clipping.initialize(this.bbox)}},e.prototype.setElementsVisibility=function(e,t,r){void 0!==r&&null!==r||(r=t);for(var i=[],n=0,a=e.length;n<a;n++){var o=e[n],s=o.split("+")[0],l=this.models[s].tree.elements[o];if(l){var u=l.getNodes();i.push.apply(i,Jt(u))}}for(var c=new Set,h=0;h<i.length;h++){var d=i[h];d.setVisibility(d.drawable.mesh.isLine()?r:t),c.add(d.drawable)}c.forEach(function(e){e.updateVisibility(!0,!0)})},e.prototype.isElementVisible=function(e){var t=e.split("+")[0],r=this.models[t].tree.elements[e];return!!r&&r.getNodes()[0].isVisible()},e.prototype.getElementBBox=function(e){var t=e.split("+")[0],r=this.models[t].tree.elements[e];return r?r.bbox:$t},e.prototype.getElementMaterials=function(e){var t=e.split("+")[0],r=this.models[t].tree.elements[e];if(r){var i=new Set;return r.getNodes().forEach(function(e){i.has(e.drawable.material)||i.add(e.drawable.material)}),Array.from(i)}},e.prototype.getElementMaterialNames=function(e){var t=e.split("+")[0],r=this.models[t].tree.elements[e];if(r){var i=new Set;return r.getNodes().forEach(function(e){e.drawable.mesh.isLine()||i.has(e.drawable.material.name)||i.add(e.drawable.material.name)}),Array.from(i)}},e.prototype.getPawnMaterialNames=function(e){var t=new Set;return e.drawables.forEach(function(e){e.mesh.isLine()||t.has(e.material.name)||t.add(e.material.name)}),Array.from(t)},e.prototype.getPawn=function(e){return this.pawns.hasOwnProperty(e)?this.pawns[e]:null},e.prototype.getMaterialType=function(e){var t=this.materialManager.getMaterial(e);if(t)return t instanceof F?"MaterialAdhoc":t instanceof ft?"MaterialPbr":void 0;console.warn("no material named "+e+" found!")},e.prototype.getModelMaterialNames=function(){var e={};for(var t in this.models)e[t]=[],this.models[t].materialDrawablesMap.forEach(function(r,i){for(var n=!1,a=0;a<r.length;a++)if(r[a].mesh.isLine()){n=!0;break}n||e[t].push(i)});return e},e.prototype.getAllDrawables=function(){var e=[];for(var t in this.models)e.push.apply(e,Jt(this.models[t].drawables));return e},e.prototype.getAllDrawablesWithoutLines=function(){var e=[];for(var t in this.models)e.push.apply(e,Jt(this.models[t].drawables.filter(function(e){return!e.mesh.isLine()})));for(var t in this.shapes)e.push(this.shapes[t]);for(var t in this.pawns)e.push.apply(e,Jt(this.pawns[t].drawables));return e},e.prototype.getDrawablesByMaterialName=function(e){var t=[];for(var r in this.models){var i=this.models[r].materialDrawablesMap;i.has(e)&&t.push.apply(t,Jt(i.get(e)))}return t},e.prototype.getElementNamesByMaterialName=function(e){var t=[];for(var r in this.models)if(this.models[r].materialDrawablesMap.has(e))return this.models[r].materialDrawablesMap.get(e).forEach(function(e){e.mesh.isLine()||e.nodes.forEach(function(e){var i=e.getElement(),n=r+"+"+i.getDocument().id+"/"+i.id;t.push(n)})}),t;return console.warn("no material named "+e+"was found!"),null},e.prototype.getMaterialParameter=function(e,t){var r=this.materialManager.getMaterial(e);switch(t){case"color":if(r instanceof F)return r.getDiffuse();if(r instanceof ft)return r.getBaseColor();break;case"colorTexture":var i=null;return r instanceof F?i=r.getDiffuseTexture():r instanceof ft&&(i=r.getBaseColorTexture()),i?i.url:null;case"opacity":if(r instanceof F||r instanceof ft)return r.getTransparent();break;case"roughness":if(r instanceof ft)return r.getRoughness();break;case"metallic":if(r instanceof ft)return r.getMetallic()}console.warn("parameter name "+t+" does not exist in material: "+e)},e.prototype.setMaterialParameter=function(e,t,r){var i=this.materialManager.getMaterial(e);switch(t){case"color":i instanceof F?i.setDiffuse(r):i instanceof ft?i.setBaseColor(r):console.warn("material "+e+" should be MaterialAhoc or MaterialPbr!");break;case"opacity":i instanceof F||i instanceof ft?i.setTransparent(r):console.warn("material "+e+" should be MaterialAhoc or MaterialPbr!");break;case"colorTexture":for(var n=this.getDrawablesByMaterialName(i.name),a=0;a<n.length;a++)if(!n[a].mesh.attributes.hasUV)return void console.warn("A drawable using this material doesn't has uv coord.");for(a=0;a<n.length;a++)n[a].recompileShader("HAS_BASECOLORMAP",!0);null===r&&(r=i.originTextureUrl),i instanceof F?i.setDiffuseTexture(r):i instanceof ft?i.setBaseColorTexture(r):console.warn("material "+e+" should be MaterialAhoc or MaterialPbr!");break;case"roughness":i instanceof ft?i.setRoughness(r):console.warn("material "+e+" should be MaterialPbr!");break;case"metallic":i instanceof ft?i.setMetallic(r):console.warn("material "+e+" should be MaterialPbr!");break;case"metallicRoughnessTexture":for(n=this.getDrawablesByMaterialName(i.name),a=0;a<n.length;a++)if(!n[a].mesh.attributes.hasUV)return void console.warn("A drawable using this material doesn't has uv coord.");for(a=0;a<n.length;a++)n[a].recompileShader("HAS_METALROUGHNESSMAP",!0);i instanceof ft?i.setMetallicRoughnessTexture(r):console.warn("material "+e+" should be MaterialPbr");break;case"emissiveTexture":for(n=this.getDrawablesByMaterialName(i.name),a=0;a<n.length;a++)if(!n[a].mesh.attributes.hasUV)return void console.warn("A drawable using this material doesn't has uv coord.");for(a=0;a<n.length;a++)n[a].recompileShader("HAS_EMISSIVEMAP",!0);i instanceof ft?i.setEmissiveTexture(r):console.warn("material "+e+" should be MaterialPbr");break;case"normalTexture":for(n=this.getDrawablesByMaterialName(i.name),a=0;a<n.length;a++)if(!n[a].mesh.attributes.hasUV)return void console.warn("A drawable using this material doesn't has uv coord.");for(a=0;a<n.length;a++)n[a].recompileShader("HAS_NORMALMAP",!0);i instanceof ft?i.setNormalTexture(r):console.warn("material "+e+" should be MaterialPbr");break;case"reflectionIntensity":i instanceof ft?i.setReflectIntensity(r):console.warn("Material type is not MaterialPbr;")}},e.prototype.getElementsBBox=function(e){var t=this,r=P.a.aabb.createFromArray([1/0,1/0,1/0,-1/0,-1/0,-1/0]);return e.forEach(function(e){var i=e.split("+")[0],n=t.models[i];if(n){var a=n.tree.elements[e];a&&P.a.aabb.union(r,r,a.bbox)}}),r},e.prototype.getElements=function(e,t){void 0===e&&(e=ut.a.ANY),void 0===t&&(t=!1);var r=[];for(var i in this.models){var n=this.models[i];for(var a in n.tree.elements){var o=n.tree.elements[a];e===ut.a.ANY?r.push(o):o.etype!==e||t?o.etype!==e&&t&&r.push(o):r.push(o)}}return r},e.prototype.getElementsNames=function(e,t){void 0===e&&(e=ut.a.ANY),void 0===t&&(t=!1);var r=[];for(var i in this.models){var n=this.models[i];for(var a in n.tree.elements){var o=n.tree.elements[a];e===ut.a.ANY?r.push(a):o.etype!==e||t?o.etype!==e&&t&&r.push(a):r.push(a)}}return r},e.prototype.setNodesColor=function(e,t,r){var i=this,n=new Map;e.forEach(function(e){var t,a=!e.material.transparent&&r[3]&&r[3]<.99?r[3]:1;if(e.isSingleton())return e.originalMaterial=null!==(t=e.originalMaterial)&&void 0!==t?t:e.material.clone(),e.material.setDiffuse(r),void e.material.setTransparent(a);var o=i.materialManager.addCustomColor([r[0],r[1],r[2],a]);i.materialManager.upload(),n.set(e,o)}),t.forEach(function(e){var t=e.drawable;t.isLine()||t.isSingleton()||e.setColorIndex(n.get(t))}),e.forEach(function(e){return e.updateColor()})},e.prototype.clearNodesColor=function(e){e.forEach(function(e){var t;e.isSingleton()?e.material=null!==(t=e.originalMaterial)&&void 0!==t?t:e.material:(e.nodes.forEach(function(e){return e.revertColor()}),e.updateColor())})},e.prototype.setElementsColor=function(e,t){var r=this._getDrawablesOfElements(e),i=this._getNodesOfElements(e);t?this._changeMatrialColorOfDrawables(r,t,i):this._revertMaterialColorOfDrawables(r,i)},e.prototype._getDrawablesOfElements=function(e){var t,r,i,n=new Array;try{for(var a=Zt(e),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.split("+")[0],u=null===(i=this.models[l])||void 0===i?void 0:i.tree.elements[s];u&&u.getNodes().forEach(function(e){var t=e.drawable;n.includes(t)||n.push(t)})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n},e.prototype._getNodesOfElements=function(e){var t,r,i,n=new Array;try{for(var a=Zt(e),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.split("+")[0],u=null===(i=this.models[l])||void 0===i?void 0:i.tree.elements[s];u&&n.push.apply(n,Jt(u.getNodes()))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n},e.prototype._revertMaterialColorOfDrawables=function(e,t){e.forEach(function(e){if(1!==e.nodes.length)e.nodes.forEach(function(e){t.includes(e)&&e.revertColor()}),e.updateColor();else{e.material.setDiffuse(e.originalMaterial.getDiffuse()),e.material.setTransparent(e.originalMaterial.getTransparent());var r=e.nodes[0].clonedDrawable;r&&(r.material.setDiffuse(r.originalMaterial.getDiffuse()),r.material.setTransparent(r.originalMaterial.getTransparent()))}})},e.prototype._changeMatrialColorOfDrawables=function(e,t,r){var i=this;e.forEach(function(e){var n,a,o,s,l=!e.material.transparent&&t[3]&&t[3]<.99?t[3]:1;if(1!==e.nodes.length){var u=i.materialManager.addCustomColor([t[0],t[1],t[2],l]);if(u>=127)console.warn("color count out of index");else{i.materialManager.upload();try{for(var c=Zt(e.nodes),h=c.next();!h.done;h=c.next()){var d=h.value;r.includes(d)&&d.setColorIndex(u)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}e.updateColor()}}else{e.originalMaterial=null!==(o=e.originalMaterial)&&void 0!==o?o:e.material.clone(),e.material.setDiffuse(t),e.material.setTransparent(l);var p=e.nodes[0].clonedDrawable;p&&(p.originalMaterial=null!==(s=p.originalMaterial)&&void 0!==s?s:p.material.clone(),p.material.setDiffuse(t),p.material.setTransparent(l))}})},e.prototype.setModelVisibility=function(e,t,r){void 0!==r&&null!==r||(r=t);var i=this.models[e];i?this.setElementsVisibility(Object.keys(i.tree.elements),t,r):console.warn("no model named "+i+" is found.")},e.prototype.addPawn=function(e){this.pawns[e.name]=e,this.updateBBox(e.bbox,!1)},e.prototype.addShape=function(e){this.shapes[e.name]=e,e.bbox&&this.updateBBox(e.bbox,!1)},e.prototype.addMap=function(e,t){var r=new Qt(e.imageryProviderOptions),i=new jt(r,e.level,new _t(e.centerLongitude*Math.PI/180,e.centerLatitude*Math.PI/180,0),e.width,e.height,t,e.maximumTilesNumber);return this.maps.push(i),i.generateMapTiles()},e.prototype.removeMap=function(e){var t=this.maps.indexOf(e);-1!==t?(e.destroy(),this.maps.splice(t,1)):console.warn("Map is not found!")},e.prototype.addModel=function(e){this.models[e.name]?console.error("can not load same model twice: "+e.name+"!"):(this.models[e.name]=e,this.updateBBox(e.bbox,!0))},e.prototype.removeModel=function(e,t){void 0===t&&(t=!1),this.models.hasOwnProperty(e.name)&&(delete this.models[e.name],t&&e.destroy(),e.state=H.UNLOADED,this.updateBBox())},e.prototype.removePawn=function(e){this.pawns.hasOwnProperty(e.name)&&(delete this.pawns[e.name],this.updateBBox())},e.prototype.removeShape=function(e){e.isDestroy||this.shapes.hasOwnProperty(e.name)&&(delete this.shapes[e.name],this.updateBBox())},e.prototype.addText3D=function(e){this.text3Ds.push(e),this.updateBBox()},e.prototype.removeText3D=function(e){var t=this.text3Ds.indexOf(e);-1!==t?(this.text3Ds.splice(t,1),this.updateBBox()):console.warn("text3D is not found!")},e.prototype.needRenderDoubleSided=function(){for(var e in this._faces=2,this.models)this._faces=Math.min(this.models[e].faces,this._faces);return this._needRenderDoubleSided=this._faces<1||this._faces<=1&&this.clipping.isEnabled(),this._needRenderDoubleSided},e.prototype.setRenderDoubleSided=function(e){this._needRenderDoubleSided=e},e.prototype.hasContours=function(){for(var e in this.models)if(this.models[e].hasContours)return!0;return!1},e.prototype.setReflectionMap=function(e){if(e)for(var t in this.models){this.models[t].drawables.forEach(function(t){t.mesh.isLine()||(t.recompileShader("SPECULAR_ENV_MAP",!0),t.material.setSpecularEnvMap(e))})}else for(var t in this.models){this.models[t].drawables.forEach(function(e){e.mesh.isLine()||e.recompileShader("SPECULAR_ENV_MAP",!1)})}},e.prototype.setTempPawn=function(e){this.pawnInfo[e.popUrl]||(this.pawnInfo[e.popUrl]=e)},e.prototype.setToneMappingEnabled=function(e){var t=this;for(var r in this.models){this.models[r].drawables.forEach(function(r){r.recompileShader("TONE_MAPPING",e),e&&(r.material.parameters.uExposure.value=t._exposure)})}this.background&&this.background.skybox&&(this.background.skybox.recompileShader("TONE_MAPPING",e),e&&(this.background.skybox.material.parameters.uExposure.value=this._exposure))},e.prototype.setToneMappingExposure=function(e){var t=this;for(var r in this._exposure=e,this.models){this.models[r].drawables.forEach(function(e){e.material.parameters.uExposure&&(e.material.parameters.uExposure.value=t._exposure)})}this.background&&this.background.skybox&&this.background.skybox.material.parameters.uExposure&&(this.background.skybox.material.parameters.uExposure.value=this._exposure)},e.prototype.setCompressedenable=function(e){this.compressed=e},e.prototype.getOriginModelBox=function(){for(var e in this.models){var t=this.models[e];P.a.aabb.union(this.originBox,this.originBox,t.originBBox)}return this.originBox},e.prototype.getModelBox=function(){return this.modelsBox},e.prototype.getSceneBox=function(){return this.bbox},e.prototype.getModel=function(e){return this.models[e]},e.prototype.setActiveView=function(e){},e.prototype.getFaces=function(){return this._faces},e.prototype.initBimCullingNeeded=function(){if(!(this.nodes<=1e5&&this.meshKbytes<=1e5))for(var e in this.models)this.models[e]&&(this.isBimCullingNeeded=this.isBimCullingNeeded||this.models[e].isBimCullingNeeded)},e.prototype.setVisibility=function(e){this.visible=e},e.prototype.getVisibility=function(){return this.visible},e}(),tr=function(){function e(e){}return e.prototype.destroy=function(){},e}(),rr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ir=function(e){function t(t,r){var i=e.call(this,t)||this;return i.core=new er(t.getResourceManager(),r),i.cores=[],i.cores.push(i.core),i._viewer=t,i}return rr(t,e),t.prototype.destroy=function(){for(var t=0;t<this.cores.length;t++)this.cores[t].destroy();this.cores=null,delete this.cores,this.core=null,delete this.core,e.prototype.destroy.call(this)},t.prototype.setElementsColor=function(e,t){this.core.setElementsColor(e,t),this._viewer.invalidate()},t.prototype.setElementsVisibility=function(e,t,r){this.core.setElementsVisibility(e,t,r),this._viewer.invalidate()},t.prototype.isElementVisible=function(e){return this.core.isElementVisible(e)},t.prototype.getElementsNames=function(e,t){return void 0===e&&(e=ut.a.ANY),void 0===t&&(t=!1),this.core.getElementsNames(e,t)},t.prototype.getElementsBBox=function(e){return this.core.getElementsBBox(e)},t.prototype.getElementBBox=function(e){return this.core.getElementBBox(e)},t.prototype.getElementMaterials=function(e){return this.core.getElementMaterials(e)},t.prototype.getElementMaterialNames=function(e){return this.core.getElementMaterialNames(e)},t.prototype.getPawnMaterialNames=function(e){return this.core.getPawnMaterialNames(e)},t.prototype.getMaterialType=function(e){return this.core.getMaterialType(e)},t.prototype.getModelMaterialNames=function(){return this.core.getModelMaterialNames()},t.prototype.getElementNamesByMaterialName=function(e){return this.core.getElementNamesByMaterialName(e)},t.prototype.getMaterialParameter=function(e,t){return this.core.getMaterialParameter(e,t)},t.prototype.setMaterialParameter=function(e,t,r){return this.core.setMaterialParameter(e,t,r)},t.prototype.setModelVisibility=function(e,t,r){this.core.setModelVisibility(e,t,r),this._viewer.invalidate()},t.prototype.getElementGuid=function(e){var t=e.split("+")[0],r=this.core.models[t].tree.elements[e];return void 0===r?(console.warn("elementName: "+e+" not found!"),null):r.guid},t.prototype.getElementNameByGuid=function(e){var t;for(var r in this.core.models)if(t=this.core.models[r].tree.guidElementMap[e])return t;return console.warn("guid: "+e+" not found!"),null},t.prototype.getClippingData=function(){return this.core.clipping.isEnabled()?{planes:this.core.clipping.getClippingPlanes(!0),points:this.core.clipping.getClippingPoints(!0)}:null},t.prototype.translateModel=function(e,t,r,i){var n=this.core.models[e];n&&(n.translate(t,r,i),this._viewer.invalidate())},t.prototype.rotateModel=function(e,t,r,i){var n=this.core.models[e];n&&(n.rotate(t,r,i),this._viewer.invalidate())},t.prototype.addPawn=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=!1),this.core.addPawn(e),this._viewer.getCamera().core._updateProjection(),e instanceof nt?e.drawables.forEach(function(e){e.update(n._viewer.getCamera().core),n._viewer.getRenderScene().addDrawable(e)}):e.drawables.forEach(function(e){n._viewer.getRenderScene().addDrawable(e)}),e.skeletons.forEach(function(e){n._viewer.getRenderScene().addSkeleton(e)}),r||this._viewer.onSceneChanged(),t&&this._viewer.getCamera().core.reset(!0),this._viewer.state=i.RENDERING,r||this._viewer.invalidate()},t.prototype.removePawn=function(e,t){var r=this;void 0===t&&(t=!1),this.core.removePawn(e),e.drawables.forEach(function(e){r._viewer.getRenderScene().removeDrawable(e)}),e.skeletons.forEach(function(e){r._viewer.getRenderScene().removeSkeleton(e)}),t||(this._viewer.onSceneChanged(),this._viewer.invalidate())},t.prototype.addText3D=function(e,t){var r=this;void 0===t&&(t=!0),this.core.addText3D(e),e.drawables.forEach(function(e){r._viewer.getRenderScene().addDrawable(e)}),t&&this._viewer.getCamera().core.reset(!0),this._viewer.state=i.RENDERING,this._viewer.invalidate()},t.prototype.removeText3D=function(e){var t=this;this.core.removeText3D(e),e.drawables.forEach(function(e){t._viewer.getRenderScene().removeDrawable(e)}),this._viewer.invalidate()},t.prototype.addModel=function(e,t,r){var i=this;void 0===t&&(t=!0),this.core.addModel(e),e.drawables.forEach(function(e){i._viewer.getRenderScene().addDrawable(e)}),t&&(r?this._viewer.getCamera().core.reset(!0,r):this._viewer.getCamera().core.reset(!0)),this._viewer.invalidate()},t.prototype.removeModel=function(e,t){void 0===t&&(t=!1);var r=this._viewer.getResourceManager(),i=this._viewer.getRenderScene();e.useLoadingBox&&e.removeLoadingBox(i),e.drawables.forEach(function(n){i.removeDrawable(n),t&&(r.removeSourceBuffers(n.mesh.bufferIndex),r.deleteBuffer(e.name+"-vmesh"+n.mesh.bufferIndex+".bin"))}),this.core.removeModel(e,t),this._viewer.onSceneChanged(),this._viewer.invalidate()},t.prototype.addMap=function(e){return this.core.addMap(e,this._viewer)},t.prototype.removeMap=function(e){this.core.removeMap(e)},t.prototype.hasContours=function(){return this.core.hasContours()},t.prototype.addVisualize=function(e){e.addEffects(),this._viewer.getRenderScene().addVisualize(e),this._viewer.invalidate()},t.prototype.removeVisualize=function(e){e.removeEffects(),this._viewer.getRenderScene().removeVisualize(e),this._viewer.invalidate()},t.prototype.getVisualize=function(e,t){return void 0===t&&(t=0),this._viewer.getRenderScene().getVisualize(e,t)},t.prototype.getVisualizes=function(e){return this._viewer.getRenderScene().getVisualizes(e)},t.prototype.setBackgroundImage=function(e,t){void 0===t&&(t=!1),this.core.background.setImages(e),t&&this.core.setReflectionMap(this.core.background.skybox.getTexture())},t.prototype.setReflectionMap=function(e){var t=this,r=this._viewer.getResourceManager().getTexture("mx-reflection-map");if(!r.ready&&e||(r.destroy(),r=this._viewer.getResourceManager().getTexture("mx-reflection-map")),e){var i=this._viewer.getResourceManager().gl;if("string"==typeof e){var n=e.split(".");if("dds"!==n[n.length-1].toLowerCase())return void console.error("File format of"+e+"is not supported!");r.createFromDDS(e,function(){t.core.setReflectionMap(r),t._viewer.invalidate()})}else e[0]instanceof HTMLImageElement?(r.createFromImages(e,i.RGB,i.UNSIGNED_BYTE,i.LINEAR,i.CLAMP_TO_EDGE),r.generateCubeMapMipMap(),this.core.setReflectionMap(r),this._viewer.invalidate()):r.createFromFiles(e,i.RGB,i.LINEAR,i.CLAMP_TO_EDGE,function(){r.generateCubeMapMipMap(),t.core.setReflectionMap(r),t._viewer.invalidate()})}else this.core.setReflectionMap(null)},t.prototype.setToneMappingEnabled=function(e){this.core.setToneMappingEnabled(e)},t.prototype.setToneMappingExposure=function(e){this.core.setToneMappingExposure(e)},t.prototype.setlightZRotation=function(e){this.core.setlightZRotation(e)},t.prototype.setBackgroundFov=function(e){this.core.background.skybox?(this.core.background.skybox.setFov(e),this._viewer.invalidate()):console.warn("please use setBackgroundImage() before setBackgroundFov()!")},t.prototype.getOriginModelBox=function(){return this.core.getOriginModelBox()},t.prototype.getModelBox=function(){return this.core.getModelBox()},t.prototype.getSceneBox=function(){return this.core.getSceneBox()},t.prototype.clearPopModel=function(){var e=this;for(var t in this.core.pawns){var r=this.core.pawns[t];this.removePawn(r),r.drawables.forEach(function(t){e._viewer.getRenderScene().removeDrawable(t)})}this._viewer.invalidate()},t.prototype.setModelTransform=function(e,t){var r=this.core.models[e];r?(r.setTransfromArry(t),this.core.updateBBox(),this._viewer.invalidate()):console.warn("modelId:"+e+" is not exist")},t.prototype.getModelTransform=function(e){var t=this.core.models[e];if(t)return t.getTransformArray();console.warn("modelId:"+e+" is not exist")},t.prototype.updateBBox=function(){this.core.updateBBox(),this._viewer.getCamera().core._updateProjection()},t.prototype.getModel=function(e){return this.core.getModel(e)},t.prototype.getPawn=function(e){return this.core.getPawn(e)},t}(tr),nr=r(22),ar=r(25),or=r(6),sr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),lr=function(e){function t(){var t=e.call(this,"normal")||this;return t._updateThreshold=1e-4,t._acceleration=.15,t._vFov=20*V.a.Deg2Rad,t._vMove=2*V.a.Meter2Foot,t._vRotate=5*V.a.Deg2Rad,t}return sr(t,e),t.prototype._update=function(e){var t=this._updateAt(e),r=this._updateFov(e),i=this._updatePhi(e),n=this._updateTheta(e),a=this._updateDistance(e);return!!(n||i||t||a||r)&&this._updateCameraMatrix()},t.prototype._updateCameraMatrix=function(){var e=this._camera;return e._scene&&e._updateProjection(),e._cull.update(),e.updateVP(),!0},t.prototype._updateTheta=function(e){var t=this._camera,r=t._targetTheta-t._theta,i=this._getStep(r,this._vRotate,e);return 0!==i&&(t._theta+=i,!0)},t.prototype._updatePhi=function(e){var t=this._camera,r=t._targetPhi-t._phi,i=this._getStep(r,this._vRotate,e);return 0!==i&&(t._phi+=i,!0)},t.prototype._updateAt=function(e){var t=this._camera;if(t._firstPerson)return!1;var r=or.a.create();or.a.sub(r,t._targetAt,t._at);var i=or.a.length(r);if(i<this._updateThreshold)return!1;var n=Math.max(i*this._acceleration,this._vMove*e);n=Math.min(i,n);var a=or.a.create();return or.a.normalize(r,r),or.a.scale(a,r,n),or.a.add(t._at,t._at,a),!0},t.prototype._updateDistance=function(e){var t=this._camera,r=t._targetDistance-t._distance,i=this._getStep(r,this._vMove,e);return 0!==i&&(t._distance+=i,!0)},t.prototype._updateFov=function(e){var t=this._camera,r=t._targetFov-t._fov,i=this._getStep(r,this._vFov,e);return 0!==i&&(t._setFov(t._fov+i),!0)},t.prototype._getStep=function(e,t,r){var i=Math.sign(e);if((e=Math.abs(e))<this._updateThreshold)return 0;var n=Math.max(e*this._acceleration,t*r);return n=Math.min(n,e)*i},t}(ar.a),ur=function(){function e(e){this._camera=e,this._scene=e._scene}return e.prototype.isCulled=function(e){if(!this._scene.clipping.isEnabled())return!1;var t=this._scene.clipping.get();if(e instanceof We){if(!P.a.inside.point_aabb(e.transform.getBottomPoint(),t))return!0}else if(P.a.outside.aabb_aabb(e.bbox,t))return!0;return!1},e}(),cr=r(58),hr=function(){function e(e){this._camera=e,this.enabled=!1}return e.prototype.update=function(){},e.prototype.isCulled=function(e,t){return!!this.enabled&&(e.hidables>0&&(t[1]=e.nodes[e.hidables].indicesOffset/e.mesh.indexSize),0===e.hidables)},e}(),dr=function(){function e(e){this._clippingCull=new ur(e),this._frustumCull=new cr.a(e),this._bimCull=new hr(e),this._enabled=!1}return e.prototype.destroy=function(){this._clippingCull=null,delete this._clippingCull,this._frustumCull=null,delete this._frustumCull,this._bimCull=null,delete this._bimCull},e.prototype.setEnabled=function(e){this._enabled=e},e.prototype.isEnabled=function(){return this._enabled},e.prototype.isCulled=function(e,t){return!!this._enabled&&!!(this._clippingCull.isCulled(e)||this._frustumCull.isCulled(e)||this._bimCull.isCulled(e,t))},e.prototype.update=function(){this._enabled&&(this._frustumCull.update(),this._bimCull.update())},e.prototype.setBimCullingEnabled=function(e){this._bimCull.enabled=e},e.prototype.isBimCullingEnabled=function(){return this._bimCull.enabled},e}(),pr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),fr=U.d.create(),_r=U.d.create(),mr=[0,0,0],vr=function(e){function t(t,r){var i=e.call(this,r)||this;return i._scene=t,i._targetAt=[0,0,0],i._targetEye=[0,0,0],i._targetFov=46,i._targetTheta=-Math.PI/4,i._targetPhi=Math.PI/18,i._targetDistance=15,i._initDistance=15,i._maxZoomOffset=.6,i._minZoomOffset=.15,i._maxZoomDistance=1/0,i._minZoomDistance=i._scene?.001*i._scene.scale:-1/0,i._yVanishFactor=U.e.create(),i.animator=new lr,i.animator.attach(i),i._cull=new dr(i),i.updated=!0,i._navigationSwitch=[!0,!0,!0,!0,!0,!0],i._prevUpdated=i.updated,i._updateStopListeners=[],i._updateStartListeners=[],i._minPitchAngle=-.499999*Math.PI,i._maxPitchAngle=.499999*Math.PI,i._maxTargetDistanceRatio=1/0,i._minTargetDistanceRatio=-1/0,i._minZnearRatio=.001,i._defaultCameraInfo=null,i}return pr(t,e),t.prototype.destroy=function(){this._cull.destroy(),this._cull=null,delete this._cull,this.animator.destroy(),this.animator=null,delete this.animator,this._targetAt=null,delete this._targetAt,this._targetEye=null,delete this._targetEye,this._updateStopListeners=null,delete this._updateStopListeners,this._updateStartListeners=null,delete this._updateStartListeners,e.prototype.destroy.call(this)},t.prototype.setDefaultCam=function(e){this._defaultCameraInfo=e},t.prototype.setMinPitchAngle=function(e){e=Math.max(e,-.499999*Math.PI),this._minPitchAngle=e},t.prototype.setMaxPitchAngle=function(e){e=Math.min(e,.499999*Math.PI),this._maxPitchAngle=e},t.prototype.setMaxTargetDistanceRatio=function(e){this._maxTargetDistanceRatio=e},t.prototype.setMinTargetDistanceRatio=function(e){this._minTargetDistanceRatio=e},t.prototype.setMinZnearRatio=function(e){this._minZnearRatio=e},t.prototype.setViewport=function(t,r){void 0===r&&(r=!0),e.prototype.setViewport.call(this,t,r);for(var i=0;i<this._updateStartListeners.length;i++)this._updateStartListeners[i](this);for(i=0;i<this._updateStopListeners.length;i++)this._updateStopListeners[i](this)},t.prototype.update=function(){if(this._prevUpdated=this.updated,this.updated=this.animator.update(),!this._prevUpdated&&this.updated&&this._scene&&this._scene.getVisibility())for(var e=0;e<this._updateStartListeners.length;e++)this._updateStartListeners[e](this);if(this._prevUpdated&&!this.updated&&this._scene&&this._scene.getVisibility())for(e=0;e<this._updateStopListeners.length;e++)this._updateStopListeners[e](this);return this.updated},t.prototype.addUpdateStartListener=function(e){this._updateStartListeners.push(e)},t.prototype.removeUpdateStartListener=function(e){var t=this._updateStartListeners.indexOf(e);t>=0&&this._updateStartListeners.splice(t,1)},t.prototype.addUpdateStopListener=function(e){this._updateStopListeners.push(e)},t.prototype.removeUpdateStopListener=function(e){var t=this._updateStopListeners.indexOf(e);t>=0&&this._updateStopListeners.splice(t,1)},t.prototype.rotate=function(e,t){if(this._navigationSwitch[1]){this._firstPerson&&(t=-t);var r=this._targetTheta-(this._navigationSwitch[4]?.006*e:0);if(this._targetPhi+=this._navigationSwitch[5]?.006*t:0,this._rotateRangeEnable){var i=r%(2*Math.PI);i=i<0?i+2*Math.PI:i,this._startTheta<this._endTheta?i<this._endTheta&&i>this._startTheta&&(this._targetTheta=r):(i>0&&i<this._endTheta||i>this._startTheta&&i<2*Math.PI)&&(this._targetTheta=r)}else this._targetTheta=r;this._updatePhi()}},t.prototype._updatePhi=function(){this._targetPhi>=this._maxPitchAngle&&(this._targetPhi=this._maxPitchAngle),this._targetPhi<=this._minPitchAngle&&(this._targetPhi=this._minPitchAngle)},t.prototype.setCullingEnabled=function(e){this._cull.setEnabled(e),e&&this._cull.update()},t.prototype.isCullingEnabled=function(){return this._cull.isEnabled()},t.prototype.setBimCullingEnabled=function(e){this._cull.setBimCullingEnabled(this._scene.isBimCullingNeeded&&e),this.isBimCullingEnabled()&&this._cull.update()},t.prototype.isBimCullingEnabled=function(){return this._scene.isBimCullingNeeded&&this._cull.isBimCullingEnabled()},t.prototype.setTargetAt=function(e){this._targetAt=e},t.prototype.setTargetFov=function(e){this._targetFov=e,this._targetFov>=179.9&&(this._targetFov=179.9),this._targetFov<=.1&&(this._targetFov=.1)},t.prototype.getTargetFov=function(){return this._targetFov},t.prototype.zoom=function(t,r,i){if(this._navigationSwitch[2]){var n=Math.abs(t*this._targetDistance*.35);this._targetDistance-=(t>0?1:-1)*Math.min(Math.max(n,this._minZoomOffset),this._maxZoomOffset),this._scene&&this._targetDistance<.001*this._scene.scale&&(this._targetDistance=.001*this._scene.scale),e.prototype._setHeight.call(this,this._targetDistance),this._targetDistance<this._minZoomDistance&&(this._distance=this._minZoomDistance,this._targetDistance=this._minZoomDistance),this._targetDistance>this._maxZoomDistance&&(this._distance=this._maxZoomDistance,this._targetDistance=this._maxZoomDistance)}},t.prototype.pan=function(e,t){if(this._navigationSwitch[0]){var r=.001*this._targetDistance;this._targetAt[0]+=-e*this.viewMatrix[0]*r+t*this.viewMatrix[1]*r,this._targetAt[1]+=-e*this.viewMatrix[4]*r+t*this.viewMatrix[5]*r,this._targetAt[2]+=-e*this.viewMatrix[8]*r+t*this.viewMatrix[9]*r}},t.prototype.setRotationRange=function(e,t,r){this._rotateRangeEnable=e,this._startTheta=t||0,this._endTheta=r||2*Math.PI},t.prototype.move=function(e,t){var r=this,i=[e*t[0],e*t[1],e*t[2]];this._targetAt.forEach(function(e,t){return r._targetAt[t]+=i[t]}),this.eye.forEach(function(e,t){return r.eye[t]+=i[t]})},t.prototype.moveLeft=function(e){var t=this.getViewDirection(),r=U.d.fromValues(t[0],t[1],t[2]),i=U.d.fromValues(0,0,1),n=U.d.create();U.d.cross(n,i,r),this.move(e,n)},t.prototype.moveRight=function(e){this.moveLeft(-e)},t.prototype.moveForward=function(e,t){void 0===t&&(t=!1);var r=this.getViewDirection();if(t){var i=U.d.fromValues(r[0],r[1],0);U.d.normalize(r,i)}this.move(e,r)},t.prototype.moveBackward=function(e,t){void 0===t&&(t=!1),this.moveForward(-e,t)},t.prototype.moveUp=function(e){this.move(e,[0,0,1])},t.prototype.moveDown=function(e){this.moveUp(-e)},t.prototype.forward=function(e,t){void 0===t&&((t=this.getViewDirection())[2]=0);var r=t[0]*e*this._scene.radius,i=t[1]*e*this._scene.radius,n=t[2]*e*this._scene.radius;this._targetAt[0]+=r,this._targetAt[1]+=i,this._targetAt[2]+=n,this.eye[0]+=r,this.eye[1]+=i,this.eye[2]+=n},t.prototype._updateProjection=function(){_r=P.a.aabb.center(this._scene.bbox),mr[0]=this._at[0]+this.viewMatrix[2]*this._targetDistance,mr[1]=this._at[1]+this.viewMatrix[6]*this._targetDistance,mr[2]=this._at[2]+this._yVanishFactor[2]*this._targetDistance,U.d.subtract(fr,this.eye,_r);var e=this.viewMatrix[2]*fr[0]+this.viewMatrix[6]*fr[1]+this._yVanishFactor[2]*fr[2];U.d.subtract(fr,mr,_r);var t=this.viewMatrix[2]*fr[0]+this.viewMatrix[6]*fr[1]+this._yVanishFactor[2]*fr[2],r=Math.min(e,t)-1.1*this._scene.radius,i=Math.max(e,t)+1.03*this._scene.radius;this._perspective&&r<this._minZnearRatio*this._scene.radius&&(r=this._minZnearRatio*this._scene.radius),this._twoPointsPerpective&&(r=Math.max(r/2,.001),i*=1.3),this.updateProjection(r,i)},t.prototype.reset=function(t,r){this._scene.bbox[0]!==1/0&&this._scene.modelsBox[0]!==1/0&&(this.animator.stop&&this.animator.stop(),this.animator=new lr,this.animator.attach(this),r?(this._targetAt=P.a.aabb.center(this._scene.bbox),this._targetDistance=this._getViewDistance(),this._maxZoomOffset=.025*this._targetDistance,this._minZoomOffset=.0025*this._targetDistance,U.d.copy(this._targetAt,r.at),this._at[0]=this._targetAt[0],this._at[1]=this._targetAt[1],this._at[2]=this._targetAt[2],this._distance=this._targetDistance=r.distance,this.setTargetFov(r.fov),this.rotateTo(r.phi,r.theta),this._fov=this._targetFov,this._phi=this._targetPhi,this._theta=this._targetTheta,this._distance+=3*1e-4,this._initDistance=this._targetDistance,this.update()):(this._scene.clipping.isEnabled()?U.d.copy(this._targetAt,this._scene.clipping.getCenter()):this._targetAt=P.a.aabb.center(this._scene.bbox),this._targetDistance=this._getViewDistance(),this._targetDistance=this._getViewDistance(),this._initDistance=this._targetDistance,this._maxZoomOffset=.025*this._targetDistance,this._minZoomOffset=.0025*this._targetDistance,this.rotateTo(Math.PI/18,-Math.PI/4),t&&(this._defaultCameraInfo&&e.prototype.resetDefaultCam.call(this)||(this.rotateTo(Math.PI/18,-Math.PI/4),e.prototype.reset.call(this,t,r),U.d.copy(this._at,this._targetAt)))))},t.prototype.rotateTo=function(e,t){var r=t-this._theta;(r%=2*Math.PI)>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI),this._targetTheta=this._theta+r,this._targetPhi=e},t.prototype.lookTo=function(t,r){if(this._navigationSwitch[3])if(this._targetAt[0]=t[0],this._targetAt[1]=t[1],this._targetAt[2]=t[2],void 0!==r)if(this._perspective)this._targetDistance=r/Math.sin(this._fov*Math.PI/360);else{var i=1.5*r;e.prototype._setHeight.call(this,i)}else{var n=this._targetAt[0]-this.eye[0],a=this._targetAt[1]-this.eye[1],o=this._targetAt[2]-this.eye[2];this._distance=Math.sqrt(n*n+a*a+o*o),this._targetDistance=Math.min(.35*this._scene.radius,this._distance)}},t.prototype.zoomTo=function(e,t,r){this._distance=e,this._targetDistance=t||e,r&&U.d.copy(this._targetAt,r)},t.prototype.zoomBy=function(t){if(!this._perspective){var r=this._height*t;e.prototype._setHeight.call(this,r),this._targetDistance-=t<1?15e-5:-15e-5}},t.prototype.dump=function(){var e,t;return this._firstPerson?(e=-this._targetPhi,t=this._targetTheta-Math.PI):(e=this._targetPhi,t=this._targetTheta),this._perspective?{fov:this._fov,distance:this._targetDistance,phi:e,theta:t,at:[this._at[0],this._at[1],this._at[2]],twoPointsPerpective:this._twoPointsPerpective}:{height:this._height,distance:this._targetDistance,phi:e,theta:t,at:[this._at[0],this._at[1],this._at[2]],twoPointsPerpective:!1}},t.prototype.restore=function(t){var r=t.height?1.2*this._scene.radius:t.distance;Math.abs(r-this._targetDistance),Math.max(r,this._targetDistance);if(this._distance=this._targetDistance=r,t.phi>=.49999*Math.PI&&(t.phi=.49999*Math.PI),t.phi<=-.49999*Math.PI&&(t.phi=-.49999*Math.PI),this._twoPointsPerpective=!!t.twoPointsPerpective,this._firstPerson){Math.abs(-t.phi-this._targetPhi),this._phi=this._targetPhi=-t.phi;var i,n,a,o=t.theta+Math.PI-this._theta;(o%=2*Math.PI)>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),Math.abs(this._theta+o-this._targetTheta),this._targetTheta=this._theta+o,this._theta=this._targetTheta;var s=Math.sin(this._targetPhi),l=Math.cos(this._targetPhi),u=Math.sin(this._targetTheta);i=l*Math.cos(this._targetTheta),n=l*u,a=s,this.eye[0]=t.at[0]-i*this._targetDistance,this.eye[1]=t.at[1]-n*this._targetDistance,this.eye[2]=t.at[2]-a*this._targetDistance}else{Math.abs(t.phi-this._targetPhi),this._phi=this._targetPhi=t.phi;o=t.theta-this._theta;(o%=2*Math.PI)>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),Math.abs(this._theta+o-this._targetTheta),this._targetTheta=this._theta+o,this._theta=this._targetTheta}this._at[0]=this._targetAt[0]=t.at[0],this._at[1]=this._targetAt[1]=t.at[1],this._at[2]=this._targetAt[2]=t.at[2],t.height?(e.prototype._setHeight.call(this,t.height),e.prototype.setPerspective.call(this,!1)):e.prototype.setPerspective.call(this,!0),this._scene&&this._updateProjection(),this.updateVP(),this._cull.update()},t.prototype.setparam=function(t){var r=t.height?1.2*this._scene.radius:t.distance;Math.abs(r-this._targetDistance),Math.max(r,this._targetDistance);if(this._distance=this._targetDistance=r,t.phi>=.49999*Math.PI&&(t.phi=.49999*Math.PI),t.phi<=-.49999*Math.PI&&(t.phi=-.49999*Math.PI),this._firstPerson){Math.abs(-t.phi-this._targetPhi),this._phi=this._targetPhi=-t.phi;var i,n,a,o=t.theta+Math.PI-this._theta;(o%=2*Math.PI)>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),Math.abs(this._theta+o-this._targetTheta),this._targetTheta=this._theta+o,this._theta=this._targetTheta;var s=Math.sin(this._targetPhi),l=Math.cos(this._targetPhi),u=Math.sin(this._targetTheta);i=l*Math.cos(this._targetTheta),n=l*u,a=s,this.eye[0]=t.at[0]-i*this._targetDistance,this.eye[1]=t.at[1]-n*this._targetDistance,this.eye[2]=t.at[2]-a*this._targetDistance}else{Math.abs(t.phi-this._targetPhi),this._phi=this._targetPhi=t.phi;o=t.theta-this._theta;(o%=2*Math.PI)>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),Math.abs(this._theta+o-this._targetTheta),this._targetTheta=this._theta+o,this._theta=this._targetTheta}if(this._at[0]=this._targetAt[0]=t.at[0],this._at[1]=this._targetAt[1]=t.at[1],this._at[2]=this._targetAt[2]=t.at[2],t.height?(e.prototype._setHeight.call(this,t.height),e.prototype.setPerspective.call(this,!1)):(this._setFov(t.fov),e.prototype.setPerspective.call(this,!0)),this._scene){var c=t.near,h=t.far;c&&h?this.updateProjection(c,h):this._updateProjection()}this.updateVP(),this._cull.update()},t.prototype.transformProperty=function(e){var t=e.at,r=e.position,i=U.d.distance(t,r),n={theta:0,phi:0,at:t,eye:r,distance:i},a=[r[0]-t[0],r[1]-t[1],0],o=r[2]-t[2],s=U.d.angleTo([1,0,0],a);return n.phi=Math.asin(o/i),n.theta=s,n.distance=i,n},t.prototype.cull=function(e,t){return this._cull.isCulled(e,t)},t.prototype.setFirstPerson=function(t,r){void 0===r&&(r=!0),this._firstPerson!==t&&(this._targetTheta=Math.PI+this._targetTheta,this._targetPhi=-this._targetPhi),!t&&r&&(this._targetAt[0]=this._at[0],this._targetAt[1]=this._at[1],this._targetAt[2]=this._at[2],this._at[0]-=1e-6,this._at[1]-=1e-6,this._at[2]-=1e-6),e.prototype.setFirstPerson.call(this,t)},t.prototype.isFirstPerson=function(){return this._firstPerson},t.prototype.isPerspective=function(){return this._perspective},t.prototype._getViewDistance=function(){var e=this,t=-Number.MAX_VALUE,r=1/Math.sin(.00872665*this._fov),i=r/Math.cos(.00872665*this._fov),n=Math.tan(.00872665*this._fov),a=this.getTargetViewDirection(),o=U.d.create(),s=U.d.create(),l=function(t,l){U.d.subtract(o,l.bsphere,e._targetAt);var u=U.d.dot(o,a);U.d.scaleAndAdd(s,e._targetAt,a,u);var c=U.d.distance(s,l.bsphere),h=l.bsphere[3],d=u+(c*i+h*r-c*n),p=1.05*Math.max(h,d);return Math.max(t,p)};for(var u in this._scene.models){var c=this._scene.models[u];if(c.visible)for(var h=0,d=c.drawables.length;h<d;h++){var p=c.drawables[h];p.visible&&(t=l(t,p))}}for(var f in this._scene.pawns){var _=this._scene.pawns[f];for(h=0,d=_.drawables.length;h<d;h++)t=l(t,_.drawables[h])}if(this._scene.clipping.isEnabled()){var m=this._scene.clipping.getRadius(),v=m*r;t=Math.min(t,1.05*Math.max(m,v))}if(t<0){var y=this._scene.radius;v=y*r;t=1.05*Math.max(y,v)}return t},t.prototype.getTargetViewDirection=function(){var e=Math.sin(this._targetPhi),t=Math.cos(this._targetPhi),r=Math.sin(this._targetTheta),i=Math.cos(this._targetTheta),n=U.d.create();return n[0]=-t*i,n[1]=-t*r,n[2]=-e,this._firstPerson&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2]),n},t.prototype.getRotation=function(){var e=this._theta;return{phi:this._phi,theta:e%=2*Math.PI}},t.prototype.setZoomMinMax=function(e){this._maxZoomOffset=.025*this._initDistance*e},t.prototype.setDistance=function(e){this._targetDistance=e},t.prototype.setZoomRange=function(e,t){this._minZoomDistance=e||.001*this._scene.scale,this._maxZoomDistance=t||1/0},t.prototype.enabledTwoPointsPerspective=function(t){t?(e.prototype.setPerspective.call(this,t),this._maxPitchAngle=.4*Math.PI,this._minPitchAngle=-.4*Math.PI):(this._maxPitchAngle=.499999*Math.PI,this._minPitchAngle=-.499999*Math.PI),this._updatePhi(),this._twoPointsPerpective=t,this._updateProjection(),this.updateVP()},t.prototype.setNavigationEnabled=function(e,t){switch(e){case"zoom":this._navigationSwitch[2]=t;break;case"pan":this._navigationSwitch[0]=t;break;case"rotate":this._navigationSwitch[1]=t;break;case"look":this._navigationSwitch[3]=t;break;case"rotatex":this._navigationSwitch[4]=t;break;case"rotatey":this._navigationSwitch[5]=t;break;default:console.warn("navigation params just support zoom,pan,rotate")}},t}(nr.a),yr=r(30),gr=r(18),br=r(24),wr=r(8),xr=function(){function e(e,t,r,i){this.queue=t.getQueue(i),this._renderQueueManager=t,this._resourceManager=e,this._overridedMaterial=null,this._overridedShaders=[null,null,null],this._needSort=r,this._cullFace=e.gl.CCW,this._visible=!0}return e.prototype.dump=function(e){console.groupCollapsed("RenderPass: "+e),this.queue.dump(),console.log("_overridedShaders: ",this._overridedShaders),console.log("_overridedMaterial: ",this._overridedMaterial),console.log("_needSort: "+this._needSort),console.log("_cullFace: "+this._cullFace),console.log("_visible: "+this._visible),console.groupEnd()},e.prototype.destroy=function(){this._overridedShaders=null,delete this._overridedShaders,this._overridedMaterial=null,delete this._overridedMaterial,this._resourceManager=null,delete this._resourceManager,this._renderQueueManager=null,delete this._renderQueueManager},e.prototype.setCullFace=function(e){this._cullFace=e},e.prototype.getCullFace=function(){return this._cullFace},e.prototype.getVisibility=function(){return this._visible},e.prototype.setVisibility=function(e){this._visible=e},e.prototype.setSortByBBoxOrderEnable=function(e){this.queue.setSortByBBoxOrderEnable(e)},e.prototype.render=function(e,t,r,i,n,a){this._visible&&this.queue.isValid()&&(this._needSort&&this.queue.sort(r),t.drawDrawables(e,this.queue.drawables,r,this._overridedShaders,this._overridedMaterial,n,a,i,null,this._cullFace))},e.prototype.renderMark=function(e,t,r,i,n,a){this._visible&&this.queue.isValid()&&t.drawMarks(e,this.queue.drawables,r,n,a,i,null,!1)},e.prototype.setOverridedMaterial=function(e){this._overridedMaterial=e,this._overridedMaterial&&this._overridedShaders[0]&&this._overridedMaterial.attachShader(this._overridedShaders[0])},e.prototype.getOverridedMaterial=function(){return this._overridedMaterial},e.prototype.getOverridedShaders=function(){return this._overridedShaders},e.prototype.setOverridedShader=function(e){if(this._overridedShaders[0]=e,this._overridedMaterial&&this._overridedShaders[0]&&this._overridedMaterial.attachShader(this._overridedShaders[0]),e&&e.shaderSource){var t=e.flags.concat("MODEL_TRANSFORM"),r=this._resourceManager.getShader(e.shaderSource.name,t);r.ready||r.createFromShaderSource(e.shaderSource,t),this._overridedShaders[1]=r;var i=t.concat("INSTANCING"),n=this._resourceManager.getShader(e.shaderSource.name,i);n.ready||n.createFromShaderSource(e.shaderSource,i),this._overridedShaders[2]=n}},e.prototype.recompileOverridedShader=function(e,t){for(var r=0;r<this._overridedShaders.length;r++){var i=this._overridedShaders[r];if(i){var n=i.flags.lastIndexOf(e),a=void 0,o=!1;if(t?-1===n&&(a=i.flags.concat(e),o=!0):-1!==n&&((a=i.flags.slice(0)).splice(n,1),o=!0),o){var s=i.shaderSource.name,l=this._resourceManager.getShader(s,a);if(!l.ready&&(l.createFromShaderSource(i.shaderSource,a),!l.ready))throw new Error("Failed to create shader '"+s+"'!");this._overridedShaders[r]=l}}}},e.prototype.addDrawable=function(e){return this.queue.addDrawable(e)},e.prototype.removeDrawable=function(e){return this.queue.removeDrawable(e)},e.prototype.createQueue=function(e,t){return this.queue.create(e,t)},e.prototype.optimize=function(){this.queue.optimize()},e}(),Mr=function(){function e(e,t,r,i,n){this._drawableNotUseOverride=[],this.isDestroy=!1;var a=e.gl;this._gl=a,this.renderTarget=new wr.a("box-normal-depth",e,i,n,{colorFormat:a.RGBA32F,clearColor:[0,0,0,0],colorBuffer:0,depthFormat:a.isWebGL2?a.DEPTH24_STENCIL8:a.DEPTH_STENCIL,depthBuffer:0}),this.buffer=new Float32Array(i*n*4),this.bufferDirty=!0,this.bufferDirtyTime=0,this.normal=U.d.create(),this.position=U.d.create(),this.nearPlaneSize=null,this.isPerspective=!0,this.inversedViewMatrix=U.a.create(),this.renderPass=new xr(e,t,!1,{line:!1});var o=e.getShader("normaldepth",["WORLDSPACE_NORMAL"]);if(!o.ready){var s=k.a.normaldepth;o.createFromShaderSource(s,["WORLDSPACE_NORMAL"])}this.renderPass.setOverridedShader(o),this.renderPass.setOverridedMaterial(new N.b("box-normal-depth"))}return e.prototype.resize=function(e,t){this.renderTarget.resize(e,t),this.buffer=new Float32Array(e*t*4)},e.prototype.destroy=function(){this.buffer=null,this.normal=null,this.inversedViewMatrix=null,this.renderTarget.destroy(),this.renderPass.destroy(),this.isDestroy=!0},e.prototype.render=function(e,t){this.beforeRenderWithOverride(this.renderPass.queue.drawables);var r=this._gl;e.invalidate(),e.clear(this.renderTarget,r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this.renderPass.render(this.renderTarget,e,t),r.readPixels(0,0,this.renderTarget.getWidth(),this.renderTarget.getHeight(),r.RGBA,r.FLOAT,this.buffer),this.nearPlaneSize=t.getNearPlaneSize(),this.isPerspective=t.isPerspective(),U.a.invert(this.inversedViewMatrix,t.viewMatrix),this.bufferDirty=!1,this.afterRenderWithOverride()},e.prototype.getNormalDepth=function(e,t){var r=Math.floor(e*s.a.devicePixelRatio),i=Math.floor(t*s.a.devicePixelRatio),n=this.renderTarget.getWidth(),a=this.renderTarget.getHeight(),o=4*(r+(a-i)*n),l=this.buffer[o+3];return 0!==l&&(this.normal[0]=this.buffer[o],this.normal[1]=this.buffer[o+1],this.normal[2]=this.buffer[o+2],!(isNaN(this.normal[0])||isNaN(this.normal[1])||isNaN(this.normal[2]))&&(this.position[2]=l,this.isPerspective?(this.position[0]=2*this.nearPlaneSize[0]*(r/n-.5)*l/this.nearPlaneSize[2],this.position[1]=2*this.nearPlaneSize[1]*((a-1-i)/a-.5)*l/this.nearPlaneSize[2]):(this.position[0]=2*this.nearPlaneSize[0]*(r/n-.5),this.position[1]=2*this.nearPlaneSize[1]*((a-1-i)/a-.5)),U.d.transformMat4(this.position,this.position,this.inversedViewMatrix),!0))},e.prototype.dirtyAt=function(e){this.bufferDirty=!0,this.bufferDirtyTime=e},e.prototype.canUpdateAt=function(e){return this.bufferDirty&&this.bufferDirtyTime<e},e.prototype.isDirty=function(){return this.bufferDirty},e.prototype.addDrawable=function(e){this.renderPass.queue.addDrawable(e)},e.prototype.recompileShader=function(e,t){this.renderPass.recompileOverridedShader(e,t)},e.prototype.isValid=function(){return this.renderPass.queue.isValid()},e.prototype.getNormal=function(){return this.normal},e.prototype.getPosition=function(){return this.position},e.prototype.beforeRenderWithOverride=function(e){var t=this;this._drawableNotUseOverride.length=0,e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},e.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1})},e}(),Er=r(51),Tr=r(19),Sr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ar=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Pr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ar(arguments[t]));return e},kr=function(e){function t(t,r,i,n){void 0===n&&(n=[]);var a=e.call(this,t,null,null,null,i)||this;a.name=null,a.isHeighLight=!1,a.isHeighLight=!1;var o=Pr(["MODEL_TRANSFORM"],n),s=r.getShader("mark",o);s.ready||s.createFromShaderSource(k.a.constant_shape,o);var l=new F("",r);return l.attachShader(s,r),l.polygonOffset=!0,l.polygonOffsetFactor=-1,l.polygonOffsetUnits=-1,l.setSide(N.a.DOUBLESIDE),a.shader=s,a.material=l,a.testCull=!1,a}return Sr(t,e),t.prototype.setHighLight=function(e){e?this.material.heighLight():this.material.restoreDiffuse()},t.prototype.setColor=function(e){this.material.setDiffuse(e)},t.prototype.setTransparent=function(e){this.material.setTransparent(e)},t}(D.a),Or=r(40),Dr=r(50),Nr=r(33),Cr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ir=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Rr=function(e){function t(t,r,i){var n=e.call(this,"Roaming")||this;return n._posCur=null,n._posEnd=null,n._atCur=null,n._atEnd=null,n._posOff=or.a.create(),n._dirCur=or.a.create(),n._dirEnd=or.a.create(),n._speedRotate=1,n._speedRoaming=1,n._tLastFrame=0,n._depthQuery=null,n._renderer=null,n.ORDINARY_PEOPLE_HEIGHT=5.5,n._renderer=r,n._depthQuery=new br.a(t,i),n}return Cr(t,e),t.prototype._update=function(e){return!this._alreadArrived()&&this._stepToTarget()},t.prototype._alreadArrived=function(){return this._equal(this._posCur,this._posEnd)},t.prototype._equal=function(e,t){return Math.abs(e[0]-t[0]+e[1]-t[1]+e[2]-t[2])<1e-4},t.prototype._stepToTarget=function(){var e=Date.now(),t=.001*(e-this._tLastFrame);return this._tLastFrame=e,this._adjustOrientation(t)||this._walkToTarget(t)},t.prototype._adjustOrientation=function(e){var t=this;if(this._equal(this._dirCur,this._dirEnd))return!1;var r=e*this._speedRotate,i=Math.cos(r);if(or.a.dot(this._dirCur,this._dirEnd)>i)return this._dirCur=or.a.clone(this._dirEnd),!0;var n=1-i,a=Math.sin(r),o=or.a.create();or.a.cross(o,this._dirCur,this._dirEnd),or.a.normalize(o,o);var s=Dr.a.create();s[0]=o[0]*o[0]*n+i,s[1]=o[0]*o[1]*n-o[2]*a,s[2]=o[0]*o[2]*n+o[1]*a,s[3]=o[0]*o[1]*n+o[2]*a,s[4]=o[1]*o[1]*n+i,s[5]=o[1]*o[2]*n-o[0]*a,s[6]=o[0]*o[2]*n-o[1]*a,s[7]=o[1]*o[2]*n+o[0]*a,s[8]=o[2]*o[2]*n+i;var l=Ir(this._dirCur,3),u=l[0],c=l[1],h=l[2];return this._dirCur[0]=s[0]*u+s[1]*c+s[2]*h,this._dirCur[1]=s[3]*u+s[4]*c+s[5]*h,this._dirCur[2]=s[6]*u+s[7]*c+s[8]*h,or.a.normalize(this._dirCur,this._dirCur),[0,1,2].forEach(function(e){return t._camera._at[e]=t._posCur[e]+t._dirCur[e]}),this._updateCameraViewProjection(),!0},t.prototype._walkToTarget=function(e){return this._updateCurPosition(e),this._updateCameraEyeAt(),this._updateCameraViewProjection(),this._alreadArrived()&&(this._resetThetaPhiViaEyeAt(),this.detach()),!0},t.prototype._updateCurPosition=function(e){for(var t=this._speedRoaming*e,r=0;r<3;r++){var i=this._posOff[r]*t,n=this._posEnd[r]-this._posCur[r];this._posCur[r]=Math.abs(i)>Math.abs(n)?this._posEnd[r]:this._posCur[r]+i}},t.prototype._updateCameraEyeAt=function(){var e=this._camera;e.eye[0]=this._posCur[0],e.eye[1]=this._posCur[1];var t=this._depthQuery.getHeightUnder(this._posCur,this._renderer);e.eye[2]=null===t?this._posCur[2]:t+this.ORDINARY_PEOPLE_HEIGHT,or.a.add(e._at,e.eye,this._dirEnd),e._distance=or.a.distance(e.eye,e._at)},t.prototype._updateCameraViewProjection=function(){var e=this._camera;Nr.a.lookAt(e.viewMatrix,e.eye,e._at,[0,0,1]),e._updateProjection(),Nr.a.multiply(e.vpMatrix,e.projectMatrix,e.viewMatrix),e._cull.update()},t.prototype._resetThetaPhiViaEyeAt=function(){var e=this._camera;e._targetDistance=e._distance;var t=e.eye[0]-e._at[0],r=e.eye[1]-e._at[1],i=e.eye[2]-e._at[2];e._targetPhi=e._phi=Math.asin(Math.min(i/e._targetDistance,1)),e._targetPhi>=.49999*Math.PI&&(e._targetPhi=.49999*Math.PI),e._targetPhi<=-.49999*Math.PI&&(e._targetPhi=-.49999*Math.PI),e._targetTheta=e._theta=Math.atan2(r,t),e._firstPerson&&(e._targetPhi=e._phi=-e._targetPhi,e._targetTheta=e._theta=e._targetTheta+Math.PI)},t.prototype.to=function(e,t){this._posCur=Array.from(this._camera.eye),this._atCur=Array.from(this._camera._at),this._posEnd=e,this._atEnd=t;for(var r=0;r<3;r++)this._posOff[r]=this._posEnd[r]-this._posCur[r],this._dirCur[r]=this._atCur[r]-this._posCur[r],this._dirEnd[r]=this._atEnd[r]-this._posEnd[r];or.a.normalize(this._posOff,this._posOff),or.a.normalize(this._dirCur,this._dirCur),or.a.normalize(this._dirEnd,this._dirEnd),this._tLastFrame=Date.now()},t.prototype.setRotateSpeed=function(e){this._speedRotate=e*Math.PI/180},t.prototype.setRoamingSpeed=function(e){this._speedRoaming=3.2808*e},t}(ar.a),Br=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Lr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Fr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Lr(arguments[t]));return e},Ur=function(e){function t(){var t=e.call(this,"Falling")||this;return t._eyeTarget=null,t._eyeStarted=null,t._atStarted=null,t._tTotal=0,t._tAccumulated=0,t._vHorizontal=0,t}return Br(t,e),t.prototype._update=function(e){return this._alreadyArrivedAtTarget()?this._stop():this._falling(e)},t.prototype._alreadyArrivedAtTarget=function(){var e=this;return[0,1,2].map(function(t){return e._camera.eye[t]-e._eyeTarget[t]}).every(function(e){return Math.abs(e)<1e-4})},t.prototype.start=function(e){this._eyeTarget=e,this._eyeStarted=Fr(this._camera.eye),this._atStarted=Fr(this._camera._at);var t=this._eyeTarget[0]-this._eyeStarted[0],r=this._eyeTarget[1]-this._eyeStarted[1],i=this._eyeTarget[2]-this._eyeStarted[2],n=Math.sqrt(t*t+r*r),a=9.81*V.a.Meter2Foot;this._tTotal=Math.sqrt(2*-i/a),this._vHorizontal=n/this._tTotal,this._tAccumulated=0},t.prototype._stop=function(){return this._adjustThetaPhiByEyeAt(),this.detach(),!0},t.prototype._falling=function(e){return this._tAccumulated+=e,this._tAccumulated>this._tTotal?this._arriveTarget():this._strideToTarget()},t.prototype._arriveTarget=function(){var e=this,t=U.d.create();U.d.sub(t,this._eyeTarget,this._camera.eye);var r=this._camera._at;return U.d.add(r,r,t),[0,1,2].forEach(function(t){return e._camera.eye[t]=e._eyeTarget[t]}),this._updateCameraViewProjectionByEyeAt(),!0},t.prototype._strideToTarget=function(){var e=U.d.create();U.d.sub(e,this._eyeTarget,this._camera.eye),e[2]=0,U.d.normalize(e,e);var t=this._vHorizontal*this._tAccumulated,r=U.d.create();U.d.scale(r,e,t);var i=9.81*V.a.Meter2Foot,n=this._tAccumulated;return r[2]=-.5*i*n*n,U.d.add(this._camera.eye,this._eyeStarted,r),U.d.add(this._camera._at,this._atStarted,r),this._updateCameraViewProjectionByEyeAt(),!0},t}(ar.a),Vr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),jr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},zr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(jr(arguments[t]));return e},Gr=function(e){function t(){var t=e.call(this,"Climbing")||this;return t._eyeTarget=null,t._eyeStarted=null,t._atStarted=null,t._tTotal=0,t._tAccumulated=0,t._distanceVertical=0,t._vHorizontal=0,t}return Vr(t,e),t.prototype._update=function(e){return this._alreadyArrivedAtTarget()?this._stop():this._climbing(e)},t.prototype._alreadyArrivedAtTarget=function(){var e=this;return[0,1,2].map(function(t){return e._camera.eye[t]-e._eyeTarget[t]}).every(function(e){return Math.abs(e)<1e-4})},t.prototype.start=function(e){this._eyeTarget=e,this._eyeStarted=zr(this._camera.eye),this._atStarted=zr(this._camera._at);var t=this._eyeTarget[0]-this._eyeStarted[0],r=this._eyeTarget[1]-this._eyeStarted[1],i=this._eyeTarget[2]-this._eyeStarted[2],n=Math.sqrt(t*t+r*r);this._distanceVertical=i;var a=9.81*V.a.Meter2Foot;this._tTotal=Math.sqrt(2*this._distanceVertical/a),this._vHorizontal=n/this._tTotal,this._tAccumulated=0},t.prototype._stop=function(){return this._adjustThetaPhiByEyeAt(),this.detach(),!0},t.prototype._climbing=function(e){return this._tAccumulated+=e,this._tAccumulated>this._tTotal?this._arriveTarget():this._strideToTarget()},t.prototype._arriveTarget=function(){var e=this,t=U.d.create();U.d.sub(t,this._eyeTarget,this._camera.eye);var r=this._camera._at;return U.d.add(r,r,t),[0,1,2].forEach(function(t){return e._camera.eye[t]=e._eyeTarget[t]}),this._updateCameraViewProjectionByEyeAt(),!0},t.prototype._strideToTarget=function(){var e=U.d.create();U.d.sub(e,this._eyeTarget,this._camera.eye),e[2]=0,U.d.normalize(e,e);var t=this._vHorizontal*this._tAccumulated,r=U.d.create();U.d.scale(r,e,t);var i=9.81*V.a.Meter2Foot,n=this._tTotal-this._tAccumulated;return r[2]=this._distanceVertical-.5*i*n*n,U.d.add(this._camera.eye,this._eyeStarted,r),U.d.add(this._camera._at,this._atStarted,r),this._updateCameraViewProjectionByEyeAt(),!0},t}(ar.a),Hr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qr=function(e){function t(t,r,i){var n=e.call(this,"Walking")||this;return n._stride=or.a.create(),n._dirCur=or.a.create(),n._upDir=or.a.fromValues(0,0,1),n._renderer=null,n._depthQuery=null,n._eyeTarget=null,n._animatorFalling=null,n._animatorClimbing=null,n._eyeHeight=1.65*V.a.Meter2Foot,n._fallClimbThreshold=.1*V.a.Meter2Foot,n._withinAngleOnlyMoveOrRotate=20*V.a.Deg2Rad,n._maxStrideHeight=.5*V.a.Meter2Foot,n._vMove=1*V.a.Meter2Foot,n._vRotate=15*V.a.Deg2Rad,n._renderer=r,n._depthQuery=new br.a(t,i),n._animatorFalling=new Ur,n._animatorClimbing=new Gr,n}return Hr(t,e),t.prototype._update=function(e){return Math.abs(this._stride[1])<Math.sin(this._withinAngleOnlyMoveOrRotate)?this._translate(e):Math.abs(this._stride[0])<Math.sin(this._withinAngleOnlyMoveOrRotate)?this._move(e):this._moveAndTranslate(e)},t.prototype._translate=function(e){var t=or.a.create();return or.a.cross(t,this._upDir,this._dirCur),or.a.scale(t,t,Math.sign(this._stride[0])),or.a.normalize(t,t),this._moveTo(e,t)},t.prototype._moveAndTranslate=function(e){var t=or.a.create();or.a.cross(t,this._upDir,this._dirCur),or.a.scale(t,t,Math.sign(this._stride[0])),or.a.normalize(t,t);var r=or.a.create();or.a.scale(r,this._dirCur,Math.sign(this._stride[1]));var i=or.a.create();return or.a.add(i,t,r),or.a.normalize(i,i),this._moveTo(e,i)},t.prototype._moveTo=function(e,t){var r=e*this._vMove,i=or.a.create();or.a.scale(i,t,r),or.a.add(this._eyeTarget,this._eyeTarget,i);var n=[this._eyeTarget[0],this._eyeTarget[1],this._eyeTarget[2]-this._eyeHeight+this._maxStrideHeight],a=this._depthQuery.getHeightUnder(n,this._renderer);this._eyeTarget[2]=null===a?this._eyeTarget[2]:a+this._eyeHeight;var o=this._eyeTarget[2]-this._camera.eye[2]<-this._fallClimbThreshold,s=this._eyeTarget[2]-this._camera.eye[2]>+this._fallClimbThreshold;return o?this._falling():s?this._climbing():this._directlyMoveToTarget()},t.prototype._calNextEyeTarget=function(e){var t=or.a.create(),r=e*this._vMove*Math.sign(this._stride[1]);or.a.scale(t,this._dirCur,r),or.a.add(this._eyeTarget,this._eyeTarget,t);var i=[this._eyeTarget[0],this._eyeTarget[1],this._eyeTarget[2]-this._eyeHeight+this._maxStrideHeight],n=this._depthQuery.getHeightUnder(i,this._renderer);this._eyeTarget[2]=null===n?this._eyeTarget[2]:n+this._eyeHeight},t.prototype._move=function(e){var t=or.a.create();return or.a.scale(t,this._dirCur,Math.sign(this._stride[1])),this._moveTo(e,t)},t.prototype._climbing=function(){return this._animatorClimbing.attach(this._camera),this._animatorClimbing.start(this._eyeTarget),!0},t.prototype._falling=function(){return this._animatorFalling.attach(this._camera),this._animatorFalling.start(this._eyeTarget),!0},t.prototype._directlyMoveToTarget=function(){var e=this,t=this._camera;return[0,1,2].forEach(function(r){return t.eye[r]=e._eyeTarget[r]}),or.a.add(t._at,t.eye,this._dirCur),t._distance=or.a.distance(t.eye,t._at),this._updateCameraViewProjectionByEyeAt(),!0},t.prototype.start=function(e,t,r){this._attach(e)&&this._initialize(t,r)},t.prototype._attach=function(e){return e.animator===this||e.animator!==this._animatorFalling&&(e.animator!==this._animatorClimbing&&(this.attach(e),!0))},t.prototype._initialize=function(e,t){return this._eyeHeight=t,this._eyeTarget=Array.from(this._camera.eye),or.a.sub(this._dirCur,this._camera._at,this._camera.eye),or.a.normalize(this._dirCur,this._dirCur),or.a.normalize(this._stride,e),!0},t.prototype.stop=function(){this._camera&&(this._adjustThetaPhiByEyeAt(),this.detach())},t}(ar.a),Wr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Qr=function(){return(Qr=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Yr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o};!function(e){e[e.Default=0]="Default",e[e.FirstPersonRoaming=1]="FirstPersonRoaming"}(Xt||(Xt={}));var Xr=function(e){function t(t){var r=e.call(this,"CameraManipulator",!1,t)||this;return r._normalDepth=null,r._animatorTransition=null,r._animatorNavigation=null,r._animatorRoaming=null,r._animatorWalking=null,r._touchMoveDistanceX=0,r._touchMoveDistanceY=0,r._touchStartTime=0,r._touchMoveInPointOneSecond=null,r._dirUp=[0,0,1],r._dirDown=[0,0,-1],r._mode=Xt.Default,r._hasIntersection=!1,r._firstStandPointSetted=!1,r._navigationNeedStop=!1,r._clickEnabled=!0,r._basePlane=null,r.ORDINARY_PEOPLE_HEIGHT=5.5,r._viewer?(r._depthQuery=new br.a(r._scene,r._resourceManager),r._normalDepth=new Mr(r._resourceManager,r._viewer.getRenderScene().getRenderQueueManager(),r._scene,r._viewer.getWidth(),r._viewer.getHeight())):r._depthQuery=null,r._animatorTransition=new yr.a(t.getEventEmitter()),r._animatorNavigation=new Or.a(t.getEventEmitter()),r._animatorRoaming=new Rr(r._scene,r._renderer,r._resourceManager),r._animatorWalking=new qr(r._scene,r._renderer,r._resourceManager),r._restricted=!1,r._touchPanSpeedScaling=1.86*s.a.devicePixelRatio,r._touchZoomSpeedScaling=.0596*Math.sqrt(s.a.devicePixelRatio),r._touchRotateSpeedScaling=.44*s.a.devicePixelRatio,r._mousePanSpeedScaling=.37,r._mouseZoomSpeedScaling=.278,r._mouseRotateSpeedScaling=.45,r._keyRotateSpeed=2,r._keyPanSpeed=1,r._keyForwardSpeed=.0092,r._eventEmitter=t.getEventEmitter(),r._hasSavedFPV=!1,r._isFPV=!1,r._adjusting=!1,r._isPanorama=!1,r.isOrthoView=!1,r.keyboardEnable=!0,r._dbclickEnabled=!0,r._orientation=t.getOrientation(),r}return Wr(t,e),Object.defineProperty(t.prototype,"normalDepth",{get:function(){return this._normalDepth},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._animatorTransition&&(this._animatorTransition.destroy(),delete this._animatorTransition,this._animatorTransition=null),this._animatorNavigation&&(this._animatorNavigation.destroy(),delete this._animatorNavigation,this._animatorNavigation=null),this._animatorRoaming&&(this._animatorRoaming.destroy(),delete this._animatorRoaming,this._animatorRoaming=null),this._depthQuery&&(this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery),this._normalDepth&&!this._normalDepth.isDestroy&&(this._normalDepth.destroy(),this._normalDepth=null,delete this._normalDepth)},t.prototype.isAvailable=function(e){return!0},t.prototype.isSupport3D=function(){return!0},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseUpListener(function(e){return t._onMouseUp(e)},"CameraManipulator"),e.addMouseDownListener(function(e){return t._onMouseDown(e)},"CameraManipulator"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"CameraManipulator"),e.addMouseWheelListener(function(e){return t._onMouseWheel(e)},"CameraManipulator"),e.addMouseDbClickListener(function(e){return t._onMouseDbClick(e)},"CameraManipulator")},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchMoveListener(function(e){return t._onTouchMove(e)},"CameraManipulator")},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e)},"CameraManipulator"),e.addKeyUpListener(function(e){return t._onKeyUp(e)},"CameraManipulator")},t.prototype._onMouseDown=function(e){return this._restoreFPV(),e.button===e.LEFT_BUTTON&&this._exitTransit(),this._stopNavigation(),this._touchMoveDistanceX=0,this._touchMoveDistanceY=0,!1},t.prototype._stopNavigation=function(){this._isFirstPersonRoaming()&&this._navigationNeedStop&&(this._animatorNavigation.stop(!0),this._navigationNeedStop=!1)},t.prototype._dealFirstPersonRoaming=function(e){if(e.moved)return!1;if(!this._isFirstPersonRoaming())return!1;var t=e.x,r=e.y;return this._firstStandPointSetted?this._roamingTo(t,r):this._setupFirstStandPoint(t,r)},t.prototype._getStandPoint=function(e,t,r){void 0===r&&(r=!0),this._normalDepth.render(this._renderer,this._camera);var i=null;if(this._normalDepth.getNormalDepth(e,t)){var n=this._normalDepth.getNormal()[2]<.9;if(r&&n)return this._viewer.notifyEventListener("unreacha"),null;i=this._getForwardTarget(e,t)}else i=this._getForwardTargetOnBasePlane(e,t);return i},t.prototype._setupFirstStandPoint=function(e,t){var r=this._getStandPoint(e,t);return!!r&&(this.enterFirstPersonRoamingMode(),this._flyToTarget(r[0],r[1]),!0)},t.prototype._getForwardTargetOnBasePlane=function(e,t){var r=new Er.a;r.setFromCamera(e,t,this._camera);var i=r.intersectPlane([0,0,1],this._scene.getSceneBox()[2]-.1);if(!i)return null;var n=this._scene.getSceneBox(),a=.5*(n[3]+n[0]),o=.5*(n[4]+n[1]),s=.5*(n[3]-n[0]),l=.5*(n[4]-n[1]),u=Math.abs(i[0]-a),c=Math.abs(i[1]-o);if(u>2*s||c>2*l)return null;i[2]+=this.ORDINARY_PEOPLE_HEIGHT;var h=U.d.create();return U.d.lerp(h,this._camera.eye,i,1.1),h[2]=i[2],[i,h]},t.prototype.checkStandPoint=function(e,t){return this._getStandPoint(e,t)?"valid":null},t.prototype.roamingTo=function(e,t){return this._roamingTo(e,t)},t.prototype._roamingTo=function(e,t){if(!this._clickEnabled)return!1;var r=this._getStandPoint(e,t,!1);return!!r&&(this._flyToTarget(r[0],r[1]),!0)},t.prototype._markStandPoint=function(e){var t=this._resourceManager.getMesh("Intersection");t.createSphere(36,36,.1*V.a.Meter2Foot);var r=new kr(t,this._resourceManager);r.name="Intersection",r.setTranslation(e[0],e[1],e[2]),r.setColor([0,1,0,1]),this._scene.addShape(r),this._viewer.onSceneChanged()},t.prototype._getForwardTarget=function(e,t){var r=this._depthQuery.unproject(e,t,this._renderer,this._camera)||this._normalDepth.getPosition();return this._normalDepth.getNormal()[2]<.9?this._getForwardTargetFromVerticalPlane(r):this._getForwardTargetFromHorizontalPlane(r)},t.prototype._getForwardTargetFromVerticalPlane=function(e){var t=U.d.create(),r=U.d.clone(e),i=U.d.create();U.d.sub(i,r,this._camera.eye),U.d.normalize(i,i),U.d.multiply(i,i,[3.28,3.28,3.28]),U.d.distance(this._camera.eye,r)>3.28*1.2?U.d.sub(t,r,i):(U.d.add(t,e,i),U.d.add(r,r,i),U.d.add(r,r,i));var n=this._depthQuery.getHeightUnder(t,this._renderer);return t[2]=r[2]=n+this.ORDINARY_PEOPLE_HEIGHT,[t,r]},t.prototype._getForwardTargetFromHorizontalPlane=function(e){var t=U.d.clone(e),r=U.d.create();return t[2]+=this.ORDINARY_PEOPLE_HEIGHT,U.d.lerp(r,this._camera.eye,t,1.1),r[2]=t[2],[t,r]},t.prototype._markPersonPose=function(e){var t=this._resourceManager.getMesh("Person");t.createCylinder(.05*V.a.Meter2Foot,-this.ORDINARY_PEOPLE_HEIGHT,36);var r=new kr(t,this._resourceManager);r.name="Person",r.setTranslation(e[0],e[1],e[2]),r.setColor([1,0,1,1]),this._scene.addShape(r),this._viewer.onSceneChanged()},t.prototype._flyToTarget=function(e,t){this._animatorNavigation.attach(this._camera),this._animatorNavigation.start(e,t),this._animatorNavigation.stop(),this._navigationNeedStop=!0,this._normalDepth.dirtyAt(this._viewer.getElapsedFrames()),this._removeBasePlane()},t.prototype._walkToTarget=function(e,t){this._animatorRoaming.attach(this._camera),this._animatorRoaming.setRotateSpeed(180),this._animatorRoaming.setRoamingSpeed(3),this._animatorRoaming.to(e,t),this._normalDepth.dirtyAt(this._viewer.getElapsedFrames())},t.prototype._travel=function(e){this._animatorWalking.start(this._camera,e,this.ORDINARY_PEOPLE_HEIGHT),this._normalDepth.dirtyAt(this._viewer.getElapsedFrames())},t.prototype.travel=function(e,t){this._travel([e,t,0])},t.prototype.stopTraveling=function(){this._animatorWalking.stop()},t.prototype.enterFirstPersonRoamingMode=function(){this.resetFirstPersonView(!0),this.setMode(Xt.FirstPersonRoaming),this._firstStandPointSetted=!0,this._camera.setFirstPerson(!0,!1),this._restoreFPV(),this._viewer.notifyEventListener("enterFirstPersonRoamingMode")},t.prototype._markBasePlane=function(){var e=this._resourceManager.getMesh("BasePlane");e.createQuad();var t=new Float32Array([-.5,-.5,0,.5,.5,.1]),r=new kr(e,this._resourceManager,t),i=this._scene.getSceneBox(),n=.5*(i[0]+i[3]),a=.5*(i[1]+i[4]),o=.5*(i[3]-i[0]),s=.5*(i[4]-i[1]);r.setScaling(2.5*o,2.5*s,1),r.setTranslation(n,a,i[2]),r.name="BasePlane",r.setColor([0,1,0,1]),r.setTransparent(.12),this._scene.addShape(r),this._viewer.onSceneChanged(),this._basePlane=r},t.prototype._removeBasePlane=function(){this._basePlane&&this._scene.removeShape(this._basePlane),this._basePlane=null,this._viewer.onSceneChanged()},t.prototype._onMouseMove=function(e){if(e.button===e.LEFT_BUTTON&&e.pressed){if(this._adjusting)return this._camera.rotate(-e.dx*this._mouseRotateSpeedScaling,0),this._viewer.notifyEventListener("getMapPosition"),!0;if(this._isPanorama)this._panoramaMouseMove(e);else{var t=this._isFirstPersonRoaming()&&this._firstStandPointSetted?.5*-e.dx:e.dx,r=this._isFirstPersonRoaming()&&this._firstStandPointSetted?.5*-e.dy:e.dy;this._camera.rotate(t*this._mouseRotateSpeedScaling,r*this._mouseRotateSpeedScaling);for(var i=1;i<this._cameras.length;i++)this._cameras[i].rotate(t*this._mouseRotateSpeedScaling,r*this._mouseRotateSpeedScaling)}}else if(e.button===e.MIDDLE_BUTTON&&e.pressed&&!this._restricted){this._camera.zoom(.01*e.dx*s.a.devicePixelRatio);for(i=1;i<this._cameras.length;i++)this._cameras[i].zoom(.01*e.dx*s.a.devicePixelRatio)}else if(e.button===e.RIGHT_BUTTON&&e.pressed&&!this._restricted)if(this._isPanorama)this._panoramaMouseMove(e);else{this._saveFPV(!1),this._exitTransit(),this._camera.pan(e.dx*this._mousePanSpeedScaling,e.dy*this._mousePanSpeedScaling);for(i=1;i<this._cameras.length;i++)this._cameras[i].pan(e.dx*this._mousePanSpeedScaling,e.dy*this._mousePanSpeedScaling)}return 0!==e.getEvent().buttonDown&&this.isOrthoView&&(this._viewer.notifyEventListener("exitOrthoView"),this.isOrthoView=!1),this._isFirstPersonRoaming()&&this._onMouseMoveOfFPR(e),!1},t.prototype._panoramaMouseMove=function(e){this._camera.rotate(-e.dx*this._mouseRotateSpeedScaling,-e.dy*this._mouseRotateSpeedScaling);for(var t=1;t<this._cameras.length;t++)this._cameras[t].rotate(-e.dx*this._mouseRotateSpeedScaling,-e.dy*this._mouseRotateSpeedScaling)},t.prototype._onMouseMoveOfFPR=function(e){var t=e.getEvent().buttonDown,r=e.moved,i=t&&r,n=this._viewer.getElapsedFrames();if(i)this._normalDepth.dirtyAt(n);else{var a=!this._camera.updated,o=this._normalDepth.canUpdateAt(n);if(r&&a&&o)this._normalDepth.render(this._renderer,this._camera);else{var s=this._normalDepth.getNormalDepth(e.x,e.y),l=s||null!=this._getForwardTargetOnBasePlane(e.x,e.y);if(this._hasIntersection!==l&&(this._viewer.notifyEventListener(l?"mouseEnterModel":"mouseLeaveModel"),this._hasIntersection=l),l){var u=this._normalDepth.getNormal()[2];this._viewer.notifyEventListener("gotStandPoint",!s||u>.9?"valid":"invalid")}}}},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype._onMouseUp=function(e){return this._restoreFPV(),this._dealFirstPersonRoaming(e),this._animatorWalking.stop(),!1},t.prototype._onMouseWheel=function(e){if(this._exitTransit(),this._restoreFPV(),this._isFirstPersonRoaming()&&(this._normalDepth.dirtyAt(this._viewer.getElapsedFrames()),this._firstStandPointSetted))return this._stopNavigation(),e.delta>0?this._moveForward(4):this._moveBackward(4),!0;this._saveFPV(!1);var t=e.delta*this._mouseZoomSpeedScaling;this._camera.zoom(t,e.x*s.a.devicePixelRatio,e.y*s.a.devicePixelRatio);for(var r=1;r<this._cameras.length;r++)this._cameras[r].zoom(t,e.x*s.a.devicePixelRatio,e.y*s.a.devicePixelRatio);return!1},t.prototype._onMouseDbClick=function(e){var t;if(!this._dbclickEnabled)return!1;if(this._isFirstPersonRoaming())return!1;if(this._camera.isFirstPerson())return!1;this._exitTransit();var r=this._depthQuery.unproject(e.x,e.y,this._renderer,this._camera);return!!r&&(this._camera.lookTo(r),!this.isOrthoView||(null===(t=this._eventEmitter)||void 0===t||t.emit("exitOrthoView"),this.isOrthoView=!1,!0))},t.prototype._postEventsByTouchMove=function(){var e,t;null===(e=this._eventEmitter)||void 0===e||e.emit("getMapPosition"),this.isOrthoView&&(this.isOrthoView=!1,null===(t=this._eventEmitter)||void 0===t||t.emit("exitOrthoView"))},t.prototype._rotateByTouch=function(e){this._restoreFPV();var t=e.cursor(0),r=this._isPanorama||this._firstStandPointSetted?-t.dx:+t.dx,i=this._isPanorama||this._firstStandPointSetted?-t.dy:+t.dy;return this._camera.rotate(r*this._touchRotateSpeedScaling,i*this._touchRotateSpeedScaling),!0},t.prototype._moveOrScaleByTouch=function(e){return this._moveInSameDirection(e)?this._moveByTouch(e):this._scaleByTouch(e)},t.prototype._getMoveDistance=function(e){for(var t=0,r=0,i=0;i<e.numCursors;++i){var n=e.cursor(i);t+=n.dx,r+=n.dy}return[t*=this._touchPanSpeedScaling/e.numCursors,r*=this._touchPanSpeedScaling/e.numCursors]},t.prototype._moveByTouch=function(e){this._restoreFPV(),this._saveFPV(!1);var t=Yr(this._getMoveDistance(e),2),r=t[0],i=t[1];return this._camera.pan(r,i),!0},t.prototype._getZoomOffset=function(e){var t=e.cursor(0),r=e.cursor(1),i=t.x-t.dx,n=t.y-t.dy,a=i-(r.x-r.dx),o=n-(r.y-r.dy),s=Math.sqrt(a*a+o*o);a=t.x-r.x,o=t.y-r.y;var l=Math.sqrt(a*a+o*o)-s;return Math.sign(l)*this._touchZoomSpeedScaling},t.prototype._scaleByTouch=function(e){this._restoreFPV(),this._saveFPV(!1);var t=this._getZoomOffset(e);return this._camera.zoom(t),!0},t.prototype._onTouchMove=function(e){return!this._firstStandPointSetted&&(this._exitTransit(),this._postEventsByTouchMove(),this._dealDefaultOperationsByTouch(e),!0)},t.prototype._checkFirstMoveTime=function(){null===this._touchMoveInPointOneSecond&&(this._touchMoveInPointOneSecond=Date.now()-this._touchStartTime<100)},t.prototype._dealDefaultOperationsByTouch=function(e){switch(e.numCursors){case 1:return this._rotateByTouch(e);case 2:return this._moveOrScaleByTouch(e);default:return this._moveByTouch(e)}},t.prototype._dealFirstPersonRoamingByTouch=function(e){switch(e.numCursors){case 1:return this._travelingOrRotating(e);case 2:return this._adjustHeightOrFov(e);default:return this._adjustPosition(e)}},t.prototype._travelingOrRotating=function(e){return this._touchMoveInPointOneSecond?this._rotateByTouch(e):this._traveling(e)},t.prototype._traveling=function(e){var t=e.cursor(0);this._touchMoveDistanceX+=t.dx,this._touchMoveDistanceY+=t.dy;var r=[-this._touchMoveDistanceX,-this._touchMoveDistanceY,0];return this._travel(r),!0},t.prototype._moveInSameDirection=function(e){var t=e.cursor(0),r=e.cursor(1);return t.dx*r.dx+t.dy*r.dy>0},t.prototype._adjustHeightOrFov=function(e){return this._moveInSameDirection(e)?this._adjustHeight(e):this._adjustFov(e)},t.prototype._adjustHeight=function(e){var t=Yr(this._getMoveDistance(e),2),r=(t[0],t[1]);r*=-.002,r=Math.min(r,2.2*3.2808-this.ORDINARY_PEOPLE_HEIGHT),r=Math.max(r,.2*3.2808-this.ORDINARY_PEOPLE_HEIGHT),this.ORDINARY_PEOPLE_HEIGHT+=r;var i=this._camera._at;return i[2]+=r,this._camera.restore(Qr(Qr({},this._camera.dump()),{at:i})),this._viewer.invalidate(16),!0},t.prototype._adjustFov=function(e){var t=20*this._getZoomOffset(e),r=this._camera._fov+t;return r=Math.max(r,20),r=Math.min(r,120),this._camera.setTargetFov(r),this._viewer.invalidate(16),!0},t.prototype._adjustPosition=function(e){var t=this._camera._at,r=Yr(this._getMoveDistance(e),2),i=(r[0],r[1]);return i*=-.01,t[2]+=i,this._camera.restore(Qr(Qr({},this._camera.dump()),{at:t})),this._viewer.invalidate(16),!0},t.prototype._onTouchStart=function(e){return this._touchMoveDistanceX=0,this._touchMoveDistanceY=0,this._touchStartTime=Date.now(),e.isDoubleClick&&window.getSelection&&window.getSelection().removeAllRanges(),!1},t.prototype._onTouchDbClick=function(e){if(this._firstStandPointSetted)return this.resetFirstPersonView(!1),!0;var t=e.cursor(0),r=t.x,i=t.y;return this._setupFirstStandPoint(r,i)},t.prototype._onTouchStop=function(e){if(!this._isFirstPersonRoaming())return!1;if(e.isDoubleClick)return!1;var t=e.cursorStopped;return t.moved?e.numCursors>2?this._dropAtFloor():(this._touchMoveInPointOneSecond=null,this._animatorWalking.stop(),!1):this._roamingTo(t.x,t.y)},t.prototype._dropAtFloor=function(){var e=Array.from(this._camera.getEye()),t=this._depthQuery.getHeightUnder(e,this._renderer);if(!t)return!1;var r=this._camera._at;return r[2]+=t-e[2]+this.ORDINARY_PEOPLE_HEIGHT,this._camera.restore(Qr(Qr({},this._camera.dump()),{at:r})),this._viewer.invalidate(),!0},t.prototype.setKeyboardEnable=function(e){this.keyboardEnable=e},t.prototype._rotateLeft=function(){this._saveFPV(!0),this._camera.rotate(-this._keyRotateSpeed,0)},t.prototype._rotateRight=function(){this._saveFPV(!0),this._camera.rotate(+this._keyRotateSpeed,0)},t.prototype._rotateUp=function(){this._saveFPV(!0),this._camera.rotate(0,-.5*this._keyRotateSpeed)},t.prototype._rotateDown=function(){this._saveFPV(!0),this._camera.rotate(0,.5*this._keyRotateSpeed)},t.prototype._moveForward=function(e){void 0===e&&(e=1),this._restricted||(this._saveFPV(!1),this._isFirstPersonRoaming()?this._camera.moveForward(this._keyPanSpeed*e,!0):this._camera.forward(this._keyForwardSpeed*e))},t.prototype._moveBackward=function(e){void 0===e&&(e=1),this._restricted||(this._saveFPV(!1),this._isFirstPersonRoaming()?this._camera.moveBackward(this._keyPanSpeed*e,!0):this._camera.forward(-this._keyForwardSpeed*e))},t.prototype._moveLeft=function(e){void 0===e&&(e=1),this._restricted||(this._saveFPV(!1),this._camera.moveLeft(this._keyPanSpeed*e))},t.prototype._moveRight=function(e){void 0===e&&(e=1),this._restricted||(this._saveFPV(!1),this._camera.moveRight(this._keyPanSpeed*e))},t.prototype._moveUp=function(){this._restricted||(this._saveFPV(!1),this._isFirstPersonRoaming()?this._camera.moveUp(this._keyPanSpeed):this._camera.forward(this._keyForwardSpeed,this._dirUp))},t.prototype._moveDown=function(){this._restricted||(this._saveFPV(!1),this._isFirstPersonRoaming()?this._camera.moveDown(this._keyPanSpeed):this._camera.forward(this._keyForwardSpeed,this._dirDown))},t.prototype._onKeyDown=function(e){return!!this.keyboardEnable&&(this._stopNavigation(),!!e.repeat&&(this._onFirstPersonRoaming(e.key),!1))},t.prototype._onKeyUp=function(e){return!!this.keyboardEnable&&(this._onSwitch(e.key)||this._onFirstPersonRoaming(e.key))},t.prototype._isFirstPersonRoaming=function(){return this._mode===Xt.FirstPersonRoaming},t.prototype._onSwitch=function(e){switch(e){case"m":this.setMode(Xt.Default);break;case"M":this.setMode(Xt.FirstPersonRoaming);break;default:return!1}return!0},t.prototype._onFirstPersonRoaming=function(e){var t=!1;switch(e){case"ArrowLeft":case"a":case"A":case"ArrowRight":case"d":case"D":case"ArrowUp":case"w":case"W":case"ArrowDown":case"s":case"S":case"e":case"E":case"q":case"Q":case"f":case"F":case"r":case"R":t=!0}switch(t&&this._exitTransit(),this._restoreFPV(),this._normalDepth.dirtyAt(this._viewer.getElapsedFrames()),e){case"ArrowLeft":case"a":case"A":this._rotateLeft();break;case"ArrowRight":case"d":case"D":this._rotateRight();break;case"ArrowUp":case"w":case"W":this._moveForward();break;case"ArrowDown":case"s":case"S":this._moveBackward();break;case"e":case"E":this._moveDown();break;case"q":case"Q":this._moveUp();break;case"f":case"F":this._rotateDown();break;case"r":case"R":this._rotateUp();break;default:return!1}return!0},t.prototype._exitTransit=function(){this._restricted||this._camera.animator instanceof yr.a&&this._camera.animator.stop()},t.prototype.setCamera=function(e,t){void 0===t&&(t=0),this._cameras=[];for(var r=0;r<e.length;r++)this._cameras.push(e[r]);this._camera=this._cameras[t]},t.prototype.exitOrthoView=function(){this.isOrthoView&&(this._eventEmitter.emit("exitOrthoView"),this.isOrthoView=!1)},t.prototype.setTransitionSpeed=function(e){this._animatorTransition.setTransitionSpeed(e)},t.prototype.setInputSensitivity=function(e){for(var t in e)switch(t){case"touchPan":this._touchPanSpeedScaling=e[t]*s.a.devicePixelRatio;break;case"touchZoom":this._touchZoomSpeedScaling=e[t]*Math.sqrt(s.a.devicePixelRatio);break;case"touchRotate":this._touchRotateSpeedScaling=e[t]*s.a.devicePixelRatio;break;case"mousePan":this._mousePanSpeedScaling=e[t];break;case"mouseZoom":this._mouseZoomSpeedScaling=e[t],this._camera.setZoomMinMax(e[t]);break;case"mouseRotate":this._mouseRotateSpeedScaling=e[t];break;case"keyPan":this._keyPanSpeed=e[t];break;case"keyForward":this._keyForwardSpeed=e[t]}},t.prototype.setInAppNaviAdjusting=function(e){this._adjusting=e},t.prototype.setPanoramaEnabled=function(e){this._isPanorama=e},t.prototype.setRestrictedViewEnabled=function(e){this._restricted=e},t.prototype.isRestrictedViewEnabled=function(){return this._restricted},t.prototype.recompileShader=function(e){if(this._scene){e.slice(0);e.push("CLIPPING"),Tr.a.compressNormals&&e.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&e.push("DOUBLESIDED"),this._depthQuery.recompileShader(this._resourceManager,e)}},t.prototype.unproject=function(e,t){return this._depthQuery.unproject(e,t,this._renderer,this._camera)},t.prototype.setZoomSpeed=function(e){this._mouseZoomSpeedScaling=e},t.prototype.setPanSpeed=function(e){this._mousePanSpeedScaling=e},t.prototype.resetFirstPersonView=function(e){var t;this._isFPV=e,this._hasSavedFPV=!1,null===(t=this._animatorRoaming)||void 0===t||t.detach(),this._animatorNavigation.stop(!0),e||this.setMode(Xt.Default)},t.prototype.switchToUserView=function(e,t){this._restoreFPV(),e&&(this._scene.setActiveView(e.name),this._scene.clipping.reset(),this._camera.animator instanceof yr.a&&this._camera.animator.stop(),this._animatorTransition.attach(this._camera),this._animatorTransition.start(e,t),this._orientation&&this._orientation.enabled&&this._orientation.reset(this._camera))},t.prototype._restoreFPV=function(){this._hasSavedFPV&&(this._hasSavedFPV=!1,this._camera.setFirstPerson(this._isFPV))},t.prototype.setDblclickEnabled=function(e){this._dbclickEnabled=e},t.prototype._saveFPV=function(e){this._hasSavedFPV||(this._isFPV=this._camera.isFirstPerson(),this._hasSavedFPV=!0,this._camera.setFirstPerson(e))},t.prototype.setMode=function(e){this._mode=e,this._hasIntersection=!1,this._firstStandPointSetted=!1,this._camera.setFirstPerson(!1,!1),this._isFirstPersonRoaming()&&(this._camera.setPerspective(!0),this._normalDepth.dirtyAt(0)),e==Xt.FirstPersonRoaming?this._markBasePlane():this._removeBasePlane()},t.prototype.resize=function(e,t){this._normalDepth&&this._normalDepth.resize(e,t)},t.prototype.enableLeftButtonClick=function(e){this._clickEnabled=e},t.prototype.getPersonHeight=function(){return this.ORDINARY_PEOPLE_HEIGHT*V.a.Foot2Meter},t.prototype.setPersonHeight=function(e){e*=V.a.Meter2Foot;var t=this._camera._at;t[2]+=e-this.ORDINARY_PEOPLE_HEIGHT,this._camera.restore(Qr(Qr({},this._camera.dump()),{at:t})),this._viewer.invalidate(16),this.ORDINARY_PEOPLE_HEIGHT=e},t.prototype.setStandPointHeight=function(e){e*=V.a.Meter2Foot;var t=this._camera.getEye(),r=this._camera._at;r[2]+=e+this.ORDINARY_PEOPLE_HEIGHT-t[2],this._camera.restore(Qr(Qr({},this._camera.dump()),{at:r})),this._viewer.invalidate(16)},t.prototype.getStandPointHeight=function(){return(this._camera.getEye()[2]-this.ORDINARY_PEOPLE_HEIGHT)*V.a.Foot2Meter},t.prototype.setCameraFOV=function(e){this._camera.setTargetFov(e),this._viewer.invalidate(16)},t.prototype.getCameraFOV=function(){return this._camera._fov},t.prototype.getTravelSpeed=function(){return[this._animatorWalking.getMoveSpeed(),this._animatorWalking.getRotateSpeed()]},t.prototype.setTravelSpeed=function(e){this._animatorWalking.setMoveSpeed(e[0]),this._animatorWalking.setRotateSpeed(e[1])},t}(gr.a),Zr=r(28),Kr=function(){function e(e){this._viewer=e;var t=[0,0,this._viewer.getCanvas().width,this._viewer.getCanvas().height];this._viewer?this._scene=e.getScene():this._scene=null,this._manipulator=null,this._scene?this.core=new vr(this._scene.core,t):this.core=new vr(null,t),this._animator=new yr.a(e.getEventEmitter()),this.cores=[],this.cores.push(this.core)}return e.prototype.destroy=function(){this.core=null,delete this.core;for(var e=0;e<this.cores.length;e++)this.cores[e].destroy();this.cores=null,delete this.cores,this._manipulator&&(this._manipulator.destroy(),this._manipulator=null,delete this._manipulator),this._viewer&&(this._viewer=null,delete this._viewer),this._scene=null,delete this._scene},e.prototype.update=function(){return this.core.update()},e.prototype.setFov=function(e){this.core.setTargetFov(e),this._viewer&&this._viewer.invalidate()},e.prototype.setFirstPersonViewEnabled=function(e){this.core.setFirstPerson(e)},e.prototype.isFirstPersonViewEnabled=function(){return this.core.isFirstPerson()},e.prototype.setRestrictedViewEnabled=function(e){this.core.setFirstPerson(e),this._manipulator.setRestrictedViewEnabled(e)},e.prototype.isRestrictedViewEnabled=function(){return this.core.isFirstPerson()&&this._manipulator.isRestrictedViewEnabled()},e.prototype.switchToTopView=function(){this.switchToView(4)},e.prototype.switchToBottomView=function(){this.switchToView(5)},e.prototype.switchToLeftView=function(){this.switchToView(2)},e.prototype.switchToRightView=function(){this.switchToView(3)},e.prototype.switchToFrontView=function(){this.switchToView(0)},e.prototype.switchToBackView=function(){this.switchToView(1)},e.prototype.switchToView=function(e){var t=[[0,-.5*Math.PI],[0,.5*Math.PI],[0,Math.PI],[0,0],[.49999*Math.PI,.49999*-Math.PI],[-.49999*Math.PI,.49999*-Math.PI]],r=null;if(e>=Zr.a.FRONT&&e<=Zr.a.BOTTOM){r=t[e];for(var i=0;i<this.cores.length;i++)this.cores[i].reset(!1),this.cores[i].rotateTo(r[0],r[1])}else{for(i=0;i<this.cores.length;i++)this.cores[i].setFirstPerson(!1),this.cores[i].setPerspective(!0);this._viewer.getEventEmitter().emit("orthoViewChanged",!0);for(i=0;i<this.cores.length;i++)this.cores[i].reset(!1);this.core.reset(!1)}},e.prototype.setSensitivity=function(e){this._manipulator.setInputSensitivity(e)},e.prototype.addInput=function(e){this._manipulator||(this._manipulator=new Xr(this._viewer)),this._manipulator.addInput(e)},e.prototype.resize=function(e,t){for(var r=[0,0,e,t],i=0;i<this.cores.length;i++)this.cores[i].setViewport(r),this.cores[i].update()},e.prototype.transformToPerspective=function(){for(var e=0;e<this.cores.length;e++)this.cores[e].transformOrthogonalToPerspective();this._viewer&&(this._viewer.invalidate(),this._viewer.getEventEmitter().emit("orthoViewChanged",!1))},e.prototype.transformToOrthogonal=function(){for(var e=0;e<this.cores.length;e++)this.cores[e].transformPerspectiveToOrthogonal();this._viewer&&(this._viewer.invalidate(),this._viewer.getEventEmitter().emit("orthoViewChanged",!0))},e.prototype.getData=function(){return this.core.dump()},e.prototype.setData=function(e,t){void 0===t&&(t=!1),t?(this.core.animator instanceof yr.a&&this.core.animator.stop(!0),this._animator.attach(this.core),this._animator.start(e,!1)):this.core.restore(e)},e.prototype.switchToWorldView=function(){for(var e=0;e<this.cores.length;e++)this.cores[e].setFirstPerson(!1),this.cores[e].setPerspective(!0);this._viewer.getEventEmitter().emit("orthoViewChanged",!1);for(e=0;e<this.cores.length;e++)this.cores[e].reset(!1)},e.prototype.project=function(e,t){return this.core.project(e,t)},e.prototype.unproject=function(e,t){return this._manipulator.unproject(e,t)},e.prototype.rotate=function(e,t){this.core.rotate(e,t)},e.prototype.getViewDirection=function(){return this.core.getViewDirection()},e.prototype.setMinPitchAngle=function(e){for(var t=0;t<this.cores.length;t++)this.cores[t].setMinPitchAngle(e)},e.prototype.setMaxPitchAngle=function(e){for(var t=0;t<this.cores.length;t++)this.cores[t].setMaxPitchAngle(e)},e.prototype.setMaxTargetDistanceRatio=function(e){for(var t=0;t<this.cores.length;t++)this.cores[t].setMaxTargetDistanceRatio(e)},e.prototype.setMinTargetDistanceRatio=function(e){for(var t=0;t<this.cores.length;t++)this.cores[t].setMinTargetDistanceRatio(e)},e.prototype.setNearPlaneDistanceRatio=function(e){for(var t=0;t<this.cores.length;t++)this.cores[t].setMinZnearRatio(e)},e.prototype.setMouseZoomSpeed=function(e){this._manipulator.setZoomSpeed(e)},e.prototype.setMousePanSpeed=function(e){this._manipulator.setPanSpeed(e)},e.prototype.setTransitionSpeed=function(e){this._manipulator.setTransitionSpeed(e)},e.prototype.calc360WorldPoint=function(e,t){return[e[0]-t[0],e[1]-t[1],t[2]-e[2]]},e.prototype.autoProductPanoramas=function(e,t,r){for(var i=[],n=r||[],a=0;a<e.length;a++){var o={visibleindexs:[],visiblePoints:[]},s=e[a];if(o.position=s,n[a]){var l=n[a].at,u=Math.sqrt((s[0]-l[0])*(s[0]-l[0])+(s[1]-l[1])*(s[1]-l[1])+(s[2]-l[2])*(s[2]-l[2]));o.cameraData360={phi:-n[a].phi,theta:n[a].theta,fov:this.core._fov,at:[15*(s[0]-l[0])/u,15*(s[1]-l[1])/u,15*(l[2]-s[2])/u],distance:15}}o.name=t?t[a]:"360Panorama"+a;var c=s;if(a>0){var h=e[a-1],d=this.calc360WorldPoint(c,h);o.visibleindexs.push(a-1),o.visiblePoints.push(d)}if(a+1<e.length){var p=e[a+1];d=this.calc360WorldPoint(c,p);o.visibleindexs.push(a+1),o.visiblePoints.push(d)}i.push(o)}return i},e.prototype.getEye=function(){return this.core.eye},e.prototype.getAt=function(){return this.core._at},e.prototype.getNear=function(){return this.core._znear},e.prototype.getFar=function(){return this.core._zfar},e.prototype.getRotation=function(){var e=this.core._theta;return{phi:this.core._phi,theta:e%=2*Math.PI}},e.prototype.setCameraGesture=function(e,t,r){this.core.rotateTo(t,r),this.core.setTargetAt(e),this._viewer.invalidate()},e.prototype.setZoomRange=function(e,t){this.core.setZoomRange(e,t),this._viewer.invalidate()},e.prototype.setTargetAt=function(e){this.core.setTargetAt(e),this._viewer.invalidate()},e.prototype.setDistance=function(e){this.core.setDistance(e),this._viewer.invalidate()},e.prototype.setNavigationTypeEnabled=function(e,t){this.core.setNavigationEnabled(e,t)},e.prototype.rotateTo=function(e,t){this.core.rotateTo(e,t),this._viewer.invalidate()},e.prototype.enabledTwoPointsPerspective=function(e){this.core.enabledTwoPointsPerspective(e)},e.prototype.setRotationRange=function(e,t,r){this.core.setRotationRange(e,t,r)},e.prototype.isPerspective=function(){return this.core.isPerspective()},e.prototype.setKeyboardEnable=function(e){this._manipulator.setKeyboardEnable(e)},e.prototype.switchToUserView=function(e,t){this._manipulator.switchToUserView(e,t)},e.prototype.setDblclickEnabled=function(e){this._manipulator.setDblclickEnabled(e)},e.prototype.transformProperty=function(e){return this.core.transformProperty(e)},e.prototype.getManipulator=function(){return this._manipulator},e}(),Jr=r(37),$r=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ei=function(e){function t(t){var r=e.call(this,t)||this;return r.setSide(N.a.DOUBLESIDE),r}return $r(t,e),t.prototype.attachShader=function(t,r){if(!t||!t.ready)return t;for(var i in e.prototype.attachShader.call(this,t,r),t.reservedUniforms)this.reservedParameters.hasOwnProperty(i)||("m_uBlitTexture"===i?(this.reservedParameters[i]=new C.a,this.hasTexture=!0,this.reservedParameters[i].texUnit=4,this.reservedParameters[i].upload=this.reservedParameters[i].uploadTexture):"m_uBlitDepthTexture"===i?(this.reservedParameters[i]=new C.a,this.hasTexture=!0,this.reservedParameters[i].texUnit=6,this.reservedParameters[i].upload=this.reservedParameters[i].uploadTexture):"m_uInvResolution"===i?(this.reservedParameters[i]=new C.a,this.reservedParameters[i].upload=this.reservedParameters[i].uploadValue,this.reservedParameters[i].value=[1,1]):"m_uForeground"===i&&(this.reservedParameters[i]=new C.a,this.reservedParameters[i].texUnit=5,this.reservedParameters[i].upload=this.reservedParameters[i].uploadTexture));return t},t.prototype.setTexture=function(e){this.reservedParameters.m_uBlitTexture.value=e},t.prototype.setForegroundTexture=function(e){this.reservedParameters.m_uForeground.value=e},t.prototype.setDepthTexture=function(e){this.reservedParameters.m_uBlitDepthTexture.value=e},t.prototype.setInvResolution=function(e){this.reservedParameters.m_uInvResolution&&(this.reservedParameters.m_uInvResolution.value=e)},t}(N.b),ti=function(){function e(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1),this._resourceManager=e,t||(t=k.a.blit),this._shader=e.getShader(t.name,[]),this._shader.ready||this._shader.createFromShaderSource(t,r?["MOBILE"]:[]),this.ready=this._shader.ready,this.ready?(this._material=new ei(t.name),this._material.attachShader(this._shader)):this._material=null}return e.prototype.destroy=function(){this.ready&&(this._material.destroy(),this._material=null,delete this._material,this._shader.destroy(),this._shader=null,delete this._shader,this.ready=!1),this._resourceManager=null,delete this._resourceManager},e.prototype.setTexture=function(e){this._material.setTexture(e)},e.prototype.setForegroundTexture=function(e){this._material.setForegroundTexture(e)},e.prototype.setDepthTexture=function(e){this._material.setDepthTexture(e)},e.prototype.setParameter=function(e,t){this._material.parameters[e].value=t},e.prototype.render=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.ready&&t.ready){var n=this._shader.getGL(),a=t.getOption("depthMask");t.setOption("depthMask",!1);var o=i?n.GREATER:n.ALWAYS,s=t.getOption("depthFunc");t.setOption("depthFunc",o);var l=t.getOption("blend");t.setOption("blend",r||!1);var u=[1/t.getWidth(),1/t.getHeight()];this._material.setInvResolution(u),t.always=!0,e.drawScreen(t,this._shader,this._material),t.setOption("depthMask",a),t.setOption("depthFunc",s),t.setOption("blend",l),e.renderState.blend(t.getOption("blend")),e.renderState.depthTest(t.getOption("depthTest"),t.getOption("clearDepth"),t.getOption("depthFunc")),e.renderState.depthMask(t.getOption("depthMask"));var c=this._material.parameters;for(var h in c)c[h].texUnit>=0&&(n.activeTexture(n.TEXTURE0+c[h].texUnit),n.bindTexture(n.TEXTURE_2D,null))}},e.prototype.recompile=function(e,t){var r,i=this._shader,n=i.flags.lastIndexOf(e),a=!1;if(t?-1===n&&(r=i.flags.concat(e),a=!0):-1!==n&&((r=i.flags.slice(0)).splice(n,1),a=!0),a){var o=i.shaderSource.name,s=this._resourceManager.getShader(o,r);if(!s.ready&&(s.createFromShaderSource(i.shaderSource,r),!s.ready))throw new Error("Failed to create shader '"+o+"'!");this._shader=s,this._material.attachShader(this._shader)}},e}(),ri=function(){function e(e,t,r,i){this._color=new Float32Array([1,0,0,1]),this._blitContour=null,this._blitOverlay=null,this._shaders=[null,null,null],this._material=null,this._ready=!1,this._rtDepth=null,this._rtColor=null,this._rtDefault=null,this._rtProgressively=null,this._rtContour=null,this._resourceManager=null,this._resourceManager=e;var n=e,a=n.gl,o=r,s=i;this._blitContour=new ti(e,k.a.contour),this._blitOverlay=new ti(e,k.a.contouroverlay),this._rtDepth=new wr.a("contour-drawablesdepth",n,o,s,{depthBuffer:1,colorBuffer:0,colorMask:[0,0,0,0]}),this._rtColor=new wr.a("contour-drawablescolor",n,o,s,{depthBuffer:1,colorBuffer:0,clearColor:[0,0,0,0],depthFunc:a.EQUAL}),this._rtContour=new wr.a("contour",n,o,s,{depthBuffer:1,colorBuffer:1,clearColor:[1,0,0,0],depthTest:!1}),this._rtDefault=new wr.a(a.isWebGL2?"pipeline":"default",n,o,s,{blend:!0,depthTest:!1}),this._rtProgressively=new wr.a("pipeline-pr",n,o,s,{blend:!0,depthTest:!1}),this._ready=this._rtDepth.ready&&this._rtColor.ready&&this._rtContour.ready&&this._rtDefault.ready,this._ready?(this._material=t.materialManager.createMaterialAdhoc("contour"),this._blitContour.setTexture(this._rtColor.getColorBuffer()),this._blitOverlay.setTexture(this._rtContour.getColorBuffer()),this.recompileShader(e,{section:!1})):(this._rtDepth.destroy(),this._rtColor.destroy(),this._rtContour.destroy(),this._rtDefault.destroy(),this._blitContour.destroy(),this._blitOverlay.destroy(),this._material.destroy())}return e.prototype.destroy=function(){this._ready&&(this._rtColor.destroy(),this._rtDepth.destroy(),this._rtDefault.destroy(),this._rtContour.destroy(),this._blitContour.destroy(),this._blitOverlay.destroy(),this._material.destroy())},e.prototype.setColor=function(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._color[3]=e[3]},e.prototype.resize=function(e,t){this._ready&&(this._rtColor.resize(e,t),this._rtDepth.resize(e,t),this._rtContour.resize(e,t),this._rtDefault.resize(e,t),this._ready=this._rtColor.ready&&this._rtDepth.ready&&this._rtContour.ready&&this._rtDefault.ready)},e.prototype.recompileShader=function(e,t){var r=[];t.section&&r.push("CLIPPING"),this._shaders[0]=e.getShader("constant",r),this._shaders[0].ready||this._shaders[0].createFromShaderSource(k.a.constant,r),r.push("MODEL_TRANSFORM"),this._shaders[1]=e.getShader("constant",r),this._shaders[1].ready||this._shaders[1].createFromShaderSource(k.a.constant,r),r.push("INSTANCING"),this._shaders[2]=e.getShader("constant",r),this._shaders[2].ready||this._shaders[2].createFromShaderSource(k.a.constant,r),this._material.attachShader(this._shaders[0],this._resourceManager),this._material.setDiffuse([1,0,0]),this._material.setTransparent(1)},e.prototype.render=function(e,t,r,i){this._ready&&(this._genContourOfSelectedDrawable(e,t,r,i),this._blitContourToDefaultFrameBuffer(e))},e.prototype.renderProgressively=function(e,t,r,i){this._ready&&(this._genContourOfSelectedDrawable(e,t,r,i),this._blitContourToPrFrameBuffer(e))},e.prototype._genContourOfSelectedDrawable=function(e,t,r,i){this._checkClipping(t,e),this._drawSceneDepth(t,e,i),this._drawSelectedDrawableWithRedColor(r,e,i,t.clipping),this._extractContourFromColorBuffer(e)},e.prototype._checkClipping=function(e,t){e.clipping.isEnabled()&&t.renderState.invalidateClip()},e.prototype._drawSceneDepth=function(e,t,r){var i=this._resourceManager.gl;t.clear(this._rtDepth,i.DEPTH_BUFFER_BIT),t.drawDrawables(this._rtDepth,e.getAllDrawablesWithoutLines(),r,this._shaders,this._material,e.clipping,null,null,null,!1)},e.prototype._drawMarksDepth=function(e,t,r,i){if(i&&0!==i.length){var n=this._resourceManager.gl;t.clear(this._rtDepth,n.DEPTH_BUFFER_BIT),t.drawDrawables(this._rtDepth,i,r,this._shaders,this._material,e.clipping,null,null,null,!1)}},e.prototype._drawSelectedDrawableWithRedColor=function(e,t,r,i){var n=this._resourceManager.gl;t.clear(this._rtColor,n.COLOR_BUFFER_BIT),t.drawDrawables(this._rtColor,e,r,this._shaders,this._material,i,null,null,null,!1)},e.prototype._extractContourFromColorBuffer=function(e){var t=this._resourceManager.gl;e.clear(this._rtContour,t.COLOR_BUFFER_BIT),this._blitContour.render(e,this._rtContour)},e.prototype._blitContourToDefaultFrameBuffer=function(e){this._blitOverlay.setParameter("uColor",this._color),this._blitOverlay.render(e,this._rtDefault,!0)},e.prototype._blitContourToPrFrameBuffer=function(e){this._blitOverlay.setParameter("uColor",this._color),this._blitOverlay.render(e,this._rtProgressively,!0)},e.prototype.renderMarkProgressively=function(e,t,r,i,n){this._ready&&(this._drawMarksDepth(t,e,i,n),this._drawSelectedDrawableWithRedColor(r,e,i,t.clipping),this._extractContourFromColorBuffer(e),this._blitContourToPrFrameBuffer(e))},e.prototype.renderMark=function(e,t,r,i,n){this._ready&&(this._drawMarksDepth(t,e,i,n),this._drawSelectedDrawableWithRedColor(r,e,i,t.clipping),this._extractContourFromColorBuffer(e),this._blitContourToDefaultFrameBuffer(e))},e}(),ii=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ni=function(e){function t(t){var r=e.call(this,"ChangeMaterial",!0,t)||this;return r._savedColors={},r._savedTransparent={},r._pickedMaterial=null,r._hoveringMaterial=null,r._pickQuery=null,r._contour=null,r._settingMaterial=null,r._savedTexture={},r._savedTextureOption={},r._isSetting=!1,s.a.isMobile?r:(r._savedTexture={},r._savedTextureOption={},r._pickQuery=new Jr.a(r._scene,r._resourceManager),r._contour=new ri(r._resourceManager,r._scene,r._viewer.getWidth(),r._viewer.getHeight()),r._contour.setColor([1,0,0,1]),r)}return ii(t,e),t.prototype.doesSupportMobile=function(e){return!0},t.prototype.destroy=function(){s.a.isMobile||(this._contour.destroy(),this._pickQuery.destroy())},t.prototype.resize=function(e,t){s.a.isMobile||this._contour.resize(e,t)},t.prototype.recompileShader=function(e){s.a.isMobile||(this._pickQuery.recompileShader(this._resourceManager,e),this._contour.recompileShader(this._resourceManager,e))},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"ChangeMaterial"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"ChangeMaterial")},t.prototype._registerTouchEvents=function(e){},t.prototype._onMouseUp=function(e){return!(!this._enabled||e.moved)&&(this._onInputStop(),!0)},t.prototype._onMouseMove=function(e){return!!this._enabled&&((0===e.getEvent().buttonDown||!e.isCameraManipulated)&&(this._onInputStart(e.x,e.y),!1))},t.prototype._getCompatibleMaterialNameOf=function(e){var t,r=e.split(".");return r.length>1?(t=(t=r[r.length-2]).replace(/\:/g,"_"),r[r.length-2]=t,r.join(".")):(t=(t=r[0]).replace(/\:/g,"_"))+"."+r[1]},t.prototype.setMaterialColor=function(e,t){var r=this._getCompatibleMaterialNameOf(e),i=this._scene.materialManager.getModelMaterial(r);i&&(i.setDiffuse(t),this._viewer.invalidate())},t.prototype.setMaterialTransparency=function(e,t){var r=this._getCompatibleMaterialNameOf(e),i=this._scene.materialManager.getMaterial(r);return i?(this._viewer.invalidate(),i.setTransparent(t),this._scene.getDrawablesByMaterialName(r)):null},t.prototype.restoreMaterials=function(){this._pickedMaterial=null,this._hoveringMaterial=null;var e=this._scene.materialManager.getModelMaterials(!0);for(var t in e){var r=e[t],i=this._scene.getDrawablesByMaterialName(this._settingMaterial);if(r instanceof F){if(this._savedTexture[t]){var n=this._resourceManager.getTexture(this._savedTexture[t].name);n.ready=!0,N.b.prototype.setDiffuseTexture.call(r,n,this._resourceManager,i)}else r.hasTexture&&r.removeDiffuseTexture();r.hasTexture&&(this._savedTextureOption[t]?(r.setTextureOffset(this._savedTextureOption[t].offset),r.setTextureScale(this._savedTextureOption[t].scale),r.setTextureRotate(this._savedTextureOption[t].scale[2])):(r.setTextureOffset(new Float32Array([0,0])),r.setTextureScale([1,1]),r.setTextureRotate(0)))}}if(this._savedColors){for(var t in this._savedColors){(r=this._scene.materialManager.getModelMaterial(t))instanceof F&&r.setDiffuse(this._savedColors[t])}for(var t in this._savedTransparent){(r=this._scene.materialManager.getModelMaterial(t)).getTransparent&&r.setTransparent(this._savedTransparent[t])}}},t.prototype.restoreMaterialColor=function(e){this._pickedMaterial=null,this._hoveringMaterial=null;var t=this._getCompatibleMaterialNameOf(e),r=this._scene.materialManager.getModelMaterial(t);this._savedColors[e]&&r instanceof F&&(r.setDiffuse(this._savedColors[t]),r.getTransparent&&r.setTransparent(this._savedTransparent[t]))},t.prototype.backupMaterials=function(){this._savedColors={},this._savedTransparent={},this._savedTexture={},this._savedTextureOption={};var e=this._scene.materialManager.getModelMaterials(!0);for(var t in e){var r=this._scene.materialManager.getModelMaterial(t);if(r&&r.getDiffuseTexture()){if(this._savedTexture[t]=r.getDiffuseTexture(),!(r instanceof F))continue;r._materialTextureOffset&&r._materialTextureOffset[2]&&(this._savedTextureOption[t]={offset:r._materialTextureOffset,scale:r._materialTextureScale})}r.getDiffuse()&&(this._savedColors[t]=r.getDiffuse().slice(0),r.getTransparent&&(this._savedTransparent[t]=r.getTransparent()))}},t.prototype._onEnableChanged=function(){this._pickedMaterial=null,this._hoveringMaterial=null},t.prototype._render=function(){if(this._settingMaterial){var e=this._scene.getDrawablesByMaterialName(this._settingMaterial);this._contour.setColor([.968,.322,.137,1]),this._contour.render(this._renderer,this._scene,e,this._camera)}if(null!==this._pickedMaterial){var t=this._scene.getDrawablesByMaterialName(this._pickedMaterial);this._contour.setColor([.968,.322,.137,1]),this._contour.render(this._renderer,this._scene,t,this._camera)}if(null!==this._hoveringMaterial&&this._hoveringMaterial!==this._pickedMaterial){var r=this._scene.getDrawablesByMaterialName(this._hoveringMaterial);this._contour.setColor([1,.565,.443,1]),this._contour.render(this._renderer,this._scene,r,this._camera)}},t.prototype._renderProgressively=function(){if(this._settingMaterial){var e=this._scene.getDrawablesByMaterialName(this._settingMaterial);this._contour.setColor([.968,.322,.137,1]),this._contour.renderProgressively(this._renderer,this._scene,e,this._camera)}if(null!==this._pickedMaterial){var t=this._scene.getDrawablesByMaterialName(this._pickedMaterial);this._contour.setColor([.968,.322,.137,1]),this._contour.renderProgressively(this._renderer,this._scene,t,this._camera)}if(null!==this._hoveringMaterial&&this._hoveringMaterial!==this._pickedMaterial){var r=this._scene.getDrawablesByMaterialName(this._hoveringMaterial);this._contour.setColor([1,.565,.443,1]),this._contour.renderProgressively(this._renderer,this._scene,r,this._camera)}},t.prototype._onInputStop=function(){if(this._needUpdate=this._hoveringMaterial!==this._pickedMaterial,this._needUpdate)if(this._pickedMaterial=this._hoveringMaterial,this._isSetting&&(this._settingMaterial=this._pickedMaterial,this._pickedMaterial=null,this._viewer.notifyEventListener("mateiralSetting",this._settingMaterial)),this._pickedMaterial){var e=this._scene.materialManager.getModelMaterial(this._pickedMaterial);if(e){var t=e.getDiffuse(),r=function(e){var t=Number(parseInt(e,10));return t>=16?t.toString(16):"0"+t.toString(16)},i="#"+r(255*t[0])+r(255*t[1])+r(255*t[2]);this._viewer.setProgressiveRendering(),this._viewer.notifyEventListener("newMaterialPicked",e,i,e.getTransparent?e.getTransparent():null)}}else this._viewer.invalidate()},t.prototype._onInputStart=function(e,t){var r=this._viewer.isLineRenderingEnabled()?this._scene.getAllDrawables():this._scene.getAllDrawablesWithoutLines(),i=this._pickQuery.pickDrawable(e,t,this._renderer,this._camera,r);if(null===i){if(null===this._hoveringMaterial)return;return this._hoveringMaterial=null,this._viewer.notifyEventListener("nothingSelected"),void this._viewer.setProgressiveRendering()}this._hoveringMaterial!==i.material.name&&(this._hoveringMaterial=i.material.name,this._viewer.notifyEventListener(i.mesh.hasColor()?"textureSelected":"materialSelected"),this._viewer.notifyEventListener("materialHover",i.material),this._viewer.invalidate(10))},t.prototype.getPickedMaterial=function(){return this._pickedMaterial},t.prototype.setSettingEnabled=function(e){this._isSetting=e},t.prototype.setMaterialTexture=function(e,t){var r=this,i=this._getCompatibleMaterialNameOf(e),n=this._scene.materialManager.getModelMaterial(i);if(n&&n.setDiffuseTexture){var a=this._scene.getDrawablesByMaterialName(i);N.b.prototype.setDiffuseTexture.call(n,t,this._resourceManager,a,function(e){r._savedTexture[i]||r._resourceManager.removeTexture(e),r._needUpdate=!0})}else console.warn("There is not material name "+i)},t.prototype.restoreMaterialTexture=function(e){var t=this._getCompatibleMaterialNameOf(e);this._pickedMaterial=null,this._hoveringMaterial=null;var r=this._scene.materialManager.getModelMaterial(t);if(r instanceof F){if(this._savedTexture[e]){var i=this._resourceManager.getTexture(this._savedTexture[t].name);i.ready=!0;var n=this._scene.getDrawablesByMaterialName(t);N.b.prototype.setDiffuseTexture.call(r,i,this._resourceManager,n)}else r.hasTexture&&r.removeDiffuseTexture();r.hasTexture&&(this._savedTextureOption[e]?(r.setTextureOffset(this._savedTextureOption[t].offset),r.setTextureScale(this._savedTextureOption[t].scale),r.setTextureRotate(this._savedTextureOption[t].scale[2])):(r.setTextureOffset(new Float32Array([0,0])),r.setTextureScale([1,1]),r.setTextureRotate(0))),this._savedColors[e]&&(r.setDiffuse(this._savedColors[t]),r.getTransparent&&r.setTransparent(this._savedTransparent[t]),this._needUpdate=!0)}},t.prototype.setMaterialTextureRotate=function(e,t){var r=this._getCompatibleMaterialNameOf(e),i=this._scene.materialManager.getModelMaterial(r);i instanceof F&&(i&&i.setTextureRotate&&i.setTextureRotate(t),this._viewer.invalidate())},t.prototype.setMaterialTextureScale=function(e,t){var r=this._getCompatibleMaterialNameOf(e),i=this._scene.materialManager.getModelMaterial(r);i instanceof F&&(i&&i.setTextureScale&&i.setTextureScale(t),this._viewer.invalidate())},t.prototype.clearPickedMaterial=function(){this._pickedMaterial=null,this._viewer.invalidate()},t.prototype.setHoveringMaterial=function(e){var t=this._getCompatibleMaterialNameOf(e);this._settingMaterial=t,this._viewer.invalidate()},t.prototype.isInteractive=function(){return this._enabled},t}(gr.a),ai=function(){function e(e){this._viewer=e,this._isSketchEnabled=!1,this._isSketchColorEnabled=!1}return e.prototype.onFocusElementEnabled=function(e){e?(this._isSketchEnabled=this._viewer.isEffectEnabled("Sketch"),this._viewer.setSketchEnabled(!1)):this._isSketchEnabled&&(this._viewer.setSketchEnabled(this._isSketchEnabled),this._viewer.setSketchColorEnabled(this._isSketchColorEnabled))},e.prototype.onSkechColorEnableChanged=function(e){this._isSketchColorEnabled=e},e.prototype.onSectionChanged=function(e){var t=this._viewer.getTool("ChangeMaterial");t instanceof ni&&(t.recompileShader({section:e}),this._viewer.getRenderer().renderState.invalidateClip())},e.prototype.onAllDrawablesCreated=function(e){var t=this._viewer.getTool("Section"),r=e.initSection;t&&r&&t.recompileSectionShader()},e}();var oi=function(){function e(){}return e.prototype.transform=function(e){if(this.attributes)for(var t=this.attributes.values[0].stride/4,r=this.attributes.hasNormal,i=[0,0,0,0],n=[0,0,0],a=0,o=this.vertices.length;a<o;a+=t)n[0]=this.vertices[a],n[1]=this.vertices[a+1],n[2]=this.vertices[a+2],U.d.transformMat4(i,n,e),this.vertices[a]=i[0],this.vertices[a+1]=i[1],this.vertices[a+2]=i[2],r&&(n[0]=this.vertices[a+3],n[1]=this.vertices[a+4],n[2]=this.vertices[a+5],n[3]=0,U.e.transformMat4(i,n,e),U.d.normalize(i,i),this.vertices[a+3]=i[0],this.vertices[a+4]=i[1],this.vertices[a+5]=i[2])},e.prototype.rotate=function(e,t,r){var i=U.a.create(),n=U.a.create();U.a.rotateZ(i,n,r),U.a.rotateY(n,i,t),U.a.rotateX(i,n,e),this.transform(i)},e.prototype.translate=function(e,t,r){var i=U.a.create();U.a.fromTranslation(i,[e,t,r]),this.transform(i)},e.prototype.scale=function(e,t,r){var i=U.a.create();U.a.fromScaling(i,[e,t,r]),this.transform(i)},e.prototype.merge=function(e,t){if(e.attributes.values[0].stride===t.attributes.values[0].stride){var r,i,n=new Float32Array(e.vertices.length+t.vertices.length);for(r=0;r<e.vertices.length;r++)n[r]=e.vertices[r];for(r=0,i=e.vertices.length;r<t.vertices.length;r++,i++)n[i]=t.vertices[r];var a=new Uint16Array(e.indices.length+t.indices.length);for(r=0;r<e.indices.length;r++)a[r]=e.indices[r];var o=e.vertices.length/(e.attributes.values[0].stride/4);for(r=0,i=e.indices.length;r<t.indices.length;r++,i++)a[i]=t.indices[r]+o;this.vertices=n,this.indices=a,this.attributes=e.attributes,this.indexType=te.a.UNSIGNED_SHORT}},e.prototype.createWiredCube=function(e){void 0===e&&(e=1);var t=new Float32Array(24),r=new Uint8Array(24);t[0]=-e,t[1]=-e,t[2]=-e,t[3]=e,t[4]=-e,t[5]=-e,t[6]=e,t[7]=e,t[8]=-e,t[9]=-e,t[10]=e,t[11]=-e,t[12]=-e,t[13]=-e,t[14]=e,t[15]=e,t[16]=-e,t[17]=e,t[18]=e,t[19]=e,t[20]=e,t[21]=-e,t[22]=e,t[23]=e,r[0]=0,r[1]=1,r[2]=1,r[3]=2,r[4]=2,r[5]=3,r[6]=3,r[7]=0,r[8]=0,r[9]=4,r[10]=1,r[11]=5,r[12]=2,r[13]=6,r[14]=3,r[15]=7,r[16]=4,r[17]=5,r[18]=5,r[19]=6,r[20]=6,r[21]=7,r[22]=7,r[23]=4,this.vertices=t,this.indices=r,this.indexType=te.a.UNSIGNED_BYTE,this.primitive=te.a.LINES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT)},e.prototype.createWiredCubeField=function(e,t){var r,i=new ArrayBuffer(96*e*t),n=new Float32Array(i,0,24*e*t),a=e*t*8;r=a<256?new Uint8Array(24*e*t):a<65536?new Uint16Array(24*e*t):new Uint32Array(24*e*t);for(var o=0,s=0,l=0,u=1/e,c=1/t,h=0;h<e;h++)for(var d=0;d<t;d++){for(var p=u*(h+.5)*2-1,f=c*(d+.5)*2-1,_=0;_<8;_++)n[o]=p,n[o+1]=f,n[o+2]=0,o+=3;r[s+0]=0+l,r[s+1]=1+l,r[s+2]=1+l,r[s+3]=2+l,r[s+4]=2+l,r[s+5]=3+l,r[s+6]=0+l,r[s+7]=3+l,r[s+8]=4+l,r[s+9]=5+l,r[s+10]=5+l,r[s+11]=6+l,r[s+12]=6+l,r[s+13]=7+l,r[s+14]=4+l,r[s+15]=7+l,r[s+16]=0+l,r[s+17]=4+l,r[s+18]=1+l,r[s+19]=5+l,r[s+20]=2+l,r[s+21]=6+l,r[s+22]=3+l,r[s+23]=7+l,l+=8,s+=24}this.vertices=new Uint8Array(i),this.indices=r,this.primitive=te.a.LINES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.indexType=l<256?te.a.UNSIGNED_BYTE:l<65536?te.a.UNSIGNED_SHORT:te.a.UNSIGNED_INT},e.prototype.createSolidCubeField=function(e,t){var r,i=new ArrayBuffer(576*e*t),n=new Float32Array(i,0,144*e*t),a=e*t*24;r=a<256?new Uint8Array(36*e*t):a<65536?new Uint16Array(36*e*t):new Uint32Array(36*e*t);for(var o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],s=0,l=0,u=0,c=1/e,h=1/t,d=0;d<e;d++)for(var p=0;p<t;p++)for(var f=c*(d+.5)*2-1,_=h*(p+.5)*2-1,m=0;m<6;m++){for(var v=0;v<4;v++)n[s+0]=f,n[s+1]=_,n[s+2]=0,n[s+3]=o[m][0],n[s+4]=o[m][1],n[s+5]=o[m][2],s+=6;m%2==0?(r[l+0]=0+u,r[l+1]=2+u,r[l+2]=1+u,r[l+3]=1+u,r[l+4]=2+u,r[l+5]=3+u):(r[l+0]=0+u,r[l+1]=1+u,r[l+2]=2+u,r[l+3]=2+u,r[l+4]=1+u,r[l+5]=3+u),u+=4,l+=6}this.vertices=new Uint8Array(i),this.indices=r,this.primitive=te.a.TRIANGLES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT),this.indexType=u<256?te.a.UNSIGNED_BYTE:u<65536?te.a.UNSIGNED_SHORT:te.a.UNSIGNED_INT},e.prototype.createGrid=function(e,t){for(var r=new Float32Array((e+1)*(t+1)*5),i=new Uint32Array(6*e*t),n=0,a=0;a<e+1;a++)for(var o=a/e,s=2*(o-.5),l=0;l<t+1;l++){var u=l/t,c=2*(u-.5);r[0+n]=s,r[1+n]=c,r[2+n]=0,r[3+n]=o,r[4+n]=u,n+=5}var h=0,d=t+1;for(a=1;a<e+1;a++)for(l=0;l<t;l++){var p=[(a-1)*d+l,(a-1)*d+1+l,a*d+l,a*d+1+l];i[0+h]=p[0],i[1+h]=p[1],i[2+h]=p[2],i[3+h]=p[2],i[4+h]=p[1],i[5+h]=p[3],h+=6}this.vertices=r,this.indices=i,this.primitive=te.a.TRIANGLES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,null,te.a.FLOAT),this.indexType=te.a.UNSIGNED_INT},e.prototype.createSolidCube=function(e){void 0===e&&(e=1);var t,r,i=new Float32Array(144),n=new Uint8Array(36);r=0,i[(t=0)+0]=-e,i[t+1]=-e,i[t+2]=-e,i[t+3]=-1,i[t+4]=0,i[t+5]=0,i[t+6]=-e,i[t+7]=e,i[t+8]=-e,i[t+9]=-1,i[t+10]=0,i[t+11]=0,i[t+12]=-e,i[t+13]=-e,i[t+14]=e,i[t+15]=-1,i[t+16]=0,i[t+17]=0,i[t+18]=-e,i[t+19]=e,i[t+20]=e,i[t+21]=-1,i[t+22]=0,i[t+23]=0,n[r+0]=0,n[r+1]=2,n[r+2]=1,n[r+3]=1,n[r+4]=2,n[r+5]=3,r+=6,i[(t+=24)+0]=e,i[t+1]=-e,i[t+2]=-e,i[t+3]=1,i[t+4]=0,i[t+5]=0,i[t+6]=e,i[t+7]=e,i[t+8]=-e,i[t+9]=1,i[t+10]=0,i[t+11]=0,i[t+12]=e,i[t+13]=-e,i[t+14]=e,i[t+15]=1,i[t+16]=0,i[t+17]=0,i[t+18]=e,i[t+19]=e,i[t+20]=e,i[t+21]=1,i[t+22]=0,i[t+23]=0,n[r+0]=4,n[r+1]=5,n[r+2]=6,n[r+3]=5,n[r+4]=7,n[r+5]=6,r+=6,i[(t+=24)+0]=-e,i[t+1]=-e,i[t+2]=-e,i[t+3]=0,i[t+4]=-1,i[t+5]=0,i[t+6]=e,i[t+7]=-e,i[t+8]=-e,i[t+9]=0,i[t+10]=-1,i[t+11]=0,i[t+12]=-e,i[t+13]=-e,i[t+14]=e,i[t+15]=0,i[t+16]=-1,i[t+17]=0,i[t+18]=e,i[t+19]=-e,i[t+20]=e,i[t+21]=0,i[t+22]=-1,i[t+23]=0,n[r+0]=8,n[r+1]=9,n[r+2]=11,n[r+3]=11,n[r+4]=10,n[r+5]=8,r+=6,i[(t+=24)+0]=-e,i[t+1]=e,i[t+2]=-e,i[t+3]=0,i[t+4]=1,i[t+5]=0,i[t+6]=e,i[t+7]=e,i[t+8]=-e,i[t+9]=0,i[t+10]=1,i[t+11]=0,i[t+12]=-e,i[t+13]=e,i[t+14]=e,i[t+15]=0,i[t+16]=1,i[t+17]=0,i[t+18]=e,i[t+19]=e,i[t+20]=e,i[t+21]=0,i[t+22]=1,i[t+23]=0,n[r+0]=12,n[r+1]=14,n[r+2]=13,n[r+3]=13,n[r+4]=14,n[r+5]=15,r+=6,i[(t+=24)+0]=-e,i[t+1]=-e,i[t+2]=-e,i[t+3]=0,i[t+4]=0,i[t+5]=-1,i[t+6]=e,i[t+7]=-e,i[t+8]=-e,i[t+9]=0,i[t+10]=0,i[t+11]=-1,i[t+12]=-e,i[t+13]=e,i[t+14]=-e,i[t+15]=0,i[t+16]=0,i[t+17]=-1,i[t+18]=e,i[t+19]=e,i[t+20]=-e,i[t+21]=0,i[t+22]=0,i[t+23]=-1,n[r+0]=16,n[r+1]=19,n[r+2]=17,n[r+3]=19,n[r+4]=16,n[r+5]=18,r+=6,i[(t+=24)+0]=-e,i[t+1]=-e,i[t+2]=e,i[t+3]=0,i[t+4]=0,i[t+5]=1,i[t+6]=e,i[t+7]=-e,i[t+8]=e,i[t+9]=0,i[t+10]=0,i[t+11]=1,i[t+12]=-e,i[t+13]=e,i[t+14]=e,i[t+15]=0,i[t+16]=0,i[t+17]=1,i[t+18]=e,i[t+19]=e,i[t+20]=e,i[t+21]=0,i[t+22]=0,i[t+23]=1,n[r+0]=20,n[r+1]=21,n[r+2]=23,n[r+3]=23,n[r+4]=22,n[r+5]=20,this.vertices=i,this.indices=n,this.primitive=te.a.TRIANGLES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT),this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createTextGrid=function(e){var t,r=4*e.length,i=new Float32Array(5*r);r<256?(t=new Uint8Array(6*e.length),this.indexType=te.a.UNSIGNED_BYTE):r<65536?(t=new Uint16Array(6*e.length),this.indexType=te.a.UNSIGNED_SHORT):(t=new Uint32Array(6*e.length),this.indexType=te.a.UNSIGNED_INT);var n=0,a=0,o=0,s=0;e.forEach(function(e){s+=e.size}),s/=2,e.forEach(function(e,r){i[0+n]=-s+o-e.xoffset,i[1+n]=0,i[2+n]=e.yoffset-.5,i[3+n]=e.x1,i[4+n]=e.y2,i[0+(n+=5)]=-s+e.width+o-e.xoffset,i[1+n]=0,i[2+n]=e.yoffset-.5,i[3+n]=e.x2,i[4+n]=e.y2,i[0+(n+=5)]=-s+e.width+o-e.xoffset,i[1+n]=0,i[2+n]=-e.height+e.yoffset-.5,i[3+n]=e.x2,i[4+n]=e.y1,i[0+(n+=5)]=-s+o-e.xoffset,i[1+n]=0,i[2+n]=-e.height+e.yoffset-.5,i[3+n]=e.x1,i[4+n]=e.y1,n+=5,o+=e.size,t[0+a]=0+4*r,t[1+a]=2+4*r,t[2+a]=1+4*r,t[3+a]=0+4*r,t[4+a]=3+4*r,t[5+a]=2+4*r,a+=6}),this.vertices=i,this.indices=t,this.primitive=te.a.TRIANGLES,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,null,te.a.FLOAT,null)},e.prototype.createQuad=function(e,t,r,i){var n=12,a=3;e&&(n+=8,a+=2),t&&(n+=12,a+=3),i&&(n+=16,a+=4);var o=new Float32Array(n),s=new Uint8Array(6),l=0;if(r?(o[0+l]=1,o[1+l]=0,o[2+l]=1,o[0+(l+=a)]=-1,o[1+l]=0,o[2+l]=1,o[0+(l+=a)]=-1,o[1+l]=0,o[2+l]=-1,o[0+(l+=a)]=1,o[1+l]=0,o[2+l]=-1):(o[0+l]=-1,o[1+l]=-1,o[2+l]=0,o[0+(l+=a)]=1,o[1+l]=-1,o[2+l]=0,o[0+(l+=a)]=1,o[1+l]=1,o[2+l]=0,o[0+(l+=a)]=-1,o[1+l]=1,o[2+l]=0),l=0,t){var u=[0,0,0];r?u[1]=1:u[2]=1;for(var c=0;c<4;c++)o[3+l]=u[0],o[4+l]=u[1],o[5+l]=u[2],l+=a}if(l=0,e){var h=a-2;r?(o[h+l]=1,o[h+1+l]=0,o[h+(l+=a)]=0,o[h+1+l]=0,o[h+(l+=a)]=0,o[h+1+l]=1,o[h+(l+=a)]=1,o[h+1+l]=1):(o[h+l]=0,o[h+1+l]=0,o[h+(l+=a)]=1,o[h+1+l]=0,o[h+(l+=a)]=1,o[h+1+l]=1,o[h+(l+=a)]=0,o[h+1+l]=1)}s[0]=0,s[1]=1,s[2]=2,s[3]=2,s[4]=3,s[5]=0,this.vertices=o,this.indices=s,this.primitive=te.a.TRIANGLES,this.attributes=new ie;var d=null,p=null,f=null;t&&(d=te.a.FLOAT),e&&(p=te.a.FLOAT),i&&(f=te.a.FLOAT),this.attributes.builtin(te.a.FLOAT,d,p,f),this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createPoint=function(){var e=new Float32Array(10),t=new Uint16Array(1);e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,t[0]=0,this.vertices=e,this.indices=t,this.primitive=te.a.POINTS,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,null,null,null),this.indexType=te.a.UNSIGNED_SHORT},e.prototype.createSphere=function(e,t,r){void 0===r&&(r=1);for(var i=new Float32Array((e+1)*(t+1)*8),n=new Uint16Array(6*e*(t+1)),a=new Float32Array(3),o=Math.PI/e,s=2*Math.PI/t,l=0,u=0,c=0,h=0;h<=e;++h)for(var d=Math.sin(h*o)*r,p=Math.cos(h*o)*r,f=0;f<=t;++f){var _=d*Math.cos(f*s),m=d*Math.sin(f*s);i[c++]=_,i[c++]=m,i[c++]=p,a[0]=_,a[1]=m,a[2]=p,U.d.normalize(a,a),i[c++]=a[0],i[c++]=a[1],i[c++]=a[2],i[c++]=f/t,i[c++]=h/e,h!==e&&(n[l++]=u+t+1,n[l++]=u,n[l++]=u+t,n[l++]=u+t+1,n[l++]=u+1,n[l++]=u,u++)}this.vertices=i,this.indices=n,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT,te.a.FLOAT),this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_SHORT},e.prototype.createLine=function(){var e=new Float32Array(6),t=new Uint8Array(2);e[0]=-.5,e[1]=0,e[2]=0,e[3]=.5,e[4]=0,e[5]=0,t[0]=0,t[1]=1,this.vertices=e,this.indices=t,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.attributes.primitive=te.a.LINES,this.primitive=te.a.LINES,this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createLineWithWidth=function(e,t,r){var i=new Float32Array(12),n=new Uint8Array(6),a=U.d.create();U.d.cross(a,r,[0,0,1]);var o=U.d.create(),s=U.d.create(),l=U.d.create(),u=U.d.create();U.d.scaleAndAdd(o,[0,0,0],a,e/2),U.d.scaleAndAdd(s,[0,0,0],a,-e/2),U.d.scaleAndAdd(l,o,r,t),U.d.scaleAndAdd(u,s,r,t),i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=s[0],i[4]=s[1],i[5]=s[2],i[6]=l[0],i[7]=l[1],i[8]=l[2],i[9]=u[0],i[10]=u[1],i[11]=u[2],n[0]=0,n[1]=1,n[2]=2,n[3]=2,n[4]=3,n[5]=1,this.vertices=i,this.indices=n,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.attributes.primitive=te.a.TRIANGLES,this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createLineStrip=function(){var e=new Float32Array(6),t=new Uint8Array(2);e[0]=-.5,e[1]=0,e[2]=0,e[3]=.5,e[4]=0,e[5]=0,t[0]=0,t[1]=1,this.vertices=e,this.indices=t,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.attributes.primitive=te.a.LINE_STRIP,this.primitive=te.a.LINE_STRIP,this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createArc=function(e,t,r,i){for(var n=new Float32Array(3*(2*i+2)),a=new Uint16Array(2*i*3),o=r/i,s=0,l=[0,0,0],u=0;u<i+1;u++)l[0]=e*Math.sin(s),l[1]=e*Math.cos(s),n[6*u+0]=(e-t)*Math.sin(s),n[6*u+1]=(e-t)*Math.cos(s),n[6*u+2]=0,n[6*u+3]=(e+t)*Math.sin(s),n[6*u+4]=(e+t)*Math.cos(s),n[6*u+5]=0,s+=o;for(u=0;u<i;u++)a[6*u+0]=2*u+0,a[6*u+1]=2*u+1,a[6*u+2]=2*u+3,a[6*u+3]=2*u+0,a[6*u+4]=2*u+3,a[6*u+5]=2*u+2;this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_SHORT,this.vertices=n,this.indices=a},e.prototype.createTorus=function(e,t,r,i,n){void 0===n&&(n=2*Math.PI);var a,o,s=new Float32Array((i+1)*(r+1)*8),l=new Uint16Array(i*r*2*3),u=0,c=[0,0],h=[0,0,0],d=[0,0,0];for(o=0;o<=i;o++)for(a=0;a<=r;a++){var p=a/r*n,f=o/i*Math.PI*2;c[0]=e*Math.cos(p),c[1]=e*Math.sin(p),h[0]=(e+t*Math.cos(f))*Math.cos(p),h[1]=(e+t*Math.cos(f))*Math.sin(p),h[2]=t*Math.sin(f),U.d.subtract(d,h,c),U.d.normalize(d,d),s[u+0]=h[0],s[u+1]=h[1],s[u+2]=h[2],s[u+3]=d[0],s[u+4]=d[1],s[u+5]=d[2],s[u+6]=a/e,s[u+7]=o/t,u+=8}for(u=0,o=1;o<=i;o++)for(a=1;a<=r;a++){var _=(r+1)*o+a-1,m=(r+1)*(o-1)+a-1,v=(r+1)*(o-1)+a,y=(r+1)*o+a;l[u]=_,l[u+1]=m,l[u+2]=y,l[u+3]=m,l[u+4]=v,l[u+5]=y,u+=6}this.vertices=s,this.indices=l,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT,te.a.FLOAT),this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_SHORT},e.prototype.createCone=function(e,t,r){var i,n=2*Math.PI,a=new Float32Array(6*r*3+6),o=new Uint16Array(9*r),s=0,l=[0,0,0],u=e*t*t/(e*e+t*t),c=e*e*t/(e*e+t*t);for(i=0;i<r;i++){var h=i/r*n,d=Math.cos(h),p=Math.sin(h);a[s]=e*d,a[s+1]=e*p,a[s+2]=0,l[0]=u*d,l[1]=u*p,l[2]=c,U.d.normalize(l,l),a[s+3]=l[0],a[s+4]=l[1],a[s+5]=l[2],a[s+=6]=0,a[s+1]=0,a[s+2]=t,a[s+3]=l[0],a[s+4]=l[1],a[s+5]=l[2],a[s+=6]=0,a[s+1]=0,a[s+2]=t,a[s+3]=0,a[s+4]=0,a[s+5]=-1,s+=6}for(a[s+0]=0,a[s+1]=0,a[s+2]=0,s=0,i=0;i<r;i++){var f=(i+1)%r;o[s]=3*i+1,o[s+1]=3*i,o[s+2]=3*f,o[s+3]=3*f,o[s+4]=3*f+1,o[s+5]=3*i+1,s+=6}for(i=0;i<r;i++){f=(i+1)%r;o[s]=3*r,o[s+1]=3*f+2,o[s+2]=3*i+2,s+=3}this.vertices=a,this.indices=o,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT),this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_SHORT},e.prototype.createCylinder=function(e,t,r){var i,n,a=2*Math.PI,o=new Float32Array(6*r*4+6),s=new Uint16Array(12*r),l=0;for(i=0;i<r;i++){var u=i/r*a,c=Math.cos(u),h=Math.sin(u);o[l]=e*c,o[l+1]=e*h,o[l+2]=0,o[l+3]=c,o[l+4]=h,o[l+5]=0,o[l+=6]=e*c,o[l+1]=e*h,o[l+2]=t,o[l+3]=c,o[l+4]=h,o[l+5]=0,o[l+=6]=e*c,o[l+1]=e*h,o[l+2]=0,o[l+3]=0,o[l+4]=0,o[l+5]=-1,o[l+=6]=e*c,o[l+1]=e*h,o[l+2]=t,o[l+3]=0,o[l+4]=0,o[l+5]=1,l+=6}for(o[l+0]=0,o[l+1]=0,o[l+2]=0,o[l+3]=0,o[l+4]=0,o[l+5]=t,l=0,i=0;i<r;i++)n=(i+1)%r,s[l]=4*i+1,s[l+1]=4*i,s[l+2]=4*n,s[l+3]=4*n,s[l+4]=4*n+1,s[l+5]=4*i+1,l+=6;for(i=0;i<r;i++)n=(i+1)%r,s[l]=4*r,s[l+1]=4*n+2,s[l+2]=4*i+2,s[l]=4*r+1,s[l+1]=4*n+3,s[l+2]=4*i+3,l+=6;this.vertices=o,this.indices=s,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT,te.a.FLOAT),this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_SHORT},e.prototype.createArrow=function(t,r,i){void 0===i&&(i=.6);var n=new e,a=new e;a.createCone(t,.1*r,8),n.createCylinder(t*i,.9*r,8),a.translate(0,0,.9*r);var o=new e;o.merge(n,a),this.vertices=o.vertices,this.indices=o.indices,this.attributes=o.attributes,this.indexType=o.indexType,this.primitive=te.a.TRIANGLES},e.prototype.createSharePolygon=function(){var e=new Float32Array(9),t=new Uint8Array(3);e[0]=-.5,e[1]=0,e[2]=0,e[3]=.5,e[4]=0,e[5]=0,e[6]=0,e[7]=.5,e[8]=0,t[0]=0,t[1]=1,t[2]=2,this.vertices=e,this.indices=t,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.attributes.primitive=te.a.TRIANGLES,this.primitive=te.a.TRIANGLES,this.indexType=te.a.UNSIGNED_BYTE},e.prototype.createParallelLines=function(e,t,r){for(var i=new Float32Array(2*t*3),n=new Uint8Array(2*t),a=e/(t-1),o=[r[1],r[0],r[2]],s=e/2,l=0;l<t;l++)i[6*l+0]=-r[0]/2*e+o[0]*(a*l-s),i[6*l+1]=-r[1]/2*e+o[1]*(a*l-s),i[6*l+2]=-r[2]/2*e+o[2]*(a*l-s),i[6*l+3]=r[0]/2*e+o[0]*(a*l-s),i[6*l+4]=r[1]/2*e+o[1]*(a*l-s),i[6*l+5]=r[2]/2*e+o[2]*(a*l-s),n[2*l+0]=2*l,n[2*l+1]=2*l+1;this.vertices=i,this.indices=n,this.attributes=new ie,this.attributes.builtin(te.a.FLOAT),this.attributes.primitive=te.a.LINES,this.primitive=te.a.LINES,this.indexType=te.a.UNSIGNED_BYTE},e}(),si=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),li=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._vao=null,i._vbos=[],i._ibo=null,i._primitive=4,i._type=r.gl.UNSIGNED_INT,i._vboBase=0,i._iboBase=0,i._shared=!1,i._vboBufferName=null,i._iboBufferName=null,i.attributes=null,i.length=0,i.bytes=0,i.indexSize=2,i.bufferIndex=-1,i}return si(t,e),t.prototype.destroy=function(t){if(void 0===t&&(t=!1),t||(this._ref--,!(this._ref>0))){if(this.ready){var r,i=this._manager.gl;this._shared||(this._vbos.forEach(function(e){i.deleteBuffer(e)}),this._vbos=null,delete this._vbos,i.deleteBuffer(this._ibo),this._ibo=!1,delete this._ibo),this._vao&&(i.deleteVertexArray(this._vao),this._vao=!1,delete this._vao),(r=i.getError())!==i.NO_ERROR&&console.log("GL error in mesh.destroy(): "+r)}this._manager&&this._manager.deleteMesh(this.name),e.prototype.destroy.call(this)}},t.prototype.createShared=function(e,t,r,i,n,a,o){var s=this._manager.gl;this.ready||(this._primitive=e,this.attributes=t,this.bytes=r.byteLength+i.byteLength,this._type=n||s.UNSIGNED_SHORT,this._type===s.UNSIGNED_BYTE?(this.length=i.byteLength,this.indexSize=1):this._type===s.UNSIGNED_INT?(this.length=i.byteLength/4,this.indexSize=4):(this.length=i.byteLength/2,this.indexSize=2),this._vbos[0]=a.buffer,this._ibo=o.buffer,this._vboBufferName=a.name,this._iboBufferName=o.name,(s.isWebGL2||s.vaoExtension)&&(this._vao=s.createVertexArray(),s.bindVertexArray(this._vao),this.attributes.bindBuffer(this._vbos[0],s),s.bindVertexArray(null)),this._shared=!0,this._iboBase=i.byteOffset,this._vboBase=r.byteOffset,this.ready=a.ready&&o.ready)},t.prototype.createSharedPop=function(e,t,r,i,n,a,o,s){if(!this.ready){var l=this._manager.gl;this._primitive=e,this.attributes=t,this._type=a||l.UNSIGNED_SHORT,this._type===l.UNSIGNED_BYTE?this.indexSize=1:this._type===l.UNSIGNED_INT?this.indexSize=4:this.indexSize=2,this.length=n,this._vbos=o,this._ibo=s,(l.isWebGL2||l.vaoExtension)&&(this._vao=l.createVertexArray(),l.bindVertexArray(this._vao),this.attributes.bindVbos(this._vbos,l),l.bindVertexArray(null)),this._shared=!0,this._iboBase=i*this.indexSize,this.ready=!0}},t.prototype.create=function(e,t,r,i,n){if(!this.ready){var a=this._manager.gl;this._vbos[0]=a.createBuffer(),this._ibo=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._vbos[0]),a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._ibo),a.bufferData(a.ELEMENT_ARRAY_BUFFER,i,a.STATIC_DRAW),this._primitive=e,this.attributes=t,(a.isWebGL2||a.vaoExtension)&&(this._vao=a.createVertexArray(),a.bindVertexArray(this._vao),this.attributes.bindBuffer(this._vbos[0],a),a.bindVertexArray(null)),this.bytes=r.byteLength+i.byteLength,this._type=n||a.UNSIGNED_SHORT,this._type===a.UNSIGNED_BYTE?(this.length=i.byteLength,this.indexSize=1):this._type===a.UNSIGNED_INT?(this.length=i.byteLength/4,this.indexSize=4):(this.length=i.byteLength/2,this.indexSize=2),a.getError()===a.NO_ERROR?this.ready=!0:(a.deleteBuffer(this._vbos[0]),a.deleteBuffer(this._ibo),this._vao&&a.deleteVertexArray(this._vao))}},t.prototype.createFromBufferObject=function(e,t,r,i,n,a,o){if(!this.ready){var s=this._manager.gl;this._vbos=e,this._ibo=t,this._iboBase=o,this._primitive=i,this.attributes=r,(s.isWebGL2||s.vaoExtension)&&(this._vao=s.createVertexArray(),s.bindVertexArray(this._vao),this.attributes.bindBuffers(this._vbos,s),s.bindVertexArray(null)),this._type=n,this.length=a,s.getError()===s.NO_ERROR?this.ready=!0:(this._vbos.forEach(function(e){s.deleteBuffer(e)}),s.deleteBuffer(this._ibo),this._vao&&s.deleteVertexArray(this._vao))}},t.prototype.createWiredCube=function(e){if(void 0===e&&(e=1),!this.ready){var t=new oi;t.createWiredCube(e),this.create(t.primitive,t.attributes,t.vertices,t.indices,t.indexType)}},t.prototype.createArrow=function(e,t,r){if(void 0===r&&(r=.6),!this.ready){var i=new oi;i.createArrow(e,t,r),this.create(i.primitive,i.attributes,i.vertices,i.indices,i.indexType)}},t.prototype.createSolidCube=function(e){if(void 0===e&&(e=1),!this.ready){var t=new oi;t.createSolidCube(e),this.create(t.primitive,t.attributes,t.vertices,t.indices,t.indexType)}},t.prototype.createWiredCubeField=function(e,t){if(!this.ready){var r=new oi;r.createWiredCubeField(e,t),this.create(r.primitive,r.attributes,r.vertices,r.indices,r.indexType)}},t.prototype.createSolidCubeField=function(e,t){if(!this.ready){var r=new oi;r.createSolidCubeField(e,t),this.create(r.primitive,r.attributes,r.vertices,r.indices,r.indexType)}},t.prototype.createGrid=function(e,t){if(!this.ready){var r=new oi;r.createGrid(e,t),this.create(r.primitive,r.attributes,r.vertices,r.indices,r.indexType)}},t.prototype.createTextGrid=function(e){if(!this.ready){var t=new oi;t.createTextGrid(e),this.create(t.primitive,t.attributes,t.vertices,t.indices,t.indexType)}},t.prototype.createQuad=function(e,t,r,i){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),!this.ready){var n=new oi;n.createQuad(e,t,r,i),this.create(n.primitive,n.attributes,n.vertices,n.indices,n.indexType)}},t.prototype.createParallelLines=function(e,t,r){if(!this.ready){var i=new oi;i.createParallelLines(e,t,r),this.create(i.primitive,i.attributes,i.vertices,i.indices,i.indexType)}},t.prototype.createPoint=function(){if(!this.ready){var e=new oi;e.createPoint(),this.create(e.primitive,e.attributes,e.vertices,e.indices,e.indexType)}},t.prototype.createSphere=function(e,t,r){if(void 0===r&&(r=1),!this.ready){var i=new oi;i.createSphere(e,t,r),this.create(i.primitive,i.attributes,i.vertices,i.indices,i.indexType)}},t.prototype.createLine=function(){if(!this.ready){var e=new oi;e.createLine(),this.create(e.primitive,e.attributes,e.vertices,e.indices,e.indexType)}},t.prototype.createLineWithWidth=function(e,t,r){if(!this.ready){var i=new oi;i.createLineWithWidth(e,t,r),this.create(i.primitive,i.attributes,i.vertices,i.indices,i.indexType)}},t.prototype.createLineStrip=function(){if(!this.ready){var e=new oi;e.createLineStrip(),this.create(e.primitive,e.attributes,e.vertices,e.indices,e.indexType)}},t.prototype.createSharePolygon=function(){if(!this.ready){var e=new oi;e.createSharePolygon(),this.create(e.primitive,e.attributes,e.vertices,e.indices,e.indexType)}},t.prototype.createArc=function(e,t,r,i){if(!this.ready){var n=new oi;n.createArc(e,t,r,i),this.create(n.primitive,n.attributes,n.vertices,n.indices,n.indexType)}},t.prototype.createTorus=function(e,t,r,i,n){if(!this.ready){var a=new oi;a.createTorus(e,t,r,i,n),this.create(a.primitive,a.attributes,a.vertices,a.indices,a.indexType)}},t.prototype.createCylinder=function(e,t,r){if(!this.ready){var i=new oi;i.createCylinder(e,t,r),this.create(i.primitive,i.attributes,i.vertices,i.indices,i.indexType)}},t.prototype.render=function(){this._manager.gl.drawElements(this._primitive,this.length,this._type,this._iboBase)},t.prototype.renderSub=function(e,t){this._manager.gl.drawElements(this._primitive,t,this._type,e+this._iboBase)},t.prototype.renderInstanced=function(e){this._manager.gl.drawElementsInstanced(this._primitive,this.length,this._type,this._iboBase,e)},t.prototype.use=function(){if(this.ready){var e=this._manager.gl;this._vao?e.bindVertexArray(this._vao):this.attributes.bind(this._vbos,e),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._ibo)}else console.error("mesh "+this.name+" is not ready.")},t.prototype.update=function(e,t,r){if(this.ready){var i=this._manager.gl;i.deleteBuffer(this._vbos[0]),i.deleteBuffer(this._ibo),this._vao&&i.deleteVertexArray(this._vao),this._vbos=[i.createBuffer()],this._ibo=i.createBuffer(),this._vboBase=0,this._iboBase=0,i.bindBuffer(i.ARRAY_BUFFER,this._vbos[0]),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._ibo),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,i.STATIC_DRAW),(i.isWebGL2||i.vaoExtension)&&(this._vao=i.createVertexArray(),i.bindVertexArray(this._vao),this.attributes.bindBuffer(this._vbos[0],i),i.bindVertexArray(null)),i.getError()!==i.NO_ERROR&&(this.ready=!1),this._type=r||i.UNSIGNED_SHORT,this._type===i.UNSIGNED_BYTE?this.length=t.byteLength:this._type===i.UNSIGNED_SHORT?this.length=t.byteLength/2:this._type===i.UNSIGNED_INT&&(this.length=t.byteLength/4),this.bytes=e.byteLength+t.byteLength}},t.prototype.isTriangle=function(){return this._primitive>=this._manager.gl.TRIANGLES},t.prototype.isLine=function(){var e=this._manager.gl;return this._primitive===e.LINES||this._primitive===e.LINE_LOOP||this._primitive==e.LINE_STRIP},t.prototype.hasColor=function(){return this.attributes.hasColor},t.prototype.slice=function(e){var t=this._manager.gl;if(!t.isWebGL2)return console.error("createSubMesh is only supported in WebGL2"),this;for(var r=0,i=0,n=0,a=e.length;n<a;n++)r+=e[n].verticesBytes,i+=e[n].indicesBytes;var o=this._manager.getMesh((parseFloat(this.name)+Math.random()).toString());o._vbos=t.createBuffer(),o._ibo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o._vbos),t.bufferData(t.ARRAY_BUFFER,new Uint8Array(r),t.STATIC_DRAW);var s=0;t.bindBuffer(t.COPY_READ_BUFFER,this._vbos);for(n=0,a=e.length;n<a;n++)t.copyBufferSubData(t.COPY_READ_BUFFER,t.ARRAY_BUFFER,this._vboBase+e[n].verticesOffset,s,e[n].verticesBytes),s+=e[n].verticesBytes;var l=null,u=null;switch(this.indexSize){case 2:l=new Uint16Array(this.length),u=new Uint16Array(i/2);break;case 1:l=new Uint8Array(this.length),u=new Uint8Array(i);break;case 4:l=new Uint32Array(this.length),u=new Uint32Array(i/4)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._ibo),t.getBufferSubData(t.ELEMENT_ARRAY_BUFFER,this._iboBase,l);var c=0,h=0;for(n=0,a=e.length;n<a;n++){for(var d=e[n].verticesOffset/this.attributes.values[0].stride,p=e[n].indicesBytes/this.indexSize,f=e[n].indicesOffset/this.indexSize,_=0;_<p;_++)u[_+c]=l[_+f]-d+h;c+=p,h+=e[n].verticesBytes/this.attributes.values[0].stride}return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o._ibo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,u,t.STATIC_DRAW),o._primitive=this._primitive,o.attributes=this.attributes,(t.isWebGL2||t.vaoExtension)&&(o._vao=t.createVertexArray(),t.bindVertexArray(o._vao),o.attributes.bindBuffer(o._vbos[0],t),t.bindVertexArray(null)),o.bytes=i+r,o._type=this._type,o.indexSize=this.indexSize,o.length=i/o.indexSize,t.getError()===t.NO_ERROR?o.ready=!0:(t.deleteBuffer(o._vbos[0]),t.deleteBuffer(o._ibo),o._vao&&t.deleteVertexArray(o._vao)),o},t.prototype.ibSubData=function(e,t){var r=this._manager.gl;this.ready=!1,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this._ibo),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,this._iboBase+e,t),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),r.getError()===r.NO_ERROR?this.ready=!0:(r.deleteBuffer(this._ibo),r.deleteBuffer(this._vbos[0]),this._vao&&(r.deleteVertexArray(this._vao),this._vao=!1,delete this._vao))},t.prototype.vbSubData=function(e,t){var r=this._manager.gl;this.ready=!1,r.bindBuffer(r.ARRAY_BUFFER,this._vbos[0]),r.bufferSubData(r.ARRAY_BUFFER,this._vboBase+e,t),r.bindBuffer(r.ARRAY_BUFFER,null),r.getError()===r.NO_ERROR?this.ready=!0:(r.deleteBuffer(this._ibo),r.deleteBuffer(this._vbos[0]),this._vao&&(r.deleteVertexArray(this._vao),this._vao=!1,delete this._vao))},t.prototype.getVBSubData=function(e,t){var r=this._manager.gl;r.bindBuffer(r.ARRAY_BUFFER,this._vbos[0]),r.getBufferSubData(r.ARRAY_BUFFER,this._vboBase+e,t),r.bindBuffer(r.ARRAY_BUFFER,null)},t.prototype.getIBSubData=function(e,t){var r=this._manager.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this._ibo),r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,this._iboBase+e,t),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)},t.prototype.setBufferIndex=function(e){this.bufferIndex=e},t.prototype.destroyBuffer=function(e){if(this._vboBufferName||this._iboBufferName){var t=e.gl,r=e.getBuffer(this._vboBufferName),i=e.getBuffer(this._iboBufferName);this._vbos[0]&&r.buffer&&r.pause(),this._ibo&&i.buffer&&i.pause(),(t.isWebGL2||t.vaoExtension)&&this._vao&&(t.bindVertexArray(null),t.deleteVertexArray(this._vao)),this._vao=null,this._vbos=null,this._ibo=null}},t.prototype.restoreBuffer=function(e){if(this._vboBufferName||this._iboBufferName){var t=e.gl,r=e.getBuffer(this._vboBufferName),i=e.getBuffer(this._iboBufferName);this._vbos&&t.deleteBuffer(this._vbos[0]),this._ibo&&t.deleteBuffer(this._ibo),this._vao&&t.deleteVertexArray(this._vao),r.restart(),i.restart(),this._vbos=[],this._vbos[0]=r.buffer,this._ibo=i.buffer,(t.isWebGL2||t.vaoExtension)&&(this._vao=t.createVertexArray(),t.bindVertexArray(this._vao),this.attributes.bindBuffer(this._vbos[0],t),t.bindVertexArray(null)),t.getError()!==t.NO_ERROR?this.ready=!1:this.ready=!0}},t.prototype.getIndexType=function(){return this._type},t}(Be.a),ui=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ci=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},hi=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},di=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._framebuffer=null,i._colorBuffers=[],i._depthBuffer=null,i}return ui(t,e),t.prototype._bufferNotReady=function(e,t){for(var r=0;r<e.length;r++)if(!e[r].ready)return!0;return!(!t||t.ready)},t.prototype._alreadyCreated=function(){return this.ready},t.prototype._dumpBasicInfo=function(e,t){console.log("FrameBuffer.create: "+this.name),e.forEach(function(e){return console.log("colorBuffer: "+e.name)}),t&&console.log("depthBuffer: "+t.name)},t.prototype._storeBuffers=function(e,t){a.a.isArray(e)||(e=[e]),this._colorBuffers=e,this._depthBuffer=t},t.prototype._createGLFramebuffer=function(){var e=this._manager.gl;this._framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),this._framebuffer.__SPECTOR_Metadata={name:this.name,colorBuffer:this._colorBuffers.map(function(e){return e.name}).join(),depthBuffer:this._depthBuffer.name}},t.prototype._attachColorBuffer=function(e,t){var r=this._manager.gl;e._rbo?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0_WEBGL+t,r.RENDERBUFFER,e._texture):r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0_WEBGL+t,r.TEXTURE_2D,e._texture,0)},t.prototype._attachColorBuffers=function(){var e,t,r=this._manager.gl;if(r.isWebGL2||r.drawBuffers){var i=0,n=[];try{for(var a=ci(this._colorBuffers),o=a.next();!o.done;o=a.next()){var s=o.value;this._attachColorBuffer(s,i),n.push(r.COLOR_ATTACHMENT0_WEBGL+i),i++}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}r.drawBuffers(n)}else this._attachColorBuffer(this._colorBuffers[0],0)},t.prototype._attachDepthBuffer=function(){var e=this._manager.gl;if(this._depthBuffer){var t=this._depthBuffer.rbo,r=this._depthBuffer.format===e.DEPTH_COMPONENT?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;t?e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,this._depthBuffer.texture):e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,this._depthBuffer.texture,0)}else e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)},t.prototype.create=function(e,t){this._alreadyCreated()||this._bufferNotReady(e,t)||(this._storeBuffers(e,t),this._createGLFramebuffer(),this._attachColorBuffers(),this._attachDepthBuffer(),this._checkCompleteness())},t.prototype._destroy=function(){var e,t=this._manager.gl;if(this.ready){t.bindFramebuffer(t.FRAMEBUFFER,this._framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,null,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,null),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,null);for(var r=0,i=t.isWebGL2||t.drawBuffers?this._colorBuffers.length:1;r<i;r++)t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0_WEBGL+r,t.TEXTURE_2D,null,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0_WEBGL+r,t.RENDERBUFFER,null);t.deleteFramebuffer(this._framebuffer),delete this._framebuffer}(e=t.getError())!==t.NO_ERROR&&console.log("GL error in framebuffer._destroy(): "+e)},t.prototype.destroy=function(t){void 0===t&&(t=!1),!t&&(this._ref--,this._ref>0)||(this.ready&&this._destroy(),this._manager&&this._manager.deleteFramebuffer(this.name),e.prototype.destroy.call(this))},t.prototype._notReady=function(){return!this.ready},t.prototype._sizeChanged=function(e,t){return e!==this.getWidth()||t!==this.getHeight()},t.prototype._limitMaxSize=function(e,t){return(e>4096||t>4096)&&(e>=t?(t=Math.floor(4096*t/e),e=4096):(e=Math.floor(4096*e/t),t=4096)),[e,t]},t.prototype._resizeColorBuffers=function(e,t){var r,i;try{for(var n=ci(this._colorBuffers),a=n.next();!a.done;a=n.next()){var o=a.value;if(o.resize(e,t),!o.ready)return this.destroy(),!1}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return!0},t.prototype._resizeDepthBuffer=function(e,t){return this._depthBuffer.resize(e,t),!!this._depthBuffer.ready||(this.destroy(),!1)},t.prototype._rebindFrameBuffer=function(){var e=this._manager.gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},t.prototype._reattachColorBuffers=function(){this._attachColorBuffers()},t.prototype._reattachDepthBuffer=function(){this._attachDepthBuffer()},t.prototype.resize=function(e,t){var r;return this.ready||(console.warn(" FBO named "+this.name+" is restore beffore resize"),this.restore()),e=(r=hi(this._limitMaxSize(e,t),2))[0],t=r[1],this._rebindFrameBuffer(),this._resizeColorBuffers(e,t),this._resizeDepthBuffer(e,t),this._reattachColorBuffers(),this._reattachDepthBuffer(),this._checkCompleteness()},t.prototype._checkCompleteness=function(){var e=this._manager.gl,t=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(this.ready=!1,t){case e.FRAMEBUFFER_COMPLETE:return this.ready=!0,!0;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case e.FRAMEBUFFER_UNSUPPORTED:console.warn("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;default:console.warn("Incomplete framebuffer: "+t)}return!1},t.prototype.getWidth=function(){return this.ready?this._colorBuffers[0].width:-1},t.prototype.getHeight=function(){return this.ready?this._colorBuffers[0].height:-1},t.prototype.use=function(){var e=this._manager.gl;this.ready?e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer):console.error("framebuffer "+this.name+" is not ready.")},t.prototype.getColorBufferNumber=function(){return this.ready?this._colorBuffers.length:null},t.prototype.getColorBuffer=function(e){return void 0===e&&(e=0),this.ready&&e<this._colorBuffers.length?this._colorBuffers[e]:null},t.prototype.getDepthBuffer=function(){return this.ready?this._depthBuffer:null},t.prototype.discard=function(){var e=this._manager.gl;if(this.ready){this._depthBuffer&&this._depthBuffer.discard();for(var t=0,r=this._colorBuffers.length;t<r;t++)this._colorBuffers[t].discard();e.deleteFramebuffer(this._framebuffer),this._framebuffer=null,this.ready=!1,console.log("frame buffer named "+this.name+" is discard")}},t.prototype.restore=function(){var e=this._manager.gl;if(!this.ready){if(!this._depthBuffer&&this._colorBuffers.length<1)return;this._depthBuffer&&this._depthBuffer.restore();for(var t=0,r=this._colorBuffers.length;t<r;t++)this._colorBuffers[t].restore();for(t=0,r=this._colorBuffers.length;t<r;t++)if(!this._colorBuffers[t].ready)return void console.warn("color buffer"+this._colorBuffers[t].name+"not ready");if(this._depthBuffer&&!this._depthBuffer.ready)return void console.warn("depth buffer"+this._depthBuffer.name+"not ready");this._framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer);var i=[];for(t=0,r=e.isWebGL2||e.drawBuffers?this._colorBuffers.length:1;t<r;t++)this._colorBuffers[t]._rbo?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0_WEBGL+t,e.RENDERBUFFER,this._colorBuffers[t]._texture,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0_WEBGL+t,e.TEXTURE_2D,this._colorBuffers[t]._texture,0),i.push(e.COLOR_ATTACHMENT0_WEBGL+t);(e.isWebGL2||e.drawBuffers)&&e.drawBuffers(i),this._depthBuffer?this._depthBuffer.rbo?this._depthBuffer.format===e.DEPTH_COMPONENT?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this._depthBuffer.texture):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthBuffer.texture):this._depthBuffer.format===e.DEPTH_COMPONENT?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this._depthBuffer.texture,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthBuffer.texture,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0),this._checkCompleteness()?console.log("frame buffer named "+this.name+" is restore success"):console.log("frame buffer named "+this.name+" is restore error")}},t.prototype.copy=function(e,t){if(this.name!==e.name){var r=this._manager.gl;if(r.isWebGL2){var i=this._colorBuffers[0].width,n=this._colorBuffers[0].height,a=r.getParameter(r.DRAW_FRAMEBUFFER_BINDING);r.bindFramebuffer(r.READ_FRAMEBUFFER,e._framebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this._framebuffer),r.blitFramebuffer(0,0,i,n,0,0,i,n,t,r.NEAREST),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,a)}else console.warn("Framebuffer.copy() only gets supported in WebGL 2.0 context.")}},t}(Be.a),pi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),fi=function(){function e(e){this.loc=e,this.upload=null}return e.prototype.initialize=function(e,t,r){this.uniforms=new Map;var i=r.getUniformBlockIndex(t,e);r.uniformBlockBinding(t,i,this.loc);var n=r.getActiveUniformBlockParameter(t,i,r.UNIFORM_BLOCK_DATA_SIZE);this.blockSize=0;for(var a=r.getActiveUniformBlockParameter(t,i,r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),o=0,s=a.length;o<s;o++){var l=r.getActiveUniform(t,a[o]),u=l.name.replace(/[_\w]+./,"");switch(this.uniforms[u]={type:l.type,size:l.size},l.type){case r.INT:case r.FLOAT:this.blockSize+=4*l.size;break;case r.INT_VEC2:case r.FLOAT_VEC2:this.blockSize+=8*l.size;break;case r.INT_VEC3:case r.FLOAT_VEC3:this.blockSize+=12*l.size;break;case r.INT_VEC4:case r.FLOAT_VEC4:this.blockSize+=16*l.size;break;case r.FLOAT_MAT4:this.blockSize+=64*l.size;break;case r.FLOAT_MAT3:this.blockSize+=48*l.size}}this.blockSize!==n&&console.warn("uniform block "+e+" has packing problem!"),r.isWebGL2&&(this.blockBuffer=null,this.blockBuffer=r.createBuffer(),r.bindBuffer(r.UNIFORM_BUFFER,this.blockBuffer),_i=new Float32Array(this.blockSize),r.bufferData(r.UNIFORM_BUFFER,_i,r.DYNAMIC_DRAW),r.bindBuffer(r.UNIFORM_BUFFER,null))},e.prototype.destroy=function(){this.uniforms=null,delete this.uniforms},e.prototype.UniformUpload1fv=function(e,t){t.uniform1fv(this.loc,e)},e.prototype.UniformUpload1f=function(e,t){t.uniform1f(this.loc,e)},e.prototype.UniformUpload2f=function(e,t){t.uniform2fv(this.loc,e)},e.prototype.UniformUpload3f=function(e,t){t.uniform3fv(this.loc,e)},e.prototype.UniformUpload4f=function(e,t){t.uniform4fv(this.loc,e)},e.prototype.UniformUpload1b=function(e,t){t.uniform1i(this.loc,e?1:0)},e.prototype.UniformUpload1i=function(e,t){t.uniform1i(this.loc,e)},e.prototype.UniformUpload2i=function(e,t){t.uniform2i(this.loc,e[0],e[1])},e.prototype.UniformUpload3i=function(e,t){t.uniform3i(this.loc,e[0],e[1],e[2])},e.prototype.UniformUpload4i=function(e,t){t.uniform4i(this.loc,e[0],e[1],e[2],e[3])},e.prototype.UniformUploadMat4=function(e,t){t.uniformMatrix4fv(this.loc,!1,e)},e.prototype.UniformUploadMat3=function(e,t){t.uniformMatrix3fv(this.loc,!1,e)},e.prototype.UniformBlockUpload=function(e,t){t.bindBufferBase(t.UNIFORM_BUFFER,this.loc,this.blockBuffer),t.bindBuffer(t.UNIFORM_BUFFER,this.blockBuffer),t.bufferSubData(t.UNIFORM_BUFFER,0,e,0,e.byteLength/4),t.bindBuffer(t.UNIFORM_BUFFER,null)},e}(),_i=null,mi=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._program=null,i.reservedUniforms={},i.userUniforms={},i.shaderSource=null,i.flags=[],i.attributes={},i}return pi(t,e),t.prototype.destroy=function(t){if(void 0===t&&(t=!1),t||(this._ref--,!(this._ref>0))){if(this.ready){for(var r,i=this._manager.gl,n=0,a=this.reservedUniforms.length;n<a;n++)this.reservedUniforms[n].destroy();this.reservedUniforms=null,delete this.reservedUniforms;for(n=0,a=this.userUniforms.length;n<a;n++)this.userUniforms[n].destroy();this.userUniforms=null,delete this.userUniforms,this.shaderSource=null,delete this.shaderSource,this.attributes=null,delete this.attributes,i.deleteProgram(this._program),delete this._program,(r=i.getError())!==i.NO_ERROR&&console.log("GL error in shader.destroy(): "+r)}this._manager&&this._manager.deleteShader(this.name),e.prototype.destroy.call(this)}},t.prototype.createFromSource=function(e,t,r){this._manager.gl;if(!this.ready){this.flags=r?r.slice(0):[];var i=this._preprocess(e,r),n=this._preprocess(t,r);this._compile(i,n)}},t.prototype._preprocess=function(e,t){var r,i,n,o,s,l,u=[!0],c=!0,h=e.split("\n"),d=[];for(r=0,n=h.length;r<n;r++){var p=h[r];if(""!==p)if("#"===p[0]&&"v"!==p[1]){if("i"===p[1]&&"f"===p[2]){c=!0;var f=p.substr(4).replace(/^\s+|\s+$/g,"");if(s=null,-1!==f.indexOf("||"))for(c=!1,i=0,o=(s=f.split("||")).length;i<o;i++){var _=s[i].replace(/^\s+|\s+$/g,"");l=!1,"!"===_[0]&&(l=!0,_=_.substring(1)),-1!==a.a.indexOf(t,_)&&(c=!l)}else if(-1!==f.indexOf("&&")){for(c=!0,i=0,o=(s=f.split("&&")).length;i<o;i++)if("!"===(_=s[i].replace(/^\s+|\s+$/g,""))[0]){if(_=_.substring(1),-1!==a.a.indexOf(t,_)){c=!1;break}}else if(-1===a.a.indexOf(t,_)){c=!1;break}}else l=!1,"!"===f[0]&&(l=!0,f=f.substring(1)),c=-1!==a.a.indexOf(t,f)?!l:l;u.push(c)}else"e"===p[1]&&"l"===p[2]&&"s"===p[3]&&"e"===p[4]?u[u.length-1]=!u[u.length-1]:"e"===p[1]&&"n"===p[2]&&"d"===p[3]&&"i"===p[4]&&"f"===p[5]&&u.pop();for(c=!0,i=0,o=u.length;i<o&&(c=u[i]&&c);++i);}else c&&d.push(p)}return d.join("\n")},t.prototype.createFromShaderSource=function(e,t){var r=this._manager.gl;this.ready||(t=t||[],r.isWebGL2&&-1===t.indexOf("WEBGL2")&&t.push("WEBGL2"),this.shaderSource=e,this.shaderSource.ready?this.createFromSource(e.vsSource,e.fsSource,t):console.warn(name+"'s source is not ready"))},t.prototype._compile=function(e,t){var r=this._manager.gl;if(!this.ready){this.ready=!1,this._program&&r.deleteProgram(this._program),this._program=r.createProgram();var i=r.createShader(r.VERTEX_SHADER),n=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(i,e),r.compileShader(i),r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){var a="failed to compile vertex shader "+this.name+"\n\n"+r.getShaderInfoLog(i);return console.log(e),console.error(a),r.deleteProgram(this._program),void r.deleteShader(i)}if(!r.getShaderParameter(n,r.COMPILE_STATUS)){a="failed to compile fragment shader "+this.name+"\n\n"+r.getShaderInfoLog(n);return console.log(t),console.error(a),r.deleteProgram(this._program),void r.deleteShader(n)}if(r.attachShader(this._program,i),r.attachShader(this._program,n),r.bindAttribLocation(this._program,0,"m_aPosition"),r.bindAttribLocation(this._program,1,"m_aNormal0"),r.bindAttribLocation(this._program,2,"m_aNormal1"),r.bindAttribLocation(this._program,3,"m_aNormal2"),r.bindAttribLocation(this._program,4,"m_aTexCoord"),r.bindAttribLocation(this._program,5,"m_aColor"),r.bindAttribLocation(this._program,6,"m_aMaterial"),r.bindAttribLocation(this._program,7,"m_aTangent"),r.bindAttribLocation(this._program,8,"m_aJoint0"),r.bindAttribLocation(this._program,9,"m_aWeight0"),r.bindAttribLocation(this._program,10,"m_aModelMatrix"),r.linkProgram(this._program),r.deleteShader(i),r.deleteShader(n),r.getError()===r.NO_ERROR){if(!r.getProgramParameter(this._program,r.LINK_STATUS)){var o=r.getProgramInfoLog(this._program);return console.log("%s linking error:\n"+o,this.name),void r.deleteProgram(this._program)}this.ready=!0;var s,l=r.getProgramParameter(this._program,r.ACTIVE_ATTRIBUTES);for(s=0;s<l;++s){var u=r.getActiveAttrib(this._program,s);this.attributes[u.name]=s}var c=r.getProgramParameter(this._program,r.ACTIVE_UNIFORMS);for(s=0;s<c;++s){var h=r.getActiveUniform(this._program,s),d=r.getUniformLocation(this._program,h.name),p=new fi(d);if("m"===h.name[0]&&"_"===h.name[1]){if(null===d&&r.isWebGL2)continue;this.reservedUniforms[h.name]=p}else this.userUniforms[h.name]=p;switch(h.type){case r.FLOAT:h.size>1?p.upload=p.UniformUpload1fv:p.upload=p.UniformUpload1f;break;case r.FLOAT_VEC2:p.upload=p.UniformUpload2f;break;case r.FLOAT_VEC3:p.upload=p.UniformUpload3f;break;case r.FLOAT_VEC4:p.upload=p.UniformUpload4f;break;case r.BOOL:p.upload=p.UniformUpload1b;break;case r.INT:case r.SAMPLER_2D:case r.SAMPLER_CUBE:p.upload=p.UniformUpload1i;break;case r.INT_VEC2:case r.BOOL_VEC2:p.upload=p.UniformUpload2i;break;case r.INT_VEC3:case r.BOOL_VEC3:p.upload=p.UniformUpload3i;break;case r.INT_VEC4:case r.BOOL_VEC4:p.upload=p.UniformUpload4i;break;case r.FLOAT_MAT4:p.upload=p.UniformUploadMat4;break;case r.FLOAT_MAT3:p.upload=p.UniformUploadMat3;break;default:console.error("unsupported shader uniform type for "+h.name)}}if(r.isWebGL2)for(var f=r.getProgramParameter(this._program,r.ACTIVE_UNIFORM_BLOCKS),_=0;_<f;_++){var m=r.getActiveUniformBlockName(this._program,_),v=void 0;"m"===m[0]&&"_"===m[1]?((v=new fi(_)).initialize(m,this._program,r),v.upload=v.UniformBlockUpload,m=m.replace(/m_b/,"m_u"),this.reservedUniforms[m]=v):((v=new fi(_)).initialize(m,this._program,r),v.upload=v.UniformBlockUpload,this.userUniforms[m]=v)}}else r.deleteProgram(this._program)}},t.prototype.use=function(){this.ready?this._manager.gl.useProgram(this._program):console.error("shader "+this.name+" is not ready.")},t.prototype.usePlatte=function(){return-1!==this.flags.lastIndexOf("USE_PLATTE")},t}(Be.a),vi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),yi=function(e){function t(t,r){var i=e.call(this,t,r)||this,n=r.gl;return i._target=n.ARRAY_BUFFER,i.buffer=n.createBuffer(),i}return vi(t,e),t.prototype.destroy=function(t){if(void 0===t&&(t=!1),t||(this._ref--,!(this._ref>0))){if(null!==this.buffer)this._manager.gl.deleteBuffer(this.buffer),this.buffer=null,delete this.buffer;if(this.ready&&this._manager){var r=this._manager.getSourceDatas();0===this.bufferType?r.vertexs.delete(this.meshBufferIndex):1===this.bufferType&&r.indexs.delete(this.meshBufferIndex),this._manager.deleteBuffer(this.name),this._manager=null}e.prototype.destroy.call(this)}},t.prototype.create=function(e,t,r,i,n){if(!this.ready){var a=this._manager.gl;this._target=e,this.offset=void 0!==r?r:-1,this.meshBufferIndex=void 0!==i?i:-1,this.bufferType=void 0!==n?n:-1,a.bindBuffer(e,this.buffer),a.bufferData(e,t,a.STATIC_DRAW),a.getError()===a.NO_ERROR?this.ready=!0:(a.deleteBuffer(this.buffer),this.buffer=null,this.ready=!1)}},t.prototype.update=function(e,t,r,i){var n=this._manager.gl;this.offset=void 0!==t?t:-1,this.meshBufferIndex=void 0!==r?r:-1,this.bufferType=void 0!==i?i:-1,n.bindBuffer(this._target,this.buffer),n.bufferData(this._target,e,n.STATIC_DRAW),n.getError()===n.NO_ERROR?this.ready=!0:(n.deleteBuffer(this.buffer),this.buffer=null,this.ready=!1)},t.prototype.pause=function(){var e=this._manager.gl;null!==this.buffer&&e.deleteBuffer(this.buffer),this.buffer=null,this.ready&&(this.ready=!1)},t.prototype.restart=function(){var e=this._manager.gl;if(!this.buffer||!this.ready){var t=this._manager.getSourceDatas(),r=null;0===this.bufferType?r=t.vertexs.get(this.meshBufferIndex):1===this.bufferType&&(r=t.indexs.get(this.meshBufferIndex)),e.bindBuffer(this._target,null),this.buffer=e.createBuffer(),e.bindBuffer(this._target,this.buffer),e.bufferData(this._target,r,e.STATIC_DRAW),e.getError()===e.NO_ERROR?this.ready=!0:this.ready=!1}},t}(Be.a),gi=function(){function e(e){this._globalMeshBufferIndex=0,this._shaders=new Map,this._meshes=new Map,this._textures=new Map,this._framebuffers=new Map,this._buffers=new Map,this._attributes=new Map,this._sourceVertex=new Map,this._soucreIndex=new Map,this._sourceTexture=new Map,this.gl=e,this.gl||console.error("ResourceManager requires a valid gl context."),this._framebuffers.set("default",{ready:!0,manager:null,_name:"default",_framebuffer:null,_width:1,_height:1,destroy:function(){},use:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},resize:function(e,t){this._width=e,this._height=t},discard:function(){},restore:function(){},getWidth:function(){return this._width},getHeight:function(){return this._height},ref:function(){},copy:function(t,r){if(this._name!==t._name&&e.isWebGL2){var i=t._colorBuffers[0].width,n=t._colorBuffers[0].height,a=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.READ_FRAMEBUFFER,t._framebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.blitFramebuffer(0,0,i,n,0,0,i,n,r,e.NEAREST),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,a)}}})}return e.prototype.getGlobalMeshBufferIndex=function(){var e=this._globalMeshBufferIndex;return this._globalMeshBufferIndex++,e},e.prototype.destroy=function(){this._meshes.forEach(function(e,t){e.destroy(!0)}),this._framebuffers.forEach(function(e,t){e.destroy(!0)}),this._textures.forEach(function(e,t){e.destroy(!0)}),this._shaders.forEach(function(e,t){e.destroy(!0)}),this._buffers.forEach(function(e,t){e.destroy(!0)}),this._textures=null,this._meshes=null,this._framebuffers=null,this._buffers=null,this._shaders=null,this._soucreIndex=null,this._sourceVertex=null,this._sourceTexture=null,delete this._textures,delete this._meshes,delete this._framebuffers,delete this._shaders,delete this._buffers,delete this._soucreIndex,delete this._sourceVertex,delete this._sourceTexture},e.prototype.createTexture=function(e){return this._textures&&!this._textures.has(e)&&this._textures.set(e,new O.a(e,this)),this._textures.get(e)},e.prototype.getTexture=function(e){this._textures&&!this._textures.has(e)&&this._textures.set(e,new O.a(e,this));var t=this._textures.get(e);return t.ref(),t},e.prototype.removeTexture=function(e){this._textures.has(e)&&this._textures.get(e).destroy()},e.prototype.renameTexture=function(e,t){this._textures&&this._textures.has(e)&&(this._textures.set(t,this._textures.get(e)),this._textures.delete(e))},e.prototype.getFramebuffer=function(e){this._framebuffers.has(e)||this._framebuffers.set(e,new di(e,this));var t=this._framebuffers.get(e);return t.ref(),t},e.prototype.getShader=function(e,t){(t=t||[]).sort(),t&&(e+=t.join("_")),this._shaders.has(e)||this._shaders.set(e,new mi(e,this));var r=this._shaders.get(e);return r.ref(),r},e.prototype.getBuffer=function(e){this._buffers.has(e)||this._buffers.set(e,new yi(e,this));var t=this._buffers.get(e);return t.ref(),t},e.prototype.getMesh=function(e){this._meshes.has(e)||this._meshes.set(e,new li(e,this));var t=this._meshes.get(e);return t.ref(),t},e.prototype.getMeshAttributes=function(e){return this._attributes[e]||(this._attributes[e]=new ie),this._attributes[e]},e.prototype.hasTexture=function(e){return this._textures.has(e)},e.prototype.hasFramebuffer=function(e){return this._framebuffers.hasOwnProperty(e)},e.prototype.hasShader=function(e,t){return(t=t||[]).sort(),t&&(e+=t.join("_")),this._shaders.has(e)},e.prototype.hasBuffer=function(e){return this._buffers.has(e)},e.prototype.hasMesh=function(e){return this._meshes.has(e)},e.prototype.deleteTexture=function(e){this._textures.delete(e),this._sourceTexture.delete(e)},e.prototype.deleteFramebuffer=function(e){this._framebuffers.delete(e)},e.prototype.deleteShader=function(e){this._shaders.delete(e)},e.prototype.deleteBuffer=function(e){this._buffers.delete(e)},e.prototype.deleteMesh=function(e){this._meshes.delete(e)},e.prototype.discard=function(){this._framebuffers.forEach(function(e){e.discard()})},e.prototype.restore=function(){this._framebuffers.forEach(function(e){e.restore()})},e.prototype.getMemStats=function(e){return e.textureKBytes=0,e.textureCount=0,this._textures.forEach(function(t){t.ready&&(e.textureKBytes+=t.getSize()/1024,e.textureCount++)}),e.meshKBytes=0,e.meshCount=0,this._meshes.forEach(function(t){t.ready&&(e.meshKBytes+=t.bytes/1024,e.meshCount++)}),e.framebufferCount=0,this._framebuffers.forEach(function(t){t.ready&&e.framebufferCount++}),e.shaderCount=0,this._shaders.forEach(function(t){t.ready&&e.shaderCount++}),e},e.prototype.addSourceBuffers=function(e,t,r){this._sourceVertex.has(e)||this._sourceVertex.set(e,t),this._soucreIndex.has(e)||this._soucreIndex.set(e,r)},e.prototype.removeSourceBuffers=function(e){this._sourceVertex.has(e)&&this._sourceVertex.delete(e),this._soucreIndex.has(e)&&this._soucreIndex.delete(e)},e.prototype.addSourceImage=function(e,t){this._sourceTexture.set(t,{image:e,name:t})},e.prototype.removeSourceImage=function(e){this._sourceTexture.delete(e)},e.prototype.getSourceDatas=function(){return{vertexs:this._sourceVertex,indexs:this._soucreIndex}},e.prototype.getSourceTextures=function(){return this._sourceTexture},e.prototype.destroyBuffers=function(){var e=this;this._meshes.forEach(function(t){t.destroyBuffer(e)}),this.gl.flush()},e.prototype.restoreBuffers=function(){var e=this;this._meshes.forEach(function(t){t.restoreBuffer(e)}),this.gl.flush()},e}(),bi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),wi=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._useTransparent=!0,i._useMaskTextue=!1,i._usediffuseTexture=!1,i.useDepthMask=!0,i}return bi(t,e),t.prototype.setUseTransparent=function(e){this._useTransparent=e},t.prototype.setUsediffuseTexture=function(e){this._usediffuseTexture=e},t.prototype.setUsemaskTexture=function(e){this._useMaskTextue=e},t.prototype.setuseDepthMask=function(e){this.useDepthMask=e},t.prototype.absorb=function(e){var t=this.reservedParameters.m_uDiffuseTexture;if(this._useMaskTextue&&e.hasMask||this._usediffuseTexture&&e.hasTexture){var r=e.reservedParameters.m_uDiffuseTexture;t&&r&&(t.value=r.value)}this._useTransparent&&this.setTransparent(e.getTransparent())},t}(F),xi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mi=function(){function e(e){this._materials={},this._modelMaterials={},this._customColors={},this._customColorCount=0,this._scene=null,this._buffer=new Uint8Array(1024),this._resourceManager=e;var t=e.gl;this.texture=e.getTexture("texturemanager"),this.texture.create(256,1,t.RGBA8,t.NEAREST,t.CLAMP_TO_EDGE),this.texture.use(3)}return e.prototype.destroy=function(){for(var e in this._materials)this._materials[e].destroy();this._materials=null,delete this._materials,this._modelMaterials=null,delete this._modelMaterials,this.texture=null,delete this.texture,this._buffer=null,delete this._buffer},e.prototype.setScene=function(e){this._scene=e},e.prototype.createMaterialPbr=function(e){return this._materials[e]?this._materials[e]:(this._materials[e]=new ft(e,this._resourceManager),this._materials[e])},e.prototype.createMaterialAdhoc=function(e){return this._materials[e]?this._materials[e]:(this._materials[e]=new F(e,this._resourceManager),this._materials[e])},e.prototype.createMaterialOverride=function(e){return this._materials[e]?this._materials[e]:(this._materials[e]=new wi(e,this._resourceManager),this._materials[e])},e.prototype.addCustomColor=function(e){var t=e.map(function(e){return Math.round(255*e)}).toString();return this._customColors[t]||(this._customColorCount=(this._customColorCount+1)%127,this._customColors[t]={index:this._customColorCount,color:e}),this._customColors[t].index},e.prototype.getMaterial=function(e){return this._materials[e]},e.prototype.deleteMaterial=function(e){this._materials[e]=null,delete this._materials[e],this._modelMaterials[e]=null,delete this._modelMaterials[e]},e.prototype.deReferenceTexture=function(e){this._resourceManager.removeTexture(e)},e.prototype.upload=function(){for(var e in this._customColors){var t=4*this._customColors[e].index;this._buffer[t]=Math.floor(255*this._customColors[e].color[0]),this._buffer[t+1]=Math.floor(255*this._customColors[e].color[1]),this._buffer[t+2]=Math.floor(255*this._customColors[e].color[2]),this._buffer[t+3]=Math.floor(255*this._customColors[e].color[3])}this.texture.update(this._buffer)},e.prototype.getAllMaterials=function(){return this._materials},e.prototype.addModelMaterial=function(e){var t;t=e.name,this._modelMaterials[t]=e,this._materials[t]=e},e.prototype.addMaterial=function(e){var t;t=e.name,this._materials[t]=e},e.prototype.getModelMaterial=function(e){return this._modelMaterials[e]},e.prototype.getModelMaterials=function(e){var t,r;if(void 0===e&&(e=!1),e)return this._modelMaterials;var i={};for(var n in this._modelMaterials){var a=this._scene.getDrawablesByMaterialName(n);try{for(var o=(t=void 0,xi(a)),s=o.next();!s.done;s=o.next()){s.value.mesh.isLine()||(i[n]=this._modelMaterials[n])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}return i},e}(),Ei={_4X4:[9/16,9/16,.125,.75,.75,7/16,.5,1/16,.8125,.6875,1/16,0,.6875,3/16,5/16,.625,.375,.875,.25,.125,0,.5,.875,.9375,3/16,.375,.9375,.25,7/16,5/16,.625,.8125],_4x4_2D:[.524814,.56488,.74661,.664308,.694092,.462367,.623577,.267783,.340815,.790118,.247202,.532242,.36916,.311385,.825046,.312099,.72246,.905,.27684,.092381,.72246,.905,.943712,.7082,.019365,.400172,.03138,.65182,.995488,.433175,.637063,.021535,.412268,.984494],_8x8_2D_LIST:[]};function Ti(e,t){for(var r=0,i=1/e,n=t;n>0;n=Math.floor(n/e))r+=i*(n%e),i/=e;return r}for(var Si=0;Si<64;++Si){var Ai=Ti(2,Si)*Math.PI,Pi=Ti(3,Si);Ei._8x8_2D_LIST[Si]=[];for(var ki=Math.cos(Ai),Oi=Math.sin(Ai),Di=0;Di<8;++Di){var Ni=(Di+Pi+.125*Math.random())/8;Ei._8x8_2D_LIST[Si][2*Di]=ki*Ni,Ei._8x8_2D_LIST[Si][2*Di+1]=Oi*Ni}}var Ci,Ii=Ei,Ri=(new Float32Array(36),function(){function e(e){this._faces=N.a.FRONTSIDE,this.dirtyBits=-1,this._framebuffer=null,this._mesh=null,this._shader=null,this._clearColor=new Float32Array([1,1,1,0]),this._colorMask=new Int32Array([1,1,1,1]),this._depthTest=!0,this._clearDepth=1,this._depthFunc=e.LESS,this._viewport=new Int32Array([0,0,1,1]),this._planesArray=new Float32Array(24),this._blend=!1,this._stencilTest=!1,this._stencilOp=[e.KEEP,e.KEEP,e.REPLACE],this._stencilFunc=[e.ALWAYS,0,-1],this._stencilMask=0,this._blendFunc=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],this._isPolygonOffset=!1,this._gl=e,e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.lineWidth(1),e.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.colorMask(this._colorMask[0],this._colorMask[1],this._colorMask[2],this._colorMask[3]),e.clearStencil(0),this._depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.clearDepth(this._clearDepth),e.depthFunc(this._depthFunc),this._blend?e.enable(e.BLEND):e.disable(e.BLEND),e.blendFuncSeparate(this._blendFunc[0],this._blendFunc[1],this._blendFunc[2],this._blendFunc[3]),this._stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilMask),e.stencilFunc(this._stencilFunc[0],this._stencilFunc[1],this._stencilFunc[2]),e.stencilOp(this._stencilOp[0],this._stencilOp[1],this._stencilOp[2]),e.viewport(this._viewport[0],this._viewport[1],this._viewport[2],this._viewport[3])}return e.prototype.useShader=function(t,r,i,n,a,o,s){if(t){t!==this._shader&&(this._shader=t,this._shader.use()),!a||this.dirtyBits&e.SHADOW_DIRTY_BIT||(this.dirtyBits|=e.SHADOW_DIRTY_BIT),!n||this.dirtyBits&e.LIGHT_DIRTY_BIT||(this.dirtyBits|=e.LIGHT_DIRTY_BIT),this.dirtyBits&&(this.dirtyBits&e.CLIP_DIRTY_BIT&&this._syncGlobalUniforms(t.reservedUniforms,i),this.dirtyBits&e.LIGHT_DIRTY_BIT&&this._syncLightUniforms(t.reservedUniforms,n),this.dirtyBits&e.SHADOW_DIRTY_BIT&&(this._syncShadowUniforms(t.reservedUniforms,a),this.dirtyBits&=~e.SHADOW_DIRTY_BIT),this.dirtyBits&e.PLATTE_DIRTY_BIT&&this._syncPlatteUniforms(t.reservedUniforms));var l,u=this._gl;if(u.isWebGL2){if(l=t.reservedUniforms.m_uPerFrame){if(r.uniformBlock.set(r.viewMatrix,0),r.uniformBlock.set(r.vpMatrix,16),r.isPerspective())r.uniformBlock[32]=r.eye[0],r.uniformBlock[33]=r.eye[1],r.uniformBlock[34]=r.eye[2],r.uniformBlock[35]=1;else{var c=r.getViewDirection();r.uniformBlock[32]=-c[0],r.uniformBlock[33]=-c[1],r.uniformBlock[34]=-c[2],r.uniformBlock[35]=0}l.upload(r.uniformBlock,u)}(l=t.reservedUniforms.m_uBaseVertexOffset)&&l.upload(s,u)}else if((l=t.reservedUniforms["m_uPerFrame.vpMatrix"])&&l.upload(r.vpMatrix,u),(l=t.reservedUniforms["m_uPerFrame.viewMatrix"])&&l.upload(r.viewMatrix,u),l=t.reservedUniforms["m_uPerFrame.cameraPosition"]){var h;if(r.isPerspective())h=r.getEye();else(c=r.getViewDirection())[0]=-c[0],c[1]=-c[1],c[2]=-c[2],h=c;l.upload(h,u)}}},e.prototype.useFramebuffer=function(e){this._framebuffer!==e&&(this._framebuffer=e,this._framebuffer.use())},e.prototype.useMesh=function(e){this._mesh!==e&&(this._mesh=e,this._mesh.use())},e.prototype.useMaterial=function(e,t){var r=e.polygonOffset,i=e.polygonOffsetFactor,n=e.polygonOffsetUnits;this.setPolygonOffset(r,i,n);var a=e.getSide();a===N.a.INHERITED&&(a=t?2305===t?N.a.FRONTSIDE:2304===t?N.a.BACKSIDE:N.a.FRONTSIDE:N.a.DOUBLESIDE),this.setCullFace(a)},e.prototype.clearColor=function(e){e[0]===this._clearColor[0]&&e[1]===this._clearColor[1]&&e[2]===this._clearColor[2]&&e[3]===this._clearColor[3]||(this._clearColor[0]=e[0],this._clearColor[1]=e[1],this._clearColor[2]=e[2],this._clearColor[3]=e[3],this._gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]))},e.prototype.colorMask=function(e){e[0]===this._colorMask[0]&&e[1]===this._colorMask[1]&&e[2]===this._colorMask[2]&&e[3]===this._colorMask[3]||(this._colorMask[0]=e[0],this._colorMask[1]=e[1],this._colorMask[2]=e[2],this._colorMask[3]=e[3],this._gl.colorMask(this._colorMask[0],this._colorMask[1],this._colorMask[2],this._colorMask[3]))},e.prototype.depthTest=function(e,t,r){var i=this._gl;this._depthTest!==e&&(this._depthTest=e,this._depthTest?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST)),this._clearDepth!==t&&(this._clearDepth=t,i.clearDepth(this._clearDepth)),this._depthFunc!==r&&(this._depthFunc=r,i.depthFunc(this._depthFunc))},e.prototype.depthMask=function(e){this._depthMask!==e&&(this._depthMask=e,this._gl.depthMask(this._depthMask))},e.prototype.viewport=function(e){e[0]===this._viewport[0]&&e[1]===this._viewport[1]&&e[2]===this._viewport[2]&&e[3]===this._viewport[3]||(this._viewport[0]=e[0],this._viewport[1]=e[1],this._viewport[2]=e[2],this._viewport[3]=e[3],this._gl.viewport(this._viewport[0],this._viewport[1],this._viewport[2],this._viewport[3]))},e.prototype.blendFunc=function(e){this._blendFunc[0]==e[0]&&this._blendFunc[1]==e[1]&&this._blendFunc[2]==e[2]&&this._blendFunc[3]==e[3]||(this._blendFunc[0]=e[0],this._blendFunc[1]=e[1],this._blendFunc[2]=e[2],this._blendFunc[3]=e[3],this._gl.blendFuncSeparate(this._blendFunc[0],this._blendFunc[1],this._blendFunc[2],this._blendFunc[3]))},e.prototype.blend=function(e){var t=this._gl;this._blend!==e&&(this._blend=e,this._blend?this._gl.enable(t.BLEND):this._gl.disable(t.BLEND))},e.prototype.stencilTest=function(e,t,r,i){var n=this._gl;this._stencil!==e&&(this._stencil=e,this._stencil?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST)),this._stencilFunc[0]===t[0]&&this._stencilFunc[1]===t[1]&&this._stencilFunc[2]===t[2]||(this._stencilFunc[0]=t[0],this._stencilFunc[1]=t[1],this._stencilFunc[2]=t[2],n.stencilFunc(t[0],t[1],t[2])),this._stencilOp[0]===r[0]&&this._stencilOp[1]===r[1]&&this._stencilOp[2]===r[2]||(this._stencilOp[0]=r[0],this._stencilOp[1]=r[1],this._stencilOp[2]=r[2],n.stencilOp(r[0],r[1],r[2])),this._stencilMask!==i&&(this._stencilMask=i,n.stencilMask(this._stencilMask))},e.prototype.invalidateStates=function(){this._mesh=null,this._framebuffer=null,this._shader=null},e.prototype.invalidateShadow=function(){this.dirtyBits|=e.SHADOW_DIRTY_BIT},e.prototype.invalidateLight=function(){this.dirtyBits|=e.LIGHT_DIRTY_BIT},e.prototype.invalidateClip=function(){this.dirtyBits|=e.CLIP_DIRTY_BIT},e.prototype.invalidatePlatte=function(){this.dirtyBits|=e.PLATTE_DIRTY_BIT},e.prototype.invalidateOther=function(){this.dirtyBits|=e.OTHER_DIRTY_BIT},e.prototype.setPolygonOffset=function(e,t,r){var i=this._gl;e?(!0!==this._isPolygonOffset&&(i.enable(i.POLYGON_OFFSET_FILL),this._isPolygonOffset=!0),this._currentPolygonOffsetFactor===t&&this._currentPolygonOffsetUnits===r||(i.polygonOffset(t,r),this._currentPolygonOffsetFactor=t,this._currentPolygonOffsetUnits=r)):this._isPolygonOffset&&(i.disable(i.POLYGON_OFFSET_FILL),this._isPolygonOffset=!1)},e.prototype.setCullFace=function(e){var t=this._gl;e!==this._faces&&(e===N.a.DOUBLESIDE||e===N.a.DOUBLESIDE_NORMAL_FRONT?t.disable(t.CULL_FACE):(t.enable(t.CULL_FACE),e===N.a.BACKSIDE?t.frontFace(t.CW):e===N.a.FRONTSIDE&&t.frontFace(t.CCW)),this._faces=e)},e.prototype._syncGlobalUniforms=function(e,t){var r;if(t&&(r=e["m_uGlobal.clipPlanes[0]"])){var i=t.getClippingPlanes();this._planesArray[0]=i[0][0],this._planesArray[1]=i[0][1],this._planesArray[2]=i[0][2],this._planesArray[3]=-i[0][3],this._planesArray[4]=i[1][0],this._planesArray[5]=i[1][1],this._planesArray[6]=i[1][2],this._planesArray[7]=-i[1][3],this._planesArray[8]=i[2][0],this._planesArray[9]=i[2][1],this._planesArray[10]=i[2][2],this._planesArray[11]=-i[2][3],this._planesArray[12]=i[3][0],this._planesArray[13]=i[3][1],this._planesArray[14]=i[3][2],this._planesArray[15]=-i[3][3],this._planesArray[16]=i[4][0],this._planesArray[17]=i[4][1],this._planesArray[18]=i[4][2],this._planesArray[19]=-i[4][3],this._planesArray[20]=i[5][0],this._planesArray[21]=i[5][1],this._planesArray[22]=i[5][2],this._planesArray[23]=-i[5][3],r.upload(this._planesArray,this._gl)}},e.prototype._syncLightUniforms=function(e,t){var r;t&&((r=e["m_uSunLight.intensity"])&&r.upload(t.intensity,this._gl),(r=e["m_uSunLight.diffuseMatrix[0]"])&&r.upload(t.envmapMatrix,this._gl),(r=e["m_uSunLight.direction"])&&r.upload(t.direction,this._gl))},e.prototype._syncShadowUniforms=function(e,t){if(t&&t.shadowMaps){var r=e.m_uShadowSize;r&&(r.upload(t.size,this._gl),s.a.isMobile||(r=e.m_uShadowFine).upload(t.fine?1:0,this._gl)),(r=e.m_uShadowContrast)&&r.upload(t.contrast,this._gl);for(var i=0,n=t.shadowMaps.length;i<n;i++)(r=e["m_uShadowTexture"+i])&&(r.upload(6+i,this._gl),t.shadowMaps[i].use(6+i,this._gl)),(r=e["m_uSunLight.shadowMatrix"+i])&&r.upload(t.shadowMatrices[i],this._gl)}},e.prototype._syncPlatteUniforms=function(e){var t=e.m_uPlatteTexture;t&&t.upload(3,this._gl)},e.CLIP_DIRTY_BIT=1,e.LIGHT_DIRTY_BIT=2,e.SHADOW_DIRTY_BIT=4,e.RESERVED_BIT=8,e.PLATTE_DIRTY_BIT=16,e.OTHER_DIRTY_BIT=32,e.ALL_DIRTY_BIT=e.CLIP_DIRTY_BIT|e.LIGHT_DIRTY_BIT|e.SHADOW_DIRTY_BIT|e.RESERVED_BIT|e.PLATTE_DIRTY_BIT|e.OTHER_DIRTY_BIT,e}()),Bi=[0,0],Li=function(){function e(e){this.renderState=new Ri(e.gl),this._resourceManager=e,this._renderTarget=null,this._quadMesh=null,this._quadMesh=e.getMesh("quad"),this._quadMesh.createQuad(),this._canvasFrameBuffer=e.getFramebuffer("default")}return Object.defineProperty(e.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.renderState=null},e.prototype.drawDrawables=function(e,t,r,i,n,a,o,s,l,u){var c=this;if(0===t.length)return 0;this.renderState.viewport(r.viewport),t.forEach(function(t){t&&!t.isDestroy&&(Bi[0]=0,Bi[1]=t.mesh.length,c.drawDrawable(e,t,r,{clipping:a,light:o,shadow:s,cullFace:u,indices:Bi,overridedShaders:i,overridedMaterial:n,materials:l}))})},e.prototype.drawMarks=function(e,t,r,i,n,a,o,s){var l=this;if(0===t.length)return 0;this.renderState.viewport(r.viewport),t.forEach(function(t){t.isDestroy||(Bi[0]=0,Bi[1]=t.mesh.length,l.drawDrawable(e,t,r,{clipping:i,light:n,shadow:a,cullFace:s,indices:Bi,materials:o}))})},e.prototype.drawLinesWithVertexIds=function(e,t,r,i,n,a){var o=this;if(0===t.length)return 0;var s=0;t.forEach(function(t){t.isDestroy||(Bi[0]=0,Bi[1]=t.mesh.length,o.drawDrawable(e,t,r,{clipping:a,indices:Bi,overridedShaders:i,overridedMaterial:n,vertexBaseId:s}),s+=t.mesh.length)})},e.prototype.drawDrawable=function(e,t,r,i){var n=i||{},a=n.clipping,o=n.light,s=n.shadow,l=n.materials,u=n.vertexBaseId,c=n.overridedShaders,h=n.overridedMaterial,d=n.onMaterialCallback,p=n.pickIndex,f=n.cullFace,_=n.indices;if((this._renderTarget!==e||this._renderTarget.always)&&(this._renderTarget=e,this._renderTarget.render(this.renderState),this._renderTarget.always&&(this._renderTarget.always=!1)),t.drawnLastFrame=!1,t.visible&&!(t.testCull&&t.bbox&&r.cull(t,_))){t.faceCamera&&t.update(r);var m,v=null;v=c&&null!==c[0]&&t.useOverride?t.transform.identity?c[0]:c[1]:t.shader,this.renderState.useShader(v,r,a,o,s,l,u),h&&t.useOverride?((m=h).absorb(t.material),m.setSide(t.material.getSide()),d&&d(p,m),d||m.restoreTransparency()):(m=t.material).getSide()===N.a.DOUBLESIDE_NORMAL_FRONT?t.recompileShader("DOUBLESIDED",!0):t.recompileShader("DOUBLESIDED",!1),m.use(v),this.renderState.useMaterial(m,f),this.renderState.useMesh(t.mesh),_?t.render(r,v,_):(t.transform.use(r,v),t.mesh.render()),t.drawnLastFrame=!0}},e.prototype.drawElements=function(e,t,r,i,n,a,o,s,l){var u=this;if(0!==t.length){this.renderState.viewport(r.viewport);var c=r.isBimCullingEnabled();r.setBimCullingEnabled(!1),t.forEach(function(t){var c=t.drawable;c.isDestroy||(Bi[0]=t.indicesOffset,Bi[1]=t.indicesCount,u.drawDrawable(e,c,r,{clipping:i,light:n,shadow:a,cullFace:o,indices:Bi,overridedShaders:s,overridedMaterial:l}))}),r.setBimCullingEnabled(c)}},e.prototype.drawGizmo=function(e,t,r,i){t.isDestroy||(Bi[0]=0,Bi[1]=t.mesh.length,this.drawDrawable(e,t,r,{cullFace:i,indices:Bi}))},e.prototype.drawScreen=function(e,t,r){(this._renderTarget!==e||this._renderTarget.always)&&(this._renderTarget=e,this._renderTarget.render(this.renderState),this._renderTarget.always&&(this._renderTarget.always=!1));this._resourceManager.gl;this.renderState.useShader(t),r.use(t),this.renderState.useMaterial(r),this.renderState.useMesh(this._quadMesh),this._quadMesh.render()},e.prototype.drawDrawablesCustom=function(e,t,r,i,n,a,o,s){var l=this;0!==t.length&&(this.renderState.viewport(r.viewport),t.forEach(function(t,u){t.isDestroy||(Bi[0]=0,Bi[1]=t.mesh.length,l.drawDrawable(e,t,r,{clipping:a,cullFace:o,indices:Bi,overridedShaders:i,overridedMaterial:n,onMaterialCallback:s,pickIndex:u}))}))},e.prototype.drawNodesCustom=function(e,t,r,i,n,a,o,s,l,u){var c=this;0!==t.length&&(this.renderState.viewport(r.viewport),t.sort(function(e,t){return Number(e.drawable.id<t.drawable.id)}),t.forEach(function(t,h){var d=t.drawable;d.isDestroy||(Bi[0]=t.indicesOffset,Bi[1]=t.indicesCount,c.drawDrawable(e,d,r,{clipping:a,light:l,shadow:u,cullFace:o,indices:Bi,overridedShaders:i,overridedMaterial:n,onMaterialCallback:s,pickIndex:h}))}))},e.prototype.drawSkybox=function(e,t,r){(this._renderTarget!==e||this._renderTarget.always)&&(this._renderTarget=e,this._renderTarget.render(this.renderState),this._renderTarget.always&&(this._renderTarget.always=!1));this._resourceManager.gl;this.renderState.setPolygonOffset(!1),this.renderState.viewport(r.viewport),this.renderState.useShader(t.shader,r),this.renderState.useMaterial(t.material),t.material.use(t.shader),t.transform.use(r,t.shader),this.renderState.useMesh(t.mesh),t.mesh.render()},e.prototype.beginFrame=function(e){void 0===e&&(e=null),this._currentFrameBuffer=e,this.renderState.invalidateStates()},e.prototype.endFrame=function(){this.renderState.dirtyBits=0,this._present()},e.prototype.invalidate=function(){this._renderTarget=null,this.renderState.dirtyBits=Ri.ALL_DIRTY_BIT},e.prototype.clear=function(e,t){(this._renderTarget!==e||this._renderTarget.always)&&(this._renderTarget=e,this._renderTarget.render(this.renderState),this._renderTarget.always&&(this._renderTarget.always=!1)),this._resourceManager.gl.clear(t)},e.prototype.restore=function(){},e.prototype.discard=function(){},e.prototype.present=function(e){var t=this._resourceManager.gl;t.isWebGL2&&this._resourceManager.getFramebuffer("default").copy(e,t.COLOR_BUFFER_BIT)},e.prototype._present=function(){var e=this._resourceManager.gl;e.isWebGL2&&null!==this._currentFrameBuffer&&this._canvasFrameBuffer.copy(this._currentFrameBuffer,e.COLOR_BUFFER_BIT)},e}(),Fi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ui=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Vi=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ui(arguments[t]));return e},ji=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},zi=function(){function e(e){this.modelNodes=[],this.drawable=e.isSingleton()?e.drawable.clone():e.drawable,e.clonedDrawable=e.isSingleton()?this.drawable:null,this.indexSize=this.drawable.mesh.indexSize,this.indicesOffset=e.indicesOffset,this.indicesCount=e.indicesCount,this.modelNodes.push(e)}return e.prototype.destroy=function(){this.drawable=null,delete this.drawable,this.modelNodes=null,delete this.modelNodes},e}(),Gi=function(e){function t(t,r){var i=e.call(this,t,r,!1,{})||this;return i._lineColor=[0,0,0],i._queue=[],i}return Fi(t,e),t.prototype.destroy=function(){for(var t=0;t<this._queue.length;++t)this._queue[t].destroy();this._queue=null,delete this._queue,e.prototype.destroy.call(this)},t.prototype.clone=function(){var e=new t(this._resourceManager,this._renderQueueManager);e._queue=new Array(this._queue.length);for(var r=0;r<this._queue.length;r++)e._queue[r]=new zi(this._queue[r].modelNodes[0]),e._queue[r].indicesCount=this._queue[r].indicesCount;return e._lineColor=this._lineColor.slice(0),e},t.prototype.render=function(e,t,r,i,n,a){0!==this._queue.length&&(null!==this._overridedMaterial&&this._overridedMaterial.transparent&&(e.always=!0),t.drawElements(e,this._queue,r,n,a,i,this._cullFace,this._overridedShaders,this._overridedMaterial),null!==this._overridedMaterial&&this._overridedMaterial.transparent&&(e.always=!0))},t.prototype.setLineColor=function(e){this._lineColor=e},t.prototype.isValid=function(){return this._queue.length>0},t.prototype.getNodes=function(){return this._queue},t.prototype.removeNodes=function(e){var t=this;e.forEach(function(e){var r=t._queue.findIndex(function(t){return t.modelNodes[0]===e});-1!==r&&t._queue.splice(r,1)})},t.prototype.getCurSelectedDrawables=function(){var e=[];return this._queue.forEach(function(t){t.drawable.isTriangle()&&e.push(t.drawable)}),e},t.prototype.getCurSelectedNodes=function(){var e=[];return this._queue.forEach(function(t){return e.push.apply(e,Vi(t.modelNodes))}),e},t.prototype.setCurSelectedNodes=function(e,t){void 0===t&&(t=!1),this.restorePreSelectedNodes(t),e&&(this._storeCurSelectedNodes(e),t&&this._hideDrawablesInfluencedBy(e))},t.prototype._storeCurSelectedNodes=function(e){var t,r;e.sort(function(e,t){var r=e.drawable.nodes[0].id-t.drawable.nodes[0].id,i=e.indicesOffset-t.indicesOffset;return 0!==r?r:i});var i=null;try{for(var n=ji(e),a=n.next();!a.done;a=n.next()){var o=a.value,s=o.drawable;if(s.mesh.isTriangle()&&o.hide(),i!==s)s.mesh.isLine()&&s.material.setDiffuse([.96,.32,.14]),this._queue.push(new zi(o)),i=s;else{var l=this._queue[this._queue.length-1];s.transform.count>1?l.indicesOffset+1===o.indicesOffset?(l.indicesCount+=1,l.modelNodes.push(o)):this._queue.push(new zi(o)):l.indicesOffset+l.indicesCount*l.indexSize===o.indicesOffset?(l.indicesCount+=o.indicesCount,l.modelNodes.push(o)):this._queue.push(new zi(o))}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t.prototype._hideDrawablesInfluencedBy=function(e){var t=this._getDrawablesInfluencedBy(e);this._updateTriangleDrawablesVisibility(t)},t.prototype._getDrawablesInfluencedBy=function(e){var t=new Set;return e&&e.forEach(function(e){return t.add(e.drawable)}),t},t.prototype._updateTriangleDrawablesVisibility=function(e){e.forEach(function(e){e.mesh.isTriangle()&&e.updateVisibility(!1,!1)})},t.prototype.restorePreSelectedNodes=function(e){this._hasNoneSelectedNodes()||(this._revertPreSelectedNodes(),this._revertPreColoredNodes(e),e&&this._showDrawblesHidedByPreSelectedNodes(),this._clearPreSelectedNodes())},t.prototype._hasNoneSelectedNodes=function(){return this._queue&&0===this._queue.length},t.prototype._revertPreSelectedNodes=function(){var e,t,r=void 0;try{for(var i=ji(this._queue),n=i.next();!n.done;n=i.next()){var a=n.value.drawable;r!==a.name&&a.mesh.isLine()&&(a.material.setDiffuse(this._lineColor),r=a.name)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype._revertPreColoredNodes=function(e){var t,r;void 0===e&&(e=!1);try{for(var i=ji(this._queue),n=i.next();!n.done;n=i.next()){var a=n.value;a.drawable.mesh.isTriangle()&&a.modelNodes.forEach(function(t){t.show(),e&&t.revertColor()})}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},t.prototype._showDrawblesHidedByPreSelectedNodes=function(){var e=this._getDrawablesHidedByPreSelectedNodes();this._updateTriangleDrawablesVisibility(e)},t.prototype._clearPreSelectedNodes=function(){this._queue.forEach(function(e){return e.destroy()}),this._queue=[]},t.prototype._getDrawablesHidedByPreSelectedNodes=function(){var e=new Set;return this._queue&&this._queue.forEach(function(t){return e.add(t.modelNodes[0].drawable)}),e},t.prototype.setCurSelectedNodesColor=function(e,t){this._queue.forEach(function(r){var i,n=r.drawable,a=!n.material.transparent&&e[3]&&e[3]<.99?e[3]:1;if(n.isSingleton())return n.originalMaterial=null!==(i=n.originalMaterial)&&void 0!==i?i:n.material.clone(),n.material.setDiffuse(e),void n.material.setTransparent(a);r.modelNodes.forEach(function(e){e.setColorIndex(t)}),n.updateColor()})},t.prototype.setNodes=function(e){for(var t="",r=0;r<this._queue.length;++r){t!==(a=this._queue[r].drawable).name&&a.mesh.isLine()&&(a.material.setDiffuse(this._lineColor),t=a.name),this._queue[r].destroy()}if(this._queue=[],e){e.sort(function(e,t){var r;return 0!==(r=e.drawable.nodes[0].id-t.drawable.nodes[0].id)?r:e.indicesOffset-t.indicesOffset});for(var i=null,n=(r=0,e.length);r<n;r++){var a,o=e[r];if(i!==(a=e[r].drawable))a.mesh.isLine()&&a.material.setDiffuse([.96,.32,.14]),this._queue.push(new zi(o)),i=a;else{var s=this._queue[this._queue.length-1];a.transform.count>1?s.indicesOffset+1===o.indicesOffset?s.indicesCount+=1:this._queue.push(new zi(o)):s.indicesOffset+s.indicesCount*s.indexSize===o.indicesOffset?s.indicesCount+=o.indicesCount:this._queue.push(new zi(o))}}}},t}(xr),Hi=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},qi=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Hi(arguments[t]));return e};!function(e){e[e.LOW=0]="LOW",e[e.NORMAL=1]="NORMAL",e[e.HIGH=2]="HIGH",e[e.VERY_HIGH=3]="VERY_HIGH"}(Ci||(Ci={}));var Wi=function(){function e(e,t,r){this._drawableNotUseOverride=[],this.name=e,this.priority=t,this._renderScene=r,this._enabled=!1,this._ready=!1,this._ready=this._initialize(),this._ready||console.warn("RenderEffect "+e+" initialized failed!"),this._renderPasses=new Map}return e.prototype.destroy=function(){this._renderScene=null,delete this._renderScene,delete this._renderPasses,this._renderPasses=null,this._shader&&(this._shader.destroy(),delete this._shader,this._shader=null),this._ready=!1},e.prototype.setEnabled=function(e){this._ready&&(this._enabled=e)},e.prototype.doesSupportMobile=function(e){return!0},e.prototype.doesSupportWebGL1=function(){return!0},e.prototype.isEnabled=function(){return this._enabled},e.prototype.resize=function(e,t){},e.prototype.draw=function(e,t){void 0===t&&(t=-1)},e.prototype._initialize=function(){return!0},e.prototype.setParameter=function(e,t){},e.prototype.getParameter=function(e){},e.prototype.onSceneChanged=function(e){},e.prototype.recompileShader=function(e,t){},e.prototype._getELementNodes=function(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r],a=n.split("+")[0],o=this._renderScene.getScene().models[a].tree.elements[n];if(o)o.getNodes().forEach(function(e){e.drawable.mesh.isLine()||t.push(e)});else console.warn("Element: +"+n+" can not be found!")}return t},e.prototype.afterElementsAdded=function(e){},e.prototype.addElements=function(e,t){var r=t.emissiveColor||[1,1,1];if(e){var i=this._getELementNodes(e),n="emissive"+r,a=this._renderScene.getScene().materialManager.createMaterialOverride(n);if(a.attachShader(this._shader,this._renderScene.getResourceManager()),a.setDiffuse(r),a.setTransparent(1),a.setSide(N.a.FRONTSIDE),this._renderPasses.has(n)){var o=this._renderPasses.get(n),s=o.renderPass,l=o.nodes;i.forEach(function(e){l.has(e)||l.add(e)}),s.setNodes(qi(l.keys()))}else{var u=new Gi(this._renderScene.getResourceManager(),this._renderScene.getRenderQueueManager());u.setOverridedShader(this._shader),u.setOverridedMaterial(a),u.setNodes(i),this._renderPasses.set(n,{renderPass:u,nodes:new Set(i)})}this.afterElementsAdded(a)}},e.prototype.removeElements=function(e){var t=this,r=this._getELementNodes(e),i=[];this._renderPasses.forEach(function(e,t){e.renderPass.removeNodes(r),r.forEach(function(t){e.nodes.has(t)&&e.nodes.delete(t)}),0===e.renderPass.getNodes().length&&i.push(t)}),i.forEach(function(e){t._renderPasses.delete(e)})},e.prototype.addDrawable=function(e){},e.prototype.removeDrawable=function(e){},e.prototype.addCustomDrawable=function(e){},e.prototype.removeCustomDrawable=function(e){},e.prototype.addPawn=function(e){},e.prototype.removePawn=function(e){},e.prototype.beforeRenderWithOverride=function(e){var t=this;e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},e.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1}),this._drawableNotUseOverride.length=0},e}(),Qi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Yi=function(e){function t(t){return e.call(this,"Sketch",Ci.NORMAL,t)||this}return Qi(t,e),t.prototype._initialize=function(){e.prototype._initialize.call(this);var t=this._renderScene.getResourceManager();this._color=[0,0,0],this._surfaceColor=[1,1,1,1],this._blit=new ti(t,k.a.sketch,s.a.isMobile);var r=this._renderScene.getScene().materialManager;this._material=r.createMaterialOverride("sketch-surface"),this.setParameter("contrast",30),this.setParameter("detail",2),this.setParameter("colored",!1),this.setParameter("color",[0,0,0]),this.setParameter("surfaceColor",[1,1,1,1]);var i=t.gl,n=this._renderScene.getCamera();if(s.a.isMobile?this._renderTarget=new wr.a("sketch-position",t,n.viewport[2],n.viewport[3],{depthTest:!0,depthFunc:i.LEQUAL,colorFormat:i.RGBA8,clearColor:[.5,.5,1,0],colorFilter:i.NEAREST,depthFormat:i.DEPTH_COMPONENT24,colorBuffer:0,depthBuffer:1}):this._renderTarget=new wr.a("sketch-position",t,n.viewport[2],n.viewport[3],{depthTest:!0,colorFormat:i.RGBA32F,clearColor:[0,0,1,0],colorFilter:i.NEAREST,colorBuffer:0,depthBuffer:0}),!this._renderTarget.ready)return this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._blit.destroy(),this._blit=null,delete this._blit,!1;this._opaques=new xr(t,this._renderScene.getRenderQueueManager(),!1,{transparent:!1,mask:!1,line:!1,uniqueId:"sketch"}),this._maskeds=new xr(t,this._renderScene.getRenderQueueManager(),!1,{mask:!0,uniqueId:"sketch"}),this._transparents=null,this._hasTransparents=!1;var a=[],o=this._renderScene.getScene();o.clipping.isEnabled()&&a.push("CLIPPING"),o.needRenderDoubleSided()&&a.push("DOUBLESIDED"),o.compressed&&a.push("COMPRESSION"),s.a.isMobile&&(a.push("ENCODE_NORMAL"),a.push("MOBILE"));var l=t.getShader("normaldepth",a);if(!l.ready){var u=k.a.normaldepth;l.createFromShaderSource(u,a)}if(this._opaques.setOverridedShader(l),a.push("ALPHATEST"),!(l=t.getShader("normaldepth",a)).ready){u=k.a.normaldepth;l.createFromShaderSource(u,a)}this._maskeds.setOverridedShader(l),this._opaques.setOverridedMaterial(r.createMaterialAdhoc("sketch_opaques"));var c=r.createMaterialAdhoc("sketch_maskeds");return c.hasMask=!0,this._maskeds.setOverridedMaterial(c),!0},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.destroy=function(){this._ready&&(this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._blit.destroy(),this._blit=null,delete this._blit,this._opaques.destroy(),this._opaques=null,delete this._opaques,this._maskeds.destroy(),this._maskeds=null,delete this._maskeds,this._transparents&&(this._transparents.destroy(),this._transparents=null,delete this._transparents),this._material.destroy(),this._material=null,delete this._material,this._surfaceColor=null,delete this._surfaceColor,this._color=null,delete this._color),e.prototype.destroy.call(this)},t.prototype.resize=function(e,t){this._ready&&(this._ready=!1,this._renderTarget.resize(e,t),this._ready=this._renderTarget.ready,this._ready||(this._ready=!0,this.destroy()))},t.prototype._recompileSurfaceShader=function(){var e=this._renderScene.getScene(),t=[];e.clipping.isEnabled()&&t.push("CLIPPING"),e.needRenderDoubleSided()&&t.push("DOUBLESIDED"),e.compressed&&t.push("COMPRESSION"),s.a.isMobile&&(t.push("ENCODE_NORMAL"),t.push("MOBILE"));var r=this._renderScene.getResourceManager().getShader("solid",t);r.ready||r.createFromShaderSource(k.a.solid,t),this._renderScene.setOverridedShaders(r),this._renderScene.setOverridedMaterials({all:this._material}),this._material.setDiffuse(this._surfaceColor),this._material.setTransparent(this._surfaceColor[3]),Dn.prototype.recompileShadow.call(this._renderScene)},t.prototype.setParameter=function(e,t){var r=this;switch(e){case"detail":var i=Math.min(Math.max(t,0),99.9)/100;this._threshold=.55*Math.sqrt(1-i*i),this._blit.setParameter("uThreshold",this._threshold),this._detailout=t;break;case"contrast":this._contrast=Math.min(Math.max(t,0),100),this._contrast=this._contrast/100,this._blit.setParameter("uContrast",.5*this._contrast),this._contrastout=t;break;case"colored":this._colored=t,this._colored?(this._renderScene.setOverridedShaders(null),this._renderScene.setOverridedMaterials(null)):this._recompileSurfaceShader();break;case"color":this._color[0]=t[0],this._color[1]=t[1],this._color[2]=t[2],this._blit.setParameter("uColor",this._color);break;case"surfaceColor":this._surfaceColor[0]=t[0],this._surfaceColor[1]=t[1],this._surfaceColor[2]=t[2],this._surfaceColor[3]=t[3],this._material.setDiffuse(this._surfaceColor),this._material.setTransparent(this._surfaceColor[3]);break;case"transparents":if(this._hasTransparents=t,this._hasTransparents&&!this._transparents){this._transparents=new xr(this._renderScene.getResourceManager(),this._renderScene.getRenderQueueManager(),!1,{transparent:!0,mask:!1,uniqueId:"sketch"});var n=this._renderScene.getScene();for(var a in n.models){n.models[a].drawables.forEach(function(e){r._transparents.queue.addDrawable(e)})}var o=this._renderScene.getTransparents();this._transparents.setCullFace(o.getCullFace());var s=this._opaques.getOverridedShaders();this._transparents.setOverridedShader(s[0]),this._transparents.setOverridedMaterial(this._opaques.getOverridedMaterial())}this._material.setUseTransparent(!1);break;case"useDepthMask":this._material.setuseDepthMask(t)}},t.prototype.getParameter=function(e){switch(e){case"detail":return this._detailout;case"contrast":return this._contrastout;case"colored":return this._colored;case"color":return this._color;case"surfaceColor":return this._surfaceColor}},t.prototype.draw=function(e,t){if(void 0===t&&(t=-1),this._ready&&this._enabled){var r=this._renderScene.getCamera(),i=this._renderScene.getRenderer(),n=this._renderScene.getScene().getMainLight(),a=this._renderScene.getScene().clipping,o=this._renderScene.getResourceManager().gl;i.clear(this._renderTarget,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),this.beforeRenderWithOverride(this._opaques.queue.drawables),this.beforeRenderWithOverride(this._maskeds.queue.drawables),this._opaques.render(this._renderTarget,i,r,null,a,n),this._maskeds.render(this._renderTarget,i,r,null,a,n),this._hasTransparents&&(this.beforeRenderWithOverride(this._transparents.queue.drawables),this._transparents.render(this._renderTarget,i,r,null,a,n)),this.afterRenderWithOverride(),this._blit.setParameter("uNearAxis",r.getNearPlaneSize()),this._blit.setParameter("uIsPerspective",r.isPerspective()),this._blit.setTexture(this._renderTarget.getColorBuffer()),s.a.isMobile&&(this._blit.setParameter("uNearFar",[r._znear,r._zfar]),this._blit.setDepthTexture(this._renderTarget.getDepthBuffer())),i.renderState.viewport([0,0,e.getWidth(),e.getHeight()]),this._blit.render(i,e,!0)}},t.prototype.onSceneChanged=function(e){var t=this;if(this._ready){this._opaques.queue.removeDrawables(),this._maskeds.queue.removeDrawables(),this._hasTransparents&&this._transparents.queue.removeDrawables();var r=this._renderScene.getScene();for(var i in r.models){r.models[i].drawables.forEach(function(e){t._opaques.queue.addDrawable(e)||t._maskeds.queue.addDrawable(e),t._hasTransparents&&t._transparents.queue.addDrawable(e)})}for(var i in r.pawns){r.pawns[i].drawables.forEach(function(e){t._opaques.queue.addDrawable(e)||t._maskeds.queue.addDrawable(e),t._hasTransparents&&t._transparents.queue.addDrawable(e)})}var n=this._renderScene.getOpaques(),a=this._renderScene.getMaskeds();if(this._opaques.setCullFace(n.getCullFace()),this._maskeds.setCullFace(a.getCullFace()),this._hasTransparents){var o=this._renderScene.getTransparents();this._transparents.setCullFace(o.getCullFace())}}},t.prototype.recompileShader=function(e,t){this._ready&&(this._opaques.recompileOverridedShader(e,t),this._maskeds.recompileOverridedShader(e,t),this._hasTransparents&&this._transparents.recompileOverridedShader(e,t))},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._ready&&(t?this.setParameter("colored",this._colored):(this._renderScene.setOverridedShaders(null),this._renderScene.setOverridedMaterials(null)))},t.prototype.addDrawable=function(e){this._opaques.queue.addDrawable(e)||this._maskeds.queue.addDrawable(e),this._hasTransparents&&this._transparents.queue.addDrawable(e)},t.prototype.removeDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._maskeds.queue.removeDrawable(e),this._hasTransparents&&this._transparents.queue.removeDrawable(e)},t.prototype.isTransParent=function(){return this._enabled&&this._hasTransparents},t}(Wi),Xi=r(13),Zi=function(){function e(e,t,r){this.ready=!1,this.result=null;var i="blurx-"+t,n="blury-"+t;if(!k.a[i]||!k.a[n]){var a,o=[],s=0;for(a=-t;a<=t;++a){var l=a/t*1.5,u=Math.exp(-l*l*r);o.push(u),s+=u}for(a=0;a<2*t+1;++a)o[a]/=s}var c=e.gl;if(!k.a[i]){for(var h="vec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n    vec4 value = vec4(0);\n    float kernel["+(2*t+1)+"];\n",d=0;d<2*t+1;++d)h+="   kernel["+d+"] = "+o[d]+";\n";h+="    for (int i = -"+t+"; i <= "+t+"; i++)\n",c.isWebGL2?h+="        value += texture(tex, (gl_FragCoord.xy + vec2(float(i), 0.0)) * invResolution) * kernel[i + "+t+"];\n":h+="        value += texture2D(tex, (gl_FragCoord.xy + vec2(float(i), 0.0)) * invResolution) * kernel[i + "+t+"];\n",h+="    return value;\n}\n",k.a[i]=new Xi.a(i,"blit.vs",["blit.fs",h],{highPrecision:!0,position:!0,uv:!0})}if(!k.a[n]){for(var p="vec4 shade(in sampler2D tex, in vec2 uv, in vec2 invResolution)\n{\n    vec4 value = vec4(0);\n    float kernel["+(2*t+1)+"];\n",f=0;f<2*t+1;++f)p+="   kernel["+f+"] = "+o[f]+";\n";p+="    for (int i = -"+t+"; i <= "+t+"; i++)\n",c.isWebGL2?p+="        value += texture(tex, (gl_FragCoord.xy + vec2(0.0, float(i))) * invResolution) * kernel[i + "+t+"];\n":p+="        value += texture2D(tex, (gl_FragCoord.xy + vec2(0.0, float(i))) * invResolution) * kernel[i + "+t+"];\n",p+="    return value;\n} ",k.a[n]=new Xi.a(n,"blit.vs",["blit.fs",p],{highPrecision:!0,position:!0,uv:!0})}this._blitx=new ti(e,k.a[i]),this._blity=new ti(e,k.a[n]),this.ready=this._blitx.ready&&this._blity.ready}return e.prototype.destroy=function(){this.ready&&(this._blitx.destroy(),this._blitx=null,delete this._blitx,this._blity.destroy(),this._blity=null,delete this._blity,this.ready=!1)},e.prototype.smooth=function(e,t,r,i){if(!this.ready)return console.error("'blur' is not ready."),null;e.getWidth()==t.getWidth()&&e.getHeight()==t.getHeight()||console.error("'blur' requires two render targets in the same size.");var n,a=[e,t],o=0;for(n=0;n<i;++n)this._blitx.setTexture(a[o].getColorBuffer()),this._blitx.render(r,a[1-o]),o=1-o,this._blity.setTexture(a[o].getColorBuffer()),this._blity.render(r,a[1-o]),o=1-o;return this.result=a[o].getColorBuffer(),this.result},e}(),Ki=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ji=function(e){function t(t){return e.call(this,"SSAO",Ci.HIGH,t)||this}return Ki(t,e),t.prototype._initialize=function(){e.prototype._initialize.call(this),this._radius=5;var t=this._renderScene.getResourceManager(),r=t.gl;if(s.a.isMobile?this._rt0=new wr.a("ssao-rt0",t,1,1,{depthTest:!0,colorFormat:r.RGBA8,clearColor:[0,0,1,-1e10],colorBuffer:2,colorFilter:r.NEAREST,depthFormat:r.DEPTH24_STENCIL8,depthBuffer:1}):this._rt0=new wr.a("ssao-rt0",t,1,1,{depthTest:!0,colorFormat:r.RGBA32F,clearColor:[0,0,1,0],colorFilter:r.LINEAR,depthBuffer:0}),this._rt1=new wr.a("ssao-rt1",t,1,1,{colorFormat:r.RGBA8,colorFilter:r.LINEAR,colorBuffer:0,depthBuffer:0,depthTest:!1}),this._rt2=new wr.a("ssao-rt2",t,1,1,{colorFormat:r.RGBA8,colorFilter:r.LINEAR,colorBuffer:1,depthBuffer:0,depthTest:!1}),!this._rt0.ready||!this._rt1.ready||!this._rt2.ready)return!1;this._opaques=new xr(t,this._renderScene.getRenderQueueManager(),!1,{mask:!1,transparent:!1,line:!1,uniqueId:"ssao"}),this._maskeds=new xr(t,this._renderScene.getRenderQueueManager(),!1,{mask:!0,uniqueId:"ssao"}),this._transparents=null,this._hasTransparents=!1;var i=[],n=this._renderScene.getScene();n.clipping.isEnabled()&&i.push("CLIPPING"),n.needRenderDoubleSided()&&i.push("DOUBLESIDED"),n.compressed&&i.push("COMPRESSION"),s.a.isMobile&&i.push("ENCODE_NORMAL");var a=t.getShader("normaldepth",i);if(!a.ready){var o=k.a.normaldepth;a.createFromShaderSource(o,i)}this._opaques.setOverridedShader(a),i.push("ALPHATEST");var l=t.getShader("normaldepth",i);if(!l.ready){o=k.a.normaldepth;l.createFromShaderSource(o,i)}this._maskeds.setOverridedShader(l),this._opaques.setOverridedMaterial(n.materialManager.createMaterialAdhoc("ssao"));var u=n.materialManager.createMaterialAdhoc("ssao_mask");return u.hasMask=!0,this._maskeds.setOverridedMaterial(u),this._blur=new Zi(t,1,.8),this._blit=new ti(t,k.a.ssao,s.a.isMobile),this._blit.setTexture(this._rt0.getColorBuffer()),this._bitblit=new ti(t),this._blur.ready},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.destroy=function(){this._ready&&(this._rt0.destroy(),this._rt0=null,delete this._rt0,this._rt1.destroy(),this._rt1=null,delete this._rt1,this._rt2.destroy(),this._rt2=null,delete this._rt2,this._blur.destroy(),this._blur=null,delete this._blur,this._blit.destroy(),this._blit=null,delete this._blit,this._maskeds.destroy(),this._maskeds=null,delete this._maskeds,this._transparents&&(this._transparents.destroy(),this._transparents=null,delete this._transparents),this._opaques.destroy(),this._opaques=null,delete this._opaques),e.prototype.destroy.call(this)},t.prototype.recompileShader=function(e,t){this._ready&&(this._opaques.recompileOverridedShader(e,t),this._maskeds.recompileOverridedShader(e,t),this._hasTransparents&&this._transparents.recompileOverridedShader(e,t))},t.prototype.resize=function(e,t){this._ready&&(this._ready=!1,this._rt0.resize(e,t),this._rt1.resize(e,t),this._rt2.resize(e,t),this._ready=this._rt0.ready&&this._rt1.ready&&this._rt2.ready,this._ready||(this._ready=!0,this.destroy()))},t.prototype.draw=function(e,t){if(void 0===t&&(t=-1),this._ready&&this._enabled&&t&&!(t<1)){t-=1;var r=this._renderScene.getRenderer(),i=this._renderScene.getScene().getMainLight(),n=this._renderScene.getScene().clipping,a=this._renderScene.getCamera();if(!a._twoPointsPerpective){var o=this._renderScene.getResourceManager().gl;this.resize(a.viewport[2],a.viewport[3]),r.clear(this._rt0,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),this.beforeRenderWithOverride(this._opaques.queue.drawables),this.beforeRenderWithOverride(this._maskeds.queue.drawables),this._opaques.render(this._rt0,r,a,null,n,i),this._maskeds.render(this._rt0,r,a,null,n,i),this._hasTransparents&&(this.beforeRenderWithOverride(this._transparents.queue.drawables),this._transparents.render(this._rt0,r,a,null,n,i)),this.afterRenderWithOverride(),this._blit.setParameter("uNearAxis",a.getNearPlaneSize()),this._blit.setParameter("uIsPerspective",a.isPerspective()),this._blit.setParameter("uTexTransform",[a.viewport[2]/this._rt0.getWidth(),a.viewport[0]/this._rt0.getWidth()]),this._blit.setParameter("uRadius",this._radius),this._blit.setParameter("uTexSizeAndInv",[this._rt0.getWidth(),this._rt0.getHeight(),1/this._rt0.getWidth(),1/this._rt0.getHeight()]),s.a.isMobile&&(this._blit.setParameter("uNearFar",[a._znear,a._zfar]),this._blit.setDepthTexture(this._rt0.getDepthBuffer())),this._blit.setParameter("uFrameCount",t),this._blit.setParameter("SAMPLES[0]",Ii._8x8_2D_LIST[t]),r.renderState.viewport([0,0,this._rt1.getWidth(),this._rt1.getHeight()]),this._blit.render(r,this._rt1);var l=this._blur.smooth(this._rt1,this._rt2,r,1);this._bitblit.setTexture(l),o.blendFuncSeparate(o.ZERO,o.SRC_COLOR,o.ZERO,o.ONE),r.renderState.viewport([0,0,e.getWidth(),e.getHeight()]),this._bitblit.render(r,e,!0,!0),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)}}},t.prototype.onSceneChanged=function(e){if(this._ready){var t=this._renderScene.getOpaques(),r=this._renderScene.getMaskeds();if(this._opaques.queue.copy(t.queue,e),this._opaques.queue.drawables=this._opaques.queue.drawables.filter(function(e){return!e.popLodInfo}),this._maskeds.queue.copy(r.queue,e),this._opaques.setCullFace(t.getCullFace()),this._maskeds.setCullFace(r.getCullFace()),this._hasTransparents){var i=this._renderScene.getTransparents();this._transparents.queue.copy(i.queue,e),this._transparents.setCullFace(i.getCullFace())}}},t.prototype.setParameter=function(e,t){switch(e){case"radius":this._radius=t;break;case"transparents":if(this._hasTransparents=t,this._hasTransparents&&!this._transparents){this._transparents=new xr(this._renderScene.getResourceManager(),this._renderScene.getRenderQueueManager(),!1,{transparent:!0,mask:!1});var r=this._opaques.getOverridedShaders();this._transparents.setOverridedShader(r[0]),this._transparents.setOverridedMaterial(this._opaques.getOverridedMaterial());var i=this._renderScene.getTransparents();this._transparents.queue.copy(i.queue,-1),this._transparents.setCullFace(i.getCullFace())}}},t.prototype.addDrawable=function(e){e.popLodInfo||(this._opaques.queue.addDrawable(e)||this._maskeds.queue.addDrawable(e),this._hasTransparents&&this._transparents.queue.addDrawable(e))},t.prototype.removeDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._maskeds.queue.removeDrawable(e),this._hasTransparents&&this._transparents.queue.removeDrawable(e)},t}(Wi),$i=function(){function e(e,t){this._resourceManager=e,this._renderQueueManager=t;var r=this._resourceManager.gl;r.isWebGL2||r.drawBuffers?(this._renderTarget=new wr.a("woit-accum",e,1,1,{colorFormat:r.RGBA16F,colorBuffer:1,colorBuffers:[{colorFormat:r.R16F,index:2}],blend:!0,depthMask:!0,depthBuffer:0,depthTest:!0,depthFunc:r.LEQUAL,clearColor:[0,0,0,1]}),this._renderQueueSolid=this._renderQueueManager.getQueue({texture:!1,color:!1,line:!1,uniqueId:"OIT"}),this._renderQueueTexture=this._renderQueueManager.getQueue({texture:!0,color:!1,line:!1,uniqueId:"OIT"}),this._renderQueueColor=this._renderQueueManager.getQueue({texture:!1,color:!0,line:!1,uniqueId:"OIT"}),this._blit=new ti(e,k.a.woit_reveal),this._shadersSolid=new Array(3),this._shadersTexture=new Array(3),this._shadersColor=new Array(3),this._recompileShader(e,["MRT_OIT"]),this._overridedMaterial=null):console.warn("OIT is not supported in WebGL1.0 context")}return e.prototype.destroy=function(){this._blit.destroy(),this._blit=null,delete this._blit,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget;for(var e=0;e<this._shadersSolid.length;e++)this._shadersSolid[e].destroy();this._shadersSolid=null,delete this._shadersSolid;for(e=0;e<this._shadersTexture.length;e++)this._shadersTexture[e].destroy();this._shadersTexture=null,delete this._shadersTexture;for(e=0;e<this._shadersColor.length;e++)this._shadersColor[e].destroy();this._shadersColor=null,delete this._shadersColor},e.prototype._recompileShader=function(e,t){var r={woit_accum_solid:this._shadersSolid,woit_accum_texture:this._shadersTexture,woit_accum_color:this._shadersColor};for(var i in r){r[i][0]=e.getShader(i,t),r[i][0].ready||r[i][0].createFromShaderSource(k.a[i],t);var n=r[i][0],a=n.flags.concat("MODEL_TRANSFORM"),o=this._resourceManager.getShader(n.shaderSource.name,a);o.ready||o.createFromShaderSource(n.shaderSource,a),r[i][1]=o;var s=a.concat("INSTANCING"),l=this._resourceManager.getShader(n.shaderSource.name,s);l.ready||l.createFromShaderSource(n.shaderSource,s),r[i][2]=l}},e.prototype.resize=function(e,t){this._renderTarget.resize(e,t)},e.prototype.addDrawable=function(e){return!(e.material.getTransparent()>.99&&(null===this._overridedMaterial||this._overridedMaterial.getTransparent()>.99))&&(this._renderQueueSolid.addDrawable(e)||this._renderQueueTexture.addDrawable(e)||this._renderQueueColor.addDrawable(e))},e.prototype.removeDrawable=function(e){return this._renderQueueSolid.removeDrawable(e)||this._renderQueueTexture.removeDrawable(e)||this._renderQueueColor.removeDrawable(e)},e.prototype.createQueue=function(e,t){this._renderQueueSolid.create(e,t),this._renderQueueTexture.create(e,t),this._renderQueueColor.create(e,t)},e.prototype.setOverridedMaterial=function(e){this._overridedMaterial=null!==e?e:null},e.prototype.render=function(e,t,r,i,n,a){var o=this._resourceManager.gl;this.resize(r.viewport[2],r.viewport[3]),t.renderState.invalidateLight(),this._renderTarget.setOption("depthMask",!0),t.clear(this._renderTarget,o.COLOR_BUFFER_BIT),this._renderTarget.setOption("blendFunc",[o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA]),this._renderTarget.setOption("blend",!0),this._renderTarget.setOption("depthMask",!1),this._renderTarget.always=!0,this._renderTarget.render(t.renderState),o.clearBufferfv(o.COLOR,1,new Float32Array([0,0,0,1])),this._renderTarget.getFramebuffer().copy(e.getFramebuffer(),o.DEPTH_BUFFER_BIT),t.drawDrawables(this._renderTarget,this._renderQueueSolid.drawables,r,this._shadersSolid,this._overridedMaterial,n,a,i,null),t.drawDrawables(this._renderTarget,this._renderQueueTexture.drawables,r,this._shadersTexture,this._overridedMaterial,n,a,i,null),t.drawDrawables(this._renderTarget,this._renderQueueColor.drawables,r,this._shadersColor,this._overridedMaterial,n,a,i,null),e.setOption("blendFunc",[o.ONE_MINUS_SRC_ALPHA,o.SRC_ALPHA,o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA]),this._blit.setTexture(this._renderTarget.getColorBuffer(0)),this._blit.setParameter("uTexture1",this._renderTarget.getColorBuffer(1)),this._blit.render(t,e,!0)},e}(),en=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),tn=function(e){function t(t,r,i,n){var a=e.call(this,t,r,i,n)||this;return a._oitEnabled=!1,a._oit=null,a}return en(t,e),t.prototype.destroy=function(){this._oitEnabled=null,delete this._oitEnabled,this._oit&&(this._oit.destroy(),this._oit=null,delete this._oit),e.prototype.destroy.call(this)},t.prototype.setOpacityDepthEnable=function(e){this._opacityDepthEnable=e},t.prototype.setOITEnabled=function(e){var t=this;this._oitEnabled=e,this._oitEnabled&&!this._oit&&(this._oit=new $i(this._resourceManager,this._renderQueueManager),this.queue.drawables.forEach(function(e){t._oit.addDrawable(e)}))},t.prototype.resize=function(e,t){this._oit&&this._oit.resize(e,t)},t.prototype.setOverridedMaterial=function(t){e.prototype.setOverridedMaterial.call(this,t),this._oit&&this._oit.setOverridedMaterial(t)},t.prototype.setOverridedShader=function(t){if(null!==t){if(this._overridedMaterial){var r=this._overridedMaterial;this._overridedMaterial=this._overridedMaterial.clone("overridedMaterial")}e.prototype.setOverridedShader.call(this,t),r&&(this._overridedMaterial=r)}else e.prototype.setOverridedShader.call(this,t)},t.prototype.addDrawable=function(t){return this._oit&&this._oit.addDrawable(t),e.prototype.addDrawable.call(this,t)},t.prototype.removeDrawable=function(t){return this._oit&&this._oit.removeDrawable(t),e.prototype.removeDrawable.call(this,t)},t.prototype.createQueue=function(t,r){this._oit&&this._oit.createQueue(t,r),e.prototype.createQueue.call(this,t,r)},t.prototype.render=function(t,r,i,n,a,o){if(this._oitEnabled&&this._oit)this._oit.render(t,r,i,n,a,o);else{var s=this._resourceManager.gl;t.setOption("blend",!0),t.setOption("depthMask",!1),t.always=!0,t.setOption("blendFunc",[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA]),(this._opacityDepthEnable||this._overridedMaterial&&this._overridedMaterial.useDepthMask)&&t.setOption("depthMask",!0),e.prototype.render.call(this,t,r,i,n,a,o),t.setOption("blend",!1),t.setOption("depthMask",!0),t.always=!0}},t}(xr),rn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),nn=function(e){function t(t){var r=e.call(this,"Glow",Ci.NORMAL,t)||this;r._radius=32,r._intensity=.5;var i=[],n=r._renderScene.getScene();if(n.clipping.isEnabled()&&i.push("CLIPPING"),n.needRenderDoubleSided()&&i.push("DOUBLESIDED"),n.compressed&&i.push("COMPRESSION"),s.a.isMobile&&i.push("ENCODE_NORMAL"),i.push("VISIBILITY"),r._shader=t.getResourceManager().getShader("plain",i),!r._shader.ready){var a=k.a.plain;r._shader.createFromShaderSource(a,i)}return r._blur=new Zi(t.getResourceManager(),r._radius,3),r._renderPasses=new Map,r._opaques=new xr(t.getResourceManager(),t.getRenderQueueManager(),!1,{line:!1,transparent:!1,mask:!1,uniqueId:"glow"}),r._transparents=new tn(t.getResourceManager(),t.getRenderQueueManager(),!0,{line:!1,transparent:!0,uniqueId:"glow"}),r}return rn(t,e),t.prototype.destroy=function(){this._blit.destroy(),this._blit=null,delete this._blit,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._renderTarget2.destroy(),this._renderTarget2=null,delete this._renderTarget2,e.prototype.destroy.call(this)},t.prototype._initialize=function(){var e=this._renderScene.getResourceManager(),t=e.gl;if(!t.isWebGL2)return console.warn("Glow effect needs webGL2.0 support!"),this._ready=!1,!1;this._blit=new ti(e,k.a.blit_glow,s.a.isMobile),this._blit.setParameter("offset",0);var r=this._renderScene.getCamera();return s.a.isMobile?(this._renderTarget=new wr.a("glow-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],depthFunc:t.LEQUAL,colorFormat:t.RGBA8,colorFilter:t.NEAREST,colorBuffer:0,depthBuffer:0,depthFilter:t.NEAREST,depthTest:!0}),this._renderTarget2=new wr.a("glow-blur-rt",e,r.viewport[2],r.viewport[3],{clearColor:[1,1,1,0],colorFormat:t.RGBA8,colorFilter:t.NEAREST,colorBuffer:2})):(this._renderTarget=new wr.a("glow-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],depthFunc:t.LEQUAL,colorFilter:t.NEAREST,colorBuffer:1,depthBuffer:0,depthFilter:t.NEAREST,depthTest:!0}),this._renderTarget2=new wr.a("glow-blur-rt",e,r.viewport[2],r.viewport[3],{clearColor:[1,1,1,0],colorFilter:t.NEAREST,colorBuffer:2})),this._blit.ready&&this._renderTarget.ready&&this._renderTarget2},t.prototype.resize=function(e,t){this._ready&&(this._ready=!1,this._renderTarget.resize(e,t),this._renderTarget2.resize(e,t),this._ready=this._renderTarget.ready&&this._renderTarget2.ready)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupportWebGL1=function(){return!1},t.prototype.onSceneChanged=function(e){this._ready},t.prototype.setParameter=function(e,t){switch(e){case"intensity":this._intensity=t,this._blit.setParameter("intensity",t)}},t.prototype.afterElementsAdded=function(e){e.setUseTransparent(!1)},t.prototype.addCustomDrawable=function(e){this._opaques.queue.addDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.removeCustomDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.addPawn=function(e){var t=this;e.drawables.forEach(function(e){t._opaques.queue.addDrawable(e)||t._transparents.queue.addDrawable(e)})},t.prototype.removePawn=function(e){var t=this;e.drawables.forEach(function(e){t._opaques.queue.removeDrawable(e)||t._transparents.queue.removeDrawable(e)})},t.prototype.draw=function(e,t){var r=this;if(void 0===t&&(t=-1),this._enabled&&this._ready){var i=this._renderScene.getCamera(),n=this._renderScene.getRenderer(),a=this._renderScene.getScene().getMainLight(),o=this._renderScene.getScene().clipping;this.resize(i.viewport[2],i.viewport[3]);var s=this._renderScene.getResourceManager().gl;t<0&&!e.getOption("stencilTest")&&this._renderTarget.getFramebuffer().copy(e.getFramebuffer(),s.DEPTH_BUFFER_BIT),n.clear(this._renderTarget,s.COLOR_BUFFER_BIT),s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(-1,-1),this._renderPasses.forEach(function(e){e.renderPass.render(r._renderTarget,n,i,null,o,a)}),this._opaques.render(this._renderTarget,n,i,null,o,a),this._transparents.render(this._renderTarget,n,i,null,o,a),s.disable(s.POLYGON_OFFSET_FILL);var l=this._blur.smooth(this._renderTarget,this._renderTarget2,n,1);this._blit.setTexture(l);var u=this._renderTarget.getOption("blendFunc");e.setOption("blendFunc",[s.ONE,s.ONE,s.ONE,s.ONE]),this._blit.render(n,e,!0),e.setOption("blendFunc",u)}},t}(Wi),an=function(){function e(e,t){this.ready=!1,this.result=null,this._blitx=new ti(e,k.a.glow_blur,s.a.isMobile),this._blitx.setParameter("radius",t),this._blitx.setParameter("direction",[1,0]),this._blitx.setParameter("weights[0]",[.05,.1,.2,.3,.2,.1,.05]),this._blity=new ti(e,k.a.glow_blur,s.a.isMobile),this._blity.setParameter("radius",t),this._blity.setParameter("direction",[0,1]),this._blity.setParameter("weights[0]",[.05,.1,.2,.3,.2,.1,.05]),this.ready=this._blitx.ready&&this._blity.ready}return e.prototype.destroy=function(){this.ready&&(this._blitx.destroy(),this._blitx=null,delete this._blitx,this._blity.destroy(),this._blity=null,delete this._blity,this.ready=!1)},e.prototype.setRadius=function(e){this._blitx.setParameter("radius",e),this._blity.setParameter("radius",e)},e.prototype.smooth=function(e,t,r){return this.ready?(e.getWidth()==t.getWidth()&&e.getHeight()==t.getHeight()||console.error("'blur' requires two render targets in the same size."),this._blitx.setTexture(e.getColorBuffer()),this._blitx.render(r,t),this._blity.setTexture(t.getColorBuffer()),this._blity.render(r,e),this.result=e.getColorBuffer(),this.result):(console.error("'blur' is not ready."),null)},e}(),on=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),sn=function(e){function t(t){var r=e.call(this,"Highlight",Ci.NORMAL,t)||this;r._radius=2,r._intensity=.5,r._innerGlow=!1,r._outerGlow=!0;var i=[],n=r._renderScene.getScene();if(n.clipping.isEnabled()&&i.push("CLIPPING"),n.needRenderDoubleSided()&&i.push("DOUBLESIDED"),n.compressed&&i.push("COMPRESSION"),s.a.isMobile&&i.push("MOBILE"),i.push("VISIBILITY"),r._shader=t.getResourceManager().getShader("plain",i),!r._shader.ready){var a=k.a.plain;r._shader.createFromShaderSource(a,i)}return r._blur=new an(t.getResourceManager(),r._radius),r._renderPasses=new Map,r._opaques=new xr(t.getResourceManager(),t.getRenderQueueManager(),!1,{line:!1,transparent:!1,mask:!1,uniqueId:"highlight"}),r._transparents=new tn(t.getResourceManager(),t.getRenderQueueManager(),!0,{line:!1,transparent:!0,uniqueId:"highlight"}),r}return on(t,e),t.prototype.destroy=function(){this._blit.destroy(),this._blit=null,delete this._blit,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._renderTarget2.destroy(),this._renderTarget2=null,delete this._renderTarget2,e.prototype.destroy.call(this)},t.prototype._initialize=function(){var e=this._renderScene.getResourceManager(),t=e.gl;this._blit=new ti(e,k.a.blit_glow,s.a.isMobile);var r=this._renderScene.getCamera();return s.a.isMobile?(this._renderTarget=new wr.a("highlight-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],depthFunc:t.LEQUAL,colorFormat:t.RGBA8,colorFilter:t.NEAREST,colorBuffer:0,depthBuffer:0,depthFilter:t.NEAREST,depthTest:!0,stencilTest:!0}),this._renderTarget2=new wr.a("highlight-blur-rt",e,r.viewport[2],r.viewport[3],{clearColor:[1,1,1,0],colorFormat:t.RGBA8,colorFilter:t.NEAREST,colorBuffer:2})):(this._renderTarget=new wr.a("highlight-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],depthFunc:t.LEQUAL,colorFilter:t.NEAREST,colorBuffer:1,depthBuffer:0,depthFilter:t.NEAREST,depthTest:!0,stencilTest:!0}),this._renderTarget2=new wr.a("highlight-blur-rt",e,r.viewport[2],r.viewport[3],{clearColor:[1,1,1,0],colorFilter:t.NEAREST,colorBuffer:2})),this._blit.setParameter("intensity",this._intensity),this._blit.ready&&this._renderTarget.ready&&this._renderTarget2},t.prototype.resize=function(e,t){this._ready&&(this._ready=!1,this._renderTarget.resize(e,t),this._renderTarget2.resize(e,t),this._ready=this._renderTarget.ready&&this._renderTarget2.ready)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.onSceneChanged=function(e){this._ready},t.prototype.setParameter=function(e,t){switch(e){case"intensity":this._intensity=t,this._blit.setParameter("intensity",this._intensity);break;case"radius":this._radius=t,this._blur.setRadius(this._radius);break;case"innerGlow":this._innerGlow=!0}},t.prototype.afterElementsAdded=function(e){e.setUseTransparent(!1)},t.prototype.addCustomDrawable=function(e){this._opaques.queue.addDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.removeCustomDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.draw=function(e,t){var r=this;if(void 0===t&&(t=-1),this._enabled&&this._ready){var i=this._renderScene.getCamera(),n=this._renderScene.getRenderer(),a=this._renderScene.getScene().getMainLight(),o=this._renderScene.getScene().clipping;this.resize(i.viewport[2],i.viewport[3]);var s=this._renderScene.getResourceManager().gl;this._renderScene.getRenderer().clear(this._renderTarget,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT);var l=e.getOption("stencilFunc"),u=e.getOption("stencilOp"),c=e.getOption("colorMask");e.setOption("colorMask",[!1,!1,!1,!1]),e.setOption("stencilFunc",[s.ALWAYS,1,255]),e.setOption("stencilOp",[s.KEEP,s.KEEP,s.REPLACE]),e.setOption("depthTest",!1),e.setOption("stencilMask",!0),e.always=!0,n.clear(e,s.STENCIL_BUFFER_BIT),this._renderPasses.forEach(function(t){t.renderPass.render(r._renderTarget,n,i,null,o,a),t.renderPass.render(e,n,i,null,o,a)}),this._opaques.render(this._renderTarget,n,i,null,o,a),this._transparents.render(this._renderTarget,n,i,null,o,a),this._opaques.render(e,n,i,null,o,a),this._transparents.render(e,n,i,null,o,a);var h=this._blur.smooth(this._renderTarget,this._renderTarget2,n);this._blit.setTexture(h),e.setOption("colorMask",c),e.setOption("depthTest",!0),this._outerGlow&&(this._blit.setParameter("offset",0),e.setOption("stencilFunc",[s.NOTEQUAL,1,255]),this._blit.render(n,e,!0)),this._innerGlow&&(this._blit.setParameter("offset",1),e.setOption("stencilFunc",[s.EQUAL,1,255]),this._blit.render(n,e,!0)),e.setOption("stencilFunc",l),e.setOption("stencilOp",u),e.setOption("stencilMask",!1),e.always=!0}},t}(Wi),ln=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),un={Sketch:Yi,SSAO:Ji,Glow:nn,Highlight:sn,DepthOfField:function(e){function t(t){var r=e.call(this,"DepthOfField",Ci.LOW,t)||this;r._opaques=new xr(t.getResourceManager(),t.getRenderQueueManager(),!1,{line:!1,transparent:!1,mask:!1,uniqueId:"DepthOfField"}),r._transparents=new xr(t.getResourceManager(),t.getRenderQueueManager(),!1,{line:!1,transparent:!0,uniqueId:"DepthOfField"}),r._useDepth=!1;var i,n=[],a=r._renderScene.getScene();if(a.clipping.isEnabled()&&n.push("CLIPPING"),a.needRenderDoubleSided()&&n.push("DOUBLESIDED"),a.compressed&&n.push("COMPRESSION"),n.push("ENCODE_DEPTH"),n.push("VISIBILITY"),!(i=t.getResourceManager().getShader("depth",n)).ready){var o=k.a.depth;i.createFromShaderSource(o,n)}r._opaques.setOverridedShader(i),r._transparents.setOverridedShader(i);var s=new F("dof-depth",t.getResourceManager());return r._opaques.setOverridedMaterial(s),r._transparents.setOverridedMaterial(s),r}return ln(t,e),t.prototype.destroy=function(){this._blit.destroy(),this._blit=null,delete this._blit,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,e.prototype.destroy.call(this)},t.prototype._initialize=function(){var e=this._renderScene.getResourceManager(),t=e.gl;this._blit=new ti(e,k.a.blit_dof,s.a.isMobile),this._blit.setParameter("maxblur",1),this._blit.setParameter("aperture",1e-5),this._blit.setParameter("focus",5e3);var r=this._renderScene.getCamera();return t.isWebGL2?(s.a.isMobile?this._renderTarget=new wr.a("DepthOfField-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],colorFormat:t.RGBA8,colorFilter:t.NEAREST,colorBuffer:3}):this._renderTarget=new wr.a("DepthOfField-rt",e,r.viewport[2],r.viewport[3],{clearColor:[0,0,0,0],colorFilter:t.NEAREST,colorBuffer:3}),this._blit.ready&&this._renderTarget.ready):(this._colorBuffer=this._renderScene.getResourceManager().getTexture("DOF-color-buffer"),this._colorBuffer.create(r.viewport[2],r.viewport[3],t.wbFormat,t.NEAREST,t.CLAMP_TO_EDGE),this._blit.ready&&this._colorBuffer.ready)},t.prototype.resize=function(e,t){this._ready&&(this._ready=!1,this._renderScene.getResourceManager().gl.isWebGL2?(this._renderTarget.resize(e,t),this._ready=this._renderTarget.ready):(this._colorBuffer.resize(e,t),this._ready=this._colorBuffer.ready),this._renderTarget2&&this._renderTarget2.ready&&(this._renderTarget2.resize(e,t),this._ready=this._ready&&this._renderTarget2.ready))},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.onSceneChanged=function(e){var t=this;if(this._ready){this._opaques.queue.removeDrawables(),this._transparents.queue.removeDrawables();var r=this._renderScene.getScene();for(var i in r.models){r.models[i].drawables.forEach(function(e){t._opaques.queue.addDrawable(e)||t._transparents.queue.addDrawable(e)})}var n=this._renderScene.getOpaques();this._opaques.setCullFace(n.getCullFace());var a=this._renderScene.getTransparents();this._transparents.setCullFace(a.getCullFace())}},t.prototype.setParameter=function(e,t){switch(e){case"depth":var r=this._renderScene.getResourceManager().getTexture("dof-depth"),i=this._renderScene.getResourceManager().gl,n=t.split("."),a=i.RGB;"png"===n[n.length-1]&&(a=i.RGBA),r.createFromFile(t,a,i.NEAREST,i.CLAMP_TO_EDGE,function(){}),this._blit.setDepthTexture(r);break;case"useDepth":if(this._useDepth=t,!this._renderTarget2&&t){i=this._renderScene.getResourceManager().gl;var o=this._renderScene.getCamera();this._renderTarget2=new wr.a("dof-depth",this._renderScene.getResourceManager(),o.viewport[2],o.viewport[3],{clearColor:[0,0,0,1],colorFormat:i.RGBA8,colorFilter:i.NEAREST,colorBuffer:4})}if(this._blit.setParameter("useDepth",t),t)this._blit.setDepthTexture(this._renderTarget2.getColorBuffer());else(r=this._renderScene.getResourceManager().getTexture("dof-depth"))&&r.ready&&this._blit.setDepthTexture(r);break;case"aperture":this._blit.setParameter("aperture",t);break;case"focus":this._blit.setParameter("focus",t)}},t.prototype.addDrawable=function(e){this._opaques.queue.addDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.removeDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._transparents.queue.removeDrawable(e)},t.prototype.addCustomDrawable=function(e){this._opaques.queue.addDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.removeCustomDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._transparents.queue.addDrawable(e)},t.prototype.draw=function(e,t){if(void 0===t&&(t=-1),this._enabled&&this._ready){var r=this._renderScene.getCamera(),i=this._renderScene.getRenderer(),n=this._renderScene.getScene().getMainLight(),a=this._renderScene.getScene().clipping,o=this._renderScene.getResourceManager().gl;this._useDepth&&(i.clear(this._renderTarget2,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),this._opaques.render(this._renderTarget2,i,r,null,a,n),this._transparents.render(this._renderTarget2,i,r,null,a,n)),this._blit.setParameter("nearFar",[r._znear,r._zfar]),o.isWebGL2?(this._renderTarget.getFramebuffer().copy(e.getFramebuffer(),o.COLOR_BUFFER_BIT),this._blit.setTexture(this._renderTarget.getColorBuffer())):(i.renderState.useFramebuffer(e.getFramebuffer()),this._colorBuffer.copy(),this._blit.setTexture(this._colorBuffer)),this._blit.render(i,e)}},t}(Wi)},cn=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},hn=function(){function e(e,t){this._nDrawalbes=0,this.name=e,this.drawables=[],this._sortByBBoxOrder=!1,this._lastUpdated=-1.01,this._setSelector(t)}return e.prototype.dump=function(){var e,t;console.groupCollapsed("RenderQueue: "+this.name),console.groupCollapsed("Drawables: "+this.drawables.length);try{for(var r=cn(this.drawables),i=r.next();!i.done;i=r.next()){i.value.dump()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}console.groupEnd(),console.log("_lastUpdated: "+this._lastUpdated),console.groupEnd()},e.prototype.destroy=function(){this.drawables=null,delete this.drawables},e.prototype.setSortByBBoxOrderEnable=function(e){this._sortByBBoxOrder=e},e.prototype.removeDrawables=function(){this.drawables=[]},e.prototype.removeDrawable=function(e){for(var t=!1,r=this.drawables.length-1;r>=0;r--)if(this.drawables[r]===e){this.drawables.splice(r,1),t=!0;break}return this._sortByBBoxOrder&&t&&this.sortDrawableByBboxOrder(),t},e.prototype.addDrawable=function(t){return!!this._selector(t)&&(-1==this.drawables.indexOf(t)&&(this._nDrawalbes++,e._nTotalDrawables++,this.drawables.push(t),this._sortByBBoxOrder&&this.sortDrawableByBboxOrder(),!0))},e.prototype.sortDrawableByBboxOrder=function(){this.drawables.sort(function(e,t){return(e.bbox[0]>t.bbox[0]?1:e.bbox[0]==t.bbox[0]?0:-1)+(e.bbox[1]>t.bbox[1]?1:e.bbox[1]==t.bbox[1]?0:-1)+(e.bbox[3]<t.bbox[3]?1:e.bbox[3]==t.bbox[3]?0:-1)+(e.bbox[4]<t.bbox[4]?1:e.bbox[4]==t.bbox[4]?0:-1)})},e.prototype.create=function(e,t){if(!(this._lastUpdated>=t)){for(var r in this.drawables=[],e.models)for(var i=e.models[r],n=0,a=i.drawables.length;n<a;n++)this.addDrawable(i.drawables[n]);if(null!=e.terrain)for(var o=e.terrain,s=0,l=o.tiles.length;s<l;s++)this.addDrawable(o.tiles[s].drawable);this._lastUpdated=t,this.optimize()}},e.prototype.isValid=function(){return this.drawables.length>0},e.prototype.optimize=function(){0!==this.drawables.length&&this.drawables.sort(function(e,t){return e.shader.name.localeCompare(t.shader.name)})},e.prototype._setSelector=function(e){this._selector=function(t){return!e||(void 0===e.line||e.line===t.mesh.isLine())&&((void 0===e.texture||e.texture===t.material.hasTexture)&&((void 0===e.color||e.color===t.mesh.attributes.hasColor)&&((void 0===e.mask||e.mask===t.material.hasMask)&&((void 0===e.transparent||e.transparent===t.material.transparent)&&(void 0===e.shadowCaster||e.shadowCaster===t.isShadowCaster())))))}},e.prototype.sort=function(e){if(this.isValid()&&!this._sortByBBoxOrder){for(var t=e.getViewDirection(),r=U.d.create(),i=0,n=this.drawables.length;i<n;++i){var a=this.drawables[i];U.d.subtract(r,a.bsphere,e.eye),a.distance=U.d.dot(r,t)}this.drawables.sort(function(e,t){return t.distance-e.distance})}},e.prototype.copy=function(e,t){if(this.name!==e.name&&!(this._lastUpdated>=t&&t>0)){this.drawables=[];for(var r=0;r<e.drawables.length;r++){var i=e.drawables[r];this._selector(i)&&this.drawables.push(i)}t>0&&(this._lastUpdated=t)}},e._nTotalDrawables=0,e}(),dn=function(){function e(){this._queues=new Map}return e.prototype.destroy=function(){this._queues.clear(),this._queues=null,delete this._queues},e.prototype.getQueue=function(e){var t="";return e?(t+=void 0===e.line?"":e.line?"_Line_":"_Not_Line_",t+=void 0===e.texture?"":e.texture?"_Texture_":"_Not_Texture_",t+=void 0===e.color?"":e.color?"_Color_":"_Not_Color_",t+=void 0===e.mask?"":e.mask?"_Mask_":"_Not_Mask_",t+=void 0===e.transparent?"":e.transparent?"_Transparent_":"_Not_Transparent_",t+=void 0===e.shadowCaster?"":e.shadowCaster?"_ShadowCaster_":"_Not_ShadowCaster_",t+=void 0===e.uniqueId?"":e.uniqueId):t="default",this._queues.has(t)||this._queues.set(t,new hn(t,e)),this._queues.get(t)},e}(),pn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),fn=function(e){function t(t,r,i){return e.call(this,t,r,i,null)||this}return pn(t,e),t.prototype.setOverridedMaterial=function(t){e.prototype.setOverridedMaterial.call(this,t)},t.prototype.setOverridedShader=function(t){if(null!==t){if(this._overridedMaterial){var r=this._overridedMaterial;this._overridedMaterial=this._overridedMaterial.clone("overridedMaterial")}e.prototype.setOverridedShader.call(this,t),r&&(this._overridedMaterial=r)}else e.prototype.setOverridedShader.call(this,t)},t.prototype.addDrawable=function(t){return e.prototype.addDrawable.call(this,t)},t.prototype.removeDrawable=function(t){return e.prototype.removeDrawable.call(this,t)},t.prototype.createQueue=function(t,r){e.prototype.createQueue.call(this,t,r)},t.prototype.render=function(t,r,i,n,a,o){this._resourceManager.gl;t.setOption("blend",!0),t.always=!0,e.prototype.render.call(this,t,r,i,n,a,o),t.setOption("blend",!1),t.always=!0},t}(xr),_n=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},mn=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},vn=function(){function e(e,t,r,i,n){this._effects={},this._sortedEffects=[],this._hasModel=!1,this._flags={},this._overridedMaterials={},this._scene=e,this._camera=t,this._resourceManager=r,this._renderer=i,this.previous=null,this._effects={},this._sortedEffects=[],this._visualizes=[],this._renderQueueManager=new dn,this._opaques=new xr(r,this._renderQueueManager,!1,{line:!1,transparent:!1,mask:!1}),this._maskeds=new xr(r,this._renderQueueManager,!1,{line:!1,transparent:!1,mask:!0}),this._transparents=new tn(r,this._renderQueueManager,!0,{line:!1,transparent:!0}),this._lines=new xr(r,this._renderQueueManager,!1,{line:!0}),this._bbox=new xr(r,this._renderQueueManager,!1,{line:!0,transparent:!1}),this._loadingBoxLine=new xr(r,this._renderQueueManager,!1,{line:!0,transparent:!1,uniqueId:"loadingBoxLine"}),this._loadingBox=new tn(r,this._renderQueueManager,!0,{line:!1,transparent:!0,uniqueId:"loadingBox"}),this._marks=new fn(r,this._renderQueueManager,!1),this._nodes=new Gi(r,this._renderQueueManager),this._renderPassAll=new tn(r,this._renderQueueManager,!1,{line:!1}),this._skeletons=[],this._flags={doubleSided:!1,clipping:!1,line:!1,oit:!1,overridedMaterial:!1};var a=this._resourceManager.gl;a.isWebGL2?(this._renderTarget=new wr.a("pipeline",this._resourceManager,t.viewport[2],t.viewport[3],{stencilTest:!!n,samples:a.wbSamples,depthFunc:a.LEQUAL,colorFilter:a.NEAREST,colorFormat:a.wbFormat,colorBuffer:0,depthBuffer:0,depthFilter:a.NEAREST}),this._renderTarget.ready||(console.warn("Can't create multisamples render buffer for 'pipeline' and use single-sample render buffer now."),this._renderTarget=new wr.a("pipeline",this._resourceManager,t.viewport[2],t.viewport[3],{stencilTest:!!n,samples:1,depthFunc:a.LEQUAL,colorFilter:a.NEAREST,colorFormat:a.wbFormat,colorBuffer:0,depthBuffer:0,depthFilter:a.NEAREST}))):this._renderTarget=new wr.a("default",this._resourceManager,t.viewport[2],t.viewport[3],{stencilTest:!!n,depthFunc:a.LEQUAL,colorFilter:a.NEAREST,colorFormat:a.wbFormat,colorBuffer:0,depthBuffer:0,depthFilter:a.NEAREST})}return e.prototype.dump=function(){console.groupCollapsed("RenderScene"),this._dumpScene(),this._dumpRenderPasses(),this._dumpEffects(),this._dumpFlags(),this._dumpOveridedMaterials(),this._dumpOveridedShader(),console.groupEnd()},e.prototype._dumpScene=function(){this._scene.dump()},e.prototype._dumpRenderPasses=function(){this._opaques.dump("_opaques"),this._transparents.dump("_transparents"),this._maskeds.dump("_maskeds"),this._lines.dump("_lines"),this._bbox.dump("_bbox"),this._loadingBoxLine.dump("_loadingBoxLine"),this._loadingBox.dump("_loadingBox"),this._nodes.dump("_nodes"),this._renderPassAll.dump("_renderPassAll")},e.prototype._dumpEffects=function(){var e,t;console.groupCollapsed("Effects: "+Object.keys(this._effects).length);try{for(var r=_n(Object.entries(this._effects)),i=r.next();!i.done;i=r.next()){var n=mn(i.value,2),a=n[0],o=n[1];console.log(a+": ",o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}console.groupEnd()},e.prototype._dumpFlags=function(){var e,t;console.groupCollapsed("Flags: "+Object.keys(this._flags).length);try{for(var r=_n(Object.entries(this._flags)),i=r.next();!i.done;i=r.next()){var n=mn(i.value,2),a=n[0],o=n[1];console.log(a+": "+o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}console.groupEnd()},e.prototype._dumpOveridedMaterials=function(){var e,t;console.groupCollapsed("OveridedMaterials: "+Object.keys(this._overridedMaterials).length);try{for(var r=_n(Object.entries(this._overridedMaterials)),i=r.next();!i.done;i=r.next()){var n=mn(i.value,2),a=n[0],o=n[1];console.log(a+": ",o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}console.groupEnd()},e.prototype._dumpOveridedShader=function(){console.log("OveridedShader: ",this._overridedShader)},e.prototype.destroy=function(){for(var e in this._scene=null,delete this._scene,this._camera=null,delete this._camera,this._resourceManager=null,delete this._resourceManager,this._renderer=null,delete this._renderer,this._effects)this._effects[e].destroy();this._effects=null,delete this._effects,this._sortedEffects=null,delete this._sortedEffects,this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,this._opaques.destroy(),this._opaques=null,delete this._opaques,this._maskeds.destroy(),this._maskeds=null,delete this._maskeds,this._transparents.destroy(),this._transparents=null,delete this._transparents,this._lines.destroy(),this._lines=null,delete this._lines,this._bbox.destroy(),this._bbox=null,delete this._bbox,this._loadingBoxLine.destroy(),this._loadingBoxLine=null,delete this._loadingBoxLine,this._loadingBox.destroy(),this._loadingBox=null,delete this._loadingBox,this._nodes.destroy(),this._nodes=null,delete this._nodes,this._flags=null,delete this._flags,this.previous=null,delete this.previous,this._renderQueueManager.destroy(),this._renderQueueManager=null,delete this._renderQueueManager},e.prototype.draw=function(e){return void 0===e&&(e=!1),!1},e.prototype.drawHD=function(){},e.prototype.resize=function(e,t){for(var r in this._camera.setViewport([0,0,e,t],!1),this._effects)this._effects[r].resize(e,t);this._scene.background.skybox&&this._scene.background.skybox.resize(e,t),this._transparents.resize(e,t),this._visualizes.forEach(function(r){r.resize(e,t)})},e.prototype.addEffect=function(e){if(!this._effects.hasOwnProperty(e)){var t=new un[e](this);if(!t.doesSupportMobile(s.a.isMobile))return t.destroy(),void console.warn("Effect "+e+" is not supported on mobile!");this._effects[t.name]=t;for(var r=this._sortedEffects.length,i=0,n=this._sortedEffects.length;i<n;i++)if(this._sortedEffects[i].priority<t.priority){r=i;break}this._sortedEffects.length===r?this._sortedEffects.push(t):this._sortedEffects.splice(r,0,t),t.onSceneChanged()}},e.prototype.removeEffect=function(e){if(this._effects.hasOwnProperty(e)){var t=this._effects[e],r=this._sortedEffects.indexOf(t);this._sortedEffects.splice(r,1),t.destroy(),delete this._effects[e]}},e.prototype.getEffect=function(e){return this._effects.hasOwnProperty(e)?this._effects[e]:(console.warn("Effect '"+e+"' does not exist!"),null)},e.prototype.isEffectEnabled=function(e){return!!this._effects[e]&&this._effects[e].isEnabled()},e.prototype.setEffectEnabled=function(e,t){this._effects.hasOwnProperty(e)||this.addEffect(e),this._effects[e].setEnabled(t)},e.prototype.addVisualize=function(e){return s.a.isMobile&&!e.doesSupportMobile(s.a.isMobile)?(e.destroy(),void console.warn("Visualize "+name+" is not supported on mobile!")):this._resourceManager.gl.isWebGL2||e.doesSupportWebGL1()?void this._visualizes.push(e):(e.destroy(),void console.warn("Visualize "+name+" is not supported in webgl 1.0 context!"))},e.prototype.removeVisualize=function(e){var t=this._visualizes.indexOf(e);-1!==t&&this._visualizes.splice(t,1)},e.prototype.getVisualize=function(e,t){for(var r=0,i=0;i<this._visualizes.length;i++)if(-1!==this._visualizes[i].name.indexOf(e)){if(t===r)return this._visualizes[i];r++}return null},e.prototype.getVisualizes=function(e){for(var t=[],r=0;r<this._visualizes.length;r++)-1!==this._visualizes[r].name.indexOf(e)&&t.push(this._visualizes[r]);return t},e.prototype.getAllVisualizes=function(){return this._visualizes},e.prototype.setOverridedMaterials=function(e){if(this._overridedMaterials=e,!e)return this._removeOverridedMaterials();this._overrideAllRenderPassMaterial(e.all),this._overrideSpecificRenderPassMaterial(e)},e.prototype._removeOverridedMaterials=function(){this._flags.overridedMaterial=!1,this._lines.setOverridedMaterial(null),this._opaques.setOverridedMaterial(null),this._transparents.setOverridedMaterial(null),this._maskeds.setOverridedMaterial(null),this._renderPassAll.setOverridedMaterial(null),this._renderPassAll.createQueue(this._scene,performance.now())},e.prototype._getOnePixelDummyWhiteTexture=function(){var e=this._resourceManager.getTexture("white");if(e.ready)return e;var t=this._resourceManager.gl;return e.create(1,1,t.RGBA8,t.NEAREST,t.CLAMP_TO_EDGE),e.update(new Uint8Array([255,255,255,255])),e},e.prototype._getDefaultTextureShader=function(){var e=this._resourceManager.getShader("texture",[]);if(e.ready)return e;var t=k.a.texture;return e.createFromShaderSource(t,[]),e},e.prototype._attachDummyTextureTo=function(e){e.hasTexture||(e.attachShader(this._getDefaultTextureShader(),this._resourceManager),e.setDiffuseTexture(this._getOnePixelDummyWhiteTexture()))},e.prototype._overrideAllRenderPassMaterial=function(e){e&&(this._flags.overridedMaterial=!0,this._attachDummyTextureTo(e),this._renderPassAll.setOverridedMaterial(e),this._renderPassAll.createQueue(this._scene,performance.now()),this._lines.setOverridedMaterial(e),this._opaques.setOverridedMaterial(e),this._transparents.setOverridedMaterial(e),this._maskeds.setOverridedMaterial(e))},e.prototype._overrideSpecificRenderPassMaterial=function(e){this._overrideLinesMaterial(e.lines),this._overrideMaskedsMaterial(e.maskeds),this._overrideOpaquesMaterial(e.opaques),this._overrideTransparentsMaterial(e.transparents)},e.prototype._overrideLinesMaterial=function(e){e&&this._lines.setOverridedMaterial(e)},e.prototype._overrideMaskedsMaterial=function(e){e&&this._maskeds.setOverridedMaterial(e)},e.prototype._overrideOpaquesMaterial=function(e){e&&(this._attachDummyTextureTo(e),this._opaques.setOverridedMaterial(e))},e.prototype._overrideTransparentsMaterial=function(e){e&&(this._attachDummyTextureTo(e),this._transparents.setOverridedMaterial(e))},e.prototype.getOverridedMaterials=function(){return this._overridedMaterials},e.prototype.setOverridedShaders=function(e){null!==e?this._overrideShaders(e):this._clearOverridedShaders()},e.prototype._clearOverridedShaders=function(){this._overridedShader=null,this._renderPassAll.setOverridedShader(null),this._lines.setOverridedShader(null),this._opaques.setOverridedShader(null),this._transparents.setOverridedShader(null),this._maskeds.setOverridedShader(null)},e.prototype._overrideShaders=function(e){this._renderPassAll.setOverridedShader(e),this._lines.setOverridedShader(e),this._opaques.setOverridedShader(e),this._transparents.setOverridedShader(e);var t=this._attachAlphaTestFlagTo(e);this._maskeds.setOverridedShader(t)},e.prototype._attachFlagsTo=function(e){var t=[];this._scene.needRenderDoubleSided()&&t.push("DOUBLESIDED"),this._flags.section&&t.push("CLIPPING"),this._flags.base?t.push("BASE"):(this._flags.shadow&&t.push("SHADOW"),this._flags.specular&&t.push("SPECULAR")),this._flags.gamma&&t.push("GAMMA"),s.a.isMobile&&t.push("MOBILE"),this._scene.compressed&&t.push("COMPRESSION");var r=e.shaderSource.name,i=this._resourceManager.getShader(r,t);if(!i.ready){var n=k.a[r];i.createFromShaderSource(n,t)}return i},e.prototype._attachAlphaTestFlagTo=function(e){var t=e.shaderSource.name,r=e.flags.concat("ALPHATEST"),i=this._resourceManager.getShader(t,r);if(!i.ready){var n=k.a[t];i.createFromShaderSource(n,r)}return i},e.prototype.getOverridedShader=function(){return this._overridedShader},e.prototype.restorePreSelectedNodes=function(e){void 0===e&&(e=!1),this._nodes.restorePreSelectedNodes(e)},e.prototype.getDrawablesInfluencedByCurSelectedNodes=function(){return this._nodes.getCurSelectedDrawables()},e.prototype.getCurSelectedNodes=function(){return this._nodes.getCurSelectedNodes()},e.prototype.setCurSelectedNodesColor=function(e,t){this._nodes.setCurSelectedNodesColor(e,t)},e.prototype.renderElements=function(e,t,r){var i,n;if(void 0===t&&(t=!1),e){var a=[];try{for(var o=_n(e),s=o.next();!s.done;s=o.next()){var l=s.value,u=l.split("+")[0],c=this._scene.models[u].tree.elements[l];if(c)c.getNodes().forEach(function(e){!t&&e.drawable.mesh.isLine()||a.push(e)});else console.warn("Element: +"+l+" can not be found!")}}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}this._nodes.setCurSelectedNodes(a,r)}else this._nodes.setCurSelectedNodes(null,r)},e.prototype.onOpacityChanged=function(e){var t=this;if(0!==e.length){var r=e[0].material.getTransparent()<.99;e.forEach(function(e){r?(t._opaques.removeDrawable(e),t._transparents.addDrawable(e)):(t._opaques.addDrawable(e),t._transparents.removeDrawable(e))})}},e.prototype.onSceneChanged=function(e){var t,r,i,n;this._lines.createQueue(this._scene,e),this._opaques.createQueue(this._scene,e),this._maskeds.createQueue(this._scene,e),this._transparents.createQueue(this._scene,e),this._renderPassAll.createQueue(this._scene,e),this._lines.queue.removeDrawables(),this._opaques.queue.removeDrawables(),this._maskeds.queue.removeDrawables(),this._transparents.queue.removeDrawables();var a=this._scene.models;for(var o in a)for(var s=0,l=(p=a[o]).drawables.length;s<l;s++)this._lines.queue.addDrawable(p.drawables[s]),this._opaques.queue.addDrawable(p.drawables[s]),this._maskeds.queue.addDrawable(p.drawables[s]),this._transparents.queue.addDrawable(p.drawables[s]);var u=this._scene.shapes;for(var c in u){var h=u[c];this._lines.queue.addDrawable(h),this._opaques.queue.addDrawable(h),this._maskeds.queue.addDrawable(h),this._transparents.queue.addDrawable(h)}var d=this._scene.pawns;for(var o in d){var p;for(s=0,l=(p=d[o]).drawables.length;s<l;s++)this._lines.queue.addDrawable(p.drawables[s]),this._opaques.queue.addDrawable(p.drawables[s]),this._maskeds.queue.addDrawable(p.drawables[s]),this._transparents.queue.addDrawable(p.drawables[s])}try{for(var f=_n(this._scene.text3Ds),_=f.next();!_.done;_=f.next()){var m=_.value;for(s=0,l=m.drawables.length;s<l;s++)this._lines.queue.addDrawable(m.drawables[s]),this._opaques.queue.addDrawable(m.drawables[s]),this._maskeds.queue.addDrawable(m.drawables[s]),this._transparents.queue.addDrawable(m.drawables[s])}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}var v=this._scene.maps;try{for(var y=_n(v),g=y.next();!g.done;g=y.next()){var b=g.value.mapTiles;for(s=0,l=b.length;s<l;s++)this._lines.queue.addDrawable(b[s].drawable),this._opaques.queue.addDrawable(b[s].drawable),this._maskeds.queue.addDrawable(b[s].drawable),this._transparents.queue.addDrawable(b[s].drawable)}}catch(e){i={error:e}}finally{try{g&&!g.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}if(this._opaques.queue.optimize(),this._maskeds.queue.optimize(),this._lines.queue.optimize(),this._scene.needRenderDoubleSided())this._opaques.setCullFace(!1),this._maskeds.setCullFace(!1),this._transparents.setCullFace(!1),this._renderPassAll.setCullFace(!1),this._nodes.setCullFace(!1);else{var w=this._resourceManager.gl;this._opaques.setCullFace(w.CCW),this._maskeds.setCullFace(w.CCW),this._transparents.setCullFace(w.CCW),this._renderPassAll.setCullFace(w.CCW),this._nodes.setCullFace(w.CCW)}for(var x in this._effects)this._effects[x].onSceneChanged(e)},e.prototype.setDoubleFaceEnabled=function(e){if(this._scene.setRenderDoubleSided(e),e)this._opaques.setCullFace(!1),this._maskeds.setCullFace(!1),this._transparents.setCullFace(!1);else{var t=this._resourceManager.gl;this._opaques.setCullFace(t.CCW),this._maskeds.setCullFace(t.CCW),this._transparents.setCullFace(t.CCW)}},e.prototype.optimize=function(){if(this._lines.optimize(),this._opaques.optimize(),this._maskeds.optimize(),this._transparents.optimize(),this._scene.needRenderDoubleSided())this._opaques.setCullFace(!1),this._maskeds.setCullFace(!1),this._transparents.setCullFace(!1);else{var e=this._resourceManager.gl;this._opaques.setCullFace(e.CCW),this._maskeds.setCullFace(e.CCW),this._transparents.setCullFace(e.CCW)}},e.prototype._recompileShaders=function(e,t){for(var r in this._effects)this._effects[r].recompileShader(e,t);for(var i in this._scene.models)this._scene.models[i].drawables.forEach(function(r){r.visible&&r.recompileShader(e,t)});for(var n in this._scene.pawns)this._scene.pawns[n].drawables.forEach(function(r){r.visible&&r.recompileShader(e,t)});this._opaques.recompileOverridedShader(e,t),this._lines.recompileOverridedShader(e,t),this._transparents.recompileOverridedShader(e,t),this._maskeds.recompileOverridedShader(e,t),this._renderPassAll.recompileOverridedShader(e,t),this._renderer.invalidate()},e.prototype.refreshRendering=function(e){void 0===e&&(e=1)},e.prototype.getScene=function(){return this._scene},e.prototype.getRenderQueueManager=function(){return this._renderQueueManager},e.prototype.getResourceManager=function(){return this._resourceManager},e.prototype.setCamera=function(e){this._camera=e},e.prototype.getCamera=function(){return this._camera},e.prototype.getRenderer=function(){return this._renderer},e.prototype.getRenderTarget=function(){return this._renderTarget},e.prototype.isLineRendering=function(e){return this._flags.line},e.prototype.setLineRendering=function(e){this._flags.line=e},e.prototype.addDrawable=function(e){for(var t in this._opaques.addDrawable(e)||this._maskeds.addDrawable(e)||this._lines.addDrawable(e)||this._transparents.addDrawable(e),this._renderPassAll.addDrawable(e),this._effects)this._effects[t].addDrawable(e)},e.prototype.addModelDrawabled=function(e){for(var t in this._opaques.addDrawable(e)||this._maskeds.addDrawable(e)||this._lines.addDrawable(e)||this._transparents.addDrawable(e),this._renderPassAll.addDrawable(e),this._effects)this._effects[t].addDrawable(e);this._hasModel=!0},e.prototype.addBboxDrawable=function(e){this._bbox.addDrawable(e)},e.prototype.removeBboxDrawable=function(e){this._bbox.removeDrawable(e)},e.prototype.addLoadingBoxDrawable=function(e,t){t&&this._loadingBox.addDrawable(t),this._loadingBoxLine.addDrawable(e)},e.prototype.removeLoadingBoxDrawable=function(e,t){t&&this._loadingBox.removeDrawable(t),this._loadingBoxLine.removeDrawable(e)},e.prototype.addMarkDrawable=function(e){this._marks.addDrawable(e)},e.prototype.removeMarkDrawable=function(e){this._marks.removeDrawable(e)},e.prototype.getSkeletons=function(){return this._skeletons},e.prototype.addSkeleton=function(e){this._skeletons.push(e)},e.prototype.removeSkeleton=function(e){var t=this._skeletons.indexOf(e);-1!==t&&this._skeletons.splice(t,1)},e.prototype.removeDrawable=function(e){for(var t in this._opaques.removeDrawable(e)||this._maskeds.removeDrawable(e)||this._lines.removeDrawable(e)||this._transparents.removeDrawable(e),this._renderPassAll.removeDrawable(e),this._effects)this._effects[t].removeDrawable(e)},e.prototype.getOpaques=function(){return this._opaques},e.prototype.getMaskeds=function(){return this._maskeds},e.prototype.getLines=function(){return this._lines},e.prototype.getTransparents=function(){return this._transparents},e.prototype.getMarks=function(){return this._marks},e.prototype.setNodesLineColor=function(e){this._nodes.setLineColor(e)},e.prototype.setOITEnabled=function(e){this._transparents.setOITEnabled(e)},e.prototype.setSortByBBoxOrderEnable=function(e){this._transparents.setSortByBBoxOrderEnable(e)},e.prototype.setOpacityDepthEnable=function(e){this._transparents.setOpacityDepthEnable(e)},e.prototype.isOITEnabled=function(){return this._flags.oit},e.prototype.haseModel=function(){return this._hasModel},e.prototype.isShadowEnabled=function(){return this._flags.shadow},e.prototype.checkOpaqueValid=function(){return this._opaques.queue.isValid()||this._maskeds.queue.isValid()},e}(),yn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),gn=function(e){function t(t,r,i,n,a){var o=e.call(this,t,r,i,n,a)||this;return o._flags={doubleSided:!1,clipping:!1,shadow:!1,specular:!1,line:!1,base:!1,bbox:!1,gamma:!1},o._shadow=null,o}return yn(t,e),t.prototype.destroy=function(){this._shadow&&(this._shadow.destroy(),this._shadow=null,delete this._shadow),e.prototype.destroy.call(this)},t.prototype.draw=function(){var e=this._resourceManager.gl;return this._scene.background.mode===st.a.SKYBOX_SOLIDCOLOR&&this._renderTarget.setClearColor(this._scene.background.color),this._scissor&&(e.enable(e.SCISSOR_TEST),e.scissor(this._camera.viewport[0],this._camera.viewport[1],this._camera.viewport[2],this._camera.viewport[3])),this._drawFrame(this._renderTarget),this._scissor&&e.disable(e.SCISSOR_TEST),!0},t.prototype.drawHD=function(){this.draw(),this._renderer.present(this._renderTarget.getFramebuffer())},t.prototype._drawFrame=function(e){var t=this._resourceManager.gl;this._renderer.clear(e,t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);for(var r=this._scene.clipping,i=this._scene.getMainLight(),n=0;n<this._skeletons.length;n++)this._skeletons[n].update();this._nodes.isValid()&&(e.always=!0,this._nodes.render(e,this._renderer,this._camera,this._shadow,r,i),e.always=!0),this._flags.line&&this._lines.render(e,this._renderer,this._camera,this._shadow,r,i),this._flags.overridedMaterial&&this._renderPassAll.getOverridedMaterial().transparent?(this._drawSkybox(e),this._renderPassAll.render(e,this._renderer,this._camera,this._shadow,r,i),this._drawVisualize(e)):(this._opaques.render(e,this._renderer,this._camera,this._shadow,r,i),this._maskeds.render(e,this._renderer,this._camera,this._shadow,r,i),this._marks.render(e,this._renderer,this._camera,this._shadow,r,i),this._drawSkybox(e),this._drawVisualize(e,!1),this._transparents.render(e,this._renderer,this._camera,this._shadow,r,i),this._drawVisualize(e,!0)),this._flags.bbox&&this._bbox.render(e,this._renderer,this._camera,this._shadow,r,i),this._loadingBox.render(e,this._renderer,this._camera,this._shadow,r,i),this._loadingBoxLine.render(e,this._renderer,this._camera,this._shadow,r,i)},t.prototype._drawSkybox=function(e){this._scene.background.skybox&&this._scene.background.skybox.visible&&(this._scene.background.skybox.update(this._camera.viewMatrix),this._renderer.drawSkybox(e,this._scene.background.skybox,this._scene.background.skybox.camera))},t.prototype._drawView=function(e,t){for(var r=this._scene.clipping,i=this._scene.getMainLight(),n=0;n<this._skeletons.length;n++)this._skeletons[n].update();this._flags.line&&this._lines.render(e,this._renderer,t,this._shadow,r,i),this._flags.overridedMaterial?(this._renderPassAll.render(e,this._renderer,t,this._shadow,r,i),this._drawVisualize(e)):(this._opaques.render(e,this._renderer,t,this._shadow,r,i),this._maskeds.render(e,this._renderer,t,this._shadow,r,i),this._drawVisualize(e),this._scene.background.skybox&&this._scene.background.skybox.visible&&(this._scene.background.skybox.update(t.viewMatrix),this._renderer.drawSkybox(e,this._scene.background.skybox,this._scene.background.skybox.camera)),this._transparents.render(e,this._renderer,t,this._shadow,r,i)),this._flags.bbox&&this._bbox.render(e,this._renderer,t,this._shadow,r,i),this._loadingBox.render(e,this._renderer,this._camera,this._shadow,r,i),this._loadingBoxLine.render(e,this._renderer,this._camera,this._shadow,r,i)},t.prototype._drawEffects=function(e,t){void 0===t&&(t=-1);for(var r=0;r<this._sortedEffects.length;r++)this._sortedEffects[r].draw(e,t)},t.prototype._drawVisualize=function(e,t){void 0===t&&(t=!1);var r=this._scene.clipping,i=this._scene.getMainLight();e.always=!0;for(var n=0;n<this._visualizes.length;n++){var a=this._visualizes[n];t===a.alwaysRenderOnTop&&a.draw(this._renderer,this._camera,r,i,this._shadow,e)}e.always=!0},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this._renderTarget.resize(t,r)},t.prototype.isLineRendering=function(){return this._flags.line},t.prototype.setLineRendering=function(e){this._flags.line=e},t.prototype.setBaseRenderingEnabled=function(e){this._flags.base!==e&&(this._flags.base=e,this._recompileShaders("BASE",e))},t.prototype.recompileSpecular=function(){this._recompileShaders("SPECULAR",this._flags.specular)},t.prototype.setBBoxEnabled=function(e){this._flags.bbox=e},t.prototype.setMarkEnabled=function(e){this._flags.mark=e},t.prototype.isShadowEnabled=function(){return this._flags.shadow},t.prototype.recompileClipping=function(e){for(var t in this._flags.clipping=e,this._recompileShaders("CLIPPING",e),this._shadow&&(this._shadow.recompileShader("CLIPPING",e),this._shadow.draw(null)),this._effects)this._effects[t].recompileShader("CLIPPING",e)},t.prototype.setClippingEnabled=function(e){this._flags.clipping!==e&&this.recompileClipping(e)},t.prototype.isClippingEnabled=function(){return this._flags.clipping},t.prototype.onSceneChanged=function(t){e.prototype.onSceneChanged.call(this,t),this._shadow&&this._shadow.onSceneChanged(t),this._flags.doubleSided=this._scene.needRenderDoubleSided()},t.prototype.setSpecularEnabled=function(e){this._flags.specular=e,this._recompileShaders("SPECULAR",e)},t.prototype.setGammaEnabled=function(e){this._flags.gamma=e,this._recompileShaders("GAMMA",e)},t.prototype.refreshRendering=function(e){void 0===e&&(e=1)},t.prototype.setScissorEnabled=function(e){this._scissor=e},t}(vn),bn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),wn=function(e){function t(t,r){var i=e.call(this,r)||this;return i._scene=t,i._cull=new dr(i),i._perspective=!1,U.a.ortho(i.projectMatrix,-1,1,-1,1,-100,100),U.a.multiply(i.vpMatrix,i.projectMatrix,i.viewMatrix),i}return bn(t,e),t.prototype.createFromLight=function(e,t,r){this._at=P.a.aabb.center(t),this._distance=P.a.aabb.len(t),this.eye=U.d.create(),this.eye[0]=-e[0]*this._distance+this._at[0],this.eye[1]=-e[1]*this._distance+this._at[1],this.eye[2]=-e[2]*this._distance+this._at[2],r?U.a.lookAt(this.viewMatrix,this.eye,this._at,r):U.a.lookAt(this.viewMatrix,this.eye,this._at,[0,0,1]);var i=.505*this._distance,n=i,a=i;this._znear=this._distance-1.02*i,this._zfar=this._distance+1.02*i,this._height=a,this._aspect=1,this._perspective=!1,U.a.ortho(this.projectMatrix,-n,n,-a,a,this._znear,this._zfar),U.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},t.prototype.createFromLightTight=function(e,t,r){var i,n=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],a=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],o=U.d.create();for(i=0;i<r.length;i++)U.d.min(n,n,r[i]),U.d.max(a,a,r[i]);var s=P.a.aabb.create(n,a),l=P.a.aabb.points(s);U.d.lerp(this._at,n,a,.5),this._distance=P.a.aabb.len(t);var u=.505*this._distance;for(this.eye=U.d.create(),this.eye[0]=-e[0]*this._distance+this._at[0],this.eye[1]=-e[1]*this._distance+this._at[1],this.eye[2]=-e[2]*this._distance+this._at[2],U.a.lookAt(this.viewMatrix,this.eye,this._at,[0,0,1]),n=[Number.MAX_VALUE,Number.MAX_VALUE],a=[-Number.MAX_VALUE,-Number.MAX_VALUE],i=0;i<l.length;i++)null!==l[i]&&(o[0]=this.viewMatrix[0]*l[i][0]+this.viewMatrix[4]*l[i][1]+this.viewMatrix[8]*l[i][2]+this.viewMatrix[12],o[1]=this.viewMatrix[1]*l[i][0]+this.viewMatrix[5]*l[i][1]+this.viewMatrix[9]*l[i][2]+this.viewMatrix[13],U.c.min(n,n,o),U.c.max(a,a,o));this._znear=this._distance-1.02*u,this._zfar=this._distance+1.02*u,this._aspect=1,this._perspective=!1,U.a.ortho(this.projectMatrix,n[0],a[0],n[1],a[1],this._znear,this._zfar),U.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},t.prototype.setCullingEnabled=function(e){this._cull.setEnabled(e),e&&this._cull.update()},t.prototype.setBimCullingEnabled=function(e){this._cull.setBimCullingEnabled(this._scene.isBimCullingNeeded&&e),this.isBimCullingEnabled()&&this._cull.update()},t.prototype.isBimCullingEnabled=function(){return this._scene.isBimCullingNeeded&&this._cull.isBimCullingEnabled()},t.prototype.cull=function(e,t){return this._cull.isCulled(e,t)},t}(nr.a),xn=function(){function e(e){this._renderScene=e;var t=this._renderScene.getCamera(),r=t.viewport[2],i=t.viewport[3];this.smSize=r<512&&i<512?1024:2048;var n=this._renderScene.getScene(),a=this._renderScene.getResourceManager();this._opaques=new xr(a,this._renderScene.getRenderQueueManager(),!1,{shadowCaster:!0,mask:!1}),this._maskeds=new xr(a,this._renderScene.getRenderQueueManager(),!1,{shadowCaster:!0,mask:!0});var o=["VISIBILITY","ONLY_DEPTH"];n.clipping.isEnabled()&&o.push("CLIPPING"),n.compressed&&o.push("COMPRESSION");var s=a.getShader("normaldepth",o);if(!s.ready){var l=k.a.normaldepth;s.createFromShaderSource(l,o)}this._opaques.setOverridedShader(s),o.push("ALPHATEST");var u=a.getShader("normaldepth",o);if(!u.ready){l=k.a.normaldepth;u.createFromShaderSource(l,o)}this._maskeds.setOverridedShader(u),this._opaques.setOverridedMaterial(n.materialManager.createMaterialAdhoc("shadow")),this._maskeds.setOverridedMaterial(n.materialManager.createMaterialAdhoc("shadow")),this._lightCamera=new wn(this._renderScene.getScene(),[0,0,this.smSize,this.smSize]),this._lightCamera.setCullingEnabled(!0),this._renderTargets=[],this.shadowMaps=[],this.shadowMatrices=[],this.shadowSplit=1e4,this._ready=!0}return e.prototype.destroy=function(){this._opaques.destroy(),this._opaques=null,delete this._opaques,this._maskeds.destroy(),this._maskeds=null,delete this._maskeds,this._lightCamera.destroy(),this._lightCamera=null,delete this._lightCamera,this._renderScene=null,delete this._renderScene;for(var e=0;e<this._renderTargets.length;e++)this._renderTargets[e].destroy();this._renderTargets=null,delete this._renderTargets,this.shadowMatrices=null,delete this.shadowMatrices,this.shadowMaps=null,delete this.shadowMaps},e.prototype.recompileShader=function(e,t){this._opaques.recompileOverridedShader(e,t),this._maskeds.recompileOverridedShader(e,t)},e.prototype.doesSupportMobile=function(e){return!0},e.prototype.draw=function(e){void 0===e&&(e=-1),this._ready},e.prototype.onSceneChanged=function(e){if(this._ready){var t=this._renderScene.getOpaques(),r=this._renderScene.getMaskeds();this._opaques.queue.copy(t.queue,e),this._maskeds.queue.copy(r.queue,e),this._opaques.setCullFace(t.getCullFace()),this._maskeds.setCullFace(r.getCullFace())}},e.prototype.addDrawable=function(e){this._opaques.queue.addDrawable(e)||this._maskeds.queue.addDrawable(e)},e.prototype.removeDrawable=function(e){this._opaques.queue.removeDrawable(e)||this._maskeds.queue.removeDrawable(e)},e.prototype.beforeRender=function(){this._opaques.queue.drawables.forEach(function(e){e instanceof We&&(e.material.setSide(N.a.DOUBLESIDE),e.shouldUpdate=!1)}),this._maskeds.queue.drawables.forEach(function(e){e instanceof We&&(e.material.setSide(N.a.DOUBLESIDE),e.shouldUpdate=!1)})},e.prototype.afterRender=function(){this._opaques.queue.drawables.forEach(function(e){e instanceof We&&(e.material.setSide(N.a.FRONTSIDE),e.shouldUpdate=!0)}),this._maskeds.queue.drawables.forEach(function(e){e instanceof We&&(e.material.setSide(N.a.FRONTSIDE),e.shouldUpdate=!0)})},e}();function Mn(e,t,r){var i=P.a.frustum.createFromMatrix(t.vpMatrix),n=P.a.intersect.aabb_frustum(e.clipping.get(),i),a=U.d.create();U.d.copy(a,e.getMainLight().direction);Math.min(.005+e.radius/t._distance*.01,.01);var o=U.d.create();Math.abs(a[0])>Math.abs(a[2])?U.d.set(o,-a[1],a[0],0):U.d.set(o,0,-a[2],a[1]),U.d.normalize(o,o);var s=U.d.create();U.d.cross(s,a,o),U.d.normalize(s,s),U.d.normalize(a,a),r.createFromLightTight(a,e.clipping.get(),n),r._cull.update()}var En,Tn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Sn=function(e){function t(t){var r=e.call(this,t)||this;if(!r._ready)return r;r.shadowMatrices.push(U.a.create());var i=r._renderScene.getResourceManager(),n=i.gl;return r._renderTargets.push(new wr.a("shadowesm-depth",i,r.smSize,r.smSize,{colorMask:[0,0,0,0],colorFormat:n.isWebGL2?n.R8:n.RGB,colorBuffer:0,depthFilter:n.NEAREST,depthFormat:n.DEPTH_COMPONENT24,depthBuffer:0})),s.a.isMobile?(r.shadowMaps.push(r._renderTargets[0].getDepthBuffer()),r._ready=r._renderTargets[0].ready):(r._renderTargets.push(new wr.a("shadowesm-smooth",i,r.smSize,r.smSize,{colorFormat:n.isWebGL2?n.R32F:"firefox"===s.a.browserName?n.RGBA32F:n.RGB32F,colorFilter:n.NEAREST,depthTest:!1,depthBufer:0})),r._blit=new ti(i,k.a.shadowsmooth),r._blit.setTexture(r._renderTargets[0].getDepthBuffer()),r.shadowMaps.push(r._renderTargets[1].getColorBuffer()),r._ready=r._blit.ready&&r._renderTargets[0].ready&&r._renderTargets[1].ready),r}return Tn(t,e),t.prototype.destroy=function(){this._blit&&(this._blit.destroy(),this._blit=null,delete this._blit),e.prototype.destroy.call(this)},t.prototype.draw=function(e){if(void 0===e&&(e=-1),this._ready){!function(e,t){t.createFromLight(e.getMainLight().direction,e.clipping.get()),t._cull.update()}(this._renderScene.getScene(),this._lightCamera),U.a.copy(this.shadowMatrices[0],this._lightCamera.vpMatrix),this._lightCamera.setBimCullingEnabled(this._renderScene.getCamera().isBimCullingEnabled());var t=this._renderScene.getRenderer(),r=this._renderScene.getScene().getMainLight(),i=this._renderScene.getScene().clipping,n=this._renderScene.getResourceManager().gl;t.renderState.invalidateClip(),t.clear(this._renderTargets[0],n.DEPTH_BUFFER_BIT),this.beforeRender(),this._opaques.render(this._renderTargets[0],t,this._lightCamera,null,i,r),this._maskeds.render(this._renderTargets[0],t,this._lightCamera,null,i,r),this.afterRender(),s.a.isMobile||this._blit.render(t,this._renderTargets[1])}},t}(xn),An=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Pn=function(e){function t(t){var r=e.call(this,t)||this;if(!r._ready)return r;r._partitions=1,r.smSize=r.smSize/r._partitions;var i=r._renderScene.getResourceManager();r.shadowMaps=new Array(r._partitions),r.shadowMatrices=new Array(r._partitions),r._renderTargets=new Array(r._partitions),r._lightCameras=new Array(r._partitions),r._sceneCameras=new Array(r._partitions);for(var n=i.gl,a=[0,0,r.smSize,r.smSize],o=0;o<r._partitions;o++)r._renderTargets[o]=new wr.a("shadowcsm-depth"+o,i,r.smSize,r.smSize,{colorMask:[0,0,0,0],colorFormat:n.R8,colorBuffer:0,depthFilter:n.NEAREST,depthFormat:n.DEPTH_COMPONENT24,depthBuffer:o}),r.shadowMaps[o]=r._renderTargets[o].getDepthBuffer(),r.shadowMatrices[o]=U.a.create(),r._ready=r._ready&&r._renderTargets[o].ready,r._lightCameras[o]=new wn(t.getScene(),a),r._sceneCameras[o]=new nr.a(a);return r}return An(t,e),t.prototype.destroy=function(){this._lightCameras=null,delete this._lightCameras,this._sceneCameras=null,delete this._sceneCameras,e.prototype.destroy.call(this)},t.prototype.draw=function(e){if(void 0===e&&(e=-1),this._ready){if(1===e){for(var t=this._renderScene.getCamera(),r=this._renderScene.getScene(),i=t.split(this._partitions,this._sceneCameras),n=0;n<this._partitions;n++)Mn(r,this._sceneCameras[n],this._lightCameras[n]),this._lightCameras[n].setViewport([0,0,this.smSize,this.smSize]);this.shadowSplit=.5*(-t.projectMatrix[10]+t.projectMatrix[14]/i[0]+1),this._renderScene.getRenderer().renderState.invalidateClip()}e-=1;var a=Ii._4x4_2D[2*e]-.5,o=Ii._4x4_2D[2*e+1]-.5,s=this._renderScene.getRenderer(),l=this._renderScene.getScene().getMainLight(),u=this._renderScene.getScene().clipping,c=this._renderScene.getResourceManager().gl;this.beforeRender();for(n=0;n<this._partitions;n++)this._lightCameras[n].jitter(a/this.smSize,o/this.smSize),s.renderState.invalidateOther(),s.clear(this._renderTargets[n],c.DEPTH_BUFFER_BIT),this._opaques.render(this._renderTargets[n],s,this._lightCameras[n],null,u,l),this._maskeds.render(this._renderTargets[n],s,this._lightCameras[n],null,u,l),U.a.copy(this.shadowMatrices[n],this._lightCameras[n].vpMatrix),this._lightCameras[n].jitter(-a/this.smSize,-o/this.smSize);this.afterRender()}},t}(xn),kn=function(){function e(e){this.contrast=.5,this.useShadowMap=!1,this.fine=!1,this.useShadowMap=!1,this._enabled=!1,this._enabledCSM=!0,this._renderScene=e,this._coarseShadow=new Sn(e),this._fineShadow=new Pn(e),this._enabledCSM=!0,this.size=this._coarseShadow.smSize,this.shadowSplit=this._coarseShadow.shadowSplit,this.contrast=.5}return e.prototype.destroy=function(){this.shadowMaps=null,delete this.shadowMaps,this.shadowMatrices=null,delete this.shadowMatrices,this._fineShadow.destroy(),this._fineShadow=null,delete this._fineShadow,this._coarseShadow.destroy(),this._coarseShadow=null,delete this._coarseShadow},e.prototype.recompileShader=function(e,t){this._fineShadow.recompileShader(e,t),this._coarseShadow.recompileShader(e,t)},e.prototype.onSceneChanged=function(e){this._fineShadow.onSceneChanged(e),this._coarseShadow.onSceneChanged(e)},e.prototype.draw=function(e){void 0===e&&(e=-1),this._enabled&&this.useShadowMap&&this._renderScene.isVisible()&&(this.fine=e>0,this.fine?(this._fineShadow.draw(e),this.shadowMaps=this._fineShadow.shadowMaps,this.shadowMatrices=this._fineShadow.shadowMatrices,this.size=this._fineShadow.smSize,this.shadowSplit=this._fineShadow.shadowSplit):(this._coarseShadow.draw(e),this.shadowMaps=this._coarseShadow.shadowMaps,this.shadowMatrices=this._coarseShadow.shadowMatrices,this.size=this._coarseShadow.smSize,this.shadowSplit=this._coarseShadow.shadowSplit))},e.prototype.setEnabled=function(e){this._enabled=e},e.prototype.addDrawable=function(e){this._fineShadow&&this._fineShadow.addDrawable(e),this._coarseShadow.addDrawable(e)},e.prototype.removeDrawable=function(e){this._fineShadow&&this._fineShadow.removeDrawable(e),this._coarseShadow.removeDrawable(e)},e.prototype.isCSMEnabled=function(){return this._enabledCSM},e.prototype.setContrast=function(e){this.contrast=e},e.prototype.enabledShadowMap=function(e){this.useShadowMap=e},e}(),On=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Dn=function(e){function t(t,r,i,n,a,o){var s=e.call(this,t,r,i,n,o)||this;s._animationStart=!0,s._alwaysUpdate=!1,s._prFrame=0,s._prSkipFrames=4,s._PR_MAX_FRAMES=16,s._prEnabled=!0,s._needUpdate=0,s._eventEmitter=a,s._alwaysUpdate=!1,s._flags={progressive:!1,doubleSided:!1,clipping:!1,shadow:!1,specular:!1,line:!1,smartCulling:!0};var l=s._resourceManager.gl;return s._prRenderTargets=[new wr.a("pipeline-pr",s._resourceManager,r.viewport[2],r.viewport[3],{depthFunc:l.LEQUAL,colorFilter:l.NEAREST,colorFormat:l.RGBA8,depthBuffer:0,stencilTest:!!o}),new wr.a("pipeline-pr1",s._resourceManager,r.viewport[2],r.viewport[3],{depthTest:!1,colorFilter:l.NEAREST,colorFormat:l.RGBA8,depthBuffer:0,stencilTest:!!o}),new wr.a("pipeline-pr2",s._resourceManager,r.viewport[2],r.viewport[3],{depthTest:!1,colorFilter:l.NEAREST,colorFormat:l.RGBA8,depthBuffer:0,stencilTest:!!o})],s._prBlit=new ti(s._resourceManager,k.a.accumulate),s._endBlit=new ti(s._resourceManager,k.a.blit),s._blit=new ti(s._resourceManager),s._visible=!0,s._onCameraUpdateStopped=function(){s._startProgressivelyDraw(),s._camera.setBimCullingEnabled(!1)},s}return On(t,e),t.prototype.destroy=function(){this._prRenderTargets[0].destroy(),this._prRenderTargets[1].destroy(),this._prRenderTargets[2].destroy(),this._prRenderTargets=null,delete this._prRenderTargets,this._prBlit.destroy(),this._prBlit=null,delete this._prBlit,this._resourceManager.gl.isWebGL2||(this._blit.destroy(),this._blit=null,delete this._blit),e.prototype.destroy.call(this)},t.prototype._drawNormally=function(){this._clearSkybox(),this._animationStart&&(this._eventEmitter.emit("modelo3dAnimationStart"),this._animationStart=!1),this._flags.progressive=!1,this._drawFrame(this._renderTarget)},t.prototype._startProgressivelyDraw=function(){this._prEnabled&&(this._flags.progressive=!0,this._prFrame=1,this._renderer.invalidate(),this._flags.shadow&&this._renderer.renderState.invalidateShadow())},t.prototype.drawProgressively=function(e){this.updateShadow(e);var t=this._resourceManager.gl;t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,null),this._drawFrame(this._prRenderTargets[0])},t.prototype.drawEffectsProgressively=function(e){this._drawEffects(this._prRenderTargets[0],e)},t.prototype.drawEffectsNormally=function(){this._drawEffects(this._renderTarget,-1)},t.prototype.accumulateCurrentFrame=function(e){this._renderer.renderState.viewport(this._camera.viewport),this._prBlit.setTexture(this._prRenderTargets[1+e%2].getColorBuffer()),this._prBlit.setParameter("uTexture0",this._prRenderTargets[0].getColorBuffer()),this._prBlit.setParameter("uFrameCount",e),this._prBlit.render(this._renderer,this._prRenderTargets[2-e%2]),e>1&&(this._blit.setTexture(this._prRenderTargets[2-e%2].getColorBuffer()),this._blit.render(this._renderer,this._renderTarget))},t.prototype._clearSkybox=function(){this._scene.background.mode===st.a.SKYBOX_SOLIDCOLOR&&(this._renderTarget.setClearColor(this._scene.background.color),this._prRenderTargets[0].setClearColor(this._scene.background.color))},t.prototype.drawVR=function(e,t){this._renderer.clear(this._renderTarget,this._resourceManager.gl.COLOR_BUFFER_BIT|this._resourceManager.gl.DEPTH_BUFFER_BIT),this._drawView(this._renderTarget,e),this._renderer.endFrame(),this._renderer.beginFrame(),this._drawView(this._renderTarget,t)},t.prototype.drawHD=function(){for(console.log("RenderScenePR.drawHD"),this._scene.background.mode===st.a.SKYBOX_SOLIDCOLOR&&this._prRenderTargets[0].setClearColor(this._scene.background.color),this.refresh(),this._prFrame=1;this._prFrame<=16;)this._prFrame++;this._resourceManager.gl.isWebGL2&&this._renderer.present(this._prRenderTargets[1+this._prFrame%2].getFramebuffer()),this._flags.progressive=!1,this._prFrame=1},t.prototype._drawEffects=function(e,t){for(var r=0;r<this._sortedEffects.length;r++)this._sortedEffects[r].draw(e,t)},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this._prRenderTargets[0].resize(t,r),this._prRenderTargets[1].resize(t,r),this._prRenderTargets[2].resize(t,r)},t.prototype.isProgressiveRenderingEnabled=function(){return this._prEnabled},t.prototype.setProgressiveRenderingEnabled=function(e){this._prEnabled=e,this._flags.progressive=e,this._prFrame=e?1:0,this._camera.setBimCullingEnabled(!1)},t.prototype.setProgressiveRenderingLatency=function(e){this._prSkipFrames>=this._PR_MAX_FRAMES&&(this._prSkipFrames=15),this._prSkipFrames<0&&(this._prSkipFrames=4)},t.prototype._onAnimationStart=function(){this._camera.setBimCullingEnabled(this._flags.smartCulling)},t.prototype._onAnimationEnd=function(){if(this._flags.progressive)this._needUpdate=0;else{if(this._needUpdate+=1.01,this._needUpdate>1&&(this._needUpdate=.9999),this._prFrame<=0&&this._camera.isBimCullingEnabled())return this._camera.setBimCullingEnabled(!1),void this._renderer.invalidate();this._prFrame=1,this._flags.progressive=!0,this._renderer.clear(this._prRenderTargets[1],this._resourceManager.gl.COLOR_BUFFER_BIT),this._renderer.clear(this._prRenderTargets[2],this._resourceManager.gl.COLOR_BUFFER_BIT),this._flags.shadow&&this._renderer.renderState.invalidateShadow()}},t.prototype.setSmartCullingEnabled=function(e){this._flags.smartCulling=e},t.prototype.isSmartCullingEnabled=function(){return this._flags.smartCulling},t.prototype.getRenderTarget=function(){return this._prFrame>this._PR_MAX_FRAMES?this._prRenderTargets[1+this._prFrame%2]:this._renderTarget},t.prototype.getRenderTargetPR=function(){return this._prRenderTargets[0]},t.prototype.refresh=function(){this._flags.progressive=!1,this._prFrame=0,this._onAnimationStart()},t.prototype.refreshRendering=function(e){void 0===e&&(e=1),this._flags.progressive&&(this._flags.progressive=!1,this._onAnimationStart(),this._prFrame=0),this._needUpdate+=1.01*e,this._needUpdate>20.01&&(this._needUpdate=20.01)},t.prototype.drawBilt=function(e,t){this._endBlit.setTexture(t.getColorBuffer()),this._endBlit.render(this._renderer,e,!0)},t.prototype.onSceneChanged=function(t){void 0===t&&(t=-1),this._visible&&(e.prototype.onSceneChanged.call(this,t),this.updateShadow(),this._startProgressivelyDraw())},t.prototype.updateShadow=function(e){void 0===e&&(e=-1),this._shadow&&this._flags.shadow&&(this._shadow.enabledShadowMap(this.checkOpaqueValid()),this._shadow.draw(e),this._renderer.renderState.invalidateShadow())},t.prototype.setShadowEnabled=function(e){this._flags.shadow!==e&&(this._flags.shadow=e,this._flags.shadow&&null===this._shadow&&(this._shadow=new kn(this),this._shadow.onSceneChanged(-1)),this._shadow.setEnabled(e),this._recompileShaders("SHADOW",e),this._shadow.isCSMEnabled()&&this._recompileShaders("SHADOW_PARTITION",e),this.updateShadow())},t.prototype.recompileShadow=function(){if(this._shadow){var e=this._flags.shadow;this._recompileShaders("SHADOW",e),this._shadow.isCSMEnabled()&&this._recompileShaders("SHADOW_PARTITION",e),this.updateShadow()}},t.prototype.setVisible=function(e){this._visible=e,this.recompileShadow()},t.prototype.isVisible=function(){return this._visible},t.prototype.removeEventListener=function(){this._camera.removeUpdateStopListener(this._onCameraUpdateStopped)},t.prototype.retoreEventListener=function(){this._camera.addUpdateStopListener(this._onCameraUpdateStopped)},t.prototype.setShadowContrast=function(e){this._shadow&&this._shadow.setContrast(e)},t}(gn),Nn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Cn=function(e){function t(t,r){var i=e.call(this,r)||this;return i._scene=t,i._cull=new dr(i),i._centerOffset=[.5,.5],i}return Nn(t,e),Object.defineProperty(t.prototype,"centerOffset",{get:function(){return this._centerOffset},enumerable:!1,configurable:!0}),t.prototype.update=function(e,t,r){U.a.copy(this.viewMatrix,e.viewMatrix),U.a.copy(this.projectMatrix,e.projectMatrix),this._phi=e._phi,this._theta=e._theta,this._at=e._at,this.eye=e.eye,this._distance=e._distance,this._fov=e._fov,this._znear=e._znear,this._zfar=e._zfar,this._aspect=e._aspect,this._perspective=e._perspective,r*=.001,this.projectMatrix[0]=2*this.projectMatrix[0],this.projectMatrix[8]=r/e._zfar,this.projectMatrix[12]=r,this.projectMatrix[8]-=.1*t,this._centerOffset[0]=.5+.5*t*.1,U.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix),this._cull.update()},t.prototype.getNearPlaneSize=function(){return nr.a.prototype.getNearPlaneSize.apply(this)},t.prototype.isPerspective=function(){return this._perspective},t.prototype.setViewport=function(e){var t=e[2],r=e[3];(t>4096||r>4096)&&(t>=r?(r=Math.floor(4096*r/t),t=4096):(t=Math.floor(4096*t/r),r=4096)),this.viewport[0]=e[0],this.viewport[1]=e[1],this.viewport[2]=t,this.viewport[3]=r},t.prototype.setBimCullingEnabled=function(e){},t.prototype.cull=function(e,t){return this._cull.isCulled(e,t)},t.prototype.setCullingEnabled=function(e){this._cull.setEnabled(e)},t}(nr.a),In=function(){function e(e,t,r){this.enabled=!1,this._scene=r,this._ready=!1,this._resourceManager=t,this._warpMaterial=null,this._screenRenderTarget=null,this._resolveRenderTarget=null,this._renderTargets=[],this._hmdWarpParam=[],this._warpScaleParam=[],this._needWarp=!1,this._cameras=[],this._convergence=-.15,this._separation=55,this._blit=new ti(t,k.a.vr_wrap),this._viewer=e;var i=e.getWidth(),n=e.getHeight(),a=[0,0,i,n];this._cameras[0]=new Cn(r,a),this._cameras[1]=new Cn(r,a),this._cameras[0].setCullingEnabled(!0),this._cameras[1].setCullingEnabled(!0),this._cameras[0].setViewport(new Int32Array([0,0,i/2,n])),this._cameras[1].setViewport(new Int32Array([i/2,0,i/2,n])),this._ready=!0}return e.prototype.destroy=function(){this._ready&&this._screenRenderTarget&&(this._screenRenderTarget.destroy(),this._renderTargets[0].destroy(),this._renderTargets[1].destroy(),this._renderTargets[2].destroy(),this._renderTargets[3].destroy(),this._warpMaterial.destroy())},e.prototype.setEnabled=function(e){this.enabled=e},e.prototype.resize=function(e,t){if(this._ready){var r=e,i=t;this._renderTargets[0]&&(this._renderTargets[0].resize(r,i),this._renderTargets[1].resize(r,i),this._renderTargets[2].resize(r,i),this._renderTargets[3].resize(r,i),this._ready=this._renderTargets[0].ready&&this._renderTargets[1].ready&&this._renderTargets[2].ready&&this._renderTargets[3].ready,this.resetWarpParam()),this._cameras[0].setViewport(new Int32Array([0,0,r/2,i])),this._cameras[1].setViewport(new Int32Array([r/2,0,r/2,i]))}},e.prototype.draw=function(e,t,r){this._ready?(this._cameras[0].update(e,-this._convergence,.5*-this._separation),this._cameras[1].update(e,this._convergence,.5*this._separation),this._needWarp?(t.drawVR(this._cameras[0],this._cameras[1],this._renderTargets),this._blit.setParameter("uLeftCenterOffset",this._cameras[0].centerOffset),this._blit.setParameter("uRightCenterOffset",this._cameras[1].centerOffset),r.renderState.viewport([0,0,this.viewer.getWidth(),this.viewer.getHeight()]),this._blit.render(r,this._screenRenderTarget)):t.drawVR(this._cameras[0],this._cameras[1])):console.error("VR is not ready.")},e.prototype.resetWarpParam=function(){this._hmdWarpParam=[1,.18,.2];var e=this._hmdWarpParam[0]+this._hmdWarpParam[1]+this._hmdWarpParam[2],t=this.viewer.getWidth()/2/this.viewer.getHeight();this._warpScaleParam=[2*t,2,.5/t/e,.5/e],this._blit.setParameter("uHmdWarpParam",this._hmdWarpParam),this._blit.setParameter("uWarpScaleParam",this._warpScaleParam)},e.prototype.setConvergence=function(e){this._convergence=e},e.prototype.setSeparation=function(e){this._separation=e},e.prototype.setCalibrationEnabled=function(e){e?this._blit.setParameter("uCalibration",!0):this._blit.setParameter("uCalibration",!1)},e}(),Rn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Bn=U.d.create(),Ln=function(e){function t(t,r){var i=e.call(this,r)||this;return i.setVi=function(e,t){},i.viewport=U.e.clone(r),i.viewMatrix=U.a.create(),i.projectMatrix=U.a.create(),i.vpMatrix=U.a.create(),i.eye=U.d.create(),i._aspect=1,i._znear=.1,i._zfar=1024,i._scene=t,i._perspective=!0,i._centerOfScene=null,i._sceneBoxDiagHalfLen=0,i}return Rn(t,e),t.prototype._updateProjection=function(e,t){if(this._scene){this._centerOfScene=P.a.aabb.center(this._scene.bbox),this._sceneBoxDiagHalfLen=.5*P.a.aabb.len(this._scene.bbox),U.d.subtract(Bn,t.eye,this._centerOfScene);var r=U.d.length(Bn),i=Math.max(r-this._sceneBoxDiagHalfLen,.1),n=1.1*Math.min(r+this._sceneBoxDiagHalfLen,1024);this._znear=i,this._zfar=n}},t.prototype.update=function(e,t,r){this._scene=e._scene,this._at=e._at,U.d.add(this.eye,e.eye,t.offset),this._distance=e._distance,this._fov=Math.max(t.fieldOfView.downDegrees,t.fieldOfView.upDegrees,t.fieldOfView.leftDegrees,t.fieldOfView.rightDegrees),U.a.multiply(this.viewMatrix,r,e.viewMatrix),this._updateProjection(this.projectMatrix,e),U.a.perspectiveFromFieldOfView(this.projectMatrix,t.fieldOfView,this._znear,this._zfar),U.a.multiply(this.vpMatrix,this.projectMatrix,this.viewMatrix)},t.prototype.getNearPlaneSize=function(){return nr.a.prototype.getNearPlaneSize.apply(this)},t.prototype.isPerspective=function(){return this._perspective},t.prototype.setViewport=function(e){nr.a.prototype.setViewport.apply(this,e)},t.prototype.getViewRightDirection=function(){var e=[];return e[0]=this.viewMatrix[0],e[1]=this.viewMatrix[4],e[2]=this.viewMatrix[8],e},t.prototype.cull=function(e){return!1},t}(nr.a),Fn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Un=function(e){function t(){return e.call(this,"instant")||this}return Fn(t,e),t.prototype._update=function(e){return!0},t.prototype.update=function(){var e=this._camera;e._distance=e._targetDistance,e._theta=e._targetTheta,e._phi=e._targetPhi,e._fov=e._targetFov,e._phi>=.49999*Math.PI&&(e._phi=.49999*Math.PI),e._phi<=-.49999*Math.PI&&(e._phi=-.49999*Math.PI),e._firstPerson||(e._at[0]=e._targetAt[0],e._at[1]=e._targetAt[1],e._at[2]=e._targetAt[2]);return e._invTanFov=1/Math.tan(.00872665*e._fov),e._perspective&&(e.projectMatrix[0]=e._invTanFov/e._aspect,e.projectMatrix[5]=e._invTanFov),e._scene&&e._updateProjection(),e.updateVP(),e._cull.update(),!0},t}(ar.a),Vn=null,jn=[0,0,0,0],zn=function(){function e(e,t,r,i){if(this.enabled=!1,this._ready=!1,this._resourceManager=t,this._eventEmitter=i,this._cameras=[],this._vrDisplay=null,this._canvas=null,this._canvasResizeCB=null,this._screenWidth=null,this._screenHeight=null,this._resizeBind=this.resize.bind(this),this._viewer=e,this._defaultViewerHeight=1.65,this._poseMat=U.a.create(),this._prevFrameDataTimeStamp=-.1,navigator.getVRDisplays){var n=this;navigator.getVRDisplays().then(function(e){var t,r,i=e.length;for(t=0;t<i;t++)if((r=e[t]).isConnected&&r.capabilities.canPresent){console.log("VR display: "+r.displayName+" is selected."),n._vrDisplay=r,Vn=new VRFrameData;break}});var a=[0,0,e.getWidth(),e.getHeight()];this._cameras[0]=new Ln(r,a),this._cameras[1]=new Ln(r,a),this._animator=new Un,this._ready=!0}else console.log("Your browser does not support WebVR latest version. VR is disabled.")}return e.prototype.destroy=function(){},e.prototype.switchPresent=function(e,t,r){if(this._vrDisplay&&this._ready){var i=this;if(this._vrDisplay.isPresenting)this.enabled=!1,this._deactivateVR(),this._canvas=null,this._canvasResizeCB=null,this._vrDisplay.exitPresent().then(function(){modelo3d.debug("VR exit present succeeded"),n._animator.detach(),window.removeEventListener("resize",i._resizeBind),i._eventEmitter.emit("webvrOff")},function(){console.error("VR exit present failed")});else{this.enabled=!0,this._canvas=e,this._canvasResizeCB=t,this._activateVR();var n=this;this._vrDisplay.requestPresent([{source:e}]).then(function(){modelo3d.debug("VR request present succeeded"),n._animator.attach(r),i._eventEmitter.emit("webvrOn"),window.addEventListener("resize",i._resizeBind)},function(){console.error("VR request present failed")})}}else this.enabled=!1},e.prototype.isPresenting=function(){return this._ready&&this.enabled&&this._vrDisplay&&this._vrDisplay.isPresenting},e.prototype._activateVR=function(){if(modelo3d.debug("WebVR Debug: enter activateVR"),this._vrDisplay&&this._ready){var e=this._vrDisplay.getEyeParameters("left"),t=this._vrDisplay.getEyeParameters("right"),r=2*Math.max(e.renderWidth,t.renderWidth),i=Math.max(e.renderHeight,t.renderHeight);this._screenWidth=this._canvas.width,this._screenHeight=this._canvas.height,this._canvas&&(this._canvas.width=r,this._canvas.height=i),jn[0]=0,jn[1]=0,jn[2]=r/2,jn[3]=i,this._cameras[0].setViewport(jn),jn[0]=r/2,this._cameras[1].setViewport(jn)}},e.prototype._deactivateVR=function(){this._canvasResizeCB&&this._canvasResizeCB(this._screenWidth,this._screenHeight)},e.prototype.resize=function(){this._screenWidth=window.innerWidth,this._screenHeight=window.innerHeight},e.prototype.getPoseMatrix=function(e,t){var r=t.orientation,i=t.position;r||(r=[0,0,0,1]),i||(i=[0,0,0]),this._vrDisplay.stageParameters?(i[1]-=this._defaultViewerHeight,U.a.fromRotationTranslation(e,r,i),U.a.multiply(e,this._vrDisplay.stageParameters.sittingToStandingTransform,e)):U.a.fromRotationTranslation(e,r,i)},e.prototype.draw=function(e,t,r){if(this._ready&&this._vrDisplay){this._vrDisplay.getFrameData(Vn);var i,n=navigator.getGamepads();(i=n[0])&&(i.buttons[1].pressed&&(e.forward(.01,this._cameras[0].getViewDirection()),e.update()),i.buttons[2].pressed&&(e.forward(.01,this._cameras[0].getViewRightDirection()),e.update())),(i=n[1])&&(i.buttons[1].pressed&&(e.forward(-.01,this._cameras[0].getViewDirection()),e.update()),i.buttons[2].pressed&&(e.forward(-.01,this._cameras[0].getViewRightDirection()),e.update())),this._cameras[0].update(e,this._vrDisplay.getEyeParameters("left"),Vn.leftViewMatrix),this._cameras[1].update(e,this._vrDisplay.getEyeParameters("right"),Vn.rightViewMatrix),t.draw(this._cameras[0],this._cameras[1],null),this._vrDisplay.submitFrame()}else console.error("VR is not ready.")},e.prototype.drawSkybox=function(e,t,r,i,n){this._ready&&this._vrDisplay?(this._vrDisplay.getFrameData(Vn),this._cameras[0].update(e,this._vrDisplay.getEyeParameters("left"),Vn.leftViewMatrix),this._cameras[1].update(e,this._vrDisplay.getEyeParameters("right"),Vn.rightViewMatrix),i.drawSkybox(n,t,this._cameras[0]),i.drawSkybox(n,r,this._cameras[1]),this._vrDisplay.submitFrame()):console.error("VR is not ready.")},e}(),Gn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Hn=function(e){function t(t,r,i,n,a,o){var s=e.call(this,t,i,n,a,o)||this;s._alwaysUpdate=!0,s._nodesBatch=[],s._nodesBatchTransparent=[],s._cameraBatch=[],s._translations=null,s._animationBeginAt=0,s._animationDuration=0,s._animationDirection=1,s._animationCurrent=0,s._animationDone=null,s._overridedMaterials=null,s._overridedShader=null;var l=r.getOverridedMaterials();if(l)if(Object.keys(l).length<=4)for(var u in s._overridedMaterials={},l)s._overridedMaterials[u]=l[u].clone(u+"explodedView");else s._overridedMaterials=l.clone(l.name+"explodedView");for(var u in r.getAllVisualizes().forEach(function(e){s._visualizes.push(e)}),r.getSkeletons().forEach(function(e){s.addSkeleton(e)}),t.pawns)t.pawns[u].drawables.forEach(function(e){s.addDrawable(e)});for(var c in t.text3Ds.forEach(function(e){e.drawables.forEach(function(e){s.addDrawable(e)})}),s._overridedShader=r.getOverridedShader()||null,s._flags={},r._flags)s._flags[c]=r._flags[c];return s._alwaysUpdate=!0,s}return Gn(t,e),t.prototype.destroy=function(){for(var t=0;t<this._nodesBatch.length;t++)this._nodesBatch[t].destroy(),this._nodesBatchTransparent[t].destroy(),this._cameraBatch[t].destroy();this._nodesBatch=null,delete this._nodesBatch,this._nodesBatchTransparent=null,delete this._nodesBatchTransparent,this._cameraBatch=null,delete this._cameraBatch,this._translations=null,delete this._translations,this._animationDone=null,delete this._animationDone,e.prototype.destroy.call(this)},t.prototype.renderElements=function(t,r){void 0===r&&(r=!1),e.prototype.renderElements.call(this,t,r,!0);var i=new vr(this._scene,this._camera.viewport);this._cameraBatch.push(i);var n=this._nodes.clone(),a=new Gi(this._resourceManager,this._renderQueueManager),o=new Gi(this._resourceManager,this._renderQueueManager);this._overridedMaterials&&0!==Object.keys(this._overridedMaterials).length&&(a.setOverridedShader(this._overridedShader),a.setOverridedMaterial(this._overridedMaterials),o.setOverridedShader(this._overridedShader),o.setOverridedMaterial(this._overridedMaterials)),n.getNodes().forEach(function(e){e.drawable.material.getTransparent()<.99?o._queue.push(e):a._queue.push(e)}),this._nodesBatch.push(a),this._nodesBatchTransparent.push(o)},t.prototype._drawFrame=function(e){var t=this._resourceManager.gl;this._renderer.clear(e,t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);for(var r=this._scene.clipping,i=this._scene.getMainLight(),n=0;n<this._skeletons.length;n++)this._skeletons[n].update();var a=[0,0,0];this._animationCurrent=Date.now()-this._animationBeginAt;var o=Math.min(this._animationCurrent/this._animationDuration,1);this._animationDirection<0&&(o=1-o);for(var s=U.a.create(),l=0;l<this._nodesBatch.length;l++)a[0]=this._translations[l][0]*o,a[1]=this._translations[l][1]*o,a[2]=this._translations[l][2]*o,s=U.a.fromTranslation(s,a),U.a.multiply(this._cameraBatch[l].viewMatrix,this._camera.viewMatrix,s),U.a.multiply(this._cameraBatch[l].vpMatrix,this._camera.projectMatrix,this._cameraBatch[l].viewMatrix),U.d.subtract(this._cameraBatch[l].eye,this._camera.eye,a),this._renderer.invalidate(),this._nodesBatch[l].render(e,this._renderer,this._cameraBatch[l],this._shadow,r,i);this._opaques.render(e,this._renderer,this._camera,this._shadow,r,i),this._maskeds.render(e,this._renderer,this._camera,this._shadow,r,i),this._flags.line&&this._lines.render(e,this._renderer,this._camera,this._shadow,r,i),e.always=!0,this._drawVisualize(e),this._transparents.render(e,this._renderer,this._camera,this._shadow,r,i);for(var u=0;u<this._nodesBatch.length;u++)e.always=!0,e.setOption("blend",!0),this._nodesBatchTransparent[u].render(e,this._renderer,this._cameraBatch[u],this._shadow,r,i),e.always=!0,e.setOption("blend",!1);this._scene.background.skybox&&this._scene.background.skybox.visible&&(this._scene.background.skybox.update(this._camera.viewMatrix),this._renderer.drawSkybox(e,this._scene.background.skybox,this._camera)),(o<=0&&this._animationDirection<0||o>=1&&this._animationDirection>0)&&(this._prEnabled=!0,this._animationDone?(this._alwaysUpdate=!1,this._animationDone()):(this._alwaysUpdate=!0,this._eventEmitter.emit("modelo3dTranslationAnimationEnd")))},t.prototype.renderElementsTranslations=function(e){this._translations=e},t.prototype.enter=function(e){this._animationBeginAt=Date.now(),this._animationCurrent=0,this._animationDuration=e,this._animationDirection=1,this._prEnabled=!1,this._flags.specular&&(this._nodesBatch.forEach(function(e){e.recompileOverridedShader("SPECULAR",!0)}),this._nodesBatchTransparent.forEach(function(e){e.recompileOverridedShader("SPECULAR",!0)}),this._renderer.invalidate())},t.prototype.setProgressiveRenderingEnabled=function(e){this._flags.progressive=!1},t.prototype.quit=function(e){this._animationBeginAt=Date.now(),this._animationCurrent=0,this._animationDirection=-1,this._prEnabled=!1,this._flags.progressive=!1,this._animationDone=e},t}(Dn),qn=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Wn=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Qn=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Wn(arguments[t]));return e};function Yn(e){return e===En.BYTE||e===En.UNSIGNED_BYTE?1:e===En.FLOAT||e===En.UNSIGNED_INT?4:e===En.HALF_FLOAT||e===En.UNSIGNED_SHORT?2:void 0}function Xn(e){return["glass","glazing","",""].some(function(t){return e.toLowerCase().includes(t)})}function Zn(e){return["metal","aluminium","steel","bronze","","","",""].some(function(t){return e.toLowerCase().includes(t)})}function Kn(e){return["water","","",""].some(function(t){return e.toLowerCase().includes(t)})}!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT"}(En||(En={}));var Jn,$n=function(){function e(e,t,r){this._scene=e,this._resourceManager=t,this._materialManager=r}return e.prototype.export=function(e){var t,r,i,n,a=e.drawables,o=[],s=this._resourceManager.getSourceDatas(),l={materials:{},geometrys:o,vertexData:s.vertexs,indexData:s.indexs,faces:this._scene.getFaces()>=1?2:1};try{for(var u=qn(a),c=u.next();!c.done;c=u.next()){var h=c.value,d=h.mesh,p=d.attributes.values,f={},_=d.attributes.primitive,m={bufferIndex:d.bufferIndex,box:h.bbox,attribute:f,transfrom:U.a.clone(h.transform.matrix),materialName:h.material.name,primitive:_,indexType:d.getIndexType(),iboBase:d._iboBase,vboBase:d._vboBase,length:d.length,id:h.getId()};try{for(var v=(i=void 0,qn(p)),y=v.next();!y.done;y=v.next()){var g=y.value,b={bufferIndex:m.bufferIndex,type:g.type,bytePerNumber:Yn(g.type),offset:g.offset,size:g.size,stride:g.stride};f[g.name]=b}}catch(e){i={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}m.attribute=f,o.push(m)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return l.materials=this.exportMaterials(),l},e.prototype.exportScene=function(){var e,t,r,i,n=[];for(var a in this._scene.models){var o=this._scene.models[a].getDrawablesWithoutLine();o=o.filter(function(e){return!(e instanceof We)}),n.push.apply(n,Qn(o))}var s=[],l=this._resourceManager.getSourceDatas(),u={materials:{},geometrys:s,vertexData:l.vertexs,indexData:l.indexs,faces:this._scene.getFaces()>=1?2:1};try{for(var c=qn(n),h=c.next();!h.done;h=c.next()){var d=h.value,p=d.mesh,f=p.attributes.values,_={},m=p.attributes.primitive,v={bufferIndex:p.bufferIndex,box:d.bbox,attribute:_,transfrom:U.a.clone(d.transform.matrix),materialName:d.material.name,primitive:m,indexType:p.getIndexType(),iboBase:p._iboBase,vboBase:p._vboBase,length:p.length,id:d.getId()};try{for(var y=(r=void 0,qn(f)),g=y.next();!g.done;g=y.next()){var b=g.value,w={bufferIndex:v.bufferIndex,type:b.type,bytePerNumber:Yn(b.type),offset:b.offset,size:b.size,stride:b.stride};_[b.name]=w}}catch(e){r={error:e}}finally{try{g&&!g.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}v.attribute=_,s.push(v)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}return u.materials=this.exportMaterials(),u},e.prototype.exportMaterials=function(){var e=this._materialManager.getModelMaterials(!0),t=this._resourceManager.getSourceTextures(),r={};for(var i in e){var n=!0,a={opacityMask:!1,useMxType:!0,diffuse:[1,1,1],reflect:[1,1,1],refract:[1,1,1],gloss:1},o=e[i];a.opacityMask=o.hasMask;var s=o.getTransparent(),l=t.get(o.textureFullName);if(Xn(o.name)){if(a.diffuse=[0,0,0],a.reflect=[0,0,0],a.refract=[.2,.2,.2],a.gloss=1,!o.hasTexture)if(o.transparent){var u=1-s;a.refract=[u,u,u]}else a.refract=[0,0,0];o.textureTransparent&&(a.refract={value:l.name,image:l.image,scale:[1,1,0]})}else if(Zn(o.name))a.diffuse=[.72,.72,.72],a.reflect=[1,1,1],a.refract=[0,0,0],a.gloss=.85;else if(Kn(o.name))a.reflect=[.1,.1,.1],a.refract=[.6,.6,.6],a.gloss=1;else if(o.transparent||s>0&&s<1){if(a.diffuse=[0,0,0],a.reflect=[0,0,0],a.refract=[.2,.2,.2],a.gloss=1,!o.hasTexture)if(o.transparent){u=1-s;a.refract=[u,u,u]}else a.refract=[0,0,0]}else{var c=o.getDiffuse();a.diffuse=[c[0],c[1],c[2]],a.refract=[0,0,0],a.reflect=[0,0,0],a.gloss=1,n=!1}if(o.hasTexture&&l&&a.diffuse&&(a.diffuse={value:l.name,image:l.image,scale:[1,1,0]}),n&&a.diffuse){c=o.getDiffuse();a.diffuse=[c[0],c[1],c[2]]}a.useMxType=n,r[i]=a}return r},e}(),ea=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ta=function(e){function t(t,r,i){var n=e.call(this,t,null,null,null,i)||this;n.name=null,n.testCull=!1;var a=r.getShader("gizmo",["MODEL_TRANSFORM"]);a.ready||a.createFromShaderSource(k.a.constant,["MODEL_TRANSFORM"]);var o=new F("",r);return o.attachShader(a,r),o.setSide(N.a.DOUBLESIDE),n.shader=a,n.material=o,n}return ea(t,e),t.prototype.setColor=function(e){this.material.setDiffuse(e)},t.prototype.setTransparent=function(e){this.material.setTransparent(e)},t}(D.a),ra=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ia=function(e){function t(t,r){return e.call(this,t,r,!1,{line:!0})||this}return ra(t,e),t.prototype.render=function(e,t,r,i,n,a){if(this.queue.isValid()){if(null!==this._overridedMaterial&&this._overridedMaterial.transparent){var o=e.getOption("blend");e.setOption("blend",!0),e.always=!0}t.drawLinesWithVertexIds(e,this.queue.drawables,r,this._overridedShaders,this._overridedMaterial,n),null!==this._overridedMaterial&&this._overridedMaterial.transparent&&(e.setOption("blend",o),e.always=!0)}},t}(xr),na=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1],[2,-1],[2,0],[2,1],[2,2],[1,2],[0,2],[-1,2],[-2,2],[-2,1],[-2,0],[-2,-1],[-2,-2],[-1,-2],[0,-2],[1,-2],[2,-2],[3,-2],[3,-1],[3,0],[3,1],[3,2],[3,3],[2,3],[1,3],[0,3],[-1,3],[-2,3],[-3,3],[-3,2],[-3,1],[-3,0],[-3,-1],[-3,-2],[-3,-3],[-2,-3],[-1,-3],[0,-3],[1,-3],[2,-3],[3,-3],[4,-3],[4,-2],[4,-1],[4,0],[4,1],[4,2],[4,3],[4,4],[3,4],[2,4],[1,4],[0,4],[-1,4],[-2,4],[-3,4],[-4,4],[-4,3],[-4,2],[-4,1],[-4,0],[-4,-1],[-4,-2],[-4,-3],[-4,-4],[-3,-4],[-2,-4],[-1,-4],[0,-4],[1,-4],[2,-4],[3,-4],[4,-4],[5,-4],[5,-3],[5,-2],[5,-1],[5,0],[5,1],[5,2],[5,3],[5,4],[5,5],[4,5],[3,5],[2,5],[1,5],[0,5],[-1,5],[-2,5],[-3,5],[-4,5],[-5,5],[-5,4],[-5,3],[-5,2],[-5,1],[-5,0],[-5,-1],[-5,-2],[-5,-3],[-5,-4],[-5,-5],[-4,-5],[-3,-5],[-2,-5],[-1,-5],[0,-5],[1,-5],[2,-5],[3,-5],[4,-5],[5,-5],[6,-5],[6,-4],[6,-3],[6,-2],[6,-1],[6,0],[6,1],[6,2],[6,3],[6,4],[6,5],[6,6],[5,6],[4,6],[3,6],[2,6],[1,6],[0,6],[-1,6],[-2,6],[-3,6],[-4,6],[-5,6],[-6,6],[-6,5],[-6,4],[-6,3],[-6,2],[-6,1],[-6,0],[-6,-1],[-6,-2],[-6,-3],[-6,-4],[-6,-5],[-6,-6],[-5,-6],[-4,-6],[-3,-6],[-2,-6],[-1,-6],[0,-6],[1,-6],[2,-6],[3,-6],[4,-6],[5,-6],[6,-6],[7,-6],[7,-5],[7,-4],[7,-3],[7,-2],[7,-1],[7,0],[7,1],[7,2],[7,3],[7,4],[7,5],[7,6],[7,7],[6,7],[5,7],[4,7],[3,7],[2,7],[1,7],[0,7],[-1,7],[-2,7],[-3,7],[-4,7],[-5,7],[-6,7],[-7,7],[-7,6],[-7,5],[-7,4],[-7,3],[-7,2],[-7,1],[-7,0],[-7,-1],[-7,-2],[-7,-3],[-7,-4],[-7,-5],[-7,-6],[-7,-7],[-6,-7],[-5,-7],[-4,-7],[-3,-7],[-2,-7],[-1,-7],[0,-7],[1,-7],[2,-7],[3,-7],[4,-7],[5,-7],[6,-7],[7,-7],[8,-7],[8,-6],[8,-5],[8,-4],[8,-3],[8,-2],[8,-1],[8,0],[8,1],[8,2],[8,3],[8,4],[8,5],[8,6],[8,7],[8,8],[7,8],[6,8],[5,8],[4,8],[3,8],[2,8],[1,8],[0,8],[-1,8],[-2,8],[-3,8],[-4,8],[-5,8],[-6,8],[-7,8],[-8,8],[-8,7],[-8,6],[-8,5],[-8,4],[-8,3],[-8,2],[-8,1],[-8,0],[-8,-1],[-8,-2],[-8,-3],[-8,-4],[-8,-5],[-8,-6],[-8,-7],[-8,-8],[-7,-8],[-6,-8],[-5,-8],[-4,-8],[-3,-8],[-2,-8],[-1,-8],[0,-8],[1,-8],[2,-8],[3,-8],[4,-8],[5,-8],[6,-8],[7,-8],[8,-8],[9,-8],[9,-7],[9,-6],[9,-5],[9,-4],[9,-3],[9,-2],[9,-1],[9,0],[9,1],[9,2],[9,3],[9,4],[9,5],[9,6],[9,7],[9,8],[9,9],[8,9],[7,9],[6,9],[5,9],[4,9],[3,9],[2,9],[1,9],[0,9],[-1,9],[-2,9],[-3,9],[-4,9],[-5,9],[-6,9],[-7,9],[-8,9],[-9,9],[-9,8],[-9,7],[-9,6],[-9,5],[-9,4],[-9,3],[-9,2],[-9,1],[-9,0],[-9,-1],[-9,-2],[-9,-3],[-9,-4],[-9,-5],[-9,-6],[-9,-7],[-9,-8],[-9,-9],[-8,-9],[-7,-9],[-6,-9],[-5,-9],[-4,-9],[-3,-9],[-2,-9],[-1,-9],[0,-9],[1,-9],[2,-9],[3,-9],[4,-9],[5,-9],[6,-9],[7,-9],[8,-9],[9,-9],[10,-9],[10,-8],[10,-7],[10,-6],[10,-5],[10,-4],[10,-3],[10,-2],[10,-1],[10,0],[10,1],[10,2],[10,3],[10,4],[10,5],[10,6],[10,7],[10,8],[10,9],[10,10],[9,10],[8,10],[7,10],[6,10],[5,10],[4,10],[3,10],[2,10],[1,10],[0,10],[-1,10],[-2,10],[-3,10],[-4,10],[-5,10],[-6,10],[-7,10],[-8,10],[-9,10],[-10,10],[-10,9],[-10,8],[-10,7],[-10,6],[-10,5],[-10,4],[-10,3],[-10,2],[-10,1],[-10,0],[-10,-1],[-10,-2],[-10,-3],[-10,-4],[-10,-5],[-10,-6],[-10,-7],[-10,-8],[-10,-9],[-10,-10],[-9,-10],[-8,-10],[-7,-10],[-6,-10],[-5,-10],[-4,-10],[-3,-10],[-2,-10],[-1,-10],[0,-10],[1,-10],[2,-10],[3,-10],[4,-10],[5,-10],[6,-10],[7,-10],[8,-10],[9,-10],[10,-10],[11,-10],[11,-9],[11,-8],[11,-7],[11,-6],[11,-5],[11,-4],[11,-3],[11,-2],[11,-1],[11,0],[11,1],[11,2],[11,3],[11,4],[11,5],[11,6],[11,7],[11,8],[11,9],[11,10],[11,11],[10,11],[9,11],[8,11],[7,11],[6,11],[5,11],[4,11],[3,11],[2,11],[1,11],[0,11],[-1,11],[-2,11],[-3,11],[-4,11],[-5,11],[-6,11],[-7,11],[-8,11],[-9,11],[-10,11],[-11,11],[-11,10],[-11,9],[-11,8],[-11,7],[-11,6],[-11,5],[-11,4],[-11,3],[-11,2],[-11,1],[-11,0],[-11,-1],[-11,-2],[-11,-3],[-11,-4],[-11,-5],[-11,-6],[-11,-7],[-11,-8],[-11,-9],[-11,-10],[-11,-11],[-10,-11],[-9,-11],[-8,-11],[-7,-11],[-6,-11],[-5,-11],[-4,-11],[-3,-11],[-2,-11],[-1,-11],[0,-11],[1,-11],[2,-11],[3,-11],[4,-11],[5,-11],[6,-11],[7,-11],[8,-11],[9,-11],[10,-11],[11,-11]];!function(e){e[e.NONE=-1]="NONE",e[e.VERTEX=0]="VERTEX",e[e.EDGE=1]="EDGE",e[e.EDGEMIDPOINT=2]="EDGEMIDPOINT"}(Jn||(Jn={}));var aa=[0,0,0],oa=function(){function e(e,t,r,i){var n=r.gl;if(this._gl=n,n.isWebGL2){this._rendering=!1,this._camera=t,this._edgeIndex=-1,this._radius=5,this._edgePass=new ia(r,i),this._notEdgePass=new xr(r,i,!1,{line:!1});var a=r.getMesh("edge");a.createLine(),this._edge=new ta(a,r),this._edge.setColor([1,177/255,0]);var o=r.getMesh("snapping-dot");o.ready||o.createSphere(16,32),this._dot=new ta(o,r),this._dot.setColor([1,177/255,0]),this._dot.transform.matrix[0]=.1,this._dot.transform.matrix[5]=.1,this._dot.transform.matrix[10]=.1;var s=r.getShader("mark",[]);if(!s.ready){var l=k.a.mark;s.createFromShaderSource(l,[])}this._edgePass.setOverridedShader(s),this._edgePass.setOverridedMaterial(new N.b("edgemap")),this._notEdgePass.setCullFace(n.CCW);var u=t.viewport[2],c=t.viewport[3];if(this._rtEdge=new wr.a("rtEdge",r,u,c,{depthTest:!0,colorFormat:n.RGBA8,colorFilter:n.NEAREST,depthBuffer:0,colorBuffer:0,clearColor:[1,1,1,1]}),this._rtNotEdge=new wr.a("rtNotEdge",r,u,c,{depthTest:!0,colorFormat:n.RGBA8,colorFilter:n.NEAREST,depthBuffer:0,colorBuffer:0,colorMask:[0,0,0,0],clearColor:[1,1,1,1]}),this._rtDefault=new wr.a("default",r,u,c,{depthFunc:n.LEQUAL}),!this._edgePass.queue.isValid())for(var h in e.models)for(var d=0,p=(f=e.models[h].drawables).length;d<p;d++)this._edgePass.queue.addDrawable(f[d]);if(!this._notEdgePass.queue.isValid())for(var h in e.models){var f;for(d=0,p=(f=e.models[h].drawables).length;d<p;d++)this._notEdgePass.queue.addDrawable(f[d])}this._edgeBuffer=new Float32Array(6),this.resize(u,c)}else console.warn("Snapping requires a WebGL 2.0 context")}return e.prototype.destroy=function(){this._edge.mesh.destroy(),this._edge.destroy(),this._edge=null,delete this._edge,this._dot.destroy(),this._dot=null,delete this._dot,this._edgeBuffer=null,delete this._edgeBuffer,this._edgesBuffer=null,delete this._edgesBuffer,this._rtEdge.destroy(),this._rtEdge=null,delete this._rtEdge,this._rtNotEdge.destroy(),this._rtNotEdge=null,delete this._rtNotEdge,this._rtDefault.destroy(),this._rtDefault=null,delete this._rtDefault,this._edgePass.destroy(),this._edgePass=null,delete this._edgePass,this._notEdgePass.destroy(),this._notEdgePass=null,delete this._notEdgePass},e.prototype.recompileShader=function(e,t){this._edgePass.recompileOverridedShader(t)},e.prototype.setSnappingRadius=function(e){this._radius=Math.max(Math.min(e,11),0)},e.prototype.setRenderingEnabled=function(e){this._rendering=e},e.prototype.resize=function(e,t){this._rtEdge.resize(e,t),this._edgesBuffer=new Uint8Array(e*t*4)},e.prototype.render=function(e,t){this._rendering},e.prototype.snap=function(e,t){var r=this._rtEdge.getWidth(),i=this._rtEdge.getHeight(),n=Math.floor(e[0]*s.a.devicePixelRatio),a=Math.floor(i-1-e[1]*s.a.devicePixelRatio),o=!1,l=this._edgeIndex;this._edgeIndex=-1;for(var u=this._radius*this._radius-1,c=0;c<u;c++){var h=n+na[c][0],d=a+na[c][1];if(!(h<1||h>r-1||d<1||d>i-1)){var p=4*(h+d*r),f=this._edgesBuffer[p+0],_=this._edgesBuffer[p+1],m=this._edgesBuffer[p+2],v=this._edgesBuffer[p+3];if(255!==f||255!==_||255!==m||255!==v){var y=v<<24|m<<16|_<<8|f;this._edgeIndex=-2&y,o=!0,e[0]=Math.floor(h/s.a.devicePixelRatio),e[1]=Math.floor((i-1-d)/s.a.devicePixelRatio);break}}}if(this._edgeIndex!==l&&o)for(var g=0,b=(h=0,this._edgePass.queue.drawables.length);h<b;h++){var w=this._edgePass.queue.drawables[h],x=w.mesh,M=x.length;if(this._edgeIndex>=g&&this._edgeIndex<g+M){if(x.getVBSubData(12*(this._edgeIndex-g),this._edgeBuffer),!w.transform.identity){var E=w.transform.matrix;U.d.transformMat4(this._edgeBuffer,this._edgeBuffer,E),aa[0]=this._edgeBuffer[3],aa[1]=this._edgeBuffer[4],aa[2]=this._edgeBuffer[5],U.d.transformMat4(aa,aa,E),this._edgeBuffer[3]=aa[0],this._edgeBuffer[4]=aa[1],this._edgeBuffer[5]=aa[2]}this._rendering&&this._edge.mesh.update(this._edgeBuffer,new Uint16Array([0,1]));break}g+=M}return o?(t=t||[0,0,0],this._snapToMidPoint(e,t)?Jn.EDGEMIDPOINT:this._snapToVertex(e,t)?Jn.VERTEX:(this._snapToEdge(e,t),Jn.EDGE)):-1},e.prototype.update=function(e,t,r){var i=this._gl;e.invalidate(),e.clear(this._rtEdge,i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this._notEdgePass.render(this._rtNotEdge,e,r),this._edgePass.render(this._rtEdge,e,r),i.readPixels(0,0,this._rtEdge.getWidth(),this._rtEdge.getHeight(),i.RGBA,i.UNSIGNED_BYTE,this._edgesBuffer)},e.prototype._snapToEdge=function(e,t){var r=[this._edgeBuffer[0],this._edgeBuffer[1],this._edgeBuffer[2]],i=[this._edgeBuffer[3],this._edgeBuffer[4],this._edgeBuffer[5]],n=this._camera.eye,a=this._camera.unproject(e[0],e[1]),o=U.d.create(),s=U.d.create(),l=U.d.create(),u=U.d.create();U.d.sub(o,i,r),U.d.sub(s,a,n),U.d.sub(l,n,r),U.d.cross(l,l,s),U.d.cross(u,o,s);var c=U.d.dot(l,u)/U.d.squaredLength(u);return U.d.lerp(t,r,i,c),!0},e.prototype._snapToMidPoint=function(e,t){var r=this._camera.project([.5*(this._edgeBuffer[0]+this._edgeBuffer[3]),.5*(this._edgeBuffer[1]+this._edgeBuffer[4]),.5*(this._edgeBuffer[2]+this._edgeBuffer[5])]),i=r[0]-e[0],n=r[1]-e[1];return i*i+n*n<this._radius*this._radius&&(e[0]=r[0],e[1]=r[1],t[0]=.5*(this._edgeBuffer[0]+this._edgeBuffer[3]),t[1]=.5*(this._edgeBuffer[1]+this._edgeBuffer[4]),t[2]=.5*(this._edgeBuffer[2]+this._edgeBuffer[5]),this._rendering&&(this._dot.transform.matrix[12]=t[0],this._dot.transform.matrix[13]=t[1],this._dot.transform.matrix[14]=t[2]),!0)},e.prototype._snapToVertex=function(e,t){var r=this._camera.project(this._edgeBuffer),i=this._camera.project([this._edgeBuffer[3],this._edgeBuffer[4],this._edgeBuffer[5]]),n=r[0]-e[0],a=r[1]-e[1],o=i[0]-e[0],s=i[1]-e[1],l=n*n+a*a,u=o*o+s*s,c=this._radius*this._radius;return l<c&&l<u?(e[0]=r[0],e[1]=r[1],t[0]=this._edgeBuffer[0],t[1]=this._edgeBuffer[1],t[2]=this._edgeBuffer[2],this._rendering&&(this._dot.transform.matrix[12]=t[0],this._dot.transform.matrix[13]=t[1],this._dot.transform.matrix[14]=t[2]),!0):u<c&&u<l&&(e[0]=i[0],e[1]=i[1],t[0]=this._edgeBuffer[3],t[1]=this._edgeBuffer[4],t[2]=this._edgeBuffer[5],this._rendering&&(this._dot.transform.matrix[12]=t[0],this._dot.transform.matrix[13]=t[1],this._dot.transform.matrix[14]=t[2]),!0)},e.prototype.onSceneChanged=function(e){for(var t in this._edgePass.queue.removeDrawables(),e.models)for(var r=0,i=(n=e.models[t].drawables).length;r<i;r++)this._edgePass.queue.addDrawable(n[r]);for(var t in this._notEdgePass.queue.removeDrawables(),e.models){var n;for(r=0,i=(n=e.models[t].drawables).length;r<i;r++)this._notEdgePass.queue.addDrawable(n[r])}},e}(),sa=[0,0,0],la=[0,0,0],ua=[0,0,0],ca=[0,0,0],ha=[0,0,0],da=function(){function e(e,t,r,i){this._normalDepthPass=new xr(r,i,!1,{line:!1}),this._rendering=!1,this._camera=t;var n=t.viewport[2],a=t.viewport[3],o=r.gl;this._gl=o,this._rtNormalDepth=new wr.a(name+"_depth",r,n,a,{colorFormat:o.RGBA32F,colorFilter:o.NEAREST,colorBuffer:0,depthBuffer:0,clearColor:[0,0,0,0]}),this._rtDefault=new wr.a("default",r,n,a,{depthFunc:o.LEQUAL});var s=r.getShader("normaldepth",["WORLDSPACE_NORMAL"]);if(!s.ready){var l=k.a.normaldepth;s.createFromShaderSource(l,["WORLDSPACE_NORMAL"])}this._normalDepthPass.setOverridedShader(s),this._normalDepthPass.setOverridedMaterial(new N.b("ruler-position-depth")),this._radius=10,this.resize(n,a);var u=r.getMesh("snapping-dot");if(u.ready||u.createSphere(16,32),this._dot=new ta(u,r),this._dot.setColor([1,177/255,0]),this._dot.transform.matrix[0]=.1,this._dot.transform.matrix[5]=.1,this._dot.transform.matrix[10]=.1,!this._normalDepthPass.queue.isValid())for(var c in e.models)for(var h=e.models[c].drawables,d=0,p=h.length;d<p;d++)this._normalDepthPass.queue.addDrawable(h[d])}return e.prototype.destroy=function(){this._normalDepthPass.destroy(),this._normalDepthPass=null,delete this._normalDepthPass,this._dot.destroy(),this._dot=null,delete this._dot,this._rtNormalDepth.destroy(),this._rtNormalDepth=null,delete this._rtNormalDepth,this._rtDefault.destroy(),this._rtDefault=null,delete this._rtDefault,this._normalDepthBuffer=null,delete this._normalDepthBuffer},e.prototype.setSnappingRadius=function(e){this._radius=Math.max(Math.min(e,11),0)},e.prototype.snap=function(e,t){e[0],e[1];var r=this._rtNormalDepth.getWidth(),i=this._rtNormalDepth.getHeight(),n=Math.floor(e[0]*s.a.devicePixelRatio),a=Math.floor(i-1-e[1]*s.a.devicePixelRatio);if(t=t||[0,0,0],this._fetchNormal(n,a))for(var o=0;o<this._radius*this._radius-1;o++){var l=n+na[o][0],u=a+na[o][1];if(!(l<0||l>r-1||u<0||u>i-1)&&this._detectEdge(l,u))return e[0]=Math.floor(l/s.a.devicePixelRatio),e[1]=Math.floor((i-1-u)/s.a.devicePixelRatio),this._fetchPosition(l,u,t),this._rendering&&(this._dot.transform.matrix[12]=t[0],this._dot.transform.matrix[13]=t[1],this._dot.transform.matrix[14]=t[2]),Jn.EDGE}return this._rendering&&(this._fetchPosition(n,a,t),this._dot.transform.matrix[12]=t[0],this._dot.transform.matrix[13]=t[1],this._dot.transform.matrix[14]=t[2]),-1},e.prototype._fetchNormal=function(e,t,r){var i=4*(e+t*this._rtNormalDepth.getWidth()),n=this._normalDepthBuffer[i],a=this._normalDepthBuffer[i+1],o=this._normalDepthBuffer[i+2];return n*n+a*a+o*o>.01&&(r&&(r[0]=n,r[1]=a,r[2]=o,U.d.normalize(r,r)),!0)},e.prototype._fetchPosition=function(e,t,r){var i=this._rtNormalDepth.getWidth(),n=this._rtNormalDepth.getHeight(),a=4*(e+t*i),o=this._normalDepthBuffer[a],l=this._normalDepthBuffer[a+1],u=this._normalDepthBuffer[a+2];if(o*o+l*l+u*u<.01)return!1;var c=e/s.a.devicePixelRatio,h=(n-1-t)/s.a.devicePixelRatio,d=this._normalDepthBuffer[a+3],p=this._camera.unproject(c,h,-d);return r[0]=p[0],r[1]=p[1],r[2]=p[2],!0},e.prototype._detectEdge=function(e,t){this._fetchNormal(e-1,t,sa),this._fetchPosition(e-1,t,ua),this._fetchNormal(e+1,t,la),this._fetchPosition(e+1,t,ca),U.d.subtract(ha,ua,ca),U.d.normalize(ha,ha);var r=Math.max(Math.abs(U.d.dot(ha,sa)),Math.abs(U.d.dot(ha,la)));this._fetchNormal(e,t-1,sa),this._fetchPosition(e,t-1,ua),this._fetchNormal(e,t+1,la),this._fetchPosition(e,t+1,ca),U.d.subtract(ha,ua,ca),U.d.normalize(ha,ha);var i=Math.max(Math.abs(U.d.dot(ha,sa)),Math.abs(U.d.dot(ha,la)));return r*r+i*i>.25},e.prototype.resize=function(e,t){this._rtNormalDepth.resize(e,t),this._normalDepthBuffer=new Float32Array(e*t*4)},e.prototype.update=function(e,t,r){var i=this._gl;e.invalidate(),e.clear(this._rtNormalDepth,i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this._normalDepthPass.render(this._rtNormalDepth,e,r),i.readPixels(0,0,this._rtNormalDepth.getWidth(),this._rtNormalDepth.getHeight(),i.RGBA,i.FLOAT,this._normalDepthBuffer)},e.prototype.render=function(e,t){this._rendering&&e.drawGizmo(this._rtDefault,this._dot,t)},e.prototype.setRenderingEdgeEnabled=function(e){this._rendering=e},e.prototype.onSceneChanged=function(e){for(var t in this._normalDepthPass.queue.removeDrawables(),e.models)for(var r=e.models[t].drawables,i=0,n=r.length;i<n;i++)this._normalDepthPass.queue.addDrawable(r[i])},e}(),pa=function(){function e(){this.enabled=!1,this.modulate=!1,this._initialViewMatrix=U.a.create(),this._rotationMatrix=U.a.create(),this._tmpMatrix=U.a.create(),this._camera=null,this._initAlpha=null,this._flip=!1,this._deviceOrientation={alpha:0,beta:0,gamma:0},this._screenOrientation=window.orientation||0,this._quatRotate=U.b.create(),this._quatOrient=U.b.create(),this._prevValues=null,this._medianValues=null,window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent.bind(this)),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent.bind(this)):console.warn("Your enviroment not support deviceOrientation")}return e.prototype.destroy=function(){this.detach(),window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1)},e.prototype.attach=function(e){this.onScreenOrientationChangeEvent(),this._camera=e,this.reset(e)},e.prototype.reset=function(e,t){void 0===t&&(t=!1),t||(e._theta=e._targetTheta,e._distance=e._targetDistance,e._phi=0,e.updateVP()),U.a.copy(this._initialViewMatrix,e.viewMatrix),this._medianValues=null,this._prevValues=null},e.prototype.detach=function(){this._initAlpha=null,this.enabled=!1,this._camera=null,this._prevValues=null,this._medianValues=null},e.prototype.onDeviceOrientationChangeEvent=function(e){if(this.enabled&&e.alpha){this._deviceOrientation.alpha=e.alpha,this._deviceOrientation.beta=e.beta,this._deviceOrientation.gamma=e.gamma;var t=Math.PI/180,r=this._deviceOrientation.alpha?t*this._deviceOrientation.alpha:0,i=this._deviceOrientation.beta?t*this._deviceOrientation.beta:0,n=this._deviceOrientation.gamma?t*this._deviceOrientation.gamma:0,a=this._screenOrientation?t*this._screenOrientation:0;if(null===this._initAlpha){var o,s,l;switch(Math.sign(a)){case-1:o=r,s=r+Math.PI/2,l=r+Math.PI;break;case 0:o=r-Math.PI/2,s=r,l=r+Math.PI/2;break;case 1:o=r-Math.PI,s=r-Math.PI/2,l=r}this._initAlpha={"-1":o,0:s,1:l},0!=Math.sign(a)&&Math.abs(i)>Math.PI/2&&(this._flip=!0)}r=r+Math.sign(a)*Math.PI/2-this._initAlpha[Math.sign(a).toString()],r=this._flip?r+Math.PI:r,U.b.setAxisAngle(this._quatOrient,[0,0,1],-a),U.b.fromYXZ(this._quatRotate,r,i,-n),U.b.multiply(this._quatRotate,this._quatRotate,[-Math.sqrt(.5),0,0,Math.sqrt(.5)]),U.b.multiply(this._quatRotate,this._quatRotate,this._quatOrient),U.b.invert(this._quatRotate,this._quatRotate),U.a.fromQuat(this._rotationMatrix,this._quatRotate),this._antiJitterValues(this._rotationMatrix)}},e.prototype.update=function(){this.modulate?(U.a.multiply(this._tmpMatrix,this._rotationMatrix,this._camera.viewMatrix),U.a.copy(this._camera.viewMatrix,this._tmpMatrix)):U.a.multiply(this._camera.viewMatrix,this._rotationMatrix,this._initialViewMatrix),U.a.multiply(this._camera.vpMatrix,this._camera.projectMatrix,this._camera.viewMatrix)},e.prototype.onScreenOrientationChangeEvent=function(){this._screenOrientation=window.orientation||0},e.prototype._antiJitterValues=function(e){if(null===this._medianValues){this._medianValues=new Array(16);for(var t=0;t<16;t++){this._medianValues[t]=new Array(10);for(var r=0;r<10;r++)this._medianValues[t][r]=e[t]}}if(null===this._prevValues){this._prevValues=new Array(16);for(t=0;t<16;t++)this._prevValues[t]=e[t]}new Array(10);for(var i=0;i<16;i++){for(t=9;t>0;t--)this._medianValues[i][t]=this._medianValues[i][t-1];this._medianValues[i][0]=e[i];for(var n,a=0,o=0;o<this._medianValues[i].length;o++)a+=this._medianValues[i][o];n=a/this._medianValues[i].length,e[i]=n,this._prevValues[i]=e[i]}},e.prototype.setEnabled=function(e){this.enabled=e},e}(),fa="3.22.0-build";function _a(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((i=i.apply(e,t||[])).next())})}const ma=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function va(e){return e.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const ya="undefined"==typeof window,ga=(()=>{if(ya)return;const{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,i=/(iphone|ipod|ipad)/i.test(e),n="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(e)||i||n,isSafari12:/Version\/12.+Safari/.test(e)}})();const ba=[],wa=[];function xa(e){return null!=e}class Ma extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const Ea=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:i,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@4.0.40/dist/benchmarks"}={})=>_a(void 0,void 0,void 0,function*(){const o={};if(ya)return{tier:0,type:"SSR"};const{isIpad:s=!!(null==ga?void 0:ga.isIpad),isMobile:l=!!(null==ga?void 0:ga.isMobile),screenSize:u=window.screen,loadBenchmarks:c=(e=>_a(void 0,void 0,void 0,function*(){const t=yield fetch(`${a}/${e}`).then(e=>e.json());if(parseInt(t.shift().split(".")[0],10)<4)throw new Ma("Detect GPU benchmark data is out of date. Please update to version 4x");return t}))}=r;let{renderer:h}=r;const d=(e,t,r,i,n)=>({device:n,fps:i,gpu:r,isMobile:l,tier:e,type:t});let p,f="";if(h)p=[h=va(h)];else{const e=i||function(e,t=!1){const r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;const i=window.document.createElement("canvas"),n=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);return null!=n?n:void 0}(null==ga?void 0:ga.isSafari12,n);if(!e)return d(0,"WEBGL_UNSUPPORTED");const t=e.getExtension("WEBGL_debug_renderer_info");if(t&&(h=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),!h)return d(1,"FALLBACK");f=h,p=function(e,t,r){return"apple gpu"===t?function(e,t,r){if(!r)return[t];const i=function(e){const t=e.createShader(35633),r=e.createShader(35632),i=e.createProgram();if(!(r&&t&&i))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(r,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(r),e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.detachShader(i,t),e.detachShader(i,r),e.deleteShader(t),e.deleteShader(r),e.useProgram(i);const n=e.createBuffer();e.bindBuffer(34962,n),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const a=e.getAttribLocation(i,"aPosition");e.vertexAttribPointer(a,3,5126,!1,0,0),e.enableVertexAttribArray(a),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const o=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,o),e.deleteProgram(i),e.deleteBuffer(n),o.join("")}(e),n="801621810",a="8016218135",o="80162181161",s=(null==ga?void 0:ga.isIpad)?[["a7",o,12],["a8",a,15],["a8x",a,15],["a9",a,15],["a9x",a,15],["a10",a,15],["a10x",a,15],["a12",n,15],["a12x",n,15],["a12z",n,15],["a14",n,15],["m1",n,15]]:[["a7",o,12],["a8",a,12],["a9",a,15],["a10",a,15],["a11",n,15],["a12",n,15],["a13",n,15],["a14",n,15]];let l;return"80162181255"===i?l=s.filter(([,,e])=>e>=14):(l=s.filter(([,e])=>e===i)).length||(l=s),l.map(([e])=>`apple ${e} gpu`)}(e,t,l):[t]}(e,h=va(h))}const _=(yield Promise.all(p.map(function(e){var t;return _a(this,void 0,void 0,function*(){const r=(e=>{const t=l?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","apple","amd","radeon","nvidia","geforce"];for(const r of t)if(e.includes(r))return r})(e);if(!r)return;const i=`${l?"m":"d"}-${r}${s?"-ipad":""}.json`,n=o[i]=null!==(t=o[i])&&void 0!==t?t:c(i);let a;try{a=yield n}catch(r){if(r instanceof Ma)throw r;return}const h=function(e){var t;const r=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==r?void 0:r.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e);let d=a.filter(([,e])=>e===h);d.length||(d=a.filter(([t])=>t.includes(e)));const p=d.length;if(0===p)return;let f,[_,,,m]=p>1?d.map(t=>[t,function(e,t){if(e===t)return 0;const r=e;e.length>t.length&&(e=t,t=r);let i=e.length,n=t.length;for(;i>0&&e.charCodeAt(~-i)===t.charCodeAt(~-n);)i--,n--;let a,o=0;for(;o<i&&e.charCodeAt(o)===t.charCodeAt(o);)o++;if(n-=o,0==(i-=o))return n;let s,l,u=0,c=0,h=0;for(;c<i;)wa[c]=e.charCodeAt(o+c),ba[c]=++c;for(;h<n;)for(a=t.charCodeAt(o+h),s=h++,u=h,c=0;c<i;c++)l=a===wa[c]?s:s+1,s=ba[c],u=ba[c]=s>u?l>u?u+1:l:l>s?s+1:l;return u}(e,t[0])]).sort(([,e],[,t])=>e-t)[0][0]:d[0],v=Number.MAX_VALUE;const{devicePixelRatio:y}=window,g=u.width*y*u.height*y;for(const e of m){const[t,r]=e,i=t*r,n=Math.abs(g-i);n<v&&(v=n,f=e)}if(!f)return;const[,,b,w]=f;return[v,b,_,w]})}))).filter(xa).sort(([e=Number.MAX_VALUE,t],[r=Number.MAX_VALUE,i])=>e===r?t-i:e-r);if(!_.length){const e=ma.find(e=>h.includes(e));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${h} (${f})`)}const[,m,v,y]=_[0];if(-1===m)return d(0,"BLOCKLISTED",v,m,y);const g=l?e:t;let b=0;for(let e=0;e<g.length;e++)m>=g[e]&&(b=e);return d(b,"BENCHMARK",v,m,y)});var Ta,Sa=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Aa=function(){return(Aa=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Pa=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},ka=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Oa={isMobile:!1,transparent:!1,stencil:!1,samples:4},Da=function(e){function t(t,r,i,n){var o=e.call(this,t,r,i,n)||this;o.initialLoaded=!0,o._onCameraUpdateStopped=null,o.onSceneChanged=Object(a.b)(function(){o._renderScene.onSceneChanged(-1),o._recompileShadow(),o._recompileSpecular(),o._renderScene.optimize(),o._tools.forEach(function(e){e.onSceneChanged()})}),console.log("["+o._canvas.id+"] %cmodeloapi version: "+fa,"font-weight:bold;"),o._elapsedFrames=0;var l=o._setupGL(Aa(Aa({},Oa),r));return Ea({glContext:l}).then(function(e){console.log(e),s.a.gpuInfo=e}).catch(function(e){console.warn("Can not get GPU tier: ",e)}),o._resourceManager=new gi(l),o._renderer=new Li(o._resourceManager),o._materialManager=new Mi(o._resourceManager),o._scene=new ir(o,o._materialManager),o._camera=new Kr(o),o._camera.core.addUpdateStartListener(function(){o._eventEmitter.emit("cameraUpdateStart")}),o._renderScene=new Dn(o._scene.core,o._camera.core,o._resourceManager,o._renderer,o._eventEmitter,r&&r.stencil),o._snapping=null,o.stateManager=new ai(o),o._onContextLostFn=null,o._onContextRestoreFn=null,o._canvas.addEventListener("webglcontextlost",o._onGLContextLost.bind(o),!1),o._canvas.addEventListener("webglcontextrestored",o._onGLContextRestore.bind(o),!1),o.getEventEmitter().on("refresh",o._renderScene.refresh),o._onUpdate=null,o._animationFn=o._requestAnimationFrame.bind(o),o._animationId=window.requestAnimationFrame(o._animationFn),o._vr=new In(o,o._resourceManager,o._scene.core),o._webvr=new zn(o,o._resourceManager,o._scene.core,o._eventEmitter),o.orientation=s.a.isMobile?new pa:null,o._renderModelFirst=!0,o._materialManager.setScene(o._scene.core),o._renderScene.retoreEventListener(),o._initCanvasHub(),o._update(),o.viewType=1,o._isProgressive=!0,o._alwaysDrawNormally=!1,o._onCameraUpdateStopped=function(){o.setProgressiveRendering(),o.disableBimCulling(),o.notifyEventListener("cameraUpdateStopped")},o._restoreCameraEventListener(),o._initStates={initSection:!1},o}return Sa(t,e),t.prototype.destroy=function(){if(this.state!==i.UNINITIALIZED){this._canvas.removeEventListener("webglcontextlost",this._onGLContextLost.bind(this),!1),this._canvas.removeEventListener("webglcontextrestored",this._onGLContextRestore.bind(this),!1),e.prototype.destroy.call(this),this._vr&&(this._vr.destroy(),this._vr=null,delete this._vr),this._webvr&&(this._webvr.destroy(),this._webvr=null,delete this._webvr),this.cancelAnimationFrame(),this._renderScene.destroy(),this._renderScene=null,delete this._renderScene,this._renderer.destroy(),this._renderer=null,delete this._renderer,this._scene.destroy(),this._scene=null,delete this._scene;var t=this._resourceManager.gl;this._resourceManager.destroy(),this._resourceManager=null,delete this._resourceManager,this._camera&&(this._camera.destroy(),this._camera=null,delete this._camera),this._snapping&&(this._snapping.destroy(),this._snapping=null,delete this._snapping),this._contextHud=null,this._canvasHud=null,this._destroyGL(t),this.viewType=-1}},t.prototype._initCanvasHub=function(){if(this._canvasHud=document.getElementById("canvas_model_comments"),this._canvasHud){var e=this.getWidth(),t=this.getHeight();this._canvasHud.oncontextmenu=function(){return!1},this._contextHud=this._canvasHud.getContext("2d"),this._canvasHud.style.width=e+"px",this._canvasHud.style.height=t+"px",this._canvasHud.width=e,this._canvasHud.height=t}},t.prototype.invalidate=function(t){void 0===t&&(t=1),this._renderer.invalidate(),this._renderScene.setProgressiveRenderingEnabled(!1),e.prototype.invalidate.call(this,t)},t.prototype.resize=function(t,r){if(e.prototype.resize.call(this,t,r),this.state!==i.UNINITIALIZED&&this.state!==i.INITIALIZED_PAUSED&&this.state!==i.RENDERING_PAUSED){t=this._canvas.width,r=this._canvas.height,this._camera.resize(t,r),this._renderScene.resize(t,r),this._vr.resize(t,r),null!==this._snapping&&this._snapping.resize(t,r);for(var n=0;n<this._tools.length;n++)this._tools[n].resize(t,r);this._renderScene.refresh(),this.invalidate()}},t.prototype.setDefaultCam=function(e){this._camera.core.setDefaultCam(e)},t.prototype.cancelAnimationFrame=function(e){var t=e||this._animationId;window.cancelAnimationFrame(t),this._animationId=-1},t.prototype._requestAnimationFrame=function(){this._preUpdate(),this._update(),this._animationId=0,this._webvr.isPresenting()?this._animationId=this._webvr._vrDisplay.requestAnimationFrame(this._animationFn):this._animationId=window.requestAnimationFrame(this._animationFn)},t.prototype._recompileShadow=function(){this._renderScene.recompileShadow()},t.prototype._recompileSpecular=function(){this._renderScene.recompileSpecular()},t.prototype._needUpdate=function(){return!this._inactived()&&(!!this._cameraUpdated()||(!!this._visualizeUpdate()||(!!this._vr.enabled||(!!this._webvr.enabled||(this._nFramesTobeDrawnNormally>0||(this._nFramesTobeDrawnProgressively>0||!!this._alwaysDrawNormally))))))},t.prototype._inactived=function(){return this.state!=i.RENDERING},t.prototype._visualizeUpdate=function(){var e=this._renderScene.getAllVisualizes().some(function(e){return e.isNeedUpdate()});return e&&this.setProgressiveRendering(0),e},t.prototype._cameraUpdated=function(){var e=this._camera.update();return e&&(this.notifyEventListener("EngineStateChanged",this.getCameraState()),this.notifyEventListener("cameraUpdated"),this.notifyEventListener("cameraRotate",this._camera.core.getRotation()),this._renderScene.refresh(),this._nFramesTobeDrawnProgressively=0),e},t.prototype.getCameraState=function(){return JSON.stringify({ID:"CAMERA",near:this._camera.getNear(),far:this._camera.getFar(),eye:this._camera.getEye(),at:this._camera.getAt()})},t.prototype._updateCurrentFrame=function(){this._beginFrame(),this._drawFrame(),this._endFrame()},t.prototype._beginFrame=function(){this._renderer.beginFrame(this._renderScene.getRenderTarget().getFramebuffer()),this._renderScene.haseModel()&&this._renderModelFirst&&(this._eventEmitter.emit("firstMeshReady"),this._renderModelFirst=!1)},t.prototype._drawFrame=function(){this.getRenderScene().isVisible()&&(!this._alwaysDrawNormally&&this._isProgressive&&this._nFramesTobeDrawnProgressively>0?this._drawFrameProgressively(17-this._nFramesTobeDrawnProgressively):this._drawFrameNormally())},t.prototype._drawFrameNormally=function(){this._drawSceneNormally(),this._drawToolsNormally(),this._drawEffectsNormally()},t.prototype._drawFrameProgressively=function(e){this._jitterCamera(e),this._drawSceneProgressively(e),this._drawToolsProgressively(),this._drawEffectsProgressively(e),this._restoreCamera(e),this._accumulateCurrentFrame(e)},t.prototype._jitterCamera=function(e){var t=Pa(this._getJitterValuesOfFrame(e),2),r=t[0],i=t[1];this._camera.core.jitter(r,i)},t.prototype._restoreCamera=function(e){var t=Pa(this._getJitterValuesOfFrame(e),2),r=t[0],i=t[1];this._camera.core.jitter(-r,-i),this._camera.core.jitter(0,0)},t.prototype._getJitterValuesOfFrame=function(e){var t=Ii._4X4[2*(e-1)]-.5,r=Ii._4X4[2*(e-1)+1]-.5;return[t/this._camera.core.viewport[2],r/this._camera.core.viewport[3]]},t.prototype._drawSceneProgressively=function(e){this._renderScene.drawProgressively(e)},t.prototype._drawEffectsProgressively=function(e){this._renderScene.drawEffectsProgressively(e)},t.prototype._drawEffectsNormally=function(){this._renderScene.drawEffectsNormally()},t.prototype._drawToolsProgressively=function(){this._tools.forEach(function(e){return e.renderProgressively()})},t.prototype._accumulateCurrentFrame=function(e){this._renderScene.accumulateCurrentFrame(e)},t.prototype._drawSceneNormally=function(){return this._webvr&&this._webvr.isPresenting()?this._webvr.draw(this.getSceneCamera(),this._renderScene,this._renderer):this._vr.enabled?(this.getTool("InAppNavigation").isEnabled()&&(this.getSceneCamera().update(),this.orientation.modulate=this.getSceneCamera().animator instanceof Or.a),this.orientation.update(),this._vr.draw(this.getSceneCamera(),this._renderScene,this._renderer)):void this._renderScene._drawNormally()},t.prototype._drawToolsNormally=function(){this._tools.forEach(function(e){return e.renderNormally()})},t.prototype._endFrame=function(){this._renderer.endFrame(),this._elapsedFrames++;var e=1===this._nFramesTobeDrawnNormally;(this._nFramesTobeDrawnNormally>0&&this._nFramesTobeDrawnNormally--,e)?this.setProgressiveRendering():(this._nFramesTobeDrawnProgressively--,0===this._nFramesTobeDrawnProgressively&&(this._renderScene.updateShadow(),this.notifyEventListener("ProgressiveRenderEnd")))},t.prototype._dumpTools=function(){var e,t;try{for(var r=ka(this._tools),i=r.next();!i.done;i=r.next()){var n=i.value;n.isEnabled()&&n.dump()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._update=function(){this._needUpdate()&&(this._onUpdate&&this._onUpdate(),this.notifyEventListener("before-rendering"),this._updateCurrentFrame(),this.notifyEventListener("after-rendering"))},t.prototype._preUpdate=function(){var e,t;try{for(var r=ka(this._tools),i=r.next();!i.done;i=r.next()){var n=i.value;n.isEnabled()&&n.update()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.pause=function(){this.state!==i.INITIALIZED&&this.state!==i.RENDERING||(this.state=this.state===i.INITIALIZED?i.INITIALIZED_PAUSED:i.RENDERING_PAUSED,this._resourceManager.discard(),this.cancelAnimationFrame()),e.prototype.pause.call(this)},t.prototype.resume=function(){this.state!==i.INITIALIZED_PAUSED&&this.state!==i.RENDERING_PAUSED||(this._resourceManager.restore(),this.state=this.state===i.INITIALIZED_PAUSED?i.INITIALIZED:i.RENDERING);var t=parseInt(this._canvas.style.width.replace("px","")),r=parseInt(this._canvas.style.height.replace("px",""));this.resize(t,r),this.invalidate(),this._requestAnimationFrame(),e.prototype.resume.call(this)},t.prototype.dumpScreen=function(e,t,r,i){var n=this._scene.core.background.getColor();e||t?t||(t=e*this._canvas.height/this._canvas.width):(e=this._canvas.width,t=this._canvas.height);var a=Math.floor(this._canvas.width/s.a.devicePixelRatio),o=Math.floor(this._canvas.height/s.a.devicePixelRatio),l=Math.floor(e/s.a.devicePixelRatio),u=Math.floor(t/s.a.devicePixelRatio);r&&this.setBackgroundColor(r),l!==a||u!==o?this.resize(l,u):this.invalidate();var c=this._tools.find(function(e){return"ArchDesign"===e.name});c&&c.disableRenderingOfHoverAndSelectedNodes(),this.drawHD(),c&&c.enableRenderingOfHoverAndSelectedNodes(),this._dumpTools(),this.setBackgroundColor(n);var h="";return i?(i&&this._contextHud.filter&&(this._contextHud.filter=i),this._contextHud.clearRect(0,0,this._canvasHud.width,this._canvasHud.height),this._contextHud.drawImage(this._canvas,0,0),h=this._canvasHud.toDataURL("image/jpg"),i&&this._contextHud.filter&&(this._contextHud.filter="none")):h=this._canvas.toDataURL("image/jpg"),l!==a||u!==o?this.resize(a,o):this.invalidate(),h},t.prototype.drawNormally=function(){this._renderScene.draw()},t.prototype.get360Screenshots=function(e,t){console.log("get360Screenshots");var r=e?1600:800,i=e?1600:800,n=Math.ceil(this.getCanvas().width/s.a.devicePixelRatio),a=Math.ceil(this.getCanvas().height/s.a.devicePixelRatio),o=Math.ceil(r/s.a.devicePixelRatio),l=Math.ceil(i/s.a.devicePixelRatio),u=this.getCamera().core;o===n&&l===a||this.resize(o,l);var c={distance:u._distance,phi:u._phi,theta:u._theta,at:[u._at[0],u._at[1],u._at[2]],eye:[u.eye[0],u.eye[1],u.eye[2]],aspect:u._aspect,fov:u._fov},h=this._scene.core.background.mode,d=u.eye,p={aspect:1};p.distance=u._distance,p.phi=0,p.theta=0,p.eye=[],p.at=d,p.fov=90;var f=document.createElement("canvas"),_=document.createElement("canvas");_.width=f.width=6*r,_.height=f.height=i;var m=_.getContext("2d"),v=f.getContext("2d");this._scene.core.background.setMode(2),this._scene.setBackgroundFov(90);for(var y=this._scene.core.bbox,g=0;g<6;g++){switch(g){case 0:p.phi=0,p.theta=.5*Math.PI,p.at=[d[0],d[1]-c.distance,d[2]],p.far=Math.max(1,d[1]-y[1]);break;case 1:p.phi=0,p.theta=-.5*Math.PI,p.at=[d[0],d[1]+c.distance,d[2]],p.far=Math.max(1,y[4]-d[1]);break;case 2:p.phi=.5*Math.PI,p.theta=-Math.PI/2,p.at=[d[0],d[1],d[2]-c.distance],p.far=Math.max(1,d[2]-y[2]);break;case 3:p.phi=-.5*Math.PI,p.theta=-Math.PI/2,p.at=[d[0],d[1],d[2]+c.distance],p.far=Math.max(1,y[5]-d[2]);break;case 4:p.phi=0,p.theta=Math.PI,p.at=[d[0]+c.distance,d[1],d[2]],p.far=Math.max(1,y[3]-d[0]);break;case 5:p.phi=0,p.theta=0,p.at=[d[0]-c.distance,d[1],d[2]],p.far=Math.max(1,d[0]-y[0])}p.far*=1.1,p.near=Math.min(.1,1e-4*p.far),console.log("Viewer3DBase.get360Screenshots: "+p.near+", "+p.far),u.setparam(p),this._renderer.invalidate(),this.drawHD(),m.drawImage(this._canvas,g*r,0),this._renderer.invalidate()}o===n&&l===a||this.resize(n,a),u.eye[0]=c.eye[0],u.eye[1]=c.eye[1],u.eye[2]=c.eye[2],u.setparam(c),this._scene.core.background.setMode(h),this._scene.setBackgroundFov(c.fov),v.translate(6*r,0),v.scale(-1,1),v.drawImage(_,0,0);var b=f.toDataURL("image/jpg");if(t){var w=document.createElement("a");w.href=b,w.download="360Panorama.jpg",w.click()}return b},t.prototype.autoProductPanoramas=function(e,t,r){return this._camera.autoProductPanoramas(e,t,r)},t.prototype.drawPanorama=function(e,t){var r={image:""},i=t?2048:1024,n=t?2048:1024,a=Math.ceil(this.getCanvas().width/s.a.devicePixelRatio),o=Math.ceil(this.getCanvas().height/s.a.devicePixelRatio),l=Math.ceil(i/s.a.devicePixelRatio),u=Math.ceil(n/s.a.devicePixelRatio),c=this.getCamera().core;l===a&&u===o||this.resize(l,u);var h={distance:c._distance,phi:c._phi,theta:c._theta,at:[c._at[0],c._at[1],c._at[2]],eye:[c.eye[0],c.eye[1],c.eye[2]],aspect:c._aspect,fov:c._fov},d=this._scene.core.background.mode,p=e;c.eye[0]=e[0],c.eye[1]=e[1],c.eye[2]=e[2];var f={aspect:1};f.distance=c._distance,f.phi=0,f.theta=0,f.eye=[],f.at=[],f.fov=90,f.near=c._znear,f.far=c._zfar;var _=document.createElement("canvas"),m=document.createElement("canvas");m.width=_.width=6*i,m.height=_.height=n;var v=m.getContext("2d"),y=_.getContext("2d");this._scene.core.background.setMode(2),this._scene.setBackgroundFov(90);for(var g=this._scene.core.bbox,b=0;b<6;b++){switch(b){case 0:f.phi=0,f.theta=.5*Math.PI,f.at=[p[0],p[1]-h.distance,p[2]],f.far=Math.max(1,p[1]-g[1]);break;case 1:f.phi=0,f.theta=-.5*Math.PI,f.at=[p[0],p[1]+h.distance,p[2]],f.far=Math.max(1,g[4]-p[1]);break;case 2:f.phi=.5*Math.PI,f.theta=-Math.PI/2,f.at=[p[0],p[1],p[2]-h.distance],f.far=Math.max(1,p[2]-g[2]);break;case 3:f.phi=-.5*Math.PI,f.theta=-Math.PI/2,f.at=[p[0],p[1],p[2]+h.distance],f.far=Math.max(1,g[5]-p[2]);break;case 4:f.phi=0,f.theta=Math.PI,f.at=[p[0]+h.distance,p[1],p[2]],f.far=Math.max(1,g[3]-p[0]);break;case 5:f.phi=0,f.theta=0,f.at=[p[0]-h.distance,p[1],p[2]],f.far=Math.max(1,p[0]-g[0])}f.far*=1.1,f.near=Math.min(.1,1e-4*f.far),c.setparam(f),this._renderer.invalidate(),this.drawHD(),v.drawImage(this._canvas,b*i,0),this._renderer.invalidate()}return l===a&&u===o||this.resize(a,o),c.eye[0]=h.eye[0],c.eye[1]=h.eye[1],c.eye[2]=h.eye[2],c.setparam(h),this._scene.core.background.setMode(d),this._scene.setBackgroundFov(h.fov),y.translate(6*i,0),y.scale(-1,1),y.drawImage(m,0,0),r.image=_.toDataURL("image/jpg"),r},t.prototype.setLightingLatitude=function(e){this._scene.core.setLightingLatitude(e),this._renderScene.updateShadow(),this.invalidate(16)},t.prototype.setLightingLongitude=function(e){this._scene.core.setLightingLongitude(e),this._renderScene.updateShadow(),this.invalidate(16)},t.prototype.setClipping=function(e,t){this._scene.core.clipping.set(e,t)},t.prototype.setLightingIntensity=function(e){this._scene.core.setLightingIntensity(e),this.invalidate(16)},t.prototype.setRenderingLinesEnabled=function(e){this._renderScene.setLineRendering(e),this.invalidate()},t.prototype.isLineRenderingEnabled=function(){return this._renderScene.isLineRendering()},t.prototype.setBaseRenderingEnabled=function(e){this._renderScene.setBaseRenderingEnabled(e),this.invalidate()},t.prototype.setSpecularEnabled=function(e){this._renderScene.setSpecularEnabled(e),this.invalidate()},t.prototype.setShadowEnabled=function(e){this._renderScene.setShadowEnabled(e),this._renderScene.onSceneChanged(-1),this.invalidate()},t.prototype.addInput=function(t){var r=e.prototype.addInput.call(this,t);return this._camera.addInput(t),r},t.prototype.getMouse=function(){for(var e=0;e<this._inputs.length;e++)if("mouse"===this._inputs[e].name)return this._inputs[e];return null},t.prototype.getKeyboard=function(){for(var e=0;e<this._inputs.length;e++)if("keyboard"===this._inputs[e].name)return this._inputs[e];return null},t.prototype._setupGL=function(e){e.isMobile;var t=e.stencil,r=e.samples,i=s.a.browserName,n=s.a.browserVersion,a=!!e.useWebGL2,o=!0;"chrome"===i&&"62"===n&&(o=!1);var l=function(e,t){t.antialias=!t.webgl2&&t.samples>1,t.depth=!t.webgl2&&t.depth;var r=WebGLUtils.setupWebGL(e,t);if(!r)return null;r.version=r.getParameter(r.VERSION);var i=null!==r.version.match("WebGL 2.0");if(i)r.floatTextureExtension=r.getExtension("EXT_color_buffer_float")||r.getExtension("OES_texture_float_linear")||!0,r.instancingExtension=t.instancing,r.COLOR_ATTACHMENT0_WEBGL=r.COLOR_ATTACHMENT0;else{t.instancing&&(r.instancingExtension=r.getExtension("ANGLE_instanced_arrays")),r.instancingExtension?(t.vao&&console.warn("Instance drawing and VAO cannot use at same time. Turn off VAO."),r.drawElementsInstanced=function(e,t,i,n,a){r.instancingExtension.drawElementsInstancedANGLE(e,t,i,n,a)},r.vertexAttribDivisor=function(e,t){r.instancingExtension.vertexAttribDivisorANGLE(e,t)}):(t.vao&&(r.vaoExtension=r.getExtension("OES_vertex_array_object")),r.vaoExtension&&(r.deleteVertexArray=function(e){return r.vaoExtension.deleteVertexArrayOES(e)},r.bindVertexArray=function(e){return r.vaoExtension.bindVertexArrayOES(e)},r.createVertexArray=function(){return r.vaoExtension.createVertexArrayOES()})),r.floatTextureExtension=(r.getExtension("OES_texture_float")||r.getExtension("WEBGL_color_buffer_float"))&&r.getExtension("OES_texture_float_linear"),r.depthTextureExtension=r.getExtension("WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture"),r.uintIBOExtension=r.getExtension("OES_element_index_uint");var n=r.getExtension("WEBGL_draw_buffers");r.COLOR_ATTACHMENT0_WEBGL=n?n.COLOR_ATTACHMENT0_WEBGL:r.COLOR_ATTACHMENT0,r.s3tcExtension=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),r.halfFloatExtension=r.getExtension("OES_texture_half_float"),r.halfFloatLinearExtension=r.getExtension("OES_texture_half_float_linear")}var a=new Uint8Array(4);return r.syncGPU=function(){"chrome"===s.a.browserName?r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,a):r.finish()},r.isWebGL2=i,r.isWebGL2||(r.RGBA8=r.RGBA,r.RGB8=r.RGB,r.DEPTH24_STENCIL8=r.DEPTH_STENCIL,r.DEPTH_COMPONENT24=r.DEPTH_COMPONENT,r.RGBA32F=34836,r.RGB32F=34837),r.wbSamples=t.samples,r.wbFormat=t.alpha?r.RGBA8:r.RGB8,r.wbDepthFormat=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,r}(this._canvas,{depth:!0,alpha:!0,premultipliedAlpha:!1,samples:r,stencil:t,preserveDrawingBuffer:!1,vao:o,instancing:!1,webgl2:a});if(null===l)return this.notifyEventListener("EngineError","WEBGL_FAILED","BrowserUnSupported"),null;var u=l.isWebGL2?"2.0":"1.0";return console.group("["+this._canvas.id+"] A WebGL "+u+" context created"),console.log("color: RGBA, depth: enabled, stencil: "+(t?"enabled":"disabled")),console.log("  VAO: "+(o?"enabled":"disabled")),console.log("  Instancing: "+(l.instancingExtension?"enabled":"disabled")),console.groupEnd(),l},t.prototype._destroyGL=function(e){if(e){var t=e.isWebGL2?"2.0":"1.0";console.group("A WebGL "+t+" context is destroyed");var r=e.getExtension("WEBGL_lose_context");null!==r&&r.loseContext(),e=void 0,console.groupEnd()}},t.prototype.setBackgroundColor=function(e){this._scene&&(this._scene&&this._scene.core.background.setColor(e),this.invalidate())},t.prototype.setBackgroundImage=function(e,t){void 0===t&&(t=!1),this._scene&&(this._scene.setBackgroundImage(e,t),this.invalidate())},t.prototype.setReflectionImages=function(e){this._scene.setReflectionMap(e),this.invalidate()},t.prototype.setBackgroundMode=function(e){if(this._scene&&this._scene.core&&this._scene.core.background){if(this._scene.core.background.setMode(e),this._scene.core.background.skybox){var t=Pa([this.getWidth(),this.getHeight()],2),r=t[0],i=t[1];this._scene.core.background.skybox.resize(r,i)}this.invalidate()}},t.prototype.setBackgroundDirection=function(e){this._scene&&this._scene.core&&this._scene.core.background&&(this._scene.core.background.setBackgroundDirection(e),this.invalidate())},t.prototype.getScene=function(){return this._scene},t.prototype.getSnapping=function(){return null===this._snapping&&(this._resourceManager.gl.isWebGL2&&this.getScene().hasContours()?this._snapping=new oa(this._scene.core,this._camera.core,this._resourceManager,this._renderScene.getRenderQueueManager()):(this._snapping=new da(this._scene.core,this._camera.core,this._resourceManager,this._renderScene.getRenderQueueManager()),this._snapping.setSnappingRadius(8))),this._snapping},t.prototype.getResourceManager=function(){return this._resourceManager},t.prototype.getMaterialManager=function(){return this._materialManager},t.prototype.getRenderer=function(){return this._renderer},t.prototype.getRenderScene=function(){return this._renderScene},t.prototype.getCamera=function(){return this._camera},t.prototype.setLazyRenderingEnabled=function(e){this._alwaysDrawNormally=!e},t.prototype._onGLContextLost=function(){this.cancelAnimationFrame(),this._onContextLostFn&&this._onContextLostFn(),this.notifyEventListener("EngineError","WEBGL_FAILED","ContextLost"),this.notifyEventListener("webglcontextlost")},t.prototype._onGLContextRestore=function(){this._onContextRestoreFn&&this._onContextRestoreFn(),this.notifyEventListener("webglcontextrestored")},t.prototype.setContextLostCbk=function(e){this._onContextLostFn=e},t.prototype.setContextRestoreCbk=function(e){this._onContextRestoreFn=e},t.prototype.setUpdateCallback=function(e){this._onUpdate=e},t.prototype.setSmartCullingEnabled=function(e){this._renderScene.setSmartCullingEnabled(e),this._scene.core.isBimCullingNeeded=!0,this._scene.core.nodes<=1e5&&this._scene.core.meshKbytes<=1e5&&console.warn("The model is too small to be used SmartCulling")},t.prototype.isSmartCullingEnabled=function(){return this._renderScene.isSmartCullingEnabled()},t.prototype.setEffectEnabled=function(e,t){this._renderScene.setEffectEnabled(e,t),this._renderScene.onSceneChanged(-1),this.invalidate()},t.prototype.setEffectParameter=function(e,t,r){this._renderScene.getEffect(e).setParameter(t,r),this.invalidate()},t.prototype.isEffectEnabled=function(e){return this._renderScene.isEffectEnabled(e)},t.prototype.enterExplodedView=function(e,t){var r=this;if(!(this._renderScene instanceof Hn)){this._alwaysDrawNormally=!0,this._removeCameraEventListener();var i=new Hn(this._scene.core,this._renderScene,this._camera.core,this._resourceManager,this._renderer,this._eventEmitter);i.previous=this._renderScene,this._renderScene=i;for(var n=0;n<e.length;n++)i.renderElements(e[n]);i.renderElementsTranslations(t),i.enter(2e3),this._eventEmitter.on("modelo3dTranslationAnimationEnd",function(){r._alwaysDrawNormally=!1})}},t.prototype.quitExplodedView=function(){var e=this;this._renderScene instanceof Hn&&(this._alwaysDrawNormally=!0,this._renderScene.quit(function(){e._alwaysDrawNormally=!1;var t=e._renderScene;e._renderScene=t.previous,e._restoreCameraEventListener(),t.destroy(),e.invalidate()}))},t.prototype.setOverrideColor=function(e){var t,r=this._materialManager.createMaterialOverride("override");this._resourceManager.hasShader("solid",[])&&(t=this._resourceManager.getShader("solid",[])),this._resourceManager.hasShader("texture",[])&&(t=this._resourceManager.getShader("texture",[])),this._resourceManager.hasShader("dark",[])&&(t=this._resourceManager.getShader("dark",[])),r.attachShader(t),r.setDiffuse(e),r.setTransparent(e[3]),e[3]<.99&&r.setUseTransparent(!1),r.setUsediffuseTexture(!1),r.setUsemaskTexture(!1),this._renderScene.setOverridedMaterials({opaques:r}),this.invalidate()},t.prototype.setOITEnabled=function(e){this._renderScene.setOITEnabled(e),this.invalidate()},t.prototype.setSortByBBoxOrderEnable=function(e){this._renderScene.setSortByBBoxOrderEnable(e)},t.prototype.focusElements=function(e,t){if(void 0===t&&(t=1),null!=e&&0!=e.length){var r=this._scene.getElementsBBox(e);P.a.aabb.len(r)>=1/0||this._camera.cores.forEach(function(e){e.lookTo(P.a.aabb.center(r),t*P.a.aabb.len(r)/2)})}},t.prototype.getSelectedElements=function(){var e=this.getTool("SelectElement");return e?e.getSelectedElements():[]},t.prototype.getElapsedFrames=function(){return this._elapsedFrames},t.prototype.setMaterialParameter=function(e,t,r){this._scene.setMaterialParameter(e,t,r),"opacity"===t&&this._renderScene.onOpacityChanged(this._scene.core.getDrawablesByMaterialName(e)),this.invalidate()},t.prototype.setModelMaterialsOpacity=function(e,t){for(var r=this._scene.getModelMaterialNames()[e],i=0,n=r.length;i<n;i++){var a=r[i];this._scene.setMaterialParameter(a,"opacity",t)}this.setOpacityDepthEnable(t<1),this.invalidate()},t.prototype.setOpacityDepthEnable=function(e){this._renderScene.setOpacityDepthEnable(e),this.invalidate()},t.prototype.getMaterialParameter=function(e,t){return this._scene.getMaterialParameter(e,t)},t.prototype.setToneMappingEnabled=function(e){this._scene.setToneMappingEnabled(e),this.invalidate()},t.prototype.setToneMappingExposure=function(e){e<=0?console.warn("Exposure should be greater than 0!"):(this._scene.setToneMappingExposure(e),this.invalidate())},t.prototype.enabledTwoPointsPerspective=function(e){this._camera.enabledTwoPointsPerspective(e),this.invalidate()},t.prototype.setCullingEnabled=function(e){this._camera.core.setCullingEnabled(e)},t.prototype.setSketchEnabled=function(e){console.log("ViewerDAM.setSketchEnabled: "+e),this.setEffectEnabled("Sketch",e),this.setEffectParameter("Sketch","transparents",e),this.invalidate(),this.notifyEventListener("EngineStateChanged",this._getSketchState())},t.prototype._getSketchState=function(){var e=this._renderScene.getEffect("Sketch");if(!e)return null;var t={ID:"SKETCH",enabled:e.isEnabled(),contrast:e.getParameter("contrast"),detail:e.getParameter("detail"),colored:e.getParameter("colored"),color:e.getParameter("color"),surfaceColor:e.getParameter("surfaceColor")};return console.log("EngineStateChanged: ",t),JSON.stringify(t)},t.prototype.setSketchColorEnabled=function(e){this.setEffectParameter("Sketch","colored",e),this._recompileShadow(),this.invalidate(),this.stateManager.onSkechColorEnableChanged(e),this.notifyEventListener("EngineStateChanged",this._getSketchState())},t.prototype.setSketchDetailLevel=function(e){this.setEffectParameter("Sketch","detail",e),this._recompileShadow(),this.invalidate(16),this.notifyEventListener("EngineStateChanged",this._getSketchState())},t.prototype.setSketchContrast=function(e){this.setEffectParameter("Sketch","contrast",e),this._recompileShadow(),this.invalidate(16),this.notifyEventListener("EngineStateChanged",this._getSketchState())},t.prototype.setlightZRotation=function(e){this._scene.setlightZRotation(e),this._recompileShadow(),this.invalidate(16)},t.prototype.setFov=function(e){this._camera.setFov(e)},t.prototype.getSceneCameraData=function(){return this._camera.getData()},t.prototype.getSceneCamera=function(){return this._camera.core},t.prototype.getSceneClippingData=function(){if(this._scene.core.clipping.isEnabled()){return{planes:this._scene.core.clipping.getClippingPlanes(!0),points:this._scene.core.clipping.getClippingPoints(!0)}}return null},t.prototype.getAllMaterials=function(){return this._materialManager.getAllMaterials()},t.prototype.getModelMaterials=function(e){return void 0===e&&(e=!1),this._materialManager.getModelMaterials(e)},t.prototype.getOriginModelBox=function(){return this._scene.getOriginModelBox()},t.prototype.getModelBox=function(){return this._scene.getModelBox()},t.prototype.getSceneBox=function(){return this._scene.getSceneBox()},t.prototype.clearPopModel=function(){this._scene.clearPopModel()},t.prototype.setModelTransform=function(e,t){this._scene.setModelTransform(e,t),this._eventEmitter.emit("modelTransformUpdate",e)},t.prototype.getModelTransform=function(e){return this._scene.getModelTransform(e)},t.prototype.hasProfileLines=function(){var e=this.getScene().core;for(var t in e.models)e.hasProfileLines=e.hasProfileLines||e.models[t].hasProfileLines;return e.hasProfileLines},t.prototype.hasCurveOrLine=function(){var e=this.getScene().core;for(var t in e.models)e.hasCurveOrLine=e.hasCurveOrLine&&e.models[t].hasCurveOrLine;return e.hasCurveOrLine},t.prototype.setGammaEnabled=function(e){this._renderScene.setGammaEnabled(e),this.invalidate()},t.prototype.removePawn=function(e){this._scene.removePawn(this._scene.getPawn(e)),this._renderScene.onSceneChanged(-1)},t.prototype.getPawn=function(e){return this._scene.getPawn(e)},t.prototype.setCameraManipulatorEnabled=function(e){var t=this.getMouse();t&&(t.isCameraManipulated=e)},t.prototype.setSceneVisible=function(e){this._scene.core.setVisibility(e),this._renderScene.setVisible(e),this.invalidate()},t.prototype.destroyBuffers=function(){this._resourceManager.destroyBuffers()},t.prototype.restoreBuffers=function(){this._resourceManager.restoreBuffers()},t.prototype.setElementsColor=function(e,t){this._scene.setElementsColor(e,t)},t.prototype.switchToUserView=function(e,t){e.distance||(e.distance=e.cameraDistance),this.getCamera().switchToUserView(e,t||this._vr.enabled),e&&(e.nodes.length>0&&this._renderScene.onSceneChanged(-1),this.invalidate())},t.prototype.switchToModelView=function(e,t){var r=this.getScene().getModel(e);if(r){var i=P.a.aabb.center(r.bbox),n=2*P.a.aabb.len(r.bbox),a=Math.PI/4;this.getCamera().switchToUserView({at:i,distance:n,phi:a,theta:0},t||this._vr.enabled),this.invalidate()}},t.prototype.getSceneMainLight=function(){return this._scene.core.getMainLight()},t.prototype.getLightingIntensity=function(){return this._scene.core.getMainLight().getIntensity()},t.prototype.requestAnimationFrame=function(e){if(this.state===i.UNINITIALIZED)return 0;return window.requestAnimationFrame(e)},t.prototype.clobber=function(){this.setSceneVisible(!1),this._resourceManager.discard(),this._renderer.discard(),this._resourceManager.gl=null},t.prototype.hide=function(){this.setSceneVisible(!1),this._resourceManager.discard()},t.prototype.show=function(){this._resourceManager.restore(),this.state!==i.RENDERING&&this.state!==i.INITIALIZED||this.setSceneVisible(!0),this._renderScene.onSceneChanged(-1),this._renderScene.setProgressiveRenderingEnabled(this._isProgressive),this.invalidate()},t.prototype.startRendering=function(){this._animationId<0&&(this.requestAnimationFrame(this._animationFn),this._renderScene.onSceneChanged(-1),this._recompileShadow())},t.prototype.stopRendering=function(){this._animationId>0&&this.cancelAnimationFrame()},t.prototype.restoreCamera=function(e,t){this._camera.setData(e,t)},t.prototype.setDblclickEnabled=function(e){this.getCamera().setDblclickEnabled(e)},t.prototype.getLayerData=function(e){var t=e&&this._scene.getModel(e);return t?t.getLayerJsonData():[]},t.prototype.getLayerIndex=function(e,t){var r=e&&this._scene.getModel(e);return null===r||void 0===r?void 0:r.getLayerIndex(t)},t.prototype.setLayersVisible=function(e,t,r){var i=this._scene.getModel(e);i&&(t.forEach(function(e){return i.showLayer(e)}),r.forEach(function(e){return i.hideLayer(e)}),this.invalidate(),this.onSceneChanged())},t.prototype.restoreLayersDefaultSetting=function(e){var t=this._scene.getModel(e);t&&t.restoreLayersDefaultSetting()},t.prototype.showAllLayers=function(e){var t=this._scene.getModel(e);t&&(t.showAllLayers(),this.onSceneChanged())},t.prototype.showLayers=function(e,t){var r=this._scene.getModel(e);r&&(t.forEach(function(e){return r.showLayer(e)}),this._scene.core.updateBBox(),this._camera.core._updateProjection(),this.invalidate(),this.onSceneChanged())},t.prototype.getBimData=function(e){var t=this._scene.getModel(e);if(t)return t.getBimDataForDAM()},t.prototype.isBimModel=function(e){var t=this._scene.getModel(e);if(t)return t.hasBimInfo()},t.prototype.hideLayers=function(e,t){var r=this._scene.getModel(e);r&&(t.forEach(function(e){return r.hideLayer(e)}),this._scene.core.updateBBox(),this._camera.core._updateProjection(),this.invalidate(),this.onSceneChanged())},t.prototype.getViewsData=function(e){return this._scene.getModel(e).getViewsData()},t.prototype.getDrawableIdsFromLayerIndices=function(e,t){var r=this._scene.getModel(e);if(r){var i=[];return t.forEach(function(e){i=i.concat(r.getDrawableIdsFromLayerIndex(e))}),i}},t.prototype.getOrientation=function(){return this.orientation},t.prototype.pauseTick=function(){this.state=i.TICK_PAUSED},t.prototype.restorTick=function(){this.state=i.RENDERING},t.prototype.setShadowContrast=function(e){this._renderScene.setShadowContrast(e),this.invalidate(16)},t.prototype.exportMX3=function(e){var t=this.getScene().getModel(e);return new $n(this._scene.core,this._resourceManager,this._materialManager).export(t)},t.prototype.exportSceneMX3=function(){return new $n(this._scene.core,this._resourceManager,this._materialManager).exportScene()},t.prototype.exportMaterials=function(){return new $n(this._scene.core,this._resourceManager,this._materialManager).exportMaterials()},t.prototype.setProgressiveRendering=function(e){void 0===e&&(e=16),this._nFramesTobeDrawnProgressively=Math.min(e,16)},t.prototype.disableBimCulling=function(){this._camera.core.setBimCullingEnabled(!1)},t.prototype._removeCameraEventListener=function(){this._camera.core.removeUpdateStopListener(this._onCameraUpdateStopped)},t.prototype._restoreCameraEventListener=function(){this._camera.core.addUpdateStopListener(this._onCameraUpdateStopped)},t.prototype.drawHD=function(e){void 0===e&&(e=16),e=Math.min(e,16);for(var t=1;t<=e;)this._drawFrameProgressively(t),t++;this._resourceManager.gl.isWebGL2&&this._renderer.present(this._renderScene.getRenderTarget().getFramebuffer())},t.prototype.unloadModel=function(e){var t=this._scene.getModel(e);t&&this._scene.removeModel(t,!0)},t.prototype.spliceLayer=function(e,t){var r=this._scene.getModel(e);if(r){this._removeCameraEventListener();var i=new Hn(this._scene.core,this._renderScene,this._camera.core,this._resourceManager,this._renderer,this._eventEmitter);i.previous=this._renderScene,this._renderScene=i,r.spliceLayer(t,i),this._scene.core.updateBBox(),this._camera.core._updateProjection(),this.invalidate()}},t.prototype.explodeLayer=function(e,t){var r=this._scene.getModel(e);if(r){this._removeCameraEventListener();var i=new Hn(this._scene.core,this._renderScene,this._camera.core,this._resourceManager,this._renderer,this._eventEmitter);i.previous=this._renderScene,this._renderScene=i,r.explodeLayer(t,i),this._scene.core.updateBBox(),this._camera.core._updateProjection(),this.invalidate()}},t.prototype.explodeAllElements=function(e,t){var r=this._scene.getModel(e);if(r){this._removeCameraEventListener();var i=new Hn(this._scene.core,this._renderScene,this._camera.core,this._resourceManager,this._renderer,this._eventEmitter);i.previous=this._renderScene,this._renderScene=i,r.explodeElements(t,i);var n=P.a.aabb.create();P.a.aabb.scale(n,this._scene.core.bbox,10),this._scene.core.updateBBox(n),this._camera.core._updateProjection()}},t.prototype.spliceElements=function(e,t){var r=this._scene.getModel(e);if(r){this._removeCameraEventListener();var i=new Hn(this._scene.core,this._renderScene,this._camera.core,this._resourceManager,this._renderer,this._eventEmitter);i.previous=this._renderScene,this._renderScene=i,r.spliceElement(t,i),this._scene.core.updateBBox(),this._camera.core._updateProjection(),this.invalidate()}},t.prototype.emitDownloadWarning=function(e){this.notifyEventListener("DOWNLOAD_WARNING",e)},t}(A),Na=function(){function e(e){this.nodes=[],this.nodeBBoxes=null,this.root=null,this.elements={},this.elementsNum=0,this.model=e,this.guidElementMap={}}return e.prototype.destroy=function(){this.nodes=null,delete this.nodes,this.elements=null,delete this.elements,this.nodeBBoxes=null,delete this.nodeBBoxes,this.root=null,delete this.root,this.guidElementMap=null,delete this.guidElementMap},e.prototype.createNodes=function(e){this.nodes=new Array(e),this.nodeBBoxes=new Float32Array(6*e)},e.prototype.getNodeBBox=function(e,t){var r=6*e;t[0]=this.nodeBBoxes[r],t[1]=this.nodeBBoxes[r+1],t[2]=this.nodeBBoxes[r+2],t[3]=this.nodeBBoxes[r+3],t[4]=this.nodeBBoxes[r+4],t[5]=this.nodeBBoxes[r+5]},e.prototype.getElementPaths=function(e){var t=[];for(var r in e){var i=this.getElementPath(e[r]);i&&t.push(i)}return t},e.prototype.getElementPath=function(e){var t={elementId:0,docId:0,modelId:""};t.elementId=e.id;var r=e.getDocument();return r?(t.docId=r.id,t.modelId=this.model.name,t):(console.warn("element '"+t.elementId+"' doesn't belong to any doc"),null)},e.prototype.getElementPathString=function(e){var t=e.getDocument();return t?this.model.name+"+"+t.id+"/"+e.id:(console.warn("element '"+e.id+"' doesn't belong to any doc"),"")},e}(),Ca=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ia=function(){function e(e,t,r,i){this._name="default",this._index=-1,this._level=0,this._visibility=!0,this._color=[1,1,1],this._nodeIndices=[],this._nodes=[],this._drawables=[],this._parent=null,this._children=[],this._height=0,this._name=e,this._index=null!==t&&void 0!==t?t:-1,this._visibility=null===r||void 0===r||r,this._color=null!==i&&void 0!==i?i:[1,1,1]}return Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),e.prototype.addNodeIndex=function(e,t){this._nodeIndices.push(e),t.addLayerOfNode(e,this)},e.prototype.addNode=function(e){this._nodes.push(e)},e.prototype.getNodes=function(){return this._nodes},e.prototype.hasNode=function(){return this._nodeIndices.length>0},e.prototype.getName=function(){return this._name},e.prototype.getFullName=function(){return 1==this._level?this._name:this._parent.getFullName()+"_"+this._name},e.prototype.getIndex=function(){return this._index},e.prototype.setIndex=function(e){this._index=e},e.prototype.getColor=function(){return this._color},e.prototype.getNodeIndices=function(){return this._nodeIndices},e.prototype.getChildren=function(){return this._children},e.prototype.getVisibility=function(){return this._visibility},e.prototype.addDrawable=function(e){this._visibility?e.show():e.hide(),this._drawables.push(e)},e.prototype.show=function(){this._showSelf(),this._showChildren()},e.prototype.setTransparent=function(e){this._drawables.forEach(function(t){t.material.adjustTransparency(e)}),this.setChildrenTransparent(e)},e.prototype.setChildrenTransparent=function(e){this._children.forEach(function(t){t.setTransparent(e)})},e.prototype.hide=function(){this._hideChildren(),this._hideSelf()},e.prototype._showSelf=function(){this._visibility=!0},e.prototype._showChildren=function(){this._visibility&&(this._showDrawables(),this._children.forEach(function(e){return e._showChildren()}))},e.prototype._showDrawables=function(){this._drawables.forEach(function(e){return e.show()})},e.prototype._hideSelf=function(){this._visibility=!1},e.prototype._hideChildren=function(){this._visibility&&(this._hideDrawables(),this._children.forEach(function(e){return e._hideChildren()}))},e.prototype._hideDrawables=function(){this._drawables.forEach(function(e){return e.hide()})},e.prototype.dump=function(){console.groupCollapsed("Layer: "+this._name),console.log("index: "+this._index),console.log("level: "+this._level),console.log("nodes: ",this._nodeIndices),console.log("drawables: ",this._drawables),console.groupEnd()},e.prototype._addChild=function(e){e._level=this._level+1,e._parent=this,this._children.push(e)},e.prototype.parseFrom=function(t,r,i,n){var a,o,s,l,u,c;try{for(var h=Ca(t),d=h.next();!d.done;d=h.next()){var p=d.value,f=null!==(s=p.name)&&void 0!==s?s:"default",_=null!==(l=p.index)&&void 0!==l?l:-1,m=new e(f,_,null===(u=p.visible)||void 0===u||u,null!==(c=p.color)&&void 0!==c?c:[1,1,1]);-1===_&&(i.push(p),n.push(m)),this._addChild(m),r.addLayer(m),p.layers&&m.parseFrom(p.layers,r,i,n)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}},e.prototype.restoreVisibilityFrom=function(e){var t,r,i,n=0;try{for(var a=Ca(e),o=a.next();!o.done;o=a.next()){var s=o.value,l=this._children[n++];l._visibility=null===(i=s.visible)||void 0===i||i,l._visibility?l._showDrawables():l._hideDrawables(),s.layers&&l.restoreVisibilityFrom(s.layers)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.supplyIndexToLayerHasZeroNode=function(e,t){-1===this._index&&this._level>0&&(this._index=t[0]++,e.addLayer(this)),this._children.forEach(function(r){return r.supplyIndexToLayerHasZeroNode(e,t)})},e.prototype.getDrawableIds=function(){return this._drawables.map(function(e){return e.getId()})},e.prototype.getDrawables=function(){return this._drawables},e}(),Ra=function(){function e(e){this._jsonData=null,this._rootLayer=new Ia("root"),this._totalLayers=[],this._layerOfNode=null,this._nLayersHasNode=0,this._currentTransparency=1,this._layerOfNode=new Array(e)}return e.prototype.getLayerJsonData=function(){return this._jsonData},e.prototype.getLayerIndex=function(e){var t,r;try{for(var i=Ca(this._totalLayers),n=i.next();!n.done;n=i.next()){var a=n.value;if(a.getName()===e)return a.getIndex()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return-1},e.prototype.getLayerCount=function(){return this._totalLayers.length},e.prototype.getLayer=function(e){return this._totalLayers[e]},e.prototype.addLayer=function(e){-1!==e.getIndex()&&(this._totalLayers[e.getIndex()]=e)},e.prototype.addLayerOfNode=function(e,t){this._layerOfNode[e]=t},e.prototype.getLayerOfNode=function(e){return this._layerOfNode[e]},e.prototype.parseFrom=function(e){if(null!==e){this._jsonData=e;var t=[],r=[];this._rootLayer.parseFrom(e,this,t,r),this._nLayersHasNode=this._totalLayers.length;for(var i=0,n=t.length;i<n;i++){var a=t[i];a.index=this._nLayersHasNode,a.visible=!0;var o=r[i];o.setIndex(this._nLayersHasNode),this.addLayer(o),this._nLayersHasNode++}}},e.prototype.dump=function(){this._totalLayers.forEach(function(e){return e.dump()})},e.prototype.restoreDefaultSetting=function(){this._rootLayer.restoreVisibilityFrom(this._jsonData)},e.prototype.showAll=function(){this._totalLayers.forEach(function(e){return e.show()})},e.prototype.showLayer=function(e){var t;null===(t=this._totalLayers[e])||void 0===t||t.show()},e.prototype.setLayerTransparent=function(e,t){var r=this;return!(e.length>this._totalLayers.length)&&(Math.abs(t-this._currentTransparency)>.01&&(e.forEach(function(e){r._totalLayers[e].setTransparent(t)}),this._currentTransparency=t,!0))},e.prototype.hideLayer=function(e){var t;null===(t=this._totalLayers[e])||void 0===t||t.hide()},e.prototype.getDrawableIds=function(e){return this._totalLayers[e]?this._totalLayers[e].getDrawableIds():(console.warn("layerIndex: "+e+" is not exist in totalLayers"),[])},e.prototype.getTotalLayers=function(){return this._totalLayers},e}(),Ba=function(){function e(e){this._viewDatas=null,this._viewDatas=[]}return e.prototype.parseFrom=function(e){this._viewDatas=e},e.prototype.getViewsData=function(){return this._viewDatas},e}(),La=function(){function e(){this._name=null,this._elements=null,this._families=null,this._levels=null,this._rooms=null,this._units=null,this._links=null,this.Document={},this.Element={}}return e.prototype.loadFrom=function(e){},e.prototype.dam2Build=function(e){},e}(),Fa=r(48),Ua=r(27),Va=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},ja=function(){function e(){this._room=null,this._unitInfo=null,this._levelInfo=null,this._bimTxt=null,this._familyPropData=null,this._typeKeys=null,this._reference=null,this._elementsInfo=null}return e.prototype.loadFrom=function(e){this._bimTxt=e.filter(function(e){return"bim.txt"===e.filename})[0].data,this._familyPropData=e.filter(function(e){return"categoryCommonKeys.json"===e.filename})[0].data,this._reference=e.filter(function(e){return"reference.csv"===e.filename})[0].data,this._elementsInfo=e.filter(function(e){return"elementsInfo.csv"===e.filename})[0].data,this._levelInfo=e.filter(function(e){return"level.json"===e.filename})[0].data,this._unitInfo=e.filter(function(e){return"unit.json"===e.filename})[0].data},e.prototype.build2DAM=function(e,t){var r=this,i=this.loadProperties(this._elementsInfo),n={};this._reference.split("\n").splice(1).forEach(function(e){var t=Va(e.split(","),3),r=t[0],i=t[1],a=t[2];i&&a&&(n[i+"-"+a.trim()]=r)});var a,o,s,l,u,c,h,d,p,f,_,m,v,y,g={};this._bimTxt.split("\n").forEach(function(b){var w=0;if(0==b.length)return!0;for(;" "===b.charAt(0)&&b.length>0;)w++,b=b.substr(1);b=b.trim();var x=Fa.a[w];if(x.type===Ua.a.File){a=b.slice(0,b.lastIndexOf("(")),h=b.substring(b.lastIndexOf("(")+1,b.length-1);var M=r._unitInfo[h];void 0==M&&(M=r._unitInfo[a]),m={name:a,roomes:{},families:{},levelElements:{},units:M},t.Document[a]=m,v={},t.Element[a]=v,g[a]={}}else if(x.type===Ua.a.Level)o=b,p=r._levelInfo[h][o],_={height:p,elements:{}},m.levelElements[o]=_,y={},v[o]=y;else if(x.type===Ua.a.Category)s=b.trim(),g[a][s]||(g[a][s]={});else if(x.type===Ua.a.Family)l=b,g[a][s][l]?f=g[a][s][l]:(f=g[a][s][l]={name:l,bim:"",elements:[]},m.families[l]=f);else if(x.type===Ua.a.Type)u=b;else if(x.type===Ua.a.Element){c=b;var E=n[h+"-"+s],T=i[E][c],S=JSON.stringify(T);d={P:S,C:s,F:l,T:u,N:[]};var A=e+"+"+h+"/"+b;y[A]=d,f.elements.push(d),_.elements[A]=d}})},e.prototype.loadFamilyProperty=function(e,t,r){var i=Object.values(r[t])[0],n="{";return e.forEach(function(t,r){var a=t.split("@")[0],o=i[a];r==e.length-1?n+='"'+a+'":"'+o+'"}':n+='"'+a+'":"'+o+'",'}),n},e.prototype.loadProperties=function(e){var t={};return e.split("\n").splice(1).forEach(function(e){var r=Va(e.split(","),5),i=r[0],n=r[1],a=r[2],o=r[3],s=r[4];if(!i||!n)return!0;var l=n;'"'===l[0]&&(l=l.substring(1,l.length-1));var u=a.split("@")[0];if('"'===u[0]&&(u=u.slice(1)),"GUID"==u)return!0;var c,h=o?Number(o):function(e){return'"'==e[0]&&'"'==e[e.length-1]?e.slice(1,e.length-1):e}(s),d=t[i];d?(c=d[l])?c[u]=h:(d[l]={})[u]=h:(t[i]={},(c=t[i][l]={})[u]=h)}),t},e}(),za=function(){function e(){this._bimInfoDAM=new La,this._bimInfoBuild=new ja}return e.prototype.loadFromDAM=function(e){this._bimInfoDAM.loadFrom(e),this._bimInfoDAM.dam2Build(this._bimInfoBuild)},e.prototype.loadFromBuild=function(e,t){this._bimInfoBuild.loadFrom(t),this._bimInfoBuild.build2DAM(e,this._bimInfoDAM)},e.prototype.getDataForDAM=function(){return{elements:this._bimInfoDAM.Element,documents:this._bimInfoDAM.Document}},e.prototype.getDataForBuild=function(){return this._bimInfoBuild},e}(),Ga=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ha=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},qa=new Float32Array([-.5,-.5,-.5,.5,.5,.5]),Wa=(Nr.a.create(),function(e){function t(t,r,i,n,a,o){void 0===a&&(a=!1);var s=e.call(this,t,i,n)||this;s.isMatrixIdentity=!0,s.usePbr=!1,s.hasProfileLines=!1,s.hasCurveOrLine=!1,s.useLoadingBox=!1,s.releaseSourceData=!0,s._layers=null,s._views=null,s._bimInfo=null,s._boundingBoxColor=[240/255,240/255,240/255,.3],s._boundingBoxLineColor=[160/255,160/255,160/255,1],s.tree=new Na(s),s.source="",s._matrix=new Float32Array(r);for(var l=0;l<s._matrix.length;l++)if(0===l||5===l||10===l||15===l){if(Math.abs(s._matrix[l]-1)>1e-6){s.isMatrixIdentity=!1;break}}else if(Math.abs(s._matrix[l])>1e-6){s.isMatrixIdentity=!1;break}s.usePbr=a,s.local=o;var u=s._resourceManager.getMesh("loadingBox");u.ready||u.createSolidCube(.5),s._boundingBoxDrawable=new ta(u,s._resourceManager),s._boundingBoxDrawable.setColor(s._boundingBoxColor),s._boundingBoxDrawable.setTransparent(s._boundingBoxColor[3]),s._boundingBoxDrawable.setBbox(qa),s._boundingBoxDrawable.name=s.name+"_loadingBox";var c=s._resourceManager.getMesh("loadingBoxLine");return c.ready||c.createWiredCube(.5),s._boundingBoxLineDrawable=new ta(c,s._resourceManager),s._boundingBoxLineDrawable.setColor(s._boundingBoxLineColor),s._boundingBoxLineDrawable.setTransparent(s._boundingBoxLineColor[3]),s._boundingBoxLineDrawable.setBbox(qa),s._boundingBoxLineDrawable.name=s.name+"_loadingBoxLine",s}return Ga(t,e),Object.defineProperty(t.prototype,"boundingBoxColor",{get:function(){return this._boundingBoxColor},set:function(e){this._boundingBoxColor=e,this._boundingBoxDrawable.setColor(this._boundingBoxColor),this._boundingBoxDrawable.setTransparent(this._boundingBoxColor[3])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxLineColor",{get:function(){return this._boundingBoxLineColor},set:function(e){this._boundingBoxLineColor=e,this._boundingBoxLineDrawable.setColor(this._boundingBoxLineColor),this._boundingBoxLineDrawable.setTransparent(this._boundingBoxLineColor[3])},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.tree.destroy(),this.tree=null,delete this.tree,this.source=null,delete this.source,e.prototype.destroy.call(this)},t.prototype.initLayers=function(e){this._layers=new Ra(e)},t.prototype.initViews=function(e){this._views=new Ba(e)},t.prototype.initTree=function(e){this.tree.createNodes(e)},t.prototype.setLayerJsonData=function(e){this._layers.parseFrom(e)},t.prototype.bindLayerNode=function(e,t){e>=this._layers.getLayerCount()&&(e=0),this._layers.getLayer(e).addNodeIndex(t,this._layers)},t.prototype.setViewsData=function(e){this._views.parseFrom(e)},t.prototype.setBimInfoData=function(e){null===this._bimInfo&&(this._bimInfo=new za),this._bimInfo.loadFromBuild(this.name,e)},t.prototype.getLayerJsonData=function(){return this._layers.getLayerJsonData()},t.prototype.getLayerIndex=function(e){return this._layers.getLayerIndex(e)},t.prototype.restoreLayersDefaultSetting=function(){this._layers.restoreDefaultSetting(),this.updateBBox(),this.recalculateMatrixFromBoundingBox(this.bbox)},t.prototype.showAllLayers=function(){this._layers.showAll(),this.updateBBox(),this.recalculateMatrixFromBoundingBox(this.bbox)},t.prototype.showLayer=function(e){this._layers.showLayer(e),this.updateBBox(),this.recalculateMatrixFromBoundingBox(this.bbox)},t.prototype.setLayerTransparent=function(e,t){return this._layers.setLayerTransparent(e,t)},t.prototype.hideLayer=function(e){this._layers.hideLayer(e),this.updateBBox(),this.recalculateMatrixFromBoundingBox(this.bbox)},t.prototype.getLayerOfNode=function(e){return this._layers.getLayerOfNode(e)},t.prototype.addDrawableToLayerByNodeIndex=function(e,t){var r=this._layers.getLayerOfNode(e);r&&r.addDrawable(t)},t.prototype.getBimDataForDAM=function(){var e;return null===(e=this._bimInfo)||void 0===e?void 0:e.getDataForDAM()},t.prototype.hasBimInfo=function(){return!!this._bimInfo},t.prototype.getDrawableIdsFromLayerIndex=function(e){return this._layers.getDrawableIds(e)},t.prototype.dump=function(){this._layers.dump()},t.prototype.getViewsData=function(){return this._views?this._views.getViewsData():[]},t.prototype.setDefaultView=function(e){this.defaultView=e},t.prototype.getDrawablesWithoutLine=function(){var e,t,r=[];try{for(var i=Ha(this.drawables),n=i.next();!n.done;n=i.next()){var a=n.value;a.mesh.isLine()||r.push(a)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return this.state===H.LOADING&&r.push(this._boundingBoxDrawable),r},t.prototype.include=function(e){var t,r;try{for(var i=Ha(this.drawables),n=i.next();!n.done;n=i.next()){if(e===n.value)return!0}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},t.prototype.setPbrEnabled=function(e){this.usePbr=e},t.prototype.isPbrEnabled=function(){return this.usePbr},t.prototype.addLoadingBox=function(e){e.addLoadingBoxDrawable(this._boundingBoxLineDrawable,this._boundingBoxDrawable)},t.prototype.removeLoadingBox=function(e){e.removeLoadingBoxDrawable(this._boundingBoxLineDrawable,this._boundingBoxDrawable)},t.prototype.setLoadingBoxVisible=function(e){this._boundingBoxDrawable.visible=e,this._boundingBoxLineDrawable.visible=e},t.prototype.updateBoundingBoxMatrix=function(){var t=e.prototype.updateBoundingBoxMatrix.call(this);this._boundingBoxDrawable.setTransformMatrix(t),this._boundingBoxLineDrawable.setTransformMatrix(t)},t.prototype.updateDrawablesTransform=function(){if(e.prototype.updateDrawablesTransform.call(this),this.state!==H.LOADED){this.getTransformMatrix();this.updateBoundingBoxMatrix()}},t.prototype.updateBBox=function(){this.state===H.LOADED?e.prototype.updateBBox.call(this):P.a.aabb.transform(this.bbox,this.geometryCenteredOrientedBoundingBox,this._matrix)},t.prototype.spliceLayer=function(e,t){var r=this._layers.getTotalLayers(),i=P.a.aabb.center(this.bbox);i=[i[0],i[1],0];r.forEach(function(e){var t=function(e){for(var t=e.getDrawables(),r=P.a.aabb.create(),i=0,n=t.length;i<n;i++){var a=t[i].bbox;P.a.aabb.union(r,a,r)}return P.a.aabb.min(r)[2]}(e);e.height=t});r.sort(function(e,t){return e.height-t.height});for(var n=[],a=new Set,o=function(e,r){for(var i=e.getNodes(),o=[],s=0,l=i.length;s<l;s++){var u=i[s].getElement().name;a.has(u)||(a.add(u),o.push(u))}t.renderElements(o),n.push(new Float32Array([0,0,r]))},s=0,l=r.length;s<l;s++){var u=s*e;o(r[s],u)}t.renderElementsTranslations(n),t.enter(2e3)},t.prototype.explodeLayer=function(e,t){var r=this._layers.getTotalLayers(),i=P.a.aabb.center(this.bbox);i=[i[0],i[1],0];r.forEach(function(e){var t=function(e){for(var t=e.getDrawables(),r=P.a.aabb.create(),i=0,n=t.length;i<n;i++){var a=t[i].bbox;P.a.aabb.union(r,a,r)}return P.a.aabb.min(r)[2]}(e);e.height=t});r.sort(function(e,t){return e.height-t.height});for(var n=[],a=new Set,o=function(t,r){var n=t.bbox,a=P.a.aabb.center(n);a=[a[0],a[1],0];var o=U.d.distance(a,i)+e,s=U.d.create();return U.d.subtract(s,a,i),U.d.normalize(s,s),U.d.scale(s,s,o),[s[0],s[1],r]},s=function(e,r){for(var i=e.getNodes(),s=0,l=i.length;s<l;s++){var u=i[s].getElement(),c=u.name;if(!a.has(c)){a.add(c),t.renderElements([c]);var h=o(u,r);n.push(new Float32Array(h))}}},l=0,u=r.length;l<u;l++){var c=l*e;s(r[l],c)}t.renderElementsTranslations(n),t.enter(2e3)},t.prototype.spliceElement=function(e,t){var r=this.tree.elements,i=(P.a.aabb.center(this.bbox),new Map),n=[];for(var a in r){var o=r[a],s=o.bbox,l=P.a.aabb.min(s)[2];l=parseInt(l),i.has(l)||i.set(l,[]),i.get(l).push(o)}for(var u=Array.from(i).sort(function(e,t){return e[0]-t[0]}),c=0,h=u.length;c<h;c++){var d=c*e,p=u[c][1];t.renderElements(p.map(function(e){return e.name})),n.push(new Float32Array([0,0,d]))}t.renderElementsTranslations(n),t.enter(2e3)},t.prototype.explodeElements=function(e,t){var r=this.tree.elements,i=P.a.aabb.center(this.bbox),n=[];for(var a in r){var o=r[a].bbox,s=P.a.aabb.center(o),l=U.d.distance(s,i),u=U.d.create();U.d.subtract(u,s,i),U.d.normalize(u,u);var c=l+e,h=U.d.create();U.d.scale(h,u,c),n.push(h),t.renderElements([a])}t.renderElementsTranslations(n),t.enter(2e3)},t}(Z)),Qa=r(26);!function(e){e[e.STRUCTURE=0]="STRUCTURE",e[e.STRUCTURE_INTERIOR=4]="STRUCTURE_INTERIOR",e[e.INTERIOR=8]="INTERIOR",e[e.MEP=12]="MEP",e[e.LANDSCAPE=15]="LANDSCAPE"}(Ta||(Ta={}));var Ya=function(){function e(e){this._visible=!0,this._layer=null,this.id=e,this.region=Ta.STRUCTURE,this.father=null,this.indicesOffset=0,this.indicesCount=0,this.verticesCount=0,this.drawable=null,this.clonedDrawable=null,this._platteIndex=127,this._visible=!0}return e.prototype.getInstance=function(){for(var e=this.father;e.etype!==ut.a.INSTANCE&&null!==(e=e.father););return e},e.prototype.getGroup=function(){for(var e=this.father;e.etype!==ut.a.GROUP&&null!==(e=e.father););return e},e.prototype.getElement=function(){for(var e=this.father;e.etype!==ut.a.ELEMENT&&e.etype!==ut.a.ROOM&&e.etype!==ut.a.AREA&&null!==(e=e.father););return e},e.prototype.getComponent=function(){for(var e=this.father;e.etype!==ut.a.GROUP&&e.etype!==ut.a.INSTANCE&&null!==(e=e.father););return e},e.prototype.usePlatte=function(){return 127!=(127&this._platteIndex)},e.prototype.revertColor=function(){this.setColorIndex(127)},e.prototype.setColorIndex=function(e){this._platteIndex&=128,this._platteIndex|=e},e.prototype.show=function(){this._visible&&(this._platteIndex&=127)},e.prototype.hide=function(){this._platteIndex|=128},e.prototype.setVisibility=function(e){this._visible=e,e?this.show():this.hide()},e.prototype.getVisibility=function(){return this._visible},e.prototype.isVisible=function(){return 0==(128&this._platteIndex)},e.prototype.getPlatteIndex=function(){return this._platteIndex},e.prototype.isMerged=function(){return this.drawable.isMerged()},e.prototype.isSingleton=function(){return this.drawable.isSingleton()},e.prototype.getLayer=function(){return this._layer},e.prototype.setLayer=function(e){this._layer=e},e.prototype.getAllNodesWithinSameLayer=function(){return this._layer?this._layer.getNodes():null},e}(),Xa=function(){function e(e,t,r,i,n,a){this._tempVector31=new Float32Array(3),this._tempVector32=new Float32Array(3),this._resourceManager=e,this._sceneJson=t,this._modelBin=r,this._modelJson=i,this._attributesData=n,this._maxVertexNumber=s.a.isMobile?65536:1e9,this._meshes=0,this._nodesInfo=null,this._buffersNodes=[],this._verticesBinary=new Map,this._indicesBinary=new Map,this._model=a,this._initialize()}return e.prototype.destroy=function(){this._attributesData=null,delete this._attributesData,this._sceneJson=null,delete this._sceneJson,this._modelBin=null,delete this._modelBin,this._nodesInfo=null,delete this._nodesInfo,this._buffersNodes=null,delete this._buffersNodes,this._verticesBinary=null,delete this._verticesBinary,this._indicesBinary=null,delete this._indicesBinary,this._model=null,delete this._model},e.prototype._initialize=function(){if(null===this._nodesInfo){for(var e=this._modelJson["model.bin"].nodes,t=this._modelJson.buffers.length,r=0,i=0;i<t;i++)r+=this._modelJson.buffers[i].byteLength,this._meshes+=this._modelJson.buffers[i].meshes;console.log("MeshBinNumber: "+t),console.log("MeshBinBytes: "+r/1024/1024+"M"),this._buffersNodes=new Array(t);for(i=0;i<t;i++)this._buffersNodes[i]=[];this._nodesInfo=new Int32Array(9*e);for(i=0;i<e;i++){var n=new Int32Array(this._nodesInfo.buffer,9*i*4,9),a=this._modelBin.readNodeData(i),o=this._modelBin.readMesh(a[1]);n[0]=i,n[1]=a[1],n[2]=65535&a[0],n[2]|=2147483648,n[2]|=a[2]>>30&1?1073741824:0,n[2]|=(a[2]>>25&15)<<24,n[2]|=a[2]>>31&1?8388608:0,n[3]=-1,n[4]=o[2],n[5]=o[4],n[8]=65535&o[0];var l=o[0]>>16;this._buffersNodes[l].push(i);var u=a[0]>>16;this._model.bindLayerNode(u,i)}i=0;for(var c=t;i<c;i++)this._groupNodesByMaterial(this._buffersNodes[i]);try{this._createMerges(new Uint32Array(t),8589934592)}catch(e){throw new Error(JSON.stringify({category:"OUT_OF_MEMORY",detail:"unsupported huge model"}))}s.a.isMobile}},e.prototype._groupNodesByMaterial=function(e){if(!(e.length<=1)){var t=this;e.sort(function(e,r){var i=9*e,n=9*r,a=8388608&t._nodesInfo[i+2],o=8388608&t._nodesInfo[n+2];if(a!==o)return a-o;var s=65535&t._nodesInfo[i+2],l=65535&t._nodesInfo[n+2];if(s!==l)return s-l;var u=t._model.getLayerOfNode(e),c=t._model.getLayerOfNode(r);if(u&&c){var h=u.getIndex(),d=c.getIndex();if(h!==d)return h-d}return(t._nodesInfo[i+8]>>8&255)-(t._nodesInfo[n+8]>>8&255)});var r=9*e[0],i=65535&this._nodesInfo[r+2],n=this._nodesInfo[r+8]>>8&255,a=0,o=this._model.getLayerOfNode(e[0]);a=o?o.getIndex():0;for(var s=[e[0]],l=1,u=e.length;l<u;++l){r=9*e[l];var c=65535&this._nodesInfo[r+2],h=8388608&this._nodesInfo[r+2],d=this._nodesInfo[r+8]>>8&255,p=255&this._nodesInfo[r+8],f=this._model.getLayerOfNode(e[l]),_=0;f&&(_=f.getIndex()),h||p>2||c!==i||d!==n||_!==a?(this._splitNodesGroup(s),s=[e[l]],i=c,n=d,a=_):s.push(e[l])}this._splitNodesGroup(s)}},e.prototype._splitNodesGroup=function(e){if(e.length>1){var t=e[0],r=t,i=t,n=9*t;this._nodesInfo[n+2]|=2147483648;for(var a=this._nodesInfo[n+4],o=this._nodesInfo[n+8]>>8&255,s=this._attributesData[o].values[0].stride*this._maxVertexNumber,l=1,u=e.length;l<u;++l){t=e[l];var c=this._nodesInfo[9*t+4];a+c>s?(this._nodesInfo[9*t+2]|=2147483648,i=t,a=c):(this._nodesInfo[9*t+2]&=2147483647,this._nodesInfo[9*r+3]=t,this._nodesInfo[9*i+6]++,a+=c),r=t}}},e.prototype._computeMergeInfo=function(e,t){var r=9*e,i=this._nodesInfo[r+8]>>8&255,n=255&this._nodesInfo[r+8],a=this._attributesData[i].values[0].stride,o=0,s=this._nodesInfo[r+4],l=this._nodesInfo[r+5],u=this._nodesInfo[r+1];t[u]||(t[u]=1,o+=s+l);for(var c=s,h=l/n,d=this._nodesInfo[r+3];d>=0;)r=9*d,s=this._nodesInfo[r+4],l=this._nodesInfo[r+5],n=255&this._nodesInfo[r+8],t[u=this._nodesInfo[r+1]]||(t[u]=1,o+=s+l),c+=s,h+=l/n,d=this._nodesInfo[r+3];var p=c/a;n=1,p>65536?n=4:p>256&&(n=2),r=9*e,this._nodesInfo[r+4]=c,this._nodesInfo[r+5]=h*n,this._nodesInfo[r+7]=o,this._nodesInfo[r+8]=4294967040&this._nodesInfo[r+8]|n},e.prototype._deleteMergeInfo=function(e,t){var r=e,i=new Int32Array(this._nodesInfo.buffer,9*r*4,9),n=9*r,a=this._modelBin.readMesh(i[1]);for(this._nodesInfo[n+4]=a[2],this._nodesInfo[n+5]=a[4],this._nodesInfo[n+6]=0,this._nodesInfo[n+8]=a[0];r>=0;){n=9*r;var o=this._nodesInfo[n+3];this._nodesInfo[n+2]|=2147483648,this._nodesInfo[n+3]=-1,r=o}},e.prototype._createMerges=function(e,t){for(var r=[],i=0,n=1073741824,a=new Uint8Array(this._meshes),o=new Uint8Array(this._meshes),s=0,l=this._buffersNodes.length;s<l;s++)for(var u=this._buffersNodes[s],c=e[s],h=u.length;c<h;++c){var d=u[c],p=9*d;if(2147483648&this._nodesInfo[p+2])if(this._nodesInfo[p+3]>=0){this._computeMergeInfo(d,a);var f=this._nodesInfo[p+4]+this._nodesInfo[p+5]-this._nodesInfo[p+7],_=this._nodesInfo[p+4]+this._nodesInfo[p+5];f<13e4?t-=_:(n>f&&(n=f),t-=this._nodesInfo[p+7],r.push(d),i+=f)}else{var m=this._nodesInfo[p+1];o[m]||(a[m]?this._nodesInfo[p+7]=this._nodesInfo[p+4]+this._nodesInfo[p+5]:a[m]=1,t-=this._nodesInfo[p+4]+this._nodesInfo[p+5],o[m]=1)}}if(t<i){var v=r.length,y=Math.ceil(t/n),g=new Uint32Array((v+1)*(y+1));for(s=1;s<=v;s++){var b=Math.floor((this._nodesInfo[9*r[s-1]+4]+this._nodesInfo[9*r[s-1]+5]-this._nodesInfo[9*r[s-1]+7])/n),w=this._nodesInfo[9*r[s-1]+6];for(c=1;c<=y;c++){var x=s*(y+1)+c,M=(s-1)*(y+1)+c;if(c<b)g[x]=g[M];else{var E=(s-1)*(y+1)+c-b;g[M]>g[E]+w?g[x]=g[M]:g[x]=g[E]+w}}}for(var T=new Uint8Array(r.length),S=v,A=y;S>0;){b=Math.floor((this._nodesInfo[9*r[S-1]+4]+this._nodesInfo[9*r[S-1]+5]-this._nodesInfo[9*r[S-1]+7])/n),w=this._nodesInfo[9*r[S-1]+6];g[S*(y+1)+A]===g[(S-1)*(y+1)+A]?S--:A-b>=0&&g[S*(y+1)+A]===g[(S-1)*(y+1)+A-b]+w&&(T[S-1]=1,S--,A-=b)}var P=new Uint8Array(this._meshes);for(s=0,l=T.length;s<l;s++)T[s]||this._deleteMergeInfo(r[s],P)}},e.prototype.load=function(e,t,r){if(e>=this._buffersNodes.length)return!1;var i=this._buffersNodes[e],n=null,a=null,o=null,l=null,u=this._resourceManager.getGlobalMeshBufferIndex();if(!s.a.isMobile){for(var c,h,d=0,p=0,f=0,_=0,m=i.length;_<m;_++){if(2147483648&(x=new Int32Array(this._nodesInfo.buffer,4*i[_]*9,9))[2])if(x[3]>=0){var v=this._attributesData[x[8]>>8&255];f+=x[4]+x[5]-x[7]+x[4]/v.values[0].stride,f=4*Math.floor((f+3)/4)}else f+=x[7],f=4*Math.floor((f+3)/4)}c=f+this._modelJson.buffers[e].byteLength,h=f+this._modelJson.buffers[e].byteLength,d<c&&(d=c),p<h&&(p=h);try{o=new ArrayBuffer(d),l=new ArrayBuffer(p)}catch(t){throw console.warn("OutOfMemory: Chrome HeapSizeLimit=4Gonly enough for loading "+e+" meshbin."),this._buffersNodes.splice(e,this._buffersNodes.length-e),new Error(JSON.stringify({category:"OUT_OF_MEMORY",detail:"not enough memory for loading "+e+" meshbin"}))}n=this._resourceManager.getBuffer(this._model.name+"-vmesh"+e+".bin"),a=this._resourceManager.getBuffer(this._model.name+"-imesh"+e+".bin"),n.create(te.a.ARRAY_BUFFER,new Uint8Array(1),void 0,u),a.create(te.a.ELEMENT_ARRAY_BUFFER,new Uint8Array(1),void 0,u)}for(var y=0,g=0,b=0,w=i.length;b<w;++b){var x,M=i[b];if(2147483648&(x=new Int32Array(this._nodesInfo.buffer,4*M*9,9))[2])if(x[3]<0){var E=this._modelBin.readMesh(x[1]);if(this._resourceManager.hasMesh(x[1]>=0?this._model.name+"/"+x[1].toString():this._model.name+"/"+-x[0].toString()))r(x,null,null,this._nodesInfo,n,a,u);else{var T=this._attributesData[x[8]>>8&255],S=(E[0],E[2]/4),A=E[2]/T.values[0].stride;Tr.a.compressNormals&&T.hasNormal&&(S-=E[2]/T.values[0].stride);var P=s.a.isMobile?new Float32Array(S):new Float32Array(o,y,S),k=s.a.isMobile?new Uint8Array(E[4]):new Uint8Array(l,g,E[4]),O=new Float32Array(t,E[1],E[2]/4);this.UncompressVertices(P,O,T,Tr.a.compressNormals);var D=new Uint8Array(t,E[3],E[4]);this.UncompressIndices(k,D,E[4],0),x[4]=A,x[7]=E[4]/(255&E[0]),y=(y+=4*S)+3&-4,g=(g+=E[4])+3&-4,r(x,P,k,this._nodesInfo,n,a,u)}}else{P=null,k=null;if(s.a.isMobile){var N=this._populateMergedNodeloneLy(x,t);r(x,N.verticesBinary,N.indicesBinary,this._nodesInfo,n,a,u)}else{var C={verticesBinary:o,indicesBinary:l,verticesOffset:y,indicesOffset:g},I=y,R=g;x=this._populateMergedNode(x,t,C);var B=(y=C.verticesOffset)-I,L=(g=C.indicesOffset)-R;y=y+3&-4,g=g+3&-4,r(x,P=new Uint8Array(o,I,B),k=new Uint8Array(l,R,L),this._nodesInfo,n,a,u)}}}if(!s.a.isMobile){var F=new Uint8Array(o,0,y),U=new Uint8Array(l,0,g);this._model.releaseSourceData||this._resourceManager.addSourceBuffers(u,F.slice(0),U.slice(0)),n.update(F,0,u,0),a.update(U,0,u,1)}return!0},e.prototype.IsTranslationMatrix=function(e){return Math.abs(e[0]-1)<1e-6&&Math.abs(e[1])<1e-6&&Math.abs(e[2])<1e-6&&Math.abs(e[3])<1e-6&&Math.abs(e[4]-1)<1e-6&&Math.abs(e[5])<1e-6&&Math.abs(e[6])<1e-6&&Math.abs(e[7])<1e-6&&Math.abs(e[8]-1)<1e-6},e.prototype.IsTranslationScalingMatrix=function(e){return Math.abs(e[1])<1e-6&&Math.abs(e[2])<1e-6&&Math.abs(e[3])<1e-6&&Math.abs(e[5])<1e-6&&Math.abs(e[6])<1e-6&&Math.abs(e[7])<1e-6},e.prototype.UnionBBox=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.prototype.TransformUncompressVertices1=function(e,t,r,i,n){var a,o=t.byteLength/r.values[0].stride|0,s=(0|r.values[0].stride)>>2|0,l=(0|s)*(0|o)|0;if(4===r.primitive)if(n){var u=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),c=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(a=0;a<o;a++){var h=a*s;e[d=a*(s-1)]=t[h]+i[0],e[d+1]=t[h+1]+i[1],e[d+2]=t[h+2]+i[2],h<<=2,u[d<<=2]=c[h+12],u[d+4]=c[h+13],u[d+8]=c[h+14]}if(r.values.length>2)if(4===r.values[2].index)for(a=0;a<o;a++){h=6*a+4;e[d=5*a+3]=t[h],e[d+1]=t[h+1]}else for(a=0;a<o;a++){var d;h=5*a+4;e[d=4*a+3]=t[h]}}else{for(a=0;a<l;a+=s)e[a]=t[a]+i[0],e[a+1]=t[a+1]+i[1],e[a+2]=t[a+2]+i[2],e[a+3]=t[a+3];if(r.values.length>2)if(4===r.values[2].index)for(a=4;a<l;a+=s)e[a]=t[a],e[a+1]=t[a+1];else for(a=4;a<l;a+=s)e[a]=t[a]}else for(a=0;a<l;a+=3)e[a]=t[a]+i[0],e[a+1]=t[a+1]+i[1],e[a+2]=t[a+2]+i[2]},e.prototype.TransformUncompressVertices2=function(e,t,r,i,n,a){var o=t.byteLength/r.values[0].stride|0,s=(0|r.values[0].stride)>>2|0,l=(0|s)*(0|o)|0,u=0,c=0;if(4===r.primitive){var h=new Int8Array(e.buffer,e.byteOffset,e.byteLength),d=new Int8Array(t.buffer,t.byteOffset,t.byteLength);if(i[0]===i[1]&&i[1]===i[2])if(a)for(u=0;u<o;u++){var p=u*s;e[b=u*(s-1)]=t[p]*i[0]+n[0],e[b+1]=t[p+1]*i[1]+n[1],e[b+2]=t[p+2]*i[2]+n[2],p<<=2,h[b<<=2]=d[p+12],h[b+4]=d[p+13],h[b+8]=d[p+14]}else for(u=0;u<l;u+=s)e[u]=t[u]*i[0]+n[0],e[u+1]=t[u+1]*i[1]+n[1],e[u+2]=t[u+2]*i[2]+n[2],e[u+3]=t[u+3];else{var f=this._tempVector31,_=this._tempVector32;if(_[0]=1/i[0],_[1]=1/i[1],_[2]=1/i[2],a)for(u=0;u<o;u++){p=u*s;e[b=u*(s-1)]=t[p]*i[0]+n[0],e[b+1]=t[p+1]*i[1]+n[1],e[b+2]=t[p+2]*i[2]+n[2],b<<=2;var m=d[(p<<=2)+12],v=d[p+13],y=d[p+14];f[0]=m*_[0],f[1]=v*_[1],f[2]=y*_[2];var g=127/Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);c=u<<2,h[b]=f[0]*g,h[b+4]=f[1]*g,h[b+8]=f[2]*g}else for(u=0;u<l;u+=s){e[u]=t[u]*i[0]+n[0],e[u+1]=t[u+1]*i[1]+n[1],e[u+2]=t[u+2]*i[2]+n[2];m=d[c=12+(u<<2)],v=d[c+1],y=d[c+2];f[0]=m*_[0],f[1]=v*_[1],f[2]=y*_[2];g=127/Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);h[c]=f[0]*g,h[c+1]=f[1]*g,h[c+2]=f[2]*g}}if(r.values.length>2)if(a)if(4===r.values[2].index)for(u=0;u<o;u++){p=6*u+4;e[b=5*u+3]=t[p],e[b+1]=t[p+1]}else for(u=0;u<o;u++){var b;p=5*u+4;e[b=4*u+3]=t[p]}else if(4===r.values[2].index)for(u=4;u<l;u+=s)e[u]=t[u],e[u+1]=t[u+1];else for(u=4;u<l;u+=s)e[u]=t[u]}else for(u=0;u<l;u+=3)e[u]=t[u]*i[0]+n[0],e[u+1]=t[u+1]*i[1]+n[1],e[u+2]=t[u+2]*i[2]+n[2]},e.prototype.TransformUncompressVertices3=function(e,t,r,i,n){var a=t.byteLength/r.values[0].stride|0,o=(0|r.values[0].stride)>>2|0,s=(0|o)*(0|a)|0,l=i[0],u=i[1],c=i[2],h=i[3],d=i[4],p=i[5],f=i[6],_=i[7],m=i[8],v=i[9],y=i[10],g=i[11],b=0;if(4===r.primitive){var w=this._tempVector31,x=new Int8Array(t.buffer,t.byteOffset,4*s),M=new Int8Array(e.buffer,e.byteOffset,e.byteLength);if(n){for(b=0;b<a;b++){var E=b*(o-1),T=l*(I=t[N=b*o])+h*(R=t[N+1])+f*(B=t[N+2])+v,S=u*I+d*R+_*B+y,A=c*I+p*R+m*B+g;e[E]=T,e[E+1]=S,e[E+2]=A,E<<=2;var P=x[(N<<=2)+12],k=x[N+13],O=x[N+14];w[0]=l*P+h*k+f*O,w[1]=u*P+d*k+_*O,w[2]=c*P+p*k+m*O;var D=127/Math.sqrt(w[0]*w[0]+w[1]*w[1]+w[2]*w[2]);M[E]=w[0]*D,M[E+4]=w[1]*D,M[E+8]=w[2]*D}if(r.values.length>2)if(4===r.values[2].index)for(b=0;b<a;b++){var N=6*b+4;e[E=5*b+3]=t[N],e[E+1]=t[N+1]}else for(b=0;b<a;b++){N=5*b+4;e[E=4*b+3]=t[N]}}else{for(b=0;b<s;b+=o){T=l*(I=t[b])+h*(R=t[b+1])+f*(B=t[b+2])+v,S=u*I+d*R+_*B+y,A=c*I+p*R+m*B+g;e[b]=T,e[b+1]=S,e[b+2]=A;var C=12+(b<<2);P=x[C],k=x[C+1],O=x[C+2];w[0]=l*P+h*k+f*O,w[1]=u*P+d*k+_*O,w[2]=c*P+p*k+m*O;D=127/Math.sqrt(w[0]*w[0]+w[1]*w[1]+w[2]*w[2]);M[C]=w[0]*D,M[C+1]=w[1]*D,M[C+2]=w[2]*D}if(r.values.length>2)if(4===r.values[2].index)for(b=4;b<s;b+=o)e[b]=t[b],e[b+1]=t[b+1];else for(b=4;b<s;b+=o)e[b]=t[b]}}else for(b=0;b<s;b+=3){var I,R,B;T=l*(I=t[b])+h*(R=t[b+1])+f*(B=t[b+2])+v,S=u*I+d*R+_*B+y,A=c*I+p*R+m*B+g;e[b]=T,e[b+1]=S,e[b+2]=A}},e.prototype.UncompressIndices=function(e,t,r,i){for(var n=0;n<r;n++)e[n]=t[n]+(0|i)},e.prototype.UncompressVertices=function(e,t,r,i){var n=t.byteLength/r.values[0].stride|0,a=(0|r.values[0].stride)>>2|0,o=(0|a)*(0|n)|0;if(4===r.primitive&&i){for(var s=new Int8Array(t.buffer,t.byteOffset,t.byteLength),l=new Int8Array(e.buffer,e.byteOffset,e.byteLength),u=0,c=0;c<o;c+=a,u+=a-1){e[u]=t[c],e[u+1]=t[c+1],e[u+2]=t[c+2];var h=u<<2,d=c<<2;l[h]=s[d+12],l[h+4]=s[d+13],l[h+8]=s[d+14]}if(r.values.length>2)if(4===r.values[2].index)for(u=3,c=4;c<o;u+=5,c+=6)e[u]=t[c],e[u+1]=t[c+1];else for(u=3,c=4;c<o;u+=4,c+=5)e[u]=t[c]}else e.set(t,0,o)},e.prototype._populateMergedNodeloneLy=function(e,t){for(var r=this._attributesData[e[8]>>8&255],i=e[8],n=this._modelBin.readNodeBBox(e[0]),a=255&e[8],o=[],s=this._nodesInfo[9*e[0]+3];s>=0;)o.push(s),s=this._nodesInfo[9*s+3];var l=this;o.sort(function(e,t){return(l._nodesInfo[9*e+2]>>24&15)-(l._nodesInfo[9*t+2]>>24&15)}),o.unshift(e[0]);for(var u=new Float32Array([0,0,0]),c=new Float32Array([0,0,0]),h=0,d=0,p=0,f=0,_=o.length;f<_;f++){var m=new Int32Array(this._nodesInfo.buffer,36*o[f],9),v=(k=this._modelBin.readMesh(m[1]))[2]/4;p+=k[2]/r.values[0].stride,Tr.a.compressNormals&&r.hasNormal&&(v-=k[2]/r.values[0].stride),h+=v;var y=0;switch(255&k[0]){case 4:y=k[4]/4;break;case 2:y=k[4]/2;break;default:y=k[4]}d+=y}var g=new Float32Array(h+p),b=null;switch(a){case 4:b=new Uint32Array(d);break;case 2:b=new Uint16Array(d);break;default:b=new Uint8Array(d)}for(var w={verticesBinary:g,indicesBinary:b},x=0,M=0,E=0,T=0,S=o.length;T<S;T++){m=new Int32Array(this._nodesInfo.buffer,36*o[T],9);var A=this._modelBin.readNodeTransform(m[0]),P=this._modelBin.readNodeBBox(m[0]),k=this._modelBin.readMesh(m[1]),O=new Float32Array(t,k[1],k[2]/4);v=k[2]/4;Tr.a.compressNormals&&r.hasNormal&&(v-=k[2]/r.values[0].stride);var D=new Float32Array(g.buffer,x,v);0==(1073741824&m[2])?this.IsTranslationMatrix(A)?(u[0]=A[9],u[1]=A[10],u[2]=A[11],this.TransformUncompressVertices1(D,O,r,u,Tr.a.compressNormals)):this.IsTranslationScalingMatrix(A)?(u[0]=A[9],u[1]=A[10],u[2]=A[11],c[0]=A[0],c[1]=A[4],c[2]=A[8],this.TransformUncompressVertices2(D,O,r,c,u,Tr.a.compressNormals)):this.TransformUncompressVertices3(D,O,r,A,Tr.a.compressNormals):this.UncompressVertices(D,O,r,Tr.a.compressNormals),x+=4*v,this.UnionBBox(n,P);var N=null,C=null;y=0;switch(255&k[0]){case 4:y=k[4]/4,C=new Uint32Array(t,k[3],y);break;case 2:y=k[4]/2,C=new Uint16Array(t,k[3],y);break;default:y=k[4],C=new Uint8Array(t,k[3],y)}switch(a){case 4:N=new Uint32Array(b.buffer,M,y);break;case 2:N=new Uint16Array(b.buffer,M,y);break;default:N=new Uint8Array(b.buffer,M,y)}this.UncompressIndices(N,C,y,E),m[6]=M-0,m[7]=y,m[4]=k[2]/r.values[0].stride,E+=m[4],M+=y*a}new Uint8Array(g.buffer,x,E).fill(0);var I=0,R=0,B=o.length-1;for(R=0;R<B;R++)I=o[R],this._nodesInfo[9*I+3]=o[R+1];I=o[R],this._nodesInfo[9*I+3]=-1;var L=this._modelBin.readNodeBBox(e[0]);return L[0]=n[0],L[1]=n[1],L[2]=n[2],L[3]=n[3],L[4]=n[4],L[5]=n[5],e[8]=i,e[1]=-1,e[2]|=1073741824,w},e.prototype._populateMergedNode=function(e,t,r){for(var i=this._attributesData[e[8]>>8&255],n=r.indicesOffset,a=e[8],o=this._modelBin.readNodeBBox(e[0]),s=255&e[8],l=[],u=e[0];u>=0;)l.push(u),u=this._nodesInfo[9*u+3];var c=this;l.sort(function(e,t){return(c._nodesInfo[9*e+2]>>24&15)-(c._nodesInfo[9*t+2]>>24&15)});for(var h=new Float32Array([0,0,0]),d=new Float32Array([0,0,0]),p=0,f=0,_=l.length;f<_;f++){var m=new Int32Array(this._nodesInfo.buffer,36*l[f],9),v=this._modelBin.readNodeTransform(m[0]),y=this._modelBin.readNodeBBox(m[0]),g=this._modelBin.readMesh(m[1]),b=new Float32Array(t,g[1],g[2]/4),w=g[2]/4;Tr.a.compressNormals&&i.hasNormal&&(w-=g[2]/i.values[0].stride);var x=new Float32Array(r.verticesBinary,r.verticesOffset,w);0==(1073741824&m[2])?this.IsTranslationMatrix(v)?(h[0]=v[9],h[1]=v[10],h[2]=v[11],this.TransformUncompressVertices1(x,b,i,h,Tr.a.compressNormals)):this.IsTranslationScalingMatrix(v)?(h[0]=v[9],h[1]=v[10],h[2]=v[11],d[0]=v[0],d[1]=v[4],d[2]=v[8],this.TransformUncompressVertices2(x,b,i,d,h,Tr.a.compressNormals)):this.TransformUncompressVertices3(x,b,i,v,Tr.a.compressNormals):this.UncompressVertices(x,b,i,Tr.a.compressNormals),r.verticesOffset+=4*w,this.UnionBBox(o,y);var M=null,E=null,T=0;switch(255&g[0]){case 4:T=g[4]/4,E=new Uint32Array(t,g[3],T);break;case 2:T=g[4]/2,E=new Uint16Array(t,g[3],T);break;default:T=g[4],E=new Uint8Array(t,g[3],T)}switch(s){case 4:M=new Uint32Array(r.indicesBinary,r.indicesOffset,T);break;case 2:M=new Uint16Array(r.indicesBinary,r.indicesOffset,T);break;default:M=new Uint8Array(r.indicesBinary,r.indicesOffset,T)}this.UncompressIndices(M,E,T,p),m[6]=r.indicesOffset-n,m[7]=T,m[4]=g[2]/i.values[0].stride,p+=m[4],r.indicesOffset+=T*s}new Uint8Array(r.verticesBinary,r.verticesOffset,p).fill(0),r.verticesOffset+=p;var S=0,A=0,P=l.length-1;for(A=0;A<P;A++)S=l[A],this._nodesInfo[9*S+3]=l[A+1];S=l[A],this._nodesInfo[9*S+3]=-1,e=new Int32Array(this._nodesInfo.buffer,9*l[0]*4,9);var k=this._modelBin.readNodeBBox(e[0]);return k[0]=o[0],k[1]=o[1],k[2]=o[2],k[3]=o[3],k[4]=o[4],k[5]=o[5],e[8]=a,e[1]=-1,e[2]|=1073741824,e},e}(),Za=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},Ka=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Ja=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},$a=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ja(arguments[t]));return e},eo=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},to=[1,1,1,1],ro=[te.a.POINTS,te.a.LINES,te.a.LINES,te.a.LINES,te.a.TRIANGLES],io=[te.a.BYTE,te.a.UNSIGNED_BYTE,te.a.SHORT,te.a.UNSIGNED_SHORT,te.a.INT,te.a.UNSIGNED_INT,0,te.a.FLOAT,0],no=new Float32Array(16);var ao=function(){function e(e,t,r,i){this.isDestroyed=!1,this._resourceManager=e,this._materialManager=t,this._model=r,this._attributes=null,this._sceneJson=null,this._modelJson=null,this._binLoader=null,this._meshBinLoader=null,this._pbrMaterialJson=null,this._renderScene=i}return e.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,this._model=null,delete this._model,this._sceneJson=null,delete this._sceneJson,this._modelJson=null,delete this._modelJson,this._binLoader=null,delete this._binLoader,this._meshBinLoader.destroy(),this._meshBinLoader=null,delete this._meshBinLoader,this._attributes=null,delete this._attributes,this.isDestroyed=!0},e.prototype.load=function(e,t,r,i,n,a){return Za(this,void 0,void 0,function(){var o,s,l,u,c,h,d;return Ka(this,function(p){switch(p.label){case 0:if(this.isDestroyed)return[2];for(this._sceneJson=t,this._modelJson=r,this._binLoader=i,o=new Array(t.attributes.length),s=0,l=t.attributes.length;s<l;s++)o[s]=new ie,u=this._binLoader.readAttribute(s),o[s].primitive=ro[u[0]],c=u[1]>=0?io[u[1]]:null,h=u[2]>=0?io[u[2]]:null,d=u[3]>=0?io[u[3]]:null,o[s].builtin(te.a.FLOAT,c,h,d);return this._attributes=o,this._meshBinLoader=new Xa(this._resourceManager,t,this._binLoader,r,this._attributes,this._model),this.isDestroyed?[2]:[4,this._loadMeshesSequentially(r.buffers.length,e,n,a)];case 1:return p.sent(),[2]}})})},e.prototype._loadMeshesSequentially=function(e,t,r,i){return Za(this,void 0,void 0,function(){var n,a;return Ka(this,function(o){switch(o.label){case 0:n=0,o.label=1;case 1:if(!(n<e))return[3,4];if(this.isDestroyed)return[2];if(a="mesh"+n.toString()+".bin",!t[a])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:a+" is not exist"}));return[4,this._loadMesh(n,t[a],r,i)];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype._loadMeshesParallelly=function(e,t,r,i){return Za(this,void 0,void 0,function(){var n,a=this;return Ka(this,function(o){switch(o.label){case 0:return n=$a(Array(e).keys()).map(function(e){return Za(a,void 0,void 0,function(){var n;return Ka(this,function(a){if(n="mesh"+e.toString()+".bin",!t[n])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:n+" not exist"}));return[2,this._loadMesh(e,t[n],r,i)]})})}),[4,Promise.all(n)];case 1:return o.sent(),[2]}})})},e.prototype.setMaterialJson=function(e){this._pbrMaterialJson=e},e.prototype._loadMesh=function(e,t,r,i){return Za(this,void 0,void 0,function(){var n,a,o=this;return Ka(this,function(l){return n=r.getSingleFileProgress(),t.onProgress(function(e){return n(e.loaded)}),a=function(e,t,r,n,a,l,u){var c=o._createShaderObject(e);if(!c)throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"shader create failed"}));var h=o._createMaterialObject(e,c);if(!h)throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"material create failed"}));o._materialManager.addModelMaterial(h);var d=s.a.isMobile?o._createMeshLonely(e,t,r):o._createMeshObject(e,t,r,a,l);if(d.setBufferIndex(u),!d)throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"mesh create failed"}));if(!o._createDrawableObject(e,d,c,h,n))throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"drawable create failed"}));i()},[2,t.downloadFile().then(function(t){t&&(o.isDestroyed||(t.data.byteLength===o._modelJson.buffers[e].byteLength?o._meshBinLoader.load(e,t.data,a)?console.log("meshbin"+e+": load success"):console.warn("meshbin "+e+": load failed"):console.warn("meshbin"+e+": download failed( filesize not match )")))})]})})},e.prototype._createShaderObject=function(e){var t=this._binLoader.readMaterial(65535&e[2]),r=this._attributes[e[8]>>8&255],i=!(255==t[4]&&255==t[5]),n="solid";r.primitive===te.a.LINES?n="plain":r.hasColor?n="color":i&&(n="texture"),this._model.isPbrEnabled()&&r.primitive!==te.a.LINES&&(n="pbr");var a=[];805306368&e[2]&&a.push("INSTANCING"),1073741824&e[2]||a.push("MODEL_TRANSFORM");var o=t[3]<250&&!i;if(this._model.faces<1&&!o&&a.push("DOUBLESIDED"),s.a.isMobile&&a.push("MOBILE"),i){var l=t[5]<<8|t[4];this._binLoader.readTexture(l)[2]&&a.push("ALPHATEST"),a.push("HAS_BASECOLORMAP")}Tr.a.compressNormals&&a.push("COMPRESSION"),this._model.isMatrixIdentity||a.push("MODEL_TRANSFORM");var u=this._resourceManager.getShader(n,a);if(!u.ready){var c=k.a[n];if(u.createFromShaderSource(c,a),!u.ready)throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"shader create failed: "+n+", "+a}))}return u},e.prototype._recompilePbrShader=function(e,t){var r=t.flags;e.hasTexture&&-1===r.indexOf("HAS_BASECOLORMAP")&&r.push("HAS_BASECOLORMAP");var i=this._resourceManager.getShader("pbr",r);if(!i.ready){var n=k.a.pbr;if(i.createFromShaderSource(n,r),!i.ready)throw new Error(JSON.stringify({category:"RESOURCE_CREATE_FAILED",detail:"shader create failed: pbr, "+r}))}},e.prototype._createMeshLonely=function(e,t,r){var i=null;if(!(i=this._resourceManager.getMesh(e[1]>=0?this._model.name+"/"+e[1].toString():this._model.name+"/-"+e[0].toString())).ready){var n=[te.a.UNSIGNED_BYTE,te.a.UNSIGNED_BYTE,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_INT],a=e[8]>>8&255,o=this._attributes[a];o=o.clone(),Tr.a.compressNormals&&o.compress();for(var s=t.byteLength/(o.values[0].stride+(e[3]>=0?4:0)),l=0,u=o.values.length;l<u;l++)o.values[l].offset+=t.byteOffset;if(e[3]>=0){o.add("m_aMaterial",6,te.a.UNSIGNED_BYTE,!0,1);var c=o.values[o.values.length-1];c.index=6,c.offset=o.values[0].offset+s*o.values[0].stride,c.stride=1}i.create(o.primitive,o,t,r,n[255&e[8]])}return i},e.prototype._createMeshObject=function(e,t,r,i,n){var a=null;if((a=this._resourceManager.getMesh(e[1]>=0?this._model.name+"/"+e[1].toString():this._model.name+"/-"+e[0].toString())).ready)return a;var o=[te.a.UNSIGNED_BYTE,te.a.UNSIGNED_BYTE,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_SHORT,te.a.UNSIGNED_INT],s=e[8]>>8&255,l=this._attributes[s];l=l.clone(),Tr.a.compressNormals&&l.compress();for(var u=t.byteLength/(l.values[0].stride+(e[3]>=0?1:0)),c=0,h=l.values.length;c<h;c++)l.values[c].offset+=t.byteOffset;if(e[3]>=0){l.add("m_aMaterial",6,te.a.UNSIGNED_BYTE,!0,1);var d=l.values[l.values.length-1];d.index=6,d.offset=l.values[0].offset+u*l.values[0].stride,d.stride=1}return a.createShared(l.primitive,l,t,r,o[255&e[8]],i,n),a},e.prototype._createDrawableObject=function(e,t,r,i,n){this._attributes[e[8]>>8&255];var a=null;0==(1073741824&e[2])?(a=function(e){return no[0]=e[0],no[1]=e[1],no[2]=e[2],no[3]=0,no[4]=e[3],no[5]=e[4],no[6]=e[5],no[7]=0,no[8]=e[6],no[9]=e[7],no[10]=e[8],no[11]=0,no[12]=e[9],no[13]=e[10],no[14]=e[11],no[15]=1,no}(this._binLoader.readNodeTransform(e[0])),this._model.isMatrixIdentity||U.a.multiply(a,this._model.getOriginalTransformMatrix(),a)):this._model.isMatrixIdentity||(a=this._model.getOriginalTransformMatrix());var o=this._binLoader.readNodeBBox(e[0]);this._model.isMatrixIdentity||P.a.aabb.transform(o,o,this._model.getOriginalTransformMatrix());var s=null;(s=!!(8388608&e[2])?new We(t,r,i,a,o):new D.a(t,r,i,a,o)).visible=!0,this._model.addDrawable(s),this._model.addDrawableToLayerByNodeIndex(e[0],s),this._renderScene.addModelDrawabled(s);for(var l=Ta.STRUCTURE,u=e[0],c=0;u>=0;){var h=this._model.tree.nodes[u],d=n[9*u+2]>>24&15;s.nodes.push(h),h.region=d,h.drawable=s;var p=this._model.getLayerOfNode(u);p.addNode(h),h.setLayer(p),805306368&n[9*u+2]?(h.indicesOffset=1,h.indicesCount=1):(h.indicesOffset=n[9*u+6],h.indicesCount=n[9*u+7]),0===h.indicesOffset&&0===h.indicesCount&&(h.indicesCount=e[5]/t.indexSize),h.verticesCount=n[9*u+4],l!==d&&(l=d,d>=Ta.STRUCTURE_INTERIOR&&s.hidables<0&&(s.hidables=c)),u=n[9*u+3],c++}return 805306368&e[2]&&(s.hidables=(e[2]>>24&15)>=Ta.STRUCTURE_INTERIOR?0:-1),s},e.prototype._createMaterialObject=function(e,t){var r=e[0],i=65535&e[2],n=this._sceneJson.materials[i],a=this._model.getLayerOfNode(r),o="defaultLayer";a&&(o=a.getFullName());var s=this._attributes[e[8]>>8&255].primitive===te.a.LINES;s&&(n="mxLine-"+n),!s&&this._model.isPbrEnabled()&&(n="mxPbr-"+n);var l=this._model.prefix;l&&(l+=".");var u=l+o+"."+n,c=this._materialManager.getMaterial(u);if(!c){var h=this._binLoader.readMaterial(i);!s&&this._model.isPbrEnabled()?((c=this._materialManager.createMaterialPbr(u)).attachShader(t,this._resourceManager),this._setMaterialPbr(c,h,i),this._recompilePbrShader(c,t)):((c=this._materialManager.createMaterialAdhoc(u)).attachShader(t,this._resourceManager),this._setMaterialAdhoc(c,h,i)),c.setModelName(this._model.name),c.setPrefix(this._model.prefix),c.setLayerName(o),c.setMaterialName(n)}return c},e.prototype._setMaterialAdhoc=function(e,t,r){var i,n,a,o;to[0]=t[0]/255,to[1]=t[1]/255,to[2]=t[2]/255,to[3]=t[3]/255;var s=[1,1],l=0;if(this._pbrMaterialJson){var u=this._pbrMaterialJson.data[r],c="FRONT"===u.side?N.a.FRONTSIDE:N.a.DOUBLESIDE_NORMAL_FRONT;if(e.polygonOffset=!!u.polygonOffset,e.polygonOffsetFactor=u.polygonOffsetFactor?u.polygonOffsetFactor:0,e.polygonOffsetUnits=u.polygonOffsetUnits?u.polygonOffsetUnits:0,u.displayMaterial){var h=u.displayMaterial.parameters,d=!1;try{for(var p=eo(h),f=p.next();!f.done;f=p.next()){var _=f.value;if("diffuseTexture"===_.name&&(d=!0),"diffuseTextureScale"===_.name){var m=_.value.split(",");s=[parseFloat(m[0]),-parseFloat(m[1])],l=-1*parseFloat(m[2])}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}d&&(to=[1,1,1,to[3]])}else if(u.physicalMaterial){var v=u.physicalMaterial.diffuseTexture;if(v){var y=null!==(a=v.repeat)&&void 0!==a?a:{x:1,y:-1};s=[y.x,-y.y],l=null!==(o=-1*v.rotation)&&void 0!==o?o:0}}e.setSide(c)}else e.setSide(this._model.faces<1?N.a.DOUBLESIDE_NORMAL_FRONT:N.a.FRONTSIDE);if(e.setDiffuse(to),e.setTransparent(t[3]/255),e.getTransparent()<.98&&(e.transparent=!0),255!==t[4]||255!==t[5]){var g=t[5]<<8|t[4],b=this._model.name+"-"+this._sceneJson.textures[g].name.toLowerCase(),w=this._binLoader.readTexture(g);4===w[0]?1===w[2]?(e.hasMask=!0,e.transparent=!1):(e.transparent=!0,e.textureTransparent=!0):e.transparent?(e.transparent=!0,e.textureTransparent=!0):e.transparent=!1;var x=this._resourceManager.getTexture(b);e.setDiffuseTexture(x),e.setTextureScale(s),e.setTextureRotate(l),e.originTextureUrl=x.url,e.setTextureFullName(b)}},e.prototype._setMaterialPbr=function(e,t,r){if(this._pbrMaterialJson){var i=this._pbrMaterialJson.data;i&&i[r]?this._setValidPbr(e,i[r]):(this._setDefaultPbr(e,t),console.warn("material index: "+r+" use default PBR parameter"))}else this._setDefaultPbr(e,t)},e.prototype._setDefaultPbr=function(e,t){var r;if(to[0]=t[0]/255,to[1]=t[1]/255,to[2]=t[2]/255,to[3]=t[3]/255,e.setSide(N.a.FRONTSIDE),e.setBaseColor(to),this._resourceManager.hasTexture("modelo-brdf-lut")?r=this._resourceManager.getTexture("modelo-brdf-lut"):(r=this._resourceManager.getTexture("modelo-brdf-lut")).createFromFile(ce,te.a.RGBA,te.a.LINEAR,te.a.CLAMP_TO_EDGE,function(){}),e.setBrdfLut(r),255!==t[4]){var i=t[5]<<8|t[4],n=this._model.name+"-"+this._sceneJson.textures[i].name.toLowerCase(),a=this._binLoader.readTexture(i);4===a[0]?1===a[2]?(e.hasMask=!0,e.transparent=!1):(e.transparent=!0,e.textureTransparent=!0):e.transparent?(e.transparent=!0,e.textureTransparent=!0):e.transparent=!1;var o=this._resourceManager.getTexture(n);e.setBaseColorTexture(o),e.setTextureFullName(n)}},e.prototype._setValidPbr=function(e,t){var r,i,n="FRONT"===t.side?N.a.FRONTSIDE:N.a.DOUBLESIDE_NORMAL_FRONT;e.polygonOffset=!!t.polygonOffset,e.polygonOffsetFactor=t.polygonOffsetFactor?t.polygonOffsetFactor:0,e.polygonOffsetUnits=t.polygonOffsetUnits?t.polygonOffsetUnits:0;var a=[1,1,1],o=.8,s=0,l=null,u="",c=[1,1,0];if(t.displayMaterial){var h=t.displayMaterial.parameters;try{for(var d=eo(h),p=d.next();!p.done;p=d.next()){var f=p.value;switch(f.name){case"diffuse":break;case"diffuseColor":var _=f.value.split(",");a=[parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])];break;case"diffuseTexture":u=JSON.parse(f.value),u=this._model.name+"-"+u.defaultUrl.toLowerCase(),(l=this._resourceManager.getTexture(u)).ready||console.warn("texture named"+u+"is not ready");break;case"diffuseTextureScale":var m=f.value.split(",");c=[parseFloat(m[0]),parseFloat(m[1]),parseFloat(m[2])];break;case"reflect":case"reflectColor":case"refract":break;case"refractColor":f.value.split(",");break;case"reflectGlossiness":o=parseFloat(f.value);break;case"bump":break;case"ior":var v=f.value.split(",");s=1-parseFloat(v[0])}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}else if(t.physicalMaterial){var y=t.physicalMaterial;s=y.reflect?1-y.reflect.x:1,o=y.gloss?1-o:.8,a=[y.diffuse.x,y.diffuse.y,y.diffuse.z],e.hasMask=!!y.opacityMask}e.setBaseColor(a),e.setEmissive([.8,.8,.8]),e.setTransparent(1),e.setRoughness(o),e.setMetallic(s),e.setReflectIntensity(1),e.setTextureScale(c),e.setSide(n),l&&(e.setBaseColorTexture(l),e.originTextureUrl=l.url,e.setTextureFullName(u))},e}(),oo=new Float32Array(6),so=function(){function e(e){this._model=e}return e.prototype.destroy=function(){this._model=null,delete this._model},e.prototype.load=function(e,t){var r=this;return e["uuid.bin"]?(e["modelgraph.bin"].onProgress(function(e){}),e["modelgraph.bin"].downloadFile().then(function(t){if(!t)return Promise.reject("Loading tree canceled");var i=t.data;return e["uuid.bin"].onProgress(function(e){}),e["uuid.bin"].downloadFile().then(function(e){r._parse(i,e.data)})})):(e["modelgraph.bin"].onProgress(function(e){}),e["modelgraph.bin"].downloadFile().then(function(e){r._parse(e.data,null)}))},e.prototype._parse=function(e,t){var r=this._model.tree,i=new ut.b(ut.a.ROOT,-1,this._model,this._model.name);r.root=i;var n,a,o,s=e.byteLength,l=0,u=[];u.push(i);for(var c=0;l<e.byteLength;){var h=new Uint8Array(e,l,9);for(n=h[3]<<24|h[2]<<16|h[1]<<8|h[0],a=h[7]<<24|h[6]<<16|h[5]<<8|h[4],o=h[8];u.length>0&&u[u.length-1].id!==a;)u.pop();if(0===u.length)return void console.warn("father of "+n+" is wrong");var d=u[u.length-1];if(o===ut.a.NODE){var p=r.nodes[n];p.father=d,d.children.push(p)}else{o===ut.a.LINK&&(c=n);var f=this._model.name+"+"+c+"/"+n,_=new ut.b(o,n,this._model,f);if(o!==ut.a.ELEMENT&&o!==ut.a.ROOM&&o!==ut.a.AREA||(r.elements[f]=_,r.elementsNum++),t&&o===ut.a.ELEMENT){var m=new Uint8Array(t,l/9*16,16);_.guid+=m[3]<16?"0"+m[3].toString(16):m[3].toString(16),_.guid+=m[2]<16?"0"+m[2].toString(16):m[2].toString(16),_.guid+=m[1]<16?"0"+m[1].toString(16):m[1].toString(16),_.guid+=m[0]<16?"0"+m[0].toString(16):m[0].toString(16),_.guid+="-",_.guid+=m[5]<16?"0"+m[5].toString(16):m[5].toString(16),_.guid+=m[4]<16?"0"+m[4].toString(16):m[4].toString(16),_.guid+="-",_.guid+=m[7]<16?"0"+m[7].toString(16):m[7].toString(16),_.guid+=m[6]<16?"0"+m[6].toString(16):m[6].toString(16),_.guid+="-",_.guid+=m[8]<16?"0"+m[8].toString(16):m[8].toString(16),_.guid+=m[9]<16?"0"+m[9].toString(16):m[9].toString(16),_.guid+="-",_.guid+=m[10]<16?"0"+m[10].toString(16):m[10].toString(16),_.guid+=m[11]<16?"0"+m[11].toString(16):m[11].toString(16),_.guid+=m[12]<16?"0"+m[12].toString(16):m[12].toString(16),_.guid+=m[13]<16?"0"+m[13].toString(16):m[13].toString(16),_.guid+=m[14]<16?"0"+m[14].toString(16):m[14].toString(16),_.guid+=m[15]<16?"0"+m[15].toString(16):m[15].toString(16),r.guidElementMap[_.guid]=f}_.father=d,d.children.push(_),u.push(_)}l+=9}var v=0;for(s=i.children.length;v<s;v++)this._computeBBox(i.children[v])},e.prototype._printTree=function(e,t){for(var r="",i=0;i<e;i++)r+=" ";if(t.hasOwnProperty("id"))r+="n id="+t.id,console.log(r);else{r+=["root","i","g","e","n","l"][t.type]+" name="+t.name,console.log(r);i=0;for(var n=t.children.length;i<n;i++)this._printTree(e+1,t.children[i])}},e.prototype._computeBBox=function(e){for(var t=0,r=e.children.length;t<r;t++){var i=e.children[t],n=void 0;i.hasOwnProperty("region")?(this._model.tree.getNodeBBox(i.id,oo),n=oo):(this._computeBBox(i),n=i.bbox),P.a.aabb.union(e.bbox,e.bbox,n)}},e}(),lo=r(78),uo=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},co=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ho=function(){function e(e){void 0===e&&(e=8),this.limit=e,this._blockQueue=[],this._currentReqNumber=0}return e.prototype.request=function(e){return uo(this,void 0,void 0,function(){var t=this;return co(this,function(r){switch(r.label){case 0:return this._currentReqNumber>=this.limit?[4,new Promise(function(e){return t._blockQueue.push(e)})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2,this._handlerReq(e)]}})})},e.prototype._handlerReq=function(e){return uo(this,void 0,void 0,function(){var t;return co(this,function(r){switch(r.label){case 0:this._currentReqNumber++,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,e()];case 2:return[2,r.sent()];case 3:return t=r.sent(),[2,Promise.reject(t)];case 4:return this._currentReqNumber--,this._blockQueue.length&&(this._blockQueue[0](),this._blockQueue.shift()),[7];case 5:return[2]}})})},e.prototype.destroy=function(){this._blockQueue.length=0,this._blockQueue=null,delete this._blockQueue},e}(),po=r(42),fo=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},_o=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},mo=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},vo=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(mo(arguments[t]));return e},yo=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},go=function(){function e(e,t,r,i){var n=this;this._nTextureLoaded=0,this._progressFn=null,this.isDestroyed=!1,this._model=e,this._resourceManager=t,this._materialManager=r,this._renderScene=i,this._binLoader=null,this._pbrMaterialsJson=null,this._filePromises=[],this._modelJson=null,this._sceneJson=null,this._progressTracker=null,this._requestLimitManager=new ho,this._model.stateChangeCallback=function(e,t){t===H.UNLOADED&&n.destroy()}}return e.prototype.destroy=function(){for(var e in this._model=null,delete this._model,this._resourceManager=null,delete this._resourceManager,this._binLoader.destroy(),this._binLoader=null,delete this._binLoader,this._meshLoader.destroy(),this._meshLoader=null,delete this._meshLoader,this._filePromises)this._filePromises[e].cancel&&this._filePromises[e].cancel();this._filePromises=null,delete this._filePromises,this._sceneJson=null,delete this._sceneJson,this._modelJson=null,delete this._modelJson,this._sceneBin=null,delete this._sceneBin,this._modelBin=null,delete this._modelBin,this._progressTracker=null,delete this._progressTracker,this._requestLimitManager.destroy(),this._requestLimitManager=null,delete this._requestLimitManager,this.isDestroyed=!0},e.prototype._saveFilePromises=function(e){var t=this;Object.keys(e).forEach(function(r){if(t._filePromises[r.toLowerCase()]=e[r],t._filePromises[r.toLowerCase()].downloadFile){var i=t._filePromises[r.toLowerCase()].downloadFile;t._filePromises[r.toLowerCase()].downloadFile=function(){return fo(t,void 0,void 0,function(){var e,t,n;return _o(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._requestLimitManager.request(i)];case 1:return[2,a.sent()];case 2:e=a.sent(),t=e,n=void 0;try{n=JSON.parse(t.message)}catch(e){n={category:"DOWNLOAD_ERROR",detail:r+" download failed"}}throw new Error(JSON.stringify({category:n.category.toUpperCase(),detail:n.detail+": "+r+" download failed"}));case 3:return[2]}})})}}}),console.log("filePromises: ",this._filePromises)},e.prototype._initProgressTracker=function(e){this._progressTracker=new Qa.a.ProgressTracker(e),this._progressFn=e},e.prototype._loadSceneJson=function(){return fo(this,void 0,void 0,function(){var e,t;return _o(this,function(r){switch(r.label){case 0:if(this.isDestroyed)return[2];if(!this._filePromises["scene.json"])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"scene.json is not exist"}));return[4,this._filePromises["scene.json"].downloadFile()];case 1:if(!(e=r.sent()))throw new Error(JSON.stringify({"category ":"FILE_CORRUPTED",detail:"scene.json is empty"}));return this._sceneJson="string"==typeof e.data?JSON.parse(e.data):e.data,this._judgeDoubleSided(),t=this._getDefaultView(this._model.getViewsData(),this._sceneJson.scene.defaultView),this._model.setDefaultView(t),console.log("mx version: "+this._sceneJson.version),[2]}})})},e.prototype._loadModelJson=function(){return fo(this,void 0,void 0,function(){var e,t,r,i;return _o(this,function(n){switch(n.label){case 0:if(this.isDestroyed)return[2];if(!this._filePromises["model.json"])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"model.json is not exist"}));return[4,this._filePromises["model.json"].downloadFile()];case 1:if(!(e=n.sent()))throw new Error(JSON.stringify({category:"FILE_CORRUPTED",detail:"model.json is empty"}));if(this._modelJson=e.data,0===this._modelJson.buffers.length)throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"mesh file is not exist"}));return t=P.a.aabb.createFromArray(this._modelJson["model.bin"].bbox),this._model.bbox=new Float32Array(6),P.a.aabb.copy(this._model.bbox,t),this._model.preInitialize(t),this._model.useLoadingBox&&this._model.addLoadingBox(this._renderScene),r=this._modelJson["model.bin"].nodes,this._model.initLayers(r),this._model.initViews(r),this._model.initTree(r),i=this._modelJson.buffers.reduce(function(e,t){return e+t.meshes},0),console.log("numOfNodes: "+r),console.log("numOfMeshes: "+i),[2]}})})},e.prototype._setProgressTracker=function(){var e=0;this._sceneJson.textures&&this._sceneJson.textures.forEach(function(t){return e+=t.byteLength});var t=0;this._modelJson.buffers&&this._modelJson.buffers.forEach(function(e){return t+=e.byteLength});var r=this._modelJson["model.bin"].byteLength,i=this._modelJson["modelgraph.bin"].byteLength,n=this._modelJson["uuid.bin"]?this._modelJson["uuid.bin"].byteLength:0;this._progressTracker.setTotalDownload(e+t+r+i+n)},e.prototype._loadLayers=function(){return fo(this,void 0,void 0,function(){var e,t;return _o(this,function(r){switch(r.label){case 0:return this.isDestroyed?[2]:(e=null,this._filePromises["layers.json"]?[3,1]:(e=this._createLayerData(),console.log("has no layers: create default layer"),[3,3]));case 1:return[4,this._filePromises["layers.json"].downloadFile()];case 2:t=r.sent(),e=t.data,r.label=3;case 3:return this._model.setLayerJsonData(e),[2]}})})},e.prototype._loadViews=function(){return fo(this,void 0,void 0,function(){var e;return _o(this,function(t){switch(t.label){case 0:return this.isDestroyed?[2]:this._filePromises["views.json"]?[4,this._filePromises["views.json"].downloadFile()]:(console.log("has no views"),[2]);case 1:return e=t.sent(),this._model.setViewsData(e.data),[2]}})})},e.prototype._loadSceneBin=function(){return fo(this,void 0,void 0,function(){var e;return _o(this,function(t){switch(t.label){case 0:if(this.isDestroyed)return[2];if(!this._filePromises["scene.bin"])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"scene.bin is not exist"}));return[4,this._filePromises["scene.bin"].downloadFile()];case 1:if(!(e=t.sent()))throw new Error(JSON.stringify({category:"FILE_CORRUPTED",detail:"scene.bin is empty"}));return this._sceneBin=e.data,[2]}})})},e.prototype._loadModelBin=function(){return fo(this,void 0,void 0,function(){var e;return _o(this,function(t){switch(t.label){case 0:if(this.isDestroyed)return[2];if(!this._filePromises["model.bin"])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"model.bin is not exist"}));return[4,this._filePromises["model.bin"].downloadFile()];case 1:if(!(e=t.sent()))throw new Error(JSON.stringify({category:"FILE_CORRUPTED",detail:"model.bin is empty"}));return this._modelBin=e.data,[2]}})})},e.prototype._loadExtendedMaterial=function(){return fo(this,void 0,void 0,function(){var e;return _o(this,function(t){switch(t.label){case 0:return this._filePromises["pbrmaterial.json"]?[4,this._filePromises["pbrmaterial.json"].downloadFile()]:[2];case 1:return(e=t.sent())||console.warn("pbr material is not exist"),this._pbrMaterialsJson=e,[2]}})})},e.prototype._prepareBinLoader=function(){this._binLoader=new Xe(this._sceneJson,this._sceneBin,this._modelJson,this._modelBin)},e.prototype._loadNodesAABB=function(){if(!this.isDestroyed)for(var e=this._model.tree,t=e.nodes.length,r=0;r<t;r++){e.nodes[r]=new Ya(r);var i=this._binLoader.readNodeBBox(r),n=new Float32Array(e.nodeBBoxes.buffer,24*r,6);P.a.aabb.copy(n,i)}},e.prototype._loadTextures=function(){return fo(this,void 0,void 0,function(){return _o(this,function(e){switch(e.label){case 0:return this.isDestroyed?[2]:0===this._sceneJson.textures.length?[2]:(this._collectSamplers(),this._hasOldDiscretedTextures()?[4,this._loadDiscretedTextures()]:[3,2]);case 1:return e.sent(),[3,4];case 2:return[4,this._loadZipTextures()];case 3:e.sent(),e.label=4;case 4:return console.log("load texture ready"),[2]}})})},e.prototype._loadMeshes=function(e){return fo(this,void 0,void 0,function(){return _o(this,function(t){switch(t.label){case 0:return this.isDestroyed?[2]:(this._meshLoader=new ao(this._resourceManager,this._materialManager,this._model,this._renderScene),this._pbrMaterialsJson&&this._meshLoader.setMaterialJson(this._pbrMaterialsJson),[4,this._meshLoader.load(this._filePromises,this._sceneJson,this._modelJson,this._binLoader,this._progressTracker,e)]);case 1:return t.sent(),[2]}})})},e.prototype._loadModelGraph=function(){return fo(this,void 0,void 0,function(){return _o(this,function(e){switch(e.label){case 0:if(!this._filePromises)return[2];if(!this._filePromises["modelgraph.bin"])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"modelgraph.bin is not exist!"}));return[4,new so(this._model).load(this._filePromises,this._progressTracker)];case 1:return e.sent(),[2]}})})},e.prototype._removeLoadingBox=function(){this._model.useLoadingBox&&this._model.removeLoadingBox(this._renderScene)},e.prototype._createLayerData=function(){return[{name:this._model.name,visible:!0,color:[1,1,1],nodes:[]}]},e.prototype._judgeDoubleSided=function(){if(this._sceneJson.source){var e=[];this._sceneJson.source.split("/").forEach(function(t){return e.push.apply(e,vo(t.split(".")))});var t=e[e.length-1];switch(this._model.faces=1,t){case"skp":this._model.faces=s.a.isOrbital?0:2,this._model.hasContours=!0,this._model.isBimCullingNeeded=!0;break;case"mpd":this._model.faces=0,this._model.isBimCullingNeeded=!0;break;case"rfa":case"rvt":this._model.faces=0,this._model.hasProfileLines=!0,this._model.hasContours=!0,this._model.isBimCullingNeeded=!0;break;case"vgx":case"stl":case"max":this._model.faces=1;break;case"obj":case"3dm":this._model.faces=0,this._model.hasCurveOrLine=!0;break;case"nwd":this._model.faces=0;break;case"ksg":this._model.faces=2,this._model.setPbrEnabled(!1);default:this._model.faces=0}this._model.source=t}},e.prototype._collectSamplers=function(){var e=this._sceneJson.samplers.length;this._samplers=new Array(e);for(var t=0;t<e;t++){this._samplers[t]=new Object;var r=this._binLoader.readSampler(t);this._samplers[t].wrap=1===r[1]?te.a.REPEAT:te.a.CLAMP_TO_EDGE,this._samplers[t].filter=1===r[0]?1===r[2]?te.a.LINEAR_MIPMAP_LINEAR:te.a.LINEAR:1===r[2]?te.a.NEAREST_MIPMAP_NEAREST:te.a.NEAREST}},e.prototype._hasOldDiscretedTextures=function(){var e=this._sceneJson.textures[0].name.toLowerCase();return!!this._filePromises[e]},e.prototype._loadDiscretedTextures=function(){return fo(this,void 0,void 0,function(){var e,t=this;return _o(this,function(r){switch(r.label){case 0:return console.log("use old texture promise"),e=this._sceneJson.textures.map(function(e,r){return t._loadSingleTextureImage(e.name.toLowerCase(),r)}),[4,Promise.all(e)];case 1:return r.sent(),[2]}})})},e.prototype._loadSingleTextureImage=function(e,t){return fo(this,void 0,void 0,function(){var r,i;return _o(this,function(n){switch(n.label){case 0:if(this.isDestroyed)return[2];if(!this._filePromises[e])throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:e+" is not exist"}));n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._filePromises[e].downloadFile()];case 2:return r=n.sent(),[3,4];case 3:return i=n.sent(),console.error(i),this.onDownloadWarning&&("string"==typeof i?this.onDownloadWarning(new Error(JSON.stringify({category:"DOWNLOADERROR",detail:i}))):this.onDownloadWarning(i)),[3,4];case 4:return r?this._createTexture(r,e,t):this._createBlankTexture(e,t),this._nTextureLoaded++,this._progressFn(.01+this._nTextureLoaded/this._sceneJson.textures.length/10,this._nTextureLoaded+"/"+this._sceneJson.textures.length),[2]}})})},e.prototype._hasNextZipTexture=function(e){var t="textures"+e.toString()+".zip";return!!this._filePromises[t]},e.prototype._loadZipTextures=function(){return fo(this,void 0,void 0,function(){var e,t,r,i,n,a,o,s=this;return _o(this,function(l){switch(l.label){case 0:if(!this._hasNextZipTexture(0))throw new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:"textures0.zip not exist"}));e=0,t=[],l.label=1;case 1:return i=(r=t.push).apply,n=[t],[4,this._loadZipTexture(e)];case 2:i.apply(r,n.concat([vo.apply(void 0,[l.sent()])])),l.label=3;case 3:if(this._hasNextZipTexture(++e))return[3,1];l.label=4;case 4:if(a=this._sceneJson.textures.length,t.length===a)return[2];throw o="textures not exist: ",Array.from(Array(a).keys()).filter(function(e){return!t.includes(e)}).forEach(function(e){return o+=s._sceneJson.textures[e].name}),new Error(JSON.stringify({category:"FILE_NOT_EXIST",detail:o}))}})})},e.prototype._loadZipTexture=function(e){return fo(this,void 0,void 0,function(){var t,r,i,n,a,o,s,l,u,c,h,d,p,f,_,m,v;return _o(this,function(y){switch(y.label){case 0:return this.isDestroyed?[2]:(t="textures"+e.toString()+".zip",[4,this._filePromises[t].downloadFile()]);case 1:r=y.sent(),i=null,y.label=2;case 2:return y.trys.push([2,4,,5]),[4,Object(lo.a)(r.data)];case 3:return n=y.sent(),i=n.entries,[3,5];case 4:throw y.sent(),new Error(JSON.stringify({category:"FILE_CORRUPTED",detail:"unzip "+t+" failed"}));case 5:a=[],y.label=6;case 6:y.trys.push([6,18,19,20]),o=yo(Object.entries(i)),s=o.next(),y.label=7;case 7:if(s.done)return[3,17];l=mo(s.value,2),u=l[0],l[1],c=null,y.label=8;case 8:return y.trys.push([8,10,,11]),h="image/"+("jpg"===u.split(".")[1]?"jpeg":"png"),[4,i[u].blob(h)];case 9:return c=y.sent(),[3,11];case 10:throw y.sent(),new Error(JSON.stringify({category:"FILE_CORRUPTED",detail:u+" decode failed"}));case 11:if(-1===(d=this._getTextureIndex(u)))return[3,16];a.push(d),p=void 0,y.label=12;case 12:return y.trys.push([12,14,,15]),[4,Object(po.b)(c,u.toLowerCase())];case 13:return p=y.sent(),[3,15];case 14:return f=y.sent(),console.error(f),this.onDownloadWarning&&("string"==typeof f?this.onDownloadWarning(new Error(JSON.stringify({category:"processImage".toUpperCase(),detail:f}))):this.onDownloadWarning(f)),[3,15];case 15:p?this._createTexture(p,u.toLowerCase(),d):this._createBlankTexture(u.toLowerCase(),d),this._nTextureLoaded++,this._progressFn(.01+this._nTextureLoaded/this._sceneJson.textures.length/10,this._nTextureLoaded+"/"+this._sceneJson.textures.length),y.label=16;case 16:return s=o.next(),[3,7];case 17:return[3,20];case 18:return _=y.sent(),m={error:_},[3,20];case 19:try{s&&!s.done&&(v=o.return)&&v.call(o)}finally{if(m)throw m.error}return[7];case 20:return[2,a]}})})},e.prototype._getTextureIndex=function(e){for(var t=this._sceneJson.textures,r=0;r<t.length;r++)if(t[r].name===e)return r;return console.log("unused texture image: "+e),-1},e.prototype._createTexture=function(e,t,r){var i=this._model.name+"-"+t;this._model.releaseSourceData||this._resourceManager.addSourceImage(e,i);var n=this._binLoader.readTexture(r),a=this._samplers[n[1]],o=this._resourceManager.gl,s=4===n[0]?o.RGBA:o.RGB,l=this._resourceManager.createTexture(i);l.ready||(l.url=e.src,l.updateImage(e,s,o.UNSIGNED_BYTE,a.filter,a.wrap))},e.prototype._createBlankTexture=function(e,t){var r=this._model.name+"-"+e,i=this._binLoader.readTexture(t),n=this._samplers[i[1]],a=this._resourceManager.gl,o=this._resourceManager.createTexture(r),s=new Uint8Array([255,255,255,255]);o.ready||(o.url="blank",o.createFromArraybuffer(s,a.RGBA,a.UNSIGNED_BYTE,n.filter,n.wrap,1,1))},e.prototype._getDefaultView=function(e,t){var r,i;if(!e||!t)return null;try{for(var n=yo(e),a=n.next();!a.done;a=n.next()){var o=a.value;if(o.name===t)return!0===o.perspective?o:null}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}},e.prototype.beforeLoading=function(){this._model.state=H.LOADING},e.prototype.afterLoaded=function(){return!!this._model&&(this._model.useLoadingBox&&this._model.removeLoadingBox(this._renderScene),this._model.state=H.LOADED,!0)},e}(),bo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),wo=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},xo=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Mo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return bo(t,e),t.prototype.load=function(e,t,r,i,n,a,o,s){return wo(this,void 0,void 0,function(){var l;return xo(this,function(u){switch(u.label){case 0:return console.group("Loading model: "+this._model.name),console.time(this._model.name+" ModelLoading: "),this.onDownloadWarning=s,[4,this._generatePromises(this._model.name,t,r,e)];case 1:return l=u.sent(),this.beforeLoading(),console.group("Loading model: "+this._model.name),console.time(this._model.name+" ModelLoading: "),this._saveFilePromises(l),this._initProgressTracker(e),[4,this._loadSceneJson()];case 2:return u.sent(),[4,this._loadModelJson()];case 3:return u.sent(),this._setProgressTracker(),[4,this._loadLayers()];case 4:return u.sent(),[4,this._loadViews()];case 5:return u.sent(),[4,this._loadSceneBin()];case 6:return u.sent(),[4,this._loadModelBin()];case 7:return u.sent(),[4,this._loadExtendedMaterial()];case 8:return u.sent(),i(this._modelJson["model.bin"]),this._prepareBinLoader(),this._loadNodesAABB(),[4,this._loadTextures()];case 9:return u.sent(),[4,this._loadMeshes(o)];case 10:return u.sent(),[4,this._loadModelGraph()];case 11:return u.sent(),e(1),n(this._sceneJson),this.afterLoaded()?(a(this._modelJson),console.timeEnd(this._model.name+" ModelLoading: "),[2]):[2,Promise.resolve(!1)]}})})},t.prototype._generatePromisesLocal=function(e,t){return wo(this,void 0,void 0,function(){var r,i,n;return xo(this,function(a){return r={},n=(i=e||"./localmodel")+"/scene.json",r["scene.json"]=Qa.a.OpenFile1(n,"json",Promise),[2,r["scene.json"].downloadFile(function(e){t(e.loaded/e.total*.05)}).then(function(e){for(var t,n=e.data,a=0,o=n.textures.length;a<o;a++){var s=n.textures[a].name;t=i+"/"+s,r[s]=Qa.a.OpenImage(t,Promise)}return t=i+"/scene.bin",r["scene.bin"]=Qa.a.OpenFile1(t,"arraybuffer",Promise),t=i+"/model.bin",r["model.bin"]=Qa.a.OpenFile1(t,"arraybuffer",Promise),t=i+"/modelgraph.bin",r["modelgraph.bin"]=Qa.a.OpenFile1(t,"arraybuffer",Promise),t=i+"/uuid.bin",r["uuid.bin"]=Qa.a.OpenFile1(t,"arraybuffer",Promise),t=i+"/model.json",r["model.json"]=Qa.a.OpenFile1(t,"json",Promise),r["model.json"].downloadFile()}).then(function(e){for(var t=0,n=e.data.buffers.length;t<n;t++){var a=i+"/mesh"+t+".bin";r["mesh"+t+".bin"]=Qa.a.OpenFile1(a,"arraybuffer",Promise)}return Promise.resolve(r)})]})})},t.prototype._generatePromises=function(e,t,r,i){return wo(this,void 0,void 0,function(){return xo(this,function(n){return r instanceof Array?[2,Object(Ze.b)(e,r)]:t?[2,this._generatePromisesLocal(r,i)]:[2,Object(Ze.b)(e)]})})},t}(go),Eo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),To=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},So=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Eo(t,e),t.prototype.load=function(e,t,r,i,n,a,o,s,l,u){return To(this,void 0,void 0,function(){var e,c;return So(this,function(h){return e=new Mo(this,this._resourceManager,this._materialManager,t),(c=e.load(r,i,n,a,o,s,l,u)).then(function(){e.destroy(),e=null}),[2,c]})})},t}(Wa),Po=r(49),ko=r(55),Oo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Do=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},No=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Co=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Io=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Ro=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Io(arguments[t]));return e};var Bo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oo(t,e),t.prototype.loadModel=function(e,t,r,i,n){return Do(this,void 0,void 0,function(){var a,o,s,l,u,c,h,d,p;return No(this,function(f){return a=!1,function(e){return"object"==typeof e&&null!==e}(t)?(a=t.usePbr,r=r||t.changeCamera,o=t.cameraInfo,s=t.onProgress,p=void 0===s?function(){}:s,l=t.initialTransform,u=void 0===l?U.a.create():l,c=t.useLoadingBox,h=t.prefix,d=t.releaseSourceData,[2,this._load(e,u,p,r,a,o,i,n,c,h,d)]):(p=t||function(){},[2,this._load(e,U.a.create(),p,r,a,null,i,n,!1)])})})},t.prototype._load=function(e,t,r,n,a,o,s,l,u,c,h){return void 0===t&&(t=U.a.create()),void 0===u&&(u=!1),void 0===c&&(c=""),void 0===h&&(h=!0),Do(this,void 0,void 0,function(){var d,p,f,_,m,v;return No(this,function(y){switch(y.label){case 0:return(d=new Ao(e,t,this._resourceManager,this._materialManager,a,s)).useLoadingBox=u,d.releaseSourceData=h,d.prefix=c,t=t&&0!==t.length?t:U.a.create(),this.invalidate(),this.state=i.RENDERING,this._elapsedFrames=1,p=this,f=function(){o&&(o.fov=o.fov||46,p.setDefaultCam(o)),Object.getOwnPropertyNames(p._scene.core.models).length>0&&(p.initialLoaded=!1),p._scene.addModel(d,!1!==n&&p.initialLoaded,o),d.defaultView&&p._camera.core.restore(d.defaultView),p.notifyEventListener("loadingPhase1Done",d.name)},_=function(){p.hasProfileLines()&&p.setRenderingLinesEnabled(!1),p.hasCurveOrLine()&&p.setRenderingLinesEnabled(!0),p.onSceneChanged();var e=function(){p._camera.core.setCullingEnabled(!0),p._camera.core.removeUpdateStopListener(e)};p._camera.core.addUpdateStopListener(e),p.notifyEventListener("loadingPhase2Done")},m=function(e){p.notifyEventListener("BIMloaded");for(var t=e["model.bin"].nodes,r=0,i=0,n=e.buffers.length;i<n;i++)r+=e.buffers[i].byteLength;p._scene.core.nodes=t,p._scene.core.meshKbytes=Math.round(r/1024*100)/100,p._scene.core.initBimCullingNeeded()},v=function(){p.invalidate(),p._renderScene.refresh(),p._camera.core._updateProjection()},[4,d.load(e,this._renderScene,r,s,l,f,_,m,v,this.emitDownloadWarning.bind(this))];case 1:return y.sent(),this.onSceneChanged(),[2,this._bindViewerWithComment(e)]}})})},t.prototype._bindViewerWithComment=function(e){return Po.a.create=Po.c.bind(null,this),Po.a.activate=Po.b.bind(null,this),Promise.resolve(e)},t.prototype.setLayersTransparent=function(e,t,r){var i=this._scene.getModel(e);i&&i.setLayerTransparent(t,r)&&(this._renderScene.onSceneChanged(),this.invalidate())},t.prototype.translateElementsByCategory=function(e,t,r){var i=this,n=this._scene.getModel(e);n&&ko.a.getTreeInfo(e).then(function(e){var t,i,n=e.categories,a=[];try{for(var o=Co(Object.entries(n)),s=o.next();!s.done;s=o.next()){var l=Io(s.value,2),u=(l[0],l[1]);if(u.name==r)u.families.forEach(function(t){e.families[t].types.forEach(function(t){var r=e.types[t].elements;a.push.apply(a,Ro(r))})})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}return a}).then(function(e){var r=Object.keys(n.tree.elements).filter(function(t){return-1===e.indexOf(t)});i.enterExplodedView([e,r],[new Float32Array([0,0,t]),new Float32Array([0,0,0])])})},t.prototype.explodeByCategory=function(e,t){var r=this;this._scene.getModel(e)&&ko.a.getTreeInfo(e).then(function(e){var t,r,i=e.categories,n=new Array,a=function(t,r){var i=[];r.families.forEach(function(t){e.families[t].types.forEach(function(t){var r=e.types[t].elements;i.push.apply(i,Ro(r))})}),n.push(i)};try{for(var o=Co(Object.entries(i)),s=o.next();!s.done;s=o.next()){var l=Io(s.value,2);l[0];a(0,l[1])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n}).then(function(e){for(var i=new Array,n=0,a=e.length;n<a;n++){var o=new Float32Array([0,0,n*t]);i.push(o)}r.enterExplodedView(e,i),r._scene.core.updateBBox(P.a.aabb.createFromArray([r._scene.core.bbox[0],r._scene.core.bbox[1],r._scene.core.bbox[2],r._scene.core.bbox[3],r._scene.core.bbox[4],r._scene.core.bbox[5]+(e.length-1)*t])),r._camera.core._updateProjection()})},t}(Da),Lo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Fo=function(e){function t(t){var r=e.call(this,"morphing")||this;return r._speed=0,r._eventEmitter=t,r}return Lo(t,e),t.prototype._update=function(e){return!0},t.prototype.update=function(){var e=this._camera;return Math.abs(e._targetFov-e._fov)<Math.abs(this._speed)?(e._setFov(e._targetFov),e.updateVP(),e._cull.update(),this.detach(),this._eventEmitter&&this._eventEmitter.emit("Tour360-MorphingOver"),!1):(e._setFov(e._fov+this._speed),e.updateVP(),e._cull.update(),!0)},t.prototype.start=function(e,t,r,i){var n=this._camera;e&&(n._phi=n._targetPhi=e),t&&(n._theta=n._targetTheta=t),null!=r&&(r=P.a.clamp(r,1,170),n._fov=r),i&&(n._targetFov=i),this._fovDiff=n._targetFov-n._fov,this._speed=(n._targetFov-n._fov)/50},t.prototype.getProgress=function(){var e=this._camera;return(e._targetFov-e._fov)/this._fovDiff},t}(ar.a),Uo=r(52),Vo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),jo=function(e){function t(t){var r=e.call(this,"panorama")||this;return r._srcAt=U.d.create(),r._dstAt=U.d.create(),r._srcTheta=0,r._dstTheta=0,r._srcPhi=0,r._dstPhi=0,r._curTheta=0,r._curPhi=0,r._eventEmitter=t,r._startTime=0,r._duration=0,r._speed=15,r}return Vo(t,e),t.prototype._update=function(e){return!0},t.prototype.update=function(){var e=(new Date).getTime()-this._startTime;if(e>=this._duration)return e>3*this._duration?(this.stop(),this._eventEmitter&&this._eventEmitter.emit("Tour360-TransitionOver")):this._updateCamera(this._dstTheta,this._dstPhi)||(this.stop(),this._eventEmitter&&this._eventEmitter.emit("Tour360-TransitionOver")),!0;var t=e/this._duration;return this._curPhi=Uo.a.linear.scalar(this._srcPhi,this._dstPhi,t),this._curTheta=Uo.a.linear.scalar(this._srcTheta,this._dstTheta,t),this._updateCamera(this._curTheta,this._curPhi)},t.prototype.stop=function(){var e=this._camera;e._targetDistance=e._distance;var t=e.eye[0]-e._at[0],r=e.eye[1]-e._at[1],i=e.eye[2]-e._at[2];e._targetPhi=e._phi=Math.asin(Math.min(i/e._targetDistance,1)),e._targetPhi>=.49999*Math.PI&&(e._targetPhi=.49999*Math.PI),e._targetPhi<=-.49999*Math.PI&&(e._targetPhi=-.49999*Math.PI),e._targetTheta=e._theta=Math.atan2(r,t),e._firstPerson&&(e._targetPhi=e._phi=-e._targetPhi,e._targetTheta=e._theta=e._targetTheta+Math.PI),this.detach()},t.prototype.start=function(e){var t=this._camera;U.d.normalize(t._at,t._at),U.d.scale(t._at,t._at,15);var r=Math.atan2(t._at[1],t._at[0]);r<0&&(r+=2*Math.PI),t._targetTheta=t._theta=r,U.d.copy(this._srcAt,t._at);var i=U.d.clone(e);U.d.normalize(i,i),U.d.scale(i,i,15),U.d.copy(this._dstAt,i),this._srcTheta=t._theta,this._srcPhi=t._phi,this._dstTheta=Math.atan2(i[1],i[0]),this._dstTheta<0&&(this._dstTheta+=2*Math.PI);var n,a,o=this._dstTheta-this._srcTheta;Math.abs(o)>Math.PI&&(this._dstTheta-=2*Math.PI*Math.sign(o)),this._dstPhi=Math.asin(Math.min(i[2]/15,1)),this._dstPhi>=.49999*Math.PI&&(this._dstPhi=.49999*Math.PI),this._dstPhi<=-.49999*Math.PI&&(this._dstPhi=-.49999*Math.PI),n=Math.abs(this._srcTheta-this._dstTheta),a=Math.abs(this._srcPhi-this._dstPhi),n=Math.ceil(n/Math.PI*90),a=Math.ceil(a/Math.PI*90);var s=Math.max(n,a);return this._duration=s*this._speed,this._startTime=(new Date).getTime(),!0},t.prototype._updateCamera=function(e,t){var r=this._camera,i=Math.sin(t),n=Math.cos(t),a=Math.sin(e),o=Math.cos(e);r._targetAt[0]=n*o*r._distance,r._targetAt[1]=n*a*r._distance,r._targetAt[2]=i*r._distance,r._targetTheta=e,r._targetPhi=t;r._targetTheta,r._theta,r._targetPhi,r._phi;var s=r._targetEye[0]-r.eye[0],l=r._targetEye[1]-r.eye[1],u=r._targetEye[2]-r.eye[2],c=r._targetAt[0]-r._at[0],h=r._targetAt[1]-r._at[1],d=r._targetAt[2]-r._at[2],p=Math.abs(s)+Math.abs(l)+Math.abs(u)+Math.abs(c)+Math.abs(h)+Math.abs(d)>1e-4;return r.eye[0]+=.15*s,r.eye[1]+=.15*l,r.eye[2]+=.15*u,r._at[0]+=.15*c,r._at[1]+=.15*h,r._at[2]+=.15*d,r._distance=U.d.distance(r.eye,r._at),U.a.lookAt(r.viewMatrix,r.eye,r._at,[0,0,1]),U.a.multiply(r.vpMatrix,r.projectMatrix,r.viewMatrix),p},t.prototype.setTransitionSpeed=function(e){this._speed=e},t}(ar.a),zo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Go=function(e){function t(t,r){var i=e.call(this,t)||this,n=[0,0,i._viewer.getCanvas().width,i._viewer.getCanvas().height];return i.cores.push(new vr(null,n)),i.cores[0].setFirstPerson(!0),U.d.set(i.cores[0].eye,0,0,0),i.cores[1].setFirstPerson(!0),U.d.set(i.cores[1].eye,0,0,0),i._fov=78,i._FOV_CHANGE_SPEED=.3,i.cores[0].setTargetFov(i._fov),i.cores[0]._targetPhi=0,i.cores[0]._targetTheta=0,i.cores[1].setTargetFov(i._fov),i.cores[1]._targetPhi=0,i.cores[1]._targetTheta=0,i._animators=new Array(2),i._eventEmitter=r,i._animators[0]=new Fo(i._eventEmitter),i._animators[1]=new Fo(i._eventEmitter),i._transition=new jo(i._eventEmitter),i._transition.setTransitionSpeed(80),i}return zo(t,e),t.prototype.destroy=function(){this._animators[0].destroy(),this._animators[1].destroy(),this._animators=null,delete this._animators,e.prototype.destroy.call(this)},t.prototype.setFov=function(e){this.cores[0].setTargetFov(e),this.cores[1].setTargetFov(e),this._viewer&&this._viewer.invalidate()},t.prototype.resize=function(e,t){this.cores[0].setViewport([0,0,e,t]),this.cores[0].update(),this.cores[1].setViewport([0,0,e,t]),this.cores[1].update()},t.prototype.update=function(){var e=this.cores[0].update(),t=this.cores[1].update();return e||t},t.prototype.addInput=function(t){var r=this;(e.prototype.addInput.call(this,t),this._manipulator.addInput(t),this._manipulator.setCamera(this.cores),this._manipulator.setPanoramaEnabled(!0),"mouse"===t.name)&&t.addMouseWheelListener(function(e){var t=-e.delta*r._FOV_CHANGE_SPEED;return r._fov+=t,r._fov>180&&(r._fov=179.99999),r._fov<0&&(r._fov=.001),r.cores[0].setTargetFov(r._fov),r.cores[1].setTargetFov(r._fov),!0},"Camera360")},t.prototype.transit=function(e,t){var r=this.cores[e],i=this.cores[1-e],n=this._animators[e],a=this._animators[1-e];n.attach(r),n.start(null,null,null,10),a.attach(i),t?(i._targetFov=i._fov=t.fov,i._targetPhi=i._phi=t.phi,i._targetTheta=i._theta=t.theta,a.start(null,null,140,t.fov)):a.start(null,null,140,78),this._manipulator.setCamera(this.cores,1-e)},t.prototype.setView=function(e,t){var r=this.cores[e],i=this.cores[1-e];r._targetPhi=t.phi,r._phi=t.phi+.001,r._targetTheta=r._theta=t.theta,i._targetPhi=t.phi,i._phi=t.phi+.001,i._targetTheta=i._theta=t.theta},t.prototype.getCameraInfo=function(e){return{fov:this.cores[e]._targetFov,phi:this.cores[e]._targetPhi,theta:this.cores[e]._targetTheta,position:U.d.clone(this.cores[e]._at)}},t.prototype.moveTo=function(e,t){var r=new jo(this._eventEmitter);r.setTransitionSpeed(300),r.attach(this.cores[e]),r.start(t)},t}(Kr),Ho=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qo=function(){return function(e){this.id=e,this.ray={start:U.d.create(),direction:U.d.create()}}}(),Wo=function(e){function t(t,r,i,n){var a=e.call(this,t,r,i,n)||this;a._convergence=.1,a._separation=1,a._data={},a._leftSkyboxes=[],a._rightSkyboxes=[],a._morphingAnimators=[],a.morphing=!1,a._renderTarget=null,a._viewDirection=U.d.create(),a._current=0,a._currentAssetId="",a.orientation=s.a.isMobile?new pa:null,a._stereo=!1,a._convergence=.1,a._separation=1,a._camera=new Go(a,a._eventEmitter),a._morphingAnimators[0]=new Fo(a.getEventEmitter()),a._morphingAnimators[1]=new Fo(a.getEventEmitter()),s.a.isMobile?(a._camera.cores[0]._targetFov=a._camera.cores[0]._fov=78,a._camera.cores[0]._targetPhi=a._camera.cores[0]._phi=0,a._camera.cores[0]._targetTheta=a._camera.cores[0]._theta=0,a._camera.cores[0].animator=new Un,a._camera.cores[0].animator.bind(a._camera.cores[0]),a._camera.cores[1].animator=new Un,a._camera.cores[1].animator.bind(a._camera.cores[1])):(a._camera.cores[0].setTargetFov(78),a._camera.cores[0]._targetPhi=0,a._camera.cores[0]._targetTheta=0);var o=a.getWidth(),l=a.getHeight(),u=new Int32Array([0,0,o/2,l]),c=new Int32Array([0,0,o/2,l]);return a._leftCamera=new Cn(null,u),a._rightCamera=new Cn(null,c),a._renderTarget=new wr.a("default",a._resourceManager,a._canvas.width,a._canvas.height,{blend:!0,depthTest:!1}),a._leftCamera.setCullingEnabled(!1),a._rightCamera.setCullingEnabled(!1),a._leftSkyboxes[0]=new st.b(a._resourceManager),a._leftSkyboxes[0].setMode(st.a.SKYBOX_CUBEMAP),a._leftSkyboxes[1]=new st.b(a._resourceManager),a._leftSkyboxes[1].setMode(st.a.SKYBOX_CUBEMAP),a._rightSkyboxes[0]=new st.b(a._resourceManager),a._rightSkyboxes[0].setMode(st.a.SKYBOX_CUBEMAP),a._rightSkyboxes[1]=new st.b(a._resourceManager),a._rightSkyboxes[1].setMode(st.a.SKYBOX_CUBEMAP),a}return Ho(t,e),t.prototype.destroy=function(){this.state!==i.UNINITIALIZED&&(this.pause(),this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget,s.a.isMobile&&(this.orientation.detach(),this.orientation.destroy(),this.orientation=null),this._data=null,delete this._data,this._leftSkyboxes[0].destroy(),this._leftSkyboxes[1].destroy(),this._leftSkyboxes=null,delete this._leftSkyboxes,this._rightSkyboxes[0].destroy(),this._rightSkyboxes[1].destroy(),this._rightSkyboxes=null,delete this._rightSkyboxes,e.prototype.destroy.call(this))},t.prototype.switchPanorama=function(e,t,r){void 0===r&&(r=!0),this.state=i.INITIALIZED,r&&this._resetScene(t),this._currentAssetId=e,this._leftSkyboxes[this._current].setImage(this._data[this._currentAssetId].images),this.state=i.RENDERING},t.prototype.moveTo=function(e){this._camera.moveTo(this._current,e)},t.prototype.getCameraInfo=function(){return this._camera.getCameraInfo(this._current)},t.prototype.getCurrentCamera=function(){return this._camera.cores[this._current]},t.prototype.dumpScreen=function(e,t){e||t?t||(t=e*this._canvas.height/this._canvas.width):(e=this._canvas.width,t=this._canvas.height);var r=Math.floor(this._canvas.width/s.a.devicePixelRatio),i=Math.floor(this._canvas.height/s.a.devicePixelRatio),n=Math.floor(e/s.a.devicePixelRatio),a=Math.floor(t/s.a.devicePixelRatio);n===r&&a===i||this.resize(n,a),this._update(!0);var o=this._canvas.toDataURL("image/jpeg",.75);return n!==r||a!==i?this.resize(r,i):this.invalidate(),o},t.prototype._resetScene=function(e){var t=this._camera;s.a.isMobile&&e&&(e.phi=0),this.morphing?t.transit(this._current,e):t.setView(this._current,e),this._current=1-this._current},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this._camera.resize(this._canvas.width,this._canvas.height),this._renderTarget.resize(this._canvas.width,this._canvas.height),s.a.isMobile&&this.orientation.reset(this._camera.cores[this._current]),this.invalidate()},t.prototype._drawScene=function(){var e=this._camera,t=this.getWidth(),r=this.getHeight();this._stereo?(this._draw360VR(e.cores[this._current],t,r),this._detectVRIndicator(this._leftCamera,this._rightCamera)):(e.cores[this._current].animator instanceof Fo?(this._renderer.drawSkybox(this._renderTarget,this._leftSkyboxes[1-this._current],e.cores[1-this._current]),this._renderer.endFrame(),this._renderer.beginFrame(),this._leftSkyboxes[this._current].setTransparency(1-e.cores[this._current].animator.getProgress())):this.detectIndicator(e.cores[this._current]),e.cores[this._current].setViewport(new Int32Array([0,0,t,r])),this._renderer.drawSkybox(this._renderTarget,this._leftSkyboxes[this._current],e.cores[this._current]))},t.prototype.detectIndicator=function(e){},t.prototype._draw360VR=function(e,t,r){this._leftCamera.update(e,-this._convergence,.5*-this._separation),this._leftCamera.setViewport(new Int32Array([0,0,t/2,r])),this._renderer.drawSkybox(this._renderTarget,this._leftSkyboxes[this._current],this._leftCamera),this._rightCamera.update(e,this._convergence,.5*this._separation),this._rightCamera.setViewport(new Int32Array([t/2,0,t/2,r])),this._renderer.drawSkybox(this._renderTarget,this._rightSkyboxes[this._current],this._rightCamera)},t.prototype._update=function(e){void 0===e&&(e=!1),this.state===i.RENDERING&&(s.a.isMobile?this._stereo?this.orientation.update():(this._camera.cores[this._current].update(),this.orientation.update()):(this._camera.cores[0].update(),this._camera.cores[1].update()),this._renderer.beginFrame(),this._drawScene(),this._renderer.endFrame())},t.prototype.setOrientationEnable=function(e){this.orientation.setEnabled(e)},t.prototype.setVREnabled=function(e){this._stereo!==e&&(this._stereo=e,s.a.isMobile&&(this.orientation.setEnabled(e),this.orientation.modulate=!this._stereo))},t.prototype.setVRConvergence=function(e){this._convergence=e},t.prototype._setVRSeparation=function(e){this._separation=e},t.prototype._detectVRIndicator=function(e,t){var r=this._detect(e,.99),i=this._detect(t,.99);this._eventEmitter.emit("updatePanoramaVRIndicator",r,i)},t.prototype._detect=function(e,t){void 0===t&&(t=.607),U.d.set(this._viewDirection,-e.viewMatrix[2],-e.viewMatrix[6],-e.viewMatrix[10]);var r=[];for(var i in this._data){var n=(h=this._data[i]).ray?U.d.dot(h.ray.direction,this._viewDirection):0,a=h.ray?e.project(h.ray.start):[0,0];r.push({id:h.id,screenPosition:[a[0],a[1]],angle:n,visible:!!(n>t&&a[2]),focus:!1})}for(var o=-1,l=0,u=0,c=r.length;u<c;u++){var h;(h=r[u]).visible=h.visible&&h.screenPosition[0]>e.viewport[0]/s.a.devicePixelRatio&&h.screenPosition[0]<(e.viewport[0]+e.viewport[2])/s.a.devicePixelRatio&&h.screenPosition[1]>e.viewport[1]/s.a.devicePixelRatio&&h.screenPosition[1]<(e.viewport[1]+e.viewport[3])/s.a.devicePixelRatio,h.visible&&l<h.angle&&(l=h.angle,o=u)}return o>-1&&(r[o].focus=!0),r},t.prototype._setIndicators=function(e){this._data={};for(var t=0;t<e.length;t++){var r=e[t].id;this._data[r]=new qo(r),U.d.copy(this._data[r].ray.start,e[t].position),U.d.normalize(this._data[r].ray.direction,this._data[r].ray.start)}},t}(Da),Qo=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},Yo=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Xo=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Zo=function(){function e(e,t){this._data=e,this._viewer=t}return e.prototype.load=function(e,t,r,i,n,a){return Qo(this,void 0,void 0,function(){var e,t,o,s,l,u,c,h,d,p,f,_,m;return Yo(this,function(v){switch(v.label){case 0:console.group("Loading panoramas "),e=1,v.label=1;case 1:v.trys.push([1,6,7,8]),t=Xo(r),o=t.next(),v.label=2;case 2:if(o.done)return[3,5];if(s=o.value,(l=this._data[s]).ready)return[2];if("cubemaps"!==l.type)throw Error("Unsupported panorama file types!");for(u=[],c=0;c<l.imageUrls.length;c++)h=l.imageUrls[c].split("/"),d={filename:h[h.length-1],url:l.imageUrls[c]},u.push(Object(Ze.a)(s,d));return[4,Promise.all(u)];case 3:if(p=v.sent(),l.images=p.slice(0),l.ready=!0,a(e/r.length,s),i(),this._viewer.isUninitialized())return[2];if(this._viewer.isPaused())return[2];e++,v.label=4;case 4:return o=t.next(),[3,2];case 5:return[3,8];case 6:return f=v.sent(),_={error:f},[3,8];case 7:try{o&&!o.done&&(m=t.return)&&m.call(t)}finally{if(_)throw _.error}return[7];case 8:return n(),[2]}})})},e}(),Ko=r(15),Jo=r(59),$o=r.n(Jo);var es=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},ts=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},rs=function(e){return es(void 0,void 0,void 0,function(){var t,r,i;return ts(this,function(n){switch(n.label){case 0:return[4,Object(Ko.a)().query({query:$o.a,variables:{assetId:e}})];case 1:if(t=n.sent(),r=t.data,i=t.errors,!r.asset)throw Error("asset does not exist");if(i)throw Error(i[0].message);return[2,function(e){if(!e.downloadUrls)throw Error("get download url for "+e.name+" failed");return{id:e.id,name:e.name,status:e.status,type:e.type,downloadUrl:e.downloadUrls[0].url,convertedUrls:e.convertedUrls?e.convertedUrls.map(function(e){return{filename:e.filename,url:e.url}}):null,panoConvertedUrl:e.panoConvertedUrl?e.panoConvertedUrl:null,updatedAt:e.updatedAt}}(r.asset)]}})})},is=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ns=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},as=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};var os=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return is(t,e),t.prototype.loadPanos=function(e,t){return ns(this,void 0,void 0,function(){var r,i,n,a,o,s,l=this;return as(this,function(u){switch(u.label){case 0:return!function(e){return"object"==typeof e&&null!==e}(t)?r=t:(r=t.onProgress,i=t.onIndicatorsUpdate,n=t.resolution),r||(r=function(){}),e.indicators||(e.indicators=[]),e.annotations||(e.annotations=[]),[4,Promise.all(e.panoIds.map(function(e){return rs(e)}))];case 1:return(a=u.sent()).forEach(function(e){if(!e.panoConvertedUrl)throw Error("asset "+e.id+" is not a panorama image")}),[4,Promise.all(a.map(function(e){return ee.a.get(e.panoConvertedUrl)}))];case 2:return o=u.sent(),s={},o.forEach(function(e,t){var r=[],i=e.data,o=Object.keys(i);o.forEach(function(e){if(e.startsWith("1024_left")?r.push(1024):e.startsWith("2048_left")?r.push(2048):e.startsWith("4096_left")&&r.push(4096),!r.length)throw Error("asset "+a[t].id+" image urls error");if(n&&!r.includes(n))throw Error("resolution not valid");n||(n=r[r.length-1]),s[a[t].id]={imageUrls:o.filter(function(e){return e.startsWith(n+"")}).map(function(e){return i[e]}),images:[],name:a[t].name,ready:!1,toAssets:[],type:"cubemaps"}})}),e.indicators.forEach(function(e,t){s[e.from].toAssets.push({id:"indicator-"+t,type:"panorama",assetId:e.to,camera:e.camera,position:e.position,fromAsset:e.from})}),e.annotations.forEach(function(e,t){s[e.from].toAssets.push({id:"annotation-"+t,type:"annotation",fromAsset:e.from,position:e.position})}),this.getEventEmitter().on("updatePanoramaIndicator",function(t){i&&i(t.map(function(t,r){return t.annotation?{position:t.screenPosition,visible:t.visible,annotation:t.annotation}:{from:e.indicators[r].from,to:t.assetId,camera:e.indicators[r].camera,position:t.screenPosition,visible:t.visible,name:t.name||s[t.assetId].name}}))}),[2,new Promise(function(t,i){l._load360(s,e.panoIds,t,i,r)})]}})})},t.prototype.loadPano=function(e,t){return ns(this,void 0,void 0,function(){return as(this,function(r){return[2,this.loadPanos({panoIds:[e],indicators:[],annotations:[]},t)]})})},t.prototype._load360=function(e,t,r,n,a){var o=this;this._data=e,new Zo(this._data,this).load(null,{},t,function(){var e=t[0];o._data[e].ready&&(o._currentAssetId=t[0],o._leftSkyboxes[0].setImage(o._data[e].images)),o.state=i.RENDERING},function(){o.invalidate(),r()},function(e,t){a(e,t)}).catch(function(e){n(e)})},t.prototype.detectIndicator=function(e,t){if(void 0===t&&(t=.607),U.d.set(this._viewDirection,-e.viewMatrix[2],-e.viewMatrix[6],-e.viewMatrix[10]),this._data[this._currentAssetId]){for(var r=[],i=0;i<this._data[this._currentAssetId].toAssets.length;i++)if(this._data[this._currentAssetId].ready){var n=this._data[this._currentAssetId].toAssets[i],a=U.d.clone(n.position);U.d.normalize(a,a);var o=U.d.dot(a,this._viewDirection),s=e.project(n.position);"panorama"===n.type?r.push({assetId:n.assetId,name:this._data[n.assetId].name,screenPosition:[s[0],s[1]],visible:!!(o>t&&s[2])}):r.push({annotation:n,screenPosition:[s[0],s[1]],visible:!!(o>t&&s[2])})}this._eventEmitter.emit("updatePanoramaIndicator",r)}},t}(Wo),ss=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ls=function(e){function t(t){var r=e.call(this,t,t.getMaterialManager())||this;return r.cores.push(new er(t.getResourceManager(),t.getMaterialManager())),r}return ss(t,e),t.prototype.addPawnViewport=function(e,t){var r=this;this.cores[e].addPawn(t),t.drawables.forEach(function(t){r._viewer.getRenderScene()[e].addDrawable(t)}),this._viewer.invalidate()},t.prototype.addModelViewport=function(e,t){var r=this;this.cores[e].addModel(t),t.drawables.forEach(function(t){r._viewer.getRenderScene()[e].addDrawable(t)}),this._viewer.invalidate()},t}(ir),us=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),cs=function(e){function t(t){var r=e.call(this,t)||this;return r._horizontal=!0,r._percentage=.5,r._viewports=new Array(2),r._viewports[0]=new Uint32Array(4),r._viewports[1]=new Uint32Array(4),r.cores.push(new vr(r._scene.cores[1],r._viewports[1])),r._updateViewports(),r}return us(t,e),t.prototype.destroy=function(){this._viewports=null,delete this._viewports,e.prototype.destroy.call(this)},t.prototype.setSplitPercentage=function(e){this._percentage=e,this._updateViewports()},t.prototype.setSplitHorizontal=function(e){this._horizontal=e,this._updateViewports()},t.prototype.setFov=function(e){this.cores[0].setTargetFov(e),this.cores[1].setTargetFov(e),this._viewer&&this._viewer.invalidate()},t.prototype.resize=function(e,t){this._updateViewports(),this.cores[0].setViewport(this._viewports[0]),this.cores[0].update(),this.cores[1].setViewport(this._viewports[1]),this.cores[1].update()},t.prototype.update=function(){var e=this.cores[0].update(),t=this.cores[1].update();return e||t},t.prototype.addInput=function(t){e.prototype.addInput.call(this,t),this._manipulator||(this._manipulator=new Xr(this._viewer)),this._manipulator.setCamera(this.cores),this._manipulator.addInput(t)},t.prototype.transformToPerspective=function(){this.cores[0].transformOrthogonalToPerspective(),this.cores[1].transformOrthogonalToPerspective(),this._viewer&&this._viewer.invalidate()},t.prototype.transformToOrthogonal=function(){this.cores[0].transformPerspectiveToOrthogonal(),this.cores[1].transformPerspectiveToOrthogonal(),this._viewer&&this._viewer.invalidate()},t.prototype._updateViewports=function(){var e=this._viewer.getCanvas().width,t=this._viewer.getCanvas().height;this._horizontal?(this._viewports[0][0]=0,this._viewports[0][1]=0,this._viewports[0][2]=Math.round(e*this._percentage),this._viewports[0][3]=t,this._viewports[1][0]=this._viewports[0][2],this._viewports[1][1]=0,this._viewports[1][2]=Math.round(e*(1-this._percentage)),this._viewports[1][3]=t):(this._viewports[0][0]=0,this._viewports[0][1]=0,this._viewports[0][2]=e,this._viewports[0][3]=Math.round(t*this._percentage),this._viewports[1][0]=0,this._viewports[1][1]=this._viewports[0][3],this._viewports[1][2]=e,this._viewports[1][3]=Math.round(t*(1-this._percentage))),this.cores[0].setViewport(this._viewports[0]),this.cores[1].setViewport(this._viewports[1])},t}(Kr),hs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ds=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},ps=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};var fs=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._scene=new ls(i),i._camera=new cs(i),i._renderScenes=[],i._renderScenes.push(new gn(i._scene.cores[0],i._camera.cores[0],i._resourceManager,i._renderer)),i._renderScenes.push(new gn(i._scene.cores[1],i._camera.cores[1],i._resourceManager,i._renderer)),i._renderScenes[0].setScissorEnabled(!0),i._renderScenes[1].setScissorEnabled(!0),i._material=i._materialManager.createMaterialOverride("select-elements-other"),i._material.setUseTransparent(!1),i._update(!0),i}return hs(t,e),t.prototype.destroy=function(){this._renderScenes[0].destroy(),this._renderScenes[1].destroy(),this._renderScenes=null,delete this._renderScenes,this._camera.destroy(),this._camera=null,delete this._camera,e.prototype.destroy.call(this)},t.prototype.resize=function(t,r){this._paused||(e.prototype.resize.call(this,t,r),this.invalidate())},t.prototype.loadModelAtViewport=function(e,t,r){return ds(this,void 0,void 0,function(){var i,n,a,o;return ps(this,function(s){return((t=t||0)<0||t>1)&&console.error("Invalid viewport index. Maximum 2 viewports are supported."),function(e){return"object"==typeof e&&null!==e}(r)?(i=r.onProgress,o=void 0===i?function(){}:i,n=r.initialTransform,a=void 0===n?[]:n,[2,this._loadToViewport(e,t,a,o)]):(o=r||function(){},[2,this._loadToViewport(e,t,[],o)])})})},t.prototype._loadToViewport=function(e,t,r,n){return ds(this,void 0,void 0,function(){var a,o,s,l=this;return ps(this,function(u){return r&&0!==r.length||(r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),a=new Ao(e,r,this._resourceManager,this._materialManager),o=this,s=this._renderScenes[t],[2,a.load(e,s,n,!1,null,function(){o._scene.addModelViewport(t,a)},function(){o.hasProfileLines()&&o.setRenderingLinesEnabled(!1),o.hasCurveOrLine()&&o.setRenderingLinesEnabled(!0),s.onSceneChanged(-1),s.optimize();var e=function(){o._camera.core.setCullingEnabled(!0),o._camera.core.removeUpdateStopListener(e)};o._camera.core.addUpdateStopListener(e)},function(e){for(var t=e["model.bin"].nodes,r=0,i=0,n=e.buffers.length;i<n;i++)r+=e.buffers[i].byteLength;o._scene.core.nodes=t,o._scene.core.meshKbytes=Math.round(r/1024*100)/100,o._scene.core.initBimCullingNeeded()},function(e){o.invalidate(),o._renderScene.refresh(),o._camera.core._updateProjection()}).then(function(){return l.state=i.RENDERING,l._elapsedFrames=1,l._renderScenes[t].optimize(),l._camera.cores[t].setCullingEnabled(!0),Promise.resolve(e)})]})})},t.prototype._update=function(e){void 0===e&&(e=!1),!e&&this.state!==i.RENDERING||void 0===this._renderScenes||(this._camera.update()&&(this._renderScenes[0].refreshRendering(1),this._renderScenes[1].refreshRendering(1)),this._renderer.beginFrame(),this._renderer.invalidate(),this._renderScenes[0].draw(),this._renderer.invalidate(),this._renderScenes[1].draw(),this._renderer.present(this._renderScene.getRenderTarget().getFramebuffer()),this._renderer.endFrame(),this._elapsedFrames++)},t.prototype.focusElementsInViewport=function(e,t,r,i){this._renderScenes[e].setOverridedMaterials({all:this._material}),this._material.setDiffuse([1,1,1]),this._material.setTransparent(.4),this._renderScenes[e].renderElements(t,i,!1),r&&this.focusElements(t)},t}(Da),_s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ms=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},vs=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ys=function(e){function t(t,r){return e.call(this,t,r)||this}return _s(t,e),t.prototype.loadModel=function(t,r,i,n,a){return ms(this,void 0,void 0,function(){var o=this;return vs(this,function(s){return[2,e.prototype.loadModel.call(this,t,r,i,n,a).then(function(e){o.setBackgroundColor([26/255,26/255,55/255,1]);var t=o._resourceManager.getShader("dark",[]);if(!t.ready){var r=k.a.dark;t.createFromShaderSource(r,[])}return o._renderScene.setOverridedShaders(t),o.setEffectEnabled("Sketch",!0),o.setEffectParameter("Sketch","color",[81/255,185/255,1]),o.setEffectParameter("Sketch","colored",!1),o.setEffectParameter("Sketch","surfaceColor",[.2,145/255,1,.2]),o.setEffectParameter("Sketch","transparents",!0),o.setEffectParameter("Sketch","useDepthMask",!1),o.setSpecularEnabled(!0),o.setEffectEnabled("SSAO",!0),o.setEffectParameter("SSAO","transparents",!0),Promise.resolve(e)})]})})},t}(Bo),gs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),bs=function(e){function t(t,r){var i=e.call(this,t,null,null,null,null)||this;i._resourceManager=r;var n=r.getShader("gizmo2d",[]);n.ready||n.createFromShaderSource(k.a.constant2d,[]);var a=new ei("");return a.attachShader(n,i._resourceManager),i.shader=n,i.material=a,i._textured=!1,i}return gs(t,e),t.prototype.destroy=function(){this._textured=null,delete this._textured,this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.setColor=function(e){this._textured&&(this.shader=this._resourceManager.getShader("gizmo2d",[]),this.shader.ready||this.shader.createFromShaderSource(k.a.constant2d,[]),this.material.attachShader(this.shader),this._textured=!1),this.material.parameters.uColor.value=e},t.prototype.setTransparent=function(e){console.warn("not supported yet."),this._textured&&(this.shader=this._resourceManager.getShader("gizmo2d",[]),this.shader.ready||this.shader.createFromShaderSource(k.a.constant2d,[]),this.material.attachShader(this.shader),this._textured=!1)},t.prototype.setTexture=function(e){this._textured||(this.shader=this._resourceManager.getShader("blit",["MODEL_TRANSFORM"]),this.shader.ready||this.shader.createFromShaderSource(k.a.blit,["MODEL_TRANSFORM"]),this.material.attachShader(this.shader),this._textured=!0),this.material.setTexture(e)},t}(D.a),ws=function(){function e(e,t,r,i){this._dashed=i,this._lineWidth=Math.floor(3*s.a.devicePixelRatio);var n=t.getMesh("line_mesh_"+e);if(n.createQuad(!1),this._drawable=new bs(n,t),this._drawable.setColor(r),this._dashed){this._vertices=new Float32Array(240),this._indices=new Uint8Array(120);for(var a=0;a<20;++a)this._indices[0+6*a]=0+4*a,this._indices[1+6*a]=1+4*a,this._indices[2+6*a]=2+4*a,this._indices[3+6*a]=2+4*a,this._indices[4+6*a]=3+4*a,this._indices[5+6*a]=0+4*a}else this._vertices=new Float32Array(12),this._indices=new Uint8Array(6),this._indices[0]=0,this._indices[1]=1,this._indices[2]=2,this._indices[3]=2,this._indices[4]=3,this._indices[5]=0;for(a=0;a<this._vertices.length;++a)this._vertices[a]=-1e6;this._drawable.mesh.update(this._vertices,this._indices,te.a.UNSIGNED_BYTE)}return e.prototype.render=function(e,t,r){t.drawDrawable(e,this._drawable,r,null,null,null,!1)},e.prototype._addQuad=function(e,t,r,i,n,a,o){var s=r-e,l=i-t,u=Math.atan2(s,l),c=Math.sign(s*l)||1,h=Math.sin(u)*this._lineWidth*.5/o*c,d=Math.cos(u)*this._lineWidth*.5/a*c;e=e/a*2-1,r=r/a*2-1,t=t/o*2-1,i=i/o*2-1,this._vertices[0+n]=e-d,this._vertices[1+n]=t+h,this._vertices[3+n]=e+d,this._vertices[4+n]=t-h,this._vertices[6+n]=r+d,this._vertices[7+n]=i-h,this._vertices[9+n]=r-d,this._vertices[10+n]=i+h,this._vertices[2+n]=0,this._vertices[5+n]=0,this._vertices[8+n]=0,this._vertices[11+n]=0},e.prototype.updateVertices=function(e,t,r,i,n,a){var o=e,l=r,u=t,c=i;o*=s.a.devicePixelRatio,u=a-1-u*s.a.devicePixelRatio;var h=(l*=s.a.devicePixelRatio)-o,d=(c=a-1-c*s.a.devicePixelRatio)-u;if(this._dashed)for(var p=0;p<20;p++){var f=o+h/39*2*p,_=u+d/39*2*p,m=f+h/39,v=_+d/39;this._addQuad(f,_,m,v,12*p,n,a)}else this._addQuad(o,u,l,c,0,n,a);this._drawable.mesh.update(this._vertices,this._indices,te.a.UNSIGNED_BYTE)},e.prototype.setLineWidth=function(e){this._lineWidth=Math.floor(Math.min(e,1)*s.a.devicePixelRatio)},e.prototype.destroy=function(){this._drawable.destroy(),this._vertices=null,this._indices=null},e}();function xs(e){void 0===e&&(e="#6092e2");var t=document.createElement("div");return t.style.width="16px",t.style.width="16px",t.style.height="16px",t.style.borderRadius="100%",t.style.pointerEvents="none",t.style.backgroundColor=e,t.style.position="absolute",t.style.top="-8px",t.style.left="-10px",t.style.transform="translate(0, 0)",t.style.borderWidth="3px",t.style.display="none",t.style.borderColor=e,t}function Ms(e,t){t?(e.style.display="block",e.style.transform="translate("+t.pos[0]+"px, "+t.pos[1]+"px)","boolean"==typeof t.isSnapped&&(t.isSnapped?(e.style.backgroundColor="transparent",e.style.border="3px solid #f75223"):e.style.backgroundColor="#f75223")):e.style.display="none"}function Es(e){void 0===e&&(e="red");var t=document.createElement("div");return t.style.fontSize="14px",t.style.lineHeight="14px",t.style.height="14px",t.style.width="60px",t.style.pointerEvents="none",t.style.position="absolute",t.style.color=e,t.style.transformOrigin="center",t.style.left="0",t.style.top="-7px",t.style.padding="0 10px",t}function Ts(e,t){t?(t.pos?(e.style.display="block",e.style.transform="translate("+t.pos[0]+"px, "+t.pos[1]+"px)"):e.style.display="none",t.value&&(e.innerText=t.value),t.color&&(e.style.color=t.color)):e.style.display="none"}var Ss,As=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2,(e[2]+t[2])/2]},Ps=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ks=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Os=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ks(arguments[t]));return e},Ds=function(e){function t(t,r){var i=e.call(this,t,!0,r)||this;i._rtLine=null,i._rtLinePR=null,i._updateSnapping=function(){i._viewer.invalidate(),i._snapping&&i._snapping.update(i._renderer,i._scene,i._camera)},i._vertices=[],i._lines=[],i._subLines=[],i._snapCoord=[0,0],i._depthQuery=new br.a(i._scene,i._resourceManager),i._rtLine=i._getRenderTarget({depthTest:!1}),i._rtLinePR=i._getRenderTargetPR({depthTest:!1}),i._clippingEnabled=i._scene.clipping.isEnabled(),i._snappingEnabled=!s.a.isMobile,i._snapping=null,i._lineColor=[.969,.398,.238],i._clicks=0,i._finished=!1,i._smartCullingEnabled=!1,i._unit="feet",i._scaling=1,i._lastEventName="",i._lastEventObject=null,i._lastAnchorUpdates=[];r.getCanvas();return i._overlays=function(){var e=document.createElement("div");return e.setAttribute("id","modelo-measure-overlays"),e.style.position="relative",e.style.left="0px",e.style.top="-100%",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.overflow="hidden",e}(),i._mouseAnchor=xs("#f75223"),i._anchorPoints=[xs(),xs(),xs()],i._anchorValues=[Es(),Es(),Es()],i._overlays.appendChild(i._mouseAnchor),i}return Ps(t,e),Object.defineProperty(t.prototype,"overlays",{get:function(){return this._overlays},enumerable:!1,configurable:!0}),t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.destroy=function(){this._rtLine=null,delete this._rtLine,this._rtLinePR=null,delete this._rtLine;for(var e=0;e<this._lines.length;e++)this._lines[e].destroy();this._lines=null,delete this._lines;for(e=0;e<this._subLines.length;e++)this._subLines[e].destroy();this._subLines=null,delete this._subLines,this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery,this._vertices=null,delete this._vertices,this._overlays.remove(),this._overlays=null,delete this._overlays,this._anchorPoints=null,delete this._anchorPoints,this._anchorValues=null,delete this._anchorValues,this._mouseAnchor=null,delete this._mouseAnchor,this._lastEventObject=null,delete this._lastEventObject,this._lastAnchorUpdates=null,delete this._lastAnchorUpdates},t.prototype.resize=function(e,t){this._snapping&&this._snapping.resize(e,t)},t.prototype._reset=function(){this._viewer.invalidate();for(var e=0;e<this._lines.length;e++)this._lines[e]._drawable.mesh.destroy(),this._lines[e].destroy();this._lines=[],this._vertices=[],this._clicks=0,this._finished=!1,this._notifyResult("Measure-Update",{distance:0,x:0,y:0,z:0,angle:0,area:0})},t.prototype._recompileShader=function(){if(this._scene.clipping.isEnabled()!==this._clippingEnabled){this._clippingEnabled=this._scene.clipping.isEnabled();var e=[];Tr.a.compressNormals&&e.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&e.push("DOUBLESIDED"),this._depthQuery.recompileShader(this._resourceManager,e),this._snapping&&this._snapping.recompileShader(this._resourceManager,e)}},t.prototype._updateMouseAnchor=function(e){this._viewer.invalidate(),Ms(this._mouseAnchor,e)},t.prototype._hideMouseAnchor=function(){this._viewer.invalidate(),Ms(this._mouseAnchor,null)},t.prototype._updateAnchorPoints=function(e){if(void 0===e&&(e=[]),this._viewer.invalidate(),e.length>this._anchorPoints.length){var t=xs();this._overlays.appendChild(t),this._anchorPoints.push(t)}this._anchorPoints.forEach(function(t,r){e[r]?Ms(t,{pos:e[r]}):Ms(t,null)})},t.prototype._hideAnchorPoints=function(){this._viewer.invalidate(),this._anchorPoints.forEach(function(e){Ms(e,null)})},t.prototype._updateAnchorValues=function(e){void 0===e&&(e=[]),this._viewer.invalidate(),this._anchorValues.forEach(function(t,r){e[r]&&Ts(t,e[r])});var t=e.filter(function(e){return!!e.value}).map(function(e){return{value:e.value}});t.length>0&&(this._lastAnchorUpdates=t)},t.prototype._hideAnchorValues=function(){this._viewer.invalidate(),this._anchorValues.forEach(function(e){Ts(e,null)})},t.prototype._projectLineSegmentToScreen=function(e,t,r,i){var n=this._camera.getViewDirection(),a=-U.d.dot(n,this._camera.eye);U.d.copy(r,e),U.d.copy(i,t);var o=U.d.dot(r,n)+a,s=U.d.dot(i,n)+a,l=U.d.create();if(o>0||s>0){if(o<0){U.d.subtract(l,r,i);var u=(.001-a-U.d.dot(i,n))/U.d.dot(l,n);U.d.scaleAndAdd(r,i,l,u)}if(s<0){U.d.subtract(l,i,r);u=(.001-a-U.d.dot(r,n))/U.d.dot(l,n);U.d.scaleAndAdd(i,r,l,u)}var c=this._camera.project(r);r[0]=c[0],r[1]=c[1];var h=this._camera.project(i);return i[0]=h[0],i[1]=h[1],!0}return!1},t.prototype.setSnappingEnabled=function(e){e&&s.a.isMobile?console.warn("Sanpping is not support on mobile."):(this._snappingEnabled=e,this._viewer.invalidate())},t.prototype._onEnableChanged=function(){var e=this;if(!this._enabled)return this._camera.removeUpdateStopListener(this._updateSnapping),this._reset(),this._viewer.setSmartCullingEnabled(this._smartCullingEnabled),this._overlays.remove(),void Os(this._anchorPoints,this._anchorValues).forEach(function(e){e.remove()});this._snapping=s.a.isMobile?null:this._viewer.getSnapping(),this._camera.addUpdateStopListener(this._updateSnapping),this._recompileShader(),this._camera.setBimCullingEnabled(!1),this._updateSnapping(),this._smartCullingEnabled=this._viewer.isSmartCullingEnabled(),this._viewer.setSmartCullingEnabled(!1),this._viewer.getCanvas().insertAdjacentElement("afterend",this._overlays),Os(this._anchorPoints,this._anchorValues).forEach(function(t){e._overlays.appendChild(t)})},t.prototype.setLineColor=function(e){this._lineColor[0]=e[0],this._lineColor[1]=e[1],this._lineColor[2]=e[2]},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},this.name),e.addMouseWheelListener(function(e){return t._onMouseWheel(e)},this.name),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},this.name),e.addMouseUpListener(function(e){return t._onMouseUp(e)},this.name)},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchMoveListener(function(e){return t._onTouchMove(e)},this.name),e.addTouchStopListener(function(e){return t._onTouchStop(e)},this.name),e.addTouchStartListener(function(e){return t._onTouchStart(e)},this.name)},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyUpListener(function(e){return t._onKeyUp(e)},this.name)},t.prototype.setUnit=function(e){var t=this,r=e!==this._unit,i=this._scaling;switch(e){case"m":this._unit="m",this._scaling=.3048;break;case"cm":this._unit="cm",this._scaling=30.48;break;case"mm":this._unit="mm",this._scaling=304.8;break;case"feet":this._unit="feet",this._scaling=1;break;case"inches":this._unit="inches",this._scaling=12;break;default:console.log('Unsupported length unit! Please use either "feet", "inches", "cm" or "m"')}if(r&&""!==this._lastEventName){var n=this._scaling/i,a=this._lastEventObject;a.distance&&(a.distance*=n,a.distance=a.distance.toFixed(2)),a.x&&(a.x*=n,a.x=a.x.toFixed(2)),a.y&&(a.y*=n,a.y=a.y.toFixed(2)),a.z&&(a.z*=n,a.z=a.z.toFixed(2)),this._viewer.getEventEmitter().emit(this._lastEventName,a),this._anchorValues.forEach(function(e,r){if(t._lastAnchorUpdates[r]){var i=t._lastAnchorUpdates[r];i.value&&(i.value*=n,i.value=i.value.toFixed(2)),Ts(e,i)}}),this._render()}},t.prototype.getUnit=function(){return this._unit},t.prototype._convertArea=function(e){return e*(this._scaling*this._scaling)},t.prototype._convertLength=function(e){return e*this._scaling},t.prototype._onKeyUp=function(e){return!1},t.prototype._onMouseDown=function(e){return!!this._enabled&&(this._recompileShader(),!0)},t.prototype._onMouseWheel=function(e){return this._enabled,!1},t.prototype._onMouseMove=function(e){return!1},t.prototype._onMouseUp=function(e){return!1},t.prototype._onTouchStart=function(e){return!1},t.prototype._onTouchMove=function(e){return!1},t.prototype._onTouchStop=function(e){return!1},t.prototype._notifyResult=function(e,t){this._viewer.getEventEmitter().emit(e,t),this._lastEventName=e,this._lastEventObject=t},t.prototype.onSceneChanged=function(){this._snapping&&this._snapping.onSceneChanged(this._scene)},t}(gr.a),Ns=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Cs=[0,0],Is=[0,0],Rs=function(e){function t(t){var r=e.call(this,"MeasureLine",t)||this;return r._perimeter=0,r}return Ns(t,e),t.prototype.destory=function(){e.prototype.destroy.call(this)},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype.getPerimeter=function(){return this._perimeter},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._clicks%2==1&&U.d.copy(this._vertices[1],this._vertices[0]),this._hideMouseAnchor(),!1)},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._clicks%2==1&&U.d.copy(this._vertices[1],this._vertices[0]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snappingEnabled){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}if(this._clicks%2==1){var a=this._camera.unproject(r,i);this._vertices.length>0&&U.d.copy(this._vertices[1],a)}this._needUpdate=!!(this._clicks%2)}return!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),this._viewer.invalidate(),t.button===t.RIGHT_BUTTON)return this._perimeter=0,this._reset(),!1;0===this._clicks&&this._viewer.getEventEmitter().emit("rulerupdate",{distance:0,x:0,y:0,z:0}),this._clicks++;var r=t.x,i=t.y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLine(r,i,n),this._viewer.setProgressiveRendering(),!0):t.button===t.LEFT_BUTTON?(this._perimeter=0,this._reset(),!1):(this._clicks--,!1)},t.prototype._updateLine=function(e,t,r){if(this._clicks%2==0){U.d.copy(this._vertices[1],r),this._vertices[2][0]=this._vertices[0][0],this._vertices[2][1]=this._vertices[0][1],this._vertices[2][2]=this._vertices[1][2],this._vertices[3][0]=this._vertices[0][0],this._vertices[3][1]=this._vertices[1][1],this._vertices[3][2]=this._vertices[1][2],this._perimeter=U.d.distance(this._vertices[0],this._vertices[1]);var i=this._convertLength(this._vertices[1][0]-this._vertices[0][0]),n=this._convertLength(this._vertices[1][1]-this._vertices[0][1]),a=this._convertLength(this._vertices[1][2]-this._vertices[0][2]);this._notifyResult("Measure-Update",{distance:this._convertLength(this._perimeter),x:Math.abs(i),y:Math.abs(n),z:Math.abs(a)}),this._updateAnchorValues([{value:i,color:"red"},{value:n,color:"limegreen"},{value:a,color:"blue"}].map(function(e){return{value:Math.abs(e.value).toFixed(2),color:e.color}}))}else{this._vertices=[];for(var o=0;o<4;o++)this._vertices[o]=U.d.clone(r);this._lines[0]=new ws("line_0",this._resourceManager,this._lineColor,!1),this._lines[1]=new ws("line_1",this._resourceManager,[0,0,1],!0),this._lines[2]=new ws("line_2",this._resourceManager,[0,1,0],!0),this._lines[3]=new ws("line_3",this._resourceManager,[1,0,0],!0),this._notifyResult("Measure-Update",{distance:0,x:0,y:0,z:0})}},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(e.prototype._onTouchStop.call(this,t),Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;this._clicks++;var r=t.cursor(0).x,i=t.cursor(0).y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLine(r,i,n),!0):(this._clicks--,!1)},t.prototype._render=function(){if(0===this._vertices.length)return this._hideAnchorPoints(),void this._hideAnchorValues();this._projectLineSegmentToScreen(this._vertices[0],this._vertices[1],Cs,Is)&&(this._lines[0].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[0].render(this._rtLine,this._renderer,this._camera)),this._clicks%2==0&&(this._projectLineSegmentToScreen(this._vertices[0],this._vertices[2],Cs,Is)&&(this._lines[1].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[1].render(this._rtLine,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[2],this._vertices[3],Cs,Is)&&(this._lines[2].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[2].render(this._rtLine,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[3],this._vertices[1],Cs,Is)&&(this._lines[3].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[3].render(this._rtLine,this._renderer,this._camera)));for(var e=[],t=this._clicks%2==0?this._vertices.length:1,r=0;r<t;++r)e.push(this._camera.project(this._vertices[r]));this._updateAnchorPoints([e[0],e[1]]),4===e.length?this._updateAnchorValues([{pos:As(e[1],e[3])},{pos:As(e[2],e[3])},{pos:As(e[2],e[0])}]):this._hideAnchorValues()},t.prototype._renderProgressively=function(){if(0===this._vertices.length)return this._hideAnchorPoints(),void this._hideAnchorValues();this._projectLineSegmentToScreen(this._vertices[0],this._vertices[1],Cs,Is)&&(this._lines[0].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[0].render(this._rtLinePR,this._renderer,this._camera)),this._clicks%2||(this._projectLineSegmentToScreen(this._vertices[0],this._vertices[2],Cs,Is)&&(this._lines[1].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[1].render(this._rtLinePR,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[2],this._vertices[3],Cs,Is)&&(this._lines[2].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[2].render(this._rtLinePR,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[3],this._vertices[1],Cs,Is)&&(this._lines[3].updateVertices(Cs[0],Cs[1],Is[0],Is[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[3].render(this._rtLinePR,this._renderer,this._camera)))},t}(Ds),Bs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ls=[0,0],Fs=[0,0],Us=function(e){function t(t){var r=e.call(this,"MeasureLines",t)||this;return r._perimeter=0,r}return Bs(t,e),t.prototype.destory=function(){e.prototype.destroy.call(this)},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype.getPerimeter=function(){return this._perimeter},t.prototype._onKeyUp=function(e){if(!this._enabled||this._finished)return!1;"Escape"!==e.key&&"Enter"!==e.key||(this._clicks%2==1&&(this._vertices.pop(),this._lines.pop()),this._finished=!0)},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._finished||this._clicks%2==1&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1)},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._finished||this._clicks%2==1&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snappingEnabled){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._finished?this._hideMouseAnchor():this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}if(this._clicks%2==1){var a=this._camera.unproject(r,i);this._vertices.length>0&&!this._finished&&U.d.copy(this._vertices[this._vertices.length-1],a)}}return this._viewer.invalidate(),!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),t.button===t.RIGHT_BUTTON)return this._perimeter=0,this._reset(),!1;this._finished&&this._reset(),this._clicks++;var r=t.x,i=t.y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(e.prototype._onTouchStop.call(this,t),Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;this._finished&&this._reset(),this._clicks++;var r=t.cursor(0).x,i=t.cursor(0).y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._updateLines=function(e,t,r){if(this._clicks%2==0){U.d.copy(this._vertices[this._vertices.length-1],r),this._perimeter=0;for(var i=0;i<this._vertices.length;i+=2)this._perimeter+=U.d.distance(this._vertices[i],this._vertices[i+1]);var n=this._convertLength(this._perimeter);this._notifyResult("Measure-Update",{distance:n}),this._updateAnchorValues([{value:n.toFixed(2),color:"red"}])}else this._vertices.push(U.d.clone(r)),this._vertices.push(U.d.clone(r)),this._lines.push(new ws("measure-lines-"+this._lines.length,this._resourceManager,this._lineColor,!1))},t.prototype._render=function(){for(var e=0;e<this._lines.length;e++){var t=this._vertices[2*e],r=this._vertices[2*e+1];this._projectLineSegmentToScreen(t,r,Ls,Fs)&&(this._lines[e].updateVertices(Ls[0],Ls[1],Fs[0],Fs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[e].render(this._rtLine,this._renderer,this._camera))}var i=[];for(e=0;e<this._vertices.length;++e)i.push(this._camera.project(this._vertices[e]));this._finished||this._clicks%2!=1||i.pop(),this._updateAnchorPoints(i),i.length>0&&i.length%2==0?this._updateAnchorValues([{pos:As(i[i.length-2],i[i.length-1])}]):this._hideAnchorValues()},t}(Ds),Vs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),js=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},zs=[0,0],Gs=[0,0],Hs=function(e){function t(t){var r=e.call(this,"MeasureLineFan",t)||this;return r._perimeter=0,r}return Vs(t,e),t.prototype.destory=function(){e.prototype.destroy.call(this)},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype.getPerimeter=function(){return this._perimeter},t.prototype._onKeyUp=function(e){if(!this._enabled||this._finished)return!1;"Escape"!==e.key&&"Enter"!==e.key||(U.d.copy(this._vertices[2],this._vertices[0]),this._finished=!0)},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._clicks>0&&U.d.copy(this._vertices[2],this._vertices[0]),this._hideMouseAnchor(),!1)},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._clicks>0&&U.d.copy(this._vertices[2],this._vertices[0]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snappingEnabled){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._finished?this._hideMouseAnchor():this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}var a=this._camera.unproject(r,i);this._vertices.length>0&&!this._finished&&U.d.copy(this._vertices[2],a)}return this._viewer.invalidate(),!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),t.button===t.RIGHT_BUTTON)return this._perimeter=0,this._reset(),!1;this._finished&&this._reset(),this._clicks++;var r=t.x,i=t.y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(e.prototype._onTouchStop.call(this,t),Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;this._finished&&this._reset(),this._clicks++;var r=t.cursor(0).x,i=t.cursor(0).y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._updateLines=function(e,t,r){var i=this;if(1===this._clicks){for(var n=0;n<5;n++)this._vertices.push(U.d.clone(r));this._lines[0]=new ws("measure-linefan-0",this._resourceManager,this._lineColor,!1),this._lines[1]=new ws("measure-linefan-1",this._resourceManager,this._lineColor,!1),this._lines[2]=new ws("measure-linefan-x",this._resourceManager,[0,0,1],!0),this._lines[3]=new ws("measure-linefan-y",this._resourceManager,[0,1,0],!0),this._lines[4]=new ws("measure-linefan-z",this._resourceManager,[1,0,0],!0)}else{U.d.copy(this._vertices[1],r),U.d.copy(this._vertices[2],r),this._vertices[3][0]=this._vertices[0][0],this._vertices[3][1]=this._vertices[0][1],this._vertices[3][2]=this._vertices[1][2],this._vertices[4][0]=this._vertices[0][0],this._vertices[4][1]=this._vertices[1][1],this._vertices[4][2]=this._vertices[1][2],this._perimeter=U.d.distance(this._vertices[0],this._vertices[1]);this._vertices[1][0],this._vertices[0][0];var a=this._vertices[1][1]-this._vertices[0][1],o=this._vertices[1][2]-this._vertices[0][2],s=js([o,a,o].map(function(e){return i._convertLength(e)}),3),l=s[0],u=s[1],c=s[2];this._notifyResult("Measure-Update",{x:l,y:u,z:c,distance:this._convertLength(this._perimeter)}),this._updateAnchorValues([{value:l,color:"red"},{value:u,color:"limegreen"},{value:c,color:"blue"}].map(function(e){return{value:Math.abs(e.value).toFixed(2),color:e.color}}))}},t.prototype._render=function(){if(0===this._vertices.length)return this._hideAnchorPoints(),void this._hideAnchorValues();this._projectLineSegmentToScreen(this._vertices[0],this._vertices[1],zs,Gs)&&(this._lines[0].updateVertices(zs[0],zs[1],Gs[0],Gs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[0].render(this._rtLine,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[0],this._vertices[2],zs,Gs)&&(this._lines[1].updateVertices(zs[0],zs[1],Gs[0],Gs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[1].render(this._rtLine,this._renderer,this._camera)),this._clicks>1&&(this._projectLineSegmentToScreen(this._vertices[0],this._vertices[3],zs,Gs)&&(this._lines[2].updateVertices(zs[0],zs[1],Gs[0],Gs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[2].render(this._rtLine,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[3],this._vertices[4],zs,Gs)&&(this._lines[3].updateVertices(zs[0],zs[1],Gs[0],Gs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[3].render(this._rtLine,this._renderer,this._camera)),this._projectLineSegmentToScreen(this._vertices[4],this._vertices[1],zs,Gs)&&(this._lines[4].updateVertices(zs[0],zs[1],Gs[0],Gs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[4].render(this._rtLine,this._renderer,this._camera)));for(var e=[],t=this._clicks>1?this._vertices.length:1,r=0;r<t;++r)2!==r&&e.push(this._camera.project(this._vertices[r]));this._updateAnchorPoints([e[0],e[1]]),4===e.length&&this._updateAnchorValues([{pos:As(e[1],e[3])},{pos:As(e[2],e[3])},{pos:As(e[2],e[0])}])},t}(Ds),qs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ws=[0,0],Qs=[0,0],Ys=function(e){function t(t){var r=e.call(this,"MeasureLineStrip",t)||this;return r._perimeter=0,r}return qs(t,e),t.prototype.destory=function(){e.prototype.destroy.call(this)},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype.getPerimeter=function(){return this._perimeter},t.prototype._onKeyUp=function(e){if(!this._enabled||this._finished)return!1;"Escape"!==e.key&&"Enter"!==e.key||(this._vertices.pop(),this._lines.pop(),this._finished=!0)},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._finished||this._clicks>0&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1)},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._finished||this._clicks>0&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snappingEnabled){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._finished?this._hideMouseAnchor():this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}var a=this._camera.unproject(r,i);this._vertices.length>0&&!this._finished&&U.d.copy(this._vertices[this._vertices.length-1],a)}return this._viewer.invalidate(),!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),t.button===t.RIGHT_BUTTON)return this._perimeter=0,this._reset(),!1;this._finished&&this._reset(),this._clicks++;var r=t.x,i=t.y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(e.prototype._onTouchStop.call(this,t),Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;this._finished&&this._reset(),this._clicks++;var r=t.cursor(0).x,i=t.cursor(0).y;this._snappingEnabled&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._updateLines=function(e,t,r){if(this._lines.push(new ws("measure-linestrip-"+this._lines.length,this._resourceManager,this._lineColor,!1)),1===this._clicks)this._vertices.push(U.d.clone(r)),this._vertices.push(U.d.clone(r));else{U.d.copy(this._vertices[this._vertices.length-1],r),this._vertices.push(U.d.clone(r)),this._perimeter=0;for(var i=0;i<this._vertices.length-1;i++)this._perimeter+=U.d.distance(this._vertices[i],this._vertices[i+1]);var n=this._convertLength(this._perimeter);this._notifyResult("Measure-Update",{distance:n}),this._updateAnchorValues([{value:n.toFixed(2),color:"red"}])}},t.prototype._render=function(){for(var e=0;e<this._lines.length;e++){var t=this._vertices[e],r=this._vertices[e+1];this._projectLineSegmentToScreen(t,r,Ws,Qs)&&(this._lines[e].updateVertices(Ws[0],Ws[1],Qs[0],Qs[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[e].render(this._rtLine,this._renderer,this._camera))}var i=[];for(e=0;e<this._vertices.length;++e)i.push(this._camera.project(this._vertices[e]));this._finished||i.pop(),this._updateAnchorPoints(i),i.length>=2?this._updateAnchorValues([{pos:As(i[i.length-2],i[i.length-1])}]):this._hideAnchorValues()},t}(Ds),Xs=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Zs=[0,0],Ks=[0,0],Js=function(e){function t(t){var r=e.call(this,"MeasureAngle",t)||this;return r._angle=0,r._radians=!1,r}return Xs(t,e),t.prototype.destory=function(){e.prototype.destroy.call(this)},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._clicks>0&&3!==this._clicks&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1)},t.prototype.getAngle=function(){return this._angle},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._clicks>0&&3!==this._clicks&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snappingEnabled){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}var a=this._camera.unproject(r,i);this._vertices.length>0&&this._clicks<3&&U.d.copy(this._vertices[this._vertices.length-1],a)}return this._viewer.invalidate(),!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),t.button===t.RIGHT_BUTTON)return this._angle=0,this._reset(),!1;var r=this._clicks;this._clicks=this._clicks%3+1;var i=t.x,n=t.y;this._snappingEnabled&&(i=this._snapCoord[0],n=this._snapCoord[1]);var a=this._depthQuery.unproject(i,n,this._renderer,this._camera);return a?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,a),this._updateLines(i,n,a),!0):(this._clicks=r,!1)},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;e.prototype._onTouchStop.call(this,t);var r=this._clicks;this._clicks=this._clicks%3+1;var i=t.cursor(0).x,n=t.cursor(0).y;this._snappingEnabled&&(i=this._snapCoord[0],n=this._snapCoord[1]);var a=this._depthQuery.unproject(i,n,this._renderer,this._camera);return a?(this._snappingEnabled&&!this._camera.updated&&this._snapping.snap(this._snapCoord,a),this._updateLines(i,n,a),!0):(this._clicks=r,!1)},t.prototype._updateLines=function(e,t,r){if(1===this._clicks)this._reset(),this._vertices.push(U.d.clone(r)),this._vertices.push(U.d.clone(r)),this._lines.push(new ws("measure-angle-"+this._lines.length,this._resourceManager,this._lineColor,!1)),this._clicks=1,this._viewer.getEventEmitter().emit("Measure-Update",{angle:0});else if(U.d.copy(this._vertices[this._vertices.length-1],r),this._vertices.length<3&&(this._vertices.push(U.d.clone(r)),this._lines.push(new ws("measure-angle-"+this._lines.length,this._resourceManager,this._lineColor,!1))),3===this._clicks){var i=U.d.create(),n=U.d.create();U.d.sub(i,this._vertices[0],this._vertices[1]),U.d.sub(n,this._vertices[2],this._vertices[1]),this._angle=U.d.angle(i,n);var a=this._radians?this._angle:this._angle/Math.PI*180;this._viewer.getEventEmitter().emit("Measure-Update",{angle:a}),this._updateAnchorValues([{value:a.toFixed(2)+(this._radians?"":""),color:"red"}]);var o=U.d.length(i),s=U.d.length(n),l=Math.min(o,s);U.d.lerp(i,this._vertices[1],this._vertices[0],.1*l/o),U.d.lerp(n,this._vertices[1],this._vertices[2],.1*l/s),this._vertices.push(n),this._vertices.push(i),this._lines.push(new ws("measure-angle-"+this._lines.length,this._resourceManager,this._lineColor,!1)),this._lines.push(new ws("measure-angle-"+this._lines.length,this._resourceManager,this._lineColor,!1))}},t.prototype._render=function(){for(var e=0;e<this._lines.length;e++){var t=this._vertices[e],r=this._vertices[e+1];this._projectLineSegmentToScreen(t,r,Zs,Ks)&&(this._lines[e].updateVertices(Zs[0],Zs[1],Ks[0],Ks[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[e].render(this._rtLine,this._renderer,this._camera))}var i=[],n=this._vertices.length-1;3===this._clicks&&(n=3);for(e=0;e<n;++e)i.push(this._camera.project(this._vertices[e]));this._updateAnchorPoints(i),3===i.length?this._updateAnchorValues([{pos:As(Zs,Ks)}]):this._hideAnchorValues()},t.prototype.useRadians=function(e){if(this._radians!==e){var t=e?this._angle:this._angle/Math.PI*180;this._updateAnchorValues([{value:t.toFixed(2)+(this._radians?"":""),color:"red"}]),this._viewer.getEventEmitter().emit("Measure-Update",{angle:t})}this._radians=e},t.prototype.isRadians=function(){return this._radians},t}(Ds),$s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),el=[0,0],tl=[0,0],rl=function(e){function t(t){var r=e.call(this,"MeasureArea",t)||this;return r._area=0,r._subLines.push(new ws("area_subline_0",r._resourceManager,r._lineColor,!0)),r._subLines.push(new ws("area_subline_1",r._resourceManager,r._lineColor,!0)),r}return $s(t,e),t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype._onKeyUp=function(e){if(!this._enabled||this._finished)return!1;"Escape"!==e.key&&"Enter"!==e.key||(this._vertices.pop(),this._finished=!0)},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._finished||this._clicks>0&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1)},t.prototype._onMouseMove=function(t){if(!this._enabled)return!1;if(e.prototype._onMouseMove.call(this,t),t.pressed)return this._finished||this._clicks>0&&U.d.copy(this._vertices[this._vertices.length-1],this._vertices[this._vertices.length-2]),this._hideMouseAnchor(),!1;if(t.moved){var r=t.x,i=t.y;if(this._snapping){if(this._snapCoord[0]=r,this._snapCoord[1]=i,!t.pressed&&!this._camera.updated){var n=this._snapping.snap(this._snapCoord);this._finished?this._hideMouseAnchor():this._updateMouseAnchor({pos:this._snapCoord,isSnapped:n!==Jn.NONE})}r=this._snapCoord[0],i=this._snapCoord[1]}var a=this._camera.unproject(r,i);this._vertices.length>0&&!this._finished&&U.d.copy(this._vertices[this._vertices.length-1],a)}return!0},t.prototype._onMouseUp=function(t){if(!this._enabled||t.moved)return!1;if(e.prototype._onMouseUp.call(this,t),t.button===t.RIGHT_BUTTON)return this._reset(),!1;this._finished&&this._reset(),this._clicks++;var r=t.x,i=t.y;this._snapping&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snapping&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._onTouchStop=function(t){if(!this._enabled||1!==t.numCursors)return!1;if(e.prototype._onTouchStop.call(this,t),Math.abs(t.cursor(0).dx)>1e-4||Math.abs(t.cursor(0).dy)>1e-4)return!1;this._finished&&this._reset(),this._clicks++;var r=t.cursor(0).x,i=t.cursor(0).y;this._snapping&&(r=this._snapCoord[0],i=this._snapCoord[1]);var n=this._depthQuery.unproject(r,i,this._renderer,this._camera);return n?(this._snapping&&!this._camera.updated&&this._snapping.snap(this._snapCoord,n),this._updateLines(r,i,n),!0):(this._clicks--,!1)},t.prototype._updateLines=function(e,t,r){if(1===this._clicks?this._vertices.push(U.d.clone(r)):U.d.copy(this._vertices[this._vertices.length-1],r),this._vertices.push(U.d.clone(r)),this._lines.push(new ws("measure-area-"+this._lines.length,this._resourceManager,this._lineColor,!1)),this._lines.length>=3){var i=this._lines.length,n=U.d.create(),a=U.d.create(),o=U.d.create(),s=U.d.create(),l=U.d.create();U.d.sub(n,this._vertices[1],this._vertices[0]),U.d.sub(a,this._vertices[2],this._vertices[1]),U.d.cross(l,n,a),U.d.normalize(l,l);for(var u=0;u<i;u++)U.d.sub(n,this._vertices[(u+1)%i],this._vertices[u%i]),U.d.sub(a,this._vertices[(u+2)%i],this._vertices[(u+1)%i]),U.d.cross(o,n,a),U.d.add(s,s,o);this._area=Math.abs(.5*U.d.dot(l,s));var c=this._convertArea(this._area);this._notifyResult("Measure-Update",{area:c}),this._updateAnchorValues([{value:c.toFixed(2),color:"red"}])}},t.prototype._render=function(){if(this._clicks<1)return this._hideAnchorPoints(),void this._hideAnchorValues();for(var e=this._lines.length,t=Math.max(e,2),r=0;r<e;r++){var i=this._vertices[r%t],n=this._vertices[(r+1)%t];this._projectLineSegmentToScreen(i,n,el,tl)&&(this._lines[r].updateVertices(el[0],el[1],tl[0],tl[1],this._viewer.getWidth(),this._viewer.getHeight()),this._lines[r].render(this._rtLine,this._renderer,this._camera))}if(this._clicks>1&&!this._finished){n=this._vertices[this._vertices.length-1],i=this._vertices[0];this._projectLineSegmentToScreen(i,n,el,tl)&&(this._subLines[0].updateVertices(el[0],el[1],tl[0],tl[1],this._viewer.getWidth(),this._viewer.getHeight()),this._subLines[0].render(this._rtLine,this._renderer,this._camera)),i=this._vertices[this._vertices.length-2],this._projectLineSegmentToScreen(i,n,el,tl)&&(this._subLines[1].updateVertices(el[0],el[1],tl[0],tl[1],this._viewer.getWidth(),this._viewer.getHeight()),this._subLines[1].render(this._rtLine,this._renderer,this._camera))}var a=[0,0,0],o=[],s=this._finished?this._vertices.length:this._vertices.length-1;for(r=0;r<this._vertices.length;++r)a[0]+=this._vertices[r][0],a[1]+=this._vertices[r][1],a[2]+=this._vertices[r][2],o.push(this._camera.project(this._vertices[r]));a[0]/=s,a[1]/=s,a[2]/=s,this._updateAnchorPoints(o.slice(0,o.length-1)),this._updateAnchorValues([{pos:this._camera.project(a)}])},t.prototype.setUnit=function(e){var t=this,r=e!==this._unit,i=this._scaling;switch(e){case"m":this._unit="m",this._scaling=.3048;break;case"cm":this._unit="cm",this._scaling=30.48;break;case"feet":this._unit="feet",this._scaling=1;break;case"inches":this._unit="inches",this._scaling=12;break;default:console.log('Unsupported length unit! Please use either "feet", "inches", "cm" or "m"')}if(r&&""!==this._lastEventName){var n=this._scaling/i,a=this._lastEventObject;a.area&&(a.area*=n*n,a.area=a.area.toFixed(2)),this._viewer.getEventEmitter().emit(this._lastEventName,a),this._anchorValues.forEach(function(e,r){if(t._lastAnchorUpdates[r]){var i=t._lastAnchorUpdates[r];i.value&&(i.value*=n*n,i.value=i.value.toFixed(2)),Ts(e,i)}})}},t}(Ds),il=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),nl=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},al=new Uint8Array([0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4]);!function(e){e[e.X_NEGATIVE=0]="X_NEGATIVE",e[e.Y_NEGATIVE=1]="Y_NEGATIVE",e[e.Z_NEGATIVE=2]="Z_NEGATIVE",e[e.X_POSITIVE=3]="X_POSITIVE",e[e.Y_POSITIVE=4]="Y_POSITIVE",e[e.Z_POSITIVE=5]="Z_POSITIVE"}(Ss||(Ss={}));var ol,sl=function(e){function t(t){var r=e.call(this,"Section",!0,t)||this;r._normalDepth=null,r._cube=null,r._plane=null,r._sensitivity=.005,r._smartCullingEnabled=!1,r._vertices=new Float32Array(24),r._indices=[],r._indices[0]=new Uint16Array([0,4,7,7,3,0]),r._indices[1]=new Uint16Array([0,1,5,5,4,0]),r._indices[2]=new Uint16Array([0,3,2,2,1,0]),r._indices[3]=new Uint16Array([5,1,2,2,6,5]),r._indices[4]=new Uint16Array([6,2,3,3,7,6]),r._indices[5]=new Uint16Array([4,5,6,6,7,4]),r._cubeRT=r._getRenderTarget(),r._planeRT=r._getRenderTarget({depthTest:!1,blend:!0});var i=r._resourceManager.getMesh("wiredcube");i.createWiredCube(),r._cube=new ta(i,r._resourceManager),r._cube.setColor([.2,.2,.2]),r._cube.setTransparent(1);var n=r._resourceManager.gl,a=new ie;a.builtin(n.FLOAT),(i=r._resourceManager.getMesh("cliplane")).create(n.TRIANGLES,a,r._vertices,r._indices[0]),r._plane=new ta(i,r._resourceManager),r._plane.setColor([.969,.322,.137]),r._plane.setTransparent(.19),r._planeIndex=null,r._gizmoPlaneIndex=null,r._rotate=!1,r._rotateMatrix=U.a.create(),r._invertedRotateMatrix=U.a.create(),r._bbox=P.a.aabb.create(),r._sectionedBBox=P.a.aabb.create(),r._points=P.a.aabb.points(r._scene.clipping.getBBox());var o=r._viewer.getCamera().core,s=o.viewport[2],l=o.viewport[3],u=r._viewer.getCamera().getManipulator().normalDepth;return r._normalDepth=u||new Mr(r._resourceManager,r._viewer.getRenderScene().getRenderQueueManager(),r._scene,s,l),r._intersect=null,r._updateAllPlane=!1,r}return il(t,e),t.prototype.destroy=function(){this._vertices=null,this._indices=null,this._plane.destroy(),this._cube.destroy(),s.a.isMobile||!this._normalDepth||this._normalDepth.isDestroy||(this._normalDepth.destroy(),this._normalDepth=null,delete this._normalDepth)},t.prototype.setSectionBox=function(e){this._sectionedBBox=e,this._updatePoints(),this.updateGeometry(),this.recompileSectionShader(),this._renderer.renderState.invalidateClip(),this._viewer.invalidate()},t.prototype.getSectionBox=function(){return this._sectionedBBox},t.prototype.resize=function(e,t){this._cubeRT.resize(e,t),this._planeRT.resize(e,t),s.a.isMobile||this._normalDepth.resize(e,t)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.isEnabled=function(){return this._enabled},t.prototype.updateGeometry=function(e){var t=this._resourceManager.gl;this._vertices[0]=this._points[0][0],this._vertices[1]=this._points[0][1],this._vertices[2]=this._points[0][2],this._vertices[3]=this._points[1][0],this._vertices[4]=this._points[1][1],this._vertices[5]=this._points[1][2],this._vertices[6]=this._points[2][0],this._vertices[7]=this._points[2][1],this._vertices[8]=this._points[2][2],this._vertices[9]=this._points[3][0],this._vertices[10]=this._points[3][1],this._vertices[11]=this._points[3][2],this._vertices[12]=this._points[4][0],this._vertices[13]=this._points[4][1],this._vertices[14]=this._points[4][2],this._vertices[15]=this._points[5][0],this._vertices[16]=this._points[5][1],this._vertices[17]=this._points[5][2],this._vertices[18]=this._points[6][0],this._vertices[19]=this._points[6][1],this._vertices[20]=this._points[6][2],this._vertices[21]=this._points[7][0],this._vertices[22]=this._points[7][1],this._vertices[23]=this._points[7][2],this._cube.mesh.update(this._vertices,al,t.UNSIGNED_BYTE),e&&e.renderState.invalidateClip()},t.prototype.update=function(){if(this._updateGeometry&&(this.updateGeometry(),this._updateGeometry=!1),this._updateplane&&(this._plane.mesh.update(this._vertices,this._indices[this._planeIndex]),this._updateplane=!1),this._updateAllPlane){for(var e=P.a.aabb.planes(this._sectionedBBox),t=0;t<6;++t)if(!(Math.abs(U.d.dot(this._intersect,e[t])+e[t][3])>1e-4)){if(this._gizmoPlaneIndex===t)return!1;this._gizmoPlaneIndex=t,this._plane.mesh.update(this._vertices,this._indices[t]),this._viewer.notifyEventListener("hoveringSectionPlane"),this._viewer.setProgressiveRendering()}this._updateAllPlane=!1}},t.prototype._render=function(){var e=this._resourceManager.gl;this._renderer.drawGizmo(this._cubeRT,this._cube,this._camera,e.CCW),this._renderer.clear(this._renderer.renderTarget,e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),null!==this._gizmoPlaneIndex&&this._renderer.drawGizmo(this._planeRT,this._plane,this._camera,e.CCW)},t.prototype._renderProgressively=function(){var e=this._resourceManager.gl;this._renderer.drawGizmo(this._getRenderTargetPR(),this._cube,this._camera,e.CCW),this._renderer.clear(this._renderer.renderTarget,e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),null!==this._gizmoPlaneIndex&&this._renderer.drawGizmo(this._getRenderTargetPR({depthTest:!1,blend:!0}),this._plane,this._camera,e.CCW)},t.prototype.reset=function(e){this._rotate=!1,this._updateBBox([0,-1,0]),this._updatePoints(),this.updateGeometry(e),s.a.isMobile||this._normalDepth.dirtyAt(0),this._viewer.stateManager.onSectionChanged(this._enabled),this._viewer.getRenderScene().updateShadow(),this._viewer.invalidate()},t.prototype.setClipRanges=function(e,t){if(this._scene.clipping.set(e,t),"number"==typeof t[0])this._updateBBox([0,-1,0]);else{this._updateBBox(e[5]);for(var r=0;r<this._points.length;r++)U.d.copy(this._points[r],t[r])}for(r=0;r<this._points.length;r++)U.d.transformMat4(this._points[r],this._points[r],this._rotateMatrix);P.a.aabb.createFromPoints(this._sectionedBBox,this._points),this._updatePoints(),this.updateGeometry(),this._gizmoPlaneIndex=null},t.prototype._onEnableChanged=function(){var e=this;if(this._scene.clipping.setEnabled(this._enabled),this._viewer.getRenderScene().setClippingEnabled(this._enabled),this._viewer.getRenderScene().refresh(),this._viewer.getRenderScene().onSceneChanged(-1),this._enabled){if(this._scene.clipping.initialize(this._scene.bbox),this._viewer.invalidate(),this._updateBBox([0,-1,0]),this._updatePoints(),this.updateGeometry(this._renderer),this._smartCullingEnabled=this._camera.isBimCullingEnabled(),this._viewer.setSmartCullingEnabled(!1),this._normalDepth&&!this._normalDepth.isValid())for(var t in this._scene.models){this._scene.models[t].drawables.forEach(function(t){e._normalDepth.addDrawable(t)})}}else this.reset(this._renderer),this._viewer.getEventEmitter().emit("leavingSectionPlane"),this._gizmoPlaneIndex=null,this._viewer.setSmartCullingEnabled(this._smartCullingEnabled),this._scene.updateBBox(),this._camera.update();this._viewer.stateManager.onSectionChanged(this._enabled)},t.prototype.recompileSectionShader=function(){this._viewer.getRenderScene().recompileClipping(!0);var e=[];this._scene.clipping.isEnabled()&&e.push("CLIPPING"),Tr.a.compressNormals&&e.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&e.push("DOUBLESIDED")},t.prototype.setRotatable=function(e){this._rotate=e,e&&(this._gizmoPlaneIndex=null),this._viewer.invalidate()},t.prototype.isRotatable=function(){return this._rotate},t.prototype.setInteractEnabled=function(e){this.setInteractive(e)},t.prototype.getInteractEnabled=function(){return this._interactive},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t)},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"Section"),e.addMouseWheelListener(function(e){return t._onMouseWheel(e)},"Section"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"Section"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"Section")},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchMoveListener(function(e){return t._onTouchMove(e)},"Section"),e.addTouchStartListener(function(e){return t._onTouchStart(e)},"Section"),e.addTouchStopListener(function(e){return t._onTouchStop(e)},"Section")},t.prototype._onTouchStart=function(e){if(!this._enabled||!this._interactive||1!==e.numCursors)return!1;var t=e.cursor(0),r=t.x,i=t.y;return this._viewer.invalidate(),this._focusPlane(r,i)},t.prototype._onTouchMove=function(e){if(!this._enabled||!this._interactive||1!==e.numCursors)return!1;var t=e.cursor(0);return this._renderer.renderState.invalidateClip(),this._viewer.invalidate(),this._dragPlaneAlongNormal(t.dx,t.dy)},t.prototype._onTouchStop=function(e){return!(!this._enabled||!this._interactive)&&(this._gizmoPlaneIndex=null,this._viewer.invalidate(),!0)},t.prototype._onMouseDown=function(e){return this._enabled&&this._interactive},t.prototype._onMouseWheel=function(e){return!!this._enabled&&(this._rotate&&this._normalDepth.dirtyAt(this._viewer.getElapsedFrames()),!1)},t.prototype._onMouseMove=function(e){if(!this._enabled)return!1;if(!this._interactive)return!1;var t=e.getEvent().buttonDown,r=e.moved,i=t&&r,n=this._rotate,a=this._viewer.getElapsedFrames();if(n&&i)return this._normalDepth.dirtyAt(a),!1;var o=!this._camera.updated,s=this._normalDepth.canUpdateAt(a);return r&&o&&s?(this._normalDepth.render(this._renderer,this._camera),!1):(this._renderer.renderState.invalidateClip(),e.pressed?this._dragPlaneAlongNormal(e.dx,e.dy):n?this._updateCube(e,[.5,.5,.5]):this._focusPlane(e.x,e.y))},t.prototype._onMouseUp=function(e){if(!this._enabled||!this._interactive)return!1;this._rotate&&!this._normalDepth.isDirty()&&(this._updateCube(e,[.2,.2,.2])&&(this._viewer.getEventEmitter().emit("Section-RotateFacePicked"),this._viewer.getEventEmitter().emit("rotateSectionFacePicked")));return this._gizmoPlaneIndex=null,this._renderer.renderState.invalidateClip(),this._viewer.setProgressiveRendering(),!0},t.prototype._cutByFaceClicked=function(){var e=U.d.create(),t=U.d.create();U.d.transformMat4(e,this._normalDepth.getNormal(),this._rotateMatrix),U.d.transformMat4(t,t,this._rotateMatrix),U.d.sub(e,e,t);for(var r=P.a.aabb.planes(this._sectionedBBox),i=0;i<6;++i)if(Math.abs(U.d.dot(e,r[i])-1)<1e-6){this._gizmoPlaneIndex=i;break}U.d.transformMat4(e,this._normalDepth.getPosition(),this._rotateMatrix),U.d.scaleAndAdd(e,e,r[this._gizmoPlaneIndex],1),this._dragPlaneAlongNormal(null,null,e[2])},t.prototype._updateCube=function(e,t){var r=this._normalDepth.getNormalDepth(e.x,e.y);return r&&(this._updateBBox(this._normalDepth.getNormal()),this._cube.setColor(t),this._updateGeometry=!0,this.setNeedUpdate(!0),this._scene.radius=this._scene.clipping.getRadius(),this._camera._updateProjection(),this._viewer.getRenderScene().onSceneChanged(-1)),this._viewer.invalidate(),r},t.prototype.setSensitivity=function(e){this._sensitivity=e,this._viewer.invalidate()},t.prototype._worldToView=function(e){var t=U.e.create();return U.e.transformMat4(t,e,this._rotateMatrix),U.e.transformMat4(t,e,this._camera.viewMatrix),t},t.prototype._dragPlaneAlongNormal=function(e,t,r){var i=this._gizmoPlaneIndex;if(null===i)return!1;var n=i%3,a=i>2?1:0,o=0===a?this._bbox[n]+.002:this._sectionedBBox[n]+.002,s=0===a?this._sectionedBBox[3+n]-.002:this._bbox[3+n]-.002,l=r;if(!r){var u=nl(this._worldToView(this._planeNormal(i)),3),c=u[0],h=u[1],d=u[2],p=h>0?1:-1,f=+e*c+-t*Math.sqrt(h*h+d*d)*p,_=this._scene.bbox[i]-this._scene.bbox[(i+3)%6];l=this._sensitivity*f*_}return this._sectionedBBox[i]=P.a.clamp(this._sectionedBBox[i]+l,o,s),this._updatePoints(),this._planeIndex=i,this._updateGeometry=!0,this._updateplane=!0,this.setNeedUpdate(!0),this._viewer.invalidate(),!0},t.prototype._planeNormal=function(e){switch(e){case Ss.X_POSITIVE:return this._direction(this._points[0],this._points[1]);case Ss.Y_POSITIVE:return this._direction(this._points[0],this._points[3]);case Ss.Z_POSITIVE:return this._direction(this._points[0],this._points[4]);case Ss.X_NEGATIVE:return this._direction(this._points[1],this._points[0]);case Ss.Y_NEGATIVE:return this._direction(this._points[3],this._points[0]);case Ss.Z_NEGATIVE:return this._direction(this._points[4],this._points[0])}},t.prototype._direction=function(e,t){var r=U.d.clone(e),i=U.d.clone(t),n=U.e.create();return U.d.sub(n,i,r),U.d.normalize(n,n),n},t.prototype._focusPlane=function(e,t){var r=U.d.create(),i=U.d.create();if(this._camera.isPerspective())U.d.copy(r,this._camera.eye),i=this._camera.unproject(e,t);else{r=this._camera.unproject(e,t);var n=this._camera.getViewDirection();U.d.add(i,r,n)}U.d.transformMat4(r,r,this._rotateMatrix),U.d.transformMat4(i,i,this._rotateMatrix);var a=[];a[0]=i[0]-r[0],a[1]=i[1]-r[1],a[2]=i[2]-r[2];var o=P.a.intersect.ray_aabb(r,a,this._sectionedBBox);return null===o?(null!==this._gizmoPlaneIndex&&(this._viewer.notifyEventListener("leavingSectionPlane"),this._viewer.setProgressiveRendering(),this._gizmoPlaneIndex=null),!1):(this._intersect=o,this._updateAllPlane=!0,this.setNeedUpdate(!0),!1)},t.prototype._updateBBox=function(e){var t=P.a.aabb.center(this._scene.bbox),r=U.d.create();U.d.scaleAndAdd(r,t,e,this._scene.radius),Math.abs(e[2])>.9999?U.a.lookAt(this._rotateMatrix,r,t,[0,1,0]):U.a.lookAt(this._rotateMatrix,r,t,[0,0,1]),U.a.invert(this._invertedRotateMatrix,this._rotateMatrix);var i=this._scene.clipping.getBBox();if(Tr.a.compressNormals){i[0]-=1e-4,i[1]-=1e-4,i[2]-=1e-4,i[3]+=1e-4,i[4]+=1e-4,i[5]+=1e-4}P.a.aabb.points2(i,this._points);for(var n=0,a=this._points.length;n<a;n++)U.d.transformMat4(this._points[n],this._points[n],this._rotateMatrix);P.a.aabb.createFromPoints(this._bbox,this._points),P.a.aabb.copy(this._sectionedBBox,this._bbox),this._updatePoints()},t.prototype._updatePoints=function(){P.a.aabb.points2(this._sectionedBBox,this._points),U.d.transformMat4(this._points[0],this._points[0],this._invertedRotateMatrix),U.d.transformMat4(this._points[1],this._points[1],this._invertedRotateMatrix),U.d.transformMat4(this._points[2],this._points[2],this._invertedRotateMatrix),U.d.transformMat4(this._points[3],this._points[3],this._invertedRotateMatrix),U.d.transformMat4(this._points[4],this._points[4],this._invertedRotateMatrix),U.d.transformMat4(this._points[5],this._points[5],this._invertedRotateMatrix),U.d.transformMat4(this._points[6],this._points[6],this._invertedRotateMatrix),U.d.transformMat4(this._points[7],this._points[7],this._invertedRotateMatrix),this._scene.clipping.update(this._points)},t.prototype.onSceneChanged=function(){this._scene.clipping.initialize(this._scene.bbox),this._viewer.invalidate(),this._updateBBox([0,-1,0]),this._updatePoints(),this.updateGeometry(this._renderer)},t}(gr.a),ll="data:image/png;base64,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",ul=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),cl=function(e){function t(t){var r=e.call(this,"MagnifyGlass",!0,t)||this;r._depthQuery=new br.a(r._scene,t.getResourceManager()),r._animator=new yr.a,r._renderTarget=r._getRenderTarget({depthTest:!1}),r._lineWidth=1,r._dashLength=1;var i=r._resourceManager.getMesh("magnify");i.createQuad(),r._drawable=new bs(i,r._resourceManager);var n=t.getResourceManager().gl;r._resourceManager.getTexture("magnify").createFromFile(ll,n.RGB,n.LINEAR,n.REPEAT,function(e){r._drawable.setTexture(e),r._dashLength=e.width}),r._vertices=new Float32Array(80),r._indices=new Uint8Array(24);for(var a=0;a<4;++a)r._indices[0+6*a]=0+4*a,r._indices[1+6*a]=1+4*a,r._indices[2+6*a]=2+4*a,r._indices[3+6*a]=2+4*a,r._indices[4+6*a]=3+4*a,r._indices[5+6*a]=0+4*a;return r._resetVertices(),r}return ul(t,e),t.prototype.destroy=function(){this._animator.destroy(),this._animator=null,delete this._animator,this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery,this._drawable.destroy(),this._drawable=null,delete this._drawable,this._vertices=null,delete this._vertices,this._indices=null,delete this._indices,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.setEnabled=function(e){this._enabled=e,this._enabled||(this._startX=0,this._startY=0,this._endX=0,this._endY=0)},t.prototype._render=function(){this._renderer.drawDrawable(this._renderTarget,this._drawable,this._camera)},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"MagnifyGlass"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"MagnifyGlass"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"MagnifyGlass")},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchMoveListener(function(e){return t._onTouchMove(e)},"MagnifyGlass"),e.addTouchStartListener(function(e){return t._onTouchStart(e)},"MagnifyGlass"),e.addTouchStopListener(function(e){return t._onTouchStop(e)},"MagnifyGlass")},t.prototype._onMouseDown=function(e){return!(!this._enabled||e.button!==e.LEFT_BUTTON)&&(this._startX=e.x,this._startY=e.y,this._endX=this._startX,this._endY=this._startY,!0)},t.prototype._onMouseMove=function(e){return!(!this._enabled||e.button!==e.LEFT_BUTTON||!e.pressed)&&(this._endX+=e.dx,this._endY+=e.dy,this._updateVertices(),!0)},t.prototype._onMouseUp=function(e){return!(!this._enabled||e.button!==e.LEFT_BUTTON)&&(this._inputStop(),this._viewer.getEventEmitter().emit("MagnifyGlass-Selected"),!0)},t.prototype._onTouchStart=function(e){if(!this._enabled||1!==e.numCursors)return!1;var t=e.cursor(0);return this._startX=t.x,this._startY=t.y,this._endX=this._startX,this._endY=this._startY,!0},t.prototype._onTouchMove=function(e){if(!this._enabled||1!==e.numCursors)return!1;var t=e.cursor(0);return this._endX+=t.dx,this._endY+=t.dy,this._updateVertices(),!0},t.prototype._onTouchStop=function(e){return!(!this._enabled||1!==e.numCursors)&&(this._inputStop(),!0)},t.prototype._inputStop=function(){var e=this._renderer,t=this._viewer.getCamera().core,r=t.viewport[2],i=t.viewport[3];if(this._resetVertices(),this._startX>this._endX){var n=this._startX;this._startX=this._endX,this._endX=n}if(this._startY>this._endY){n=this._startY;this._startY=this._endY,this._endY=n}if(this._startX===this._endX||this._startY===this._endY)return this.setEnabled(!1),this._viewer.getEventEmitter().emit("magnificationSelected");var a=this._depthQuery.getNearest(this._startX,this._startY,this._endX,this._endY,e,this._camera);if(null===a)return this.setEnabled(!1),this._viewer.getEventEmitter().emit("magnificationSelected");var o=U.d.create();U.d.subtract(o,a,this._camera.eye);var s=U.d.length(o);if(s<.01*this._scene.radius)return this.setEnabled(!1),this._viewer.getEventEmitter().emit("magnificationSelected");var l=Math.max(Math.abs(this._endX-this._startX)/r,Math.abs(this._endY-this._startY)/i);if(this._camera.isPerspective()){var u={fov:this._camera._fov,theta:this._camera._theta,phi:this._camera._phi,at:[a[0],a[1],a[2]],distance:l*s};this._animator.attach(this._camera),this._animator.start(u,!1,50)}else this._camera.zoomBy(l);return this.setEnabled(!1),this._viewer.getEventEmitter().emit("magnificationSelected"),this._viewer.getRenderScene().refresh(),null},t.prototype.resize=function(t,r){this._renderTarget.resize(t,r),e.prototype.resize.call(this,t,r)},t.prototype.setLineWidth=function(e){this._lineWidth=e},t.prototype._updateVertices=function(){var e=this._startX,t=this._endX,r=this._startY,i=this._endY;this._startX>this._endX&&(e=this._endX,t=this._startX),this._startY>this._endY&&(r=this._endY,i=this._startY);var n=this._viewer.getCamera().core.viewport[3];e=Math.floor(e*s.a.devicePixelRatio),r=Math.floor(n-1-r*s.a.devicePixelRatio);var a=(t=Math.floor(t*s.a.devicePixelRatio))-e,o=r-(i=Math.floor(n-1-i*s.a.devicePixelRatio)),l=Math.floor(this._lineWidth*s.a.devicePixelRatio);this._addQuad(e,r,e+l,i,0,0,o,o,0),this._addQuad(e,r,t,r+l,0,a,a,0,20),this._addQuad(t-l,r,t,i,0,0,o,o,40),this._addQuad(e,i-l,t,i,0,a,a,0,60);var u=this._viewer.getResourceManager().gl;this._drawable.mesh.update(this._vertices,this._indices,u.UNSIGNED_BYTE),this._viewer.invalidate()},t.prototype._addQuad=function(e,t,r,i,n,a,o,s,l){var u=this._viewer.getCamera().core,c=u.viewport[2],h=u.viewport[3];e=e/c*2-1,r=r/c*2-1,t=t/h*2-1,i=i/h*2-1,this._vertices[0+l]=e,this._vertices[1+l]=t,this._vertices[2+l]=0,this._vertices[3+l]=n/this._dashLength,this._vertices[4+l]=.5,this._vertices[5+l]=r,this._vertices[6+l]=t,this._vertices[7+l]=0,this._vertices[8+l]=a/this._dashLength,this._vertices[9+l]=.5,this._vertices[10+l]=r,this._vertices[11+l]=i,this._vertices[12+l]=0,this._vertices[13+l]=o/this._dashLength,this._vertices[14+l]=.5,this._vertices[15+l]=e,this._vertices[16+l]=i,this._vertices[17+l]=0,this._vertices[18+l]=s/this._dashLength,this._vertices[19+l]=.5},t.prototype._resetVertices=function(){for(var e=0;e<80;++e)this._vertices[e]=-1e6;var t=this._viewer.getResourceManager().gl;this._drawable.mesh.update(this._vertices,this._indices,t.UNSIGNED_BYTE)},t}(gr.a),hl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),dl=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},pl=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(dl(arguments[t]));return e},fl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(e){e[e.SELECT_OUT_LINE=0]="SELECT_OUT_LINE",e[e.SELECT_HIGH_LIGHT=1]="SELECT_HIGH_LIGHT"}(ol||(ol={}));var _l,ml=function(e){function t(t){var r=e.call(this,"SelectElement",!0,t)||this;r._dashLength=1,r._lineWidth=1,r._elementNames=[],r._selectMode=0,r._renderScene=t.getRenderScene(),r._multiselect=!1,r._elements={},r._pickQuery=null,r._depthQuery=null,r._regionSelectEnabled=!1,r._interactive=!1,r._closeup=!0,r._highlight=!0,r._bbox=P.a.aabb.create(),r._renderScene=t.getRenderScene(),r._renderTarget=r._getRenderTarget({depthTest:!1}),r._material=r._scene.materialManager.createMaterialOverride("select-elements-other"),r._material.setUseTransparent(!1),r._overridedColor=[1,1,1,.4],r._clearselect=!0,r._clearPreState=!1,r._selectMode=ol.SELECT_OUT_LINE,r._selectElements=[];var i=[],n=r._renderScene.getScene();if(n.clipping.isEnabled()&&i.push("CLIPPING"),n.needRenderDoubleSided()&&i.push("DOUBLESIDED"),n.compressed&&i.push("COMPRESSION"),s.a.isMobile&&i.push("ENCODE_NORMAL"),i.push("VISIBILITY"),r._shader=r._renderScene.getResourceManager().getShader("solid",i),!r._shader.ready){var a=k.a.solid;r._shader.createFromShaderSource(a,i)}r._smartCullingEnabled=!1,r._startX=-1,r._startY=-1,r._endX=-1,r._endY=-1,r._vertices=new Float32Array(80),r._indices=new Uint8Array(24);for(var o=0;o<4;++o)r._indices[0+6*o]=0+4*o,r._indices[1+6*o]=1+4*o,r._indices[2+6*o]=2+4*o,r._indices[3+6*o]=2+4*o,r._indices[4+6*o]=3+4*o,r._indices[5+6*o]=0+4*o;r._clippingEnabled=r._scene.clipping.isEnabled();var l=r._viewer.getResourceManager().gl,u=r._resourceManager.getMesh("region-select");return u.createQuad(),r._drawable=new bs(u,r._resourceManager),r._drawable.setColor([.969,.398,.238]),r._resourceManager.getTexture("regionSelect").createFromFile(ll,l.RGB,l.LINEAR,l.REPEAT,function(e){r._drawable.setTexture(e),r._dashLength=e.width}),r._resetVertices(),r}return hl(t,e),t.prototype.destroy=function(){this._pickQuery&&(this._pickQuery.destroy(),this._pickQuery=null,delete this._pickQuery),this._depthQuery&&(this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery),this._bbox=null,delete this._bbox,this._elements=null,delete this._elements,this._vertices=null,delete this._vertices,this._indices=null,delete this._indices,this._renderScene=null,delete this._renderScene,this._material.destroy(),this._material=null,delete this._material,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.setSelectionRectangleColor=function(e){this._drawable.setColor(e),this._drawable.setTransparent(e[3])},t.prototype._onEnableChanged=function(){this._enabled&&(null===this._pickQuery&&(this._pickQuery=new Jr.a(this._scene,this._resourceManager)),null===this._depthQuery&&(this._depthQuery=new br.a(this._scene,this._resourceManager)))},t.prototype._render=function(){Math.abs(this._endX-this._startX)<2||Math.abs(this._endY-this._startY)<2||this._regionSelectEnabled&&this._renderer.drawDrawable(this._renderTarget,this._drawable,this._camera)},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"SelectElemets"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"SelectElemets"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"SelectElemets")},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchStartListener(function(e){return t._onTouchStart(e)},"SelectElemets"),e.addTouchMoveListener(function(e){return t._onTouchMove(e)},"SelectElemets"),e.addTouchStopListener(function(e){return t._onTouchStop(e)},"SelectElemets")},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e)},"SelectElemets"),e.addKeyUpListener(function(e){return t._onKeyUp(e)},"SelectElemets")},t.prototype.setRegionSelectEnabled=function(e){this._regionSelectEnabled!=e&&(this._regionSelectEnabled=e,e?(this._smartCullingEnabled=this._viewer.isSmartCullingEnabled(),this._viewer.setSmartCullingEnabled(!1)):this._viewer.setSmartCullingEnabled(this._smartCullingEnabled),this._interactive=e,this._viewer.invalidate())},t.prototype.setCloseUpEnabled=function(e){this._closeup=e},t.prototype.setHighlightEnabled=function(e){this._highlight=e},t.prototype._onKeyDown=function(e){return"Control"===e.key&&this.setMultiselectEnabled(!0),!1},t.prototype._onKeyUp=function(e){return"Control"===e.key&&this.setMultiselectEnabled(!1),!1},t.prototype._onTouchStart=function(e){if(!this._enabled||Object.keys(e.cursors).length>1)return!1;if(document.activeElement.blur(),this._startX=e.cursor(0).x,this._startY=e.cursor(0).y,this._endX=this._startX,this._endY=this._startY,this._scene.clipping.isEnabled()&&!this._clippingEnabled){this._clippingEnabled=!0;var t=["VISIBILITY","CLIPPING"];Tr.a.compressNormals&&t.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&t.push("DOUBLESIDED"),this.recompileShader(t)}else if(!this._scene.clipping.isEnabled()&&!this._clippingEnabled){this._clippingEnabled=!1;t=["VISIBILITY"];Tr.a.compressNormals&&t.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&t.push("DOUBLESIDED"),this.recompileShader(t)}return this._regionSelectEnabled&&this._updateVertices(),!1},t.prototype._onTouchMove=function(e){return!(!this._enabled||Object.keys(e.cursors).length>1||!this._regionSelectEnabled)&&(!this._regionSelectEnabled||(this._endX+=e.cursor(0).dx,this._endY+=e.cursor(0).dy,this._updateVertices(),!0))},t.prototype._onTouchStop=function(e){if(!this._enabled||Object.keys(e.cursors).length>1||e.isDoubleClick)return!1;if(0==Object.keys(e.cursors).length)return!1;if(this._endX=e.cursor(0).x,this._endY=e.cursor(0).y,Math.abs(e.cursor(0).dx)<=1e-4&&Math.abs(e.cursor(0).dy)<=1e-4)this._select();else if(this._regionSelectEnabled){if(this._startX>this._endX){var t=this._startX;this._startX=this._endX,this._endX=t}if(this._startY>this._endY){t=this._startY;this._startY=this._endY,this._endY=t}this._selectRegion(),this._resetVertices(),this._viewer.getEventEmitter().emit("SelectElemets-Disabled")}return!0},t.prototype._onMouseDown=function(e){if(!this._enabled||e.button!==e.LEFT_BUTTON)return!1;if(document.activeElement.blur(),this._startX=e.x,this._startY=e.y,this._endX=this._startX,this._endY=this._startY,this._scene.clipping.isEnabled()&&!this._clippingEnabled){this._clippingEnabled=!0;var t=["VISIBILITY","CLIPPING"];Tr.a.compressNormals&&t.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&t.push("DOUBLESIDED"),this.recompileShader(t)}else if(!this._scene.clipping.isEnabled()&&!this._clippingEnabled){this._clippingEnabled=!1;t=["VISIBILITY"];Tr.a.compressNormals&&t.push("COMPRESSION"),this._scene.needRenderDoubleSided()&&t.push("DOUBLESIDED"),this.recompileShader(t)}return this._regionSelectEnabled&&this._updateVertices(),!0},t.prototype._onMouseMove=function(e){return!!(this._enabled&&e.button===e.LEFT_BUTTON&&e.pressed&&this._regionSelectEnabled)&&(!!this._regionSelectEnabled&&(this._endX+=e.dx,this._endY+=e.dy,this._updateVertices(),this._viewer.invalidate(),!0))},t.prototype._restorePreSelectedNodes=function(){var e=this._renderScene.getDrawablesInfluencedByCurSelectedNodes();this._viewer.getScene().core.clearNodesColor(e),this._renderScene.restorePreSelectedNodes(this._clearPreState)},t.prototype._onMouseUp=function(e){if(!this._enabled||e.button!==e.LEFT_BUTTON||e.isDoubleClick)return!1;if(this._endX=e.x,this._endY=e.y,Math.abs(this._endX-this._startX)<1||Math.abs(this._endY-this._startY)<1)this._clearselect&&this._clearPreState&&this._restorePreSelectedNodes(),this._selectMode===ol.SELECT_OUT_LINE?this.pickElement(this._endX,this._endY,this._renderer,this._camera):this._select();else if(this._regionSelectEnabled){if(this._startX>this._endX){var t=this._startX;this._startX=this._endX,this._endX=t}if(this._startY>this._endY){t=this._startY;this._startY=this._endY,this._endY=t}this._selectRegion(),this._resetVertices(),this._viewer.getEventEmitter().emit("onRegionSelectFinished")}return!0},t.prototype.setMultiselectEnabled=function(e){this._multiselect=e},t.prototype.setClearselectEnabled=function(e){this._clearselect=e},t.prototype.recompileShader=function(e){this._enabled&&(this._pickQuery&&this._pickQuery.recompileShader(this._resourceManager,e),this._depthQuery&&this._depthQuery.recompileShader(this._resourceManager,e))},t.prototype._select=function(){var e=this._endX,t=this._endY;this._viewer.invalidate();var r=this._pickQuery.pickNodesInsideRegion(e,t,e,t,this._renderer,this._camera,this._getPickables()),i=null,n=null;if(r.length>0&&(n=(i=r[0].getElement()).model.name+"+"+i.getDocument().id+"/"+i.id,this._viewer.getEventEmitter().emit("onPointPicked",pl(this._depthQuery.unproject(this._endX,this._endY,this._renderer,this._camera).slice(0,3)))),i)this._multiselect?this._elements[n]?delete this._elements[n]:this._elements[n]=i:(this._elements={},this._elements[n]=i,this._closeup&&this._camera.lookTo(P.a.aabb.center(i.bbox),P.a.aabb.len(i.bbox)/2)),this._highlight&&(this._highlightElements(Object.keys(this._elements)),this._viewer.invalidate());else{if(!this._clearselect)return;this._multiselect||(this._elements={},this._highlight&&(this._viewer.invalidate(),this._highlightElements(null)))}this._viewer.getEventEmitter().emit("onElementSelected",Object.keys(this._elements))},t.prototype._getPickables=function(){if(!this._pickables){var e=new hn("pickQueue",{line:!1});for(var t in this._scene.models)this._scene.models[t].drawables.forEach(function(t){e.addDrawable(t)});this._pickables=e.drawables}return this._pickables},t.prototype._selectRegion=function(){var e={};this._viewer.invalidate();var t=this._pickQuery.pickNodesInsideRegion(this._startX,this._startY,this._endX,this._endY,this._renderer,this._camera,this._getPickables());if(t.length>0){t.forEach(function(t){var r=t.getElement(),i=r.model.name+"+"+r.getDocument().id+"/"+r.id;e[i]||(e[i]=r)});var r=P.a.aabb.create();for(var i in e)t=t.concat(e[i].getNodes()),P.a.aabb.union(r,r,e[i].bbox);this._closeup&&this._camera.lookTo(P.a.aabb.center(r),P.a.aabb.len(r)/2),this._elements=e,this._highlight&&this._highlightElements(Object.keys(this._elements))}else this._elements={},this._highlight&&this._highlightElements(null);this._highlight&&this._viewer.invalidate();var n=Object.keys(this._elements);this._viewer.getEventEmitter().emit("onElementSelected",n)},t.prototype._highlightElements=function(e){e?(this._renderScene.setOverridedMaterials({all:this._material}),this._renderScene.setOverridedShaders(this._shader),this._material.setDiffuse(this._overridedColor),this._material.setTransparent(this._overridedColor[3]),this._renderScene.renderElements(e,!0,this._clearPreState)):(this._renderScene.setOverridedMaterials(null),this._renderScene.setOverridedShaders(null),this._renderScene.renderElements(null,!1,this._clearPreState))},t.prototype.pick=function(e,t){this._enabled&&(!e||0===e.length?this._resetPreviousSelections():(t&&this._focusToSelections(e),this._updateSelections(e),this._highlightSelections()))},t.prototype._resetPreviousSelections=function(){this._elements={},this._highlight&&(this._highlightElements(null),this._viewer.invalidate())},t.prototype._focusToSelections=function(e){var t=this;if(this._closeup){var r=!1;this._bbox=P.a.aabb.createFromArray([1/0,1/0,1/0,-1/0,-1/0,-1/0]),e.forEach(function(e){var i=e.split("+")[0],n=t._scene.models[i].tree.elements[e];n&&(P.a.aabb.union(t._bbox,t._bbox,n.bbox),r=!0)}),r&&this._camera.lookTo(P.a.aabb.center(this._bbox),P.a.aabb.len(this._bbox)/2)}},t.prototype._updateSelections=function(e){var t,r,i,n,a=Object.keys(this._elements),o=e.length!==a.length;if(!o)try{for(var s=fl(e),l=s.next();!l.done;l=s.next()){var u=l.value;if(!a.includes(u)){o=!0;break}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!o)return!1;this._elements={};try{for(var c=fl(e),h=c.next();!h.done;h=c.next()){var d=(u=h.value).split("+")[0],p=this._scene.models[d].tree.elements[u];p&&(this._elements[u]=p)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return!0},t.prototype._highlightSelections=function(){this._highlight&&(this._highlightElements(Object.keys(this._elements)),this._viewer.invalidate())},t.prototype._updateVertices=function(){var e=this._startX,t=this._endX,r=this._startY,i=this._endY;this._startX>this._endX&&(e=this._endX,t=this._startX),this._startY>this._endY&&(r=this._endY,i=this._startY);var n=this._viewer.getCamera().core.viewport[3];e=Math.floor(e*s.a.devicePixelRatio),r=Math.floor(n-1-r*s.a.devicePixelRatio);var a=(t=Math.floor(t*s.a.devicePixelRatio))-e,o=r-(i=Math.floor(n-1-i*s.a.devicePixelRatio)),l=Math.floor(this._lineWidth*s.a.devicePixelRatio);this._addQuad(e,r,e+l,i,0,0,o,o,0),this._addQuad(e,r,t,r+l,0,a,a,0,20),this._addQuad(t-l,r,t,i,0,0,o,o,40),this._addQuad(e,i-l,t,i,0,a,a,0,60);var u=this._viewer.getResourceManager().gl;this._drawable.mesh.update(this._vertices,this._indices,u.UNSIGNED_BYTE)},t.prototype._addQuad=function(e,t,r,i,n,a,o,s,l){var u=this._viewer.getCamera().core.viewport[2],c=this._viewer.getCamera().core.viewport[3];e=e/u*2-1,r=r/u*2-1,t=t/c*2-1,i=i/c*2-1,this._vertices[0+l]=e,this._vertices[1+l]=t,this._vertices[2+l]=0,this._vertices[3+l]=n/this._dashLength,this._vertices[4+l]=.5,this._vertices[5+l]=r,this._vertices[6+l]=t,this._vertices[7+l]=0,this._vertices[8+l]=a/this._dashLength,this._vertices[9+l]=.5,this._vertices[10+l]=r,this._vertices[11+l]=i,this._vertices[12+l]=0,this._vertices[13+l]=o/this._dashLength,this._vertices[14+l]=.5,this._vertices[15+l]=e,this._vertices[16+l]=i,this._vertices[17+l]=0,this._vertices[18+l]=s/this._dashLength,this._vertices[19+l]=.5},t.prototype._resetVertices=function(){for(var e=0;e<80;++e)this._vertices[e]=-1e6;this._drawable.mesh.update(this._vertices,this._indices,this._viewer.getResourceManager().gl.UNSIGNED_BYTE)},t.prototype.setLineColor=function(e){this._renderScene.setNodesLineColor(e)},t.prototype.setOverridedColor=function(e){this._overridedColor[0]=e[0],this._overridedColor[1]=e[1],this._overridedColor[2]=e[2],void 0!==e[3]&&(this._overridedColor[3]=e[3])},t.prototype.setElementsColor=function(e,t){var r=this._viewer.getScene().core,i=this._renderScene.getDrawablesInfluencedByCurSelectedNodes(),n=this._renderScene.getCurSelectedNodes();r.setNodesColor(i,n,t),this._viewer.invalidate(16)},t.prototype.clearElementColor=function(){this._viewer.getScene().core.setElementsColor(this._elementNames),this._elementNames=[]},t.prototype.pickElement=function(e,t,r,i){var n,a;this._multiselect||(this._selectElements=[]);var o=this._pickQuery.pickNodesInsideRegion(e,t,e,t,r,i,this._getPickables()),s=[],l=!1;if(o.length>0){var u=o[0].getElement().name;this._viewer.getEventEmitter().emit("onPointPicked",pl(this._depthQuery.unproject(e,t,this._renderer,this._camera).slice(0,3)));for(var c=0,h=this._selectElements.length;c<h;c++){u===(f=this._selectElements[c]).element?(this._selectElements.splice(c,1),c--,h--,l=!0):s.push(f.element)}l||(this._selectElements.push({element:u}),s.push(u)),this.pick(s,!0),this._viewer.getEventEmitter().emit("onElementSelectedDAM",this._selectElements)}else{if(!this._clearselect)return;this._selectElements=[],this.pick(null,!0),this._viewer.getEventEmitter().emit("onElementSelectedDAM",null)}this._elements={};try{for(var d=fl(this._selectElements),p=d.next();!p.done;p=d.next()){var f=p.value;this._elements[f.element]=!0}}catch(e){n={error:e}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}this._viewer.getEventEmitter().emit("onElementSelected",Object.keys(this._elements)),this._viewer.invalidate()},t.prototype.setSelectMode=function(e){this._selectMode=e},t.prototype.setClearPreState=function(e){this._clearPreState=e},t.prototype.onSceneChanged=function(){this._pickables=null,this._getPickables()},t}(gr.a),vl=[],yl=[],gl=function(){function e(e,t,r,i){this._resourceManager=null,this._ready=!1,this._shaders=[null,null,null],this._maskedShaders=[null,null,null],this._material=null,this._maskMaterial=null,this._rtDepth=null,this._rtColor=null,this._rtDefault=null,this._rtProgressively=null,this._rtOutline=null,this._blitOutline=null,this._blitOverlay=null,this._sectionEnabled=!1,this._drawableNotUseOverride=[],this._resourceManager=e;var n=e.gl;this._blitOutline=new ti(e,k.a.outline),this._blitOverlay=new ti(e,k.a.outlineoverlay),this._rtDepth=new wr.a("outline-depth",e,r,i,{colorBuffer:0,depthBuffer:0,depthTest:!0,depthFunc:n.LESS,colorMask:[0,0,0,0],stencilTest:!0,stencilMask:255,stencilFunc:[n.ALWAYS,255,255],stencilOp:[n.KEEP,n.KEEP,n.REPLACE]}),this._rtColor=new wr.a("outline-color",e,r,i,{colorBuffer:0,depthBuffer:0,clearColor:[0,1,0,0],depthFunc:n.EQUAL,stencilTest:!0,stencilMask:255,stencilFunc:[n.ALWAYS,143,255],stencilOp:[n.REPLACE,n.REPLACE,n.REPLACE]}),this._rtOutline=new wr.a("outline",e,r,i,{colorBuffer:1,depthBuffer:0,clearColor:[1,0,0,0],depthTest:!1,stencilTest:!0,stencilMask:0,stencilFunc:[n.NOTEQUAL,143,255],stencilOp:[n.KEEP,n.KEEP,n.KEEP]}),this._rtDefault=new wr.a(n.isWebGL2?"pipeline":"default",e,r,i,{blend:!0,depthTest:!1}),this._rtProgressively=new wr.a("pipeline-pr",e,r,i,{blend:!0,depthTest:!1}),this._ready=this._rtDepth.ready&&this._rtColor.ready&&this._rtOutline.ready&&this._rtDefault.ready&&this._rtProgressively.ready,this._ready?(this._material=t.createMaterialAdhoc("outline"),this._maskMaterial=t.createMaterialAdhoc("outline-mask"),this._maskMaterial.hasMask=!0,this._maskMaterial.hasTexture=!0,this._maskMaterial.transparent=!1,this._blitOutline.setTexture(this._rtColor.getColorBuffer()),this._blitOverlay.setTexture(this._rtOutline.getColorBuffer()),this.recompileShader({section:!1})):(this._rtDepth.destroy(),this._rtColor.destroy(),this._rtOutline.destroy(),this._rtDefault.destroy(),this._rtProgressively.destroy(),this._blitOutline.destroy(),this._blitOverlay.destroy(),this._material.destroy(),this._maskMaterial.destroy())}return e.prototype.destroy=function(){this._ready&&(this._rtColor.destroy(),this._rtDepth.destroy(),this._rtDefault.destroy(),this._rtProgressively.destroy(),this._rtOutline.destroy(),this._blitOutline.destroy(),this._blitOverlay.destroy(),this._material.destroy(),this._maskMaterial.destroy())},e.prototype.resize=function(e,t){this._ready&&(this._rtColor.resize(e,t),this._rtDepth.resize(e,t),this._rtOutline.resize(e,t),this._rtDefault.resize(e,t),this._rtProgressively.resize(e,t),this._ready=this._rtColor.ready&&this._rtDepth.ready&&this._rtOutline.ready&&this._rtDefault.ready&&this._rtProgressively.ready)},e.prototype.recompileShader=function(e){var t=[];e.section&&t.push("CLIPPING");var r=this._resourceManager;this._shaders[0]=r.getShader("constant",t),this._shaders[0].ready||this._shaders[0].createFromShaderSource(k.a.constant,t),t.push("MODEL_TRANSFORM"),this._shaders[1]=r.getShader("constant",t),this._shaders[1].ready||this._shaders[1].createFromShaderSource(k.a.constant,t),t.push("INSTANCING"),this._shaders[2]=r.getShader("constant",t),this._shaders[2].ready||this._shaders[2].createFromShaderSource(k.a.constant,t),this._material.attachShader(this._shaders[0],r),this._material.setDiffuse([1,0,0]),this._material.setTransparent(1);var i=[];e.section&&i.push("CLIPPING"),i.push("BASE","ALPHATEST"),this._maskedShaders[0]=this._resourceManager.getShader("constant_mask",i),this._maskedShaders[0].ready||this._maskedShaders[0].createFromShaderSource(k.a.constant_mask,i),i.push("MODEL_TRANSFORM"),this._maskedShaders[1]=this._resourceManager.getShader("constant_mask",i),this._maskedShaders[1].ready||this._maskedShaders[1].createFromShaderSource(k.a.constant_mask,i),i.push("INSTANCING"),this._maskedShaders[2]=this._resourceManager.getShader("constant_mask",i),this._maskedShaders[2].ready||this._maskedShaders[2].createFromShaderSource(k.a.constant_mask,i),this._maskMaterial.attachShader(this._maskedShaders[0],r),this._maskMaterial.setDiffuse([1,0,0]),this._maskMaterial.setTransparent(1)},e.prototype._checkClipping=function(e,t){e.clipping.isEnabled()&&t.renderState.invalidateClip()},e.prototype._genSceneDepth=function(e,t,r){var i=this._resourceManager.gl;t.clear(this._rtDepth,i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT);var n=e.getAllDrawablesWithoutLines();this.beforeRenderWithOverride(n),vl.length=0,yl.length=0,n.forEach(function(e){e.isDestroy||(e.material.hasMask?yl.push(e):vl.push(e))}),t.drawDrawables(this._rtDepth,vl,r,this._shaders,this._material,e.clipping,null,null,null,!1),t.drawDrawables(this._rtDepth,yl,r,this._maskedShaders,this._maskMaterial,e.clipping,null,null,null,!1),this.afterRenderWithOverride()},e.prototype._updateShader=function(e){this._sectionEnabled!==!!e&&(this._sectionEnabled=!this._sectionEnabled,this.recompileShader({section:this._sectionEnabled}))},e.prototype._drawSelectedNodesWithRedColor=function(e,t,r,i){var n=this._resourceManager.gl;this._updateShader(i),t.clear(this._rtColor,n.COLOR_BUFFER_BIT),t.drawNodesCustom(this._rtColor,e,r,this._shaders,this._material,i,null,null)},e.prototype._extractOutlineFromColorBuffer=function(e,t){var r=this._resourceManager.gl;e.clear(this._rtOutline,r.COLOR_BUFFER_BIT),this._blitOutline.setParameter("u_outlineWidth",t),this._blitOutline.render(e,this._rtOutline)},e.prototype._blitOutlineToDefaultFrameBuffer=function(e,t){this._blitOverlay.setParameter("uColor",t),this._blitOverlay.render(e,this._rtDefault,!0)},e.prototype._blitOutlineToPrFrameBuffer=function(e,t){this._blitOverlay.setParameter("uColor",t),this._blitOverlay.render(e,this._rtProgressively,!0)},e.prototype._genOutlineOfSelectedNodes=function(e,t,r,i,n){this._checkClipping(t,e),this._genSceneDepth(t,e,i),this._drawSelectedNodesWithRedColor(r,e,i,t.clipping),this._extractOutlineFromColorBuffer(e,n)},e.prototype.render=function(e,t,r,i,n,a){this._ready&&(this._genOutlineOfSelectedNodes(e,t,r,i,n),this._blitOutlineToDefaultFrameBuffer(e,a))},e.prototype.renderProgressively=function(e,t,r,i,n,a){this._ready&&(this._genOutlineOfSelectedNodes(e,t,r,i,n),this._blitOutlineToPrFrameBuffer(e,a))},e.prototype.beforeRenderWithOverride=function(e){var t=this;e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},e.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1}),this._drawableNotUseOverride.length=0},e}();!function(e){e[e.OVERRIDDEN=0]="OVERRIDDEN",e[e.OVERLAPPED=1]="OVERLAPPED"}(_l||(_l={}));var bl,wl=function(){function e(e,t,r,i){this._resourceManager=null,this._materialManager=null,this._ready=!1,this._shaders=[null,null,null],this._material=null,this._rtDepth=null,this._rtColor=null,this._rtDefault=null,this._rtProgressively=null,this._blit=null,this._width=0,this._height=0,this._shadowEnabled=!1,this._sectionEnabled=!1,this._saveProperties(e,t,r,i),this._createRenderTargets(),this._checkCompleteness(),this._createShader(),this._createBlit()}return e.prototype._saveProperties=function(e,t,r,i){this._resourceManager=e,this._materialManager=t,this._width=r,this._height=i},e.prototype._createRenderTargets=function(){var e=this._resourceManager,t=e.gl,r=this._width,i=this._height;this._rtDepth=new wr.a("flood-depth",e,r,i,{colorBuffer:0,depthBuffer:0,depthTest:!0,depthFunc:t.LESS,colorMask:[0,0,0,0]}),this._rtColor=new wr.a("flood-color",e,r,i,{colorBuffer:0,depthBuffer:0,clearColor:[1,1,1,0],depthFunc:t.EQUAL}),this._rtDefault=new wr.a(t.isWebGL2?"pipeline":"default",e,r,i,{blend:!0,depthTest:!1}),this._rtProgressively=new wr.a("pipeline-pr",e,r,i,{blend:!0,depthTest:!1})},e.prototype._checkCompleteness=function(){if(this._ready=this._rtDepth.ready&&this._rtColor.ready&&this._rtDefault.ready&&this._rtProgressively.ready,!this._ready)throw this._rtDepth.destroy(),this._rtColor.destroy(),this._rtDefault.destroy(),this._rtProgressively.destroy(),this._blit.destroy(),new Error("flood initialization failed")},e.prototype._createShader=function(){this._material=this._materialManager.createMaterialAdhoc("flood"),this._recompileShader({section:!1,shadow:!1})},e.prototype._createBlit=function(){this._blit=new ti(this._resourceManager,k.a.overlay),this._blit.setForegroundTexture(this._rtColor.getColorBuffer())},e.prototype.destroy=function(){this._ready&&(this._rtColor.destroy(),this._rtDepth.destroy(),this._rtDefault.destroy(),this._rtProgressively.destroy(),this._blit.destroy(),this._material.destroy())},e.prototype.resize=function(e,t){this._ready&&(e===this._width&&t===this._height||(this._width=e,this._height=t,this._rtColor.resize(e,t),this._rtDepth.resize(e,t),this._rtDefault.resize(e,t),this._rtProgressively.resize(e,t),this._checkCompleteness()))},e.prototype._recompileShader=function(e){var t=[];e.section&&t.push("CLIPPING"),e.shadow&&t.push("SHADOW");var r=this._resourceManager;this._shaders[0]=r.getShader("solid",t),this._shaders[0].ready||this._shaders[0].createFromShaderSource(k.a.solid,t),t.push("MODEL_TRANSFORM"),this._shaders[1]=r.getShader("solid",t),this._shaders[1].ready||this._shaders[1].createFromShaderSource(k.a.solid,t),t.push("INSTANCING"),this._shaders[2]=r.getShader("solid",t),this._shaders[2].ready||this._shaders[2].createFromShaderSource(k.a.solid,t),this._material.attachShader(this._shaders[0],r),this._material.setDiffuse([1,0,0]),this._material.setTransparent(1)},e.prototype._checkClipping=function(e,t){e.clipping.isEnabled()&&t.renderState.invalidateClip()},e.prototype._genSceneDepth=function(e,t,r){var i=this._resourceManager.gl;t.clear(this._rtDepth,i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),t.drawDrawables(this._rtDepth,e.getAllDrawablesWithoutLines(),r,this._shaders,this._material,e.clipping,null,null,null,e.needRenderDoubleSided()?0:i.CCW)},e.prototype._updateShader=function(e,t){if(this._sectionEnabled!==!!e||this._shadowEnabled!==!!t){var r={};this._sectionEnabled!==!!e&&(this._sectionEnabled=!this._sectionEnabled,r.section=this._sectionEnabled),this._shadowEnabled!==!!t&&(this._shadowEnabled=!this._shadowEnabled,r.shadow=this._shadowEnabled),this._recompileShader(r)}},e.prototype._drawSelectedNodesWithColor=function(e,t,r,i,n,a,o,s){var l=this._resourceManager.gl;this._updateShader(i,s),this._material.setDiffuse(n),this._material.setTransparent(n[3]),t.renderState.invalidateShadow(),t.clear(this._rtColor,l.COLOR_BUFFER_BIT),t.drawNodesCustom(this._rtColor,e,r,this._shaders,this._material,i,a,null,o,s)},e.prototype._blitColorToDefaultFrameBuffer=function(e){this._blit.render(e,this._rtDefault,!0)},e.prototype._blitColorToPrFrameBuffer=function(e){this._blit.render(e,this._rtProgressively,!0)},e.prototype._drawSelectedNodes=function(e,t,r,i,n,a){var o=t.needRenderDoubleSided()?0:this._resourceManager.gl.CCW;this._checkClipping(t,e),this._genSceneDepth(t,e,i),this._drawSelectedNodesWithColor(r,e,i,t.clipping,n,o,t.getMainLight(),a)},e.prototype.render=function(e,t,r,i,n,a){this._ready&&(this._drawSelectedNodes(e,t,r,i,n,a),this._blitColorToDefaultFrameBuffer(e))},e.prototype.renderProgressively=function(e,t,r,i,n,a){this._ready&&(this._drawSelectedNodes(e,t,r,i,n,a),this._blitColorToPrFrameBuffer(e))},e.prototype.setMode=function(e){var t=this._resourceManager.gl;switch(e){case _l.OVERLAPPED:return this._setBlendFunc([t.ZERO,t.SRC_COLOR,t.ZERO,t.ONE]);case _l.OVERRIDDEN:return this._setBlendFunc([t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA])}},e.prototype._setBlendFunc=function(e){this._rtDefault.setOption("blendFunc",e),this._rtProgressively.setOption("blendFunc",e)},e}(),xl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ml=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},El=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ml(arguments[t]));return e};!function(e){e[e.NODE=0]="NODE",e[e.MATERIAL=1]="MATERIAL",e[e.LAYER=2]="LAYER",e[e.GROUP=3]="GROUP"}(bl||(bl={}));var Tl,Sl,Al,Pl=function(){function e(e,t){this._width=0,this._color=[0,0,0,1],this._nodes=new Map,this._width=e,this._color=t}return e.prototype.add=function(e){this._nodes.set(e.id,e)},e.prototype.remove=function(e){this._nodes.delete(e.id)},e.prototype.getColor=function(){return this._color},e.prototype.getWidth=function(){return this._width},e.prototype.getNode=function(e){return this._nodes.get(e)},e.prototype.getNodes=function(){return Array.from(this._nodes.values())},e.prototype.empty=function(){return 0===this._nodes.size},e}(),kl=function(){function e(e){this._color=[1,1,1,1],this._nodes=new Map,this._color=e}return e.prototype.add=function(e){this._nodes.set(e.id,e)},e.prototype.remove=function(e){this._nodes.delete(e.id)},e.prototype.getColor=function(){return this._color},e.prototype.getNodes=function(){return Array.from(this._nodes.values())},e.prototype.empty=function(){return 0===this._nodes.size},e}(),Ol=function(e){function t(t,r){var i=e.call(this,"ArchDesign",!0,t)||this;i._keyCtrlPressed=!1,i._selector=null,i._selectMode=bl.NODE,i._nodeHovering=null,i._nodesHovering=null,i._nodesSelected=null,i._flood=null,i._outline=null,i._nodesOverriddens=new Map,i._nodesOverriddenContainer=new Map,i._nodesOverlappeds=new Map,i._nodesOverlappedContainer=new Map,i._nodesOutlineds=new Map,i._nodesOutlinedContainer=new Map,i._lineWidthHovering=4,i._lineWidthSelected=2,i._lineColorHovering=[.9686,.4549,.3098,1],i._lineColorSelected=[.8275,.2902,.1255,1],i._lineColorOutlined=[0,0,0,1],i._hoverAndSelectedNodesNeedRendering=!0,i._nodesMap=new Map;var n=t.getResourceManager(),a=t.getMaterialManager(),o=t.getWidth(),s=t.getHeight();return i._outline=new gl(n,a,o,s),i._flood=new wl(n,a,o,s),i._selector=r,i}return xl(t,e),t.prototype.doesSupportMobile=function(e){return!e},t.prototype.destroy=function(){this._outline.destroy()},t.prototype.resize=function(e,t){this._outline.resize(e,t),this._flood.resize(e,t)},t.prototype.recompileShader=function(e){this._outline.recompileShader(e)},t.prototype.addInput=function(e){switch(e.name){case"touch":return this._registerTouchEvents(e);case"mouse":return this._registerMouseEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseUpListener(function(e){return t._onMouseUp(e)},"ArchDesign"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"ArchDesign")},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e.key)},"ArchDesign"),e.addKeyUpListener(function(e){return t._onKeyUp(e.key)},"ArchDesign")},t.prototype._registerTouchEvents=function(e){},t.prototype._onKeyDown=function(e){if(!this._enabled||!this.isInputEnabled())return!1;switch(e){case"Control":this._keyCtrlPressed=!0;break;case"a":case"A":return!0}return!1},t.prototype._onKeyUp=function(e){if(!this._enabled)return!1;if(!this.isInputEnabled())return!1;switch(e){case"Control":this._keyCtrlPressed=!1;break;case"a":case"A":return this._nodesSelected=this._keyCtrlPressed?this._selector.getAllNode():this._nodesSelected,this._viewer.invalidate(),this._viewer.notifyEventListener("NodesSelected",this._nodesSelected.length,this._getOutlineWidthOfSelectedNodes(),this._getFloodColorOfSelectedNodes()),!0;default:return!1}return!1},t.prototype._onMouseMove=function(e){if(e.pressed)return!1;if(!this._enabled)return!1;if(!this.isInputEnabled())return!1;var t=this._selector.getNodeUnderCursor();return t!==this._nodeHovering&&(this._nodeHovering=t,this._updateNodesHoveringAccordingSelectMode(),this._viewer.invalidate(8),!1)},t.prototype._updateNodesHoveringAccordingSelectMode=function(){if(this._nodesHovering=null,this._nodeHovering)switch(this._selectMode){case bl.NODE:return void(this._nodesHovering=[this._nodeHovering]);case bl.LAYER:return void(this._nodesHovering=El(this._nodeHovering.getLayer().getNodes()));case bl.MATERIAL:return void(this._nodesHovering=El(this._nodeHovering.drawable.nodes))}},t.prototype._addOrRemoveNodesHovering=function(){if(this._nodesHovering){if(!this._nodesSelected)return this._refreshNodesSelected();-1!==this._nodesSelected.indexOf(this._nodeHovering)?this._removeNodesHovering():this._addNodesHovering()}},t.prototype._removeNodesHovering=function(){var e=this;this._nodesSelected=this._nodesSelected.filter(function(t){return!e._nodesHovering.includes(t)})},t.prototype._addNodesHovering=function(){var e;(e=this._nodesSelected).push.apply(e,El(this._nodesHovering))},t.prototype._refreshNodesSelected=function(){this._nodesSelected=this._nodesHovering},t.prototype._onMouseUp=function(e){var t,r,i=this;return!e.moved&&(e.button===e.LEFT_BUTTON&&(!!this._enabled&&(!!this.isInputEnabled()&&(!!this._nodesSelectedChanged()&&(this._keyCtrlPressed?this._addOrRemoveNodesHovering():this._refreshNodesSelected(),this._viewer.notifyEventListener("NodesSelected",(null===(t=this._nodesSelected)||void 0===t?void 0:t.length)||0,this._getOutlineWidthOfSelectedNodes(),this._getFloodColorOfSelectedNodes(),this._getOutlineColorOfSelectedNodes()),this._viewer.invalidate(8),this._viewer.notifyEventListener("onNodesSelected",this._nodesSelected),null===(r=this._nodesSelected)||void 0===r||r.forEach(function(e){i._nodesMap.has(e.id)||i._nodesMap.set(e.id,e)}),!1)))))},t.prototype._nodesSelectedChanged=function(){return this._keyCtrlPressed?!!this._nodesHovering:this._nodesHovering!=this._nodesSelected},t.prototype._getOutlineWidthOfSelectedNodes=function(){var e=this;if(!this._nodesSelected)return"unOutlined";if(!this._nodesSelected.some(function(t){return e._nodesOutlinedContainer.has(t)}))return"unOutlined";if(this._nodesSelected.some(function(t){return!e._nodesOutlinedContainer.has(t)}))return"multiWidth";var t=this._nodesOutlinedContainer.get(this._nodesSelected[0]).getWidth();return this._nodesSelected.some(function(r){return e._nodesOutlinedContainer.get(r).getWidth()!==t})?"multiWidth":t},t.prototype._getOutlineColorOfSelectedNodes=function(){var e=this;if(!this._nodesSelected)return"unOutlined";if(!this._nodesSelected.some(function(t){return e._nodesOutlinedContainer.has(t)}))return"unOutlined";if(this._nodesSelected.some(function(t){return!e._nodesOutlinedContainer.has(t)}))return"multiColor";var t=this._nodesOutlinedContainer.get(this._nodesSelected[0]).getColor();return this._nodesSelected.some(function(r){return e._nodesOutlinedContainer.get(r).getColor()!==t})?"multiColor":t},t.prototype._getFloodColorOfSelectedNodes=function(){var e=this;if(!this._nodesSelected)return"unFlooded";if(!this._nodesSelected.some(function(t){return e._nodesOverlappedContainer.has(t)||e._nodesOverriddenContainer.has(t)}))return"unFlooded";if(this._nodesSelected.some(function(t){return!(e._nodesOverlappedContainer.has(t)||e._nodesOverriddenContainer.has(t))}))return"multiColor";var t=this._getNodeOverriddenOrOverlappedColor(this._nodesSelected[0]);return this._nodesSelected.some(function(r){return e._getNodeOverriddenOrOverlappedColor(r)!==t})?"multiColor":t.map(function(e,t){return t<3?255*e:e})},t.prototype._getNodeOverriddenOrOverlappedColor=function(e){var t,r;return(null===(t=this._nodesOverriddenContainer.get(e))||void 0===t?void 0:t.getColor())||(null===(r=this._nodesOverlappedContainer.get(e))||void 0===r?void 0:r.getColor())},t.prototype._onEnableChanged=function(){this.reset()},t.prototype._render=function(){this._renderNodesOverlappeds(),this._renderNodesOverriddens(),this._renderNodesOutlineds(),this._hoverAndSelectedNodesNeedRendering&&(this._renderNodesSelected(),this._renderNodesHovering())},t.prototype._renderNodesOverriddens=function(){var e,t=this;this._flood.setMode(_l.OVERRIDDEN),null===(e=this._nodesOverriddens)||void 0===e||e.forEach(function(e){return t._renderNodesOverridden(e)})},t.prototype._renderNodesOverridden=function(e){var t=e.getColor(),r=e.getNodes(),i=this._isShadowEnabled()?this._getDefaultShadow():null;this._flood.render(this._renderer,this._scene,r,this._camera,t,i)},t.prototype._renderNodesOverlappeds=function(){var e,t=this;this._flood.setMode(_l.OVERLAPPED),null===(e=this._nodesOverlappeds)||void 0===e||e.forEach(function(e){return t._renderNodesOverlapped(e)})},t.prototype._renderNodesOverlapped=function(e){var t=e.getColor(),r=e.getNodes(),i=this._isShadowEnabled()?this._getDefaultShadow():null;this._flood.render(this._renderer,this._scene,r,this._camera,t,i)},t.prototype._renderNodesOutlineds=function(){var e=this;null===this||void 0===this||this._nodesOutlineds.forEach(function(t){return e._renderNodesOutlined(t)})},t.prototype._renderNodesOutlined=function(e){var t=e.getWidth(),r=e.getColor(),i=e.getNodes();i.length>0&&this._outline.render(this._renderer,this._scene,i,this._camera,t,r)},t.prototype._renderNodesSelected=function(){var e;(null===(e=this._nodesSelected)||void 0===e?void 0:e.length)>0&&this._outline.render(this._renderer,this._scene,this._nodesSelected,this._camera,this._lineWidthSelected,this._lineColorSelected)},t.prototype._renderNodesHovering=function(){var e;(null===(e=this._nodesHovering)||void 0===e?void 0:e.length)>0&&this._outline.render(this._renderer,this._scene,this._nodesHovering,this._camera,this._lineWidthHovering,this._lineColorHovering)},t.prototype._renderProgressively=function(){this._renderNodesOverlappedsPR(),this._renderNodesOverriddensPR(),this._renderNodesOutlinedsPR(),this._hoverAndSelectedNodesNeedRendering&&(this._renderNodesSelectedPR(),this._renderNodesHoveringPR())},t.prototype._renderNodesOverriddensPR=function(){var e,t=this;this._flood.setMode(_l.OVERRIDDEN),null===(e=this._nodesOverriddens)||void 0===e||e.forEach(function(e){return t._renderNodesOverriddenPR(e)})},t.prototype._renderNodesOverriddenPR=function(e){var t=e.getColor(),r=e.getNodes(),i=this._isShadowEnabled()?this._getDefaultShadow():null;r.length>0&&this._flood.renderProgressively(this._renderer,this._scene,r,this._camera,t,i)},t.prototype._renderNodesOverlappedsPR=function(){var e,t=this;this._flood.setMode(_l.OVERLAPPED),null===(e=this._nodesOverlappeds)||void 0===e||e.forEach(function(e){return t._renderNodesOverlappedPR(e)})},t.prototype._renderNodesOverlappedPR=function(e){var t=e.getColor(),r=e.getNodes(),i=this._isShadowEnabled()?this._getDefaultShadow():null;r.length>0&&this._flood.renderProgressively(this._renderer,this._scene,r,this._camera,t,i)},t.prototype._renderNodesOutlinedsPR=function(){var e,t=this;null===(e=this._nodesOutlineds)||void 0===e||e.forEach(function(e){return t._renderNodesOutlinedPR(e)})},t.prototype._renderNodesOutlinedPR=function(e){var t=e.getWidth(),r=e.getColor(),i=e.getNodes();i.length>0&&this._outline.renderProgressively(this._renderer,this._scene,i,this._camera,t,r)},t.prototype._renderNodesSelectedPR=function(){var e;(null===(e=this._nodesSelected)||void 0===e?void 0:e.length)>0&&this._outline.renderProgressively(this._renderer,this._scene,this._nodesSelected,this._camera,this._lineWidthSelected,this._lineColorSelected)},t.prototype._renderNodesHoveringPR=function(){var e;(null===(e=this._nodesHovering)||void 0===e?void 0:e.length)>0&&this._outline.renderProgressively(this._renderer,this._scene,this._nodesHovering,this._camera,this._lineWidthHovering,this._lineColorHovering)},t.prototype.setWidthOfSelectedOutline=function(e){this._lineWidthSelected=e,this._viewer.setProgressiveRendering()},t.prototype.setWidthOfHoveringOutline=function(e){this._lineWidthHovering=e,this._viewer.setProgressiveRendering()},t.prototype.setColorOfSelectedOutline=function(e){this._lineColorSelected=e,this._viewer.setProgressiveRendering()},t.prototype.setColorOfHoveringOutline=function(e){this._lineColorHovering=e,this._viewer.setProgressiveRendering()},t.prototype.reset=function(){this._nodesSelected=[],this._nodesOverriddens.clear(),this._nodesOverriddenContainer.clear(),this._nodesOverlappeds.clear(),this._nodesOverlappedContainer.clear(),this._nodesOutlineds.clear(),this._nodesOutlinedContainer.clear(),this._viewer.setProgressiveRendering()},t.prototype.clear=function(){this._nodesOverriddens.clear(),this._nodesOverriddenContainer.clear(),this._nodesOverlappeds.clear(),this._nodesOverlappedContainer.clear(),this._nodesOutlineds.clear(),this._nodesOutlinedContainer.clear(),this._viewer.setProgressiveRendering()},t.prototype._getNodesOutlined=function(e,t){var r=JSON.stringify({width:e,color:t});if(this._nodesOutlineds.has(r))return this._nodesOutlineds.get(r);var i=new Pl(e,t);return this._nodesOutlineds.set(r,i),i},t.prototype.outlineCurrentSelectedNodes=function(e,t){this.outlineSelectedNodes(this._nodesSelected,e,t),this._viewer.notifyEventListener("onArchDesignChanged",{floods:this.getJSONFromNodeMap(this._nodesOverriddens),outlines:this.getJSONFromNodeMap(this._nodesOutlineds)})},t.prototype.outlineSelectedNodes=function(e,t,r){var i=this;r=(r=r||this._lineColorOutlined).map(function(e,t){return t<3?e/255:e}),null===e||void 0===e||e.forEach(function(e){return i._outlineNode(e,t,r)}),this._viewer.setProgressiveRendering()},t.prototype.unOutlineCurrentSelectedNodes=function(){this._unOutlineSelectedNodes(this._nodesSelected)},t.prototype._unOutlineSelectedNodes=function(e){var t=this;null===e||void 0===e||e.forEach(function(e){return t._unOutlineNode(e)}),this._viewer.setProgressiveRendering()},t.prototype.overrideCurrentSelectedNodesWith=function(e){this._overrideSelectedNodesWith(this._nodesSelected,e),this._viewer.notifyEventListener("onArchDesignChanged",{floods:this.getJSONFromNodeMap(this._nodesOverriddens),outlines:this.getJSONFromNodeMap(this._nodesOutlineds)})},t.prototype._overrideSelectedNodesWith=function(e,t){var r=this;t=t.map(function(e,t){return t<3?e/255:e}),null===e||void 0===e||e.forEach(function(e){return r._overrideNode(e,t)}),this._viewer.invalidate(10)},t.prototype._getNodesOverridden=function(e){var t=JSON.stringify(e);if(this._nodesOverriddens.has(t))return this._nodesOverriddens.get(t);var r=new kl(e);return this._nodesOverriddens.set(t,r),r},t.prototype.overlapCurrentSelectedNodesWith=function(e){var t,r=this;e=e.map(function(e,t){return t<3?e/255:e}),null===(t=this._nodesSelected)||void 0===t||t.forEach(function(t){return r._overlapNode(t,e)}),this._viewer.invalidate(10)},t.prototype._overlapNode=function(e,t){var r=this._getNodesOverlapped(t);this._moveNodeOverlapped(e,r)},t.prototype._getNodesOverlapped=function(e){var t=JSON.stringify(e);if(this._nodesOverlappeds.has(t))return this._nodesOverlappeds.get(t);var r=new kl(e);return this._nodesOverlappeds.set(t,r),r},t.prototype._moveNodeOverlapped=function(e,t){var r=this._getFloodedNodeContainer(e);r!==t&&(this._removeFloodedNodeFromContainer(e,r),this._addNodeOverlappedToContainer(e,t))},t.prototype._getFloodedNodeContainer=function(e){return this._nodesOverriddenContainer.get(e)||this._nodesOverlappedContainer.get(e)},t.prototype._removeFloodedNodeFromContainer=function(e,t){var r,i;if(t){t.remove(e),this._nodesOverriddenContainer.delete(e)||this._nodesOverlappedContainer.delete(e);var n=JSON.stringify(t.getColor());(null===(r=this._nodesOverriddens.get(n))||void 0===r?void 0:r.empty())&&this._nodesOverriddens.delete(n),(null===(i=this._nodesOverlappeds.get(n))||void 0===i?void 0:i.empty())&&this._nodesOverlappeds.delete(n)}},t.prototype._removeNodeOverlappedFromContainer=function(e,t){if(!t)return!1;t.remove(e),this._nodesOverlappedContainer.delete(e);var r=JSON.stringify(t.getColor()),i=this._nodesOverlappeds.get(r);return(null===i||void 0===i?void 0:i.empty())&&this._nodesOverlappeds.delete(r),!0},t.prototype._addNodeOverlappedToContainer=function(e,t){t.add(e),this._nodesOverlappedContainer.set(e,t)},t.prototype._moveNodeOverriden=function(e,t){var r=this._getFloodedNodeContainer(e);r!==t&&(this._removeFloodedNodeFromContainer(e,r),this._addNodeOverriddenToContainer(e,t))},t.prototype._removeNodeOverriddenFromContainer=function(e,t){if(!t)return!1;t.remove(e),this._nodesOverriddenContainer.delete(e);var r=JSON.stringify(t.getColor()),i=this._nodesOverriddens.get(r);return(null===i||void 0===i?void 0:i.empty())&&this._nodesOverriddens.delete(r),!0},t.prototype._addNodeOverriddenToContainer=function(e,t){t.add(e),this._nodesOverriddenContainer.set(e,t)},t.prototype.unFloodCurrentSelectedNodes=function(){this._unFloodSelectedNodes(this._nodesSelected)},t.prototype._unFloodSelectedNodes=function(e){var t=this;null===e||void 0===e||e.forEach(function(e){return t._unFloodNode(e)}),this._viewer.setProgressiveRendering()},t.prototype._unFloodNode=function(e){var t=this._getFloodedNodeContainer(e);this._removeFloodedNodeFromContainer(e,t)},t.prototype._unOutlineNode=function(e){var t=this._nodesOutlinedContainer.get(e);this._removeNodeOutlinedFromContainer(e,t)},t.prototype._outlineNode=function(e,t,r){var i=this._nodesOutlinedContainer.get(e),n=this._getNodesOutlined(t,r);i!==n&&(this._removeNodeOutlinedFromContainer(e,i),this._addNodeOutlinedToContainer(e,n))},t.prototype._removeNodeOutlinedFromContainer=function(e,t){if(t){t.remove(e),this._nodesOutlinedContainer.delete(e);var r=t.getWidth(),i=t.getColor(),n=JSON.stringify({w:r,c:i}),a=this._nodesOutlineds.get(n);(null===a||void 0===a?void 0:a.empty())&&this._nodesOutlineds.delete(n)}},t.prototype._addNodeOutlinedToContainer=function(e,t){this._nodesOutlinedContainer.set(e,t),t.add(e)},t.prototype._overrideNode=function(e,t){var r=this._getNodesOverridden(t);this._moveNodeOverriden(e,r)},t.prototype._increaseOutlineWidthOfSelectedNodes=function(){var e=this;this._nodesSelected.forEach(function(t){return e._increaseOutlineWidthOfNode(t)})},t.prototype._decreaseOutlineWidthOfSelectedNodes=function(){var e=this;this._nodesSelected.forEach(function(t){return e._decreaseOutlineWidthOfNode(t)})},t.prototype._increaseFloodedColorTransparencyOfSelectedNodes=function(){var e=this;this._nodesSelected.forEach(function(t){return e._increaseTransparencyOfNodeOverridden(t)})},t.prototype._decreaseFloodedColorTransparencyOfSelectedNodes=function(){var e=this;this._nodesSelected.forEach(function(t){return e._decreaseTransparencyOfNodeOverridden(t)})},t.prototype._increaseOutlineWidthOfNode=function(e){var t=1,r=[0,0,0,1],i=this._nodesOutlinedContainer.get(e);i&&(t=i.getWidth()+1,r=i.getColor(),i.remove(e)),t=Math.min(t,8),this._outlineNode(e,t,r),this._viewer.invalidate(5)},t.prototype._decreaseOutlineWidthOfNode=function(e){var t=0,r=[0,0,0,1],i=this._nodesOutlinedContainer.get(e);i&&(t=i.getWidth()-1,r=i.getColor(),i.remove(e)),t=Math.max(t,0),this._outlineNode(e,t,r),this._viewer.invalidate(5)},t.prototype._increaseTransparencyOfNodeOverridden=function(e){var t=this._nodesOverriddenContainer.get(e);if(t){var r=El(t.getColor());r[3]+=.1,r[3]=Math.min(r[3],1),this._overrideNode(e,r),this._viewer.invalidate(5)}},t.prototype._decreaseTransparencyOfNodeOverridden=function(e){var t=this._nodesOverriddenContainer.get(e);if(t){var r=El(t.getColor());r[3]-=.1,r[3]=Math.max(r[3],0),this._overrideNode(e,r),this._viewer.invalidate(5)}},t.prototype.disableRenderingOfHoverAndSelectedNodes=function(){this._hoverAndSelectedNodesNeedRendering=!1},t.prototype.enableRenderingOfHoverAndSelectedNodes=function(){this._hoverAndSelectedNodesNeedRendering=!0},t.prototype.setSelectMode=function(e){this._selectMode=e},t.prototype.unSelectAll=function(){this._nodesSelected&&(this._nodesSelected=null,this._viewer.invalidate())},t.prototype.setOutlineDefaultColor=function(e){this._lineColorOutlined=e},t.prototype.getOutlineDefaultColor=function(){return this._lineColorOutlined},t.prototype.updateOutlineWidth=function(e){var t=this;e.forEach(function(e){var r=e.nodeIds,i=e.width,n=t._getNodesByIds(r);void 0!=i?t.outlineSelectedNodes(n,i):t._unOutlineSelectedNodes(n)})},t.prototype.updateOutlineColor=function(e){var t=this;e.forEach(function(e){var r=e.nodeIds,i=e.width,n=e.outlineColor,a=t._getNodesByIds(r);n?t.outlineSelectedNodes(a,i,n):t.outlineSelectedNodes(a,i)})},t.prototype.updateFloodColor=function(e){var t=this;e.forEach(function(e){var r=e.nodeIds,i=e.color,n=t._getNodesByIds(r);i?t._overrideSelectedNodesWith(n,i):t._unFloodSelectedNodes(n)})},t.prototype._getNodesByIds=function(e){var t,r=[];for(var i in this._scene.models){t=this._scene.models[i];break}var n=t.tree.nodes;return e.forEach(function(e){var t=n[parseInt(e)];t&&r.push(t)}),r},t.prototype.getJSONFromNodeMap=function(e){var t={};return e.values[0],e.forEach(function(e,r){var i=e.getNodes();i.length>0&&(t[r]=i.map(function(e){return e.id}))}),t},t}(gr.a),Dl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Nl=function(){return function(){this.eye=U.d.create(),this.at=U.d.create(),this.angleDiff=0}}(),Cl=function(e){function t(t){var r=e.call(this,"CameraNavigator",!1,t)||this;return r._rotationDuration=100,r._updateDatas=function(){if(r._animating){r._currentStep++;for(var e=r._currentStep*r._speed,t=0;t<r._keyPoints.length&&!(r._distances[t]>e);t++);if(t===r._keyPoints.length){var i=r._keyPoints[r._keyPoints.length-1];r._moveTo(i.eye,i.at),r.stop()}else{var n=(e-r._distances[t-1])/(r._distances[t]-r._distances[t-1]);U.d.lerp(r._tmpKeypoint.eye,r._keyPoints[t-1].eye,r._keyPoints[t].eye,n),U.d.rotateZ(r._tmpKeypoint.at,r._keyPoints[t-1].at,r._keyPoints[t-1].eye,r._keyPoints[t].angleDiff*n),U.d.subtract(r._tmpKeypoint.at,r._tmpKeypoint.at,r._keyPoints[t-1].eye),U.d.add(r._tmpKeypoint.at,r._tmpKeypoint.at,r._tmpKeypoint.eye),r._moveTo(r._tmpKeypoint.eye,r._tmpKeypoint.at)}}},r._keyPoints=[],r._distances=[],r._speed=.5,r._animator=new Or.a(t.getEventEmitter()),r._animating=!1,r._currentStep=0,r._tmpKeypoint=new Nl,r._viewer.getEventEmitter().on("before-rendering",r._updateDatas),r}return Dl(t,e),t.prototype.destroy=function(){this._keyPoints=null,delete this._keyPoints,this._distances=null,delete this._distances,this._speed=null,delete this._speed,this._animator=null,delete this._animator,this._animating=null,delete this._animating,this._currentStep=null,delete this._currentStep,this._tmpKeypoint=null,delete this._tmpKeypoint,this._viewer.getEventEmitter().remove("before-rendering",this._updateDatas),e.prototype.destroy.call(this)},t.prototype.setRotationDuration=function(e){this._rotationDuration=e},t.prototype.clearKeyPoints=function(){this._keyPoints.length=0},t.prototype._reCalculateKeyPoints=function(){var e=[];this._distances.length=0;var t=this._keyPoints.length;for(t=1;t<this._keyPoints.length;t++){var r=this._keyPoints[t-1],i=this._keyPoints[t],n=U.d.distance(i.eye,r.eye);if(1==t)this._distances.push(0),this._distances.push(n),r.at=U.d.clone(i.eye),U.d.subtract(i.at,r.at,r.eye),U.d.add(i.at,i.at,i.eye),e.push(r),e.push(i);else{var a=new Nl;a.eye=U.d.clone(r.eye),U.d.subtract(a.at,i.eye,r.eye),U.d.add(a.at,a.eye,a.at),U.d.subtract(i.at,a.at,a.eye),U.d.add(i.at,i.at,i.eye);var o=U.d.create(),s=U.d.create();U.d.subtract(o,a.at,a.eye),U.d.subtract(s,r.at,r.eye),U.d.normalize(o,o),U.d.normalize(s,s);var l=Math.acos(U.d.dot(o,s)),u=U.d.create();U.c.cross(u,s,o),l=u[2]>=0?l:-l,a.angleDiff=l,this._distances.push(this._distances[this._distances.length-1]+Math.abs(l)*this._rotationDuration),this._distances.push(this._distances[this._distances.length-1]+n),e.push(a),e.push(i)}}this._keyPoints=e},t.prototype.addKeyPoint=function(e){var t=new Nl;t.eye=e,this._keyPoints.push(t)},t.prototype.setSpeed=function(e){this._speed=e},t.prototype.start=function(){this._keyPoints.length<2||(this._reCalculateKeyPoints(),this._camera.eye=U.d.clone(this._keyPoints[0].eye),this._camera._at=U.d.clone(this._keyPoints[0].at),this._animating=!0,this._currentStep=0)},t.prototype.stop=function(){this._animating=!1},t.prototype.resume=function(){this._animating=!0},t.prototype._moveTo=function(e,t){this._animator.attach(this._camera),this._animator.start(e,t),this._animator.stop()},t}(gr.a),Il=function(){function e(e,t,r){void 0===t&&(t=[0,0,1]),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=U.d.clone(e[i]);this._useDefaultUpVector=r,this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t,r){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._useDefaultUpVector=r,this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),U.d.normalize(this._tangents[0],this._tangents[0]),this._tangents[t-1]=U.d.create(),U.d.subtract(this._tangents[t-1],this._curve[t-1],this._curve[t-2]),U.d.normalize(this._tangents[t-1],this._tangents[t-1]);var r,i,n,a=this._tangents[0],o=this._normalVector(a,e);this._normals[0]=o,U.d.normalize(this._normals[0],this._normals[0]),this._binormals[0]=U.d.create(),U.d.cross(this._binormals[0],a,this._normals[0]),U.d.normalize(this._binormals[0],this._binormals[0]),this._distances[0]=0;for(var s=U.d.create(),l=1;l<t;l++)r=this._getLastNonNullVector(l),l<t-1&&(i=this._getFirstNonNullVector(l),this._tangents[l]=U.d.create(),this._tangents[l]=i,U.d.normalize(this._tangents[l],this._tangents[l])),this._distances[l]=this._distances[l-1]+U.d.length(r),n=this._tangents[l],this._binormals[l-1],this._normals[l]=U.d.create(),U.d.cross(s,n,this._normals[l-1]),U.d.cross(this._normals[l],s,n),U.d.normalize(this._normals[l],this._normals[l]),this._binormals[l]=U.d.create(),U.d.cross(this._binormals[l],n,this._normals[l]),U.d.normalize(this._binormals[l],this._binormals[l])},e.prototype._getFirstNonNullVector=function(e){var t=1,r=U.d.create();for(U.d.subtract(r,this._curve[e+t],this._curve[e]),this._useDefaultUpVector&&(r[2]=0);0===U.d.length(r)&&e+t+1<this._curve.length;)t++,U.d.subtract(r,this._curve[e+t],this._curve[e]),this._useDefaultUpVector&&(r[2]=0);return 0===U.d.length(r)&&(r=U.d.fromValues(0,1,0)),r},e.prototype._getLastNonNullVector=function(e){var t=1,r=U.d.create();for(U.d.subtract(r,this._curve[e],this._curve[e-t]),this._useDefaultUpVector&&(r[2]=0);0===U.d.length(r)&&e>t+1;)t++,r=this._curve[e].subtract(this._curve[e-t]),this._useDefaultUpVector&&(r[2]=0);return 0===U.d.length(r)&&(r=U.d.fromValues(0,1,0)),r},e.prototype._normalVector=function(e,t){var r,i=U.d.create(),n=U.d.length(e);(0===n&&(n=1),void 0===t||null===t)?(r=Math.abs(Math.abs(e.y)/n-1)>.001?[0,-1,0]:Math.abs(Math.abs(e.x)/n-1)>.001?[1,0,0]:Math.abs(Math.abs(e.z)/n-1)>.001?[0,0,1]:U.d.create(),U.d.cross(i,e,r)):(U.d.cross(i,e,t),U.d.cross(i,i,e));return U.d.normalize(i,i),i},e}(),Rl=function(){function e(e,t,r){var i=this;void 0===r&&(r=!0),this._update=function(){if(i._playing){var e=i._speed*i._frameNumber;if(e>i._distances[i._distances.length-1]){if(!i._loop)return void(i._playing=!1);e=0,i._frameNumber=0}for(var t=0;t<i._distances.length-2&&!(e>=i._distances[t]&&e<i._distances[t+1]);t++);var r=(e-i._distances[t])/(i._distances[t+1]-i._distances[t]);U.d.lerp(i._currentPosition,i._points[t],i._points[t+1],r),i._currentPoseMatrix=[i._binormals[t][0],i._binormals[t][1],i._binormals[t][2],0,i._tangents[t][0],i._tangents[t][1],i._tangents[t][2],0,i._normals[t][0],i._normals[t][1],i._normals[t][2],0,i._currentPosition[0],i._currentPosition[1],i._currentPosition[2],1];for(var n=0;n<i._pawns.length;n++)U.a.copy(i._currentMatrix,i._pawns[n].getTransformMatrix()),i._currentMatrix[12]=0,i._currentMatrix[13]=0,i._currentMatrix[14]=0,U.a.multiply(i._currentMatrix,i._currentPoseMatrix,i._currentMatrix),i._pawns[n].drawables.forEach(function(e){e.transform.set(i._currentMatrix),e.updateBBox()});i._frameNumber++}},this._useDefaultUpVector=r;var n=new Il(t,[0,0,1],r);this._points=n.getCurve(),this._normals=n.getNormals(),this._tangents=n.getTangents(),this._binormals=n.getBinormals(),this._distances=n.getDistances(),this._pawns=[],this._speed=.1,this._frameNumber=0,this._currentPoseMatrix=U.a.create(),this._currentMatrix=U.a.create(),this._playing=!1,this._currentPosition=U.d.create(),this._loop=!0,this._viewer=e,e.getEventEmitter().on("before-rendering",this._update)}return e.prototype.destroy=function(){this._useDefaultUpVector=null,delete this._useDefaultUpVector,this._points=null,delete this._points,this._normals=null,delete this._normals,this._tangents=null,delete this._tangents,this._binormals=null,delete this._binormals,this._distances=null,delete this._distances,this._pawns=null,delete this._pawns,this._speed=null,delete this._speed,this._frameNumber=null,delete this._frameNumber,this._currentPoseMatrix=null,delete this._currentPoseMatrix,this._currentMatrix=null,delete this._currentMatrix,this._playing=null,delete this._playing,this._currentPosition=null,delete this._currentPosition,this._viewer=null,delete this._viewer,this._viewer.getEventEmitter().remove("before-rendering",this._update)},e.prototype.isInteractive=function(){return!0},e.prototype.doesSupportMobile=function(e){return!0},e.prototype.addPawn=function(e){this._pawns.push(e)},e.prototype.start=function(){this._playing=!0,this._frameNumber=0},e.prototype.stop=function(){this._playing=!1},e.prototype.resume=function(){this._playing=!0},e.prototype.setSpeed=function(e){this._speed=e},e.prototype.setLoop=function(e){this._loop=e},e}(),Bl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ll=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(e){e.AXIS_X="axis-x",e.AXIS_Y="axis-y",e.AXIS_Z="axis-z",e.ROTATE_XY="rotate-xy",e.ROTATE_YZ="rotate-yz",e.ROTATE_XZ="rotate-xz",e.TRANSLATE_XY="translate-xy",e.TRANSLATE_YZ="translate-yz",e.TRANSLATE_XZ="translate-xz",e.TRANSLATE_XYZ="translate-xyz"}(Al||(Al={}));var Fl,Ul=((Tl={})[Al.AXIS_X]=U.e.fromValues(1,85/255,.2,1),Tl[Al.AXIS_Y]=U.e.fromValues(22/255,217/255,168/255,1),Tl[Al.AXIS_Z]=U.e.fromValues(26/255,122/255,248/255,1),Tl[Al.ROTATE_XY]=U.e.fromValues(26/255,122/255,248/255,1),Tl[Al.ROTATE_YZ]=U.e.fromValues(1,85/255,.2,1),Tl[Al.ROTATE_XZ]=U.e.fromValues(22/255,217/255,168/255,1),Tl[Al.TRANSLATE_XY]=U.e.fromValues(.8,.8,.8,1),Tl[Al.TRANSLATE_YZ]=U.e.fromValues(.8,.8,.8,1),Tl[Al.TRANSLATE_XZ]=U.e.fromValues(.8,.8,.8,1),Tl[Al.TRANSLATE_XYZ]=U.e.fromValues(.4,.4,.4,1),Tl.picked=U.e.fromValues(1,171/255,0,1),Tl),Vl=((Sl={})[Al.AXIS_X]={axis:[0,1,0],angle:Math.PI/2},Sl[Al.AXIS_Y]={axis:[1,0,0],angle:-Math.PI/2},Sl[Al.AXIS_Z]={axis:[0,0,1],angle:0},Sl[Al.ROTATE_XY]={axis:[0,0,1],angle:0},Sl[Al.ROTATE_YZ]={axis:[0,1,0],angle:-Math.PI/2},Sl[Al.ROTATE_XZ]={axis:[1,0,0],angle:Math.PI/2},Sl[Al.TRANSLATE_XY]={axis:[0,0,1],angle:0},Sl[Al.TRANSLATE_YZ]={axis:[0,1,0],angle:-Math.PI/2},Sl[Al.TRANSLATE_XZ]={axis:[1,0,0],angle:Math.PI/2},Sl[Al.TRANSLATE_XYZ]={axis:[0,0,1],angle:0},Sl),jl=new Float32Array([1,1,1]),zl=U.a.create(),Gl=function(e){function t(t,r,i){void 0===i&&(i=1);var n=e.call(this,"TransformGizmo",!0,t)||this;if(n._pickedWorldPositionOnGizmo=[0,0,0],n._needAdsorb=!0,n._blockRotate=!1,n._rotation=0,n._rotationAfterSnap=0,n._minimumSnapAngle=Math.PI/36,n._translation=[0,0,0],n._planeNormal=[0,0,0],n.revokeEnabled=!0,n._transformMatrix=U.a.create(),r){if(n._actor=t.getScene().core.models[r],!n._actor)return console.warn("No modelId "+r+" is found!"),n.destroy(),n;n._actor.updateBBox(),n._actor.isMatrixIdentity&&(n._actor.drawables.forEach(function(e){e.recompileShader("MODEL_TRANSFORM",!0)}),t.invalidate()),n._transformMatrix[12]=.5*(n._actor.bbox[0]+n._actor.bbox[3]),n._transformMatrix[13]=.5*(n._actor.bbox[1]+n._actor.bbox[4]),n._transformMatrix[14]=.5*(n._actor.bbox[2]+n._actor.bbox[5])}return n._rtDefault=n._getRenderTarget({depthTest:!0}),n._rtProgressively=n._getRenderTargetPR({depthTest:!0}),n._picked=null,n._drawables=[],n._hoverDrawables=[],n._activeDrawables=[],n._scale=.15*i,n._scaleMatrix=U.a.create(),n._tempMat=U.a.create(),n._needAdsorb=!0,n._blockRotate=!1,n._keyOperation=[],n._unkeyOperation=[],n._mouseCumulative=U.c.create(),n._planeNormal=U.d.create(),n._isMouseDown=!1,n._startSnap=!1,n._viewer.getEventEmitter().on("modelTransformUpdate",function(e){n.updateGizmo(e)}),n}return Bl(t,e),Object.defineProperty(t.prototype,"minimumSnapAngle",{get:function(){return this._minimumSnapAngle},set:function(e){this._minimumSnapAngle=Math.floor(Math.abs(180*e/Math.PI))%90*Math.PI/180},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actor",{get:function(){return this._actor},enumerable:!1,configurable:!0}),t.prototype.setEntity=function(e){if(void 0===e)return this._actor=void 0,this._picked=void 0,void this._viewer.invalidate();if("string"==typeof e){if(this._actor&&this._actor.name===e)return;this._actor=this._viewer.getScene().core.models[e]}else{if(this._actor&&this._actor.name===e.name)return;this._actor=e}if(!this._actor)return console.warn("No modelId "+e+" is found!"),void this.destroy();var t=this._actor.getTransformMatrix();this._actor.isMatrixIdentity&&(this._actor.drawables.forEach(function(e){e.recompileShader("MODEL_TRANSFORM",!0)}),this._viewer.invalidate()),U.a.copy(this._transformMatrix,t),this._recordOperation()},t.prototype.setModel=function(e){if(console.warn("plese use setEntity to instead of setModel"),"string"==typeof e){if(this._actor&&this._actor.name===e)return;this._actor=this._viewer.getScene().core.models[e]}else{if(this._actor&&this._actor.name===e.name)return;this._actor=e}if(!this._actor)return console.warn("No modelId "+e+" is found!"),void this.destroy();var t=this._actor.getTransformMatrix();this._actor.isMatrixIdentity&&(this._actor.drawables.forEach(function(e){e.recompileShader("MODEL_TRANSFORM",!0)}),this._viewer.invalidate()),U.a.copy(this._transformMatrix,t),this._recordOperation()},t.prototype.destroy=function(){this._drawables.length>0&&this._drawables.forEach(function(e){e.destroy()}),this._drawables=null,delete this._drawables,this._activeDrawables.length>0&&this._activeDrawables.forEach(function(e){e.destroy()}),this._activeDrawables=null,delete this._activeDrawables,this._pickQuery&&(this._pickQuery.destroy(),this._pickQuery=null,delete this._pickQuery),this._depthQuery&&(this._depthQuery.destroy(),this._depthQuery=null,delete this._depthQuery),this._actor=null,delete this._actor},t.prototype._onEnableChanged=function(){if(this._viewer.invalidate(),!this._enabled)return this._picked=null,void(this._actor=null);this._drawables.length>0||(this._createGizmo(),this._pickQuery=new Jr.a(this._scene,this._resourceManager),this._depthQuery=new br.a(this._scene,this._resourceManager))},t.prototype._render=function(){this._enabled&&this._drawables.length&&this._actor&&(this._beginRenderGizmo(),this._drawGizmo())},t.prototype._renderProgressively=function(){this._enabled&&this._drawables.length&&this._actor&&(this._beginRenderGizmo(),this._drawGizmoProgressively())},t.prototype._beginRenderGizmo=function(){var e=this;U.a.identity(this._scaleMatrix);var t=U.d.create(),r=U.d.fromValues(this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]);U.d.subtract(t,this._camera._at,this._camera.eye),U.d.normalize(t,t),U.d.subtract(r,r,this._camera.eye),U.a.getScaling(jl,this._transformMatrix),this._scaleMatrix[0]=this._scaleMatrix[5]=this._scaleMatrix[10]=U.d.dot(t,r)/jl[0],U.a.multiply(this._scaleMatrix,this._transformMatrix,this._scaleMatrix),this._drawables.forEach(function(t,r){if(U.a.fromRotation(e._tempMat,Vl[t.name].angle,Vl[t.name].axis),r<3&&(U.a.fromTranslation(zl,[0,0,.1*e._scale]),U.a.multiply(e._tempMat,e._tempMat,zl)),U.a.multiply(e._tempMat,e._scaleMatrix,e._tempMat),r>5&&r<9){var i=.15*e._scale;U.a.fromTranslation(zl,[i,i,0]),U.a.multiply(e._tempMat,e._tempMat,zl)}t.setTransformMatrix(e._tempMat),e._hoverDrawables[r].setTransformMatrix(e._tempMat),e._activeDrawables[r].setTransformMatrix(e._tempMat)})},t.prototype._drawGizmo=function(){var e=this;this._renderer.clear(this._rtDefault,this._resourceManager.gl.DEPTH_BUFFER_BIT),this._drawables.forEach(function(t){return e._renderer.drawGizmo(e._rtDefault,t,e._camera)}),this._activeDrawables.forEach(function(t){return e._renderer.drawGizmo(e._rtDefault,t,e._camera)})},t.prototype._drawGizmoProgressively=function(){var e=this;this._renderer.clear(this._rtProgressively,this._resourceManager.gl.DEPTH_BUFFER_BIT),this._drawables.forEach(function(t){return e._renderer.drawGizmo(e._rtProgressively,t,e._camera)}),this._activeDrawables.forEach(function(t){return e._renderer.drawGizmo(e._rtProgressively,t,e._camera)})},t.prototype.updateGizmo=function(e,t){if(void 0===t&&(t=!0),this.actor&&(void 0===e||this._actor.name===e)&&this._actor&&this._actor instanceof Z){var r=this._actor.getTransformMatrix();U.a.copy(this._transformMatrix,r),t&&this._recordOperation()}},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"TransformGizmo"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"TransformGizmo"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"TransformGizmo")},t.prototype._registerTouchEvents=function(e){var t=this;e.addTouchStartListener(function(e){return t._onTouchStart(e)},"TransformGizmo"),e.addTouchStopListener(function(e){return t._onTouchStop(e)},"TransformGizmo"),e.addTouchMoveListener(function(e){return t._onTouchMove(e)},"TransformGizmo")},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e)},"TransformGizmo"),e.addKeyUpListener(function(e){return t._onKeyUp(e)},"TransformGizmo")},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype._recordOperation=function(e){var t=U.a.clone(this._transformMatrix);this._keyOperation.length>=20&&this._keyOperation.shift();var r={actor:e||this._actor,matrix:t};this._keyOperation.push(r),this._keyOperation.length>1&&this._viewer.getEventEmitter().emit("TransformGizmo-revokeEnabled",!0)},t.prototype._onMouseDown=function(e){if(!this._picked)return!1;this._depthQuery.phonyCamera.enabledCull=!1;var t=this._depthQuery.unproject(e.x,e.y,this._renderer,this._camera,this._hoverDrawables);return this._depthQuery.phonyCamera.enabledCull=!0,U.d.copy(this._pickedWorldPositionOnGizmo,t),this._mouseCumulative=U.c.create(),this._blockRotate=!1,this._recordOperation(),this._currentAxisX=U.d.fromValues(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2]),U.d.normalize(this._currentAxisX,this._currentAxisX),this._currentAxisY=U.d.fromValues(this._transformMatrix[4],this._transformMatrix[5],this._transformMatrix[6]),U.d.normalize(this._currentAxisY,this._currentAxisY),this._currentAxisZ=U.d.fromValues(this._transformMatrix[8],this._transformMatrix[9],this._transformMatrix[10]),U.d.normalize(this._currentAxisZ,this._currentAxisZ),U.a.getTranslation(this._planeNormal,this._transformMatrix),U.d.sub(this._planeNormal,this._camera.eye,this._planeNormal),U.d.normalize(this._planeNormal,this._planeNormal),this._rotation=0,this._translation[0]=this._translation[1]=this._translation[2]=0,this._viewer.setProgressiveRendering(0),this._viewer.notifyEventListener("TransformGizmo-Start",this._picked.name),this._isMouseDown=!0,this._startSnap=!1,!0},t.prototype._onMouseUp=function(e){return!!this._isMouseDown&&(!!this._picked&&(this.unsetActiveMode(),0===U.c.len(this._mouseCumulative)&&this._viewer.notifyEventListener("TransformGizmo-Click",this._picked.name,[e.x,e.y]),this._viewer.getScene().core.updateBBox(),this._viewer.setProgressiveRendering(16),this._viewer.notifyEventListener("TransformGizmo-End",this._picked.name),this._isMouseDown=!1,!0))},t.prototype._onMouseMove=function(e){return!!this._enabled&&(e.pressed?this._moveGizmo(e):this._hoverGizmo(e))},t.prototype._moveGizmo=function(e){return!!this._picked&&(this._updateTransformForModel(e),this._scene.updateBBox(),this._viewer.setProgressiveRendering(0),this._viewer.invalidate(16),this._viewer.notifyEventListener("TransformGizmo-Move"),!0)},t.prototype._hoverGizmo=function(e){if(!this.actor)return!1;var t=this._pickQuery.pickDrawable(e.x,e.y,this._renderer,this._camera,this._hoverDrawables,!0);if(t){var r=this._hoverDrawables.indexOf(t);if(!(r>-1))return!1;t=this._drawables[r]}return t!==this._picked&&(t&&t.setColor(Ul.picked),this._picked&&this._picked.setColor(Ul[this._picked.name]),this._picked=t,this._viewer.invalidate(1),!0)},t.prototype._onTouchStart=function(e){if(!this._enabled)return!1;var t=this._pickQuery.pickDrawable(e.cursor(0).x,e.cursor(0).y,this._renderer,this._camera,this._drawables,!0);return t!==this._picked&&(this._picked&&this._picked.setColor(Ul[this._picked.name]),this._picked=t,this._picked&&(this._picked.setColor(Ul.picked),this._picked&&(this._currentAxisX=U.d.fromValues(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2]),this._currentAxisY=U.d.fromValues(this._transformMatrix[4],this._transformMatrix[5],this._transformMatrix[6]),this._currentAxisZ=U.d.fromValues(this._transformMatrix[8],this._transformMatrix[9],this._transformMatrix[10]))),!0)},t.prototype._onTouchStop=function(e){return!!this._enabled&&(this._picked&&(this._picked.setColor(Ul[this._picked.name]),this._viewer.getEventEmitter().emit("TransformGizmo-End",this._picked.name)),this._picked=null,!0)},t.prototype._onTouchMove=function(e){return!!this._enabled&&(!(1!==e.numCursors||!this._picked)&&(this._updateTransformForModel(e),this._scene.updateBBox(),this._viewer.invalidate(),this._viewer.getEventEmitter().emit("TransformGizmo-Move"),!0))},t.prototype._onKeyDown=function(e){return!!this._enabled&&("Control"===e.key&&(this._isCtrlDown=!0),!(!this._isCtrlDown||"z"!==e.key&&"Z"!==e.key)&&(this.revokeOperation(),!1))},t.prototype._onKeyUp=function(e){return!!this._enabled&&("Control"===e.key&&(this._isCtrlDown=!1),!1)},t.prototype._intersectPlane=function(e,t,r,i){var n=U.d.create();U.d.sub(n,t,e);var a=(i-U.d.dot(e,r))/U.d.dot(n,r),o=U.d.create();return U.d.scaleAndAdd(o,e,n,a),o},t.prototype._getTranslationAlongAxisFromPlane=function(e,t,r,i,n){t=this._camera.unproject(t[0],t[1]),e=this._camera.unproject(e[0],e[1]);var a=this._intersectPlane(this._camera.eye,e,i,n),o=this._intersectPlane(this._camera.eye,t,i,n);U.d.sub(a,a,o);var s=U.d.create(),l=U.d.dot(a,r)/U.d.length(r);return U.d.scale(s,r,l),s},t.prototype._getTranslationFromPlane=function(e,t,r,i){t=this._camera.unproject(t[0],t[1]),e=this._camera.unproject(e[0],e[1]);var n=this._intersectPlane(this._camera.eye,e,r,i),a=this._intersectPlane(this._camera.eye,t,r,i);return U.d.sub(n,n,a),n},t.prototype._getTranslation=function(e,t,r,i){var n=U.d.create(),a=U.c.create(),o=U.d.create(),s=U.d.create(),l=U.a.create();l[12]=this._transformMatrix[12],l[13]=this._transformMatrix[13],l[14]=this._transformMatrix[14];var u=this._camera.project(r,l),c=this._camera.project(s,l);U.c.sub(n,e,t),a=U.c.fromValues(u[0]-c[0],u[1]-c[1]),U.c.normalize(a,a);var h=U.c.dot(n,a),d=this._camera._distance/(this._camera.viewport[2]-this._camera.viewport[0]);return U.d.scale(o,r,h*d),o},t.prototype._getRotation=function(e,t,r,i,n){t=this._camera.unproject(t[0],t[1]),e=this._camera.unproject(e[0],e[1]);var a=this._intersectPlane(this._camera.eye,e,r,i),o=this._intersectPlane(this._camera.eye,t,r,i),s=U.d.fromValues(this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]);if(U.d.sub(a,a,s),U.d.sub(o,o,s),0===U.d.distance(a,o))return 0;var l=Math.acos(U.d.dot(a,o)/U.d.length(a)/U.d.length(o));U.d.cross(a,o,a),l*=Math.sign(U.d.dot(a,r));var u=!1;if(this._needAdsorb&&(Math.abs(this._rotation)>this.minimumSnapAngle||this._startSnap)){this._startSnap=!0;var c=U.d.create(),h=U.d.create(),d=U.d.fromValues(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2]),p=U.d.fromValues(this._transformMatrix[4],this._transformMatrix[5],this._transformMatrix[6]),f=U.d.fromValues(this._transformMatrix[8],this._transformMatrix[9],this._transformMatrix[10]),_=U.d.fromValues(1,0,0),m=U.d.fromValues(0,1,0),v=U.d.fromValues(0,0,1),y=void 0,g=void 0,b=void 0;switch(n){case"rotate-xy":g=U.d.angle(m,f),b=U.d.angle(_,f),y=Math.abs(g-Math.PI/2)-Math.abs(b-Math.PI/2)>0?_:m,U.d.cross(h,y,f),U.d.copy(c,d);break;case"rotate-yz":g=U.d.angle(m,d),b=U.d.angle(v,d),y=Math.abs(g-Math.PI/2)-Math.abs(b-Math.PI/2)>0?v:m,U.d.cross(h,y,d),U.d.copy(c,p);break;case"rotate-xz":g=U.d.angle(_,p),b=U.d.angle(m,p),y=Math.abs(g-Math.PI/2)-Math.abs(b-Math.PI/2)>0?m:_,U.d.cross(h,y,p),U.d.copy(c,f)}U.d.normalize(c,c);var w=U.d.angle(c,h),x=0,M=this._minimumSnapAngle,E=Math.abs(this._rotation)-Math.floor(Math.abs(this._rotation)/(Math.PI/4))*(Math.PI/4);if(Math.abs(w)<M?(u=!0,x=l>0?Math.abs(w):-Math.abs(w)):Math.abs(w+Math.PI/2)<M?(u=!0,x=l>0?Math.abs(w+Math.PI/2):-Math.abs(w+Math.PI/2)):Math.abs(w-Math.PI/2)<M?(u=!0,x=l>0?Math.abs(w-Math.PI/2):-Math.abs(w-Math.PI/2)):Math.abs(Math.abs(w)-Math.PI)<M?(u=!0,x=l>0?Math.PI-Math.abs(w):Math.abs(w)-Math.PI):E<M?(u=!0,x=(l>0?1:-1)*E):E>=Math.PI/4-M&&(u=!0,x=(l>0?1:-1)*(Math.PI/4-E)),u&&this._blockRotate&&(this._rotationAfterSnap+=l,Math.abs(this._rotationAfterSnap)>M)){u=!1,this._blockRotate=!1;var T=this._rotationAfterSnap;return this._rotationAfterSnap=0,T}if(u){T=this._blockRotate?0:x;return this._rotationAfterSnap-=x,this._blockRotate=!0,T}}return l},t.prototype._updateTransformForModel=function(e){var t,r,i;e instanceof h?(t=U.c.fromValues(e.x,e.y),i=U.c.fromValues(e.dx,e.dy),r=U.c.fromValues(e.x-e.dx,e.y-e.dy)):(t=U.c.fromValues(e.cursor(0).x,e.cursor(0).y),i=U.c.fromValues(e.cursor(0).dx,e.cursor(0).dy),r=U.c.fromValues(e.cursor(0).x-e.cursor(0).dx,e.cursor(0).y-e.cursor(0).dy)),U.c.add(this._mouseCumulative,this._mouseCumulative,[Math.abs(i[0]),Math.abs(i[1])]);var n=[0,0,0],a=0,o=[0,0,1],s=0,l=U.d.fromValues(this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]);switch(this.setActiveModeByTransformType(this._picked.name),this._picked.name){case Al.AXIS_X:o=this._currentAxisX,s=U.d.dot(l,this._planeNormal)/U.d.length(this._planeNormal),n=this._getTranslationFromPlane(t,r,this._planeNormal,s),U.d.scale(n,o,U.d.dot(n,o));break;case Al.AXIS_Y:o=this._currentAxisY,s=U.d.dot(l,this._planeNormal)/U.d.length(this._planeNormal),n=this._getTranslationFromPlane(t,r,this._planeNormal,s),U.d.scale(n,o,U.d.dot(n,o));break;case Al.AXIS_Z:o=this._currentAxisZ,s=U.d.dot(l,this._planeNormal)/U.d.length(this._planeNormal),n=this._getTranslationFromPlane(t,r,this._planeNormal,s),U.d.scale(n,o,U.d.dot(n,o));break;case Al.ROTATE_XY:o=this._currentAxisZ,s=U.d.dot(l,o)/U.d.length(o),a=this._getRotation(t,r,o,s,"rotate-xy");break;case Al.ROTATE_YZ:o=this._currentAxisX,s=U.d.dot(l,o)/U.d.length(o),a=this._getRotation(t,r,o,s,"rotate-yz");break;case Al.ROTATE_XZ:o=this._currentAxisY,s=U.d.dot(l,o)/U.d.length(o),a=this._getRotation(t,r,o,s,"rotate-xz");break;case Al.TRANSLATE_XY:o=this._currentAxisZ,s=U.d.dot(l,o)/U.d.length(o),n=this._getTranslationFromPlane(t,r,o,s);break;case Al.TRANSLATE_YZ:o=this._currentAxisX,s=U.d.dot(l,o)/U.d.length(o),n=this._getTranslationFromPlane(t,r,o,s);break;case Al.TRANSLATE_XZ:o=this._currentAxisY,s=U.d.dot(l,o)/U.d.length(o),n=this._getTranslationFromPlane(t,r,o,s);break;case Al.TRANSLATE_XYZ:o=this._planeNormal,s=U.d.dot(l,o)/U.d.length(o),n=this._getTranslationFromPlane(t,r,o,s)}this._rotation+=a,this._translation[0]+=n[0],this._translation[1]+=n[1],this._translation[2]+=n[2];var u=U.d.len(this._translation),c=1;switch(this._picked.name){case Al.AXIS_X:case Al.AXIS_Y:case Al.AXIS_Z:c=Math.sign(U.d.dot(o,this._translation))}u*=c;var d=U.d.fromValues(this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]),p=U.a.create();U.a.fromRotation(p,a,o);var f=U.d.create();U.d.transformMat4(f,d,p),p[12]=d[0]-f[0],p[13]=d[1]-f[1],p[14]=d[2]-f[2],U.a.multiply(this._transformMatrix,p,this._transformMatrix),this._transformMatrix[12]+=n[0],this._transformMatrix[13]+=n[1],this._transformMatrix[14]+=n[2],U.d.transformMat4(this._pickedWorldPositionOnGizmo,this._pickedWorldPositionOnGizmo,p),this._pickedWorldPositionOnGizmo[0]+=n[0],this._pickedWorldPositionOnGizmo[1]+=n[1],this._pickedWorldPositionOnGizmo[2]+=n[2];var _=this._camera.project(this._pickedWorldPositionOnGizmo);this._actor.setTransformMatrix(this._transformMatrix),this._viewer.getRenderScene().recompileShadow();for(var m=0;m<this._cameras.length;m++)this._cameras[m]._updateProjection();var v,y=this._actor.getTransformArray(),g={x:this._transformMatrix[12]-this._actor.initMatrix[12],y:this._transformMatrix[13]-this._actor.initMatrix[13],z:this._transformMatrix[14]-this._actor.initMatrix[14],type:"translation"},b={x:(v=U.a.getEuler(this._transformMatrix))[0],y:v[1],z:v[2],type:"rotation"};switch(this._picked.name){case Al.AXIS_X:case Al.AXIS_Y:case Al.AXIS_Z:case Al.TRANSLATE_XY:case Al.TRANSLATE_YZ:case Al.TRANSLATE_XZ:case Al.TRANSLATE_XYZ:this._viewer.getEventEmitter().emit("TransformGizmo-Update",{relativeMatrix:y,type:"translation",delta:u,screenPosition:_.slice()}),this._viewer.getEventEmitter().emit("Model-Transform-Update",g);break;case Al.ROTATE_XY:case Al.ROTATE_YZ:case Al.ROTATE_XZ:this._viewer.getEventEmitter().emit("TransformGizmo-Update",{relativeMatrix:y,type:"rotation",delta:this._rotation,screenPosition:_.slice()}),this._viewer.getEventEmitter().emit("Model-Transform-Update",b)}this._viewer.invalidate()},t.prototype._createGizmo=function(){var e=.04*this._scale,t=.08*this._scale,r=.025*this._scale,i=this._scale,n=this._resourceManager.getMesh("transformX");n.createArrow(e,i,.4);var a=this._resourceManager.getMesh("transformX-hover");a.createArrow(t,i);var o=this._resourceManager.getMesh("rotateXY");o.createTorus(.5*this._scale,.5*e,36,4,Math.PI/2);var s=this._resourceManager.getMesh("rotateXY-hover");s.createTorus(.5*this._scale,t,36,4,Math.PI/2);var l=this._resourceManager.getMesh("rotateXY-active");l.createTorus(.5*this._scale,.5*e,36,4);var u=this._resourceManager.getMesh("translatePlane");u.createArc(r,r,2*Math.PI,16);var c=this._resourceManager.getMesh("translateSphere");c.createSphere(16,16,r),this._drawables=new Array(10),this._drawables[0]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._drawables[0].setColor(Ul[Al.AXIS_X]),this._drawables[0].setTransparent(Ul[Al.AXIS_X][3]),this._drawables[0].name=Al.AXIS_X,this._hoverDrawables[0]=new ta(a,this._resourceManager,new Float32Array([0,0,0,2*t,2*t,i])),this._hoverDrawables[0].name="axis-x-hover",this._activeDrawables[0]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._activeDrawables[0].setColor(Ul[Al.AXIS_X]),this._activeDrawables[0].setTransparent(Ul[Al.AXIS_X][3]),this._activeDrawables[0].name="axis-x-active",this._activeDrawables[0].visible=!1,this._drawables[1]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._drawables[1].setColor(Ul[Al.AXIS_Y]),this._drawables[1].setTransparent(Ul[Al.AXIS_Y][3]),this._drawables[1].name=Al.AXIS_Y,this._hoverDrawables[1]=new ta(a,this._resourceManager,new Float32Array([0,0,0,2*t,2*t,i])),this._hoverDrawables[1].name="axis-y-hover",this._activeDrawables[1]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._activeDrawables[1].setColor(Ul[Al.AXIS_Y]),this._activeDrawables[1].setTransparent(Ul[Al.AXIS_Y][3]),this._activeDrawables[1].name="axis-y-active",this._activeDrawables[1].visible=!1,this._drawables[2]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._drawables[2].setColor(Ul[Al.AXIS_Z]),this._drawables[2].setTransparent(Ul[Al.AXIS_Z][3]),this._drawables[2].name=Al.AXIS_Z,this._hoverDrawables[2]=new ta(a,this._resourceManager,new Float32Array([0,0,0,2*t,2*t,i])),this._hoverDrawables[2].name="axis-z-hover",this._activeDrawables[2]=new ta(n,this._resourceManager,new Float32Array([0,0,0,2*e,2*e,i])),this._activeDrawables[2].setColor(Ul[Al.AXIS_Z]),this._activeDrawables[2].setTransparent(Ul[Al.AXIS_Z][3]),this._activeDrawables[2].name="axis-z-active",this._activeDrawables[2].visible=!1,this._drawables[3]=new ta(o,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[3].setColor(Ul[Al.AXIS_Z]),this._drawables[3].setTransparent(Ul[Al.AXIS_Z][3]),this._drawables[3].name=Al.ROTATE_XY,this._hoverDrawables[3]=new ta(s,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._hoverDrawables[3].name="rotate-xy-hover",this._activeDrawables[3]=new ta(l,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[3].setColor(Ul[Al.AXIS_Z]),this._activeDrawables[3].setTransparent(Ul[Al.AXIS_Z][3]),this._activeDrawables[3].name="rotate-xy-active",this._activeDrawables[3].visible=!1,this._drawables[4]=new ta(o,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[4].setColor(Ul[Al.AXIS_X]),this._drawables[4].setTransparent(Ul[Al.AXIS_X][3]),this._drawables[4].name=Al.ROTATE_YZ,this._hoverDrawables[4]=new ta(s,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._hoverDrawables[4].name="rotate-yz-hover",this._activeDrawables[4]=new ta(l,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[4].setColor(Ul[Al.AXIS_X]),this._activeDrawables[4].setTransparent(Ul[Al.AXIS_X][3]),this._activeDrawables[4].name="rotate-yz-active",this._activeDrawables[4].visible=!1,this._drawables[5]=new ta(o,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[5].setColor(Ul[Al.AXIS_Y]),this._drawables[5].setTransparent(Ul[Al.AXIS_Y][3]),this._drawables[5].name=Al.ROTATE_XZ,this._hoverDrawables[5]=new ta(s,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._hoverDrawables[5].name="rotate-xz-hover",this._activeDrawables[5]=new ta(l,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[5].setColor(Ul[Al.AXIS_Y]),this._activeDrawables[5].setTransparent(Ul[Al.AXIS_Y][3]),this._activeDrawables[5].name="rotate-xz-active",this._activeDrawables[5].visible=!1,this._drawables[6]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[6].setColor(Ul[Al.TRANSLATE_XY]),this._drawables[6].setTransparent(Ul[Al.TRANSLATE_XY][3]),this._drawables[6].name=Al.TRANSLATE_XY,this._hoverDrawables[6]=this._drawables[6],this._activeDrawables[6]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[6].setColor(Ul[Al.TRANSLATE_XY]),this._activeDrawables[6].setTransparent(Ul[Al.TRANSLATE_XY][3]),this._activeDrawables[6].name="translate-xy-active",this._activeDrawables[6].visible=!1,this._drawables[7]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[7].setColor(Ul[Al.TRANSLATE_YZ]),this._drawables[7].setTransparent(Ul[Al.TRANSLATE_YZ][3]),this._drawables[7].name=Al.TRANSLATE_YZ,this._hoverDrawables[7]=this._drawables[7],this._activeDrawables[7]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[7].setColor(Ul[Al.TRANSLATE_YZ]),this._activeDrawables[7].setTransparent(Ul[Al.TRANSLATE_YZ][3]),this._activeDrawables[7].name="translate-yz-active",this._activeDrawables[7].visible=!1,this._drawables[8]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._drawables[8].setColor(Ul[Al.TRANSLATE_XZ]),this._drawables[8].setTransparent(Ul[Al.TRANSLATE_XZ][3]),this._drawables[8].name=Al.TRANSLATE_XZ,this._hoverDrawables[8]=this._drawables[8],this._activeDrawables[8]=new ta(u,this._resourceManager,new Float32Array([0,0,0,i,i,i])),this._activeDrawables[8].setColor(Ul[Al.TRANSLATE_XZ]),this._activeDrawables[8].setTransparent(Ul[Al.TRANSLATE_XZ][3]),this._activeDrawables[8].name="translate-xz-active",this._activeDrawables[8].visible=!1,this._drawables[9]=new ta(c,this._resourceManager,new Float32Array([-r,-r,-r,r,r,r])),this._drawables[9].setColor(Ul[Al.TRANSLATE_XYZ]),this._drawables[9].setTransparent(Ul[Al.TRANSLATE_XYZ][3]),this._drawables[9].name=Al.TRANSLATE_XYZ,this._hoverDrawables[9]=this._drawables[9],this._activeDrawables[9]=new ta(c,this._resourceManager,new Float32Array([-r,-r,-r,r,r,r])),this._activeDrawables[9].setColor(Ul[Al.TRANSLATE_XYZ]),this._activeDrawables[9].setTransparent(Ul[Al.TRANSLATE_XYZ][3]),this._activeDrawables[9].name="translate-xyz-active",this._activeDrawables[9].visible=!1},t.prototype._setOperation=function(e){U.a.copy(this._transformMatrix,e.matrix);var t=e.actor;this._actor=t,this._actor.setTransformMatrix(this._transformMatrix),this._scene.updateBBox(),this._viewer.getRenderScene().recompileShadow();for(var r=0;r<this._cameras.length;r++)this._cameras[r]._updateProjection();var i=this._actor.getTransformArray();this._viewer.getEventEmitter().emit("TransformGizmo-Update",{relativeMatrix:i}),this._viewer.invalidate()},t.prototype.translate=function(e,t,r){if(this._actor){this._transformMatrix[12]=this._actor.initMatrix[12]+e,this._transformMatrix[13]=this._actor.initMatrix[13]+t,this._transformMatrix[14]=this._actor.initMatrix[14]+r,this._actor.setTransformMatrix(this._transformMatrix);for(var i=0;i<this._cameras.length;i++)this._cameras[i]._updateProjection()}},t.prototype.enabledAdsorb=function(e){this._needAdsorb=e},t.prototype.rotate=function(e,t,r){var i=[this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]],n=U.a.create();U.a.setFromEuler(n,e,t,r);var a=U.d.create();U.d.transformMat4(a,i,n),n[12]=i[0]-a[0],n[13]=i[1]-a[1],n[14]=i[2]-a[2];var o=U.a.create();o[12]=i[0],o[13]=i[1],o[14]=i[2],U.a.multiply(this._transformMatrix,n,o),this._actor.setTransformMatrix(this._transformMatrix);for(var s=0;s<this._cameras.length;s++)this._cameras[s]._updateProjection()},t.prototype.getRotation=function(){var e=U.a.create();U.a.copy(e,this._transformMatrix);return U.a.getEuler(e)},t.prototype.getTranslation=function(){var e=[];return e[0]=this._transformMatrix[12]-this._actor.initMatrix[12],e[1]=this._transformMatrix[13]-this._actor.initMatrix[13],e[2]=this._transformMatrix[14]-this._actor.initMatrix[14],e},t.prototype.getTransformMatrix=function(){var e=U.a.create();return U.a.copy(e,this._transformMatrix),e},t.prototype.getinitTranslation=function(){if(this._actor){var e=[];return e[0]=this._actor.initMatrix[12],e[1]=this._actor.initMatrix[13],e[2]=this._actor.initMatrix[14],e}console.warn("please use .setModel to add model")},t.prototype.getworldMatrix=function(){var e=U.a.create();return U.a.copy(e,this._transformMatrix),e},t.prototype.revokeOperation=function(){if(this.revokeEnabled){if(this._keyOperation.length>0){var e=1===this._keyOperation.length?this._keyOperation[0]:this._keyOperation.pop();this._revokeOperation(e),this._unkeyOperation.push(e)}return 1!==this._keyOperation.length||(this._viewer.getEventEmitter().emit("TransformGizmo-revokeEnabled",!1),!1)}},t.prototype.unRevokeOperation=function(){return!!this._unkeyOperation.length&&this._revokeOperation(this._unkeyOperation.pop())},t.prototype._revokeOperation=function(e){var t,r;U.a.copy(this._transformMatrix,e.matrix);var i=e.actor;this._actor=i;var n=!1;try{for(var a=Ll(this._actor.drawables),o=a.next();!o.done;o=a.next()){o.value.isDestroy||(n=!0)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}if(!n)return!1;this._actor.setTransformMatrix(this._transformMatrix),this._scene.updateBBox(),this._viewer.getRenderScene().recompileShadow();for(var s=0;s<this._cameras.length;s++)this._cameras[s]._updateProjection();var l=this._actor.getTransformArray();return this._viewer.getEventEmitter().emit("TransformGizmo-Update",{relativeMatrix:l}),this._viewer.invalidate(),!0},t.prototype.reset=function(){if(this._keyOperation.length>1){var e=this._keyOperation[0];this._setOperation(e),this._keyOperation=this._keyOperation.slice(0,1),this._viewer.getEventEmitter().emit("TransformGizmo-revokeEnabled",!1)}},t.prototype.setActiveModeByTransformType=function(e){switch(this._drawables.forEach(function(e,t){e.visible&&(e.visible=!1)}),e){case Al.AXIS_X:this._activeDrawables[0].visible||(this._activeDrawables[0].visible=!0);break;case Al.AXIS_Y:this._activeDrawables[1].visible||(this._activeDrawables[1].visible=!0);break;case Al.AXIS_Z:this._activeDrawables[2].visible||(this._activeDrawables[2].visible=!0);break;case Al.ROTATE_XY:this._activeDrawables[3].visible||(this._activeDrawables[3].visible=!0);break;case Al.ROTATE_YZ:this._activeDrawables[4].visible||(this._activeDrawables[4].visible=!0);break;case Al.ROTATE_XZ:this._activeDrawables[5].visible||(this._activeDrawables[5].visible=!0);break;case Al.TRANSLATE_XY:this._activeDrawables[6].visible||(this._activeDrawables[6].visible=!0,this._activeDrawables[0].visible=!0,this._activeDrawables[1].visible=!0);break;case Al.TRANSLATE_YZ:this._activeDrawables[7].visible||(this._activeDrawables[7].visible=!0,this._activeDrawables[1].visible=!0,this._activeDrawables[2].visible=!0);break;case Al.TRANSLATE_XZ:this._activeDrawables[8].visible||(this._activeDrawables[8].visible=!0,this._activeDrawables[0].visible=!0,this._activeDrawables[2].visible=!0);break;case Al.TRANSLATE_XYZ:this._activeDrawables[9].visible||(this._activeDrawables[9].visible=!0,this._activeDrawables[0].visible=!0,this._activeDrawables[1].visible=!0,this._activeDrawables[2].visible=!0)}},t.prototype.unsetActiveMode=function(){this._activeDrawables.forEach(function(e){e.visible&&(e.visible=!1)}),this._drawables.forEach(function(e,t){e.visible||(e.visible=!0)})},t}(gr.a),Hl=r(53),ql=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e[e.SELECTED=0]="SELECTED",e[e.NOTHINGSELECTED=1]="NOTHINGSELECTED",e[e.SELECTSAME=2]="SELECTSAME"}(Fl||(Fl={}));var Wl,Ql=new Uint8Array([0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4]),Yl=function(e){function t(t){var r=e.call(this,"SelectModel",!1,t)||this;r._boundingBoxEnabled=!0,r._snapping=null,r._pickQuery=null,r._snapped=-1,r.currentSelectedModel=void 0,r.currentHoveredModel=void 0,r.currentPosition=new Array(3);var i=r._resourceManager.getMesh("wiredcube");i.ready||i.createWiredCube(),r._cube=new ta(i,r._resourceManager),r._cube.setColor([247/255,82/255,35/255]),r._cube.setTransparent(1);var n=new Float32Array([-.5,-.5,-.5,.5,.5,.5]);return r._cube.setBbox(n),r._cube.name="select_bounding_box",r._vertices=new Float32Array(24),r.updateBoundingBoxVertices(n),r}return ql(t,e),Object.defineProperty(t.prototype,"boundingBoxEnabled",{get:function(){return this._boundingBoxEnabled},set:function(e){this._boundingBoxEnabled=e},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.removeBoundingBox(),this._snapping&&(this._snapping.destroy(),this._snapping=null,delete this._snapping),this._pickQuery&&(this._pickQuery.destroy(),this._pickQuery=null,delete this._pickQuery),this.currentSelectedModel=null,delete this.currentSelectedModel,this.currentHoveredModel=null,delete this.currentHoveredModel,this.currentPosition=null,delete this.currentPosition,this._vertices=null,delete this._vertices,this._points=null,delete this._points,this._cube=null,delete this._cube},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"SelectModel"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"SelectModel")},t.prototype.doesSupportMobile=function(e){return!e},t.prototype.doesSupport3D=function(e){return!0},t.prototype._udpateSnapping=function(e){this._snapping.update(this._renderer,this._scene,this._camera)},t.prototype._render=function(){},t.prototype.resize=function(e,t){},t.prototype._onEnableChanged=function(){this._enabled?null===this._pickQuery&&(this._pickQuery=new Jr.a(this._scene,this._resourceManager)):(this.removeBoundingBox(),this.currentHoveredModel=void 0,this.currentSelectedModel=void 0)},t.prototype._onMouseMove=function(e){return!!this._enabled&&(!e.pressed&&this._camera.updated,!1)},t.prototype._onMouseUp=function(e){if(!this._enabled)return!1;if(!e.moved){var t=this._pickQuery.pickModel(e.x,e.y,this._renderer,this._camera),r=this.pickModel(t,!1);r===Fl.SELECTED?this._viewer.getEventEmitter().emit("SelectModel-Selected",t.name):r===Fl.NOTHINGSELECTED&&this._viewer.getEventEmitter().emit("SelectModel-Selected",void 0),this._viewer.invalidate()}return!1},t.prototype.pickModel=function(e,t){var r;return void 0===t&&(t=!1),r=t?this.currentHoveredModel:this.currentSelectedModel,e?e!==r?(this.removeBoundingBox(),t?this.currentHoveredModel=e:this.currentSelectedModel=e,r=e,this.updateBoundingBoxVertices(r.geometryCenteredOrientedBoundingBox),this._cube.mesh.update(this._vertices,Ql,this._resourceManager.gl.UNSIGNED_BYTE),this.updateBoundingBoxMatrix(r),this._cube.setBbox(r.bbox),this.addBoundingBox(),Fl.SELECTED):Fl.SELECTSAME:(this.removeBoundingBox(),t?this.currentHoveredModel=void 0:this.currentSelectedModel=void 0,this._viewer.invalidate(),Fl.NOTHINGSELECTED)},t.prototype.pickModelById=function(e){if(!e)return this.pickModel(void 0,!1),void this._viewer.getEventEmitter().emit("SelectModel-Selected",void 0);var t=this._viewer.getScene().getModel(e);if(t){var r=this.pickModel(t,!1);r===Fl.SELECTED?this._viewer.getEventEmitter().emit("SelectModel-Selected",t.name):r===Fl.NOTHINGSELECTED&&this._viewer.getEventEmitter().emit("SelectModel-Selected",void 0)}},t.prototype.pickModelByMouseCoordinate=function(e,t){var r=this._pickQuery.pickModel(e,t,this._renderer,this._camera);return this.pickModel(r,!1),this._viewer.invalidate(),r},t.prototype.updateBoundingBoxMatrix=function(e){if(e){var t=e.getTransformMatrix();U.a.equals(t,this._cube.getTransformMatrix())||this._cube.setTransformMatrix(t)}},t.prototype.updateBoundingBox=function(){this.updateBoundingBoxMatrix(this.currentSelectedModel)},t.prototype.updateBoundingBoxVertices=function(e){this._points?P.a.aabb.points2(e,this._points):this._points=P.a.aabb.points(e),this._vertices[0]=this._points[0][0],this._vertices[1]=this._points[0][1],this._vertices[2]=this._points[0][2],this._vertices[3]=this._points[1][0],this._vertices[4]=this._points[1][1],this._vertices[5]=this._points[1][2],this._vertices[6]=this._points[2][0],this._vertices[7]=this._points[2][1],this._vertices[8]=this._points[2][2],this._vertices[9]=this._points[3][0],this._vertices[10]=this._points[3][1],this._vertices[11]=this._points[3][2],this._vertices[12]=this._points[4][0],this._vertices[13]=this._points[4][1],this._vertices[14]=this._points[4][2],this._vertices[15]=this._points[5][0],this._vertices[16]=this._points[5][1],this._vertices[17]=this._points[5][2],this._vertices[18]=this._points[6][0],this._vertices[19]=this._points[6][1],this._vertices[20]=this._points[6][2],this._vertices[21]=this._points[7][0],this._vertices[22]=this._points[7][1],this._vertices[23]=this._points[7][2]},t.prototype.addBoundingBox=function(){var e;this._boundingBoxEnabled&&(null===(e=this._viewer.getRenderScene())||void 0===e||e.addLoadingBoxDrawable(this._cube),this.currentSelectedModel&&this.currentSelectedModel.setLoadingBoxVisible(!1),this._viewer.invalidate())},t.prototype.removeBoundingBox=function(){var e;this._boundingBoxEnabled&&(this.currentSelectedModel&&this.currentSelectedModel.setLoadingBoxVisible(!0),null===(e=this._viewer.getRenderScene())||void 0===e||e.removeLoadingBoxDrawable(this._cube),this._viewer.invalidate())},t}(gr.a),Xl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Zl=function(e){function t(t,r){return e.call(this,t,r)||this}return Xl(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uPlatte"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uData"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uRes"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uThickness"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return i},t.prototype.setPlatteTexture=function(e){this.reservedParameters.m_uPlatte.value=e},t.prototype.setDataTexture=function(e){this.reservedParameters.m_uData.value=e},t.prototype.setResolution=function(e){this.reservedParameters.m_uRes.value=e},t.prototype.setThickness=function(e){this.reservedParameters.m_uThickness.value=.5*e},t}(F),Kl=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Jl=function(e){function t(t){var r=e.call(this,"BarChart",t)||this;return r._resourceManager=t.getResourceManager(),r._xres=32,r._yres=32,r._thickness=1,r._showLines=!0,r._lineColor=[.2,.2,.2],r._dataTexture=null,r._platteTexture=r._resourceManager.getTexture(r.name+"-barchart-platte"),r}return Kl(t,e),t.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,this._xres=null,delete this._xres,this._yres=null,delete this._yres,this._thickness=null,delete this._thickness,this._showLines=null,delete this._showLines,this._lineColor=null,delete this._lineColor,this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,e.prototype.destroy.call(this)},t.prototype._initialize=function(){return!!this._resourceManager.gl.isWebGL2||(console.warn("BarChart is not supported in webgl1.0 context!"),!1)},t.prototype.setParameter=function(e,t){var r=!1,i=this._resourceManager.gl;switch(e){case"xres":this._xres=t,r=!0;break;case"yres":this._yres=t,r=!0;break;case"thickness":this._thickness=2*t;break;case"showLines":this._showLines=t;break;case"lineColor":this._lineColor=t;break;case"dataTexture":this._dataTexture=t;break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,null)}r&&this._updateGeometry()},t.prototype._updateGeometry=function(){this._resourceManager.hasMesh(this.name+"-barchart")&&this._resourceManager.getMesh(this.name+"-barchart").destroy(!0);var e=this._resourceManager.getMesh(this.name+"-barchart");(e.createSolidCubeField(this._xres,this._yres),this._resourceManager.hasMesh(this.name+"-barchart-wireframe"))&&this._resourceManager.getMesh(this.name+"-barchart-wireframe").destroy(!0);var t=this._resourceManager.getMesh(this.name+"-barchart-wireframe");if(t.createWiredCubeField(this._xres,this._yres),this._drawables.length<1){var r="barchart",i=this._resourceManager.getShader(r,["MODEL_TRANSFORM"]);if(!i.ready){var n=k.a[r];if(i.createFromShaderSource(n,["MODEL_TRANSFORM"]),!i.ready)throw new Error("Error at creating shader '"+r+"'!")}r="barchart_wireframe";var a=this._resourceManager.getShader(r,["MODEL_TRANSFORM"]);if(!a.ready){n=k.a[r];if(a.createFromShaderSource(n,["MODEL_TRANSFORM"]),!a.ready)throw new Error("Error at create shader '"+r+"'!")}var o=new Zl("barchart",this._resourceManager);o.attachShader(i,this._resourceManager);var s=new D.a(e,i,o,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]));this._drawables.push(s);var l=new Zl("barchart-wireframe",this._resourceManager);l.attachShader(a,this._resourceManager),s=new D.a(t,a,l,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0])),this._drawables.push(s),this.setPosition(this._position),this.setScaling(this._scale)}else this._drawables[0].mesh=e,this._drawables[1].mesh=t},t.prototype.draw=function(e,t,r,i,n,a,o){if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready&&this._dataTexture.ready){var s=this._drawables[0].material;s.setPlatteTexture(this._platteTexture),s.setDataTexture(this._dataTexture),s.setThickness(this._thickness),s.setResolution([this._xres,this._yres]),this._showLines?(this._drawables[1].visible=!0,(s=this._drawables[1].material).setDiffuse(this._lineColor),s.setTransparent(1),s.setDataTexture(this._dataTexture),s.setThickness(this._thickness),s.setResolution([this._xres,this._yres])):this._drawables[1].visible=!1,a.setOption("blend",!0);var l=this._resourceManager.gl;e.drawDrawables(a,this._drawables,t,null,null,r,i,n,null,l.CCW),a.setOption("blend",!1)}else console.warn("cannot visualize 3D bar field without field data!")},t.prototype.doesSupportWebGL1=function(){return!1},t}(Rt),$l=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),eu=function(e){function t(t){var r=e.call(this,"metaball",t)||this;r._resourceManager=t.getResourceManager(),r._width=1024,r._height=1024,r._showPoints=!0,r._showContour=!1,r._color=[1,0,0,1],r._contourWidth=1.75,r._contourColor=[1,1,0,1],r._backgroundColor=[1,1,1,1],r._radius=64,r._ballTexture=r._resourceManager.getTexture(r.name+"-metaball-ball"),r._foregroundTexture=r._resourceManager.getTexture(r.name+"-metaball-foreground"),r._enableForeground=!1,r._updateBallImage(),r._point=null,r._ball=null,r._needUpdate=!0,r._blit=new ti(r._resourceManager,k.a.metaball,s.a.isMobile),r._blitForeground=new ti(r._resourceManager,k.a.overlay,s.a.isMobile),r._blitBackground=new ti(r._resourceManager,k.a.background,s.a.isMobile);var i=r._resourceManager.gl;return r._camera=new nr.a([0,0,r._width,r._height]),r._renderTarget1=new wr.a("metaball1",r._resourceManager,r._width,r._height,{depthTest:!1,blend:!0,depthFunc:i.LEQUAL,colorFormat:i.RGBA8,clearColor:[0,0,0,0],colorFilter:i.LINEAR,depthFormat:i.DEPTH_COMPONENT24,colorBuffer:0,depthBuffer:0}),r._renderTarget2=new wr.a("metaball2"+Math.random(),r._resourceManager,r._width,r._height,{depthTest:!1,depthFunc:i.LEQUAL,colorFormat:i.RGBA8,clearColor:[0,0,0,0],colorFilter:i.LINEAR,depthFormat:i.DEPTH_COMPONENT24,depthBuffer:0}),r._dataTexture=r._renderTarget2.getColorBuffer(),r._enableForeground=!1,r._needUpdate=!0,r}return $l(t,e),t.prototype.destroy=function(){this._dataTexture.destroy(),this._dataTexture=null,delete this._dataTexture,this._ballTexture.destroy(),this._ballTexture=null,delete this._ballTexture,this._foregroundTexture.destroy(),this._foregroundTexture=null,delete this._foregroundTexture,this._renderTarget1.destroy(),this._renderTarget1=null,delete this._renderTarget1,this._renderTarget2.destroy(),this._renderTarget2=null,delete this._renderTarget2,this._points=null,delete this._points,this._color=null,delete this._color,this._contourColor=null,delete this._contourColor,this._backgroundColor=null,delete this._backgroundColor,this._resourceManager=null,delete this._resourceManager,this._point.destroy(),this._point=null,delete this._point,this._ball.destroy(),this._ball=null,delete this._ball,this._blit.destroy(),this._blit=null,delete this._blit,e.prototype.destroy.call(this)},t.prototype.setParameter=function(e,t){var r=this;switch(e){case"points":this._points=t;break;case"colors":this._colors=t;break;case"width":this._width=t;break;case"height":this._height=t;break;case"contourColor":this._contourColor=t;break;case"contourWidth":this._contourWidth=1+t;break;case"backgroundColor":this._backgroundColor=t;break;case"color":this._color=t;break;case"radius":this._radius=t;break;case"contour":this._showContour!==t&&(this._showContour=t,this._blit.recompile("CONTOUR",this._showContour));break;case"foregroundImage":var i=this._resourceManager.gl;this._enableForeground=!0,this._foregroundTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){r._updateImage()})}this._needUpdate=!0},t.prototype._updateBallImage=function(){var e=2*this._radius+1,t=1/this._radius,r=this._resourceManager.gl,i=null;r.isWebGL2?(i=new Float32Array(e*e),this._ballTexture.create(e,e,r.R32F,r.LINEAR,r.CLAMP_TO_EDGE)):(i=new Uint8Array(e*e),this._ballTexture.create(e,e,r.LUMINANCE,r.LINEAR,r.CLAMP_TO_EDGE)),this._ballTexture.resize(e,e);for(var n=0;n<this._radius;n++)for(var a=0;a<this._radius;a++){var o=Math.sqrt(Math.max(1-Math.sqrt(n*n+a*a)*t,0)),s=void 0;s=this._radius+a,i[(this._radius+n)*e+s]=o*(r.isWebGL2?1:255),s=this._radius-a,i[(this._radius+n)*e+s]=o*(r.isWebGL2?1:255),s=this._radius+a,i[(this._radius-n)*e+s]=o*(r.isWebGL2?1:255),s=this._radius-a,i[(this._radius-n)*e+s]=o*(r.isWebGL2?1:255)}this._ballTexture.update(i)},t.prototype._updateImage=function(){if(this._points){if(!this._ball||!this._point){var e=this._resourceManager.getMesh("metaball-quad");e.ready||e.createQuad(),this._ball=new bs(e,this._resourceManager),this._ball.setTexture(this._ballTexture),this._ball.transform.setScaling(this._radius/this._width,this._radius/this._height,1),(e=this._resourceManager.getMesh("point")).ready||e.createPoint(),this._point=new bs(e,this._resourceManager),this._point.setColor([1,1,1])}this._renderTarget1.resize(this._width,this._height),this._renderTarget2.resize(this._width,this._height),this._camera.setViewport([0,0,this._width,this._height]);var t=this._resourceManager.gl,r=this._renderScene.getRenderer();if(r.renderState.invalidateStates(),r.clear(this._renderTarget2,t.COLOR_BUFFER_BIT),r.renderState.viewport([0,0,this._width,this._height]),this._blitBackground.setParameter("uColor",this._backgroundColor),this._blitBackground.render(r,this._renderTarget2),this._colors)for(var i=0;i<this._colors.length;i++){r.clear(this._renderTarget1,t.COLOR_BUFFER_BIT),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE);for(var n=0;n<this._points.length;n++)if(this._points[n].colorIndex===i){var a=2*this._points[n].x-1,o=2*this._points[n].y-1;this._ball.transform.setTranslation(a,o,0),r.drawDrawable(this._renderTarget1,this._ball,this._camera)}t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this._blit.setTexture(this._renderTarget1.getColorBuffer()),this._blit.setParameter("uColor",this._colors[i].color),this._showContour&&(this._blit.setParameter("uContourColor",this._colors[i].contourColor),this._blit.setParameter("uContourWidth",this._contourWidth)),this._blit.render(r,this._renderTarget2,!0)}else{r.clear(this._renderTarget1,t.COLOR_BUFFER_BIT),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE);for(i=0;i<this._points.length;i++){a=2*this._points[i].x-1,o=2*this._points[i].y-1;this._ball.transform.setTranslation(a,o,0),r.drawDrawable(this._renderTarget1,this._ball,this._camera)}t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this._blit.setTexture(this._renderTarget1.getColorBuffer()),this._blit.setParameter("uColor",this._color),this._showContour&&(this._blit.setParameter("uContourColor",this._contourColor),this._blit.setParameter("uContourWidth",this._contourWidth)),this._blit.render(r,this._renderTarget2)}this._enableForeground&&(this._blitForeground.setForegroundTexture(this._foregroundTexture),this._renderTarget2.setOption("blendFunc",[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA]),this._blitForeground.render(r,this._renderTarget2,!0)),this._dataTexture=this._renderTarget2.getColorBuffer()}},t.prototype.getTexture=function(){return this._needUpdate&&(this._updateImage(),this._needUpdate=!1),this._dataTexture},t}(Rt),tu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ru=function(){function e(e,t,r){var i=t.getMesh("trail-path"+e);i.createLineStrip();var n=t.getShader("plain",["MODEL_TRANSFORM"]);if(!n.ready){var a=k.a.plain;if(n.createFromShaderSource(a,["MODEL_TRANSFORM"]),!n.ready)throw new Error("Error at creating shader 'plain'!")}var o=r.createMaterialAdhoc("trail");o.attachShader(n,t),o.setTransparent(.2),this.drawable=new D.a(i,n,o,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]))}return e.prototype.destroy=function(){this.points=null,delete this.points,this.distances=null,delete this.distances,this.drawable.destroy(),this.drawable=null,delete this.drawable},e.prototype.update=function(e){this.points=e;for(var t=this.points.length/3,r=new Uint16Array(t),i=0;i<t;i++)r[i]=i;this.drawable.mesh.update(new Float32Array(this.points),r);var n=0;this.distances=new Array(this.points.length/3);for(i=0;i<this.points.length-3;i+=3){var a=this.points[i+3]-this.points[i],o=this.points[i+4]-this.points[i+1],s=this.points[i+5]-this.points[i+2],l=Math.sqrt(a*a+o*o+s*s);this.distances[i/3]=n,n+=l}this.distances[this.points.length/3-1]=n},e.prototype.draw=function(e,t){e%=this.distances[this.distances.length-1];for(var r=-1,i=0;i<this.distances.length;i++)if(e<this.distances[i]){r=i;break}var n=r-1,a=(e-this.distances[n])/(this.distances[r]-this.distances[n]);return t[0]=this.points[3*n],t[1]=this.points[3*n+1],t[2]=this.points[3*n+2],t[3]=this.points[3*n]*(1-a)+this.points[3*r]*a,t[4]=this.points[3*n+1]*(1-a)+this.points[3*r+1]*a,t[5]=this.points[3*n+2]*(1-a)+this.points[3*r+2]*a,r},e}(),iu=function(e){function t(t){var r=e.call(this,"trail",t)||this;r._resourceManager=t.getResourceManager(),r._start=-1,r._speed=.01;Math.random();var i=r._resourceManager.getShader("plain",["MODEL_TRANSFORM"]);if(!i.ready){var n=k.a.plain;if(i.createFromShaderSource(n,["MODEL_TRANSFORM"]),!i.ready)throw new Error("Error at creating shader 'plain'!")}var a=t.getScene().materialManager.createMaterialAdhoc("trail");a.attachShader(i),a.setTransparent(.2);var o=r._resourceManager.getMesh("trail-growing");return o.createLine(),r._current=new D.a(o,i,a,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0])),r._vertices=new Float32Array(6),r._indices=new Uint16Array(2),r._indices[0]=0,r._indices[1]=1,(o=r._resourceManager.getMesh("trail-tip")).createPoint(),r._tip=new D.a(o,i,a,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0])),r._paths=[],r}return tu(t,e),t.prototype.destroy=function(){this._indices=null,delete this._indices,this._vertices=null,delete this._vertices;for(var e=0;e<this._paths.length;e++)this._paths[e].destroy();this._paths=null,delete this._paths,this._tip.destroy(),this._tip=null,delete this._tip,this._current.destroy(),this._current=null,delete this._current},t.prototype.setParameter=function(e,t){switch(e){case"color":for(var r=0;r<this._paths.length;r++)this._paths[r].drawable.material.setDiffuse(t);this._tip.material.setDiffuse(t),this._current.material.setDiffuse(t);break;case"transparent":for(r=0;r<this._paths.length;r++)this._paths[r].drawable.material.setTransparent(t);this._tip.material.setTransparent(t),this._current.material.setTransparent(t);break;case"speed":this._speed=t}},t.prototype.addTrail=function(e){var t=new ru(this._paths.length,this._resourceManager,this._renderScene.getScene().materialManager);t.update(e),this._paths.push(t)},t.prototype.draw=function(e,t,r,i,n,a,o){if(void 0===o&&(o=-1),this._enabled)for(var s=(Date.now()-this._start)*this._speed,l=0;l<this._paths.length;l++){var u=a.getOption("blend");if(a.setOption("blend",!0),a.always=!0,this._animate){var c=this._paths[l].draw(s,this._vertices);e.drawDrawable(a,this._paths[l].drawable,t,r,i,n,!1,[0,c]),this._current.mesh.update(this._vertices,this._indices),e.drawDrawable(a,this._current,t,r,i,n,!1),a.setOption("blend",u);var h=new Float32Array(this._vertices.buffer,12,3),d=new Uint16Array(this._indices.buffer,0,1);this._tip.mesh.update(h,d),e.drawDrawable(a,this._tip,t,r,i,n,!1)}else{e.drawDrawable(a,this._paths[l].drawable,t,r,i,n,!1),a.setOption("blend",u);var p=this._paths[l].points;h=new Float32Array([p[p.length-3],p[p.length-2],p[p.length-1]]),d=new Uint16Array(this._indices.buffer,0,1);this._tip.mesh.update(h,d),e.drawDrawable(a,this._tip,t,r,i,n,!1)}}},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._start=Date.now()},t.prototype.setAnimationEnabled=function(e){this._animate=e},t}(Rt),nu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),au=function(e){function t(t,r){return e.call(this,t,r)||this}return nu(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uInvTransform"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uPlatteTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uGradientTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=8,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uDensityTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=9,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uMaskTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=10,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uAlphaCorrection"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uLayers"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uGridSize"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uSampleNumber"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return i},t.prototype.setPlatteTexture=function(e){this.reservedParameters.m_uPlatteTexture&&(this.reservedParameters.m_uPlatteTexture.value=e)},t.prototype.setGradientTexture=function(e){this.reservedParameters.m_uGradientTexture&&(this.reservedParameters.m_uGradientTexture.value=e)},t.prototype.setDataTexture=function(e){this.reservedParameters.m_uDensityTexture&&(this.reservedParameters.m_uDensityTexture.value=e)},t.prototype.setAlphaCorrection=function(e){this.reservedParameters.m_uAlphaCorrection&&(this.reservedParameters.m_uAlphaCorrection.value=e)},t.prototype.setInvTransform=function(e){this.reservedParameters.m_uInvTransform&&(this.reservedParameters.m_uInvTransform.value=e)},t.prototype.setLayers=function(e){this.reservedParameters.m_uLayers&&(this.reservedParameters.m_uLayers.value=e)},t.prototype.setGridSize=function(e){this.reservedParameters.m_uGridSize&&(this.reservedParameters.m_uGridSize.value=e)},t.prototype.setSampleNumber=function(e){this.reservedParameters.m_uSampleNumber&&(this.reservedParameters.m_uSampleNumber.value=e)},t}(F),ou=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),su=function(e){function t(t){var r=e.call(this,"volume",t)||this;return r._resourceManager=t.getResourceManager(),r._dataTexture=null,r._platteTexture=r._resourceManager.getTexture(r.name+"-volume-platte"),r._gradientTexture=r._resourceManager.getTexture(r.name+"-volume-gradient"),r}return ou(t,e),t.prototype.destroy=function(){this._gradientTexture.destroy(),this._gradientTexture=null,delete this._gradientTexture,this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.setParameter=function(e,t){var r=this._resourceManager.gl;switch(e){case"data":if(this._dataTexture=this._resourceManager.getTexture(this.name+"-volume"),!this._dataTexture.ready){var i=this._resourceManager.gl;i.isWebGL2?this._dataTexture.create(t.width,t.height,i.R32F,i.LINEAR,i.CLAMP_TO_EDGE):this._dataTexture.create(t.width,t.height,i.LUMINANCE,i.LINEAR,i.CLAMP_TO_EDGE)}var n=t.data;if(!(r.isWebGL2||t.data instanceof Uint8Array)){n=new Uint8Array(t.data.length);for(var a=0;a<t.data.length;a++)n[a]=255*t.data[a]}this._dataTexture.update(n);break;case"dataTexture":this._dataTexture=t;break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,r.RGBA,r.LINEAR,r.CLAMP_TO_EDGE,null);break;case"gradientImage":this._gradientTexture.createFromFile(t,r.RGB,r.LINEAR,r.CLAMP_TO_EDGE,null)}},t.prototype._updateInvTransform=function(e){var t=U.a.create();U.a.invert(t,e.transform.matrix),e.material.setInvTransform(t)},t.prototype.setPosition=function(t){e.prototype.setPosition.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setScaling=function(t){e.prototype.setScaling.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.draw=function(e,t,r,i,n,a,o){if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready&&this._dataTexture.ready&&this._gradientTexture.ready){if(0===this._drawables.length){var s=this._resourceManager.getMesh("volume");s.createSolidCube(.5);var l=this._resourceManager.getShader("volume",["MODEL_TRANSFORM"]);if(!l.ready){var u=k.a.volume;if(l.createFromShaderSource(u,["MODEL_TRANSFORM"]),!l.ready)throw new Error("Error at creating shader 'volume'!")}var c=new au("volume",this._resourceManager);c.attachShader(l,this._resourceManager);var h=new D.a(s,l,c,null,new Float32Array([-.5,-.5,-.5,.5,.5,.5]));this._drawables.push(h),this.setPosition(this._position),this.setScaling(this._scale)}var d=this._drawables[0].material;d.setPlatteTexture(this._platteTexture),d.setGradientTexture(this._gradientTexture),d.setDataTexture(this._dataTexture),d.setAlphaCorrection(.03),a.setOption("blend",!0),e.drawDrawables(a,this._drawables,t,null,null,r,i,n),a.setOption("blend",!1)}else console.warn("The resources of "+this.name+" are not ready!")},t}(Rt),lu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),uu=function(e){function t(t){var r=e.call(this,"MultiLayerVolume",t)||this;r._resourceManager=t.getResourceManager(),r._dataTexture=null,r._platteTexture=r._resourceManager.getTexture(r.name+"-volume-platte"),r._maskTexture=null,r._layers=33,r._sampleNumber=1,r._gridSize=[8,8],r._blit=new ti(r._resourceManager,k.a.blit_simple,s.a.isMobile);var i=r._resourceManager.gl;return r._renderTarget=new wr.a(r.name+"-volume-data-texture",r._resourceManager,1024,1024,{clearColor:[0,0,0,0],colorFormat:i.RGBA8,colorFilter:i.LINEAR}),r}return lu(t,e),t.prototype.destroy=function(){this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype._updateDataTexture=function(){var e=this;if(this._dataTexture&&this._dataTexture.ready&&(this._blit.setTexture(this._dataTexture),this._renderScene.getRenderer().renderState.viewport([0,0,this._renderTarget.getWidth(),this._renderTarget.getHeight()]),this._blit.render(this._renderScene.getRenderer(),this._renderTarget,!1)),this._maskTexture&&this._maskTexture.ready){var t=this._resourceManager.gl;this._blit.setTexture(this._maskTexture);var r=this._renderTarget.getOption("blendFunc");this._renderTarget.setOption("blendFunc",[t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA]),this._renderScene.getRenderer().renderState.viewport([0,0,this._renderTarget.getWidth(),this._renderTarget.getHeight()]),this._blit.render(this._renderScene.getRenderer(),this._renderTarget,!0),this._renderTarget.setOption("blendFunc",r),this._renderTarget.always=!0}this._drawables.forEach(function(t){t.material.setDataTexture(e._renderTarget.getColorBuffer())})},t.prototype.setParameter=function(e,t){var r=this,i=this._resourceManager.gl;switch(e){case"sampleNumber":this._sampleNumber=t;break;case"gridSize":this._gridSize=t,this._renderTarget.resize(1024,1024/this._gridSize[0]*this._gridSize[1]);break;case"maskImage":if(this._maskTexture=this._resourceManager.getTexture(this.name+"-mask"),this._maskTexture.ready){console.warn("Can not set maskImage multiple times.");break}this._maskTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){r._updateDataTexture()});break;case"dataImage":this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-volume"),this._dataTexture.ready&&(this._dataTexture.destroy(!0),this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-volume")),this._dataTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){r._updateDataTexture()});break;case"data":this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-volume");var n=t.data;if(!this._dataTexture.ready)if(i.isWebGL2)this._dataTexture.create(t.width,t.height,i.R32F,i.LINEAR,i.CLAMP_TO_EDGE);else if(this._dataTexture.create(t.width,t.height,i.LUMINANCE,i.LINEAR,i.CLAMP_TO_EDGE),!(n instanceof Uint8Array)){n=new Uint8Array(t.data.length);for(var a=0;a<t.data.length;a++)n[a]=255*t.data[a]}this._dataTexture.update(n),this._updateDataTexture();break;case"dataTexture":this._dataTexture=t,this._updateDataTexture();break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,null),this._drawables.forEach(function(e){e.material.setPlatteTexture(r._platteTexture)});break;case"layers":this._layers=t,this._drawables.forEach(function(e){e.material.setLayers(r._layers)})}},t.prototype.getVolumeTexture=function(){return this._renderTarget.getColorBuffer()},t.prototype._updateInvTransform=function(e){var t=U.a.create();U.a.invert(t,e.transform.matrix),e.material.setInvTransform(t)},t.prototype.setPosition=function(t){e.prototype.setPosition.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setScaling=function(t){e.prototype.setScaling.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setRotation=function(t,r){e.prototype.setRotation.call(this,t,r),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setRotationByQuat=function(t){e.prototype.setRotationByQuat.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.draw=function(e,t,r,i,n,a,o){var s=this;if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready&&this._renderTarget.getColorBuffer().ready){if(0===this._drawables.length){var l=this._resourceManager.getMesh("volume-multi-layer");l.createSolidCube(.5);var u=["MODEL_TRANSFORM"];this._maskTexture&&u.push("HAS_MASK");var c=this._resourceManager.getShader("volume_multi_layer",u);if(!c.ready){var h=k.a.volume_multi_layer;if(c.createFromShaderSource(h,u),!c.ready)throw new Error("Error at creating shader 'volume_multi_layer'!")}var d=new au("volume-multi-layer",this._resourceManager);d.attachShader(c,this._resourceManager),d.setPlatteTexture(this._platteTexture),d.setAlphaCorrection(.09),d.setLayers(this._layers),d.setSampleNumber(this._sampleNumber);var p=new D.a(l,c,d,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]));this._drawables.push(p),this.setRotationByQuat(this._quaternion),this.setPosition(this._position),this.setScaling(this._scale),this._updateDataTexture()}this._drawables.forEach(function(e){e.material.setGridSize(s._gridSize)}),a.setOption("blend",!0),e.drawDrawables(a,this._drawables,t,null,null,r,i,n),a.setOption("blend",!1)}else console.warn("The resources of "+this.name+" are not ready!")},t}(Rt),cu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),hu=function(e){function t(t,r){return e.call(this,t,r)||this}return cu(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uInvTransform"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uPlatteTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=6,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uGradientTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=8,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uDensityTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=9,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uMaskTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=10,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uAlphaCorrection"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uLayers"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uInstanceFilter"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uGridSize"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uSampleNumber"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uDiffuseTexture"===n&&(this.reservedParameters[n]=new C.a,this.hasTexture=!0,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture));return i},t.prototype.setDiffuseTexture=function(e){var t=this;if(this.reservedParameters.m_uDiffuseTexture)if(e instanceof O.a)this.reservedParameters.m_uDiffuseTexture.value=e;else{var r=this.reservedParameters.m_uDiffuseTexture.value,i=r.getFilter(),n=r.getWrap(),a=this._resourceManager.gl.RGB;if(e instanceof HTMLImageElement){var o=new O.a("texture-"+e.src,this._resourceManager);"png"===(s=e.src.split("."))[s.length-1]&&(a=this._resourceManager.gl.RGBA),o.createFromImage(e,a,this._resourceManager.gl.UNSIGNED_BYTE,i,n),this.reservedParameters.m_uDiffuseTexture.value=o}else{var s,l=new O.a("texture-"+e,this._resourceManager);a=this._resourceManager.gl.RGB;"png"===(s=e.split("."))[s.length-1]&&(a=this._resourceManager.gl.RGBA),l.createFromFile(e,a,i,n,function(){t.reservedParameters.m_uDiffuseTexture.value=l})}}else console.warn("can not set texture for "+this.name)},t.prototype.setPlatteTexture=function(e){this.reservedParameters.m_uPlatteTexture&&(this.reservedParameters.m_uPlatteTexture.value=e)},t.prototype.setGradientTexture=function(e){this.reservedParameters.m_uGradientTexture&&(this.reservedParameters.m_uGradientTexture.value=e)},t.prototype.setDataTexture=function(e){this.reservedParameters.m_uDensityTexture&&(this.reservedParameters.m_uDensityTexture.value=e)},t.prototype.setAlphaCorrection=function(e){this.reservedParameters.m_uAlphaCorrection&&(this.reservedParameters.m_uAlphaCorrection.value=e)},t.prototype.setInvTransform=function(e){this.reservedParameters.m_uInvTransform&&(this.reservedParameters.m_uInvTransform.value=e)},t.prototype.setLayers=function(e){this.reservedParameters.m_uLayers&&(this.reservedParameters.m_uLayers.value=e)},t.prototype.setinstanceFilter=function(e){this.reservedParameters.m_uInstanceFilter&&(this.reservedParameters.m_uInstanceFilter.value=e)},t.prototype.setGridSize=function(e){this.reservedParameters.m_uGridSize&&(this.reservedParameters.m_uGridSize.value=e)},t.prototype.setSampleNumber=function(e){this.reservedParameters.m_uSampleNumber&&(this.reservedParameters.m_uSampleNumber.value=e)},t}(F),du=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),pu=function(e){function t(t){var r=e.call(this,"MultiLayerColor",t)||this;r._resourceManager=t.getResourceManager(),r._dataTexture=null,r._platteTexture=r._resourceManager.getTexture(r.name+"-volume-platte"),r._maskTexture=null,r._layers=33,r._sampleNumber=1,r._gridSize=[8,8],r._blit=new ti(r._resourceManager,k.a.blit_simple,s.a.isMobile),r._instanceFilter=0;var i=r._resourceManager.gl;return r._renderTarget=new wr.a(r.name+"-volume-data-texture",r._resourceManager,1024,1024,{clearColor:[0,0,0,0],colorFormat:i.RGBA8,colorFilter:i.LINEAR}),r}return du(t,e),t.prototype.destroy=function(){this._platteTexture.destroy(),this._platteTexture=null,delete this._platteTexture,this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype._updateDataTexture=function(){var e=this;if(this._dataTexture&&this._dataTexture.ready&&(this._blit.setTexture(this._dataTexture),this._renderScene.getRenderer().renderState.viewport([0,0,this._renderTarget.getWidth(),this._renderTarget.getHeight()]),this._blit.render(this._renderScene.getRenderer(),this._renderTarget,!1)),this._maskTexture&&this._maskTexture.ready){var t=this._resourceManager.gl;this._blit.setTexture(this._maskTexture);var r=this._renderTarget.getOption("blendFunc");this._renderTarget.setOption("blendFunc",[t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA]),this._renderScene.getRenderer().renderState.viewport([0,0,this._renderTarget.getWidth(),this._renderTarget.getHeight()]),this._blit.render(this._renderScene.getRenderer(),this._renderTarget,!0),this._renderTarget.setOption("blendFunc",r),this._renderTarget.always=!0}this._drawables.forEach(function(t){t.material.setDataTexture(e._renderTarget.getColorBuffer())})},t.prototype.setParameter=function(e,t){var r=this,i=this._resourceManager.gl;switch(e){case"sampleNumber":this._sampleNumber=t;break;case"gridSize":this._gridSize=t,this._renderTarget.resize(1024,1024/this._gridSize[0]*this._gridSize[1]);break;case"maskImage":if(this._maskTexture=this._resourceManager.getTexture(this.name+"-mask"),this._maskTexture.ready){console.warn("Can not set maskImage multiple times.");break}this._maskTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){r._updateDataTexture()});break;case"dataImage":this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-color"),this._dataTexture.ready&&(this._dataTexture.destroy(!0),this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-color")),this._dataTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,function(){r._updateDataTexture()});break;case"data":var n=t.data;if(this._dataTexture=this._resourceManager.getTexture(this.name+"-multi-layer-color"),!this._dataTexture.ready)if(i.isWebGL2)this._dataTexture.create(t.width,t.height,i.R32F,i.LINEAR,i.CLAMP_TO_EDGE,null,t.depth);else if(this._dataTexture.create(t.width,t.height,i.LUMINANCE,i.LINEAR,i.CLAMP_TO_EDGE,null,t.depth),!(n instanceof Uint8Array)){n=new Uint8Array(t.data.length);for(var a=0;a<t.data.length;a++)n[a]=255*t.data[a]}this._dataTexture.update(n),this._updateDataTexture();break;case"dataTexture":this._dataTexture=t,this._updateDataTexture();break;case"paletteImage":case"platteImage":this._platteTexture.createFromFile(t,i.RGBA,i.LINEAR,i.CLAMP_TO_EDGE,null),this._drawables.forEach(function(e){e.material.setPlatteTexture(r._platteTexture)});break;case"layers":this._layers=t,this._drawables.forEach(function(e){e.material.setLayers(r._layers)});case"instanceFilter":this._instanceFilter=t,this._drawables.forEach(function(e){e.material.setinstanceFilter(r._instanceFilter)})}},t.prototype.getVolumeTexture=function(){return this._renderTarget.getColorBuffer()},t.prototype._updateInvTransform=function(e){var t=U.a.create();U.a.invert(t,e.transform.matrix),e.material.setInvTransform(t)},t.prototype.setPosition=function(t){e.prototype.setPosition.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setScaling=function(t){e.prototype.setScaling.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setRotation=function(t,r){e.prototype.setRotation.call(this,t,r),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.setRotationByQuat=function(t){e.prototype.setRotationByQuat.call(this,t),this._drawables.length>0&&this._updateInvTransform(this._drawables[0])},t.prototype.draw=function(e,t,r,i,n,a,o){var s=this;if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready&&this._renderTarget.getColorBuffer().ready){if(0===this._drawables.length){var l=this._resourceManager.getMesh("volume-multi-layer");l.createSolidCube(.5);var u=["MODEL_TRANSFORM"];this._maskTexture&&u.push("HAS_MASK");var c=this._resourceManager.getShader("color_multi_layer",u);if(!c.ready){var h=k.a.color_multi_layer;if(c.createFromShaderSource(h,u),!c.ready)throw new Error("Error at creating shader 'color_multi_layer'!")}var d=new hu("volume-multi-layer",this._resourceManager);d.attachShader(c,this._resourceManager),d.setPlatteTexture(this._platteTexture),d.setAlphaCorrection(.09),d.setLayers(this._layers),d.setinstanceFilter(this._instanceFilter),d.setSampleNumber(this._sampleNumber);var p=new D.a(l,c,d,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]));this._drawables.push(p),this.setRotationByQuat(this._quaternion),this.setPosition(this._position),this.setScaling(this._scale),this._updateDataTexture()}this._drawables.forEach(function(e){e.material.setGridSize(s._gridSize)}),a.setOption("blend",!0),e.drawDrawables(a,this._drawables,t,null,null,r,i,n),a.setOption("blend",!1)}else console.warn("The resources of "+this.name+" are not ready!")},t}(Rt),fu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),_u=function(e){function t(t,r){return e.call(this,t,r)||this}return fu(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||("m_uPlatteTexture"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].texUnit=5,this.reservedParameters[n].upload=this.reservedParameters[n].uploadTexture):"m_uTime"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uSpeed"===n?(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue):"m_uWidth"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue));return i},t.prototype.setPlatteTexture=function(e){this.reservedParameters.m_uPlatteTexture.value=e},t.prototype.setTime=function(e){this.reservedParameters.m_uTime.value=e},t.prototype.setSpeed=function(e){this.reservedParameters.m_uSpeed.value=e},t.prototype.setWidth=function(e){this.reservedParameters.m_uWidth.value=e},t}(F),mu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),vu=function(){function e(e,t,r,i,n,a){this._mesh=e.getMesh("ribbon-"+t),this._mesh.createQuad(!0,!0,!1,!0),this._resourceManager=e,this._points=r,this._width=i,this._unitLength=n,this._speed=a,this.update()}return e.prototype.setWidth=function(e){this._width=e},e.prototype.setPoints=function(e){this._points=e},e.prototype.setUnitLength=function(e){this._unitLength=e},e.prototype.setSpeed=function(e){this._speed=e},e.prototype.update=function(){var e=2*this._points.length*12,t=new Float32Array(e),r=null;r=e/3>65536?new Uint32Array(6*(this._points.length-1)):new Uint16Array(6*(this._points.length-1));for(var i=0,n=0,a=0;a<this._points.length;a++){var o=this._points[a],s=this._points[Math.max(0,a-1)],l=this._points[Math.min(this._points.length-1,a+1)],u=[(i+=U.d.distance(o,s))/this._unitLength,0];t[n+0]=o[0],t[n+1]=o[1],t[n+2]=o[2],t[n+3]=s[0],t[n+4]=s[1],t[n+5]=s[2],t[n+6]=u[0],t[n+7]=u[1],t[n+8]=l[0],t[n+9]=l[1],t[n+10]=l[2],t[n+11]=1,t[(n+=12)+0]=o[0],t[n+1]=o[1],t[n+2]=o[2],t[n+3]=s[0],t[n+4]=s[1],t[n+5]=s[2],t[n+6]=u[0],t[n+7]=u[1],t[n+8]=l[0],t[n+9]=l[1],t[n+10]=l[2],t[n+11]=-1,n+=12}var c=0;for(a=1;a<this._points.length;a++)r[c+0]=2*(a-1),r[c+1]=2*(a-1)+1,r[c+2]=2*(a-1)+2,r[c+3]=2*(a-1)+2,r[c+4]=2*(a-1)+1,r[c+5]=2*(a-1)+3,c+=6;var h=this._resourceManager.gl;this._mesh.update(t,r,r instanceof Uint32Array?h.UNSIGNED_INT:h.UNSIGNED_SHORT);var d=this._resourceManager.getShader("animating-ribbon",["MODEL_TRANSFORM"]);if(!d.ready){var p=k.a["animating-ribbon"];if(d.createFromShaderSource(p,["MODEL_TRANSFORM"]),!d.ready)throw new Error("Error at creating shader 'animating-ribbon'!")}this.material=new _u("ribbon-"+this.id,this._resourceManager),this.material.attachShader(d,this._resourceManager),this.material.setSpeed(this._speed),this.material.setWidth(this._width),this.drawable=new D.a(this._mesh,d,this.material,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]))},e}(),yu=function(e){function t(t){var r=e.call(this,"AnimatingRibbon",t)||this;return r._milliSeconds=0,r._width=4,r._unitLength=10,r._speed=1,r._ribbons=[],r._platteTexture=null,r._resourceManager=t.getResourceManager(),r._lastDate=new Date,r._depthTest=!0,r}return mu(t,e),t.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype._initialize=function(){return!0},t.prototype.setParameter=function(e,t){var r=this,i=!1;switch(e){case"width":this._width=t/2,this._ribbons.forEach(function(e){e.material.setWidth(r._width)});break;case"paletteTexture":case"platteTexture":if(t instanceof O.a)this._platteTexture=t;else{this._platteTexture=this._resourceManager.getTexture(this.name+"-animatingRibbon-platte");var n=this._resourceManager.gl,a=n.RGB,o=t.split(".");"png"===o[o.length-1]&&(a=n.RGBA),this._platteTexture.createFromFile(t,a,n.LINEAR,n.REPEAT,function(){})}this._ribbons.forEach(function(e){e.material.setPlatteTexture(r._platteTexture)});break;case"speed":this._speed=t,this._ribbons.forEach(function(e){e.material.setSpeed(r._speed)});break;case"unitLength":case"unitLenght":this._unitLength=t,i=!0;break;case"depthTest":this._depthTest=t}i&&this._updateGeometry()},t.prototype.resize=function(e,t){this._ribbons.forEach(function(r){r.material.parameters.uTexSizeAndInv.value=[e,t,1/e,1/t]})},t.prototype.addRibbon=function(e){if(!(e.length<2)){var t=new vu(this._resourceManager,this.name+this._ribbons.length,e,this._width,this._unitLength,this._speed),r=this._renderScene.getRenderTarget();if(t.material.parameters.uTexSizeAndInv.value=[r.getWidth(),r.getHeight(),1/r.getWidth(),1/r.getHeight()],this._platteTexture&&t.material.setPlatteTexture(this._platteTexture),this._ribbons.push(t),this._drawables.push(t.drawable),this._resourceManager.gl.isWebGL2){this._renderScene.addEffect("Glow");var i=this._renderScene.getEffect("Glow");this.isAdded()&&i.addCustomDrawable(t.drawable),i.setEnabled(!0)}return t}console.warn("points length must be greater than 1!")},t.prototype.addEffects=function(){if(this._resourceManager.gl.isWebGL2){var e=this._renderScene.getEffect("Glow");this._ribbons.forEach(function(t){e.addCustomDrawable(t.drawable)})}},t.prototype.removeEffects=function(){if(this._resourceManager.gl.isWebGL2){var e=this._renderScene.getEffect("Glow");e&&this._ribbons.forEach(function(t){e.removeCustomDrawable(t.drawable)})}},t.prototype.removeRibbon=function(e){var t=this._ribbons.findIndex(function(t){return t===e});if(-1===t)return console.warn("can not find ribbon."),void console.warn(e);if(this._ribbons.splice(t,1),-1!==(t=this._drawables.findIndex(function(t){return e.drawable===t}))){this._renderScene.addEffect("Glow");var r=this._renderScene.getEffect("Glow");r&&this.isAdded()&&r.removeCustomDrawable(e.drawable),e.drawable.destroy(),this._drawables.splice(t,1)}else console.warn("no drawable attached to this ribbon found.")},t.prototype._updateGeometry=function(){var e=this;this._ribbons.forEach(function(t){t.setWidth(e._width),t.setUnitLength(e._unitLength),t.update()})},t.prototype._onEnableChanged=function(){this.needUpdate=this._enabled},t.prototype.draw=function(e,t,r,i,n,a,o){var s=this;if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready){var l=new Date;this._milliSeconds+=l.getTime()-this._lastDate.getTime(),this._milliSeconds>36e5&&(this._milliSeconds=0),this._lastDate=l,this._ribbons.forEach(function(e){e.material.setTime(s._milliSeconds)});var u=this._platteTexture.format===this._resourceManager.gl.RGBA,c=a.getOption("depthMask");a.setOption("blend",!0),u&&a.setOption("depthMask",!1),a.setOption("depthTest",this._depthTest),a.always=!0,e.drawDrawables(a,this._drawables,t,null,null,r,i,n,null,null),a.setOption("blend",!1),u&&a.setOption("depthMask",c),a.setOption("depthTest",!0),a.always=!0}else console.warn("cannot visualize animation ribbon without a platte texture!")},t}(Rt),gu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),bu=function(){function e(e,t,r,i,n,a,o){void 0===o&&(o=[0,0,1]),this._mesh=e.getMesh("stripe-"+t),this._mesh.createQuad(!0),this._resourceManager=e,this._points=r,this._width=i,this._unitLength=n,this._speed=a,this._normal=o,this.update()}return e.prototype.setWidth=function(e){this._width=e},e.prototype.setPoints=function(e){this._points=e},e.prototype.setUnitLength=function(e){this._unitLength=e},e.prototype.setSpeed=function(e){this._speed=e},e.prototype.update=function(){var e=2*this._points.length*5,t=new Float32Array(e),r=null;r=e/3>65536?new Uint32Array(6*(this._points.length-1)):new Uint16Array(6*(this._points.length-1));var i=0,n=0,a=U.d.create();U.d.sub(a,this._points[1],this._points[0]);for(var o=U.d.create(),s=U.d.create(),l=0;l<this._points.length;l++){var u=this._points[l],c=this._points[Math.max(0,l-1)],h=(i+=U.d.distance(u,c))/this._unitLength;U.d.cross(o,a,this._normal),U.d.normalize(o,o),U.d.scaleAndAdd(s,this._points[l],o,.5*this._width),t[n+0]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=h,t[n+4]=0,U.d.scaleAndAdd(s,this._points[l],o,.5*-this._width),t[n+5]=s[0],t[n+6]=s[1],t[n+7]=s[2],t[n+8]=h,t[n+9]=1,l<this._points.length-2?(U.d.sub(s,this._points[l+1],this._points[l]),U.d.normalize(s,s),U.d.sub(a,this._points[l+2],this._points[l+1]),U.d.normalize(a,a),U.d.add(a,a,s)):this._points[l+1]&&U.d.sub(a,this._points[l+1],this._points[l]),n+=10}var d=0;for(l=0;l<this._points.length-1;l++)r[d+0]=2*l,r[d+1]=2*l+2,r[d+2]=2*l+1,r[d+3]=2*l+1,r[d+4]=2*l+2,r[d+5]=2*l+3,d+=6;var p=this._resourceManager.gl;this._mesh.update(t,r,r instanceof Uint16Array?p.UNSIGNED_SHORT:p.UNSIGNED_INT);var f=this._resourceManager.getShader("animating-stripe",["MODEL_TRANSFORM"]);if(!f.ready){var _=k.a["animating-stripe"];if(f.createFromShaderSource(_,["MODEL_TRANSFORM"]),!f.ready)throw new Error("Error at creating shader 'animating-stripe'!")}this.material=new _u("stripe-"+this.id,this._resourceManager),this.material.attachShader(f,this._resourceManager),this.material.setSpeed(this._speed),this.drawable=new D.a(this._mesh,f,this.material,null,new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]))},e}(),wu=function(e){function t(t){var r=e.call(this,"AnimatingStripe",t)||this;return r._milliSeconds=0,r._width=4,r._unitLength=10,r._speed=1,r._stripes=[],r._platteTexture=null,r._resourceManager=t.getResourceManager(),r._lastDate=new Date,r}return gu(t,e),t.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype._initialize=function(){return!0},t.prototype.setParameter=function(e,t){var r=this,i=!1;switch(e){case"width":this._width=t;break;case"paletteTexture":case"platteTexture":if(t instanceof O.a)this._platteTexture=t;else{this._platteTexture=this._resourceManager.getTexture(this.name+"-animatingStripe-platte");var n=this._resourceManager.gl,a=n.RGB,o=t.split(".");"png"===o[o.length-1]&&(a=n.RGBA),this._platteTexture.createFromFile(t,a,n.LINEAR,n.REPEAT,function(){})}this._stripes.forEach(function(e){e.material.setPlatteTexture(r._platteTexture)});break;case"speed":this._speed=t,this._stripes.forEach(function(e){e.material.setSpeed(r._speed)});break;case"unitLength":case"unitLenght":this._unitLength=t,i=!0}i&&this._updateGeometry()},t.prototype.resize=function(e,t){},t.prototype.addStripe=function(e){if(!(e.length<2)){var t=new bu(this._resourceManager,this.name+this._stripes.length,e,this._width,this._unitLength,this._speed);this._platteTexture&&t.material.setPlatteTexture(this._platteTexture),this._stripes.push(t),this._drawables.push(t.drawable),this._renderScene.addEffect("Glow");var r=this._renderScene.getEffect("Glow");return this.isAdded()&&r.addCustomDrawable(t.drawable),r.setEnabled(!0),t}console.warn("points length must be greater than 1!")},t.prototype.removeStripe=function(e){var t=this._stripes.findIndex(function(t){return t===e});if(-1===t)return console.warn("can not find stripe."),void console.warn(e);if(this._stripes.splice(t,1),-1!==(t=this._drawables.findIndex(function(t){return e.drawable===t}))){if(this.isAdded(),this._resourceManager.gl.isWebGL2){var r=this._renderScene.getEffect("Glow");r&&this.isAdded()&&r.removeCustomDrawable(e.drawable)}e.drawable.destroy(),this._drawables.splice(t,1)}else console.warn("no drawable attached to this stripe found.")},t.prototype.addEffects=function(){if(this._resourceManager.gl.isWebGL2){var e=this._renderScene.getEffect("Glow");this._stripes.forEach(function(t){e.addCustomDrawable(t.drawable)})}},t.prototype.removeEffects=function(){if(this._resourceManager.gl.isWebGL2){var e=this._renderScene.getEffect("Glow");e&&this._stripes.forEach(function(t){e.removeCustomDrawable(t.drawable)})}},t.prototype._updateGeometry=function(){var e=this;this._stripes.forEach(function(t){t.setWidth(e._width),t.setUnitLength(e._unitLength),t.update()})},t.prototype._onEnableChanged=function(){this.needUpdate=this._enabled},t.prototype.draw=function(e,t,r,i,n,a,o){var s=this;if(void 0===o&&(o=-1),this._enabled)if(this._platteTexture.ready){var l=new Date;this._milliSeconds+=l.getTime()-this._lastDate.getTime(),this._milliSeconds>36e5&&(this._milliSeconds=0),this._lastDate=l,this._stripes.forEach(function(e){e.material.setTime(s._milliSeconds)});var u=this._platteTexture.format===this._resourceManager.gl.RGBA,c=a.getOption("depthMask");a.setOption("blend",!0),u&&a.setOption("depthMask",!1),e.drawDrawables(a,this._drawables,t,null,null,r,i,n,null,null),a.setOption("blend",!1),u&&a.setOption("depthMask",c)}else console.warn("cannot visualize animation stripe without a platte texture!")},t}(Rt),xu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Mu=function(e){function t(t,r){return e.call(this,t,r)||this}return xu(t,e),t.prototype.attachShader=function(t,r){var i=e.prototype.attachShader.call(this,t,r);if(!i)return null;for(var n in t.reservedUniforms)this.reservedParameters.hasOwnProperty(n)||"m_uLimitU"===n&&(this.reservedParameters[n]=new C.a,this.reservedParameters[n].upload=this.reservedParameters[n].uploadValue);return i},t.prototype.setLimitU=function(e){this.reservedParameters.m_uLimitU.value=e},t}(F),Eu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Tu=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Su=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Tu(arguments[t]));return e},Au=function(){return function(e,t){this._center=null,this._normal=null,this._center=[e[0]*V.a.Meter2Foot,e[1]*V.a.Meter2Foot,e[2]*V.a.Meter2Foot],this._normal=t,U.d.normalize(this._normal,this._normal)}}(),Pu=function(e){function t(t,r,i,n){var a=e.call(this,t,r)||this;return a._radius=.1*V.a.Meter2Foot,a._slices=12,a._radius=i*V.a.Meter2Foot,a._slices=n,a}return Eu(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),t.prototype.meshize=function(){var e=this,t=this._slices+1,r=new Float32Array(8*t),i=U.d.clone(this._normal),n=U.d.create(),a=U.d.create();U.d.normalize(i,i);var o=Math.abs(i[0])>.9?[0,1,0]:[1,0,0];U.d.cross(a,i,o),U.d.cross(n,a,i),U.d.normalize(n,n),U.d.normalize(a,a);for(var s=2*Math.PI/this._slices,l=this._radius,u=0,c=0,h=U.d.create(),d=function(t){var i=Math.cos(u),o=Math.sin(u);[0,1,2].forEach(function(t){return r[c+t]=e._center[t]+l*i*n[t]+l*o*a[t]});var d=[r[c],r[c+1],r[c+2]];U.d.sub(h,d,p._center),U.d.normalize(h,h),c+=3,[0,1,2].forEach(function(e){return r[c+e]=h[e]}),r[(c+=3)+0]=0,r[c+1]=t/p._slices,c+=2,u+=s},p=this,f=0;f<=this._slices;f++)d(f);return r},t}(Au),ku=function(e){function t(t,r,i,n,a){void 0===a&&(a=[0,0,1]);var o=e.call(this,t,r)||this;return o._width=1*V.a.Meter2Foot,o._height=1*V.a.Meter2Foot,o._axisY=[0,0,1],o._width=i*V.a.Meter2Foot,o._height=n*V.a.Meter2Foot,o._axisY=a,o}return Eu(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return.5*this._width},enumerable:!1,configurable:!0}),t.prototype.meshize=function(){var e=new Float32Array(64),t=this._center,r=this._axisY,i=this._normal,n=this._height,a=this._width,o=2*(a+n),s=U.d.create();U.d.cross(s,r,i);var l=U.d.create(),u=U.d.create();U.d.scale(l,s,.5*a),U.d.scale(u,r,.5*n);var c=new Float32Array(e.buffer,0),h=new Float32Array(e.buffer,32),d=new Float32Array(e.buffer,64),p=new Float32Array(e.buffer,96),f=new Float32Array(e.buffer,128),_=new Float32Array(e.buffer,160),m=new Float32Array(e.buffer,192),v=new Float32Array(e.buffer,224);return U.d.sub(c,t,l),U.d.add(c,c,u),U.d.sub(h,t,l),U.d.sub(h,h,u),U.d.copy(d,h),U.d.add(p,t,l),U.d.sub(p,p,u),U.d.copy(f,p),U.d.add(_,t,l),U.d.add(_,_,u),U.d.copy(m,_),U.d.copy(v,c),c=new Float32Array(e.buffer,12),h=new Float32Array(e.buffer,44),d=new Float32Array(e.buffer,76),p=new Float32Array(e.buffer,108),f=new Float32Array(e.buffer,140),_=new Float32Array(e.buffer,172),m=new Float32Array(e.buffer,204),v=new Float32Array(e.buffer,236),U.d.scale(c,s,-1),U.d.copy(h,c),U.d.scale(d,r,-1),U.d.copy(p,d),U.d.copy(f,s),U.d.copy(_,f),U.d.copy(m,r),U.d.copy(v,m),c=new Float32Array(e.buffer,24),h=new Float32Array(e.buffer,56),d=new Float32Array(e.buffer,88),p=new Float32Array(e.buffer,120),f=new Float32Array(e.buffer,152),_=new Float32Array(e.buffer,184),m=new Float32Array(e.buffer,216),v=new Float32Array(e.buffer,248),U.c.copy(c,[0,0]),U.c.copy(h,[0,n/o]),U.c.copy(d,h),U.c.copy(p,[0,(a+n)/o]),U.c.copy(f,p),U.c.copy(_,[0,(a+2*n)/o]),U.c.copy(m,_),U.c.copy(v,[0,1]),e},t}(Au),Ou=function(){function e(e,t){this._head=null,this._tail=null,this._length=0,this._head=e,this._tail=t,this._length=U.d.distance(e,t)}return Object.defineProperty(e.prototype,"head",{get:function(){return this._head},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tail",{get:function(){return this._tail},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),e.prototype.meshize=function(e,t){var r=e.length/8-1;return[this._createVertices(e,t),this._createIndices(r)]},e.prototype._createVertices=function(e,t){var r=e.length,i=new Float32Array(2*r),n=U.d.create();U.d.sub(n,this._tail,this._head),U.d.normalize(n,n),U.d.scale(n,n,t),t*=V.a.Foot2Meter;for(var a=r/8,o=0;o<a;o++){for(var s=0;s<8;s++){var l=8*o+s;i[l]=e[l],i[r+l]=e[l]}i[r+8*o+0]=e[8*o+0]+n[0],i[r+8*o+1]=e[8*o+1]+n[1],i[r+8*o+2]=e[8*o+2]+n[2],i[r+8*o+6]=e[8*o+6]+t}return i},e.prototype._createIndices=function(e){for(var t=new Uint32Array(6*e),r=0,i=0;i<e;i++)t[r+0]=i,t[r+1]=i+1,t[r+2]=t[r+0]+e+1,t[r+3]=t[r+1],t[r+4]=t[r+1]+e+1,t[r+5]=t[r+2],r+=6;return t},e}(),Du=function(){function e(e,t,r,i,n){this._head=null,this._tail=null,this._center=null,this._length=0,this._pipeRadius=0,this._bendRadius=0,this._angle=0,this._dAngle=10*V.a.Deg2Rad,this._rotateAxis=[0,0,1],this._head=e,this._tail=t,this._pipeRadius=i,this._bendRadius=n,this._calLengthAndRotateAxis(r)}return e.prototype._calLengthAndRotateAxis=function(e){var t=this._pipeRadius+this._bendRadius,r=U.d.create(),i=U.d.create();U.d.sub(r,this._head,e),U.d.sub(i,this._tail,e),U.d.normalize(r,r),U.d.normalize(i,i);var n=U.d.angle(r,i);this._angle=Math.PI-n,this._length=this._angle*t;var a=U.d.create();U.d.cross(a,i,r);var o=U.d.create(),s=.5*n;U.d.rotateByVector(o,i,a,s),U.d.normalize(o,o);var l=t/Math.sin(s);U.d.scale(o,o,l);var u=U.d.create();U.d.add(u,e,o),this._center=u,U.d.normalize(this._rotateAxis,a)},Object.defineProperty(e.prototype,"head",{get:function(){return this._head},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tail",{get:function(){return this._tail},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),e.prototype.meshize=function(e,t){for(var r=this._pipeRadius+this._bendRadius,i=t/r,n=Math.floor(i/this._dAngle)+1+1,a=e.length/8,o=6*(a-1)*(n-1),s=new Float32Array(8*(a*n)),l=new Uint32Array(o),u=0,c=0,h=0,d=0;d<n;d++){for(var p=0,f=this._rotate(this._head,u),_=u*r*V.a.Foot2Meter,m=function(t){var r=[e[p+0],e[p+1],e[p+2]],i=v._rotate(r,u),o=U.d.create();return U.d.sub(o,i,f),U.d.normalize(o,o),[0,1,2].forEach(function(e){return s[c+0+e]=i[e]}),[0,1,2].forEach(function(e){return s[c+3+e]=o[e]}),s[c+6]=e[p+6]+_,s[c+7]=e[p+7],t===a-1?"continue":d===n-1?"continue":(l[h+0]=d*a+t,l[h+1]=d*a+t+1,l[h+2]=l[h+0]+a,l[h+3]=l[h+1],l[h+4]=l[h+1]+a,l[h+5]=l[h+2],void(h+=6))},v=this,y=0;y<a;y++,p+=8,c+=8)m(y);u+=this._dAngle,u=Math.min(u,i)}return[s,l]},e.prototype._rotate=function(e,t){var r=U.d.create(),i=U.d.create();return U.d.sub(i,e,this._center),U.d.rotateByVector(r,i,this._rotateAxis,t),U.d.add(r,r,this._center),r},e}();!function(e){e[e.Growing=0]="Growing",e[e.Flowing=1]="Flowing",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"}(Wl||(Wl={}));var Nu,Cu,Iu,Ru,Bu=function(){function e(t){this._statusCur=Wl.Stopped,this._statusPre=Wl.Stopped,this._id=-1,this._resourceManager=null,this._mesh=null,this._material=null,this._color=[1,0,0,1],this._texture=null,this._textureScale=[1,1,0],this._shader=null,this._drawable=null,this._bendRadius=.1*V.a.Meter2Foot,this._profile=null,this._keyPoints=[],this._speedGrow=.3*V.a.Meter2Foot,this._speedFlow=.1*V.a.Meter2Foot,this._tsUpdateGeometry=null,this._teUpdateGeometry=0,this._tsUpdateMaterial=null,this._teUpdateMaterial=0,this._updateGeometryOver=!1,this._updateMaterialOver=!1,this._segments=[],this._corners=[],this._length=0,this._onGrowingOver=null,this._onFlowingOver=null,this._resourceManager=t,this._id=e.numPipes++}return e.prototype.onGrowingOver=function(e){this._onGrowingOver=e},e.prototype.onFlowingOver=function(e){this._onFlowingOver=e},e.prototype._createMesh=function(){this._mesh=this._resourceManager.getMesh("pipe-"+this._id),this._mesh.createQuad(!0,!0,!1,!1)},e.prototype._createShader=function(){var e=this._statusCur===Wl.Growing?"animating-pipe-solid":"animating-pipe-texture";if(this._shader=this._resourceManager.getShader(e),!this._shader.ready){var t=k.a[e];if(this._shader.createFromShaderSource(t),!this._shader.ready)throw new Error("Error at creating shader '"+e+"'!")}},e.prototype._createMaterial=function(){this._material=new Mu("pipe-"+this._id,this._resourceManager),this._material.setSide(N.a.DOUBLESIDE),this._material.attachShader(this._shader,this._resourceManager),this._color&&this._material.setDiffuse(this._color),this._statusCur!==Wl.Growing&&(this._material.setDiffuseTexture(this._texture),this._material.setTextureScale(this._textureScale))},e.prototype._createDrawable=function(){var e=new Float32Array([-1/0,-1/0,-1/0,1/0,1/0,1/0]);this._drawable=new D.a(this._mesh,this._shader,this._material,null,e)},e.prototype.draw=function(e,t,r,i,n,a){this._statusCur!==Wl.Stopped&&(this._update(),this._draw(e,t,r,i,n,a))},e.prototype._update=function(){this._statusCur!==Wl.Paused&&(this._growing()||this._flowing())},e.prototype._draw=function(e,t,r,i,n,a){e.drawDrawables(t,[this._drawable],r,null,null,i,n,a,null,null)},e.prototype.grow=function(){this._statusCur=Wl.Growing,this._reset()},e.prototype.flow=function(){this._statusCur=Wl.Flowing,this._reset()},e.prototype.pause=function(){this._statusCur!==Wl.Paused&&this._statusCur!==Wl.Stopped&&(this._statusPre=this._statusCur,this._statusCur=Wl.Paused)},e.prototype.resume=function(){this._statusCur===Wl.Paused&&(this._statusCur=this._statusPre,this._tsUpdateGeometry=Date.now())},e.prototype.stop=function(){this._statusCur!==Wl.Stopped&&(this._statusCur=Wl.Stopped,this._destroy())},e.prototype.attachEffect=function(e){e.addCustomDrawable(this._drawable)},e.prototype.detachEffect=function(e){e.removeCustomDrawable(this._drawable)},e.prototype.setBendRadius=function(e){this._bendRadius=e*V.a.Meter2Foot},e.prototype.setKeyPoints=function(e){var t=this;e.forEach(function(e){return t._keyPoints.push([e[0]*V.a.Meter2Foot,e[1]*V.a.Meter2Foot,e[2]*V.a.Meter2Foot])})},e.prototype.getLength=function(){return 0==this._segments.length&&(this._cut(),this._calPipeLength()),this._length*V.a.Foot2Meter},e.prototype._cut=function(){if(!(this._segments.length>0)){this._segments=[],this._corners=[];for(var e=this._keyPoints.length,t=0;t<e-1;t++){var r=this._getSectionHead(t),i=this._getSectionTail(t),n=new Ou(r,i);if(this._segments.push(n),0!==t){var a=r,o=this._segments[this._segments.length-2].tail,s=this._keyPoints[t],l=new Du(o,a,s,this._profile.radius,this._bendRadius);this._corners.push(l)}}}},e.prototype._getSectionHead=function(e){if(0===e)return this._keyPoints[0];var t=Su(this._keyPoints[e]),r=this._keyPoints[e+1],i=this._keyPoints[e-1],n=U.d.create(),a=U.d.create();U.d.sub(n,i,t),U.d.sub(a,r,t),U.d.normalize(a,a),U.d.normalize(n,n);var o=.5*U.d.angle(n,a);if(o>1.57)return t;var s=(this._profile.radius+this._bendRadius)/Math.tan(o),l=U.d.create();return U.d.scale(l,a,s),U.d.add(t,t,l),t},e.prototype._getSectionTail=function(e){var t=this._keyPoints.length;if(e===t-2)return this._keyPoints[t-1];var r=this._keyPoints[e],i=Su(this._keyPoints[e+1]),n=this._keyPoints[e+2],a=U.d.create(),o=U.d.create();U.d.sub(a,r,i),U.d.sub(o,n,i),U.d.normalize(a,a),U.d.normalize(o,o);var s=.5*U.d.angle(a,o);if(s>1.57)return i;var l=(this._profile.radius+this._bendRadius)/Math.tan(s),u=U.d.create();return U.d.scale(u,a,l),U.d.add(i,i,u),i},e.prototype._calPipeLength=function(){var e=this;this._length=0,this._segments.forEach(function(t){return e._length+=t.length}),this._corners.forEach(function(t){return e._length+=t.length})},e.prototype._destroy=function(){this._updateGeometryOver=!1,this._updateMaterialOver=!1,this._tsUpdateGeometry=null,this._teUpdateGeometry=0,this._tsUpdateMaterial=null,this._teUpdateMaterial=0,this._drawable.destroy(),this._shader.destroy(),this._material.destroy(),this._mesh.destroy()},e.prototype._reset=function(){this._createMesh(),this._createShader(),this._createMaterial(),this._createDrawable(),this._cut(),this._calPipeLength()},e.prototype.setColor=function(e){var t,r,i=this;[0,1,2].forEach(function(t){return i._color[t]=e[t]/255}),this._color[3]=null!==(t=e[3])&&void 0!==t?t:1,null===(r=this._material)||void 0===r||r.setDiffuse(this._color)},e.prototype.setTextureScale=function(e){var t;this._textureScale=e,null===(t=this._material)||void 0===t||t.setTextureScale(e)},e.prototype.setTexture=function(e){this._texture=this._resourceManager.getTexture("pipe_"+this._id);var t=this._resourceManager.gl,r="png"===e.split(".").pop()?t.RGBA:t.RGB;this._texture.createFromFile(e,r,t.LINEAR,t.REPEAT)},e.prototype.setGrowSpeed=function(e){this._speedGrow=e*V.a.Meter2Foot},e.prototype.setFlowSpeed=function(e){this._speedFlow=e*V.a.Meter2Foot},e.prototype.setProfile=function(e){this._profile=e},e.prototype.getProfile=function(){return this._profile},e.prototype._growing=function(){var e;if(this._statusCur!==Wl.Growing)return!1;if(this._updateGeometryOver)return!0;var t=Date.now();this._tsUpdateGeometry=null!==(e=this._tsUpdateGeometry)&&void 0!==e?e:t,this._teUpdateGeometry+=.001*(t-this._tsUpdateGeometry),this._tsUpdateGeometry=t;var r=this._speedGrow*this._teUpdateGeometry;r>this._length&&(r=this._length,this._updateGeometryOver=!0,this._onGrowingOver&&this._onGrowingOver());var i=Tu(this._meshize(r),2),n=i[0],a=i[1],o=this._resourceManager.gl;return this._mesh.update(n,a,o.UNSIGNED_INT),this._drawable.updateBBox(),!0},e.prototype._flowing=function(){var e;if(this._statusCur!==Wl.Flowing)return!1;var t=Date.now();this._tsUpdateMaterial=null!==(e=this._tsUpdateMaterial)&&void 0!==e?e:t,this._teUpdateMaterial+=.001*(t-this._tsUpdateMaterial),this._tsUpdateMaterial=t;var r=this._speedFlow*this._teUpdateMaterial;if(r-=r>2*this._length?this._length:0,this._material.setLimitU(r*V.a.Foot2Meter),this._updateMaterialOver)return!0;r>=this._length&&(this._updateMaterialOver=!0,this._onFlowingOver&&this._onFlowingOver());var i=Tu(this._meshize(r),2),n=i[0],a=i[1],o=this._resourceManager.gl;return this._mesh.update(n,a,o.UNSIGNED_INT),this._drawable.updateBBox(),!0},e.prototype._meshize=function(e){for(var t=[],r=[],i=0,n=this._profile.meshize(),a=4*n.length,o=function(o){var l,u=s._segments[o],c=Math.min(u.length,e),h=Tu(u.meshize(n,c),2),d=h[0],p=h[1];if(p.forEach(function(e,t){return p[t]+=i}),i+=d.length/8,t.push.apply(t,Su(d)),r.push.apply(r,Su(p)),(e-=c)<=0)return"break";if(o===s._segments.length-1)return"break";var f=s._corners[o];if(c=Math.min(f.length,e),n=new Float32Array(d.buffer,4*d.length-a),d=(l=Tu(f.meshize(n,c),2))[0],(p=l[1]).forEach(function(e,t){return p[t]+=i}),i+=d.length/8,t.push.apply(t,Su(d)),r.push.apply(r,Su(p)),(e-=c)<=0)return"break";n=new Float32Array(d.buffer,4*d.length-a)},s=this,l=0;l<this._segments.length;l++){if("break"===o(l))break}return[new Float32Array(t),new Uint32Array(r)]},e.numPipes=0,e}(),Lu=function(e){function t(t){var r=e.call(this,"AnimatingPipe",t)||this;return r._pipes=[],r._depthTest=!0,r._enabled=!0,r._resourceManager=r._renderScene.getResourceManager(),r}return Eu(t,e),t.prototype.destroy=function(){this._resourceManager=null,delete this._resourceManager,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype._initialize=function(){return!0},t.prototype.resize=function(e,t){},t.prototype.addPipe=function(e){this._pipes.push(e)},t.prototype.removePipe=function(e){var t=this._pipes.indexOf(e);-1!==t&&this._pipes.splice(t,1)},t.prototype.attachEffectGlow=function(e){if(!this._resourceManager.gl.isWebGL2)return!1;var t=this._renderScene.getEffect("Glow");return!!(t||(this._renderScene.addEffect("Glow"),t=this._renderScene.getEffect("Glow")))&&(t.setEnabled(!0),e?e.attachEffect(t):this._pipes.forEach(function(e){return e.attachEffect(t)}),!0)},t.prototype.detachEffectGlow=function(e){if(!this._resourceManager.gl.isWebGL2)return!1;var t=this._renderScene.getEffect("Glow");return!!t&&(e?e.detachEffect(t):this._pipes.forEach(function(e){return e.detachEffect(t)}),!0)},t.prototype._onEnableChanged=function(){this.needUpdate=this._enabled},t.prototype.draw=function(e,t,r,i,n,a){if(this._enabled){var o=a.getOption("depthMask");a.setOption("blend",!0),a.setOption("depthMask",!0),a.setOption("depthTest",this._depthTest),a.always=!0,this._pipes.forEach(function(o){return o.draw(e,a,t,r,i,n)}),a.setOption("blend",!1),a.setOption("depthMask",o),a.setOption("depthTest",!0),a.always=!0}},t}(Rt),Fu=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Uu=new Uint8Array([0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4]),Vu=function(e){function t(t){var r=e.call(this,"BBoxSize",!0,t)||this;r._cube=null,r._vertices=new Float32Array(24),r._indices=[],r._indices[0]=new Uint16Array([0,4,7,7,3,0]),r._indices[1]=new Uint16Array([0,1,5,5,4,0]),r._indices[2]=new Uint16Array([0,3,2,2,1,0]),r._indices[3]=new Uint16Array([5,1,2,2,6,5]),r._indices[4]=new Uint16Array([6,2,3,3,7,6]),r._indices[5]=new Uint16Array([4,5,6,6,7,4]);var i=r._resourceManager.getMesh("wiredcube");i.createWiredCube(),r._cube=new ta(i,r._resourceManager),r._cube.setColor([.2,.2,.2]),r._cube.setTransparent(1),t.getRenderScene().addBboxDrawable(r._cube),r._anchors=[{x:0,y:0,number:NaN,position:U.d.create()},{x:0,y:0,number:NaN,position:U.d.create()},{x:0,y:0,number:NaN,position:U.d.create()}];r._resourceManager.gl;return r._rotate=!1,r._rotateMatrix=U.a.create(),r._invertedRotateMatrix=U.a.create(),r._bbox=P.a.aabb.create(),r._BBoxSizeedBBox=P.a.aabb.create(),r._points=P.a.aabb.points(r._scene.bbox),r}return Fu(t,e),t.prototype.destroy=function(){this._vertices=null,this._indices=null,this._cube.destroy()},t.prototype._updateAnchor=function(){var e=[0,0,0],t=[0,0,0];U.d.copy(e,this._points[4]),U.d.copy(t,this._points[2]);var r=U.d.fromValues(t[0]-e[0],t[1]-e[1],t[2]-e[2]);U.d.set(this._anchors[0].position,e[0]+r[0]/2,e[1],e[2]),U.d.set(this._anchors[1].position,e[0],e[1]+r[1]/2,e[2]),U.d.set(this._anchors[2].position,e[0],e[1],e[2]+r[2]/2),this._anchors[0].number=r[0],this._anchors[1].number=r[1],this._anchors[2].number=r[2]},t.prototype.setBBoxSizeBox=function(e){this._BBoxSizeedBBox=e,this._updatePoints(),this.updateGeometry(),this._renderer.renderState.invalidateClip(),this._viewer.invalidate()},t.prototype.getBBoxSizeBox=function(){return this._BBoxSizeedBBox},t.prototype._render=function(){for(var e=this._viewer.getCamera().core,t=0;t<3;++t){var r=e.project(this._anchors[t].position);this._anchors[t].x=r[0],this._anchors[t].y=r[1]}this._viewer.notifyEventListener("showBoxUpdate",[this._anchors[0],this._anchors[1],this._anchors[2]])},t.prototype.dump=function(){var e=this._viewer.getCamera().core;if(this._enabled){for(var t=0;t<3;++t){var r=e.project(this._anchors[t].position);this._anchors[t].x=r[0],this._anchors[t].y=r[1]}this._viewer.getEventEmitter().emit("showBoxDump",[this._anchors[0],this._anchors[1],this._anchors[2]])}},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.updateGeometry=function(e){var t=this._resourceManager.gl;this._vertices[0]=this._points[0][0],this._vertices[1]=this._points[0][1],this._vertices[2]=this._points[0][2],this._vertices[3]=this._points[1][0],this._vertices[4]=this._points[1][1],this._vertices[5]=this._points[1][2],this._vertices[6]=this._points[2][0],this._vertices[7]=this._points[2][1],this._vertices[8]=this._points[2][2],this._vertices[9]=this._points[3][0],this._vertices[10]=this._points[3][1],this._vertices[11]=this._points[3][2],this._vertices[12]=this._points[4][0],this._vertices[13]=this._points[4][1],this._vertices[14]=this._points[4][2],this._vertices[15]=this._points[5][0],this._vertices[16]=this._points[5][1],this._vertices[17]=this._points[5][2],this._vertices[18]=this._points[6][0],this._vertices[19]=this._points[6][1],this._vertices[20]=this._points[6][2],this._vertices[21]=this._points[7][0],this._vertices[22]=this._points[7][1],this._vertices[23]=this._points[7][2],this._cube.mesh.update(this._vertices,Uu,t.UNSIGNED_BYTE),e&&e.renderState.invalidateClip()},t.prototype.reset=function(e){this._rotate=!1,this._updateBBox([0,-1,0]),this._updatePoints(),this.updateGeometry(e),this._updateAnchor()},t.prototype.setVisible=function(e){this._enabled=e,this._viewer.setCullingEnabled(!e),this._enabled&&this.reset(),this._viewer.getRenderScene().setBBoxEnabled(e),this._viewer.invalidate()},t.prototype.isRotatable=function(){return this._rotate},t.prototype._updateBBox=function(e){var t=P.a.aabb.center(this._scene.bbox),r=U.d.create();U.d.scaleAndAdd(r,t,e,this._scene.radius),Math.abs(e[2])>.9999?U.a.lookAt(this._rotateMatrix,r,t,[0,1,0]):U.a.lookAt(this._rotateMatrix,r,t,[0,0,1]),U.a.invert(this._invertedRotateMatrix,this._rotateMatrix);var i=this._scene.bbox;if(Tr.a.compressNormals){i[0]-=1e-4,i[1]-=1e-4,i[2]-=1e-4,i[3]+=1e-4,i[4]+=1e-4,i[5]+=1e-4}P.a.aabb.points2(i,this._points);for(var n=0,a=this._points.length;n<a;n++)U.d.transformMat4(this._points[n],this._points[n],this._rotateMatrix);P.a.aabb.createFromPoints(this._bbox,this._points),P.a.aabb.copy(this._BBoxSizeedBBox,this._bbox),this._cube.bbox=P.a.aabb.createFromArray(this._BBoxSizeedBBox),this._cube.bsphere=P.a.sphere.createFromAABB(this._BBoxSizeedBBox),this._updatePoints()},t.prototype._updatePoints=function(){P.a.aabb.points2(this._BBoxSizeedBBox,this._points),U.d.transformMat4(this._points[0],this._points[0],this._invertedRotateMatrix),U.d.transformMat4(this._points[1],this._points[1],this._invertedRotateMatrix),U.d.transformMat4(this._points[2],this._points[2],this._invertedRotateMatrix),U.d.transformMat4(this._points[3],this._points[3],this._invertedRotateMatrix),U.d.transformMat4(this._points[4],this._points[4],this._invertedRotateMatrix),U.d.transformMat4(this._points[5],this._points[5],this._invertedRotateMatrix),U.d.transformMat4(this._points[6],this._points[6],this._invertedRotateMatrix),U.d.transformMat4(this._points[7],this._points[7],this._invertedRotateMatrix),this._scene.clipping.update(this._points)},t}(gr.a),ju=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),zu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Gu=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Hu=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gu(arguments[t]));return e};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE",e[e.AREA=3]="AREA",e[e.RECT=4]="RECT"}(Nu||(Nu={})),function(e){e[e.NONE=0]="NONE",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.OUTLINE=2]="OUTLINE"}(Cu||(Cu={})),function(e){e[e.NONE=-1]="NONE",e[e.TRIANGLE=0]="TRIANGLE",e[e.Arrow=1]="Arrow"}(Iu||(Iu={})),function(e){e[e.NONE=-1]="NONE",e[e.XY=0]="XY",e[e.XZ=1]="XZ",e[e.YZ=2]="YZ"}(Ru||(Ru={}));var qu,Wu=function(){function e(e,t){this.ready=!1,this.id=e,this.renderScene=t,this.drawingPlane=[0,0,1,0]}return e.prototype.use=function(){this.ready||(this.drawable.setId(this.id),this.drawable.name=this.id,this.renderScene.addMarkDrawable(this.drawable),this.ready=!0)},e.prototype.clone=function(){},e.prototype.getWorldPoints=function(){return[]},e.prototype.getTypeName=function(){var e="";switch(this.type){case 1:e="point";break;case 2:e="line";break;case 3:e="area";break;case 4:e="rect";break;default:e="unKnown"}return e},e.prototype.getParameters=function(){var e={};for(var t in this._parameters)e[t]=this._parameters[t];return e},e.prototype.setParameters=function(e){for(var t in e)void 0!==this._parameters[t]&&(this._parameters[t]=e[t]);this._updateParameters()},e.prototype._updateParameters=function(){this.setColor(this._parameters.color),this.setTransparent(this._parameters.opacity),this.setTransformMatrix(this._parameters.transform)},e.prototype.detach=function(){this.renderScene.removeMarkDrawable(this.drawable)},e.prototype.isEmpty=function(){return!this.drawable},e.prototype.destory=function(){var e,t;if(this.anchorPoints){try{for(var r=zu(this.anchorPoints),i=r.next();!i.done;i=r.next()){var n=i.value;this.renderScene.removeMarkDrawable(n)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.anchorPoints=[]}this.detach(),this.drawable&&(this.drawable.destroy(),this.drawable=null),this.ready=!1},e.prototype.restore=function(){if(!this.ready){var e=this.renderScene.getResourceManager(),t=e.getMesh(this.id);t.restoreBuffer(e),this.drawable=new kr(t,e),this.renderScene.addMarkDrawable(this.drawable),this.ready=!0}},e.prototype.setVisible=function(e){this.drawable.visible=e},e.prototype.isVisible=function(){return this.drawable.visible},e.prototype.calcAlignment=function(e,t){var r=U.d.create();switch(U.d.subtract(r,t,e),(r=r.map(function(e){return Math.abs(e)}))[0]>r[1]?r[0]>r[2]?"x":"z":r[1]>r[2]?"y":"z"){case"x":t[1]=e[1],t[2]=e[2];break;case"y":t[0]=e[0],t[2]=e[2];break;case"z":t[0]=e[0],t[1]=e[1]}return t},e.prototype.select=function(){},e.prototype.unSelect=function(){},e.prototype.setColor=function(e){this.color=e,this.drawable.setColor(this.color)},e.prototype.setTransparent=function(e){this.drawable.setTransparent(e)},e.prototype.transform=function(e){this.matrix=e},e.prototype.startEdit=function(){},e.prototype.addAnchorPoint=function(e){var t=this.renderScene.getResourceManager().getMesh(a.a.generateUUID());t.createPoint();var r=new kr(t,this.renderScene.getResourceManager());r.setTranslation(e[0],e[1],e[2]),r.setColor(Ju),r.setTransparent(1),this.renderScene.addMarkDrawable(r),this.anchorPoints.push(r)},e.prototype.removeAnchorPoint=function(e){var t=this.anchorPoints[e];this.renderScene.removeMarkDrawable(t),this.anchorPoints.splice(e,1),t.destroy()},e.prototype.removeAllAnchorPoint=function(){var e,t;try{for(var r=zu(this.anchorPoints),i=r.next();!i.done;i=r.next()){var n=i.value;this.renderScene.removeMarkDrawable(n),n.destroy()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.anchorPoints=[]},e.prototype.setDrawingPlane=function(e){this.drawingPlane=e},e.prototype.setTransformMatrix=function(e){this.drawable&&this.drawable.setTransformMatrix(e)},e.prototype.getTransformMatrix=function(){return this.drawable.getTransformMatrix()},e}(),Qu=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;n._worldPoint=i,n.type=Nu.POINT,n._pointSize=10;var a=r.getResourceManager(),o=a.getMesh("point"+t);o.createPoint(),n.drawable=new kr(o,a,void 0,["DRAW_POINT"]),o.update(new Float32Array(i),new Uint16Array([0]));var s=n._calcBbox(i);return n.drawable.setBbox(s),n}return ju(t,e),t.prototype.getWorldPoints=function(){return this._worldPoint},t.prototype.revoke=function(){this._worldPoint=null,this.destory()},t.prototype._calcBbox=function(e){return P.a.aabb.createFromArray([e[0]-this._pointSize,e[1]-this._pointSize,e[2]-this._pointSize,e[0]+this._pointSize,e[1]+this._pointSize,e[2]+this._pointSize])},t.prototype.getKeyPoints=function(){return this._worldPoint},t.prototype.update=function(e){e.unproject(this._worldPoint)},t}(Wu),Yu=function(e){function t(t,r){var i=e.call(this,t,r)||this,n=r.getResourceManager();return i._worldPoints=[],i.type=Nu.LINE,i._mesh=n.getMesh("Line"+t),i._mesh.createLineStrip(),i.drawable=new kr(i._mesh,n),i}return ju(t,e),t.prototype.addKeyPoint=function(e,t){var r=this._worldPoints.length>0?this._worldPoints[this._worldPoints.length-1]:null;return t&&r&&this.calcAlignment(r,e),this._worldPoints.push(e),e},t.prototype.revoke=function(){var e=null;return this._worldPoints.pop(),0===this._worldPoints.length?this.destory():(e=this._worldPoints[this._worldPoints.length-1],this._updateVertices()),e},t.prototype.unRevoke=function(){},t.prototype.getWorldPoints=function(){return this._worldPoints},t.prototype.setWorldPoints=function(e){this._worldPoints=e,this.completeDrawing()},t.prototype.updateActivePoint=function(e,t){0!==this._worldPoints.length&&(this._activePoint=t?this.calcAlignment(this._worldPoints[this._worldPoints.length-1],e):e,this._updateVertices())},t.prototype.stopDrawing=function(e,t){var r=this.addKeyPoint(e,t);return this.completeDrawing(),r},t.prototype._calcBbox=function(){for(var e=P.a.aabb.createFromArray([1/0,1/0,1/0,-1/0,-1/0,-1/0]),t=0,r=this._worldPoints.length;t<r;t++)e[0]=Math.min(this._worldPoints[t][0],e[0]),e[1]=Math.min(this._worldPoints[t][1],e[1]),e[2]=Math.min(this._worldPoints[t][2],e[2]),e[3]=Math.max(this._worldPoints[t][0],e[3]),e[4]=Math.max(this._worldPoints[t][1],e[4]),e[5]=Math.max(this._worldPoints[t][2],e[5]);return this._activePoint&&(e[0]=Math.min(this._activePoint[0],e[0]),e[1]=Math.min(this._activePoint[1],e[1]),e[2]=Math.min(this._activePoint[2],e[2]),e[3]=Math.max(this._activePoint[0],e[3]),e[4]=Math.max(this._activePoint[1],e[4]),e[5]=Math.max(this._activePoint[2],e[5])),e},t.prototype._updateVertices=function(){for(var e=[],t=new Uint16Array(this._worldPoints.length+(this._activePoint?1:0)),r=0;r<this._worldPoints.length;r++)e.push(this._worldPoints[r][0]),e.push(this._worldPoints[r][1]),e.push(this._worldPoints[r][2]),t[r]=r;this._activePoint&&(e.push(this._activePoint[0]),e.push(this._activePoint[1]),e.push(this._activePoint[2]),t[t.length-1]=t.length-1),this._mesh.update(new Float32Array(e),t)},t.prototype.getKeyPoints=function(){return this._worldPoints},t.prototype.update=function(e){},t.prototype.completeDrawing=function(){if(this._activePoint=null,this._worldPoints.length>1){this._updateVertices();var e=this._calcBbox();return this.drawable.setBbox(e),!0}return this.destory(),!1},t}(Wu),Xu=function(e){function t(t,r){var i=e.call(this,t,r)||this,n=r.getResourceManager();return i._worldPoints=[],i.anchorPoints=[],i.type=Nu.AREA,i._mesh=n.getMesh("Area"+t),i._mesh.createSharePolygon(),i.drawable=new kr(i._mesh,n),i}return ju(t,e),t.prototype.addKeyPoint=function(e,t){var r=this._worldPoints.length>0?this._worldPoints[this._worldPoints.length-1]:null;t&&r&&this.calcAlignment(r,e),this._worldPoints.push(e),this.addAnchorPoint(e),this._worldPoints.length>=3&&this.removeAnchorPoint(0)},t.prototype.getWorldPoints=function(){return this._worldPoints},t.prototype.revoke=function(){this._worldPoints.pop(),this._worldPoints.length<=1?this.destory():(this.removeAllAnchorPoint(),this.addAnchorPoint(this._worldPoints[this._worldPoints.length-1]),this.addAnchorPoint(this._worldPoints[this._worldPoints.length-2]),this._updateVertices())},t.prototype.unRevoke=function(){},t.prototype.setWorldPoints=function(e){this._worldPoints=e,this.completeDrawing()},t.prototype.updateActivePoint=function(e,t){0!==this._worldPoints.length&&(this._activePoint=t?this.calcAlignment(this._worldPoints[this._worldPoints.length-1],e):e,this._updateVertices())},t.prototype.stopDrawing=function(e,t){var r=null;r=t?this.calcAlignment(this._worldPoints[this._worldPoints.length-1],e):e,this._worldPoints.push(r),this.completeDrawing()},t.prototype._calcBbox=function(){for(var e=P.a.aabb.createFromArray([1/0,1/0,1/0,-1/0,-1/0,-1/0]),t=0,r=this._worldPoints.length;t<r;t++)e[0]=Math.min(this._worldPoints[t][0],e[0]),e[1]=Math.min(this._worldPoints[t][1],e[1]),e[2]=Math.min(this._worldPoints[t][2],e[2]),e[3]=Math.max(this._worldPoints[t][0],e[3]),e[4]=Math.max(this._worldPoints[t][1],e[4]),e[5]=Math.max(this._worldPoints[t][2],e[5]);return this._activePoint&&(e[0]=Math.min(this._activePoint[0],e[0]),e[1]=Math.min(this._activePoint[1],e[1]),e[2]=Math.min(this._activePoint[2],e[2]),e[3]=Math.max(this._activePoint[0],e[3]),e[4]=Math.max(this._activePoint[1],e[4]),e[5]=Math.max(this._activePoint[2],e[5])),e},t.prototype._updateVertices=function(){for(var e=[],t=0;t<this._worldPoints.length;t++)e.push(this._worldPoints[t][0]),e.push(this._worldPoints[t][1]),e.push(this._worldPoints[t][2]);this._activePoint&&(e.push(this._activePoint[0]),e.push(this._activePoint[1]),e.push(this._activePoint[2]));var r=e.length/3-2,i=new Uint16Array(3*r);for(t=0;t<r;t++)i[3*t]=t,i[3*t+1]=t+1,i[3*t+2]=t+2;this._mesh.update(new Float32Array(e),i)},t.prototype.getKeyPoints=function(){return this._worldPoints},t.prototype.update=function(e){},t.prototype.completeDrawing=function(){this.removeAllAnchorPoint(),this._activePoint=null,this._updateVertices();var e=this._calcBbox();this.drawable.setBbox(e)},t}(Wu),Zu=function(e){function t(t,r){var i=e.call(this,t,r)||this;i._width=1,i._updateVertices=Object(a.b)(function(e){void 0===e&&(e=!0);for(var t=[],r=0;r<i._worldPoints.length;r++)t.push(i._worldPoints[r][0]),t.push(i._worldPoints[r][1]),t.push(i._worldPoints[r][2]);i._activePoint&&(t.push(i._activePoint[0]),t.push(i._activePoint[1]),t.push(i._activePoint[2]));var n=t.length/3;if(!(n<2)){var a=i._startPointStyle>-1,o=i._endPointStyle>-1,s=[],l=[],u=0,c=0,h=0,d=[];for(r=0;r<n-1;r++){var p=a&&0===r,f=o&&r===n-2,_=i._orthoPlanes.get(r),m=U.d.fromValues(t[3*r],t[3*r+1],t[3*r+2]),v=U.d.fromValues(t[3*r+3],t[3*r+4],t[3*r+5]),y=U.d.create(),g=U.d.create(),b=U.d.create(),w=U.d.create(),x=0,M=i._parameters.isDotted?(i._parameters.dottedLength+i._parameters.intervalLength)*i._width:0,E=[];U.d.subtract(b,v,m),x=U.d.length(b),U.d.normalize(b,b),_>Ru.NONE?i._setNormal(_):i._updateNormal(b),U.d.cross(w,b,i._normal),p?(U.d.scaleAndAdd(y,m,b,2.6*i._width),x-=2.6*i._width):U.d.copy(y,m),f?(U.d.scaleAndAdd(g,v,b,-2.6*i._width),x-=2.6*i._width):U.d.copy(g,v);var T=U.d.create(),S=U.d.create(),A=U.d.create(),P=U.d.create();U.d.scaleAndAdd(T,y,w,i._width/2),U.d.scaleAndAdd(S,y,w,-i._width/2);var k=0;if(i._parameters.isDotted){for(var O=Math.floor(x/M),D=U.d.create(),N=U.d.create(),C=U.d.create(),I=U.d.create(),R=0;R<O;R++)U.d.scaleAndAdd(D,T,b,M*R),U.d.scaleAndAdd(N,S,b,M*R),U.d.scaleAndAdd(C,T,b,M*R+i._parameters.dottedLength*i._width),U.d.scaleAndAdd(I,S,b,M*R+i._parameters.dottedLength*i._width),E=[D[0],D[1],D[2],N[0],N[1],N[2],C[0],C[1],C[2],I[0],I[1],I[2]],s=s.concat(E),k++;var B=x%M,L=Math.min(B,i._parameters.dottedLength);U.d.scaleAndAdd(D,D,b,L),U.d.scaleAndAdd(N,N,b,L),U.d.scaleAndAdd(C,C,b,L),U.d.scaleAndAdd(I,I,b,L),E=[D[0],D[1],D[2],N[0],N[1],N[2],C[0],C[1],C[2],I[0],I[1],I[2]],s=s.concat(E),k++}else U.d.scaleAndAdd(A,g,w,i._width/2),U.d.scaleAndAdd(P,g,w,-i._width/2),E=[T[0],T[1],T[2],S[0],S[1],S[2],A[0],A[1],A[2],P[0],P[1],P[2]],s=s.concat(E),k=1;for(var F=u,V=0;V<k;V++)l[c]=u,l[c+1]=u+1,l[c+2]=u+2,l[c+3]=u+2,l[c+4]=u+3,l[c+5]=u+1,u+=4,c+=6;if(d.push(u-1),p){var j=U.d.create(),z=U.d.create(),G=U.d.create();U.d.scaleAndAdd(j,y,w,1.5*i._width),U.d.scaleAndAdd(z,y,w,-1.5*i._width),U.d.copy(G,m),s=s.concat([j[0],j[1],j[2],z[0],z[1],z[2],G[0],G[1],G[2]])}if(f){var H=U.d.create(),q=U.d.create(),W=U.d.create();U.d.scaleAndAdd(H,g,w,1.5*i._width),U.d.scaleAndAdd(q,g,w,-1.5*i._width),U.d.copy(W,v),s=s.concat([H[0],H[1],H[2],q[0],q[1],q[2],W[0],W[1],W[2]])}if(p&&(l[c]=u,l[c+1]=u+1,l[c+2]=u+2,c+=3,u+=3),f&&(l[c]=u,l[c+1]=u+1,l[c+2]=u+2,u+=3,c+=3),h>=1&&!i._parameters.isDotted){var Q=d[r-1];l[c]=Q,l[c+1]=Q-1,l[c+2]=F,l[c+3]=Q,l[c+4]=Q-1,l[c+5]=F+1,c+=6}h++}i._mesh.update(new Float32Array(s).buffer,new Uint16Array(l).buffer),e&&i.renderScene.draw()}});var n=r.getResourceManager();return i._worldPoints=[],i._revokePoints=[],i.type=Nu.RECT,i._mesh=n.getMesh("rect"+t),i._mesh.createSharePolygon(),i.drawable=new kr(i._mesh,n),i._normal=[0,0,1],i._orthoPlanes=new Map,i._startPointStyle=Iu.NONE,i._endPointStyle=Iu.TRIANGLE,i._parameters={width:1,startPoint:Iu.NONE,endPoint:Iu.TRIANGLE,color:Ju,opacity:$u,isDotted:!1,dottedLength:3,intervalLength:2,transform:U.a.create(),orthoPlanes:[]},i}return ju(t,e),t.prototype.clone=function(){var e=new t(a.a.generateUUID(),this.renderScene);e.setWorldPoints(this.getWorldPoints());var r=this.getParameters();e.setParameters(r),e.use();var i=P.a.aabb.size(this._calcBbox()),n=Math.max(i.width,i.height,i.depth),o=[n-i.width==0?1:0,n-i.height==0?1:0,n-i.depth==0?1:0];return U.d.scale(o,o,ec*this._width),e.drawable.translate(o[0],o[1],o[2]),e},t.prototype.getWorldPoints=function(){return Hu(this._worldPoints)},t.prototype.revoke=function(){var e=null;return this._revokePoints.push(this._worldPoints.pop()),0===this._worldPoints.length?this.destory():(e=this._worldPoints[this._worldPoints.length-1],this._updateVertices()),e},t.prototype.unRevoke=function(){var e=null;return this.ready||this.restore(),this._revokePoints.length&&(e=this._revokePoints.pop())&&(this._worldPoints.push(e),this._updateVertices()),e},t.prototype.setWidth=function(e){this._width=e,this._updateVertices()},t.prototype.addKeyPoint=function(e,t,r){if(0===this._worldPoints.length)return this._activePoint=e,this._worldPoints.push(e),this.updateOrthoPlane(r,0),e;var i=this._worldPoints[this._worldPoints.length-1],n=t?this.calcAlignment(i,e):e;return n.every(function(e,t){return Math.abs(e-i[t])<.01})?null:(this._worldPoints.push(n),this.updateOrthoPlane(r,this._worldPoints.length-1),this._activePoint=null,this._updateVertices(),n)},t.prototype.setWorldPoint=function(e,t){this._worldPoints[t]&&(this._worldPoints[t]=e,this.completeDrawing(!1))},t.prototype.setWorldPoints=function(e){this._worldPoints=e,this.completeDrawing()},t.prototype.updateOrthoPlane=function(e,t){this._worldPoints.length&&this._orthoPlanes.set(t||this._worldPoints.length-1,e)},t.prototype.updateActivePoint=function(e,t){0!==this._worldPoints.length&&(this._activePoint=t?this.calcAlignment(this._worldPoints[this._worldPoints.length-1],e):e,this._updateVertices(),this.drawable.setBbox(this._calcBbox()))},t.prototype.stopDrawing=function(e,t,r,i){return i&&this.addKeyPoint(e,t,r),this.completeDrawing()},t.prototype.startEdit=function(){var e,t;if(this._activePoint)try{for(var r=zu(this._worldPoints),i=r.next();!i.done;i=r.next()){var n=i.value;this.addAnchorPoint(n)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else console.warn("This mark is in editing")},t.prototype._calcBbox=function(){for(var e=P.a.aabb.createFromArray([1/0,1/0,1/0,-1/0,-1/0,-1/0]),t=this.getTransformedKeyPoints(),r=0,i=t.length;r<i;r++)e[0]=Math.min(t[r][0],e[0]),e[1]=Math.min(t[r][1],e[1]),e[2]=Math.min(t[r][2],e[2]),e[3]=Math.max(t[r][0],e[3]),e[4]=Math.max(t[r][1],e[4]),e[5]=Math.max(t[r][2],e[5]);return this._activePoint&&(e[0]=Math.min(this._activePoint[0],e[0]),e[1]=Math.min(this._activePoint[1],e[1]),e[2]=Math.min(this._activePoint[2],e[2]),e[3]=Math.max(this._activePoint[0],e[3]),e[4]=Math.max(this._activePoint[1],e[4]),e[5]=Math.max(this._activePoint[2],e[5])),e},t.prototype._updateNormal=function(e){var t=Math.max(Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2]));t-Math.abs(e[0])<1e-4?U.d.cross(this._normal,[0,1,0],e):(Math.abs(e[1]),U.d.cross(this._normal,[1,0,0],e))},t.prototype._setNormal=function(e){switch(e){case Ru.XY:this._normal=[0,0,1];break;case Ru.XZ:this._normal=[0,1,0];break;case Ru.YZ:this._normal=[1,0,0];break;default:return void(this._normal=[0,0,1])}},t.prototype.getKeyPoints=function(){return this._worldPoints},t.prototype.update=function(e){},t.prototype.getParameters=function(){var e={};for(var t in this._parameters)e[t]=this._parameters[t];this.drawable&&(e.transform=this.drawable.getTransformMatrix());var r=[];return this._orthoPlanes.forEach(function(e,t){r[t]=e}),e.orthoPlanes=r,e},t.prototype.setParameters=function(e){for(var t in e)void 0!==this._parameters[t]&&(this._parameters[t]=e[t]);this.drawable&&!e.transform&&(this._parameters.transform=this.drawable.getTransformMatrix()),this._updateParameters()},t.prototype._updateParameters=function(){var e=this;this.setWidth(this._parameters.width),this.setColor(this._parameters.color),this.setTransparent(this._parameters.opacity),this.setStartPointStyle(this._parameters.startPoint),this.setEndPointStyle(this._parameters.endPoint),this.setTransformMatrix(this._parameters.transform),this._parameters.orthoPlanes&&this._parameters.orthoPlanes.forEach(function(t,r){e._orthoPlanes.set(r,t)}),this._updateVertices()},t.prototype.setStartPointStyle=function(e){this._startPointStyle=e},t.prototype.setEndPointStyle=function(e){this._endPointStyle=e},t.prototype.completeDrawing=function(e){if(void 0===e&&(e=!0),this._activePoint=null,this._worldPoints.length<2)return!1;this._updateVertices(e);var t=this._calcBbox();return this.drawable.setBbox(t),!0},t.prototype.getTransformedKeyPoints=function(){var e=this;return this._worldPoints.map(function(t){return U.d.transformMat4(U.d.create(),t,e.getTransformMatrix())})},t.prototype.worldPositionToLocalPosition=function(e){var t=this.getTransformMatrix().slice();return U.a.invert(t,t),U.d.transformMat4(U.d.create(),e,t)},t}(Wu),Ku=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ju(t,e)}(Wu),{plane:U.e.fromValues(1,1,1,1),"x-line":U.e.fromValues(1,0,0,1),"y-line":U.e.fromValues(0,1,0,1),"z-line":U.e.fromValues(0,0,1,1),edgingColor:U.e.fromValues(.3,.3,.3,1),opacityLine:.6,opacityPlane:.3}),Ju=[247/255,82/255,35/255],$u=1,ec=4,tc=[.968,.322,.137,1],rc=[.968,.322,.137,1],ic=function(e){function t(t,r){var i=e.call(this,"MarkGraph",!0,t)||this;return i.orthoDrawing=!1,i._drawing=null,i._alignment=!1,i._multiselect=!1,i._isHoverEnabled=!0,i._showAuxiliary=!1,i.revokeEnabled=!0,i.enableOnlyDrawingRevoke=!1,i.enableGizmo=!0,i._selector=null,i.disableRevokeHotkey=!1,i._selector=r,i.mode=Nu.DEFAULT,i._depthQuery=new br.a(t.getScene().core,t.getResourceManager()),i._contour=new ri(i._resourceManager,i._scene,i._viewer.getWidth(),i._viewer.getHeight()),i.marks=new Map,i._selectType=Cu.OUTLINE,i._alignment=!1,i._selectMarks=new Map,i.defaultColor=null,i.defaultOpacity=null,i._transformMatrix=U.a.create(),i._keyOperation=[],i._revokeOperation=[],i._orthoPlane=Ru.NONE,i._gizmo=null,i._ray=new Er.a,i._isHoverEnabled=!0,i._hoverMark=null,i._auxiliaryPlane=[],i._showAuxiliary=!1,i._scale=.15,i._scaleMatrix=U.a.create(),i._tempMat=U.a.create(),i._rtDefault=i._getRenderTarget({depthTest:!0}),i._rtProgressively=i._getRenderTargetPR({depthTest:!0}),i._arrowParameters={width:1,color:Ju,opacity:$u,startPoint:Iu.NONE,endPoint:Iu.TRIANGLE,isDotted:!1,dottedLength:3,intervalLength:2,transform:U.a.create()},i._contour.setColor([.968,.322,.137,1]),i}return ju(t,e),t.prototype._update=function(){this._drawing&&this._activePoint&&(this._drawing.updateActivePoint(this._activePoint,this._alignment||this.orthoDrawing),this._scene.updateBBox(this._drawing.drawable.bbox),this._camera._updateProjection())},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype.setSceneSize=function(e){var t=Math.min(e[3]-e[0],e[4]-e[1],e[5]-e[2]);this._arrowParameters.width=.1*t},t.prototype._createAuxiliaryPlane=function(){if(0===this._auxiliaryPlane.length){var e=this._resourceManager.getMesh("auxiliaryLines1");e.createParallelLines(.2,9,[1,0,0]),this._auxiliaryPlane[0]=new ta(e,this._resourceManager),this._auxiliaryPlane[0].setColor(Ku["x-line"]),this._auxiliaryPlane[0].setTransparent(Ku.opacityLine),this._auxiliaryPlane[0].name="auxiliaryLines1";var t=this._resourceManager.getMesh("auxiliaryLines2");t.createParallelLines(.2,9,[0,1,0]),this._auxiliaryPlane[1]=new ta(t,this._resourceManager),this._auxiliaryPlane[1].setColor(Ku["y-line"]),this._auxiliaryPlane[1].setTransparent(Ku.opacityLine),this._auxiliaryPlane[1].name="auxiliaryLines2";var r=this._resourceManager.getMesh("auxiliaryLines3");r.createLineWithWidth(.004,.09,[1,0,0]),this._auxiliaryPlane[2]=new ta(r,this._resourceManager),this._auxiliaryPlane[2].setColor(Ku["x-line"]),this._auxiliaryPlane[2].setTransparent(1),this._auxiliaryPlane[2].name="auxiliaryLines3";var i=this._resourceManager.getMesh("auxiliaryLines4");i.createLineWithWidth(.004,.09,[0,1,0]),this._auxiliaryPlane[3]=new ta(i,this._resourceManager),this._auxiliaryPlane[3].setColor(Ku["y-line"]),this._auxiliaryPlane[3].setTransparent(1),this._auxiliaryPlane[3].name="auxiliaryLines4"}},t.prototype._updateAuxiliaryPlane=function(e,t){this._transformMatrix[12]=e[0],this._transformMatrix[13]=e[1],this._transformMatrix[14]=e[2];var r=[t[1],t[0],t[2]];switch(this._auxiliaryPlane[0].transform.setRotation(r,Math.PI/2),this._auxiliaryPlane[1].transform.setRotation(r,Math.PI/2),this._auxiliaryPlane[2].transform.setRotation(r,Math.PI/2),this._auxiliaryPlane[3].transform.setRotation(r,Math.PI/2),this._auxiliaryPlane[2].visible=this._orthoPlane>Ru.NONE,this._auxiliaryPlane[3].visible=this._orthoPlane>Ru.NONE,this._orthoPlane){case Ru.XY:this._auxiliaryPlane[0].setColor(Ku["x-line"]),this._auxiliaryPlane[1].setColor(Ku["y-line"]),this._auxiliaryPlane[2].setColor(Ku["x-line"]),this._auxiliaryPlane[3].setColor(Ku["y-line"]);break;case Ru.XZ:this._auxiliaryPlane[0].setColor(Ku["x-line"]),this._auxiliaryPlane[1].setColor(Ku["z-line"]),this._auxiliaryPlane[2].setColor(Ku["x-line"]),this._auxiliaryPlane[3].setColor(Ku["z-line"]);break;case Ru.YZ:this._auxiliaryPlane[0].setColor(Ku["y-line"]),this._auxiliaryPlane[1].setColor(Ku["z-line"]),this._auxiliaryPlane[2].setColor(Ku["y-line"]),this._auxiliaryPlane[3].setColor(Ku["z-line"])}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"MarkGraph"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"MarkGraph"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"MarkGraph")},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e)},"MarkGraph"),e.addKeyUpListener(function(e){return t._onKeyUp(e)},"MarkGraph")},t.prototype._beginRenderGizmo=function(){U.a.copy(this._tempMat,this._camera.vpMatrix);var e=U.d.create(),t=U.d.fromValues(this._transformMatrix[12],this._transformMatrix[13],this._transformMatrix[14]);U.d.subtract(e,this._camera._at,this._camera.eye),U.d.normalize(e,e),U.d.subtract(t,t,this._camera.eye),this._scaleMatrix[0]=this._scaleMatrix[5]=this._scaleMatrix[10]=U.d.dot(e,t),U.a.multiply(this._scaleMatrix,this._transformMatrix,this._scaleMatrix),U.a.multiply(this._camera.vpMatrix,this._camera.vpMatrix,this._scaleMatrix)},t.prototype._drawAuxiliary=function(){var e=this,t=this._resourceManager.gl;this._renderer.clear(this._rtDefault,t.DEPTH_BUFFER_BIT),this._rtDefault.setOption("blend",!0),this._rtDefault.setOption("depthTest",!1),this._rtDefault.always=!0,this._rtDefault.setOption("blendFunc",[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA]),this._auxiliaryPlane.forEach(function(t){return e._renderer.drawGizmo(e._rtDefault,t,e._camera)}),this._rtDefault.setOption("blend",!1),this._rtDefault.setOption("depthTest",!0),this._rtDefault.always=!0},t.prototype._drawAuxiliaryProgressively=function(){var e=this,t=this._resourceManager.gl;this._renderer.clear(this._rtProgressively,t.DEPTH_BUFFER_BIT),this._rtProgressively.setOption("blend",!0),this._rtProgressively.setOption("depthTest",!1),this._rtProgressively.always=!0,this._rtProgressively.setOption("blendFunc",[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA]),this._auxiliaryPlane.forEach(function(t){return e._renderer.drawGizmo(e._rtProgressively,t,e._camera)}),this._rtProgressively.setOption("blend",!1),this._rtProgressively.setOption("depthTest",!0),this._rtProgressively.always=!0},t.prototype._endRenderGizmo=function(){U.a.copy(this._camera.vpMatrix,this._tempMat),U.a.identity(this._scaleMatrix)},t.prototype.destroy=function(){this.marks.forEach(function(e){e.destory()}),this._depthQuery.destroy(),this._contour.destroy(),this._auxiliaryPlane.length>0&&(this._auxiliaryPlane[0].destroy(),this._auxiliaryPlane[1].destroy(),this._auxiliaryPlane[2].destroy(),this._auxiliaryPlane[3].destroy()),this._auxiliaryPlane=null,delete this._auxiliaryPlane},t.prototype.resize=function(e,t){this._contour.resize(e,t)},t.prototype.recompileShader=function(e){this._contour.recompileShader(this._resourceManager,e)},t.prototype.setMarkType=function(e){this.mode=e,this._drawing&&(this._viewer.notifyEventListener("MarkGraph-Removed",this._drawing.id),this._selectMarks.delete(this._drawing.id),this.marks.delete(this._drawing.id),this._drawing.destory(),this._drawing=null),e!==Nu.DEFAULT&&this._enabled&&(this._hoverMark=null,this._viewer.notifyEventListener("MarkGraph-Start"),this.clearAllSelect()),e===Nu.DEFAULT&&this.setAuxiliaryVisibility(!1),this._viewer.invalidate()},t.prototype._onEnableChanged=function(){this._viewer.getRenderScene().setMarkEnabled(this._enabled),this._enabled&&(this.enableGizmo&&this.startGizmo(),this._createAuxiliaryPlane())},t.prototype._onMouseDown=function(e){return!1},t.prototype._onMouseUp=function(e){if(!this._enabled)return!1;if(!this.isInputEnabled())return!1;if(e.moved)return!1;switch(this.mode){case Nu.DEFAULT:this._select(e);break;case Nu.POINT:this._createPoint(e.x,e.y);break;case Nu.LINE:this._setLineKeyPoints(e);break;case Nu.AREA:this._setAreaKeyPoints(e);break;case Nu.RECT:this._setRectKeyPoints(e)}return!1},t.prototype._onKeyDown=function(e){if(!this.isInputEnabled()||!this._enabled)return!1;if("Control"===e.key&&(this._alignment=!0,this._multiselect=!0,this._isCtrlDown=!0),this.revokeEnabled&&!this.disableRevokeHotkey){if(this._isCtrlDown&&("z"===e.key||"Z"===e.key))return this._alignment=!1,this.revokeOperation(),!0;if(this._isCtrlDown&&("y"===e.key||"Y"===e.key))return this._alignment=!1,this.unRevokeOperation(),!0}if(this._isCtrlDown&&("c"===e.key||"C"===e.key))return this._alignment=!1,this._copyMarks(this.getSelectArrows()),!0;if(this._isCtrlDown&&("v"===e.key||"V"===e.key)){this._alignment=!1;var t=this._pasteMarks();return this.clearAllSelect(!1),this.setSelectMarks(t,!1),this._viewer.notifyEventListener("MarkGraph-Copied",t),!0}return!1},t.prototype._onKeyUp=function(e){return!(!this.isInputEnabled()||!this._enabled)&&("Control"===e.key&&(this._alignment=!1,this._multiselect=!1,this._isCtrlDown=!1),e.key,!1)},t.prototype._getPickables=function(){if(!this._pickables){var e=this._viewer.getRenderScene().getMarks();this._pickables=e.queue.drawables}return this._pickables},t.prototype._onMouseMove=function(e){return!!this.isInputEnabled()&&(!!e.moved&&(this._hover()||this._draw(e.x,e.y),!1))},t.prototype._hover=function(){if(!this._isHoverEnabled)return!1;if(this._drawing)return!1;this._hoverMark=null;var e=this._selector.getDrawableUnderCursor();if(!(e instanceof kr))return!1;var t=this.marks.get(e.getId());return!!t&&(this._hoverMark=t,this._viewer.notifyEventListener("MarkGraph-Hovered",t.id),this._viewer.invalidate(16),!0)},t.prototype._draw=function(e,t){return!!this._drawing&&(this._ray.setFromCamera(e,t,this._camera),this._activePoint=this._orthoPlane===Ru.NONE?this._depthQuery.unproject(e,t,this._renderer,this._camera)||this._ray.intersectPlane([0,0,1],0):this._ray.intersectPlane(this._drawing.drawingPlane,this._drawing.drawingPlane[3]),!!this._activePoint&&(this.setNeedUpdate(!0),this._viewer.invalidate(10),!0))},t.prototype._select=function(e){if(e.button!==e.LEFT_BUTTON)return!1;var t=this._selector.getDrawableUnderCursor();this._multiselect||this.clearAllSelect(!t),t instanceof kr&&this.setSelect(t,this._selectType)},t.prototype._renderMarkSelected=function(e){if(this._selectMarks&&this._selectType===Cu.OUTLINE){this._contour.setColor(tc);var t=this._gatherDrawablesOf(this._selectMarks);this._contour.renderMark(this._renderer,this._scene,t,this._camera,e)}},t.prototype._renderMarkHovering=function(e){this._isHoverEnabled&&this._hoverMark&&(this._contour.setColor(rc),this._contour.renderMark(this._renderer,this._scene,[this._hoverMark.drawable],this._camera,e))},t.prototype._renderAuxiliary=function(){this._showAuxiliary&&(this._beginRenderGizmo(),this._drawAuxiliary(),this._endRenderGizmo())},t.prototype._render=function(){if(this._enabled){this._viewer.notifyEventListener("MarkGraph-Before-Render");var e=this._gatherDrawablesOf(this.marks);this._renderMarkSelected(e),this._renderMarkHovering(e),this._renderAuxiliary()}},t.prototype._renderMarkSelectedPR=function(e){if(this._selectMarks&&this._selectType===Cu.OUTLINE){this._contour.setColor(tc);var t=this._gatherDrawablesOf(this._selectMarks);this._contour.renderMarkProgressively(this._renderer,this._scene,t,this._camera,e)}},t.prototype._renderMarkHoveringPR=function(e){this._isHoverEnabled&&this._hoverMark&&(this._contour.setColor(rc),this._contour.renderMarkProgressively(this._renderer,this._scene,[this._hoverMark.drawable],this._camera,e))},t.prototype._renderAuxiliaryPR=function(){this._showAuxiliary&&(this._beginRenderGizmo(),this._drawAuxiliaryProgressively(),this._endRenderGizmo())},t.prototype._gatherDrawablesOf=function(e){var t=[];return e.forEach(function(e){return e.drawable&&t.push(e.drawable)}),t},t.prototype._renderProgressively=function(){if(this._enabled){var e=this._gatherDrawablesOf(this.marks);this._renderMarkSelectedPR(e),this._renderMarkHoveringPR(e),this._renderAuxiliaryPR()}},t.prototype.clearAllSelect=function(e){var t=this;void 0===e&&(e=!0),0!==this._selectMarks.size&&(this.marks.forEach(function(e){e.drawable&&e.drawable.setHighLight(!1)}),this._selectMarks.forEach(function(e){t._selectMarks.delete(e.id)}),e&&this._viewer.notifyEventListener("MarkGraph-SelectionCleared"),this._viewer.invalidate())},t.prototype.setSelect=function(e,t,r){if(void 0===t&&(t=void 0),void 0===r&&(r=!0),!e)return null;var i=this.marks.get(e.getId());return i?(t=t||this._selectType,e.setHighLight(t===Cu.HIGHLIGHT),this._selectMarks.set(i.id,i),r&&this._viewer.notifyEventListener("MarkGraph-Selected",i.id),this._viewer.invalidate(),i):null},t.prototype.setSelectMarks=function(e,t){var r=this;void 0===t&&(t=!0),"string"==typeof e[0]?e.forEach(function(e){var i=r.getMark(e);i&&r.setSelect(i.drawable,void 0,t)}):e.forEach(function(e){return r.setSelect(e.drawable,void 0,t)})},t.prototype._createPoint=function(e,t){var r=this._depthQuery.unproject(e,t,this._renderer,this._camera);if(!r)return null;var i=new Qu(a.a.generateUUID(),this._viewer.getRenderScene(),r);return this.marks.set(i.id,i),i.setColor(this.defaultColor?this.defaultColor:Ju),i.setTransparent(this.defaultOpacity?this.defaultOpacity:$u),i.use(),this._viewer.notifyEventListener("MarkGraph-Created",i.id),this._scene.addShape(i.drawable),this._viewer.onSceneChanged(),this._viewer.invalidate(),this._recordOperation(),i},t.prototype._createLines=function(){var e=new Yu(a.a.generateUUID(),this._viewer.getRenderScene());return this.marks.set(e.id,e),e.setColor(this.defaultColor?this.defaultColor:Ju),e.setTransparent(this.defaultOpacity?this.defaultOpacity:1),e.use(),this._scene.addShape(e.drawable),this._viewer.onSceneChanged(),this._viewer.invalidate(),e},t.prototype._createArea=function(){var e=new Xu(a.a.generateUUID(),this._viewer.getRenderScene());return this.marks.set(e.id,e),e.setColor(this.defaultColor?this.defaultColor:Ju),e.setTransparent(this.defaultOpacity?this.defaultOpacity:1),e.use(),this._viewer.onSceneChanged(),this._viewer.invalidate(),this._scene.addShape(e.drawable),e},t.prototype._createRect=function(){var e=new Zu(a.a.generateUUID(),this._viewer.getRenderScene());return e.setParameters(this._arrowParameters),this.marks.set(e.id,e),e.use(),this._scene.addShape(e.drawable),this._viewer.onSceneChanged(),this._viewer.invalidate(),e},t.prototype._setLineKeyPoints=function(e){var t=this._depthQuery.unproject(e.x,e.y,this._renderer,this._camera),r=this._alignment||this.orthoDrawing,i=this._drawing;this._drawing?t&&(e.button===e.LEFT_BUTTON?i.addKeyPoint(t,r):(i.stopDrawing(t,r),this._recordOperation(),this._viewer.notifyEventListener("MarkGraph-Created",this._drawing.id),i=null)):e.button===e.LEFT_BUTTON&&(this._drawing=this._createLines(),t&&this._drawing.addKeyPoint(t,r)),this._viewer.invalidate()},t.prototype._setAreaKeyPoints=function(e){var t=this._depthQuery.unproject(e.x,e.y,this._renderer,this._camera),r=this._alignment||this.orthoDrawing,i=this._drawing;this._drawing?t&&(e.button===e.LEFT_BUTTON?i.addKeyPoint(t,r):(i.stopDrawing(t,r),this._recordOperation(),this._viewer.notifyEventListener("MarkGraph-Created",this._drawing.id),this._drawing=null)):e.button===e.LEFT_BUTTON&&(this._drawing=this._createArea(),t&&this._drawing.addKeyPoint(t,r)),this._viewer.invalidate()},t.prototype._calcOrthogonalPlaneNormal=function(){var e=[0,0,1];switch(this._orthoPlane){case Ru.XY:e=[0,0,1];break;case Ru.YZ:e=[1,0,0];break;case Ru.XZ:e=[0,1,0]}return e},t.prototype._calcOrthogonalPlane=function(e){var t=this._calcOrthogonalPlaneNormal(),r=0;if(e)switch(this._orthoPlane){case Ru.XY:r=e[2];break;case Ru.YZ:r=e[0];break;case Ru.XZ:r=e[1]}return t.concat(r)},t.prototype._calcOrthogonalPlaneDistance=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.prototype._getInitPlaneDistance=function(){var e=this._viewer.getSceneBox();if(!e||P.a.aabb.isEmpty(e))return 0;switch(this._orthoPlane){case Ru.XY:return e[2];case Ru.YZ:return(e[0]+e[3])/2;case Ru.XZ:return(e[1]+e[4])/2;default:return e[2]}},t.prototype._getIntersectionOnPlane=function(e,t,r,i){return this._ray.setFromCamera(e,t,this._camera),this._ray.intersectPlane(r,i)},t.prototype._calAttachPoint=function(e,t){if(this._orthoPlane>Ru.NONE&&this._drawing){var r=this._calcOrthogonalPlaneNormal(),i=this._drawing.drawingPlane[3];return this._getIntersectionOnPlane(e,t,r,i)}var n=this._depthQuery.unproject(e,t,this._renderer,this._camera);if(n)return n;var a=this._orthoPlane===Ru.NONE?[0,0,1]:this._calcOrthogonalPlaneNormal(),o=this._getInitPlaneDistance();return this._getIntersectionOnPlane(e,t,a,o)},t.prototype._calPlaneDistance=function(e){if(this._orthoPlane===Ru.NONE)return this._getInitPlaneDistance();if(!(null===this._drawing))return this._drawing.drawingPlane[3];var t=this._calcOrthogonalPlaneNormal();return this._calcOrthogonalPlaneDistance(t,e)},t.prototype._setStartPoint=function(e){var t=this._orthoPlane===Ru.NONE?[0,0,1]:this._calcOrthogonalPlaneNormal(),r=this._calPlaneDistance(e),i=this._alignment||this.orthoDrawing;this._drawing=this._createRect(),this._drawing.setDrawingPlane(t.concat(r)),this._viewer.notifyEventListener("MarkGraph-StartDrawing",this._drawing.id);var n=this._drawing.addKeyPoint(e,i,this._orthoPlane);this._orthoPlane!==Ru.NONE&&(this.setAuxiliaryVisibility(!0),this._updateAuxiliaryPlane(n,t))},t.prototype._insertNextPoint=function(e){var t=this._alignment||this.orthoDrawing,r=this._drawing.addKeyPoint(e,t,this._orthoPlane);if(r&&this._orthoPlane!==Ru.NONE){var i=this._calcOrthogonalPlaneNormal();this._updateAuxiliaryPlane(r,i),this._activePoint=null,this._viewer.invalidate()}},t.prototype._addPoint=function(e){null===this._drawing?this._setStartPoint(e):this._insertNextPoint(e)},t.prototype._endDrawing=function(e){if(this._drawing){this._viewer.invalidate(),this.setAuxiliaryVisibility(!1);var t=this._alignment||this.orthoDrawing;if(!this._drawing.stopDrawing(e,t,this._orthoPlane,!1))return this._scene.removeShape(this._drawing.drawable),this._drawing.destory(),void(this._drawing=null);this._recordOperation(),this._viewer.notifyEventListener("MarkGraph-Created",this._drawing.id),this._selector.addPickable(this._drawing.drawable),this._drawing=null,this._viewer.onSceneChanged()}},t.prototype._setRectKeyPoints=function(e){var t=this._calAttachPoint(e.x,e.y);t&&(e.button===e.LEFT_BUTTON?this._addPoint(t):this._endDrawing(t))},t.prototype.reset=function(){var e=this;this.marks.forEach(function(t){t.ready&&(e._viewer.notifyEventListener("MarkGraph-Removed",t.id),e._scene.removeShape(t.drawable),t.destory(),e.marks.delete(t.id))}),this._viewer.onSceneChanged(),this.setAuxiliaryVisibility(!1),this._selectMarks=new Map,this._viewer.invalidate()},t.prototype.getMark=function(e){return this.marks.get(e)},t.prototype.getPoints=function(){var e=[];return this.marks.forEach(function(t){t instanceof Qu&&e.push(t)}),e},t.prototype.getLines=function(){var e=[];return this.marks.forEach(function(t){t instanceof Yu&&e.push(t)}),e},t.prototype.getRects=function(){var e=[];return this.marks.forEach(function(t){t instanceof Zu&&e.push(t)}),e},t.prototype.remove=function(e){var t="string"==typeof e?this.getMark(e):e;if(t.ready){var r=t.id;this._scene.removeShape(t.drawable),this._selectMarks.delete(r),this.marks.delete(r),this._recordOperation(),this._viewer.onSceneChanged(),this._viewer.invalidate(),t.destory(),this._viewer.notifyEventListener("MarkGraph-Removed",r)}},t.prototype.setRectDefaultWidth=function(e,t){var r=this;this._arrowParameters.width=e,t&&this.marks.forEach(function(e){e instanceof Zu&&e.setParameters(r._arrowParameters)}),this._viewer.invalidate()},t.prototype.setPointSize=function(e){},t.prototype.setSelectType=function(e){this._selectType=e,this._viewer.invalidate()},t.prototype.getSelectMarks=function(){var e=[];return this._selectMarks.forEach(function(t){e.push(t)}),e},t.prototype.getSelectArrows=function(){var e=[];return this._selectMarks.forEach(function(t){t.type===Nu.RECT&&e.push(t)}),e},t.prototype.setDefaultColor=function(e,t){var r=this;e?(this.defaultColor=[],this.defaultColor[0]=e[0],this.defaultColor[1]=e[1],this.defaultColor[2]=e[2]):this.defaultColor=null,t&&this.marks.forEach(function(e){e.setColor(r.defaultColor?r.defaultColor:Ju)}),this._viewer.invalidate()},t.prototype.setDefaultOpacity=function(e,t){var r=this;this.defaultOpacity=e||null,t&&this.marks.forEach(function(e){e.setTransparent(r.defaultOpacity?r.defaultOpacity:$u)}),this._viewer.invalidate()},t.prototype.setMarkDiffuse=function(e,t){("string"==typeof e?this.getMark(e):e).setColor(t),this._viewer.invalidate()},t.prototype.setMarkOpacity=function(e,t){("string"==typeof e?this.getMark(e):e).setTransparent(t),this._viewer.invalidate()},t.prototype.setContourColor=function(e){this._contour.setColor([e[0],e[1],e[2],1])},t.prototype.drawMark=function(e,t,r,i){var n=this._drawMark(e,t,r,i);return this._scene.addShape(n.drawable),this._viewer.onSceneChanged(),this._recordOperation(),n},t.prototype.editMark=function(e){var t="string"==typeof e?this.marks.get(e):e;t.type!==Nu.POINT?t.startEdit():console.warn("Mark edited does not support point")},t.prototype.startGizmo=function(){return this._gizmo||(this._gizmo=new Gl(this._viewer),this._viewer.addTool(this._gizmo)),this._gizmo},t.prototype.getGizmo=function(){return this._gizmo},t.prototype.transformMark=function(e,t,r){var i,n;t&&(this._gizmo=t),this._gizmo||(this._gizmo=new Gl(this._viewer),this._viewer.addTool(this._gizmo));var o=[],s=P.a.aabb.create();try{for(var l=zu(e),u=l.next();!u.done;u=l.next()){var c=u.value,h="string"==typeof c?this.marks.get(c):c;o.push(h),P.a.aabb.union(s,s,h.drawable.bbox)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}if(o.length){var d=new Z("transfomEntity"+a.a.generateUUID(),this._resourceManager,this._viewer.getMaterialManager());d.preInitialize(s),r&&d.copyMatrixFromEntity(r),d.addMarks(o),this._gizmo.setEntity(d),this._gizmo.setEnabled(!0)}else console.warn("This markGraph is not exist!")},t.prototype._lockedDrawbales=function(e){var t,r;try{for(var i=zu(e),n=i.next();!n.done;n=i.next()){n.value.locked()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},t.prototype.setArrowDrawingParameters=function(e){for(var t in e)void 0!==this._arrowParameters[t]&&(this._arrowParameters[t]=e[t])},t.prototype.getArrowDrawingParameters=function(){var e={};for(var t in this._arrowParameters)e[t]=this._arrowParameters[t];return e},t.prototype.exitTransformMark=function(){this._gizmo.setEnabled(!1)},t.prototype.setOrthoPlane=function(e){if(this._orthoPlane=e,e<0)this.setAuxiliaryVisibility(!1);else if(this._drawing&&this._drawing instanceof Zu){this._drawing.updateOrthoPlane(e);var t=this._drawing.getWorldPoints(),r=this._calcOrthogonalPlane(t[t.length-1]);this._drawing.setDrawingPlane(r),this._updateAuxiliaryPlane(t[t.length-1],r)}this._viewer.invalidate()},t.prototype.setAuxiliaryVisibility=function(e){this._showAuxiliary=e},t.prototype.completeDrawing=function(){if(this._drawing&&this._drawing.type!==Nu.POINT){if(this.setAuxiliaryVisibility(!1),this._viewer.invalidate(),!this._drawing.completeDrawing())return this._scene.removeShape(this._drawing.drawable),this._drawing.destory(),void(this._drawing=null);this._recordOperation(),this._viewer.notifyEventListener("MarkGraph-Created",this._drawing.id),this._selector.addPickable(this._drawing.drawable),this._drawing=null,this._viewer.onSceneChanged()}},t.prototype._copyMarks=function(e){this._copyingMarks=e},t.prototype._pasteMarks=function(){var e,t,r=[];try{for(var i=zu(this._copyingMarks),n=i.next();!n.done;n=i.next()){var a=n.value.clone();this._scene.addShape(a.drawable),this.marks.set(a.id,a),r.push(a)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return this._viewer.onSceneChanged(),r},t.prototype.copyArrows=function(){var e=this.getSelectArrows();this._copyMarks(e);var t=this._pasteMarks();this.clearAllSelect(!1),this.setSelectMarks(t,!1),this._recordOperation(),this._viewer.notifyEventListener("MarkGraph-Copied",t)},t.prototype.getArrowParameters=function(e){var t=this.getMark(e);return t.type!==Nu.RECT?(console.warn("This mark is not a arrow"),null):t.getParameters()},t.prototype.setArrowParameters=function(e,t){var r=this.getMark(e);if(!r||r.type!==Nu.RECT)return console.warn("This mark is not a arrow"),null;r.setParameters(t),this._recordOperation(),this._viewer.invalidate()},t.prototype._drawMark=function(e,t,r,i){var n;switch(t){case Nu.POINT:n=this._drawPoint(e,i,r);break;case Nu.LINE:n=this._drawLine(e,i,r);break;case Nu.AREA:n=this._drawArea(e,i,r);break;case Nu.RECT:n=this._drawRect(e,i,r)}return n},t.prototype._recordOperation=function(){var e=[],t=[];this._keyOperation.length>=100&&this._keyOperation.shift(),this.marks.forEach(function(e){var r={worldPoints:e.getWorldPoints(),markType:e.type,matrix:e.matrix,id:e.id,parameter:e.getParameters()};t.push(r)}),this._selectMarks.forEach(function(t){e.push(t.id)});var r={marksParameter:t,selectMarkIds:e,selectType:this._selectType};this._keyOperation.push(r)},t.prototype.revokeOperation=function(){var e,t,r,i;if(this.revokeEnabled){if(this._hoverMark=null,this._drawing){var n=this._drawing.revoke();if(this._drawing.isEmpty())return this._viewer.notifyEventListener("Mark-Drawing-Undo-Empty",this._drawing),this._drawing=null,this.setAuxiliaryVisibility(!1),void this._viewer.invalidate();if(this._orthoPlane>Ru.NONE){var a=this._calcOrthogonalPlaneNormal();this._updateAuxiliaryPlane(n,a),this._viewer.invalidate()}}else if(!this.enableOnlyDrawingRevoke&&this._keyOperation.length>0){var o=this._keyOperation.pop();this._revokeOperation.push(o);var s=this._keyOperation[this._keyOperation.length-1];if(this.reset(),s){try{for(var l=zu(s.marksParameter),u=l.next();!u.done;u=l.next()){var c=u.value,h=c.markType,d=c.worldPoints,p=c.id,f=c.parameter;this._drawMark(d,h,p,f)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}try{for(var _=zu(s.selectMarkIds),m=_.next();!m.done;m=_.next()){var v=m.value,y=this.marks.get(v).drawable;y&&this.setSelect(y,s.selectType)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}}}this._viewer.notifyEventListener("Mark-RedoEnabled",this._keyOperation.length>0)}},t.prototype.revoke=function(){var e;(null===(e=this._gizmo)||void 0===e?void 0:e.isEnabled())?this._gizmo.revokeOperation()||this.exitTransformMark():this.revokeOperation()},t.prototype.unRevokeOperation=function(){var e,t,r,i;if(this.revokeEnabled){if(this._hoverMark=null,this._drawing){var n=this._drawing.unRevoke();if(!n)return;if(this._orthoPlane>Ru.NONE){var a=this._calcOrthogonalPlaneNormal();this._updateAuxiliaryPlane(n,a),this._viewer.invalidate()}}else if(!this.enableOnlyDrawingRevoke&&this._revokeOperation.length>0){var o=this._revokeOperation.pop();if(this._keyOperation.push(o),this._keyOperation.length>=100&&this._keyOperation.shift(),this.reset(),o){try{for(var s=zu(o.marksParameter),l=s.next();!l.done;l=s.next()){var u=l.value,c=u.markType,h=u.worldPoints,d=u.parameter,p=u.id;this._drawMark(h,c,p,d)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}try{for(var f=zu(o.selectMarkIds),_=f.next();!_.done;_=f.next()){var m=_.value,v=this.marks.get(m).drawable;v&&this.setSelect(v,o.selectType)}}catch(e){r={error:e}}finally{try{_&&!_.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}}this._viewer.notifyEventListener("Mark-UndoEnabled",this._revokeOperation.length>0)}},t.prototype.unRevoke=function(){var e=!1;this._gizmo&&(e=this._gizmo.unRevokeOperation()),e&&!this._gizmo.isEnabled()&&this._gizmo.setEnabled(!0),e||this.unRevokeOperation()},t.prototype.clearOperation=function(){this._revokeOperation.length=0,this._keyOperation.length=0},t.prototype.setHoverEnabled=function(e){this._isHoverEnabled=e},t.prototype.enabledOrthoDrawing=function(e){this.orthoDrawing=e},t.prototype._drawPoint=function(e,t,r){var i=new Qu(r||a.a.generateUUID(),this._viewer.getRenderScene(),e);return this.marks.set(i.id,i),i.setParameters(t),i.use(),this._viewer.notifyEventListener("MarkGraph-Created",i.id),this._viewer.invalidate(),i},t.prototype._drawLine=function(e,t,r){if(e){var i=new Yu(r||a.a.generateUUID(),this._viewer.getRenderScene());return this.marks.set(i.id,i),i.setParameters(t),i.setWorldPoints(e),i.use(),this._viewer.invalidate(),i}},t.prototype._drawArea=function(e,t,r){if(e){var i=new Xu(r||a.a.generateUUID(),this._viewer.getRenderScene());return this.marks.set(i.id,i),i.setParameters(t),i.setWorldPoints(e),i.use(),this._viewer.invalidate(),i}},t.prototype._drawRect=function(e,t,r){if(e){var i=new Zu(r||a.a.generateUUID(),this._viewer.getRenderScene());return this.marks.set(i.id,i),i.setParameters(t||this._arrowParameters),i.setWorldPoints(e),i.use(),this._viewer.invalidate(),i}},t.prototype.transformKeyPoint=function(e,t){var r=this;t&&(this._gizmo=t),this._gizmo||(this._gizmo=new Gl(this._viewer),this._viewer.addTool(this._gizmo));var i=P.a.aabb.create();P.a.aabb.createFromPoints(i,e);var n=new Z("transform-key-point",this._resourceManager,this._viewer.getMaterialManager());n.preInitialize(i),e.forEach(function(e,t){var i=P.a.aabb.create();P.a.aabb.createFromPoints(i,[e]);var a=new Z("transform-key-point_"+t,r._resourceManager,r._viewer.getMaterialManager());a.setTranslation(e[0],e[1],e[2]),n.addChildEntity(a)}),this._gizmo.setEntity(n),this._gizmo.setEnabled(!0)},t}(gr.a),nc=r(64),ac=r.n(nc),oc=function(){return function(){this.eye3d=U.d.create(),this.at3d=U.d.create(),this.eye2d=U.c.create(),this.at2d=U.c.create(),this.adjust=1,this.angleDiff=0}}(),sc=function(){function e(e){e?(this._viewer=e,this._scene=e.getScene().core,this._camera=e.getCamera().core,this._resourceManager=e.getResourceManager(),this._renderer=e.getRenderer()):(this._viewer=null,this._scene=null,this._camera=null,this._resourceManager=null,this._renderer=null),this._floorPlan=!1,this._keypoints=[],this._trajectories=[],this._distances=[],this._mileage=0,this._speed=.08,this._mapWidth=1e3,this._mapHeight=1e3,this._cameraHeight=Number.MIN_VALUE,this.ORDINARY_PEOPLE_HEIGHT=5.5,this._state=0,this._lod={level:0,depthbuffers:[],inversedVPMatrices:[]};var t=[0,0,e.getWidth(),e.getHeight()];this._godView=new vr(this._scene,t),this._godView._perspective=!1,this._godView.resize=function(){},this._godView.update=function(){},this._godView.invertVPMatrix=U.a.create(),this._lodCamera=new vr(this._scene,t),this._lodCamera._perspective=!1,this._lodCamera.resize=function(){},this._lodCamera.update=function(){},this._renderTarget=null,this._depthQuery=null,this._miniMap=null,this._sceneScale=1,this._animator=new Or.a(this._viewer.getEventEmitter()),this._at3d=U.d.create(),this._at2d=U.c.create(),this._tmpAt=U.d.create(),this._tmpKeyPoint=new oc}return e.prototype.destroy=function(){this._keypoints=null,this._distances=null,this._depthQuery=null,this._renderTarget&&(this._renderTarget.destroy(),this._renderTarget=null,delete this._renderTarget),this._lod=null},e.prototype.doesSupportMobile=function(e){return!0},e.prototype.doesSupport3D=function(e){return!0},e.prototype.init=function(e){if(void 0===e&&(e=!0),!this._renderTarget)if(this._renderTarget=new wr.a("inapp",this._resourceManager,this._mapWidth,this._mapHeight,{clearColor:[0,0,0,0]}),e){var t=P.a.aabb.size(this._scene.clipping.get()),r=Math.max(t.width,t.height),i=Math.ceil(r/80);i=Math.min(Math.max(i,1),3),this._setLOD(i)}else this._setLOD(1);this._depthQuery||(this._depthQuery=new br.a(this._scene,this._resourceManager))},e.prototype._setLOD=function(e){this._lod.level=e,this._lod.depthbuffers=[],this._lod.inversedVPMatrices=[];for(var t=0;t<this._lod.level*this._lod.level;t++)this._lod.depthbuffers.push(new Uint8Array(this._mapWidth*this._mapHeight*4)),this._lod.inversedVPMatrices.push(U.a.create())},e.prototype.addKeyPoint=function(e,t){var r=new oc;U.d.copy(r.eye3d,this._camera.eye),U.c.copy(r.eye2d,[e,t]),U.d.copy(r.at3d,[this._at3d[0],this._at3d[1],this._camera.eye[2]]),U.c.copy(r.at2d,this._at2d);var i=U.d.distance(r.at3d,r.eye3d);U.d.lerp(r.at3d,r.eye3d,r.at3d,1/i),this._keypoints.push(r),this._calculateAdjust();var n=this._keypoints.length;if(n>1){var a=U.d.distance(this._keypoints[n-2].eye3d,this._keypoints[n-1].eye3d);this._distances.push(a+this._distances[this._distances.length-1]),this._trajectories.push([]),this._calculateTrajectory(n-2)}else this._distances.push(0);return this.restart(),this.stop(),{keypoint:this._keypoints[n-1]}},e.prototype.adjustPathPoint=function(e,t,r){var i=this._getWorldPosition(t,r);if(null===i)return!1;U.d.copy(this._keypoints[e].eye3d,i),U.c.copy(this._keypoints[e].eye2d,[t,r]),this._calculateAdjust(),this._distances=[],this._distances.push(0);for(var n=1;n<this._keypoints.length;n++){var a=U.d.distance(this._keypoints[n-1].eye3d,this._keypoints[n].eye3d);this._distances.push(a+this._distances[this._distances.length-1])}return 0===this._trajectories.length||(this._calculateTrajectory(e),this._calculateTrajectory(e-1),!0)},e.prototype.adjustFocusPoint=function(e,t,r){var i=this._getWorldPosition(t,r);this._keypoints[e].at3d[0]=i[0],this._keypoints[e].at3d[1]=i[1],this._keypoints[e].at2d[0]=t,this._keypoints[e].at2d[1]=r,this._calculateAdjust();var n=U.d.distance(this._keypoints[e].at3d,this._keypoints[e].eye3d);return U.d.lerp(this._keypoints[e].at3d,this._keypoints[e].eye3d,this._keypoints[e].at3d,1/n),this.restart(),{keypoint:this._keypoints[e]}},e.prototype.deleteKeyPoint=function(e){for(var t=e;t<this._keypoints.length-1;t++)this._keypoints[t]=this._keypoints[t+1];if(this._keypoints.pop(),this._calculateAdjust(),this._distances=[],this._keypoints.length>0){this._distances.push(0);for(t=1;t<this._keypoints.length;t++){var r=U.d.distance(this._keypoints[t-1].eye3d,this._keypoints[t].eye3d);this._distances.push(r+this._distances[this._distances.length-1])}}for(t=e;t<this._trajectories.length-1;t++)this._trajectories[t]=this._trajectories[t+1];this._trajectories.pop(),this._calculateTrajectory(e-1),this.restart()},e.prototype.navigate=function(e){if(0===this._state)return U.d.copy(this._camera.eye,this._keypoints[0].eye3d),U.d.copy(this._camera._at,this._keypoints[0].at3d),this._moveTo(this._keypoints[0].eye3d,this._keypoints[0].at3d),this._state++,{update:!0,info:null,progress:0};if(this._mileage>=this._distances[this._distances.length-1]){var t=this._keypoints[this._keypoints.length-1].eye2d,r=this._keypoints[this._keypoints.length-1].at2d;return{update:!1,info:U.e.fromValues(t[0],t[1],r[0],r[1]),progress:1}}var i=0;for(i=0;i<this._keypoints.length;i++)if(this._distances[i]>this._mileage){i-=1;break}var n=e?e*this._keypoints[i].adjust:1;this._mileage+=this._speed*n,this._mileage>this._distances[i+1]&&i++;var a=0;if(i<this._keypoints.length-1){var o=(this._mileage-this._distances[i])/(this._distances[i+1]-this._distances[i]);U.d.lerp(this._tmpKeyPoint.eye3d,this._keypoints[i].eye3d,this._keypoints[i+1].eye3d,o),U.d.lerp(this._tmpKeyPoint.eye2d,this._keypoints[i].eye2d,this._keypoints[i+1].eye2d,o),1!==this._keypoints[i].adjust?(U.d.rotateZ(this._tmpKeyPoint.at3d,this._keypoints[i].at3d,this._keypoints[i].eye3d,-this._keypoints[i].angleDiff*o),U.d.subtract(this._tmpKeyPoint.at3d,this._tmpKeyPoint.at3d,this._keypoints[i].eye3d),U.d.add(this._tmpKeyPoint.at3d,this._tmpKeyPoint.at3d,this._tmpKeyPoint.eye3d),U.c.rotate(this._tmpKeyPoint.at2d,this._keypoints[i].at2d,this._keypoints[i].eye2d,this._keypoints[i].angleDiff*o),U.d.subtract(this._tmpKeyPoint.at2d,this._tmpKeyPoint.at2d,this._keypoints[i].eye2d),U.d.add(this._tmpKeyPoint.at2d,this._tmpKeyPoint.at2d,this._tmpKeyPoint.eye2d)):(U.d.lerp(this._tmpKeyPoint.at3d,this._keypoints[i].at3d,this._keypoints[i+1].at3d,o),U.d.lerp(this._tmpKeyPoint.at2d,this._keypoints[i].at2d,this._keypoints[i+1].at2d,o));var s=this._trajectories[i].length,l=this._trajectories[i][Math.floor(s*o)];this._tmpKeyPoint.eye3d[2]=l,this._tmpKeyPoint.at3d[2]=l,a=this._mileage/this._distances[this._distances.length-1]}else U.d.copy(this._tmpKeyPoint.eye3d,this._keypoints[this._keypoints.length-1].eye3d),U.d.copy(this._tmpKeyPoint.at3d,this._keypoints[this._keypoints.length-1].at3d),U.c.copy(this._tmpKeyPoint.eye2d,this._keypoints[this._keypoints.length-1].eye2d),U.c.copy(this._tmpKeyPoint.at2d,this._keypoints[this._keypoints.length-1].at2d),a=1;return this._moveTo(this._tmpKeyPoint.eye3d,this._tmpKeyPoint.at3d),{update:!0,info:U.e.fromValues(this._tmpKeyPoint.eye2d[0],this._tmpKeyPoint.eye2d[1],this._tmpKeyPoint.at2d[0],this._tmpKeyPoint.at2d[1]),progress:a}},e.prototype.jumpTo=function(e){return this._state=1,this._mileage=this._distances[this._distances.length-1]*e,this.navigate()},e.prototype.getSteps=function(){return Math.floor(this._distances[this._distances.length-1]/this._speed)},e.prototype.restart=function(){this._state=0,this._mileage=0},e.prototype.loadData=function(e){var t,r=!1;for(this.clearData(),t=0;t<e.points.length;t++){var i=new oc;i.eye2d=[e.points[t].x,e.points[t].y],i.eye3d=e.points[t].eye3d.slice(0),i.at2d=[e.points[t].targetX,e.points[t].targetY],i.at3d=e.points[t].at3d.slice(0),this._keypoints.push(i)}if(this._calculateAdjust(),"string"==typeof e.trajectories)for(var n=ac.a.decompressFromEncodedURIComponent(e.trajectories).split("#"),a=0;a<n.length-1;a++){this._trajectories.push([]);for(var o=n[a].split(","),s=0;s<o.length-1;s++)this._trajectories[this._trajectories.length-1].push(Number(o[s]))}else this._trajectories=e.trajectories;var l=0;for(l=e.height?e.height:this._keypoints[0].eye3d[2],Math.abs(this._cameraHeight-l)>.001&&(this._cameraHeight=l,r=!0),this._distances.push(0),t=1;t<this._keypoints.length;t++){var u=U.d.distance(this._keypoints[t-1].eye3d,this._keypoints[t].eye3d);this._distances.push(u+this._distances[this._distances.length-1])}return this.restart(),r},e.prototype.exportData=function(e){void 0===e&&(e=!1);for(var t={points:[],trajectories:e?"":[],height:0},r=0;r<this._keypoints.length;r++){var i=this._keypoints[r];t.points.push({x:i.eye2d[0],y:i.eye2d[1],targetX:i.at2d[0],targetY:i.at2d[1],eye3d:i.eye3d.slice(0),at3d:i.at3d.slice(0)})}return t.trajectories=e?this.getTrajectories():this._trajectories.slice(0),t.height=this._cameraHeight,t},e.prototype.pinPoint=function(e,t){var r=this._depthQuery.unproject(e,t,this._renderer,this._camera);if(null!==r){this.clearData(),r[2]+=this.ORDINARY_PEOPLE_HEIGHT,this._cameraHeight=r[2];var i=U.d.create();return U.d.lerp(i,this._camera.eye,r,1.01),i[2]=r[2],this._moveTo(r,i),r}return null},e.prototype.generateDepthMap=function(){if(1===this._lod.level)this._renderDepthMap(this._godView,0);else for(var e=this._scene.clipping.get(),t=P.a.aabb.size(e),r=1.1*Math.max(t.width,t.height),i=r/this._lod.level*.5,n=0;n<this._lod.level;n++)for(var a=0;a<this._lod.level;a++)this._renderTarget.resize(this._mapWidth,this._mapHeight),this._lodCamera.eye[0]=.5*(e[0]+e[3])+(a/this._lod.level+.5/this._lod.level-.5)*r,this._lodCamera.eye[1]=.5*(e[1]+e[4])+((this._lod.level-1-n)/this._lod.level+.5/this._lod.level-.5)*r,this._lodCamera.eye[2]=this._cameraHeight+.01,U.d.set(this._lodCamera._at,this._lodCamera.eye[0],this._lodCamera.eye[1],this._lodCamera.eye[2]-1.01),U.a.lookAt(this._lodCamera.viewMatrix,this._lodCamera.eye,this._lodCamera._at,[0,1,0]),U.a.ortho(this._lodCamera.projectMatrix,-i,i,-i,i,.01,this._cameraHeight-e[2]+.02),this._lodCamera.viewport=[0,0,this._mapWidth,this._mapHeight],U.a.multiply(this._lodCamera.vpMatrix,this._lodCamera.projectMatrix,this._lodCamera.viewMatrix),this._lodCamera._cull.update(),this._renderDepthMap(this._lodCamera,a+n*this._lod.level)},e.prototype._renderDepthMap=function(e,t){var r=this._viewer.getResourceManager().gl,i=this._scene.getAllDrawablesWithoutLines();this._renderer.invalidate(),this._renderer.clear(this._renderTarget,r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this._renderer.drawDrawables(this._renderTarget,i,e,this._depthQuery._shaders,this._depthQuery._material,this._scene.clipping,null,null,null,!this._scene.needRenderDoubleSided()&&r.CCW),r.readPixels(0,0,this._mapWidth,this._mapHeight,r.RGBA,r.UNSIGNED_BYTE,this._lod.depthbuffers[t]),U.a.invert(this._lod.inversedVPMatrices[t],e.vpMatrix)},e.prototype.lookAt=function(e,t,r,i){this._floorPlan&&(e*=this._mapWidth,t*=this._mapHeight,void 0!==r&&void 0!==i&&(r*=this._mapWidth,i*=this._mapHeight));var n=this._getWorldPosition(e,t);if(void 0!==r&&void 0!==i){var a=this._getWorldPosition(r,i);U.d.set(this._at3d,a[0],a[1],n[2]),U.d.set(this._at2d,r,i),U.d.distance(this._at3d,n)<.001&&U.d.set(this._at3d,this._camera._at[0],this._camera._at[1],n[2]),this._moveTo(n,this._at3d)}else U.d.lerp(this._tmpAt,this._camera.eye,n,1.01),this._moveTo(n,this._tmpAt);return!0},e.prototype.setMiniMap=function(e){this._miniMap=e},e.prototype.getMiniMap=function(){return this._miniMap},e.prototype.getGodView=function(e,t,r,i,n,a,o){this._mapWidth=n||1e3,this._mapHeight=a||1e3,this._mapWidth=Math.floor(Math.floor(this._mapWidth/s.a.devicePixelRatio)*s.a.devicePixelRatio),this._mapHeight=Math.floor(Math.floor(this._mapHeight/s.a.devicePixelRatio)*s.a.devicePixelRatio),r=r||1,i=i||1,this._renderTarget.resize(this._mapWidth,this._mapHeight);var l=this._scene.clipping.get();P.a.aabb.scale(l,l,this._sceneScale);var u=P.a.aabb.size(l),c=this._mapWidth/this._mapHeight,h=.5*u.height*1.1,d=.5*u.width*1.1;if(d=(h=Math.max(c*d,h))/c,this._godView._perspective=!1,e&&t?(this._godView.eye[0]=.5*(l[0]+l[3])+(2*t-1)*h,this._godView.eye[1]=.5*(l[1]+l[4])+(2*(1-e)-1)*d,this._godView.eye[2]=this._cameraHeight+.01):U.d.set(this._godView.eye,.5*(l[0]+l[3]),.5*(l[1]+l[4]),this._cameraHeight+.01),U.d.set(this._godView._at,this._godView.eye[0],this._godView.eye[1],this._godView.eye[2]-1.01),U.a.lookAt(this._godView.viewMatrix,this._godView.eye,this._godView._at,[0,1,0]),h=r?h*r:h,d=i?d*i:d,U.a.ortho(this._godView.projectMatrix,-h,h,-d,d,.01,this._cameraHeight-l[2]+.02),this._godView.viewport=[0,0,this._mapWidth,this._mapHeight],U.a.multiply(this._godView.vpMatrix,this._godView.projectMatrix,this._godView.viewMatrix),this._godView._cull.update(),o)for(;!this._resetScreenPosition();)this._sceneScale++,this.getGodView(e,t,r,i,n,a,o);return this._sceneScale=1,this.generateDepthMap(),this._godView},e.prototype.getScreenPosList=function(){for(var e=[],t=0,r=this._keypoints.length;t<r;t++)e.push({eye2d:this._keypoints[t].eye2d,at2d:this._keypoints[t].at2d});return e},e.prototype.getMapCoord=function(e){var t=e||this._camera._at,r=U.d.fromValues(t[0],t[1],t[2]);return U.d.transformMat4(r,r,this._godView.vpMatrix),{x:(r[0]/2+.5)*this._mapWidth,y:this._mapHeight-1-(r[1]/2+.5)*this._mapHeight,height:0}},e.prototype.setViewHeightByRatio=function(e){var t=this._scene.clipping.get();this._cameraHeight=void 0!==e||null!==e?t[2]+this.ORDINARY_PEOPLE_HEIGHT+e*(t[5]-t[2]-this.ORDINARY_PEOPLE_HEIGHT):this._keypoints[this._keypoints.length-1].eye3d[2];var r=U.d.fromValues(this._camera.eye[0],this._camera.eye[1],this._cameraHeight),i=U.d.fromValues(this._camera._at[0],this._camera._at[1],this._cameraHeight);this._moveTo(r,i)},e.prototype.getViewHeight=function(){return this._cameraHeight},e.prototype.getTrajectories=function(){for(var e="",t=0;t<this._trajectories.length;t++){for(var r=0;r<this._trajectories[t].length;r++)e+=this._trajectories[t][r].toString()+",";e+="#"}return ac.a.compressToEncodedURIComponent(e)},e.prototype.getViewHeightRatio=function(){var e=this._scene.clipping.get();return((this._keypoints.length>1?this._camera.eye[2]:this._cameraHeight)-e[2]-this.ORDINARY_PEOPLE_HEIGHT)/(e[5]-e[2]-this.ORDINARY_PEOPLE_HEIGHT)},e.prototype.setSpeed=function(e){this._speed=e,this._calculateAdjust()},e.prototype._resetScreenPosition=function(){for(var e,t,r=U.d.create(),i=0,n=this._keypoints.length;i<n;i++)if(U.d.transformMat4(r,this._keypoints[i].eye3d,this._godView.vpMatrix),e=(r[0]/2+.5)*this._mapWidth,t=this._mapHeight-1-(r[1]/2+.5)*this._mapHeight,this._keypoints[i].eye2d[0]=e,this._keypoints[i].eye2d[1]=t,U.d.transformMat4(r,this._keypoints[i].at3d,this._godView.vpMatrix),e=(r[0]/2+.5)*this._mapWidth,t=this._mapHeight-1-(r[1]/2+.5)*this._mapHeight,this._keypoints[i].at2d[0]=e,this._keypoints[i].at2d[1]=t,e<0||e>this._mapWidth||t<0||t>this._mapHeight)return!1;return!0},e.prototype._getWorldPosition=function(e,t){if(this._floorPlan){var r=U.d.fromValues(2*(e/this._mapWidth-.5),2*((this._mapHeight-1-t)/this._mapHeight-.5),1);return U.d.transformMat4(r,r,this._godView.invertVPMatrix),r[2]=this._cameraHeight,r}var i,n;if(1===this._lod.level)i=this._lod.depthbuffers[0],n=this._lod.inversedVPMatrices[0],e=P.a.clamp(Math.floor(e),1,this._mapWidth),t=P.a.clamp(Math.floor(t),1,this._mapHeight);else{var a=Math.floor(e*this._lod.level/this._mapWidth),o=Math.floor(t*this._lod.level/this._mapWidth),s=a+o*this._lod.level;i=this._lod.depthbuffers[s],n=this._lod.inversedVPMatrices[s],e=e*this._lod.level-a*this._mapWidth,t=t*this._lod.level-o*this._mapHeight,e=P.a.clamp(Math.floor(e),1,this._mapWidth),t=P.a.clamp(Math.floor(t),1,this._mapHeight)}var l,u=4*(Math.floor(e)+Math.floor(this._mapHeight-t)*this._mapWidth),c=[i[u],i[u+1],i[u+2],i[u+3]];l=0===c[0]&&0===c[1]&&0===c[2]&&0===c[3]?.5:c[0]/255*(1/16581375)+c[1]/255*(1/65025)+c[2]/255*(1/255)+c[3]/255;var h=U.d.fromValues(2*(e/this._mapWidth-.5),2*((this._mapHeight-1-t)/this._mapHeight-.5),2*l-1);return U.d.transformMat4(h,h,n),h[2]+=this.ORDINARY_PEOPLE_HEIGHT,h},e.prototype._calculateAdjust=function(){if(0!==this._keypoints.length){if(this._keypoints.length>1)for(var e=U.c.create(),t=U.c.create(),r=0,i=this._keypoints.length-1;r<i;r++){var n=this._keypoints[r],a=this._keypoints[r+1],o=U.d.distance(n.eye3d,a.eye3d);U.c.subtract(e,n.at2d,n.eye2d),U.c.subtract(t,a.at2d,a.eye2d),U.c.normalize(e,e),U.c.normalize(t,t);var s=Math.atan2(e[1],e[0])+Math.PI,l=Math.atan2(t[1],t[0])+Math.PI,u=Math.sign(l-s),c=Math.abs(l-s);c>Math.PI&&(c=2*Math.PI-c,u*=-1),this._keypoints[r].angleDiff=c*u,this._keypoints[r].adjust=0==c?1:P.a.clamp(.08*o/c,.1,1)}this._keypoints[this._keypoints.length-1].adjust=1}},e.prototype._moveTo=function(e,t){this._animator.attach(this._camera),this._animator.start(e,t),this._animator.stop()},e.prototype.stop=function(e){this._camera.animator instanceof yr.a&&this._camera.animator.stop(),this._camera.animator instanceof Or.a&&this._animator.stop(e)},e.prototype._calculateTrajectory=function(e){if(!(e<0||e>this._trajectories.length-1)){this._trajectories[e]=[];for(var t=this._distances[e+1]-this._distances[e],r=Math.ceil(t/this._speed),i=0;i<r;i++){var n=U.c.create();U.d.lerp(n,this._keypoints[e].eye2d,this._keypoints[e+1].eye2d,i/r);var a=this._getWorldPosition(n[0],n[1]);this._trajectories[e].push(a[2])}}},e.prototype.clearData=function(){this._keypoints=[],this._distances=[],this._trajectories=[]},e.prototype.dumpMiniMap=function(e,t,r,i,n,a,o,s){o&&this.generateDepthMap();var l=this._camera,u=this.getGodView(e,t,r,i,n,a),c=this._viewer.getRenderScene();c.setCamera(u);var h=this._scene.clipping,d=h.getMin(),p=h.getMax();h.set(d,[p[0],p[1],this.getViewHeight()]),c.updateShadow();var f={};if(s){var _=this._scene.getMainLight();f.lightingIntensity=_.getIntensity(),f.latitude=_.getLatitude(),f.longitude=_.getLongitude(),this._scene.setLightingIntensity(.735),this._scene.setLightingLatitude(1.1938052083641213),this._scene.setLightingLongitude(3.392920065876977),f.isShadowEnabled=c.isShadowEnabled(),this._viewer.setShadowEnabled(!1),this._viewer.setSketchEnabled(!0),this._viewer.setSketchDetailLevel(2),this._viewer.setSketchContrast(35),this._viewer.invalidate(16)}var m=this._viewer.dumpScreen(this.mapWidth,this.mapHeight);return s&&(this._scene.setLightingIntensity(f.lightingIntensity),this._scene.setLightingLatitude(f.latitude),this._scene.setLightingLongitude(f.longitude),this._viewer.setShadowEnabled(f.isShadowEnabled),this._viewer.setSketchEnabled(!1)),h.set(d,p),c.setCamera(l),this.setMiniMap(m),m},e.prototype.setFloorPlanEnabled=function(e){this._floorPlan=!0},e.prototype.getGodViewForFloorPlan=function(e,t){this._mapWidth=t||1e3,this._mapHeight=this._mapWidth*(e[4]-e[1])/(e[3]-e[0]),this._mapWidth=Math.floor(Math.floor(this._mapWidth/s.a.devicePixelRatio)*s.a.devicePixelRatio),this._mapHeight=Math.floor(Math.floor(this._mapHeight/s.a.devicePixelRatio)*s.a.devicePixelRatio),this._cameraHeight=e[2]+this.ORDINARY_PEOPLE_HEIGHT;var r=new Float32Array(6);P.a.aabb.copy(r,e);var i=r[4];r[4]=-e[1],r[1]=-i;var n=P.a.aabb.size(r),a=(this._mapWidth,this._mapHeight,.5*n.height),o=.5*n.width;this._godView._perspective=!1,U.d.set(this._godView.eye,.5*(r[0]+r[3]),.5*(r[1]+r[4]),r[5]),U.d.set(this._godView._at,this._godView.eye[0],this._godView.eye[1],r[2]),U.a.lookAt(this._godView.viewMatrix,this._godView.eye,this._godView._at,[0,1,0]),U.a.ortho(this._godView.projectMatrix,-o,o,-a,a,.01,r[5]-r[2]+.01),this._godView.viewport=[0,0,this._mapWidth,this._mapHeight],U.a.multiply(this._godView.vpMatrix,this._godView.projectMatrix,this._godView.viewMatrix),U.a.invert(this._godView.invertVPMatrix,this._godView.vpMatrix),this._godView._cull.update()},e.prototype.recompileShader=function(e){this._depthQuery||(this._depthQuery=new br.a(this._scene,this._resourceManager)),this._depthQuery.recompileShader(this._resourceManager,e)},Object.defineProperty(e.prototype,"mapWidth",{get:function(){return this._mapWidth},set:function(e){this._mapWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapHeight",{get:function(){return this._mapHeight},set:function(e){this._mapHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keyPoints",{get:function(){return this._keypoints},enumerable:!1,configurable:!0}),e}(),lc=function(){return(lc=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},uc=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},cc=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(uc(arguments[t]));return e},hc="data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cfilter x='-50%25' y='-50%25' width='200%25' height='200%25' filterUnits='objectBoundingBox' id='a'%3E%3CfeMorphology radius='1' operator='dilate' in='SourceAlpha' result='shadowSpreadOuter1'/%3E%3CfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3E%3CfeGaussianBlur stdDeviation='1' in='shadowOffsetOuter1' result='shadowBlurOuter1'/%3E%3CfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3E%3CfeColorMatrix values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.34057971 0' in='shadowBlurOuter1'/%3E%3C/filter%3E%3Ccircle id='b' cx='387' cy='760' r='7'/%3E%3C/defs%3E%3Cg transform='translate(-371 -744)' fill='none' fill-rule='evenodd'%3E%3Cuse fill='%23000' filter='url(%23a)' xlink:href='%23b'/%3E%3Cuse stroke='%23FFF' stroke-width='2' fill='%23F75223' xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E",dc="data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient x1='50%25' y1='100%25' x2='50%25' y2='-3.448%25' id='a'%3E%3Cstop stop-color='%23F75223' offset='0%25'/%3E%3Cstop stop-color='%23FFF' stop-opacity='0' offset='100%25'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M370.305 808.455A50.59 50.59 0 00354.708 806c-5.21 0-10.246.792-15.013 2.27L355.053 835l15.252-26.545z' transform='translate(-339 -804)' fill='url(%23a)' fill-rule='evenodd'/%3E%3C/svg%3E",pc="data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cfilter x='-50%25' y='-50%25' width='200%25' height='200%25' filterUnits='objectBoundingBox' id='a'%3E%3CfeMorphology radius='1' operator='dilate' in='SourceAlpha' result='shadowSpreadOuter1'/%3E%3CfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3E%3CfeGaussianBlur stdDeviation='1' in='shadowOffsetOuter1' result='shadowBlurOuter1'/%3E%3CfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3E%3CfeColorMatrix values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.34057971 0' in='shadowBlurOuter1'/%3E%3C/filter%3E%3Ccircle id='b' cx='387' cy='792' r='7'/%3E%3C/defs%3E%3Cg transform='translate(-371 -776)' fill='none' fill-rule='evenodd'%3E%3Cuse fill='%23000' filter='url(%23a)' xlink:href='%23b'/%3E%3Cuse stroke='%23FFF' stroke-width='2' fill='%23797979' xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E",fc="data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Ccircle id='a' cx='291' cy='760' r='7'/%3E%3Cmask id='b' x='-1' y='-1' width='16' height='16'%3E%3Cpath fill='%23fff' d='M283 752h16v16h-16z'/%3E%3Cuse xlink:href='%23a'/%3E%3C/mask%3E%3C/defs%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg transform='translate(-275 -744)'%3E%3Cuse fill='%23FFF' xlink:href='%23a'/%3E%3Cuse stroke='%23F75223' mask='url(%23b)' stroke-width='2' xlink:href='%23a'/%3E%3C/g%3E%3Cpath d='M16.036 15.328l2.474-2.474.354-.354.707.707-.352.354-2.475 2.476 2.475 2.474.353.354-.706.707-.354-.352-2.474-2.475-2.475 2.475-.353.353-.707-.706.354-.354 2.474-2.474-2.474-2.475-.354-.353.707-.707.354.354 2.476 2.474z' fill='%23F75223'/%3E%3C/g%3E%3C/svg%3E",_c=2;!function(e){e[e.ADD=0]="ADD",e[e.EDIT=1]="EDIT",e[e.REMOVE=2]="REMOVE"}(qu||(qu={}));var mc,vc,yc={markerPointImage:hc,markerArrowImage:dc,animatingMarkerPointImage:hc,animatingMarkerArrowImage:dc,startMarkerImage:hc,endMarkerImage:"data:image/svg+xml;charset=utf-8,%3Csvg width='32px' height='32px' viewBox='0 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath d='M7.05833333,0 C3.33820098,0 0.329411765,3.04460813 0.329411765,6.80902778 C0.329411765,11.9157986 7.05833333,19.4543651 7.05833333,19.4543651 C7.05833333,19.4543651 13.7872549,11.9157986 13.7872549,6.80902778 C13.7872549,3.04460813 10.7784657,0 7.05833333,0 L7.05833333,0 Z' id='path-1'%3E%3C/path%3E%3Cfilter x='-50%25' y='-50%25' width='200%25' height='200%25' filterUnits='objectBoundingBox' id='filter-2'%3E%3CfeMorphology radius='0.9' operator='dilate' in='SourceAlpha' result='shadowSpreadOuter1'%3E%3C/feMorphology%3E%3CfeOffset dx='0' dy='0' in='shadowSpreadOuter1' result='shadowOffsetOuter1'%3E%3C/feOffset%3E%3CfeGaussianBlur stdDeviation='1' in='shadowOffsetOuter1' result='shadowBlurOuter1'%3E%3C/feGaussianBlur%3E%3CfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'%3E%3C/feComposite%3E%3CfeColorMatrix values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.34 0' type='matrix' in='shadowBlurOuter1'%3E%3C/feColorMatrix%3E%3C/filter%3E%3Cmask id='mask-3' maskContentUnits='userSpaceOnUse' maskUnits='objectBoundingBox' x='-0.9' y='-0.9' width='15.2578431' height='21.2543651'%3E%3Crect x='-0.570588235' y='-0.9' width='15.2578431' height='21.2543651' fill='white'%3E%3C/rect%3E%3Cuse xlink:href='%23path-1' fill='black'%3E%3C/use%3E%3C/mask%3E%3C/defs%3E%3Cg id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='new-icons-copy' transform='translate(-430.000000, -744.000000)'%3E%3Cg id='ic_place-copy-2' transform='translate(439.000000, 754.000000)'%3E%3Cg id='Shape'%3E%3Cuse fill='black' fill-opacity='1' filter='url(%23filter-2)' xlink:href='%23path-1'%3E%3C/use%3E%3Cuse fill='%23F75223' fill-rule='evenodd' xlink:href='%23path-1'%3E%3C/use%3E%3Cuse stroke='%23FFFFFF' mask='url(%23mask-3)' stroke-width='1.8' xlink:href='%23path-1'%3E%3C/use%3E%3C/g%3E%3Cpath d='M7.06001425,9.16596396 C5.55255591,9.16596396 4.32911147,7.9279547 4.32911147,6.40255043 C4.32911147,4.87714616 5.55255591,3.6391369 7.06001425,3.6391369 C8.56747258,3.6391369 9.79091703,4.87714616 9.79091703,6.40255043 C9.79091703,7.9279547 8.56747258,9.16596396 7.06001425,9.16596396 L7.06001425,9.16596396 Z' id='Path' fill='%23FFFFFF'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E",width:32,height:32},gc=function(){function e(e,t,r,i,n,a,o,l){var u=this;this.steps=0,this._currentStep=0,this.onMouseMove=function(e){var t=e.clientX-u._startPoint[0],r=e.clientY-u._startPoint[1];t*t+r*r>_c&&!u._dragMap&&u._mouseDown&&(u._dragMap=!0),u._dragMap&&(u._mapCenter[0]=u._startMapCenter[0]-t/u._zoomLevel,u._mapCenter[1]=u._startMapCenter[1]-r/u._zoomLevel,u.update())},this.onMouseDown=function(e){u._mouseDown||(u._mouseDown=!0,u._startPoint=[e.clientX,e.clientY]),e.preventDefault()},this.onMouseUp=function(e){u._dragMap?(u._dragMap=!1,u._startMapCenter=[u._mapCenter[0],u._mapCenter[1]]):u.editMode!==qu.ADD||u.showAnimatingMarker||u.addDefaultMarker(e.offsetX,e.offsetY),u._mouseDown&&(u._mouseDown=!1),e.preventDefault()},this.onWheel=function(e){u._zoomLevel=e.deltaY<0?u._zoomLevel+.5:u._zoomLevel-.5,u._zoomLevel<.5&&(u._zoomLevel=.5),u._zoomLevel>3&&(u._zoomLevel=3),u.update()},this._animatingMarkerOptions=t?lc(lc({},yc),t):yc,this._pointMarkerImage=new Image,this._pointMarkerImage.src=this._animatingMarkerOptions.animatingMarkerPointImage,this._arrowMarkerImage=new Image,this._arrowMarkerImage.src=this._animatingMarkerOptions.animatingMarkerArrowImage,this._startMarkerImage=new Image,this._startMarkerImage.src=this._animatingMarkerOptions.startMarkerImage,this._endMarkerImage=new Image,this._endMarkerImage.src=this._animatingMarkerOptions.endMarkerImage,this.showAnimatingMarker=!1,this.animatingMarkerPosition=[0,0],this.animatingMarkerRotation=0,this.eventEmitter=r||new E;var c=o||e.clientWidth,h=l||e.clientHeight;this._container=document.createElement("div"),this._canvas=document.createElement("canvas"),this._container.appendChild(this._canvas);var d=Math.floor(c*s.a.devicePixelRatio),p=Math.floor(h*s.a.devicePixelRatio);this._container.style.width=c+"px",this._container.style.height=h+"px",e.appendChild(this._container),this._parentContainer=e,this._canvas.width=d,this._canvas.height=p,this._canvas.style.width=c+"px",this._canvas.style.height=h+"px";var f=this._canvas.getBoundingClientRect();this._canvasOffsetX=f.left,this._canvasOffsetY=f.top,this._ctx=this._canvas.getContext("2d"),this._mouseDown=!1,this._dragMap=!1,this._startPoint=[0,0],this._startMapCenter=[n||0,a||0],this._mapCenter=[n||0,a||0],this.mapWidth=0,this.mapHeight=0,this._miniMapImage=i,this._zoomLevel=1,this._markers=[],this._editMode=qu.ADD,this.enabled=!1,this.update(),document.oncontextmenu=function(e){e.preventDefault()}}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,e?this.registerEvents():this.removeEvents()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editMode",{get:function(){return this._editMode},set:function(e){var t=this;e!==this._editMode&&(this._markers.forEach(function(r){r.updateByEditMode(e,t._editMode)}),this._editMode=e,this.update(),this.eventEmitter.emit("editModeChange",e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"markers",{get:function(){return this._markers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"miniMapImage",{get:function(){return this._miniMapImage},set:function(e){var t=this;this._miniMapImage=e,this._miniMapImage.onload=function(){t.update()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapCenter",{get:function(){return this._mapCenter},set:function(e){this._mapCenter=e,this._startMapCenter=cc(e),this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasOffsetX",{get:function(){return this._canvasOffsetX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasOffsetY",{get:function(){return this._canvasOffsetY},enumerable:!1,configurable:!0}),e.prototype.registerEvents=function(){this._canvas.addEventListener("mousedown",this.onMouseDown),this._canvas.addEventListener("mouseup",this.onMouseUp),this._canvas.addEventListener("mousemove",this.onMouseMove),this._canvas.addEventListener("wheel",this.onWheel)},e.prototype.removeEvents=function(){this._canvas.removeEventListener("mousedown",this.onMouseDown),this._canvas.removeEventListener("mouseup",this.onMouseUp),this._canvas.removeEventListener("mousemove",this.onMouseMove),this._canvas.removeEventListener("wheel",this.onWheel)},e.prototype.miniMapCoordToCanvasCoord=function(e,t){var r=this._canvas.width,i=this._canvas.height;return[r/2-(this._mapCenter[0]-e)*this._zoomLevel,i/2-(this._mapCenter[1]-t)*this._zoomLevel]},e.prototype.canvasCoordToMiniMapCoord=function(e,t){var r=this._canvas.width,i=this._canvas.height;return[this._mapCenter[0]-(r/2-e)/this._zoomLevel,this._mapCenter[1]-(i/2-t)/this._zoomLevel]},e.prototype.drawMap=function(){if(this.miniMapImage){var e=this.miniMapImage.width,t=this.miniMapImage.height,r=e*this._zoomLevel,i=t*this._zoomLevel,n=this.miniMapCoordToCanvasCoord(0,0);this._ctx.drawImage(this.miniMapImage,0,0,e,t,n[0],n[1],r,i)}},e.prototype.clearMap=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},e.prototype.clearMarkers=function(){this.markers.forEach(function(e){e.destroy()}),this._markers.length=0},e.prototype.clear=function(){this.clearMarkers(),this.clearMap()},e.prototype.update=function(){this.clearMap(),this.drawMap(),this.updateMarkers(),this.updateLines(),this.updateAnimatingMarker()},e.prototype.loadDefaultMarkers=function(e){var t=this;e.forEach(function(e){var r=e.eye2d[0],i=e.eye2d[1],n=e.eye3d[2],a=e.at2d[0],o=e.at2d[1],s=wc.calculateRotation(r,i,a,o),l=t.miniMapCoordToCanvasCoord(r,i);t.addDefaultMarker(l[0],l[1],n,s,!1,!1).state=mc.ARROW}),this.update()},e.prototype.addDefaultMarker=function(e,t,r,i,n,a){void 0===n&&(n=!0),void 0===a&&(a=!0);var o=new wc(this,{pointImageUrl:this._animatingMarkerOptions.markerPointImage,arrowImageUrl:this._animatingMarkerOptions.markerArrowImage,width:32,height:32});return this.addMarker(e,t,o,r,i,n,a),o},e.prototype.addMarker=function(e,t,r,i,n,a,o){void 0===n&&(n=0),void 0===a&&(a=!0),void 0===o&&(o=!0),r.x=e,r.y=t,r.mapX>this.mapWidth||r.mapX<0||r.mapY>this.mapHeight||r.mapY<0||(r.mapZ=i,r.rotation=n,this._markers.push(r),r.afterAdded(),o&&(r.editState=2,this.editMode=1),a&&(this.update(),this.eventEmitter.emit("afterAddMarker",r)))},e.prototype.removeMarker=function(e){for(var t=this._markers.indexOf(e),r=t+1;r<this._markers.length;r++)this._markers[r].setId(r-1);this._markers.splice(t,1),this.update(),e.destroy(),this.eventEmitter.emit("afterRemoveMarker",t)},e.prototype.updateMarkers=function(){this._markers.forEach(function(e){e.updateCanvasPosition()})},e.prototype.updateLines=function(){var e=this._ctx;e.setLineDash([5,5]),e.strokeStyle="#f75223",e.lineWidth=3,this._markers.forEach(function(t,r){0===r?(e.beginPath(),e.moveTo(t.x,t.y)):(e.lineTo(t.x,t.y),e.stroke())})},e.prototype.setAnimatingMarkerPositionFromMapCoord=function(e,t){this.animatingMarkerPosition=this.miniMapCoordToCanvasCoord(e,t)},e.prototype.setAnimatingMarkerRotationFromMapCoord=function(e,t,r,i){this.animatingMarkerRotation=wc.calculateRotation(e,t,r,i)},e.prototype.updateAnimatingMarker=function(){if(this.showAnimatingMarker){var e=this.animatingMarkerPosition,t=this.animatingMarkerRotation,r=this._ctx,i=this._animatingMarkerOptions,n=i.width,a=i.height,o=this._markers[0],s=this._markers[this._markers.length-1];this._startMarkerImage&&(r.save(),r.translate(o.x-n/2,o.y-a/2),r.drawImage(this._startMarkerImage,0,0,n,a),r.restore()),this._endMarkerImage&&(r.save(),r.translate(s.x-n/2,s.y-a/2),r.drawImage(this._endMarkerImage,0,0,n,a),r.restore()),r.globalAlpha=.5,this._pointMarkerImage&&(r.save(),r.translate(e[0]-n/2,e[1]-a/2),r.drawImage(this._pointMarkerImage,0,0,n,a),r.restore()),this._arrowMarkerImage&&(r.save(),r.translate(e[0],e[1]),r.rotate(t+Math.PI/2),r.drawImage(this._arrowMarkerImage,-n/2,-a,n,a),r.restore()),r.globalAlpha=1}},e.prototype.playAnimation=function(e){this.showAnimatingMarker=!0,this._markers.forEach(function(e){e.show=!1}),this.steps=e,this._currentStep=0,this._timer=requestAnimationFrame(this._navigate.bind(this))},e.prototype._navigate=function(){this._timer=requestAnimationFrame(this._navigate.bind(this)),this.update(),this._currentStep++,this.eventEmitter.emit("navigate",this._currentStep/this.steps)},e.prototype.stopAnimation=function(){this.showAnimatingMarker&&(this.showAnimatingMarker=!1,this._markers.forEach(function(e){e.show=!0}),this.update()),this._timer&&(cancelAnimationFrame(this._timer),this.eventEmitter.emit("animationStopped"))},e.prototype.restart=function(){var e=this._markers[0];this.setAnimatingMarkerPositionFromMapCoord(e.mapX,e.mapY),this.animatingMarkerRotation=e.rotation,this.update()},e.prototype.setMarkersEnabled=function(e){this._markers.forEach(function(t){t.state=e?mc.POINT:mc.DISABLE})},e.prototype.setMarkersEnabledByHeight=function(e,t){void 0===t&&(t=2.5),this._markers.forEach(function(r){r.state=Math.abs(e-r.mapZ)<t?mc.POINT:mc.DISABLE})},e.prototype.destroy=function(){this.stopAnimation(),this.clear(),this.removeEvents(),this.container.removeChild(this.canvas),St(this)},e}();!function(e){e[e.POINT=0]="POINT",e[e.ARROW=1]="ARROW",e[e.DISABLE=2]="DISABLE",e[e.REMOVE=4]="REMOVE"}(mc||(mc={})),function(e){e[e.SELECT=0]="SELECT",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.AFTEREDIT=3]="AFTEREDIT"}(vc||(vc={}));var bc,wc=function(){function e(e,t){var r=this;this.onMouseDownOnCanvas=function(e){switch(r.editState){case vc.ROTATION:r.editState=vc.AFTEREDIT}e.stopPropagation()},this.onMouseDownWhenRemove=function(e){r._miniMap.removeMarker(r)},this.onMouseDown=function(e){switch(r.editState){case vc.SELECT:r.editState=vc.POSITION,e.stopPropagation();break;case vc.POSITION:r._miniMap.eventEmitter.emit("afterEditPositionComplete",{marker:r,x:r.mapX,y:r.mapY}),r.editState=vc.ROTATION,e.stopPropagation();break;case vc.ROTATION:break;default:e.stopPropagation()}},this.onMouseUp=function(e){switch(r.editState){case vc.SELECT:case vc.POSITION:case vc.ROTATION:break;case vc.AFTEREDIT:r._miniMap.eventEmitter.emit("afterEditRotationComplete",{marker:r,x:r.mapX,y:r.mapY,atX:r._mapCoordAt[0],atY:r._mapCoordAt[1]}),r.editState=vc.SELECT}e.preventDefault()},this.onMouseMove=function(e){var t=e.clientX-r._miniMap.canvasOffsetX,i=e.clientY-r._miniMap.canvasOffsetY;switch(r.editState){case vc.SELECT:break;case vc.POSITION:r.x=t,r.y=i,r._miniMap.update(),r._miniMap.eventEmitter.emit("changingPosition",{x:r.mapX,y:r.mapY});break;case vc.ROTATION:r.rotation=r.calculateRotation(t,i),r._mapCoordAt=r._miniMap.canvasCoordToMiniMapCoord(t,i),r._miniMap.eventEmitter.emit("changingRotation",{marker:r,x:r.mapX,y:r.mapY,atX:r._mapCoordAt[0],atY:r._mapCoordAt[1]})}},this._miniMap=e;var i=t.pointImageUrl,n=t.width,a=void 0===n?32:n,o=t.height,s=void 0===o?32:o,l=t.arrowImageUrl,u=t.pointDisableImageUrl,c=t.deleteImageUrl;this._pointImageUrl=i||hc,this._pointDisableImageUrl=u||pc,this._arrowImageUrl=l||dc,this._deleteImageUrl=c||fc,this._x=0,this._y=0,this._rotation=0,this._width=a,this._height=s;var h=this._miniMap.canvasCoordToMiniMapCoord(this._x,this._y);this._mapX=h[0],this._mapY=h[1],this.mapZ=0,this._show=!0,this._container=document.createElement("div"),this._container.style.width=a+"px",this._container.style.height=s+"px",this._container.style.position="absolute",this._container.style.display=this._show?"block":"none",this._arrowContainer=document.createElement("div"),this._arrowContainer.style.width=a+"px",this._arrowContainer.style.height=s+"px",this._arrowContainer.style.position="absolute",this._arrowContainer.style.top=-Math.floor(s/2)+"px",this._arrowContainer.style.display="none",this._arrowContainer.style.transformOrigin="50% 100%",this._arrowContainer.style.transform="rotate("+this._rotation+"rad)",this._arrowContainer.style.backgroundImage='url("'+l+'")',this._container.appendChild(this._arrowContainer),this._pointContainer=document.createElement("div"),this._pointContainer.style.width=a+"px",this._pointContainer.style.height=s+"px",this._pointContainer.style.position="absolute",this._pointContainer.style.backgroundRepeat="no-repeat",this._pointContainer.style.backgroundSize="100%",this._pointContainer.style.backgroundImage='url("'+i+'")',this._container.appendChild(this._pointContainer),this._state=mc.POINT,this._prevState=mc.POINT,this._editState=vc.SELECT,this.updateByEditMode(this._miniMap.editMode)}return Object.defineProperty(e.prototype,"centerX",{get:function(){return this._x-this._width/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._y-this._height/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){e!==this._x&&(this._x=e,this._mapX=this._miniMap.canvasCoordToMiniMapCoord(this._x,this._y)[0],this._container.style.left=this._x-this._width/2+this._miniMap.canvas.offsetLeft+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){e!==this._y&&(this._y=e,this._mapY=this._miniMap.canvasCoordToMiniMapCoord(this._x,this._y)[1],this._container.style.top=this._y-this._height/2+this._miniMap.canvas.offsetTop+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapX",{get:function(){return this._mapX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapY",{get:function(){return this._mapY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e,this._container.style.display=e?"block":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){if(e!==this._state)switch(this._prevState=this._state,this._state=e,e){case mc.POINT:this._pointContainer.style.display="block",this._arrowContainer.style.display="none",this._pointContainer.style.backgroundImage='url("'+this._pointImageUrl+'")';break;case mc.ARROW:this._arrowContainer.style.display="block",this._pointContainer.style.display="block",this._pointContainer.style.backgroundImage='url("'+this._pointImageUrl+'")';break;case mc.DISABLE:this._pointContainer.style.display="block",this._arrowContainer.style.display="none",this._pointContainer.style.backgroundImage='url("'+this._pointDisableImageUrl+'")';break;case mc.REMOVE:this._arrowContainer.style.display="none",this._pointContainer.style.backgroundImage='url("'+this._deleteImageUrl+'")'}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editState",{get:function(){return this._editState},set:function(e){if(e!==this._editState)switch(this._editState=e,e){case vc.SELECT:this.state=mc.ARROW;break;case vc.POSITION:this.state=mc.POINT;break;case vc.ROTATION:this.state=mc.ARROW}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){e!==this._rotation&&(this._rotation=e,this._arrowContainer.style.transform="rotate("+(this._rotation+Math.PI/2)+"rad)")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),e.prototype.setId=function(e){this._id=e},e.prototype.afterAdded=function(){this._id=this._miniMap.markers.length-1,this._miniMap.container.appendChild(this._container)},e.prototype.updateByEditMode=function(e,t){switch(e){case qu.REMOVE:this.state=mc.REMOVE}switch(t){case qu.REMOVE:this.state=this._prevState}this.updateEventsByMode(e)},e.prototype.updateEventsByMode=function(e){switch(e){case qu.ADD:this.removeRemoveModeEvents(),this.removeEditModeEvents();break;case qu.EDIT:this.removeRemoveModeEvents(),this.registerEditModeEvents();break;case qu.REMOVE:this.removeEditModeEvents(),this.registerRemoveModeEvents()}},e.prototype.removeRemoveModeEvents=function(){this._container.removeEventListener("mousedown",this.onMouseDownWhenRemove)},e.prototype.registerRemoveModeEvents=function(){this._container.addEventListener("mousedown",this.onMouseDownWhenRemove)},e.prototype.registerEditModeEvents=function(){this._miniMap.container.addEventListener("mousedown",this.onMouseDownOnCanvas),this._container.addEventListener("mousedown",this.onMouseDown),this._miniMap.container.addEventListener("mousemove",this.onMouseMove),this._miniMap.container.addEventListener("mouseup",this.onMouseUp)},e.prototype.removeEditModeEvents=function(){this._miniMap.container.removeEventListener("mousedown",this.onMouseDownOnCanvas),this._container.removeEventListener("mousedown",this.onMouseDown),this._miniMap.container.removeEventListener("mousemove",this.onMouseMove),this._miniMap.container.removeEventListener("mouseup",this.onMouseUp)},e.calculateRotation=function(e,t,r,i){return Math.atan2(i-t,r-e)},e.prototype.calculateRotation=function(t,r){return e.calculateRotation(this.x,this.y,t,r)},e.prototype.updateCanvasPosition=function(){var e=this._miniMap.miniMapCoordToCanvasCoord(this.mapX,this.mapY);this.x=e[0],this.y=e[1],this.show&&(this.x<0||this.x>this._miniMap.canvas.width||this.y<0||this.y>this._miniMap.canvas.height?"none"!==this._container.style.display&&(this._container.style.display="none"):"block"!==this._container.style.display&&(this._container.style.display="block"))},e.prototype.updateMapPosition=function(){var e=this._miniMap.canvasCoordToMiniMapCoord(this.x,this.y);this._mapX=e[0],this._mapY=e[1]},e.prototype.destroy=function(){this._miniMap.container.removeChild(this._container),this.removeEditModeEvents(),this.removeRemoveModeEvents(),St(this)},e}(),xc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Mc=function(e){function t(t,r,i){var n=e.call(this,"MiniMapNavigation",!1,t)||this;return n._editMode=qu.ADD,n._navigationUtility=new sc(t),n._miniMapService=new gc(r,i),n._speed=n._navigationUtility.speed,n._eventRemoveCallbacks=[],n}return xc(t,e),Object.defineProperty(t.prototype,"utility",{get:function(){return this._navigationUtility},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstPointAdded",{get:function(){return this._firstPointAdded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playable",{get:function(){return this._playable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editMode",{get:function(){return this._editMode},set:function(e){this._editMode=e,this._miniMapService.editMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this._navigationUtility.setSpeed(e)},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._navigationUtility.destroy(),this._miniMapService.destroy(),St(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype._onEnableChanged=function(){this._enabled?(this._miniMapService.container.style.display="block",this._navigationUtility.init(!0)):(this._miniMapService.stopAnimation(),this._miniMapService.container.style.display="none")},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseUpListener(function(e){return t._onMouseUp(e)},"MiniMapNavigation")},t.prototype._onMouseUp=function(e){if(e.button===e.LEFT_BUTTON&&!e.moved)return!!this._enabled&&(this._firstPointAdded||this.initMiniMap(e)&&(this._viewer.notifyEventListener("firstPointAdded",e),this._firstPointAdded=!0),!0)},t.prototype.initMiniMap=function(e){var t=this,r=this._navigationUtility,i=this._miniMapService,n=r.pinPoint(e.x,e.y);if(!n)return null;var a=r.dumpMiniMap(void 0,void 0,void 0,void 0,void 0,void 0,!0),o=new Image;return o.src=a,o.onload=function(){i.enabled=!0;var e=r.getMapCoord(n);i.miniMapImage=o,i.mapCenter=[e.x,e.y],i.mapWidth=r.mapWidth,i.mapHeight=r.mapHeight,t._eventRemoveCallbacks.push(i.eventEmitter.on("afterAddMarker",function(e){console.log("add marker"),e.mapZ=r.getViewHeight();try{r.lookAt(e.mapX,e.mapY),i.markers.length>1?t._playable=!0:t._playable=!1,t._viewer.notifyEventListener("afterAddMarker",e)}catch(e){console.warn(e)}})),t._eventRemoveCallbacks.push(i.eventEmitter.on("afterRemoveMarker",function(e){console.log("remove marker"),r.deleteKeyPoint(e),i.markers.length>1?t._playable=!0:t._playable=!1,t._viewer.notifyEventListener("afterRemoveMarker",e)})),t._eventRemoveCallbacks.push(i.eventEmitter.on("changingPosition",function(e){r.lookAt(e.x,e.y)})),t._eventRemoveCallbacks.push(i.eventEmitter.on("changingRotation",function(e){try{r.lookAt(e.x,e.y,e.atX,e.atY)}catch(e){console.warn(e)}})),t._eventRemoveCallbacks.push(i.eventEmitter.on("afterEditPositionComplete",function(e){console.log("edit position complete"),t._editMode===qu.ADD||t._editMode===qu.EDIT&&r.adjustPathPoint(e.marker.id,e.x,e.y)})),t._eventRemoveCallbacks.push(i.eventEmitter.on("afterEditRotationComplete",function(e){console.log("edit rotation complete"),t._editMode===qu.ADD?(r.addKeyPoint(e.x,e.y),i.editMode=0):t._editMode===qu.EDIT&&r.adjustFocusPoint(e.marker.id,e.atX,e.atY)})),t._eventRemoveCallbacks.push(i.eventEmitter.on("navigate",function(){var e=r.navigate();t.updateMiniMapAnimation(e)})),t._eventRemoveCallbacks.push(i.eventEmitter.on("animationStopped",function(){t._isPlaying=!1,t._viewer.notifyEventListener("animationStopped")}));var a=i.miniMapCoordToCanvasCoord(e.x,e.y);i.addDefaultMarker(a[0],a[1])},n},t.prototype.updateMiniMapAnimation=function(e){var t=e.info,r=this._miniMapService;e.update?(t&&(r.setAnimatingMarkerPositionFromMapCoord(t[0],t[1]),r.setAnimatingMarkerRotationFromMapCoord(t[0],t[1],t[2],t[3])),this._viewer.notifyEventListener("navigate",e)):r.stopAnimation()},t.prototype.playAnimation=function(){this._isPlaying=!0;var e=this._navigationUtility.getSteps();this._miniMapService.playAnimation(e)},t.prototype.stopAnimation=function(){var e=this._miniMapService,t=this._navigationUtility;e.stopAnimation(),e.restart(),t.restart(),t.stop(),t.jumpTo(0),this._isPlaying=!1},t.prototype.jumpTo=function(e){console.log("jump to");var t=this._navigationUtility.jumpTo(e);this.updateMiniMapAnimation(t)},t.prototype.getViewHeightRatio=function(){return this._navigationUtility.getViewHeightRatio()},t.prototype.getViewHeight=function(){return this._navigationUtility.getViewHeight()},t.prototype.setViewHeightByRatio=function(e){this._navigationUtility.setViewHeightByRatio(e),this.regenerateMiniMap(!1,!0),this._miniMapService.setMarkersEnabledByHeight(this._navigationUtility.getViewHeight())},t.prototype.changeMiniMapStyle=function(e){void 0===e&&(e=!1),this._useSketchEffect=e,this.regenerateMiniMap(e,!1)},t.prototype.loadData=function(e){(this.clearData(),0!==e.points.length)?(this._navigationUtility.loadData(e)&&this.regenerateMiniMap(this._useSketchEffect,!0),this._miniMapService.loadDefaultMarkers(this._navigationUtility.keyPoints)):this._firstPointAdded=!1},t.prototype.exportData=function(){return this._navigationUtility.exportData()},t.prototype.clearData=function(){this._navigationUtility.restart(),this._navigationUtility.clearData(),this._miniMapService.clear()},t.prototype.restart=function(){this.editMode=qu.ADD,this.clearData(),this._eventRemoveCallbacks.forEach(function(e){e()}),this._eventRemoveCallbacks.length=0,this._miniMapService.enabled=!1,this._firstPointAdded=!1},t.prototype.regenerateMiniMap=function(e,t){void 0===t&&(t=!1);var r=this._navigationUtility.dumpMiniMap(void 0,void 0,void 0,void 0,void 0,void 0,t,e),i=this._miniMapService;i.miniMapImage=new Image,i.miniMapImage.src=r},t}(gr.a),Ec=function(){function e(e){this.updateFunction=e,this.records=new Map}return e.prototype.record=function(e,t,r){var i=this.records.get(e);i||(i=new Map,this.records.set(e,i)),i.has(t)||i.set(t,r)},e.prototype.recover=function(){var e=this;this.records.forEach(function(t,r){t.forEach(function(t,i){e.updateFunction(r,i,t)})})},e.prototype.isEmpty=function(){return 0===this.records.size},e}();!function(e){e[e.None=0]="None",e[e.Undoing=1]="Undoing",e[e.Redoing=2]="Redoing",e[e.Aborting=3]="Aborting"}(bc||(bc={}));var Tc,Sc=25,Ac=function(){function e(e){var t=this;this.undoStack=[],this.redoStack=[],this.status=bc.None,this.onPropertyChange=function(e,r,i){t.status!==bc.Aborting&&t.activeTransaction.record(e,r,i),t.status===bc.None&&t.onBackupRecord&&t.onBackupRecord(e,r,i)},this.updateFunction=e.updateFunction,this.onBackupRecord=e.onBackupRecord,this.maxBackupStep=e.maxBackupStep||Sc,this.openTransaction()}return Object.defineProperty(e.prototype,"undoable",{get:function(){return this.undoStack.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"redoable",{get:function(){return this.redoStack.length>0},enumerable:!1,configurable:!0}),e.prototype.setMaxBackupStep=function(e){if(e<1)throw Error("MaxBackupStep must not smaller than 1");this.maxBackupStep=e,this.undoStack.length>=this.maxBackupStep&&this.undoStack.splice(0,this.undoStack.length-this.maxBackupStep)},e.prototype.openTransaction=function(){this.redoStack.length=0,this.activeTransaction=this.createTransaction()},e.prototype.commitTransaction=function(){this.undoStack.length>=this.maxBackupStep&&this.undoStack.splice(0,this.undoStack.length-(this.maxBackupStep+1)),this.undoStack.push(this.activeTransaction),this.openTransaction()},e.prototype.abortTransaction=function(){this.status=bc.Aborting,this.activeTransaction.recover(),this.status=bc.None,this.activeTransaction=this.createTransaction()},e.prototype.undo=function(){return 0!==this.undoStack.length&&(this.abortTransaction(),this.activeTransaction=this.createTransaction(),this.status=bc.Undoing,this.undoStack.pop().recover(),this.status=bc.None,this.redoStack.push(this.activeTransaction),this.activeTransaction=this.createTransaction(),!0)},e.prototype.redo=function(){return 0!==this.redoStack.length&&(this.abortTransaction(),this.activeTransaction=this.createTransaction(),this.status=bc.Redoing,this.redoStack.pop().recover(),this.status=bc.None,this.undoStack.push(this.activeTransaction),this.activeTransaction=this.createTransaction(),!0)},e.prototype.clear=function(){this.undoStack.length=0,this.redoStack.length=0,this.openTransaction()},e.prototype.createTransaction=function(){return new Ec(this.updateFunction)},e}(),Pc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),kc=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Oc=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(kc(arguments[t]));return e};!function(e){e[e.NODE=0]="NODE",e[e.MATERIAL=1]="MATERIAL",e[e.LAYER=2]="LAYER",e[e.GROUP=3]="GROUP"}(Tc||(Tc={}));!function(e){function t(t){var r=e.call(this,"SelectElement",!0,t)||this;r._keyCtrlPressed=!1,r._nodeHoveringChanged=!1,r._shader=null,r._material=null,r._pickQuery=null,r._pickables=null,r._renderScene=null,r._nodeHovering=null,r._nodesHovering=[],r._nodesSelected=[],r._selectMode=Tc.NODE,r._interactive=!1,r._renderScene=t.getRenderScene(),r._material=t.getMaterialManager().createMaterialOverride("select-elements-other"),r._material.setUseTransparent(!1);var i=r._renderScene.getScene(),n=["VISIBILITY"];if(i.compressed&&n.push("COMPRESSION"),s.a.isMobile&&n.push("ENCODE_NORMAL"),i.clipping.isEnabled()&&n.push("CLIPPING"),i.needRenderDoubleSided()&&n.push("DOUBLESIDED"),r._shader=r._viewer.getResourceManager().getShader("solid",n),!r._shader.ready){var a=k.a.solid;r._shader.createFromShaderSource(a,n)}return r}Pc(t,e),t.prototype.destroy=function(){this._pickQuery&&(this._pickQuery.destroy(),this._pickQuery=null,delete this._pickQuery),this._renderScene=null,delete this._renderScene,this._material.destroy(),this._material=null,delete this._material,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype._onEnableChanged=function(){this._enabled&&(this._pickQuery||(this._pickQuery=new Jr.a(this._scene,this._viewer.getResourceManager())))},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e);case"keyboard":return this._registerKeyboardEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"SelectNodes"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"SelectNodes")},t.prototype._registerTouchEvents=function(e){},t.prototype._registerKeyboardEvents=function(e){var t=this;e.addKeyDownListener(function(e){return t._onKeyDown(e.key)},"SelectNodes"),e.addKeyUpListener(function(e){return t._onKeyUp(e.key)},"SelectNodes")},t.prototype._onKeyDown=function(e){switch(e){case"Control":this._keyCtrlPressed=!0;break;case"a":case"A":this._keyCtrlPressed&&this._selectAllNodes();break;case"n":this._selectMode=Tc.NODE,this._nodeHovering=null;break;case"m":this._selectMode=Tc.MATERIAL,this._nodeHovering=null;break;case"l":this._selectMode=Tc.LAYER,this._nodeHovering=null}return!1},t.prototype._onKeyUp=function(e){switch(e){case"Control":this._keyCtrlPressed=!1}return!1},t.prototype._selectAllNodes=function(){var e=this;for(var t in this._nodesSelected=[],this._scene.models)this._scene.models[t].drawables.forEach(function(t){var r;t.isTriangle()&&(r=e._nodesSelected).push.apply(r,Oc(t.nodes))})},t.prototype._onMouseMove=function(e){if(!this._enabled)return!1;if(e.pressed)return!1;var t=this._pointSelect(e.x,e.y);if(this._nodeHoveringChanged=t!==this._nodeHovering,!this._nodeHoveringChanged)return!1;if(this._nodesHovering=[],this._nodeHovering=t,null===this._nodeHovering)return!1;switch(this._selectMode){case Tc.NODE:this._nodesHovering=[this._nodeHovering];break;case Tc.MATERIAL:this._nodesHovering=Oc(this._nodeHovering.drawable.nodes);break;case Tc.LAYER:this._nodesHovering=Oc(this._nodeHovering.getLayer().getNodes())}return!1},t.prototype._pointSelect=function(e,t){var r=this._pickQuery.pickNodesInsideRegion(e,t,e,t,this._renderer,this._camera,this._getPickables());return 0===r.length?null:r[0]},t.prototype._onMouseUp=function(e){var t,r=this;if(!this._enabled)return!1;if(e.moved)return!1;if(e.isDoubleClick)return!1;if(e.button!==e.LEFT_BUTTON)return!1;var i=-1!==this._nodesSelected.indexOf(this._nodesHovering[0]);return this._keyCtrlPressed?(this._nodesSelected=this._nodesSelected.filter(function(e){return!r._nodesHovering.includes(e)}),!i&&((t=this._nodesSelected).push.apply(t,Oc(this._nodesHovering)),!1)):(this._nodesSelected=i?this._nodesSelected:this._nodesHovering,!1)},t.prototype.recompileShader=function(e){this._enabled&&this._pickQuery&&this._pickQuery.recompileShader(this._viewer.getResourceManager(),e)},t.prototype._getPickables=function(){if(this._pickables&&this._pickables.length>0)return this._pickables;var e=new hn("pickQueue",{line:!1});for(var t in this._scene.models)this._scene.models[t].drawables.forEach(function(t){e.addDrawable(t)});return this._pickables=e.drawables,this._pickables},t.prototype.getNodesSelected=function(){return this._nodesSelected},t.prototype.getNodesHovering=function(){return this._nodesHovering},t.prototype.setMode=function(e){e!==this._selectMode&&(this._selectMode=e,this._nodeHovering=null)},t.prototype.nodeHoveringChanged=function(){return this._nodeHoveringChanged}}(gr.a);var Dc,Nc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Cc=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Ic=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Cc(arguments[t]));return e},Rc=U.d.fromValues(0,0,1),Bc=5*Math.PI/180,Lc=[],Fc=[];!function(e){e.ADD="ADD",e.SELECT="SELECT"}(Dc||(Dc={}));var Uc,Vc=function(e){function t(t,r){var i=e.call(this,"BillboardPlacer",!0,t)||this;i._mode=Dc.SELECT,i._selectMode=Tc.NODE,i._hoveringBillboards=[],i._selectedBillboards=[],i.selectedColor=[.968,.322,.137,1],i.hoveredColor=[1,.565,.443,1],i._selector=r;var n=i._viewer.getCamera().getManipulator().normalDepth;return i._normalDepth=n||new Mr(i._resourceManager,i._viewer.getRenderScene().getRenderQueueManager(),i._scene,i._viewer.getWidth(),i._viewer.getHeight()),i._depthQuery=new br.a(i._scene,i._resourceManager),i._hoveredDrawables=[],i._selectedDrawables=[],i._rtDefault=i._getRenderTarget({depthTest:!1}),i._rtProgressively=i._getRenderTargetPR({depthTest:!1}),i}return Nc(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectMode",{get:function(){return this._selectMode},set:function(e){this._selectMode=e},enumerable:!1,configurable:!0}),t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseDownListener(function(e){return t._onMouseDown(e)},"BillboardPlacer"),e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"BillboardPlacer"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"BillboardPlacer")},t.prototype._onMouseDown=function(e){return!1},t.prototype._onMouseUp=function(e){if(!this._enabled||e.moved||e.button!==e.LEFT_BUTTON||!this.isInputEnabled())return!1;if(this.mode===Dc.ADD){if(this._normalDepth.render(this._renderer,this._camera),this._normalDepth.getNormalDepth(e.x,e.y)){var t=this._normalDepth.getPosition();if(t){var r=this._normalDepth.getNormal(),i=U.d.angle(r,Rc);if(!(i>=0&&i<Math.PI/2-Bc))return this._viewer.notifyEventListener("onPickAvailablePositionForBillboard",void 0,t),!0;var n=this._depthQuery.unproject(e.x,e.y,this._renderer,this._camera),o=U.d.distance(n,t),s=this._camera,l=s._zfar,u=s._znear;if(n&&o<(l-u)/100){var c=V.b.lengthUnitScale("m");return n[0]/=c,n[1]/=c,n[2]/=c,this._viewer.notifyEventListener("onPickAvailablePositionForBillboard",n),!0}}}return this._viewer.notifyEventListener("onPickAvailablePositionForBillboard",void 0),!0}if(this.mode===Dc.SELECT){var h=a.a.arrayDiff(this._selectedBillboards,this._hoveringBillboards),d=h.added,p=h.removed;if(0!==d.length||0!==p.length)return this._viewer.notifyEventListener("onPawnBillboardSelected",this._hoveringBillboards.map(function(e){return e.name})),!0}return!1},t.prototype._onMouseMove=function(e){return!(!this._enabled||!this.isInputEnabled())&&(!(this.mode!==Dc.SELECT||!this.pickBillboard(e))&&(this._viewer.notifyEventListener("onPawnBillboardHovered",this._hoveringBillboards.map(function(e){return e.name})),this._viewer.invalidate(),!0))},t.prototype.pickBillboard=function(e){var t=this._selector.getDrawableUnderCursor();if(t&&t instanceof We){switch(this.selectMode){case Tc.NODE:var r=Lc[Fc.indexOf(t)];if(r===this._hoveringBillboards[0])return!1;this.setHoveringBillboards([r]);break;case Tc.MATERIAL:if(this._hoveringBillboards[0]&&t.material===this._hoveringBillboards[0].drawables[0].material)return!1;this.setHoveringBillboards(this.getBillboardsByMaterial(t.material));break;case Tc.LAYER:if(this._hoveringBillboards[0]&&t.material.getDiffuseTexture()===this._hoveringBillboards[0].drawables[0].material.getDiffuseTexture())return!1;this.setHoveringBillboards(this.getBillboardsByTexture(t.material.getDiffuseTexture()))}return!0}return this._hoveringBillboards.length>0&&(this.setHoveringBillboards(void 0),!0)},t.prototype.onSceneChanged=function(){for(var e in Fc.length=0,Lc.length=0,this._scene.pawns)if(this._scene.pawns[e]instanceof nt){var t=this._scene.pawns[e];Lc.push(t),Fc.push(t.drawables[0])}this._scene.needRenderDoubleSided()?this._normalDepth.recompileShader("DOUBLESIDED",!0):this._normalDepth.recompileShader("DOUBLESIDED",!1)},t.prototype.addBillboard=function(e){var t=this;e.forEach(function(e){var r=e.id,i=e.position,n=e.color,a=void 0===n?[1,1,1]:n,o=e.width,s=e.height,l=e.image,u=e.alphaCutOff,c=void 0===u?.3:u,h=new nt(r,t._resourceManager,t._viewer.getMaterialManager());h.createTexturedQuad(l,{hasMask:!0,color:a}),h.useOverride=!1,h.drawables[0].material.setAlphaCutoff(c),h.drawables[0].recompileShader("CLIPPING",t._scene.clipping.isEnabled());var d=V.b.lengthUnitScale("m");h.setScaling(o/2*d,o/2*d,s/2*d),h.setTranslation(i[0]*d,i[1]*d,(i[2]+s/2)*d),t._viewer.getScene().addPawn(h,!1,!0)}),e.length>0&&(this._viewer.onSceneChanged(),this._viewer.invalidate())},t.prototype.updateBillboard=function(e){var t=this,r=!1;e.forEach(function(e){var i=e.id,n=e.position,a=e.color,o=e.width,s=e.height,l=e.alphaCutOff,u=t._viewer.getScene().getPawn(i);if(u){if(a&&t.setBillboardColor(u.drawables[0],a),void 0!==l&&u.drawables[0].material.setAlphaCutoff(l),void 0!==o&&void 0!==s){var c=V.b.lengthUnitScale("m"),h=u.scale[2];u.setScaling(o/2*c,o/2*c,s/2*c);var d=u.position;u.setTranslation(d[0],d[1],d[2]-h+s/2*c),r=!0}if(n){c=V.b.lengthUnitScale("m");var p=u.scale[2]/c;u.setTranslation(n[0]*c,n[1]*c,(n[2]+p)*c),r=!0}}}),r&&(this._selectedDrawables.length=0,this.updateHighlight(this._selectedBillboards,!1),this._scene.updateBBox(),this._viewer.onSceneChanged()),this._viewer.invalidate()},t.prototype.removeBillboard=function(e){var t=this;e.forEach(function(e){var r=t._viewer.getScene().getPawn(e);if(r){var i=t._selectedBillboards.indexOf(r);i>-1&&t._selectedBillboards.splice(i,1),t._viewer.getScene().removePawn(r,!0)}}),e.length>0&&(this._selectedDrawables.length=0,this.updateHighlight(this._selectedBillboards,!1),this._viewer.onSceneChanged(),this._viewer.invalidate())},t.prototype.setBillboardColor=function(e,t){var r=e.material,i=this.getMaterialByColor(r,t);e.material=i},t.prototype.getBillboardsByMaterial=function(e){var t=[];for(var r in this._scene.pawns){var i=this._scene.pawns[r];i instanceof nt&&i.drawables[0].material===e&&t.push(i)}return t},t.prototype.getBillboardsByTexture=function(e){var t=[];for(var r in this._scene.pawns){var i=this._scene.pawns[r];i instanceof nt&&i.drawables[0].material.getDiffuseTexture()===e&&t.push(i)}return t},t.prototype.setVisibilityByIds=function(e,t){var r=this;0!==e.length&&(e.forEach(function(e){var i=r._viewer.getScene().getPawn(e);i&&(i.drawables[0].visible=t)}),this._hoveredDrawables.forEach(function(e){return e.visible=t}),this._selectedDrawables.forEach(function(e){return e.visible=t}),this._viewer.onSceneChanged(),this._viewer.invalidate())},t.prototype.getMaterialByColor=function(e,t){var r=e.getDiffuse();if(r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]){var i=e.getDiffuseTexture(),n="pawn-billboard-texture-",a=i.name.indexOf(n),o="pawn-billboard-material-"+i.name.slice(a+n.length)+"_"+t.join(","),s=this._viewer.getMaterialManager().getMaterial(o);if(!s){var l=this._viewer.getMaterialManager().createMaterialAdhoc(o);return e.clone(o,l),l.setDiffuse(t),l}return s}return e},t.prototype._render=function(){this._renderer.drawDrawables(this._rtDefault,this._selectedDrawables,this._camera,null,null,this._scene.clipping),this._renderer.drawDrawables(this._rtDefault,this._hoveredDrawables,this._camera,null,null,this._scene.clipping)},t.prototype._renderProgressively=function(){this._renderer.drawDrawables(this._rtProgressively,this._selectedDrawables,this._camera,null,null,this._scene.clipping),this._renderer.drawDrawables(this._rtProgressively,this._hoveredDrawables,this._camera,null,null,this._scene.clipping)},t.prototype.setHoveringBillboards=function(e){var t=this;this._hoveringBillboards.length=0,this._hoveredDrawables.length=0,void 0!==e&&0!==e.length&&("string"==typeof e[0]?e.forEach(function(e){var r=t._scene.pawns[e];r&&r instanceof nt&&t._hoveringBillboards.push(r)}):e.forEach(function(e){t._hoveringBillboards.push(e)}),this.updateHighlight(this._hoveringBillboards,!0))},t.prototype.setSelectBillboards=function(e){var t=this;if(this._selectedBillboards.length=0,void 0===e)return this._selectedDrawables.length=0,void this._viewer.invalidate();"string"==typeof e[0]?e.forEach(function(e){var r=t._scene.pawns[e];r&&r instanceof nt&&t._selectedBillboards.push(r)}):e.forEach(function(e){t._selectedBillboards.push(e)}),this.updateHighlight(this._selectedBillboards,!1),this._viewer.invalidate()},t.prototype.updateHighlight=function(e,t){var r=this;void 0===t&&(t=!1),0!==e.length&&(t?e.forEach(function(e,t){var i=new nt("billboard_single_hover_bounding_box_"+t,r._resourceManager,r._viewer.getMaterialManager());i.createWiredCube(r.hoveredColor),i.setTranslation.apply(i,Ic(e.position));var n=e.scale;i.setScaling(n[0],.01,n[2]),r._hoveredDrawables.push(i.drawables[0])}):e.forEach(function(e,t){var i=new nt("billboard_single_select_bounding_box_"+t,r._resourceManager,r._viewer.getMaterialManager());i.createWiredCube(r.selectedColor),i.setTranslation.apply(i,Ic(e.position));var n=e.scale;i.setScaling(n[0],.01,n[2]),r._selectedDrawables.push(i.drawables[0]);var a=r._hoveredDrawables.indexOf(i.drawables[0]);a>-1&&r._hoveredDrawables.splice(a,1)}))},t.prototype.beforeDestroy=function(){return this._normalDepth.isDestroy||this._normalDepth.destroy(),this._normalDepth=null,delete this._normalDepth,!0},t}(gr.a),jc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),zc=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},Gc=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(zc(arguments[t]));return e},Hc=function(e){function t(t){var r=e.call(this,"Selector",!1,t)||this;r._material=null,r._maskedMaterial=null,r._pickables=[],r._maskedPickables=[],r._renderTarget=null,r._pickCamera=null,r._shaders=[null,null,null],r._maskedShaders=[null,null,null],r._indexBuffer=null,r._cursor=[0,0],r._currNodeUnderCursor=null,r._currModelUnderCursor=null,r._currDrawableUnderCursor=null,r._drawableNotUseOverride=[],r._material=t.getMaterialManager().createMaterialAdhoc("selector"),r._material.transparent=!1,r._maskedMaterial=t.getMaterialManager().createMaterialAdhoc("selector-masked"),r._maskedMaterial.hasMask=!0,r._maskedMaterial.hasTexture=!0,r._maskedMaterial.transparent=!1;var i=["VISIBILITY"],n=t.getRenderScene().getScene();return n.compressed&&i.push("COMPRESSION"),s.a.isMobile&&i.push("ENCODE_NORMAL"),n.clipping.isEnabled()&&i.push("CLIPPING"),n.needRenderDoubleSided()&&i.push("DOUBLESIDED"),r.recompileShader(i),r._enabled=!0,r._pickCamera=new nr.a([r._camera.viewport[0],r._camera.viewport[1],1,1]),r._indexBuffer=new Uint8Array(4),r._renderTarget=new wr.a("query",r._resourceManager,1,1,{clearColor:[0,0,0,0],depthFunc:r._resourceManager.gl.LEQUAL}),r}return jc(t,e),t.prototype.destroy=function(){this._material.destroy(),this._material=null,delete this._material,this._pickCamera=null,delete this._pickCamera,this._indexBuffer=null,delete this._indexBuffer,this._renderTarget=null,delete this._renderTarget,e.prototype.destroy.call(this)},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.addInput=function(e){switch(e.name){case"mouse":return this._registerMouseEvents(e);case"touch":return this._registerTouchEvents(e)}},t.prototype._registerMouseEvents=function(e){var t=this;e.addMouseMoveListener(function(e){return t._onMouseMove(e)},"Selector"),e.addMouseUpListener(function(e){return t._onMouseUp(e)},"Selector")},t.prototype._registerTouchEvents=function(e){},t.prototype._onMouseMove=function(e){return!(!this._enabled||!this.isInputEnabled())&&(this._cursor[0]=e.x,this._cursor[1]=e.y,this._currNodeUnderCursor=null,this._currModelUnderCursor=null,this._currDrawableUnderCursor=null,!1)},t.prototype._onMouseUp=function(e){if(!this._enabled||!this.isInputEnabled())return!1;this.getNodeUnderCursor(),this.getModelUnderCursor(),this.getDrawableUnderCursor();return!1},t.prototype.getNodeUnderCursor=function(){return this._currNodeUnderCursor||(this._currNodeUnderCursor=this.getNodeAtPixel(this._cursor[0],this._cursor[1])),this._currNodeUnderCursor},t.prototype.getDrawableUnderCursor=function(){if(this._enabled&&this.isInputEnabled())return this._currDrawableUnderCursor||(this._currDrawableUnderCursor=this.getDrawableAtPixel(this._cursor[0],this._cursor[1])),this._currDrawableUnderCursor},t.prototype.getModelUnderCursor=function(){if(this._enabled&&this.isInputEnabled())return this._currModelUnderCursor||(this._currModelUnderCursor=this.getModelAtPixel(this._cursor[0],this._cursor[1])),this._currModelUnderCursor},t.prototype.getNodeAtPixel=function(e,t){var r=this.getDrawableAtPixel(e,t);if(!r)return null;var i=r.nodes;if(!i)return null;var n=[];i.forEach(function(e){e.isVisible()&&n.push(e)}),this._renderNodesOfSelectedDrawable(n);var a=this._getPickedIndex();return-1==a?null:n[a]},t.prototype._renderNodesOfSelectedDrawable=function(e){this._scene.clipping.isEnabled()&&this._renderer.renderState.invalidateClip(),this._renderer.clear(this._renderTarget,this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._renderer.drawNodesCustom(this._renderTarget,e,this._pickCamera,this._shaders,this._material,this._scene.clipping,!this._scene.needRenderDoubleSided()&&this._gl.CCW,this._changeMaterial)},t.prototype.getDrawableAtPixel=function(e,t){if(this._enabled&&this.isInputEnabled()){this._generatePickCameraAtPixel(e,t),this._renderPickablesUnderPickCamera();var r=this._getPickedIndex();return r>=this._pickables.length?this._maskedPickables[r-this._pickables.length]:-1==r?null:this._pickables[r]}},t.prototype.getModelAtPixel=function(e,t){if(this._enabled&&this.isInputEnabled()){var r=this.getDrawableAtPixel(e,t);if(!r)return null;for(var i in this._scene.models){var n=this._scene.models[i];if(n.include(r))return n}return null}},t.prototype._generatePickCameraAtPixel=function(e,t){e=Math.floor(e*s.a.devicePixelRatio),t=Math.floor(t*s.a.devicePixelRatio);var r=this._camera.viewport;t=r[3]-1-t;var i=U.a.create();i[0]=r[2],i[5]=r[3],i[12]=r[2]-2*e,i[13]=r[3]-2*t,U.d.copy(this._pickCamera.eye,this._camera.eye),U.d.copy(this._pickCamera._at,this._camera._at),U.a.mul(this._pickCamera.vpMatrix,i,this._camera.vpMatrix)},t.prototype._renderPickablesUnderPickCamera=function(){var e=this;this._scene.clipping.isEnabled()&&this._renderer.renderState.invalidateClip(),this._renderer.clear(this._renderTarget,this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this.beforeRenderWithOverride(this._pickables),this._renderer.drawDrawablesCustom(this._renderTarget,this._pickables,this._pickCamera,this._shaders,this._material,this._scene.clipping,!this._scene.needRenderDoubleSided()&&this._gl.CCW,this._changeMaterial),this.afterRenderWithOverride(),this.beforeRenderWithOverride(this._maskedPickables),this._renderer.drawDrawablesCustom(this._renderTarget,this._maskedPickables,this._pickCamera,this._maskedShaders,this._maskedMaterial,this._scene.clipping,!this._scene.needRenderDoubleSided()&&this._gl.CCW,function(t,r){e._changeMaterial(e._pickables.length+t,r)}),this.afterRenderWithOverride()},t.prototype._changeMaterial=function(e,t){e++;var r=[0,0,0,0];r[0]=(.49+(e>>0&255))/255,r[1]=(.49+(e>>8&255))/255,r[2]=(.49+(e>>16&255))/255,r[3]=(.49+(e>>24&255))/255,t.setDiffuse(r),t.setTransparent(r[3])},t.prototype._getPickedIndex=function(){return this._renderTarget.getFramebuffer().use(),this._gl.readPixels(0,0,1,1,this._gl.RGBA,this._gl.UNSIGNED_BYTE,this._indexBuffer),(this._indexBuffer[0]<<0)+(this._indexBuffer[1]<<8)+(this._indexBuffer[2]<<16)+(this._indexBuffer[3]<<24)-1},t.prototype.addPickable=function(e){var t=this;e instanceof Wa?e.getDrawablesWithoutLine().forEach(function(e){t.addPickable(e)}):e instanceof J?e.drawables.forEach(function(e){t.addPickable(e)}):e.isDestroy||(e.material.hasMask?this._maskedPickables.push(e):this._pickables.push(e))},t.prototype.removePickable=function(e){var t=this;e instanceof Wa?e.getDrawablesWithoutLine().forEach(function(e){return t.removePickable(e)}):e instanceof J?e.drawables.forEach(function(e){return t.removePickable(e)}):e.material.hasMask?this._maskedPickables.splice(this._pickables.indexOf(e),1):this._pickables.splice(this._pickables.indexOf(e),1)},t.prototype.getAllNode=function(){var e=[];for(var t in this._scene.models){this._scene.models[t].drawables.forEach(function(t){t.isTriangle()&&e.push.apply(e,Gc(t.nodes))})}return e},t.prototype.getAllMark=function(){return null},t.prototype.getAllBillboard=function(){return null},t.prototype.onSceneChanged=function(){var e=this;this._pickables.length=0,this._maskedPickables.length=0,Object.values(this._scene.models).forEach(function(t){return e.addPickable(t)}),Object.values(this._scene.pawns).forEach(function(t){return e.addPickable(t)}),this._scene.shapes&&Object.values(this._scene.shapes).forEach(function(t){return e.addPickable(t)})},t.prototype.recompileShader=function(e){var t=Gc(e);this._shaders[0]=this._resourceManager.getShader("constant",e),this._shaders[0].ready||this._shaders[0].createFromShaderSource(k.a.constant,e),e.push("MODEL_TRANSFORM"),this._shaders[1]=this._resourceManager.getShader("constant",e),this._shaders[1].ready||this._shaders[1].createFromShaderSource(k.a.constant,e),e.push("INSTANCING"),this._shaders[2]=this._resourceManager.getShader("constant",e),this._shaders[2].ready||this._shaders[2].createFromShaderSource(k.a.constant,e),this._material.attachShader(this._shaders[0]),this._material.setDiffuse([0,0,0]),this._material.setTransparent(1),t.push("BASE","DIFFUSE_REPLACE","ALPHATEST","USE_ONLY_TEXTURE_ALPHA"),this._maskedShaders[0]=this._resourceManager.getShader("constant_mask",t),this._maskedShaders[0].ready||this._maskedShaders[0].createFromShaderSource(k.a.constant_mask,t),t.push("MODEL_TRANSFORM"),this._maskedShaders[1]=this._resourceManager.getShader("constant_mask",t),this._maskedShaders[1].ready||this._maskedShaders[1].createFromShaderSource(k.a.constant_mask,t),t.push("INSTANCING"),this._maskedShaders[2]=this._resourceManager.getShader("constant_mask",t),this._maskedShaders[2].ready||this._maskedShaders[2].createFromShaderSource(k.a.constant_mask,t),this._maskedMaterial.attachShader(this._maskedShaders[0]),this._maskedMaterial.setDiffuse([0,0,0]),this._maskedMaterial.setTransparent(1)},t.prototype.beforeRenderWithOverride=function(e){var t=this;this._drawableNotUseOverride.length=0,e.forEach(function(e){e.useOverride||(e.useOverride=!0,t._drawableNotUseOverride.push(e))})},t.prototype.afterRenderWithOverride=function(){this._drawableNotUseOverride.forEach(function(e){e.useOverride=!1})},t}(gr.a),qc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Wc={},Qc=function(e){function t(t,r){var i=e.call(this,"PerformanceDebugger",!1,t)||this;return r=r||{},i._lastTimestamp=0,i._frameCount=0,i._stutterCount=0,i._currentTime=Date.now(),i._emitEventInterval=void 0!==r.emitInterval?r.emitInterval:30,i._totalTime=0,i._stutterTime=0,i}return qc(t,e),t.prototype._onEnableChanged=function(){this._enabled},t.prototype.doesSupportMobile=function(e){return!0},t.prototype.doesSupport3D=function(e){return!0},t.prototype.renderNormally=function(){if(this._currentTime=Date.now(),this._totalTime>1e3*this._emitEventInterval&&(this._frameCount>0&&this._viewer.getEventEmitter().emit("performanceRecord",this.getAllPerformanceData()),this._frameCount=0,this._stutterCount=0,this._totalTime=0,this._stutterTime=0),0!==this._lastTimestamp){var e=this._currentTime-this._lastTimestamp;e>100&&(this._stutterCount++,this._stutterTime+=e),this._frameCount++,this._totalTime+=e}this._lastTimestamp=this._currentTime},t.prototype.renderProgressively=function(){this._lastTimestamp=0},t.prototype.getMemoryData=function(){return"memory"in performance?{totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}:{totalJSHeapSize:0,usedJSHeapSize:0}},t.prototype.getGPUMemoryStats=function(){this._viewer.getResourceManager().getMemStats(Wc)},t.prototype.getAllPerformanceData=function(){var e=this.getMemoryData();this.getGPUMemoryStats();var t=0,r=0,i=this._scene.models;for(var n in i){i[n].drawables.forEach(function(e){t++,e.drawnLastFrame&&r++})}return{totalFrameCount:this._frameCount,totalTimes:this._totalTime,stutterCount:this._stutterCount,stutterTime:this._stutterTime,gpuDevice:s.a.gpuInfo.device,benchMarkFps:s.a.gpuInfo.fps,gpu:s.a.gpuInfo.gpu,gpuTier:s.a.gpuInfo.tier,browserName:s.a.browserName,browserVersion:s.a.browserVersion,browserEngineName:s.a.browserEngineName,browserEngineVersion:s.a.browserEngineVersion,deviceModel:s.a.deviceModel,deviceType:s.a.deviceType,deviceVendor:s.a.deviceVendor,totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize,meshKBytes:Math.floor(Wc.meshKBytes),meshCount:Wc.meshCount,textureKBytes:Math.floor(Wc.textureKBytes),textureCount:Wc.textureCount,framebufferCount:Wc.framebufferCount,shaderCount:Wc.shaderCount,drawableCount:t,drawnLastFrameDrawableCount:r,viewportWidth:this._camera.viewport[2],viewportHeight:this._camera.viewport[3],cpuArchitecture:s.a.cpuArchitecture,webGLVersion:this._viewer.getResourceManager().gl.isWebGL2?2:1}},t}(gr.a);r.d(t,"a",function(){return Uc}),function(e){!function(e){!function(e){e[e.LINES=0]="LINES",e[e.LINE=1]="LINE",e[e.LINESTRIP=2]="LINESTRIP",e[e.LINEFAN=3]="LINEFAN",e[e.ANGLE=4]="ANGLE",e[e.AREA=5]="AREA"}(e.MeasureType||(e.MeasureType={})),function(e){e.FEET="feet",e.INCHES="inches",e.CM="cm",e.M="m"}(e.MeasureUnit||(e.MeasureUnit={})),function(e){e[e.NONE=-1]="NONE",e[e.VERTEX=0]="VERTEX",e[e.EDGE=1]="EDGE",e[e.EDGE_MIDPOINT=2]="EDGE_MIDPOINT"}(e.SnappingMode||(e.SnappingMode={})),e.MeasureLine=Rs,e.MeasureLineFan=Hs,e.MeasureLines=Us,e.MeasureLineStrip=Ys,e.MeasureAngle=Js,e.MeasureArea=rl,e.Section=sl,e.MagnifyGlass=cl,e.SelectElements=ml,e.CameraManipulator=Xr,e.TransformGizmo=Gl,e.Comment=Hl.a,e.SelectModel=Yl,e.ArchDesign=Ol,e.CameraNavigator=Cl,e.BBoxSize=Vu,e.MarkGraph=ic,e.MiniMapNavigation=Mc,e.BillboardPlacer=Vc,e.Selector=Hc,e.PerformanceDebugger=Qc}(e.Tool||(e.Tool={})),function(e){e.Mouse=h,e.Keyboard=g,e.Touch=_}(e.Input||(e.Input={})),e.ViewAngle=Zr.a,e.DrawMode=Nu,e.ArrowStyle=Iu,e.SelectType=Cu,function(e){e[e.SOLIDCOLOR=0]="SOLIDCOLOR",e[e.WALLPAPER=1]="WALLPAPER",e[e.EQUIRECTANGLE=2]="EQUIRECTANGLE",e[e.CUBEMAP=3]="CUBEMAP",e[e.WALLPAPER_TILED=4]="WALLPAPER_TILED"}(e.ViewBackground||(e.ViewBackground={})),e.TRANSFORM_TYPE=Al,e.State=i,e.Scene3D=ir,e.Camera=Kr,e.Pawn=J,e.GLTFLoader=Ce,e.Text3D=Ve,e.Text3DBillboard=Ye,e.PawnBillboard=nt,function(e){e.AnimatingRibbon=yu,e.BarChart=Jl,e.AnimatingStripe=wu,e.AnimatingPipe=Lu,e.Pipe=Bu,e.PipeCircleProfile=Pu,e.PipeRectProfile=ku,e.HeatMap=Lt,e.HeightMap=Ut,e.MetaBall=eu,e.Trail=iu,e.Volume=su,e.MultiLayerVolume=uu,e.MultiLayerColor=pu}(e.Visualize||(e.Visualize={})),e.Viewer3D=Bo,e.Viewer3DBase=Da,e.Viewer360=os,e.Viewer360Base=Wo,e.Viewer3DCompare=fs,e.Viewer3DDark=ys,e.PathFollowingAnimator=Rl,e.NavigationUtility=sc,e.NavigationMiniMapService=gc,e.TransactionManager=Ac}(Uc||(Uc={}))},function(e,t,r){"use strict";t.a=function(){var e=function(e){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>"},t=function(e,t){var r=null;if(t.webgl2)return r=e.getContext("webgl2",t),console.log("Try to use webgl2.0."),!!r?r:(console.warn("webgl2.0 is not supported on this browser!"),null);for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;++n){try{r=e.getContext(i[n],t)}catch(e){}if(r)break}return r};return window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return window.setTimeout(e,1e3/60)},window.cancelAnimFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout,{create3DContext:t,setupWebGL:function(r,i){function n(t){var i=r.parentNode;i&&(i.innerHTML=e(t))}if(!window.WebGLRenderingContext)return n('This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var a=t(r,i);return a||n('It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),a}}}},function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i,n=r(29),a=(r(23),function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})}),o=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){e.Architect="Architect",e.Product="Product"}(i||(i={}));var s,l={};!function(e){!function(e){e.Architect="Architect",e.Product="Product"}(e.ModelShaderSetting||(e.ModelShaderSetting={})),e.get=function(e){return a(this,void 0,void 0,function(){return o(this,function(t){return[2,new Promise(function(t,r){n.i(e).then(function(e){return e.forEach(function(e){l[e.id]=e}),t(e)}).catch(r)})]})})},e.create=function(e,t){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,n.c(e,t)]})})},e.update=function(e,t){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,n.n(e,t)]})})},e.remove=function(e){return a(this,void 0,void 0,function(){return o(this,function(t){return[2,n.d(e)]})})}}(s||(s={}))},function(e,t,r){"use strict";(function(e,i){function n(e){return e.arrayBuffer?e.arrayBuffer():new Promise((t,r)=>{const i=new FileReader;i.addEventListener("loadend",()=>{t(i.result)}),i.addEventListener("error",r),i.readAsArrayBuffer(e)})}async function a(e){const t=await n(e);return new Uint8Array(t)}function o(e){return"undefined"!=typeof Blob&&e instanceof Blob}function s(e){return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}r.d(t,"a",function(){return ie});const l=void 0!==e&&e.versions&&void 0!==e.versions.node&&void 0===e.versions.electron;class u{constructor(e){this.typedArray=e instanceof ArrayBuffer||s(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,t){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,t)}}class c{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,t){const r=this.blob.slice(e,e+t),i=await n(r);return new Uint8Array(i)}async sliceAsBlob(e,t,r=""){return this.blob.slice(e,e+t,r)}}function h(e,t){var r=e.length;if(t<=r)return e;var i=new Uint8Array(Math.max(r<<1,t));return i.set(e,0),i}function d(e,t,r,i,n,a){for(var o=v,s=g,l=0;l<r;){var u=e[s(i,n)&t];n+=15&u;var c=u>>>4;if(c<=15)a[l]=c,l++;else{var h=0,d=0;16==c?(d=3+o(i,n,2),n+=2,h=a[l-1]):17==c?(d=3+o(i,n,3),n+=3):18==c&&(d=11+o(i,n,7),n+=7);for(var p=l+d;l<p;)a[l]=h,l++}}return n}function p(e,t,r,i){for(var n=0,a=0,o=i.length>>>1;a<r;){var s=e[a+t];i[a<<1]=0,i[1+(a<<1)]=s,s>n&&(n=s),a++}for(;a<o;)i[a<<1]=0,i[1+(a<<1)]=0,a++;return n}function f(e,t){for(var r,i,n,a,o=e.length,s=b.bl_count,l=0;l<=t;l++)s[l]=0;for(l=1;l<o;l+=2)s[e[l]]++;var u=b.next_code;for(r=0,s[0]=0,i=1;i<=t;i++)r=r+s[i-1]<<1,u[i]=r;for(n=0;n<o;n+=2)0!=(a=e[n+1])&&(e[n]=u[a],u[a]++)}function _(e,t,r){for(var i=e.length,n=b.rev15,a=0;a<i;a+=2)if(0!=e[a+1])for(var o=a>>1,s=e[a+1],l=o<<4|s,u=t-s,c=e[a]<<u,h=c+(1<<u);c!=h;){r[n[c]>>>15-t]=l,c++}}function m(e,t){for(var r=b.rev15,i=15-t,n=0;n<e.length;n+=2){var a=e[n]<<t-e[n+1];e[n]=r[a]>>>i}}function v(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1}function y(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1}function g(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}const b=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();!function(){for(var e=0;e<32768;e++){var t=e;t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8,b.rev15[e]=(t>>>16|t<<16)>>>17}function r(e,t,r){for(;0!=t--;)e.push(0,r)}for(e=0;e<32;e++)b.ldef[e]=b.of0[e]<<3|b.exb[e],b.ddef[e]=b.df0[e]<<4|b.dxb[e];r(b.fltree,144,8),r(b.fltree,112,9),r(b.fltree,24,7),r(b.fltree,8,8),f(b.fltree,9),_(b.fltree,9,b.flmap),m(b.fltree,9),r(b.fdtree,32,5),f(b.fdtree,5),_(b.fdtree,5,b.fdmap),m(b.fdtree,5),r(b.itree,19,0),r(b.ltree,286,0),r(b.dtree,30,0),r(b.ttree,320,0)}();const w={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,i=0;i<8;i++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,i){for(var n=0;n<i;n++)e=w.table[255&(e^t[r+n])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^w.update(4294967295,e,t,r)}};function x(e,t){return function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var i=y,n=v,a=d,o=g,s=null==t;s&&(t=new r(e.length>>>2<<3));for(var l,u,c=0,m=0,w=0,x=0,M=0,E=0,T=0,S=0,A=0;0==c;)if(c=i(e,A,1),m=i(e,A+1,2),A+=3,0!=m){if(s&&(t=h(t,S+(1<<17))),1==m&&(l=b.flmap,u=b.fdmap,E=511,T=31),2==m){w=n(e,A,5)+257,x=n(e,A+5,5)+1,M=n(e,A+10,4)+4,A+=14;for(var P=0;P<38;P+=2)b.itree[P]=0,b.itree[P+1]=0;var k=1;for(P=0;P<M;P++){var O=n(e,A+3*P,3);b.itree[1+(b.ordr[P]<<1)]=O,O>k&&(k=O)}A+=3*M,f(b.itree,k),_(b.itree,k,b.imap),l=b.lmap,u=b.dmap,A=a(b.imap,(1<<k)-1,w+x,e,A,b.ttree);var D=p(b.ttree,0,w,b.ltree);E=(1<<D)-1;var N=p(b.ttree,w,x,b.dtree);T=(1<<N)-1,f(b.ltree,D),_(b.ltree,D,l),f(b.dtree,N),_(b.dtree,N,u)}for(;;){var C=l[o(e,A)&E];A+=15&C;var I=C>>>4;if(I>>>8==0)t[S++]=I;else{if(256==I)break;var R=S+I-254;if(I>264){var B=b.ldef[I-257];R=S+(B>>>3)+n(e,A,7&B),A+=7&B}var L=u[o(e,A)&T];A+=15&L;var F=L>>>4,U=b.ddef[F],V=(U>>>4)+i(e,A,15&U);for(A+=15&U,s&&(t=h(t,S+(1<<17)));S<R;)t[S]=t[S++-V],t[S]=t[S++-V],t[S]=t[S++-V],t[S]=t[S++-V];S=R}}}else{0!=(7&A)&&(A+=8-(7&A));var j=4+(A>>>3),z=e[j-4]|e[j-3]<<8;s&&(t=h(t,S+z)),t.set(new r(e.buffer,e.byteOffset+j,z),S),A=j+z<<3,S+=z}return t.length==S?t:t.slice(0,S)}(e,t)}const M={numWorkers:1,workerURL:"",useWorkers:!1};let E=0,T=0,S=!0;const A=[],P=[],k=[],O=new Map;function D(e){I(e.target);const{id:t,error:r,data:i}=e.data,n=O.get(t);O.delete(t),r?n.reject(r):n.resolve(i)}function N(e){return new Promise((t,r)=>{const i=new Worker(e);i.onmessage=(e=>{"start"===e.data?(i.onerror=void 0,i.onmessage=void 0,t(i)):r(new Error(`unexpected message: ${e.data}`))}),i.onerror=r})}const C=function(){if(l){const{Worker:e}=function(e,t){return e.require(t)}(i,"worker_threads");return{createWorker:async t=>new e(t),addEventListener(e,t){e.on("message",r=>{t({target:e,data:r})})},async terminate(e){await e.terminate()}}}return{async createWorker(e){try{return await N(e)}catch(t){console.warn("could not load worker:",e)}let t;try{const r=await fetch(e,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${e}`);t=await r.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const i=await N(e);return M.workerURL=e,i}catch(t){console.warn("could not load worker via fetch:",e)}if(void 0!==t)try{e=`data:application/javascript;base64,${btoa(t)}`;const r=await N(e);return M.workerURL=e,r}catch(e){console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}}}();function I(e){P.push(e),B()}function R(e,t,r,i){const n=new Uint8Array(t);x(e,n),i(r?new Blob([n],{type:r}):n.buffer)}async function B(){if(0!==k.length){if(M.useWorkers&&S){const e=await async function(){if(0===P.length&&T<M.numWorkers){++T;try{const e=await C.createWorker(M.workerURL);A.push(e),P.push(e),C.addEventListener(e,D)}catch(e){S=!1}}return P.pop()}();if(S){if(e){if(0===k.length)return void I(e);const{id:t,src:r,uncompressedSize:i,type:n,resolve:a,reject:o}=k.shift();O.set(t,{id:t,resolve:a,reject:o});const s=[];e.postMessage({type:"inflate",data:{id:t,type:n,src:r,uncompressedSize:i}},s)}return}}for(;k.length;){const{src:e,uncompressedSize:t,type:r,resolve:i}=k.shift();let n=e;o(e)&&(n=await a(e)),R(n,t,r,i)}}}function L(e,t,r){return new Promise((i,n)=>{k.push({src:e,uncompressedSize:t,type:r,resolve:i,reject:n,id:E++}),B()})}class F{constructor(e,t){this._reader=e,this._rawEntry=t,this.name=t.name,this.nameBytes=t.nameBytes,this.size=t.uncompressedSize,this.compressedSize=t.compressedSize,this.comment=t.comment,this.commentBytes=t.commentBytes,this.compressionMethod=t.compressionMethod,this.lastModDate=function(e,t){return new Date(1980+(e>>9&127),(e>>5&15)-1,31&e,t>>11&31,t>>5&63,2*(31&t),0)}(t.lastModFileDate,t.lastModFileTime),this.isDirectory=0===t.uncompressedSize&&t.name.endsWith("/"),this.encrypted=!!(1&t.generalPurposeBitFlag)}async blob(e="application/octet-stream"){return await async function(e,t,r){const{decompress:i,fileDataStart:n}=await te(e,t);if(!i){const i=await H(e,n,t.compressedSize,r);return o(i)?i:new Blob([s(i.buffer)?new Uint8Array(i):i],{type:r})}const a=await H(e,n,t.compressedSize);return await L(a,t.uncompressedSize,r)}(this._reader,this._rawEntry,e)}async arrayBuffer(){return await async function(e,t){const{decompress:r,fileDataStart:i}=await te(e,t);if(!r){const r=await G(e,i,t.compressedSize);return function(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength}(r)?r.buffer:r.slice().buffer}const n=await H(e,i,t.compressedSize);return await L(n,t.uncompressedSize)}(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return Z(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const U=22,V=65535,j=101010256,z=101075792;async function G(e,t,r){return await e.read(t,r)}async function H(e,t,r,i){return e.sliceAsBlob?await e.sliceAsBlob(t,r,i):await e.read(t,r)}const q={unsigned:()=>0};function W(e,t){return e[t]+256*e[t+1]}function Q(e,t){return e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function Y(e,t){return Q(e,t)+4294967296*Q(e,t+4)}const X=new TextDecoder;function Z(e,t){return s(e.buffer)&&(e=new Uint8Array(e)),X.decode(e)}const K=117853008;async function J(e,t,r,i){const n=t-20,a=await G(e,n,20);if(Q(a,0)!==K)throw new Error("invalid zip64 end of central directory locator signature");const o=Y(a,8),s=await G(e,o,56);if(Q(s,0)!==z)throw new Error("invalid zip64 end of central directory record signature");const l=Y(s,32),u=Y(s,40);return ee(e,Y(s,48),u,l,r,i)}const $=33639248;async function ee(e,t,r,i,n,a){let o=0;const s=await G(e,t,r),l=[];for(let e=0;e<i;++e){const e=s.subarray(o,o+46),t=Q(e,0);if(t!==$)throw new Error(`invalid central directory file header signature: 0x${t.toString(16)}`);const r={versionMadeBy:W(e,4),versionNeededToExtract:W(e,6),generalPurposeBitFlag:W(e,8),compressionMethod:W(e,10),lastModFileTime:W(e,12),lastModFileDate:W(e,14),crc32:Q(e,16),compressedSize:Q(e,20),uncompressedSize:Q(e,24),fileNameLength:W(e,28),extraFieldLength:W(e,30),fileCommentLength:W(e,32),internalFileAttributes:W(e,36),externalFileAttributes:Q(e,38),relativeOffsetOfLocalHeader:Q(e,42)};if(64&r.generalPurposeBitFlag)throw new Error("strong encryption is not supported");o+=46;const i=s.subarray(o,o+r.fileNameLength+r.extraFieldLength+r.fileCommentLength);r.nameBytes=i.slice(0,r.fileNameLength),r.name=Z(r.nameBytes);const n=r.fileNameLength+r.extraFieldLength,a=i.slice(r.fileNameLength,n);r.extraFields=[];let u=0;for(;u<a.length-3;){const e=W(a,u+0),t=u+4,i=t+W(a,u+2);if(i>a.length)throw new Error("extra field length exceeds extra field buffer size");r.extraFields.push({id:e,data:a.slice(t,i)}),u=i}if(r.commentBytes=i.slice(n,n+r.fileCommentLength),r.comment=Z(r.commentBytes),o+=i.length,4294967295===r.uncompressedSize||4294967295===r.compressedSize||4294967295===r.relativeOffsetOfLocalHeader){const e=r.extraFields.find(e=>1===e.id);if(!e)return new Error("expected zip64 extended information extra field");const t=e.data;let i=0;if(4294967295===r.uncompressedSize){if(i+8>t.length)throw new Error("zip64 extended information extra field does not include uncompressed size");r.uncompressedSize=Y(t,i),i+=8}if(4294967295===r.compressedSize){if(i+8>t.length)throw new Error("zip64 extended information extra field does not include compressed size");r.compressedSize=Y(t,i),i+=8}if(4294967295===r.relativeOffsetOfLocalHeader){if(i+8>t.length)throw new Error("zip64 extended information extra field does not include relative header offset");r.relativeOffsetOfLocalHeader=Y(t,i),i+=8}}const c=r.extraFields.find(e=>28789===e.id&&e.data.length>=6&&1===e.data[0]&&Q(e.data,1),q.unsigned(r.nameBytes));if(c&&(r.fileName=Z(c.data.slice(5))),0===r.compressionMethod){let e=r.uncompressedSize;if(0!=(1&r.generalPurposeBitFlag)&&(e+=12),r.compressedSize!==e)throw new Error(`compressed size mismatch for stored file: ${r.compressedSize} != ${e}`)}l.push(r)}return{zip:{comment:n,commentBytes:a},entries:l.map(t=>new F(e,t))}}async function te(e,t){if(1&t.generalPurposeBitFlag)throw new Error("encrypted entries not supported");const r=await G(e,t.relativeOffsetOfLocalHeader,30),i=await e.getLength(),n=Q(r,0);if(67324752!==n)throw new Error(`invalid local file header signature: 0x${n.toString(16)}`);const a=W(r,26),o=W(r,28),s=t.relativeOffsetOfLocalHeader+r.length+a+o;let l;if(0===t.compressionMethod)l=!1;else{if(8!==t.compressionMethod)throw new Error(`unsupported compression method: ${t.compressionMethod}`);l=!0}const u=s,c=u+t.compressedSize;if(0!==t.compressedSize&&c>i)throw new Error(`file data overflows file bounds: ${u} +  ${t.compressedSize}  > ${i}`);return{decompress:l,fileDataStart:u}}async function re(e){let t;if("undefined"!=typeof Blob&&e instanceof Blob)t=new c(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new u(e);else if(s(e)||s(e.buffer))t=new u(e);else if("string"==typeof e){const r=await fetch(e);if(!r.ok)throw new Error(`failed http request ${e}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();t=new c(i)}else{if("function"!=typeof e.getLength||"function"!=typeof e.read)throw new Error("unsupported source type");t=e}const r=await t.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await async function(e,t){const r=Math.min(U+V,t),i=t-r,n=await G(e,i,r);for(let t=r-U;t>=0;--t){if(Q(n,t)!==j)continue;const r=new Uint8Array(n.buffer,n.byteOffset+t,n.byteLength-t),a=W(r,4);if(0!==a)throw new Error(`multi-volume zip files are not supported. This is volume: ${a}`);const o=W(r,10),s=Q(r,12),l=Q(r,16),u=W(r,20),c=r.length-U;if(u!==c)throw new Error(`invalid comment length. expected: ${c}, actual: ${u}`);const h=new Uint8Array(r.buffer,r.byteOffset+22,u),d=Z(h);return 65535===o||4294967295===l?await J(e,i+t,d,h):await ee(e,l,s,o,d,h)}throw new Error("could not find end of central directory. maybe not zip file")}(t,r)}async function ie(e){const{zip:t,entries:r}=await re(e);return{zip:t,entries:Object.fromEntries(r.map(e=>[e.name,e]))}}}).call(this,r(56),r(68)(e))},function(e,t,r){var i;!function(n,a){"use strict";var o="model",s="name",l="type",u="vendor",c="version",h="mobile",d="tablet",p="smarttv",f=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},_=function(e,t){return"string"==typeof e&&-1!==m(t).indexOf(m(e))},m=function(e){return e.toLowerCase()},v=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),void 0===t?e:e.substring(0,255)},y=function(e,t){for(var r,i,n,a,o,s,l=0;l<t.length&&!o;){var u=t[l],c=t[l+1];for(r=i=0;r<u.length&&!o;)if(o=u[r++].exec(e))for(n=0;n<c.length;n++)s=o[++i],"object"==typeof(a=c[n])&&a.length>0?2===a.length?"function"==typeof a[1]?this[a[0]]=a[1].call(this,s):this[a[0]]=a[1]:3===a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?this[a[0]]=s?s.replace(a[1],a[2]):void 0:this[a[0]]=s?a[1].call(this,s,a[2]):void 0:4===a.length&&(this[a[0]]=s?a[3].call(this,s.replace(a[1],a[2])):void 0):this[a]=s||void 0;l+=2}},g=function(e,t){for(var r in t)if("object"==typeof t[r]&&t[r].length>0){for(var i=0;i<t[r].length;i++)if(_(t[r][i],e))return"?"===r?void 0:r}else if(_(t[r],e))return"?"===r?void 0:r;return e},b={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},w={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[c,[s,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[c,[s,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[s,c],[/opios[\/ ]+([\w\.]+)/i],[c,[s,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[c,[s,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[s,c],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[c,[s,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[c,[s,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[c,[s,"WeChat"]],[/konqueror\/([\w\.]+)/i],[c,[s,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[c,[s,"IE"]],[/yabrowser\/([\w\.]+)/i],[c,[s,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[s,/(.+)/,"$1 Secure Browser"],c],[/\bfocus\/([\w\.]+)/i],[c,[s,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[c,[s,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[c,[s,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[c,[s,"Dolphin"]],[/coast\/([\w\.]+)/i],[c,[s,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[c,[s,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[c,[s,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[s,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[s,/(.+)/,"$1 Browser"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[s,/_/g," "],c],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[s,c],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[s],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[s,"Facebook"],c],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[s,c],[/\bgsa\/([\w\.]+) .*safari\//i],[c,[s,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[c,[s,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[s,"Chrome WebView"],c],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[c,[s,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[s,c],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[c,[s,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[c,s],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[s,[c,g,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[s,c],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[s,"Netscape"],c],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[c,[s,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[s,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",m]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",m]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",m]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[o,[u,"Samsung"],[l,d]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[o,[u,"Samsung"],[l,h]],[/\((ip(?:hone|od)[\w ]*);/i],[o,[u,"Apple"],[l,h]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[o,[u,"Apple"],[l,d]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[o,[u,"Huawei"],[l,d]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[o,[u,"Huawei"],[l,h]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[o,/_/g," "],[u,"Xiaomi"],[l,h]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[o,/_/g," "],[u,"Xiaomi"],[l,d]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[o,[u,"OPPO"],[l,h]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[o,[u,"Vivo"],[l,h]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[o,[u,"Realme"],[l,h]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[o,[u,"Motorola"],[l,h]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[o,[u,"Motorola"],[l,d]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[o,[u,"LG"],[l,d]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[o,[u,"LG"],[l,h]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[o,[u,"Lenovo"],[l,d]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[o,/_/g," "],[u,"Nokia"],[l,h]],[/(pixel c)\b/i],[o,[u,"Google"],[l,d]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[o,[u,"Google"],[l,h]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[u,"Sony"],[l,h]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[o,"Xperia Tablet"],[u,"Sony"],[l,d]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[o,[u,"OnePlus"],[l,h]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[o,[u,"Amazon"],[l,d]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[o,/(.+)/g,"Fire Phone $1"],[u,"Amazon"],[l,h]],[/(playbook);[-\w\),; ]+(rim)/i],[o,u,[l,d]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[o,[u,"BlackBerry"],[l,h]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[o,[u,"ASUS"],[l,d]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[o,[u,"ASUS"],[l,h]],[/(nexus 9)/i],[o,[u,"HTC"],[l,d]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[u,[o,/_/g," "],[l,h]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[o,[u,"Acer"],[l,d]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[o,[u,"Meizu"],[l,h]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[o,[u,"Sharp"],[l,h]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,o,[l,h]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,o,[l,d]],[/(surface duo)/i],[o,[u,"Microsoft"],[l,d]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[o,[u,"Fairphone"],[l,h]],[/(u304aa)/i],[o,[u,"AT&T"],[l,h]],[/\bsie-(\w*)/i],[o,[u,"Siemens"],[l,h]],[/\b(rct\w+) b/i],[o,[u,"RCA"],[l,d]],[/\b(venue[\d ]{2,7}) b/i],[o,[u,"Dell"],[l,d]],[/\b(q(?:mv|ta)\w+) b/i],[o,[u,"Verizon"],[l,d]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[o,[u,"Barnes & Noble"],[l,d]],[/\b(tm\d{3}\w+) b/i],[o,[u,"NuVision"],[l,d]],[/\b(k88) b/i],[o,[u,"ZTE"],[l,d]],[/\b(nx\d{3}j) b/i],[o,[u,"ZTE"],[l,h]],[/\b(gen\d{3}) b.+49h/i],[o,[u,"Swiss"],[l,h]],[/\b(zur\d{3}) b/i],[o,[u,"Swiss"],[l,d]],[/\b((zeki)?tb.*\b) b/i],[o,[u,"Zeki"],[l,d]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],o,[l,d]],[/\b(ns-?\w{0,9}) b/i],[o,[u,"Insignia"],[l,d]],[/\b((nxa|next)-?\w{0,9}) b/i],[o,[u,"NextBook"],[l,d]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],o,[l,h]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],o,[l,h]],[/\b(ph-1) /i],[o,[u,"Essential"],[l,h]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[o,[u,"Envizen"],[l,d]],[/\b(trio[-\w\. ]+) b/i],[o,[u,"MachSpeed"],[l,d]],[/\btu_(1491) b/i],[o,[u,"Rotor"],[l,d]],[/(shield[\w ]+) b/i],[o,[u,"Nvidia"],[l,d]],[/(sprint) (\w+)/i],[u,o,[l,h]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[u,"Microsoft"],[l,h]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[o,[u,"Zebra"],[l,d]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[o,[u,"Zebra"],[l,h]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,o,[l,"console"]],[/droid.+; (shield) bui/i],[o,[u,"Nvidia"],[l,"console"]],[/(playstation [345portablevi]+)/i],[o,[u,"Sony"],[l,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[o,[u,"Microsoft"],[l,"console"]],[/smart-tv.+(samsung)/i],[u,[l,p]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[u,"Samsung"],[l,p]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,"LG"],[l,p]],[/(apple) ?tv/i],[u,[o,"Apple TV"],[l,p]],[/crkey/i],[[o,"Chromecast"],[u,"Google"],[l,p]],[/droid.+aft(\w)( bui|\))/i],[o,[u,"Amazon"],[l,p]],[/\(dtv[\);].+(aquos)/i],[o,[u,"Sharp"],[l,p]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[u,v],[o,v],[l,p]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,p]],[/((pebble))app/i],[u,o,[l,"wearable"]],[/droid.+; (glass) \d/i],[o,[u,"Google"],[l,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[o,[u,"Zebra"],[l,"wearable"]],[/(quest( 2)?)/i],[o,[u,"Facebook"],[l,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[l,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[o,[l,h]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[o,[l,d]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,d]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[l,h]],[/(android[-\w\. ]{0,9});.+buil/i],[o,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[c,[s,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[c,[s,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[s,c],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[c,s]],os:[[/microsoft (windows) (vista|xp)/i],[s,c],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[s,[c,g,b]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[s,"Windows"],[c,g,b]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[c,/_/g,"."],[s,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[s,"Mac OS"],[c,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[c,s],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[s,c],[/\(bb(10);/i],[c,[s,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[c,[s,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[c,[s,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[c,[s,"webOS"]],[/crkey\/([\d\.]+)/i],[c,[s,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[s,"Chromium OS"],c],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[s,c],[/(sunos) ?([\w\.\d]*)/i],[[s,"Solaris"],c],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[s,c]]},x=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof x))return new x(e,t).getResult();var r=e||(void 0!==n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),i=t?function(e,t){var r={};for(var i in e)t[i]&&t[i].length%2==0?r[i]=t[i].concat(e[i]):r[i]=e[i];return r}(w,t):w;return this.getBrowser=function(){var e={name:void 0,version:void 0};return y.call(e,r,i.browser),e.major=function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0}(e.version),e},this.getCPU=function(){var e={architecture:void 0};return y.call(e,r,i.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return y.call(e,r,i.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return y.call(e,r,i.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return y.call(e,r,i.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r="string"==typeof e&&e.length>255?v(e,255):e,this},this.setUA(r),this};x.VERSION="1.0.2",x.BROWSER=f([s,c,"major"]),x.CPU=f(["architecture"]),x.DEVICE=f([o,u,l,"console",h,p,d,"wearable","embedded"]),x.ENGINE=x.OS=f([s,c]),void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=x),t.UAParser=x):r(122)?void 0===(i=function(){return x}.call(t,r,t,e))||(e.exports=i):void 0!==n&&(n.UAParser=x);var M=void 0!==n&&(n.jQuery||n.Zepto);if(M&&!M.ua){var E=new x;M.ua=E.getResult(),M.ua.get=function(){return E.getUA()},M.ua.set=function(e){E.setUA(e);var t=E.getResult();for(var r in t)M.ua[r]=t[r]}}}("object"==typeof window?window:this)},function(e,t,r){"use strict";(function(e){var r=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var r=-1;return e.some(function(e,i){return e[0]===t&&(r=i,!0)}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var r=e(this.__entries__,t),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(t,r){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=r:this.__entries__.push([t,r])},t.prototype.delete=function(t){var r=this.__entries__,i=e(r,t);~i&&r.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var r=0,i=this.__entries__;r<i.length;r++){var n=i[r];e.call(t,n[1],n[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n=void 0!==e&&e.Math===Math?e:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),a="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)},o=2;var s=20,l=["top","right","bottom","left","width","height","size","weight"],u="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var r=!1,i=!1,n=0;function s(){r&&(r=!1,e()),i&&u()}function l(){a(s)}function u(){var e=Date.now();if(r){if(e-n<o)return;i=!0}else r=!0,i=!1,setTimeout(l,t);n=e}return u}(this.refresh.bind(this),s)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,r=t.indexOf(e);~r&&t.splice(r,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return e.forEach(function(e){return e.broadcastActive()}),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),u?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,r=void 0===t?"":t;l.some(function(e){return!!~r.indexOf(e)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),h=function(e,t){for(var r=0,i=Object.keys(t);r<i.length;r++){var n=i[r];Object.defineProperty(e,n,{value:t[n],enumerable:!1,writable:!1,configurable:!0})}return e},d=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},p=g(0,0,0,0);function f(e){return parseFloat(e)||0}function _(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(t,r){return t+f(e["border-"+r+"-width"])},0)}function m(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return p;var i=d(e).getComputedStyle(e),n=function(e){for(var t={},r=0,i=["top","right","bottom","left"];r<i.length;r++){var n=i[r],a=e["padding-"+n];t[n]=f(a)}return t}(i),a=n.left+n.right,o=n.top+n.bottom,s=f(i.width),l=f(i.height);if("border-box"===i.boxSizing&&(Math.round(s+a)!==t&&(s-=_(i,"left","right")+a),Math.round(l+o)!==r&&(l-=_(i,"top","bottom")+o)),!function(e){return e===d(e).document.documentElement}(e)){var u=Math.round(s+a)-t,c=Math.round(l+o)-r;1!==Math.abs(u)&&(s-=u),1!==Math.abs(c)&&(l-=c)}return g(n.left,n.top,s,l)}var v="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof d(e).SVGGraphicsElement}:function(e){return e instanceof d(e).SVGElement&&"function"==typeof e.getBBox};function y(e){return i?v(e)?function(e){var t=e.getBBox();return g(0,0,t.width,t.height)}(e):m(e):p}function g(e,t,r,i){return{x:e,y:t,width:r,height:i}}var b=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=y(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),w=function(){return function(e,t){var r=function(e){var t=e.x,r=e.y,i=e.width,n=e.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,o=Object.create(a.prototype);return h(o,{x:t,y:r,width:i,height:n,top:r,right:t+i,bottom:n+r,left:t}),o}(t);h(this,{target:e,contentRect:r})}}(),x=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new r,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new b(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(e){return new w(e.target,e.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),M="undefined"!=typeof WeakMap?new WeakMap:new r,E=function(){return function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=c.getInstance(),i=new x(t,r,this);M.set(this,i)}}();["observe","unobserve","disconnect"].forEach(function(e){E.prototype[e]=function(){var t;return(t=M.get(this))[e].apply(t,arguments)}});var T=void 0!==n.ResizeObserver?n.ResizeObserver:E;t.a=T}).call(this,r(63))},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i,n=r(46),a=r(28),o=r(39),s=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},l=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){e.upload=function(e,t){return s(this,void 0,void 0,function(){var r,i,s;return l(this,function(l){return function(e){return"object"==typeof e&&null!==e}(t)?(r=t.onProgress,s=void 0===r?function(){}:r,(i=t.type)&&Object(a.b)(i,Object(a.g)([o.b.File,o.b.Dwg,o.b.Img,o.b.Wbs,o.b.ModelConvertedPdf,o.b.Image360]),"asset type not supported"),[2,Object(n.d)(e,i,s)]):(s=t||function(){},[2,Object(n.d)(e,null,s)])})})},e.get=function(e){return s(this,void 0,void 0,function(){return l(this,function(t){return[2,Object(n.b)(e)]})})},e.remove=function(e){return s(this,void 0,void 0,function(){return l(this,function(t){return[2,Object(n.a)(e)]})})},e.update=function(e,t){return s(this,void 0,void 0,function(){return l(this,function(r){return[2,Object(n.c)(e,t)]})})}}(i||(i={}))},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateModelRenderSetting"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Id"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"enhancedRendering"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acceleratedRendering"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"architectEffect"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"penDetail"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"inkContrast"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"blackAndWhite"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shadow"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"brightness"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"latitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"longitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"materials"}},type:{kind:"NamedType",name:{kind:"Name",value:"JSONObject"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundMode"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundColor"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundImage"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reflectionImage"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shader"}},type:{kind:"NamedType",name:{kind:"Name",value:"ModelShaderSetting"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateModelSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"enhancedRendering"},value:{kind:"Variable",name:{kind:"Name",value:"enhancedRendering"}}},{kind:"Argument",name:{kind:"Name",value:"acceleratedRendering"},value:{kind:"Variable",name:{kind:"Name",value:"acceleratedRendering"}}},{kind:"Argument",name:{kind:"Name",value:"architectEffect"},value:{kind:"Variable",name:{kind:"Name",value:"architectEffect"}}},{kind:"Argument",name:{kind:"Name",value:"penDetail"},value:{kind:"Variable",name:{kind:"Name",value:"penDetail"}}},{kind:"Argument",name:{kind:"Name",value:"inkContrast"},value:{kind:"Variable",name:{kind:"Name",value:"inkContrast"}}},{kind:"Argument",name:{kind:"Name",value:"blackAndWhite"},value:{kind:"Variable",name:{kind:"Name",value:"blackAndWhite"}}},{kind:"Argument",name:{kind:"Name",value:"shadow"},value:{kind:"Variable",name:{kind:"Name",value:"shadow"}}},{kind:"Argument",name:{kind:"Name",value:"brightness"},value:{kind:"Variable",name:{kind:"Name",value:"brightness"}}},{kind:"Argument",name:{kind:"Name",value:"latitude"},value:{kind:"Variable",name:{kind:"Name",value:"latitude"}}},{kind:"Argument",name:{kind:"Name",value:"longitude"},value:{kind:"Variable",name:{kind:"Name",value:"longitude"}}},{kind:"Argument",name:{kind:"Name",value:"materials"},value:{kind:"Variable",name:{kind:"Name",value:"materials"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundMode"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundMode"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundColor"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundColor"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundImage"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundImage"}}},{kind:"Argument",name:{kind:"Name",value:"reflectionImage"},value:{kind:"Variable",name:{kind:"Name",value:"reflectionImage"}}},{kind:"Argument",name:{kind:"Name",value:"shader"},value:{kind:"Variable",name:{kind:"Name",value:"shader"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filter"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enhancedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"acceleratedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"architectEffect"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"penDetail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inkContrast"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"blackAndWhite"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shadow"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"brightness"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"latitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"longitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"materials"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reflectionImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shader"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:1635}};r.loc.source={body:"mutation UpdateModelRenderSetting(\n    $id: Int!\n    $modelId: Id\n    $name: String\n    $filter: String\n    $enhancedRendering: Boolean\n    $acceleratedRendering: Boolean\n    $architectEffect: Boolean\n    $penDetail: Float\n    $inkContrast: Float\n    $blackAndWhite: Boolean\n    $shadow: Boolean\n    $brightness: Float\n    $latitude: Float\n    $longitude: Float\n    $materials: JSONObject\n    $backgroundMode: Int\n    $backgroundColor: String\n    $backgroundImage: [String]\n    $reflectionImage: [String]\n    $shader: ModelShaderSetting\n) {\n    updateModelSettings(\n        id: $id\n        modelId: $modelId\n        name: $name\n        filter: $filter\n        enhancedRendering: $enhancedRendering\n        acceleratedRendering: $acceleratedRendering\n        architectEffect: $architectEffect\n        penDetail: $penDetail\n        inkContrast: $inkContrast\n        blackAndWhite: $blackAndWhite\n        shadow: $shadow\n        brightness: $brightness\n        latitude: $latitude\n        longitude: $longitude\n        materials: $materials\n        backgroundMode: $backgroundMode\n        backgroundColor: $backgroundColor\n        backgroundImage: $backgroundImage\n        reflectionImage: $reflectionImage\n        shader: $shader\n    ) {\n        id\n        modelId\n        name\n        filter\n        enhancedRendering\n        acceleratedRendering\n        architectEffect\n        penDetail\n        inkContrast\n        blackAndWhite\n        shadow\n        brightness\n        latitude\n        longitude\n        materials\n        backgroundMode\n        backgroundColor\n        backgroundImage\n        reflectionImage\n        shader\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateModelRenderSetting=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateModelRenderSetting")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteModelRenderSetting"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteModelSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}],loc:{start:0,end:80}};r.loc.source={body:"mutation DeleteModelRenderSetting($id: Int!) {\n  deleteModelSettings(id: $id)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.DeleteModelRenderSetting=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"DeleteModelRenderSetting")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddModelRenderSetting"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"enhancedRendering"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acceleratedRendering"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"architectEffect"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"penDetail"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"inkContrast"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"blackAndWhite"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shadow"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"brightness"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"latitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"longitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"materials"}},type:{kind:"NamedType",name:{kind:"Name",value:"JSONObject"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundMode"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundColor"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"backgroundImage"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reflectionImage"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shader"}},type:{kind:"NamedType",name:{kind:"Name",value:"ModelShaderSetting"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addModelSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"enhancedRendering"},value:{kind:"Variable",name:{kind:"Name",value:"enhancedRendering"}}},{kind:"Argument",name:{kind:"Name",value:"acceleratedRendering"},value:{kind:"Variable",name:{kind:"Name",value:"acceleratedRendering"}}},{kind:"Argument",name:{kind:"Name",value:"architectEffect"},value:{kind:"Variable",name:{kind:"Name",value:"architectEffect"}}},{kind:"Argument",name:{kind:"Name",value:"penDetail"},value:{kind:"Variable",name:{kind:"Name",value:"penDetail"}}},{kind:"Argument",name:{kind:"Name",value:"inkContrast"},value:{kind:"Variable",name:{kind:"Name",value:"inkContrast"}}},{kind:"Argument",name:{kind:"Name",value:"blackAndWhite"},value:{kind:"Variable",name:{kind:"Name",value:"blackAndWhite"}}},{kind:"Argument",name:{kind:"Name",value:"shadow"},value:{kind:"Variable",name:{kind:"Name",value:"shadow"}}},{kind:"Argument",name:{kind:"Name",value:"brightness"},value:{kind:"Variable",name:{kind:"Name",value:"brightness"}}},{kind:"Argument",name:{kind:"Name",value:"latitude"},value:{kind:"Variable",name:{kind:"Name",value:"latitude"}}},{kind:"Argument",name:{kind:"Name",value:"longitude"},value:{kind:"Variable",name:{kind:"Name",value:"longitude"}}},{kind:"Argument",name:{kind:"Name",value:"materials"},value:{kind:"Variable",name:{kind:"Name",value:"materials"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundMode"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundMode"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundColor"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundColor"}}},{kind:"Argument",name:{kind:"Name",value:"backgroundImage"},value:{kind:"Variable",name:{kind:"Name",value:"backgroundImage"}}},{kind:"Argument",name:{kind:"Name",value:"reflectionImage"},value:{kind:"Variable",name:{kind:"Name",value:"reflectionImage"}}},{kind:"Argument",name:{kind:"Name",value:"shader"},value:{kind:"Variable",name:{kind:"Name",value:"shader"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filter"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enhancedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"acceleratedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"architectEffect"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"penDetail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inkContrast"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"blackAndWhite"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shadow"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"brightness"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"latitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"longitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"materials"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reflectionImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shader"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:1600}};r.loc.source={body:"mutation AddModelRenderSetting(\n    $modelId: Id!\n    $name: String\n    $filter: String\n    $enhancedRendering: Boolean\n    $acceleratedRendering: Boolean\n    $architectEffect: Boolean\n    $penDetail: Float\n    $inkContrast: Float\n    $blackAndWhite: Boolean\n    $shadow: Boolean\n    $brightness: Float\n    $latitude: Float\n    $longitude: Float\n    $materials: JSONObject\n    $backgroundMode: Int\n    $backgroundColor: String\n    $backgroundImage: [String]\n    $reflectionImage: [String]\n    $shader: ModelShaderSetting\n) {\n    addModelSettings(\n        modelId: $modelId\n        name: $name\n        filter: $filter\n        enhancedRendering: $enhancedRendering\n        acceleratedRendering: $acceleratedRendering\n        architectEffect: $architectEffect\n        penDetail: $penDetail\n        inkContrast: $inkContrast\n        blackAndWhite: $blackAndWhite\n        shadow: $shadow\n        brightness: $brightness\n        latitude: $latitude\n        longitude: $longitude\n        materials: $materials\n        backgroundMode: $backgroundMode\n        backgroundColor: $backgroundColor\n        backgroundImage: $backgroundImage\n        reflectionImage: $reflectionImage\n        shader: $shader\n    ) {\n        id\n        modelId\n        name\n        filter\n        enhancedRendering\n        acceleratedRendering\n        architectEffect\n        penDetail\n        inkContrast\n        blackAndWhite\n        shadow\n        brightness\n        latitude\n        longitude\n        materials\n        backgroundMode\n        backgroundColor\n        backgroundImage\n        reflectionImage\n        shader\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.AddModelRenderSetting=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"AddModelRenderSetting")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelRenderSetting"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"settings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filter"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enhancedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"acceleratedRendering"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"architectEffect"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"penDetail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inkContrast"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"blackAndWhite"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shadow"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"brightness"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"latitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"longitude"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"materials"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reflectionImage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shader"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:590}};r.loc.source={body:"query GetModelRenderSetting($modelId: Id!) {\n    model(id: $modelId) {\n        id\n        settings {\n            id\n            name\n            modelId\n            filter\n            enhancedRendering\n            acceleratedRendering\n            architectEffect\n            penDetail\n            inkContrast\n            blackAndWhite\n            shadow\n            brightness\n            latitude\n            longitude\n            materials\n            backgroundMode\n            backgroundColor\n            backgroundImage\n            reflectionImage\n            shader\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelRenderSetting=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelRenderSetting")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteModelSelectionSet"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteModelSelectionSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}],loc:{start:0,end:85}};r.loc.source={body:"mutation DeleteModelSelectionSet($id: Int!) {\n    deleteModelSelectionSet(id: $id)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.DeleteModelSelectionSet=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"DeleteModelSelectionSet")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateModelSelectionSet"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIds"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateModelSelectionSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"elementIds"},value:{kind:"Variable",name:{kind:"Name",value:"elementIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"elementIds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:264}};r.loc.source={body:"mutation UpdateModelSelectionSet($id: Int!, $name: String, $elementIds: [String]) {\n    updateModelSelectionSet(id: $id, name: $name, elementIds: $elementIds) {\n        id\n        name\n        modelId\n        elementIds\n        createdAt\n        updatedAt\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateModelSelectionSet=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateModelSelectionSet")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelSelectionSets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelSelectionSets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"elementIds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:248}};r.loc.source={body:"query GetModelSelectionSets($modelId: Id!) {\n    model(id: $modelId) {\n        id\n        modelSelectionSets {\n            id\n            name\n            modelId\n            elementIds\n            createdAt\n            updatedAt\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelSelectionSets=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelSelectionSets")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddModelSelectionSet"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addModelSelectionSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"elementIds"},value:{kind:"Variable",name:{kind:"Name",value:"elementIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"elementIds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:274}};r.loc.source={body:"mutation AddModelSelectionSet($name: String!, $modelId: Id!, $elementIds: [String]!) {\n    addModelSelectionSet(name: $name, modelId: $modelId, elementIds: $elementIds) {\n        id\n        name\n        modelId\n        elementIds\n        createdAt\n        updatedAt\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.AddModelSelectionSet=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"AddModelSelectionSet")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateModelComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"plainText"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateModelComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"message"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}},{kind:"Argument",name:{kind:"Name",value:"plainText"},value:{kind:"Variable",name:{kind:"Name",value:"plainText"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bimdata"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"camera"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"plainText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:293}};r.loc.source={body:"mutation UpdateModelComment($id: Int!, $message: String!, $plainText: String!) {\n    updateModelComment(id: $id, message: $message, plainText: $plainText) {\n        id\n        bimdata\n        camera\n        modelId\n        message\n        plainText\n        createdAt\n        updatedAt\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateModelComment=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateModelComment")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteModelComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteModelComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}}],loc:{start:0,end:75}};r.loc.source={body:"mutation DeleteModelComment($id: Int!) {\n    deleteModelComment(id: $id)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.DeleteModelComment=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"DeleteModelComment")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bimdata"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"camera"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"plainText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:279}};r.loc.source={body:"query GetModelComment($commentId: Int!) {\n    modelComment(id: $commentId) {\n        id\n        bimdata\n        camera\n        modelId\n        message\n        plainText\n        createdAt\n        updatedAt\n        createdBy {\n            id\n            username\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelComment=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelComment")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelComments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelComments"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bimdata"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"camera"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"plainText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:281}};r.loc.source={body:"query GetModelComments($modelId: Id!) {\n    modelComments(modelId: $modelId) {\n        id\n        bimdata\n        camera\n        modelId\n        message\n        plainText\n        createdAt\n        updatedAt\n        createdBy {\n            id\n            username\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelComments=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelComments")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"BatchUpdateProperty"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"strValueArr"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"numValueArr"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Float"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"batchUpdateProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"docAndCatIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"elementIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"propertyArr"},value:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}}},{kind:"Argument",name:{kind:"Name",value:"strValueArr"},value:{kind:"Variable",name:{kind:"Name",value:"strValueArr"}}},{kind:"Argument",name:{kind:"Name",value:"numValueArr"},value:{kind:"Variable",name:{kind:"Name",value:"numValueArr"}}}],directives:[]}]}}],loc:{start:0,end:386}};r.loc.source={body:"mutation BatchUpdateProperty(\n  $modelId: Id!\n  $docAndCatIdArr: [Int]!\n  $elementIdArr: [Int]!\n  $propertyArr: [String]!\n  $strValueArr: [String]\n  $numValueArr: [Float]\n) {\n  batchUpdateProperties(\n    modelId: $modelId\n    docAndCatIdArr: $docAndCatIdArr\n    elementIdArr: $elementIdArr\n    propertyArr: $propertyArr\n    strValueArr: $strValueArr\n    numValueArr: $numValueArr\n  )\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.BatchUpdateProperty=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"BatchUpdateProperty")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateElementProperty"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"docAndCatId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"property"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"strValue"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"numValue"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updatePropertyValue"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"docAndCatId"},value:{kind:"Variable",name:{kind:"Name",value:"docAndCatId"}}},{kind:"Argument",name:{kind:"Name",value:"elementId"},value:{kind:"Variable",name:{kind:"Name",value:"elementId"}}},{kind:"Argument",name:{kind:"Name",value:"property"},value:{kind:"Variable",name:{kind:"Name",value:"property"}}},{kind:"Argument",name:{kind:"Name",value:"strValue"},value:{kind:"Variable",name:{kind:"Name",value:"strValue"}}},{kind:"Argument",name:{kind:"Name",value:"numValue"},value:{kind:"Variable",name:{kind:"Name",value:"numValue"}}}],directives:[]}]}}],loc:{start:0,end:371}};r.loc.source={body:"mutation UpdateElementProperty(\n    $modelId: Id!\n    $docAndCatId: Int!\n    $elementId: Int!\n    $property: String!\n    $strValue: String\n    $numValue: Float\n) {\n    updatePropertyValue(\n        modelId: $modelId\n        docAndCatId: $docAndCatId\n        elementId: $elementId\n        property: $property\n        strValue: $strValue\n        numValue: $numValue\n    )\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateElementProperty=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateElementProperty")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"InitElementProperty"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"property"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"strValue"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"numValue"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initModelElementProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"property"},value:{kind:"Variable",name:{kind:"Name",value:"property"}}},{kind:"Argument",name:{kind:"Name",value:"strValue"},value:{kind:"Variable",name:{kind:"Name",value:"strValue"}}},{kind:"Argument",name:{kind:"Name",value:"numValue"},value:{kind:"Variable",name:{kind:"Name",value:"numValue"}}}],directives:[]}]}}],loc:{start:0,end:218}};r.loc.source={body:"mutation InitElementProperty($modelId: Id!, $property: String!, $strValue: String, $numValue: Float) {\n    initModelElementProperties(modelId: $modelId, property: $property, strValue: $strValue, numValue: $numValue)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.InitElementProperty=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"InitElementProperty")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"BatchGetProperties"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"batchGetElementProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"elementIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"propertyArr"},value:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"elementIdArr"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"properties"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"property"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"strValues"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numValues"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:322}};r.loc.source={body:"query BatchGetProperties($modelId: Id!, $elementIdArr: [Int]!, $propertyArr: [String]!) {\n    batchGetElementProperties(modelId: $modelId, elementIdArr: $elementIdArr, propertyArr: $propertyArr) {\n        elementIdArr\n        properties {\n            property\n            strValues\n            numValues\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.BatchGetProperties=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"BatchGetProperties")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"BatchAddProperty"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"strValueArr"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"numValueArr"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Float"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"batchAddProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"docAndCatIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"docAndCatIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"elementIdArr"},value:{kind:"Variable",name:{kind:"Name",value:"elementIdArr"}}},{kind:"Argument",name:{kind:"Name",value:"propertyArr"},value:{kind:"Variable",name:{kind:"Name",value:"propertyArr"}}},{kind:"Argument",name:{kind:"Name",value:"strValueArr"},value:{kind:"Variable",name:{kind:"Name",value:"strValueArr"}}},{kind:"Argument",name:{kind:"Name",value:"numValueArr"},value:{kind:"Variable",name:{kind:"Name",value:"numValueArr"}}}],directives:[]}]}}],loc:{start:0,end:380}};r.loc.source={body:"mutation BatchAddProperty(\n  $modelId: Id!\n  $docAndCatIdArr: [Int]!\n  $elementIdArr: [Int]!\n  $propertyArr: [String]!\n  $strValueArr: [String]\n  $numValueArr: [Float]\n) {\n  batchAddProperties(\n    modelId: $modelId\n    docAndCatIdArr: $docAndCatIdArr\n    elementIdArr: $elementIdArr\n    propertyArr: $propertyArr\n    strValueArr: $strValueArr\n    numValueArr: $numValueArr\n  )\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.BatchAddProperty=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"BatchAddProperty")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetElementProperties"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"docAndCatId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"elementId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"elementProperties"},arguments:[{kind:"Argument",name:{kind:"Name",value:"docAndCatId"},value:{kind:"Variable",name:{kind:"Name",value:"docAndCatId"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"elementId"},value:{kind:"Variable",name:{kind:"Name",value:"elementId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"property"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"strValue"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numValue"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:234}};r.loc.source={body:"query GetElementProperties($docAndCatId: Int!, $modelId: Id!, $elementId: Int!) {\n    elementProperties(docAndCatId: $docAndCatId, modelId: $modelId, elementId: $elementId) {\n        property\n        strValue\n        numValue\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetElementProperties=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetElementProperties")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadAssetSuccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadAssetSuccess"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"assetId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"folderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filenames"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:282}};r.loc.source={body:"mutation UploadAssetSuccess($assetId: Int!) {\n  uploadAssetSuccess(id: $assetId) {\n    id\n    name\n    folderId\n    type\n    status\n    filenames\n    downloadUrls {\n        filename\n        url\n    }\n    createdBy {\n        id\n      username\n    }\n    createdAt\n    updatedAt\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UploadAssetSuccess=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UploadAssetSuccess")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"assetId"}}}],directives:[]}]}}],loc:{start:0,end:69}};r.loc.source={body:"mutation DeleteAsset($assetId: Int!) {\n  deleteAsset(id: $assetId)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.DeleteAsset=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"DeleteAsset")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"assetId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:147}};r.loc.source={body:"mutation UpdateAsset($assetId: Int!, $name: String, $folderId: Int) {\n  updateAsset(id: $assetId, name: $name, folderId: $folderId) {\n    id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateAsset=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateAsset")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fileNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"type"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AssetType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"assetName"}}},{kind:"Argument",name:{kind:"Name",value:"filenames"},value:{kind:"Variable",name:{kind:"Name",value:"fileNames"}}},{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"Variable",name:{kind:"Name",value:"type"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uploadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:261}};r.loc.source={body:"mutation UploadAsset(\n  $folderId: Int\n  $assetName: String!\n  $fileNames: [String]!\n  $type: AssetType!\n) {\n  uploadAsset(folderId: $folderId, name: $assetName, filenames: $fileNames, type: $type) {\n    id\n    uploadUrls {\n      filename\n      url\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UploadAsset=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UploadAsset")},function(e,t,r){"use strict";let i=r(125);e.exports=new i(r(124),r(123))},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAssetFolder"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"projects"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assetFolder"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:145}};r.loc.source={body:"query GetAssetFolder {\n    user {\n        projects {\n            id\n            assetFolder {\n                id\n            }\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetAssetFolder=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetAssetFolder")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelFolder"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"projects"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelFolder"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:145}};r.loc.source={body:"query GetModelFolder {\n    user {\n        projects {\n            id\n            modelFolder {\n                id\n            }\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelFolder=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelFolder")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.print=function(e){return(0,i.visit)(e,{leave:a})};var i=r(35),n=r(126);var a={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return s(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,r=e.name,i=u("(",s(e.variableDefinitions,", "),")"),n=s(e.directives," "),a=e.selectionSet;return r||n||i||"query"!==t?s([t,s([r,i]),n,a]," "):a},VariableDefinition:function(e){var t=e.variable,r=e.type,i=e.defaultValue,n=e.directives;return t+": "+r+u(" = ",i)+u(" ",s(n," "))},SelectionSet:function(e){return l(e.selections)},Field:function(e){var t=e.alias,r=e.name,i=e.arguments,n=e.directives,a=e.selectionSet;return s([u("",t,": ")+r+u("(",s(i,", "),")"),s(n," "),a]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+u(" ",s(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,r=e.directives,i=e.selectionSet;return s(["...",u("on ",t),s(r," "),i]," ")},FragmentDefinition:function(e){var t=e.name,r=e.typeCondition,i=e.variableDefinitions,n=e.directives,a=e.selectionSet;return"fragment ".concat(t).concat(u("(",s(i,", "),")")," ")+"on ".concat(r," ").concat(u("",s(n," ")," "))+a},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var r=e.value;return e.block?(0,n.printBlockString)(r,"description"===t?"":"  "):JSON.stringify(r)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+s(e.values,", ")+"]"},ObjectValue:function(e){return"{"+s(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+u("(",s(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:function(e){var t=e.directives,r=e.operationTypes;return s(["schema",s(t," "),l(r)]," ")},OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:o(function(e){return s(["scalar",e.name,s(e.directives," ")]," ")}),ObjectTypeDefinition:o(function(e){var t=e.name,r=e.interfaces,i=e.directives,n=e.fields;return s(["type",t,u("implements ",s(r," & ")),s(i," "),l(n)]," ")}),FieldDefinition:o(function(e){var t=e.name,r=e.arguments,i=e.type,n=e.directives;return t+(d(r)?u("(\n",c(s(r,"\n")),"\n)"):u("(",s(r,", "),")"))+": "+i+u(" ",s(n," "))}),InputValueDefinition:o(function(e){var t=e.name,r=e.type,i=e.defaultValue,n=e.directives;return s([t+": "+r,u("= ",i),s(n," ")]," ")}),InterfaceTypeDefinition:o(function(e){var t=e.name,r=e.directives,i=e.fields;return s(["interface",t,s(r," "),l(i)]," ")}),UnionTypeDefinition:o(function(e){var t=e.name,r=e.directives,i=e.types;return s(["union",t,s(r," "),i&&0!==i.length?"= "+s(i," | "):""]," ")}),EnumTypeDefinition:o(function(e){var t=e.name,r=e.directives,i=e.values;return s(["enum",t,s(r," "),l(i)]," ")}),EnumValueDefinition:o(function(e){return s([e.name,s(e.directives," ")]," ")}),InputObjectTypeDefinition:o(function(e){var t=e.name,r=e.directives,i=e.fields;return s(["input",t,s(r," "),l(i)]," ")}),DirectiveDefinition:o(function(e){var t=e.name,r=e.arguments,i=e.repeatable,n=e.locations;return"directive @"+t+(d(r)?u("(\n",c(s(r,"\n")),"\n)"):u("(",s(r,", "),")"))+(i?" repeatable":"")+" on "+s(n," | ")}),SchemaExtension:function(e){var t=e.directives,r=e.operationTypes;return s(["extend schema",s(t," "),l(r)]," ")},ScalarTypeExtension:function(e){return s(["extend scalar",e.name,s(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,r=e.interfaces,i=e.directives,n=e.fields;return s(["extend type",t,u("implements ",s(r," & ")),s(i," "),l(n)]," ")},InterfaceTypeExtension:function(e){var t=e.name,r=e.directives,i=e.fields;return s(["extend interface",t,s(r," "),l(i)]," ")},UnionTypeExtension:function(e){var t=e.name,r=e.directives,i=e.types;return s(["extend union",t,s(r," "),i&&0!==i.length?"= "+s(i," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,r=e.directives,i=e.values;return s(["extend enum",t,s(r," "),l(i)]," ")},InputObjectTypeExtension:function(e){var t=e.name,r=e.directives,i=e.fields;return s(["extend input",t,s(r," "),l(i)]," ")}};function o(e){return function(t){return s([t.description,e(t)],"\n")}}function s(e,t){return e?e.filter(function(e){return e}).join(t||""):""}function l(e){return e&&0!==e.length?"{\n"+c(s(e,"\n"))+"\n}":""}function u(e,t,r){return t?e+t+(r||""):""}function c(e){return e&&"  "+e.replace(/\n/g,"\n  ")}function h(e){return-1!==e.indexOf("\n")}function d(e){return e&&e.some(h)}},function(e,t,r){"use strict";function i(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.d(t,"a",function(){return i})},function(e,t,r){"use strict";(function(e,i){var n,a=r(108);n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:i;var o=Object(a.a)(n);t.a=o}).call(this,r(63),r(68)(e))},function(e,t,r){e.exports=r(127).Observable},function(e,t,r){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&function(e){return function(t){return function(r,i){var n={key:r,value:t[r]},a={key:i,value:t[i]};return e(n,a)}}}(t.cmp),n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var a,o;if(Array.isArray(t)){for(o="[",a=0;a<t.length;a++)a&&(o+=","),o+=e(t[a])||"null";return o+"]"}if(null===t)return"null";if(-1!==n.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=n.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",a=0;a<l.length;a++){var u=l[a],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return n.splice(s,1),"{"+o+"}"}}(e)}},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Get3DPDFURL"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"assetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"asset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"assetId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:101}};r.loc.source={body:"query Get3DPDFURL($assetId: Int!) {\n  asset(id: $assetId) {\n    downloadUrls {\n      url\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.Get3DPDFURL=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"Get3DPDFURL")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"Generate3DPDF"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelStartConvertToPdf"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assetId"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:104}};r.loc.source={body:"mutation Generate3DPDF($modelId: Id!) {\n  modelStartConvertToPdf(modelId: $modelId) {\n    assetId\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.Generate3DPDF=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"Generate3DPDF")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddSliceModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"query"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isTerrain"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sliceModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}},{kind:"Argument",name:{kind:"Name",value:"query"},value:{kind:"Variable",name:{kind:"Name",value:"query"}}},{kind:"Argument",name:{kind:"Name",value:"isTerrain"},value:{kind:"Variable",name:{kind:"Name",value:"isTerrain"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"folderId"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:217}};r.loc.source={body:"mutation AddSliceModel($name: String!, $folderId: Int, $query: String!, $isTerrain: Boolean) {\n  sliceModel(name: $name, folderId: $folderId, query: $query, isTerrain: $isTerrain) {\n    id\n    name\n    folderId\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.AddSliceModel=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"AddSliceModel")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCombinedModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addCombinedModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"modelIds"},value:{kind:"Variable",name:{kind:"Name",value:"modelIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:191}};r.loc.source={body:"mutation AddCombinedModel($folderId: Int!, $name: String!, $modelIds: [Id]!) {\n    addCombinedModel(folderId: $folderId, name: $name, modelIds: $modelIds) {\n        id\n        status\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.AddCombinedModel=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"AddCombinedModel")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:154}};r.loc.source={body:"mutation UpdateModel($modelId: Id!, $name: String, $folderId: Int) {\n    updateModel(id: $modelId, name: $name, folderId: $folderId) {\n        id\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UpdateModel=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UpdateModel")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSuccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadModelSuccess"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"folderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"targetModelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"version"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"convertedUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:442}};r.loc.source={body:"mutation UploadModelSuccess($modelId: Id!) {\n    uploadModelSuccess(id: $modelId) {\n        id\n        folderId\n        targetModelId\n        type\n        name\n        status\n        version\n        createdBy {\n            id\n            username\n        }\n        createdAt\n        updatedAt\n        downloadUrls {\n            filename\n            url\n        }\n        convertedUrls {\n            filename\n            url\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UploadModelSuccess=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UploadModelSuccess")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filenames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cvtOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"filenames"},value:{kind:"Variable",name:{kind:"Name",value:"filenames"}}},{kind:"Argument",name:{kind:"Name",value:"cvtOptions"},value:{kind:"Variable",name:{kind:"Name",value:"cvtOptions"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uploadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:287}};r.loc.source={body:"mutation UploadModel($folderId: Int!, $name: String!, $filenames: [String]!, $cvtOptions: String) {\n    uploadModel(folderId: $folderId, name: $name, filenames: $filenames, cvtOptions: $cvtOptions) {\n        id\n        uploadUrls {\n            filename\n            url\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.UploadModel=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"UploadModel")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}}],loc:{start:0,end:68}};r.loc.source={body:"mutation DeleteModel($modelId: Id!) {\n  deleteModel(id: $modelId)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.DeleteModel=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"DeleteModel")},function(e,t){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelFiles"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Id"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"convertedUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:223}};r.loc.source={body:"query GetModelFiles($modelId: Id!) {\n    model(id: $modelId) {\n        id\n        downloadUrls {\n            filename\n            url\n        }\n        convertedUrls {\n            filename\n            url\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function n(e,t){for(var r=0;r<e.definitions.length;r++){var i=e.definitions[r];if(i.name&&i.name.value==t)return i}}r.definitions.forEach(function(e){if(e.name){var t=new Set;!function e(t,r){if("FragmentSpread"===t.kind)r.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&r.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach(function(t){e(t,r)}),t.variableDefinitions&&t.variableDefinitions.forEach(function(t){e(t,r)}),t.definitions&&t.definitions.forEach(function(t){e(t,r)})}(e,t),i[e.name.value]=t}}),e.exports=r,e.exports.GetModelFiles=function(e,t){var r={kind:e.kind,definitions:[n(e,t)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;for(a.forEach(function(e){s.add(e)});s.size>0;){var l=s;s=new Set,l.forEach(function(e){o.has(e)||(o.add(e),(i[e]||new Set).forEach(function(e){s.add(e)}))})}return o.forEach(function(t){var i=n(e,t);i&&r.definitions.push(i)}),r}(r,"GetModelFiles")},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i,n=r(29),a=r(31),o=r(21),s=r(32),l=function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())})},u=function(e,t){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};!function(e){e.ElementType=o.a,e.get=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){return[2,Object(n.h)(e)]})})},e.remove=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){return[2,Object(a.a)(e)]})})},e.update=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(r){return[2,Object(a.g)(e,t)]})})},e.upload=function(e,t){return l(this,void 0,void 0,function(){var r,i,n;return u(this,function(o){return function(e){return"object"==typeof e&&null!==e}(t)?(r=t.onProgress,n=void 0===r?function(){}:r,i=t.reduceTextures,[2,Object(a.h)(e,i,n)]):(n=t||function(){},[2,Object(a.h)(e,!1,n)])})})},e.merge=function(e,t,r,i){return l(this,void 0,void 0,function(){return u(this,function(n){return[2,Object(a.f)(e,t,r,i)]})})},e.generate3DPDF=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){return[2,Object(a.b)(e)]})})},e.compare=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(r){return[2,new Promise(function(r,i){var n=new Blob(['\n        function Node(name, type) {\n            this.father   = null;\n            this.children = null;\n            this.name     = name;\n            this.type     = type;\n            this.docId    = null;\n        }\n        var extractNode = function(element, nodes) {\n            if (element.children === null) {\n                nodes.push(element.name);\n            } else {\n                for (var i = 0, len = element.children.length; i < len; i++) {\n                    extractNode(element.children[i], nodes);\n                }\n            }\n        }\n        \n        var parseGraph = function(modelGraphBin, modelBin) {\n            var byteLength = modelGraphBin.byteLength;\n            var len = byteLength / 9;\n            var index = 0;\n            var e_name, e_father, e_type;\n            var root = new Node(-1, -1);\n            root.children = [];\n            var fathers = [];\n            fathers.push(root);\n    \n            var currentDocName = 0;\n    \n            var elements = [];\n            for (var i = 0; i < len; i++) {\n                var data = new Uint8Array(modelGraphBin, i * 9, 9);\n                e_name   = ((data[3] << 24) | (data[2] << 16) | (data[1] << 8) | data[0]);\n                e_father = ((data[7] << 24) | (data[6] << 16) | (data[5] << 8) | data[4]);\n                e_type   = data[8];\n                \n                while (fathers.length > 0 && fathers[fathers.length - 1].name !== e_father) {\n                    fathers.pop();\n                }\n                if (fathers.length === 0) {\n                    postMessage("father of " + e_name + " is wrong");\n                    close();\n                }\n                var father = fathers[fathers.length - 1];\n                if (e_type === 4) { // NODE\n                    var node = new Node(e_name, e_type);\n                    node.father = father;\n                    father.children.push(node);\n                } else {\n                    if (e_type === 5) { // link\n                        currentDocName = e_name;\n                    } \n                    var element = new Node(e_name, e_type);\n                    element.children = [];\n                    element.docId = currentDocName;\n                    if (e_type === 3) { // ElEMENT\n                        elements.push(element);\n                    }\n                    element.father = father;\n                    father.children.push(element);\n                    fathers.push(element);\n                }\n            }\n            for (var i = 0, len = elements.length; i < len; i++) {\n                var element = elements[i];\n                element.nodes = [];\n                extractNode(element, element.nodes);\n            }\n    \n            return elements;\n        };    \n    \n        var parseBBox = function(bboxBuffer, index) {\n            return new Float32Array(bboxBuffer, (index * 21 + 3) * 4, 6);\n        };\n    \n        var getElementBBox = function(nodes, bboxBuffer) {\n            var bbox = new Float32Array([Infinity, Infinity, Infinity, -Infinity, -Infinity, -Infinity]);\n            for (var i = 0, len = nodes.length; i < len; i++) {\n                var nodeBBox = parseBBox(bboxBuffer, nodes[i]);\n                if (bbox[0] > nodeBBox[0]) {\n                    bbox[0] = nodeBBox[0]\n                }\n                if (bbox[1] > nodeBBox[1]) {\n                    bbox[1] = nodeBBox[1]\n                }\n                if (bbox[2] > nodeBBox[2]) {\n                    bbox[2] = nodeBBox[2]\n                }\n                if (bbox[3] < nodeBBox[3]) {\n                    bbox[3] = nodeBBox[3]\n                }\n                if (bbox[4] < nodeBBox[4]) {\n                    bbox[4] = nodeBBox[4]\n                }\n                if (bbox[5] < nodeBBox[5]) {\n                    bbox[5] = nodeBBox[5]\n                }\n            }\n            return bbox;\n        }\n        var compareModel = function(elements1, elements2, bboxBuffer1, bboxBuffer2, modelId1, modelId2) {\n            if (elements1 === null || elements2 === null || bboxBuffer1 === null || bboxBuffer2 === null) {\n                return;\n            }\n            var EPS                 = 0.001;\n            var newElementIds1      = [];\n            var newElementIds2      = [];\n            var modifiedElementIds1 = [];\n            var modifiedElementIds2 = [];\n            elements1.sort(function(a, b) {\n                return a.name - b.name;\n            });\n            elements2.sort(function(a, b) {\n                return a.name - b.name;\n            });\n            var idx1 = 0, idx2 = 0;\n            var element1 = elements1[idx1];\n            var element2 = elements2[idx2];\n            while(element1 !== undefined && element2 !== undefined) {\n                if (element1.name === element2.name) {\n                    // compare nodes number and bbox\n                    if (element1.nodes.length != element2.nodes.length) {\n                        modifiedElementIds1.push(modelId1 + "+" + element1.docId + "/" + element1.name);\n                        modifiedElementIds2.push(modelId2 + "+" + element1.docId + "/" + element2.name);\n                    } else {\n                        var bbox1 = getElementBBox(element1.nodes, bboxBuffer1);\n                        var bbox2 = getElementBBox(element2.nodes, bboxBuffer2);\n                        if (Math.abs(bbox1[0] - bbox2[0]) > EPS ||\n                            Math.abs(bbox1[1] - bbox2[1]) > EPS ||\n                            Math.abs(bbox1[2] - bbox2[2]) > EPS ||\n                            Math.abs(bbox1[3] - bbox2[3]) > EPS ||\n                            Math.abs(bbox1[4] - bbox2[4]) > EPS ||\n                            Math.abs(bbox1[5] - bbox2[5]) > EPS) {\n                            modifiedElementIds1.push(modelId1 + "+" + element1.docId + "/" + element1.name);\n                            modifiedElementIds2.push(modelId2 + "+" + element1.docId + "/" + element2.name);\n                        }\n                    }\n                    idx1++;\n                    idx2++;\n                    element1 = elements1[idx1];\n                    element2 = elements2[idx2];\n                } else if (element1 === undefined || element1.name > element2.name) {\n                    // element2 doesn\'t exist in elements1;\n                    newElementIds2.push(modelId2 + "+" + element2.docId + "/" + element2.name);\n                    idx2++;\n                    element2 = elements2[idx2];\n                } else if (element2 === undefined || element1.name <= element2.name) {\n                    // element1 doesn\'t exist in elements2;\n                    newElementIds1.push(modelId1 + "+" + element1.docId + "/" + element1.name);\n                    idx1++;\n                    element1 = elements1[idx1];\n                }\n            }\n            postMessage({\n                newElements1: newElementIds1,\n                newElements2: newElementIds2,\n                modifiedElements1: modifiedElementIds1,\n                modifiedElements2: modifiedElementIds2\n            });\n            close();\n        }\n        var elements1 = null;\n        var elements2 = null;\n        var bboxBuffer1 = null;\n        var bboxBuffer2 = null;\n        var modelId1 = null;\n        var modelId2 = null;\n            \n        onmessage = function(evt) {\n            switch(evt.data.name) {\n                case "graph1":\n                    elements1 = parseGraph(evt.data.buffer);\n                    break;\n                case "graph2":\n                    elements2 = parseGraph(evt.data.buffer);\n                    break;\n                case "model1": \n                    var len = new Uint32Array(evt.data.buffer, 0, 1)[0];\n                    var nodesLocation = len * 20 + 8; // len * sizeof(uint32) * 5 + 8\n                    bboxBuffer1 = evt.data.buffer.slice(nodesLocation);\n                    modelId1 = evt.data.modelId;\n                    break;\n                case "model2":\n                    var len = new Uint32Array(evt.data.buffer, 0, 1)[0];\n                    var nodesLocation = len * 20 + 8; // len * sizeof(uint32) * 5 + 8\n                    bboxBuffer2 = evt.data.buffer.slice(nodesLocation);\n                    modelId2 = evt.data.modelId;\n                    break;\n            }\n            compareModel(elements1, elements2, bboxBuffer1, bboxBuffer2, modelId1, modelId2);\n        };\n        '],{type:"text/javascript"}),a=new Worker(window.URL.createObjectURL(n));a.onmessage=function(e){if(e.data instanceof String)i(e.data);else{var t=e.data;r(t)}},Object(s.b)(e).then(function(t){t["model.bin"].downloadFile().then(function(t){var r={buffer:t.data,name:"model1",modelId:e};a.postMessage(r,[r.buffer]),t.data.byteLength&&console.warn("transferred buffer not supported")},function(e){i(e)}),t["modelgraph.bin"].downloadFile().then(function(e){var t={buffer:e.data,name:"graph1"};a.postMessage(t,[t.buffer]),e.data.byteLength&&console.warn("transferred buffer not supported")},function(e){i(e)})}).catch(function(e){i(e)}),Object(s.b)(t).then(function(e){e["model.bin"].downloadFile().then(function(e){var r={buffer:e.data,name:"model2",modelId:t};a.postMessage(r,[r.buffer])},function(e){i(e)}),e["modelgraph.bin"].downloadFile().then(function(e){var t={buffer:e.data,name:"graph2"};a.postMessage(t,[t.buffer])},function(e){i(e)})}).catch(function(e){i(e)})})]})})},e.get3DPDFURL=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){return[2,Object(a.c)(e)]})})},e.getBBox=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){return[2,new Promise(function(t,r){Object(s.b)(e).then(function(e){e["model.json"].downloadFile().then(function(e){var r=e.data;t(r["model.bin"].bbox)}).catch(function(){r("error")})})})]})})}}(i||(i={}))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t){e.exports={"application/prs.cww":["cww"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["*iso"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]}},function(e,t){e.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma","es"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/mrb-consumer+xml":["*xdf"],"application/mrb-publish+xml":["*xdf"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["*xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-error+xml":["xer"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},function(e,t,r){"use strict";function i(){this._types=Object.create(null),this._extensions=Object.create(null);for(let e=0;e<arguments.length;e++)this.define(arguments[e]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}i.prototype.define=function(e,t){for(let r in e){let i=e[r].map(function(e){return e.toLowerCase()});r=r.toLowerCase();for(let e=0;e<i.length;e++){const n=i[e];if("*"!==n[0]){if(!t&&n in this._types)throw new Error('Attempt to change mapping for "'+n+'" extension from "'+this._types[n]+'" to "'+r+'". Pass `force=true` to allow this, otherwise remove "'+n+'" from the list of extensions for "'+r+'".');this._types[n]=r}}if(t||!this._extensions[r]){const e=i[0];this._extensions[r]="*"!==e[0]?e:e.substr(1)}}},i.prototype.getType=function(e){let t=(e=String(e)).replace(/^.*[/\\]/,"").toLowerCase(),r=t.replace(/^.*\./,"").toLowerCase(),i=t.length<e.length;return(r.length<t.length-1||!i)&&this._types[r]||null},i.prototype.getExtension=function(e){return(e=/^\s*([^;\s]*)/.test(e)&&RegExp.$1)&&this._extensions[e.toLowerCase()]||null},e.exports=i},function(e,t,r){"use strict";function i(e){for(var t=null,r=1;r<e.length;r++){var i=e[r],a=n(i);if(a!==i.length&&((null===t||a<t)&&0===(t=a)))break}return null===t?0:t}function n(e){for(var t=0;t<e.length&&(" "===e[t]||"\t"===e[t]);)t++;return t}function a(e){return n(e)===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.dedentBlockStringValue=function(e){var t=e.split(/\r\n|[\n\r]/g),r=i(t);if(0!==r)for(var n=1;n<t.length;n++)t[n]=t[n].slice(r);for(;t.length>0&&a(t[0]);)t.shift();for(;t.length>0&&a(t[t.length-1]);)t.pop();return t.join("\n")},t.getBlockStringIndentation=i,t.printBlockString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=-1===e.indexOf("\n"),n=" "===e[0]||"\t"===e[0],a='"'===e[e.length-1],o=!i||a||r,s="";!o||i&&n||(s+="\n"+t);s+=t?e.replace(/\n/g,"\n"+t):e,o&&(s+="\n");return'"""'+s.replace(/"""/g,'\\"""')+'"""'}},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.Observable=void 0;var o=function(){return"function"==typeof Symbol},s=function(e){return o()&&Boolean(Symbol[e])},l=function(e){return s(e)?Symbol[e]:"@@"+e};o()&&!s("observable")&&(Symbol.observable=Symbol("observable"));var u=l("iterator"),c=l("observable"),h=l("species");function d(e,t){var r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function p(e){var t=e.constructor;return void 0!==t&&null===(t=t[h])&&(t=void 0),void 0!==t?t:M}function f(e){return e instanceof M}function _(e){_.log?_.log(e):setTimeout(function(){throw e})}function m(e){Promise.resolve().then(function(){try{e()}catch(e){_(e)}})}function v(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var r=d(t,"unsubscribe");r&&r.call(t)}}catch(e){_(e)}}function y(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function g(e,t,r){e._state="running";var i=e._observer;try{var n=d(i,t);switch(t){case"next":n&&n.call(i,r);break;case"error":if(y(e),!n)throw r;n.call(i,r);break;case"complete":y(e),n&&n.call(i)}}catch(e){_(e)}"closed"===e._state?v(e):"running"===e._state&&(e._state="ready")}function b(e,t,r){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void m(function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var r=0;r<t.length&&(g(e,t[r].type,t[r].value),"closed"!==e._state);++r);}}(e)})):void g(e,t,r);e._queue.push({type:t,value:r})}}var w=function(){function e(t,r){i(this,e),this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var n=new x(this);try{this._cleanup=r.call(void 0,n)}catch(e){n.error(e)}"initializing"===this._state&&(this._state="ready")}return a(e,[{key:"unsubscribe",value:function(){"closed"!==this._state&&(y(this),v(this))}},{key:"closed",get:function(){return"closed"===this._state}}]),e}(),x=function(){function e(t){i(this,e),this._subscription=t}return a(e,[{key:"next",value:function(e){b(this._subscription,"next",e)}},{key:"error",value:function(e){b(this._subscription,"error",e)}},{key:"complete",value:function(){b(this._subscription,"complete")}},{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),M=function(){function e(t){if(i(this,e),!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}return a(e,[{key:"subscribe",value:function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new w(e,this._subscriber)}},{key:"forEach",value:function(e){var t=this;return new Promise(function(r,i){if("function"==typeof e)var n=t.subscribe({next:function(t){try{e(t,a)}catch(e){i(e),n.unsubscribe()}},error:i,complete:r});else i(new TypeError(e+" is not a function"));function a(){n.unsubscribe(),r()}})}},{key:"map",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(p(this))(function(r){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})})}},{key:"filter",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(p(this))(function(r){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})})}},{key:"reduce",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=p(this),i=arguments.length>1,n=!1,a=arguments[1];return new r(function(r){return t.subscribe({next:function(t){var o=!n;if(n=!0,!o||i)try{a=e(a,t)}catch(e){return r.error(e)}else a=t},error:function(e){r.error(e)},complete:function(){if(!n&&!i)return r.error(new TypeError("Cannot reduce an empty sequence"));r.next(a),r.complete()}})})}},{key:"concat",value:function(){for(var e=this,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=p(this);return new n(function(t){var i,a=0;return function e(o){i=o.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){a===r.length?(i=void 0,t.complete()):e(n.from(r[a++]))}})}(e),function(){i&&(i.unsubscribe(),i=void 0)}})}},{key:"flatMap",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=p(this);return new r(function(i){var n=[],a=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return i.error(e)}var a=r.from(t).subscribe({next:function(e){i.next(e)},error:function(e){i.error(e)},complete:function(){var e=n.indexOf(a);e>=0&&n.splice(e,1),o()}});n.push(a)},error:function(e){i.error(e)},complete:function(){o()}});function o(){a.closed&&0===n.length&&i.complete()}return function(){n.forEach(function(e){return e.unsubscribe()}),a.unsubscribe()}})}},{key:c,value:function(){return this}}],[{key:"from",value:function(t){var r="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var i=d(t,c);if(i){var n=i.call(t);if(Object(n)!==n)throw new TypeError(n+" is not an object");return f(n)&&n.constructor===r?n:new r(function(e){return n.subscribe(e)})}if(s("iterator")&&(i=d(t,u)))return new r(function(e){m(function(){if(!e.closed){var r=!0,n=!1,a=void 0;try{for(var o,s=i.call(t)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;if(e.next(l),e.closed)return}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}e.complete()}})});if(Array.isArray(t))return new r(function(e){m(function(){if(!e.closed){for(var r=0;r<t.length;++r)if(e.next(t[r]),e.closed)return;e.complete()}})});throw new TypeError(t+" is not observable")}},{key:"of",value:function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return new("function"==typeof this?this:e)(function(e){m(function(){if(!e.closed){for(var t=0;t<r.length;++t)if(e.next(r[t]),e.closed)return;e.complete()}})})}},{key:h,get:function(){return this}}]),e}();t.Observable=M,o()&&Object.defineProperty(M,Symbol("extensions"),{value:{symbol:c,hostReportError:_},configurable:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return s(e,[])};var i=function(e){return e&&e.__esModule?e:{default:e}}(r(128));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=10,o=2;function s(e,t){switch(n(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var r=[].concat(t,[e]),n=function(e){var t=e[String(i.default)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==n){var l=n.call(e);if(l!==e)return"string"==typeof l?l:s(l,r)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>o)return"[Array]";for(var r=Math.min(a,e.length),i=e.length-r,n=[],l=0;l<r;++l)n.push(s(e[l],t));1===i?n.push("... 1 more item"):i>1&&n.push("... ".concat(i," more items"));return"["+n.join(", ")+"]"}(e,r);return function(e,t){var r=Object.keys(e);if(0===r.length)return"{}";if(t.length>o)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var r=e.constructor.name;if("string"==typeof r&&""!==r)return r}return t}(e)+"]";return"{ "+r.map(function(r){var i=s(e[r],t);return r+": "+i}).join(", ")+" }"}(e,r)}(e,t);default:return String(e)}}},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){"use strict";var i=r(70);function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new i(e),t(r.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e;return{token:new n(function(t){e=t}),cancel:e}},e.exports=n},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";var i=r(36);e.exports=function(e,t,r){return i.forEach(r,function(r){e=r(e,t)}),e}},function(e,t,r){"use strict";var i=r(36),n=r(134),a=r(71),o=r(62),s=r(133),l=r(132);function u(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return u(e),e.baseURL&&!s(e.url)&&(e.url=l(e.baseURL,e.url)),e.headers=e.headers||{},e.data=n(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),i.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||o.adapter)(e).then(function(t){return u(e),t.data=n(t.data,t.headers,e.transformResponse),t},function(t){return a(t)||(u(e),t&&t.response&&(t.response.data=n(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,r){"use strict";var i=r(36);function n(){this.handlers=[]}n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=n},function(e,t,r){"use strict";var i=r(36);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,r,n,a,o){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),i.isString(n)&&s.push("path="+n),i.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var i=r(36);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var i=e;return t&&(r.setAttribute("href",i),i=r.href),r.setAttribute("href",i),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=i.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var i=r(36),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,a,o={};return e?(i.forEach(e.split("\n"),function(e){if(a=e.indexOf(":"),t=i.trim(e.substr(0,a)).toLowerCase(),r=i.trim(e.substr(a+1)),t){if(o[t]&&n.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}}),o):o}},function(e,t,r){"use strict";var i=r(36);function n(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var a;if(r)a=r(t);else if(i.isURLSearchParams(t))a=t.toString();else{var o=[];i.forEach(t,function(e,t){null!==e&&void 0!==e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),o.push(n(t)+"="+n(e))}))}),a=o.join("&")}return a&&(e+=(-1===e.indexOf("?")?"?":"&")+a),e}},function(e,t,r){"use strict";e.exports=function(e,t,r,i,n){return e.config=t,r&&(e.code=r),e.request=i,e.response=n,e}},function(e,t,r){"use strict";var i=r(72);e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(i("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},function(e,t,r){"use strict";var i=r(36);e.exports=function(e,t){i.forEach(e,function(r,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[i])})}},function(e,t,r){"use strict";var i=r(62),n=r(36),a=r(136),o=r(135);function s(e){this.defaults=e,this.interceptors={request:new a,response:new a}}s.prototype.request=function(e){"string"==typeof e&&(e=n.merge({url:arguments[0]},arguments[1])),(e=n.merge(i,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[o,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},n.forEach(["delete","get","head","options"],function(e){s.prototype[e]=function(t,r){return this.request(n.merge(r||{},{method:e,url:t}))}}),n.forEach(["post","put","patch"],function(e){s.prototype[e]=function(t,r,i){return this.request(n.merge(i||{},{method:e,url:t,data:r}))}}),e.exports=s},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,r){"use strict";var i=r(36),n=r(74),a=r(144),o=r(62);function s(e){var t=new a(e),r=n(a.prototype.request,t);return i.extend(r,a.prototype,t),i.extend(r,t),r}var l=s(o);l.Axios=a,l.create=function(e){return s(i.merge(o,e))},l.Cancel=r(70),l.CancelToken=r(131),l.isCancel=r(71),l.all=function(e){return Promise.all(e)},l.spread=r(130),e.exports=l,e.exports.default=l},function(e,t){var r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Model"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"folderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"targetModelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"version"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"downloadUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"convertedUrls"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:298}};r.loc.source={body:"fragment ModelInfo on Model {\n    id\n    folderId\n    targetModelId\n    type\n    name\n    status\n    version\n    createdBy {\n        id\n        username\n    }\n    createdAt\n    updatedAt\n    downloadUrls {\n        filename\n        url\n    }\n    convertedUrls {\n        filename\n        url\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=r},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"init",function(){return _});var i=r(43),n=r(121),a=r(81),o=r(55),s=r(75),l=r(49),u=r(77),c=r(28),h=r(76),d=r(67);for(var p in d)["init","default"].indexOf(p)<0&&function(e){r.d(t,e,function(){return d[e]})}(p);var f=r(39);function _(e){Object(c.b)(e,Object(c.d)(["endpoint","appToken"]),"initial config not valid"),Object(i.b)(e)}r.d(t,"ComStatus",function(){return f.c}),r.d(t,"AssetType",function(){return f.b}),r.d(t,"TaskPriority",function(){return f.k}),r.d(t,"TaskCommentType",function(){return f.j}),r.d(t,"IssuePriority",function(){return f.d}),r.d(t,"IssueStatus",function(){return f.e}),r.d(t,"ModelType",function(){return f.h}),r.d(t,"ModelStatus",function(){return f.g}),r.d(t,"SelectionType",function(){return f.i}),r.d(t,"ModelShaderSetting",function(){return f.f}),r.d(t,"AssetStatus",function(){return f.a}),r.d(t,"WechatMessageType",function(){return f.l}),e.WebGLUtils=Object(h.a)(),t.default={Model:n.a,Asset:a.a,BIM:o.a,Comment:l.a,RenderSetting:u.a,View:s.a,isSupportWebGL:c.e,isSupportWebGL2:c.f,init:_}}.call(this,r(63))},function(e,t,r){e.exports=r(148)}]).default});
//# sourceMappingURL=build.js.map